"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[702],{5702:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(9379),r=s(9950),l=s(7902),d=s(4414);const i=e=>{let{workPackages:t,setWorkPackages:i,currentProject:n,risks:c=[],scheduleData:o=null,includeWeekends:x=!1,purchaseOrders:u=[],setPurchaseOrders:m,advances:p=[],setAdvances:h,invoices:v=[],setInvoices:g,contracts:b=[],setContracts:j,useSupabase:N=!1}=e;const[y,f]=(0,r.useState)(!1),[w,C]=(0,r.useState)(!1),[D,A]=(0,r.useState)(!1),[I,k]=(0,r.useState)(null),[P,E]=(0,r.useState)(null),[S,F]=(0,r.useState)(null),[V,O]=(0,r.useState)(!1),[R,T]=(0,r.useState)(null),{logFinancialEvent:$}=(0,l.A)(null===n||void 0===n?void 0:n.id,N);r.useEffect(()=>{o&&(e=>{if(!e||!e.tasks)return;console.log("\ud83d\udd04 Sincronizando m\xe9tricas financieras con cronograma...");const s=t.map(t=>{const s=e.tasks.find(e=>e.workPackageId===t.id);return s?{id:t.id,name:t.name,description:t.description,startDate:t.startDate,endDate:t.endDate,budget:t.budget,actualCost:t.actualCost,status:t.status,priority:t.priority,percentComplete:s.progress||t.percentComplete,plannedValue:t.plannedValue,earnedValue:s.progress?t.plannedValue*s.progress/100:t.earnedValue,resources:t.resources,startDate:s.startDate||t.startDate,endDate:s.endDate||t.endDate,status:s.status||t.status}:t});i(s),console.log("\u2705 Work packages actualizados desde cronograma")})(o)},[o]);const B=()=>{if(!c||!Array.isArray(c))return.05*((null===n||void 0===n?void 0:n.budget)||0);const e=c.filter(e=>"active"===e.status);if(0===e.length)return.05*((null===n||void 0===n?void 0:n.budget)||0);return.05*((null===n||void 0===n?void 0:n.budget)||0)+e.reduce((e,t)=>e+(t.probability||0)*(t.costImpact||0)*("high"===t.priority?1.5:"medium"===t.priority?1.2:1),0)},L=()=>{if(!n)return 0;const e=n.budget||0;if(!c||!Array.isArray(c))return.1*e;const t=c.filter(e=>"active"===e.status);let s=.1*e;t.length>10?s*=1.2:t.length>5&&(s*=1.1);return t.filter(e=>"high"===e.priority).length>3&&(s*=1.15),s},q=(0,r.useMemo)(()=>{const e=Array.isArray(u)?u:[],t=Array.isArray(p)?p:[],s=Array.isArray(v)?v:[];console.log("\ud83d\udd0d FINANCIAL METRICS DEBUG:",{purchaseOrdersType:typeof u,purchaseOrdersIsArray:Array.isArray(u),purchaseOrdersLength:e.length,advancesType:typeof p,advancesIsArray:Array.isArray(p),advancesLength:t.length,invoicesType:typeof v,invoicesIsArray:Array.isArray(v),invoicesLength:s.length});const a=e.reduce((e,t)=>e+(t.totalAmount||0),0),r=t.reduce((e,t)=>e+(t.amount||0),0),l=s.reduce((e,t)=>e+(t.amount||0),0),d=s.filter(e=>"paid"===e.status).reduce((e,t)=>e+(t.amount||0),0),i=l-d,c=(null===n||void 0===n?void 0:n.budget)||0,o=l,x=d,m=a+r,h=b.reduce((e,t)=>e+(t.value||0),0),g=b.filter(e=>"active"===e.status).reduce((e,t)=>e+(t.value||0),0),j=c-x,N=o+j;return{totalPO:a,totalAdvances:r,totalInvoices:l,paidInvoices:d,pendingInvoices:i,totalContracts:h,activeContracts:g,committedBudget:a+r+g,availableBudget:c-(a+r+g),BAC:c,AC:o,EV:x,PV:m,CV:x-o,SV:x-m,CPI:o>0?x/o:1,SPI:m>0?x/m:1,ETC:j,EAC:N,VAC:c-N,TCPI:(c-x)/(c-o),percentComplete:c>0?x/c*100:0,percentSpent:c>0?o/c*100:0,contingencyReserve:B(),managementReserve:L(),totalReserves:B()+L(),totalProjectBudget:((null===n||void 0===n?void 0:n.budget)||0)+B()+L()}},[u,p,v,b,n,c]),z=e=>{switch(e){case"paid":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-100 rounded-2xl shadow-lg p-6 text-gray-800 relative overflow-hidden",children:[(0,d.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-green-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,d.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-emerald-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,d.jsx)("div",{className:"relative z-10",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,d.jsx)("span",{className:"text-3xl",children:"\ud83d\udcb0"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gray-800",children:"Gesti\xf3n Financiera"}),(0,d.jsx)("p",{className:"text-gray-600 text-lg",children:"Control de costos, \xf3rdenes de compra, anticipos y facturas"})]})]}),(0,d.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl px-4 py-2 shadow-sm",children:(0,d.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,d.jsx)("span",{className:"text-gray-600",children:"\ud83d\udcc5 D\xedas laborables:"}),(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(x?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:x?"Lunes a Domingo":"Lunes a Viernes"})]})})]})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-blue-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["BAC (Presupuesto)",(0,d.jsx)("span",{className:"ml-1 text-blue-500 cursor-help",title:"Budget at Completion: Presupuesto total aprobado para el proyecto",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:["$",(q.BAC/1e3).toFixed(0),"K"]})]}),(0,d.jsx)("div",{className:"text-blue-500 text-2xl",children:"\ud83d\udcb0"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-green-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["EV (Valor Ganado)",(0,d.jsx)("span",{className:"ml-1 text-green-500 cursor-help",title:"Earned Value: Valor del trabajo realmente completado",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",(q.EV/1e3).toFixed(0),"K"]})]}),(0,d.jsx)("div",{className:"text-green-500 text-2xl",children:"\ud83d\udcc8"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-yellow-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["AC (Costo Real)",(0,d.jsx)("span",{className:"ml-1 text-yellow-500 cursor-help",title:"Actual Cost: Costo real incurrido hasta la fecha",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-yellow-600",children:["$",(q.AC/1e3).toFixed(0),"K"]})]}),(0,d.jsx)("div",{className:"text-yellow-500 text-2xl",children:"\ud83d\udcb8"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-purple-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["EAC (Estimaci\xf3n Final)",(0,d.jsx)("span",{className:"ml-1 text-purple-500 cursor-help",title:"Estimate at Completion: Estimaci\xf3n del costo total al terminar",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-purple-600",children:["$",(q.EAC/1e3).toFixed(0),"K"]})]}),(0,d.jsx)("div",{className:"text-purple-500 text-2xl",children:"\ud83c\udfaf"})]})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-blue-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["CPI",(0,d.jsx)("span",{className:"ml-1 text-blue-500 cursor-help",title:"Cost Performance Index: EV/AC",children:"\u2753"})]}),(0,d.jsx)("div",{className:"text-2xl font-bold ".concat(q.CPI>=1?"text-green-600":"text-red-600"),children:q.CPI.toFixed(2)}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"Cost Performance"})]}),(0,d.jsx)("div",{className:"text-blue-500 text-2xl",children:"\ud83d\udcca"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-orange-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["SPI",(0,d.jsx)("span",{className:"ml-1 text-orange-500 cursor-help",title:"Schedule Performance Index: EV/PV",children:"\u2753"})]}),(0,d.jsx)("div",{className:"text-2xl font-bold ".concat(q.SPI>=1?"text-green-600":"text-red-600"),children:q.SPI.toFixed(2)}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"Schedule Performance"})]}),(0,d.jsx)("div",{className:"text-orange-500 text-2xl",children:"\u23f1\ufe0f"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-red-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["VAC",(0,d.jsx)("span",{className:"ml-1 text-red-500 cursor-help",title:"Variance at Completion: BAC-EAC",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold ".concat(q.VAC>=0?"text-green-600":"text-red-600"),children:["$",(q.VAC/1e3).toFixed(0),"K"]}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"Variance at Completion"})]}),(0,d.jsx)("div",{className:"text-red-500 text-2xl",children:"\ud83d\udcc9"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-teal-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["TCPI",(0,d.jsx)("span",{className:"ml-1 text-teal-500 cursor-help",title:"To Complete Performance Index",children:"\u2753"})]}),(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:q.TCPI.toFixed(2)}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"To Complete Performance"})]}),(0,d.jsx)("div",{className:"text-teal-500 text-2xl",children:"\ud83c\udfaf"})]})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-purple-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["Contratos Activos",(0,d.jsx)("span",{className:"ml-1 text-purple-500 cursor-help",title:"Valor total de contratos activos",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",(q.activeContracts/1e3).toFixed(0),"K"]}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"Valor total"})]}),(0,d.jsx)("div",{className:"text-purple-500 text-2xl",children:"\ud83d\udccb"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-green-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["% Completado",(0,d.jsx)("span",{className:"ml-1 text-green-500 cursor-help",title:"Porcentaje de trabajo completado",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:[q.percentComplete.toFixed(1),"%"]}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"Progreso del proyecto"})]}),(0,d.jsx)("div",{className:"text-green-500 text-2xl",children:"\ud83d\udcc8"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-orange-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["% Gastado",(0,d.jsx)("span",{className:"ml-1 text-orange-500 cursor-help",title:"Porcentaje del presupuesto utilizado",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:[q.percentSpent.toFixed(1),"%"]}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"Presupuesto utilizado"})]}),(0,d.jsx)("div",{className:"text-orange-500 text-2xl",children:"\ud83d\udcb8"})]})})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\ud83d\udee1\ufe0f Reservas y Contingencias"}),(0,d.jsx)("span",{className:"text-sm text-gray-500",children:"Basado en an\xe1lisis de riesgos"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,d.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["Presupuesto Base",(0,d.jsx)("span",{className:"ml-1 text-gray-500 cursor-help",title:"Presupuesto inicial aprobado del proyecto",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",(((null===n||void 0===n?void 0:n.budget)||0)/1e3).toFixed(0),"K"]})]}),(0,d.jsx)("div",{className:"text-gray-500 text-2xl",children:"\ud83d\udcb0"})]})}),(0,d.jsx)("div",{className:"bg-blue-50 rounded-lg p-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["Reserva de Contingencia",(0,d.jsx)("span",{className:"ml-1 text-blue-500 cursor-help",title:"Reserva para riesgos identificados. F\xf3rmula: 5% base + impacto esperado de riesgos activos",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-blue-800",children:["$",(q.contingencyReserve/1e3).toFixed(0),"K"]})]}),(0,d.jsx)("div",{className:"text-blue-500 text-2xl",children:"\ud83d\udee1\ufe0f"})]})}),(0,d.jsx)("div",{className:"bg-green-50 rounded-lg p-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["Reserva de Gesti\xf3n",(0,d.jsx)("span",{className:"ml-1 text-green-500 cursor-help",title:"Reserva para riesgos no identificados. F\xf3rmula: 10% base + ajustes por complejidad",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-green-800",children:["$",(q.managementReserve/1e3).toFixed(0),"K"]})]}),(0,d.jsx)("div",{className:"text-green-500 text-2xl",children:"\ud83d\udcca"})]})}),(0,d.jsx)("div",{className:"bg-purple-50 rounded-lg p-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center",children:["Presupuesto Total",(0,d.jsx)("span",{className:"ml-1 text-purple-500 cursor-help",title:"Presupuesto base + reservas de contingencia y gesti\xf3n",children:"\u2753"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-purple-800",children:["$",(q.totalProjectBudget/1e3).toFixed(0),"K"]})]}),(0,d.jsx)("div",{className:"text-purple-500 text-2xl",children:"\ud83c\udfaf"})]})})]}),(0,d.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,d.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udccb Detalles del C\xe1lculo"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs text-gray-600",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Reserva de Contingencia:"})," 5% del presupuesto base + impacto esperado de riesgos activos"]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Riesgos Activos:"})," ",(null===c||void 0===c?void 0:c.filter(e=>"active"===e.status).length)||0," identificados"]})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Reserva de Gesti\xf3n:"})," 10% del presupuesto base + ajustes por complejidad"]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Riesgos de Alta Prioridad:"})," ",(null===c||void 0===c?void 0:c.filter(e=>"active"===e.status&&"high"===e.priority).length)||0," identificados"]})]})]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\ud83d\udccb \xd3rdenes de Compra"}),(0,d.jsx)("button",{onClick:()=>{k({id:"",number:"",supplier:"",description:"",totalAmount:0,currency:"USD",status:"pending",requestDate:(new Date).toISOString().split("T")[0],approvalDate:"",expectedDate:"",projectId:(null===n||void 0===n?void 0:n.id)||""}),f(!0)},className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700",children:"+ Nueva"})]}),(0,d.jsx)("div",{className:"space-y-3",children:Array.isArray(u)&&0!==u.length?u.map(e=>{var t;return(0,d.jsx)("div",{className:"border rounded p-3",children:(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("div",{className:"font-medium text-sm",children:e.number}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:e.supplier}),(0,d.jsxs)("div",{className:"text-xs text-gray-600",children:["$",null===(t=e.totalAmount)||void 0===t?void 0:t.toLocaleString()]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("approved"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:"approved"===e.status?"Aprobada":"pending"===e.status?"Pendiente":"Rechazada"}),"approved"===e.status&&(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e.approvalDate&&""!==e.approvalDate.trim()?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"),children:e.approvalDate&&""!==e.approvalDate.trim()?"\u2705 ".concat(new Date(e.approvalDate+"T00:00:00").toLocaleDateString("es-ES")):"\u26a0\ufe0f Sin fecha de aprobaci\xf3n"})]})]}),(0,d.jsxs)("div",{className:"flex space-x-1",children:[(0,d.jsx)("button",{onClick:()=>{k(e),f(!0)},className:"text-blue-600 hover:text-blue-800 text-sm",children:"\u270f\ufe0f"}),(0,d.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xbfEst\xe1s seguro de que quieres eliminar esta orden de compra?"))try{const{default:t}=await Promise.resolve().then(s.bind(s,9874)),a=await t.deletePurchaseOrder(e);if(a.success){const t=(Array.isArray(u)?u:[]).filter(t=>t.id!==e);console.log("\ud83d\uddd1\ufe0f ELIMINANDO OC:",e,"\xd3rdenes restantes:",t.length),m(t),console.log("\u2705 Orden de compra eliminada localmente y de Supabase")}else console.error("\u274c Error eliminando orden de compra de Supabase:",a.error),alert("Error eliminando la orden de compra. Int\xe9ntalo de nuevo.")}catch(t){console.error("\u274c Error inesperado eliminando orden de compra:",t),alert("Error inesperado eliminando la orden de compra. Int\xe9ntalo de nuevo.")}})(e.id),className:"text-red-600 hover:text-red-800 text-sm",children:"\ud83d\uddd1\ufe0f"})]})]})},e.id)}):(0,d.jsx)("p",{className:"text-gray-500 text-sm",children:"No hay \xf3rdenes de compra"})})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\ud83d\udcb3 Anticipos"}),(0,d.jsx)("button",{onClick:()=>{E({}),C(!0)},className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700",children:"+ Nuevo"})]}),(0,d.jsx)("div",{className:"space-y-3",children:0===p.length?(0,d.jsx)("p",{className:"text-gray-500 text-sm",children:"No hay anticipos"}):p.map(e=>{var t;return(0,d.jsx)("div",{className:"border rounded p-3",children:(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"font-medium text-sm",children:e.number}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:e.supplier}),(0,d.jsxs)("div",{className:"text-xs text-gray-600",children:["$",null===(t=e.amount)||void 0===t?void 0:t.toLocaleString()]})]}),(0,d.jsxs)("div",{className:"flex space-x-1",children:[(0,d.jsx)("button",{onClick:()=>{E(e),C(!0)},className:"text-blue-600 hover:text-blue-800 text-sm",children:"\u270f\ufe0f"}),(0,d.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xbfEst\xe1s seguro de que quieres eliminar este anticipo?"))try{const{default:t}=await Promise.resolve().then(s.bind(s,9874)),a=await t.deleteAdvance(e);if(a.success){const t=(Array.isArray(p)?p:[]).filter(t=>t.id!==e);h(t),console.log("\u2705 Anticipo eliminado localmente y de Supabase")}else console.error("\u274c Error eliminando anticipo de Supabase:",a.error),alert("Error eliminando el anticipo. Int\xe9ntalo de nuevo.")}catch(t){console.error("\u274c Error inesperado eliminando anticipo:",t),alert("Error inesperado eliminando el anticipo. Int\xe9ntalo de nuevo.")}})(e.id),className:"text-red-600 hover:text-red-800 text-sm",children:"\ud83d\uddd1\ufe0f"})]})]})},e.id)})})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\ud83d\udcc4 Facturas"}),(0,d.jsx)("button",{onClick:()=>{F({}),A(!0)},className:"bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700",children:"+ Nueva"})]}),(0,d.jsx)("div",{className:"space-y-3",children:0===v.length?(0,d.jsx)("p",{className:"text-gray-500 text-sm",children:"No hay facturas"}):v.map(e=>{var t;return(0,d.jsx)("div",{className:"border rounded p-3",children:(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"font-medium text-sm",children:e.number}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:e.supplier}),(0,d.jsxs)("div",{className:"text-xs text-gray-600",children:["$",null===(t=e.amount)||void 0===t?void 0:t.toLocaleString()]}),(0,d.jsx)("span",{className:"inline-block px-2 py-1 rounded-full text-xs font-medium ".concat(z(e.status)),children:e.status})]}),(0,d.jsxs)("div",{className:"flex space-x-1",children:[(0,d.jsx)("button",{onClick:()=>{F(e),A(!0)},className:"text-blue-600 hover:text-blue-800 text-sm",children:"\u270f\ufe0f"}),(0,d.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xbfEst\xe1s seguro de que quieres eliminar esta factura?"))try{const{default:t}=await Promise.resolve().then(s.bind(s,9874)),a=await t.deleteInvoice(e);if(a.success){const t=(Array.isArray(v)?v:[]).filter(t=>t.id!==e);g(t),console.log("\u2705 Factura eliminada localmente y de Supabase")}else console.error("\u274c Error eliminando factura de Supabase:",a.error),alert("Error eliminando la factura. Int\xe9ntalo de nuevo.")}catch(t){console.error("\u274c Error inesperado eliminando factura:",t),alert("Error inesperado eliminando la factura. Int\xe9ntalo de nuevo.")}})(e.id),className:"text-red-600 hover:text-red-800 text-sm",children:"\ud83d\uddd1\ufe0f"})]})]})},e.id)})})]})]}),y&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,d.jsx)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,d.jsxs)("div",{className:"p-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsx)("h2",{className:"text-xl font-bold",children:null!==I&&void 0!==I&&I.id?"Editar Orden de Compra":"Nueva Orden de Compra"}),(0,d.jsx)("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700 text-xl",children:"\u2715"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xfamero de OC *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:(null===I||void 0===I?void 0:I.number)||"",onChange:e=>k((0,a.A)((0,a.A)({},I),{},{number:e.target.value})),placeholder:"PO-2025-XXX"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Proveedor *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:(null===I||void 0===I?void 0:I.supplier)||"",onChange:e=>k((0,a.A)((0,a.A)({},I),{},{supplier:e.target.value})),placeholder:"Nombre del proveedor"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto Total *"}),(0,d.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2",value:(null===I||void 0===I?void 0:I.totalAmount)||"",onChange:e=>k((0,a.A)((0,a.A)({},I),{},{totalAmount:Number(e.target.value)})),min:"0",step:"0.01"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),(0,d.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:(null===I||void 0===I?void 0:I.status)||"pending",onChange:e=>k((0,a.A)((0,a.A)({},I),{},{status:e.target.value})),children:[(0,d.jsx)("option",{value:"pending",children:"Pendiente"}),(0,d.jsx)("option",{value:"approved",children:"Aprobada"}),(0,d.jsx)("option",{value:"rejected",children:"Rechazada"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Fecha de Aprobaci\xf3n *",(0,d.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,d.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===I||void 0===I?void 0:I.approvalDate)||"",onChange:e=>k((0,a.A)((0,a.A)({},I),{},{approvalDate:e.target.value})),required:!0}),(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Fecha cuando la orden fue aprobada (usada para flujo de caja)"})]}),(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,d.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===I||void 0===I?void 0:I.description)||"",onChange:e=>k((0,a.A)((0,a.A)({},I),{},{description:e.target.value})),placeholder:"Descripci\xf3n de los productos/servicios"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,d.jsx)("button",{onClick:()=>f(!1),className:"px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,d.jsx)("button",{onClick:()=>{if(console.log("\ud83d\udcbe GUARDANDO OC - editingPO:",I),"approved"===I.status&&(!I.approvalDate||""===I.approvalDate.trim()))return void alert("\u26a0\ufe0f Error: Las \xf3rdenes de compra aprobadas deben tener una fecha de aprobaci\xf3n para el c\xe1lculo del flujo de caja.");const e=Array.isArray(u)?u:[];if(I.id){const t=e.map(e=>e.id===I.id?I:e);console.log("\ud83d\udcdd EDITANDO OC EXISTENTE:",I.id,"Total \xf3rdenes:",t.length),m(t)}else{const t={id:Date.now().toString(),number:I.number,supplier:I.supplier,description:I.description,totalAmount:I.totalAmount,currency:I.currency||"USD",status:I.status,requestDate:I.requestDate,approvalDate:I.approvalDate,expectedDate:I.expectedDate,projectId:I.projectId},s=[...e,t];console.log("\u2795 CREANDO NUEVA OC:",t.id,"Total \xf3rdenes:",s.length),m(s),$&&n&&$("purchase-order",t,n)}f(!1),k(null)},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Guardar"})]})]})})}),w&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,d.jsx)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,d.jsxs)("div",{className:"p-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsx)("h2",{className:"text-xl font-bold",children:null!==P&&void 0!==P&&P.id?"Editar Anticipo":"Nuevo Anticipo"}),(0,d.jsx)("button",{onClick:()=>C(!1),className:"text-gray-500 hover:text-gray-700 text-xl",children:"\u2715"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xfamero de Anticipo *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:(null===P||void 0===P?void 0:P.number)||"",onChange:e=>E({id:P.id,number:P.number,supplier:P.supplier,amount:P.amount,paymentDate:P.paymentDate,description:P.description,projectId:P.projectId,number:e.target.value}),placeholder:"ADV-2025-XXX"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Proveedor *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:(null===P||void 0===P?void 0:P.supplier)||"",onChange:e=>E({id:P.id,number:P.number,supplier:P.supplier,amount:P.amount,paymentDate:P.paymentDate,description:P.description,projectId:P.projectId,supplier:e.target.value}),placeholder:"Nombre del proveedor"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto *"}),(0,d.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2",value:(null===P||void 0===P?void 0:P.amount)||"",onChange:e=>E({id:P.id,number:P.number,supplier:P.supplier,amount:P.amount,paymentDate:P.paymentDate,description:P.description,projectId:P.projectId,amount:Number(e.target.value)}),min:"0",step:"0.01"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Pago"}),(0,d.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2",value:(null===P||void 0===P?void 0:P.paymentDate)||"",onChange:e=>E({id:P.id,number:P.number,supplier:P.supplier,amount:P.amount,paymentDate:P.paymentDate,description:P.description,projectId:P.projectId,paymentDate:e.target.value})})]}),(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,d.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===P||void 0===P?void 0:P.description)||"",onChange:e=>E({id:P.id,number:P.number,supplier:P.supplier,amount:P.amount,paymentDate:P.paymentDate,description:P.description,projectId:P.projectId,description:e.target.value}),placeholder:"Descripci\xf3n del anticipo"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,d.jsx)("button",{onClick:()=>C(!1),className:"px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,d.jsx)("button",{onClick:()=>{const e=Array.isArray(p)?p:[];if(P.id){const t=e.map(e=>e.id===P.id?P:e);h(t)}else{const t={id:Date.now().toString(),number:P.number,supplier:P.supplier,amount:P.amount,paymentDate:P.paymentDate,description:P.description,projectId:P.projectId},s=[...e,t];h(s),$&&n&&$("advance",t,n)}C(!1),E(null)},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Guardar"})]})]})})}),D&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,d.jsx)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,d.jsxs)("div",{className:"p-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsx)("h2",{className:"text-xl font-bold",children:null!==S&&void 0!==S&&S.id?"Editar Factura":"Nueva Factura"}),(0,d.jsx)("button",{onClick:()=>A(!1),className:"text-gray-500 hover:text-gray-700 text-xl",children:"\u2715"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xfamero de Factura *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:(null===S||void 0===S?void 0:S.number)||"",onChange:e=>F({id:S.id,number:S.number,supplier:S.supplier,amount:S.amount,status:S.status,receivedDate:S.receivedDate,dueDate:S.dueDate,description:S.description,projectId:S.projectId,number:e.target.value}),placeholder:"INV-2025-XXX"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Proveedor *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:(null===S||void 0===S?void 0:S.supplier)||"",onChange:e=>F({id:S.id,number:S.number,supplier:S.supplier,amount:S.amount,status:S.status,receivedDate:S.receivedDate,dueDate:S.dueDate,description:S.description,projectId:S.projectId,supplier:e.target.value}),placeholder:"Nombre del proveedor"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto *"}),(0,d.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2",value:(null===S||void 0===S?void 0:S.amount)||"",onChange:e=>F({id:S.id,number:S.number,supplier:S.supplier,amount:S.amount,status:S.status,receivedDate:S.receivedDate,dueDate:S.dueDate,description:S.description,projectId:S.projectId,amount:Number(e.target.value)}),min:"0",step:"0.01"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),(0,d.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:(null===S||void 0===S?void 0:S.status)||"pending",onChange:e=>F({id:S.id,number:S.number,supplier:S.supplier,amount:S.amount,status:S.status,receivedDate:S.receivedDate,dueDate:S.dueDate,description:S.description,projectId:S.projectId,status:e.target.value}),children:[(0,d.jsx)("option",{value:"pending",children:"Pendiente"}),(0,d.jsx)("option",{value:"paid",children:"Pagada"}),(0,d.jsx)("option",{value:"overdue",children:"Vencida"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Recepci\xf3n"}),(0,d.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2",value:(null===S||void 0===S?void 0:S.receivedDate)||"",onChange:e=>F({id:S.id,number:S.number,supplier:S.supplier,amount:S.amount,status:S.status,receivedDate:S.receivedDate,dueDate:S.dueDate,description:S.description,projectId:S.projectId,receivedDate:e.target.value})})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Vencimiento"}),(0,d.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2",value:(null===S||void 0===S?void 0:S.dueDate)||"",onChange:e=>F({id:S.id,number:S.number,supplier:S.supplier,amount:S.amount,status:S.status,receivedDate:S.receivedDate,dueDate:S.dueDate,description:S.description,projectId:S.projectId,dueDate:e.target.value})})]}),(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,d.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===S||void 0===S?void 0:S.description)||"",onChange:e=>F({id:S.id,number:S.number,supplier:S.supplier,amount:S.amount,status:S.status,receivedDate:S.receivedDate,dueDate:S.dueDate,description:S.description,projectId:S.projectId,description:e.target.value}),placeholder:"Descripci\xf3n de la factura"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,d.jsx)("button",{onClick:()=>A(!1),className:"px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,d.jsx)("button",{onClick:()=>{const e=Array.isArray(v)?v:[];if(S.id){const t=e.map(e=>e.id===S.id?S:e);g(t)}else{const t={id:Date.now().toString(),number:S.number,supplier:S.supplier,amount:S.amount,dueDate:S.dueDate,description:S.description,projectId:S.projectId},s=[...e,t];g(s),$&&n&&$("invoice",t,n)}A(!1),F(null)},className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:"Guardar"})]})]})})})]})}}}]);
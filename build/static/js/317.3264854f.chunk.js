"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[317,449],{317:(e,s,t)=>{t.r(s),t.d(s,{default:()=>G});var a=t(9950),r=t(9379),l=t(2331),n=t(4634),i=t(1403),c=t(4321),o=t(3286),d=t(8103),m=t(4414);const x=e=>{let{error:s}=e;return s?(0,m.jsx)("p",{className:"text-red-500 text-xs mt-1",children:s}):null},u=e=>{var s,t;let{projects:u,currentProjectId:g,setCurrentProjectId:h,portfolioMetrics:p,workPackages:b,risks:j,globalResources:v,setGlobalResources:y,tasksByProject:f,createProject:N,updateProject:w,deleteProject:k,duplicateProject:P,archiveProject:C,includeWeekendsByProject:D,setIncludeWeekendsByProject:A,getCurrentProjectIncludeWeekends:S,triggerNewProject:I=!1,onNewProjectTriggered:T}=e;const[R,E]=(0,a.useState)(!1),[O,M]=(0,a.useState)(null),[F,z]=(0,a.useState)(!1),[B,L]=(0,a.useState)(null),[_,W]=(0,a.useState)({}),[V,U]=(0,a.useState)(null),[q,G]=(0,a.useState)(!1),[$,H]=(0,a.useState)(null),K=e=>{L("function"===typeof e?e:s=>null===e?null:s?(0,r.A)((0,r.A)({},s),e):e)},{permissions:J,isReadOnly:Y,isLoading:X}=(0,c.A)(),Q=e=>{switch(e){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},Z=e=>{switch(e){case"active":return"bg-blue-100 text-blue-800 border-blue-200";case"completed":return"bg-green-100 text-green-800 border-green-200";case"on-hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},ee=e=>{switch(e){case"active":return"\ud83d\udd04";case"completed":return"\u2705";case"on-hold":default:return"\u23f8\ufe0f";case"cancelled":return"\u274c"}},se=(e,s)=>{K(t=>(0,r.A)((0,r.A)({},t),{},{[e]:s}))},te=(e,s)=>{const t=Object.assign({},_);switch(e){case"name":!s||s.trim().length<3?t.name="El nombre debe tener al menos 3 caracteres":delete t.name;break;case"manager":!s||s.trim().length<2?t.manager="El manager debe tener al menos 2 caracteres":delete t.manager;break;case"sponsor":!s||s.trim().length<2?t.sponsor="El sponsor debe tener al menos 2 caracteres":delete t.sponsor;break;case"startDate":s?delete t.startDate:t.startDate="La fecha de inicio es requerida";break;case"endDate":s?null!==B&&void 0!==B&&B.startDate&&s<=B.startDate?t.endDate="La fecha de fin debe ser posterior a la fecha de inicio":delete t.endDate:t.endDate="La fecha de fin es requerida";break;case"budget":!s||s<=0?t.budget="El presupuesto debe ser mayor a 0":delete t.budget;break;case"irr":s&&(s<0||s>100)?t.irr="La TIR debe estar entre 0% y 100%":delete t.irr}return W(t),0===Object.keys(t).length},ae=()=>{K({id:"",name:"",description:"",status:"inactive",priority:"medium",startDate:(new Date).toISOString().split("T")[0],endDate:new Date(Date.now()+7776e6).toISOString().split("T")[0],budget:1e5,contingencyReserve:1e4,managementReserve:5e3,manager:"",sponsor:"",objective:"",businessCase:"",irr:0,roi:0,kickoffDate:"",stakeholders:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),version:"1.0.0"}),W({}),z(!0)};a.useEffect(()=>{I&&(ae(),T&&T())},[I,T]),(0,a.useEffect)(()=>{const e=()=>{try{const e=d.default.getCurrentOrganization();e?(U(e),console.log("\u2705 PortfolioDashboard - Organization ID cargado:",e)):console.warn("\u26a0\ufe0f PortfolioDashboard - No se encontr\xf3 organization ID")}catch(e){console.error("\u274c Error obteniendo organizationId:",e)}};e();const s=setTimeout(()=>{V||(console.log("\ud83d\udd04 PortfolioDashboard - Reintentando obtener organization ID..."),e())},1e3);return()=>clearTimeout(s)},[]);const re=(0,a.useMemo)(()=>{if(!u||0===u.length)return{totalProjects:0,activeProjects:0,completedProjects:0,totalBudget:0,averageProgress:0,totalWorkPackages:0,totalRisks:0,activeRisks:0};const e=u.length,s=u.filter(e=>"active"===e.status).length,t=u.filter(e=>"completed"===e.status).length,a=u.filter(e=>"active"===e.status),r=a.reduce((e,s)=>e+(s.budget||0),0),l=a.length>0?a.reduce((e,s)=>e+(s.progress||0),0)/a.length:0,n=b?b.length:0,i=j?j.length:0,c=j?j.filter(e=>"active"===e.status).length:0;return{totalProjects:e,activeProjects:s,completedProjects:t,totalBudget:r,averageProgress:Math.round(l),totalWorkPackages:n,totalRisks:i,activeRisks:c}},[u,b,j]),le=p||re;return(0,m.jsxs)("div",{className:"space-y-6 max-w-full overflow-hidden",children:[(0,m.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("div",{className:"text-blue-600 text-xl mr-3",children:"\u2139\ufe0f"}),(0,m.jsxs)("div",{className:"text-blue-800",children:[(0,m.jsx)("strong",{children:"Nota:"}),' Las m\xe9tricas financieras y KPIs solo consideran proyectos con estado "Activo". Los proyectos "Inactivos" o "Completados" no influyen en los indicadores financieros.']})]})}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,m.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-blue-500",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Total Proyectos"}),(0,m.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:le.totalProjects})]}),(0,m.jsx)("div",{className:"text-blue-500 text-2xl",children:"\ud83d\udcca"})]})}),(0,m.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-green-500",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Proyectos Activos"}),(0,m.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:le.activeProjects})]}),(0,m.jsx)("div",{className:"text-green-500 text-2xl",children:"\ud83d\udd04"})]})}),(0,m.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-purple-500",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Completados"}),(0,m.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:le.completedProjects})]}),(0,m.jsx)("div",{className:"text-purple-500 text-2xl",children:"\u2705"})]})}),(0,m.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-indigo-500",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Presupuesto Proyectos Activos"}),(0,m.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",(le.totalBudget/1e3).toFixed(0),"K"]})]}),(0,m.jsx)("div",{className:"text-indigo-500 text-2xl",children:"\ud83d\udcb0"})]})})]}),(0,m.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:(0,m.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,m.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"Acciones del Portfolio"}),(0,m.jsxs)("div",{className:"flex space-x-2",children:[J.canEdit&&(0,m.jsxs)("button",{onClick:ae,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center space-x-2",children:[(0,m.jsx)("span",{children:"\u2795"}),(0,m.jsx)("span",{children:"Nuevo Proyecto"})]}),Y()&&(0,m.jsxs)("div",{className:"text-sm text-gray-500 italic bg-gray-50 px-3 py-2 rounded-lg border",children:[(0,m.jsx)("span",{children:"\ud83d\udc40"})," Modo solo lectura"]})]})]})}),(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[(0,m.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Proyectos del Portfolio"}),0===u.length?(0,m.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,m.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udcc1"}),(0,m.jsx)("div",{children:"No hay proyectos en el portfolio"}),(0,m.jsx)("button",{onClick:ae,className:"mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Crear Primer Proyecto"})]}):(0,m.jsx)("div",{className:"space-y-3",children:u.map(e=>(0,m.jsx)("div",{className:"border rounded-lg p-4 transition-all duration-200 cursor-pointer hover:shadow-md ".concat(g===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>h(e.id),children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,m.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,m.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(Q(e.priority)),children:e.priority}),(0,m.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(Z(e.status)),children:[ee(e.status)," ",e.status]})]}),(0,m.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,m.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,m.jsxs)("span",{children:["\ud83d\udcc5 ",e.startDate," - ",e.endDate]}),(0,m.jsxs)("span",{children:["\ud83d\udcb0 $",(e.budget/1e3).toFixed(0),"K"]}),(0,m.jsxs)("span",{children:["\ud83d\udc64 ",e.manager]})]})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("button",{onClick:s=>{s.stopPropagation(),M(e),E(!0)},className:"p-2 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors",title:"Ver archivos del proyecto",children:"\ud83d\udcce"}),(0,m.jsx)("button",{onClick:s=>{s.stopPropagation(),P(e.id)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded",title:"Duplicar proyecto",children:"\ud83d\udccb"}),(0,m.jsx)("button",{onClick:s=>{s.stopPropagation(),(e=>{console.log("\ud83d\udd0d Proyecto original para editar:",e),console.log("\ud83d\udd0d Estado del proyecto original:",e.status);const s=(0,r.A)((0,r.A)({},e),{},{description:e.description||"",objective:e.objective||"",businessCase:e.businessCase||"",kickoffDate:e.kickoffDate||"",stakeholders:e.stakeholders||[]});console.log("\ud83d\udd0d Proyecto preparado para editar:",s),console.log("\ud83d\udd0d Estado del proyecto preparado:",s.status),K(s),W({}),z(!0)})(e)},className:"p-2 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded",title:"Editar proyecto",children:"\u270f\ufe0f"}),(0,m.jsx)("button",{onClick:s=>{s.stopPropagation(),window.confirm('\xbfArchivar proyecto "'.concat(e.name,'"? Se mover\xe1 al archivo y se limpiar\xe1n sus datos del sistema activo.'))&&C(e.id)},className:"p-2 text-gray-400 hover:text-orange-600 hover:bg-orange-50 rounded",title:"Archivar proyecto",children:"\ud83d\udcc1"}),(0,m.jsx)("button",{onClick:s=>{s.stopPropagation(),window.confirm('\xbfEliminar proyecto "'.concat(e.name,'"? Esta acci\xf3n no se puede deshacer.'))&&k(e.id)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded",title:"Eliminar proyecto",children:"\ud83d\uddd1\ufe0f"})]})]})},e.id))})]}),g&&(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[(0,m.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"M\xe9tricas del Proyecto Actual"}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,m.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:(null===p||void 0===p||null===(s=p.currentProjectCPI)||void 0===s?void 0:s.toFixed(2))||"N/A"}),(0,m.jsx)("div",{className:"text-xs text-gray-600",children:"CPI"})]}),(0,m.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:(null===p||void 0===p||null===(t=p.currentProjectSPI)||void 0===t?void 0:t.toFixed(2))||"N/A"}),(0,m.jsx)("div",{className:"text-xs text-gray-600",children:"SPI"})]}),(0,m.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,m.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",((null===p||void 0===p?void 0:p.currentProjectCV)/1e3).toFixed(0),"K"]}),(0,m.jsx)("div",{className:"text-xs text-gray-600",children:"CV"})]}),(0,m.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,m.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",((null===p||void 0===p?void 0:p.currentProjectSV)/1e3).toFixed(0),"K"]}),(0,m.jsx)("div",{className:"text-xs text-gray-600",children:"SV"})]})]})]}),(0,m.jsx)(n.A,{projects:u,portfolioMetrics:p}),(0,m.jsx)(l.A,{projects:u,portfolioMetrics:p,workPackages:b,risks:j,tasksByProject:f,includeWeekendsByProject:D,setIncludeWeekendsByProject:A,getCurrentProjectIncludeWeekends:S}),R&&O&&(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,m.jsx)("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl text-white",children:(0,m.jsx)("span",{className:"text-2xl",children:"\ud83d\udcce"})}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("h3",{className:"text-xl font-bold text-gray-800",children:["Archivos del Proyecto: ",O.name]}),(0,m.jsx)("p",{className:"text-sm text-gray-600",children:"Gesti\xf3n completa de documentos y archivos adjuntos"})]})]}),(0,m.jsx)("button",{onClick:()=>{E(!1),M(null)},className:"px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-200 shadow-sm hover:shadow-md",children:"\u2715 Cerrar"})]}),(0,m.jsx)(i.default,{projectId:O.id,category:"general",isContextual:!0,title:"\ud83d\udcce Archivos de ".concat(O.name),onFileUploaded:()=>{}})]}),F&&(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center p-4",children:(0,m.jsx)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:(0,m.jsxs)("div",{className:"p-6",children:[(0,m.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,m.jsx)("h2",{className:"text-xl font-bold",children:null!==B&&void 0!==B&&B.id?"Editar Proyecto":"Nuevo Proyecto"}),(0,m.jsx)("button",{onClick:()=>{z(!1),K(null)},className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Proyecto *"}),(0,m.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(_.name?"border-red-500":"border-red-300"),value:(null===B||void 0===B?void 0:B.name)||"",onChange:e=>{se("name",e.target.value),te("name",e.target.value)},onBlur:e=>te("name",e.target.value),placeholder:"Nombre del proyecto"}),(0,m.jsx)(x,{error:_.name})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Manager *"}),(0,m.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(_.manager?"border-red-500":"border-gray-300"),value:(null===B||void 0===B?void 0:B.manager)||"",onChange:e=>{se("manager",e.target.value),te("manager",e.target.value)},onBlur:e=>te("manager",e.target.value),placeholder:"Gerente del proyecto"}),(0,m.jsx)(x,{error:_.manager})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sponsor *"}),(0,m.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(_.sponsor?"border-red-500":"border-gray-300"),value:(null===B||void 0===B?void 0:B.sponsor)||"",onChange:e=>{se("sponsor",e.target.value),te("sponsor",e.target.value)},onBlur:e=>te("sponsor",e.target.value),placeholder:"Patrocinador del proyecto"}),(0,m.jsx)(x,{error:_.sponsor})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prioridad"}),(0,m.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:(null===B||void 0===B?void 0:B.priority)||"medium",onChange:e=>se("priority",e.target.value),children:[(0,m.jsx)("option",{value:"low",children:"Baja"}),(0,m.jsx)("option",{value:"medium",children:"Media"}),(0,m.jsx)("option",{value:"high",children:"Alta"})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado del Proyecto *"}),(0,m.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:(null===B||void 0===B?void 0:B.status)||"inactive",onChange:e=>se("status",e.target.value),children:[(0,m.jsx)("option",{value:"inactive",children:"\u26ab Inactivo"}),(0,m.jsx)("option",{value:"active",children:"\ud83d\udfe2 Activo"})]}),(0,m.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[(0,m.jsx)("strong",{children:"Por defecto:"}),' Los proyectos nuevos y duplicados aparecen como "Inactivos" para revisi\xf3n. Solo los proyectos "Activos" suman al dashboard consolidado y aparecen en Gesti\xf3n de Proyectos.']})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Inicio *"}),(0,m.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2 ".concat(_.startDate?"border-red-500":"border-gray-300"),value:(null===B||void 0===B?void 0:B.startDate)||"",onChange:e=>{se("startDate",e.target.value),te("startDate",e.target.value),null!==B&&void 0!==B&&B.endDate&&te("endDate",B.endDate)},onBlur:e=>te("startDate",e.target.value)}),(0,m.jsx)(x,{error:_.startDate})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Fin *"}),(0,m.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(_.endDate?"border-red-500":"border-gray-300"),value:(null===B||void 0===B?void 0:B.endDate)||"",onChange:e=>{se("endDate",e.target.value),te("endDate",e.target.value)},onBlur:e=>te("endDate",e.target.value),placeholder:"YYYY-MM-DD"}),(0,m.jsx)(x,{error:_.endDate})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Presupuesto (USD) *"}),(0,m.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 ".concat(_.budget?"border-red-500":"border-gray-300"),value:(null===B||void 0===B?void 0:B.budget)||"",onChange:e=>{const s=e.target.value;if(""===s||/^\d+$/.test(s)){const e=""===s?"":Number(s);se("budget",e),te("budget",e)}},onBlur:e=>{const s=""===e.target.value?"":Number(e.target.value);te("budget",s)},placeholder:"Presupuesto en USD (ej: 100000)",min:"0"}),(0,m.jsx)(x,{error:_.budget})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"TIR (%)"}),(0,m.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 ".concat(_.irr?"border-red-500":"border-gray-300"),value:(null===B||void 0===B?void 0:B.irr)||"",onChange:e=>{const s=e.target.value;if(""===s||/^\d*\.?\d*$/.test(s)){const e=""===s?"":Number(s),t=(null===B||void 0===B?void 0:B.period)||3,a=((null===B||void 0===B?void 0:B.budget)||0)*Math.pow(1+e/100,t);se("irr",e),se("plannedValue",Math.round(a)),te("irr",e)}},onBlur:e=>{const s=""===e.target.value?"":Number(e.target.value);te("irr",s)},placeholder:"Tasa Interna de Retorno (ej: 15.5)",min:"0",max:"100",step:"0.01"}),(0,m.jsx)(x,{error:_.irr})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Periodo del Proyecto (a\xf1os)"}),(0,m.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 border-gray-300",value:(null===B||void 0===B?void 0:B.period)||3,onChange:e=>{const s=parseInt(e.target.value)||3,t=(null===B||void 0===B?void 0:B.budget)||0,a=(null===B||void 0===B?void 0:B.irr)||0,r=t*Math.pow(1+a/100,s);se("period",s),se("plannedValue",Math.round(r))},placeholder:"Ej: 3",min:"1",max:"20"}),(0,m.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Duraci\xf3n estimada del proyecto para c\xe1lculo de valor con TIR"})]}),(0,m.jsxs)("div",{className:"md:col-span-2 bg-blue-50 p-4 rounded-lg border-2 border-blue-200",children:[(0,m.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center",children:["\ud83d\udcb0 Valor Planificado del Proyecto (USD)",(0,m.jsx)("span",{className:"ml-2 text-blue-600 text-xs font-semibold",children:"(Auto-calculado con TIR)"})]}),(0,m.jsxs)("div",{className:"relative",children:[(0,m.jsx)("input",{type:"number",className:"w-full border-2 rounded px-3 py-2 border-blue-300 bg-white text-lg font-semibold",value:(null===B||void 0===B?void 0:B.plannedValue)||0,onChange:e=>{se("plannedValue",parseFloat(e.target.value)||0)},placeholder:"Calculado autom\xe1ticamente",min:"0",step:"10000"}),(0,m.jsx)("button",{type:"button",onClick:()=>{const e=(null===B||void 0===B?void 0:B.budget)||0,s=(null===B||void 0===B?void 0:B.irr)||0,t=(null===B||void 0===B?void 0:B.period)||3,a=e*Math.pow(1+s/100,t);se("plannedValue",Math.round(a))},className:"absolute right-2 top-2 text-xs bg-blue-500 text-white px-3 py-1.5 rounded hover:bg-blue-600 font-medium",title:"Recalcular autom\xe1ticamente",children:"\ud83d\udd04 Recalcular"})]}),(0,m.jsxs)("p",{className:"text-xs text-blue-700 mt-2 font-medium",children:["F\xf3rmula: $",((null===B||void 0===B?void 0:B.budget)||0).toLocaleString()," \xd7 (1 + ",(null===B||void 0===B?void 0:B.irr)||0,"%)^",(null===B||void 0===B?void 0:B.period)||3," = ",(0,m.jsxs)("span",{className:"text-green-600 font-bold",children:["$",((null===B||void 0===B?void 0:B.plannedValue)||0).toLocaleString()]})]}),(0,m.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Este valor se distribuir\xe1 autom\xe1ticamente entre todas las tareas del cronograma seg\xfan su costo y prioridad."})]}),(0,m.jsxs)("div",{className:"md:col-span-2",children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,m.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===B||void 0===B?void 0:B.description)||"",onChange:e=>se("description",e.target.value),placeholder:"Descripci\xf3n detallada del proyecto"})]}),(0,m.jsxs)("div",{className:"md:col-span-2",children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Objetivo del Proyecto"}),(0,m.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===B||void 0===B?void 0:B.objective)||"",onChange:e=>se("objective",e.target.value),placeholder:"\xbfQu\xe9 se busca lograr con este proyecto?"})]}),(0,m.jsxs)("div",{className:"md:col-span-2",children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Caso de Negocio"}),(0,m.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===B||void 0===B?void 0:B.businessCase)||"",onChange:e=>se("businessCase",e.target.value),placeholder:"Justificaci\xf3n del proyecto desde el punto de vista del negocio"})]})]}),(0,m.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,m.jsx)("button",{onClick:()=>{z(!1),K(null)},className:"px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,m.jsxs)("button",{onClick:async()=>{W({});const e={};if((!B.name||B.name.trim().length<3)&&(e.name="El nombre debe tener al menos 3 caracteres"),(!B.manager||B.manager.trim().length<2)&&(e.manager="El manager debe tener al menos 2 caracteres"),(!B.sponsor||B.sponsor.trim().length<2)&&(e.sponsor="El sponsor debe tener al menos 2 caracteres"),B.startDate||(e.startDate="La fecha de inicio es requerida"),B.endDate?B.startDate&&B.endDate<=B.startDate&&(e.endDate="La fecha de fin debe ser posterior a la fecha de inicio"):e.endDate="La fecha de fin es requerida",(!B.budget||B.budget<=0)&&(e.budget="El presupuesto debe ser mayor a 0"),B.irr&&(B.irr<0||B.irr>100)&&(e.irr="La TIR debe estar entre 0% y 100%"),Object.keys(e).length>0)return W(e),void alert("\u274c No se puede guardar el proyecto. Hay ".concat(Object.keys(e).length," errores de validaci\xf3n."));if(!B.id&&V){console.log("\ud83d\udd0d Validando l\xedmites de suscripci\xf3n para organizationId:",V);try{const e=await o.A.canCreateProject(V);if(console.log("\ud83d\udcca Resultado de validaci\xf3n:",e),!e.allowed)return console.warn("\u26d4 L\xedmite alcanzado - Mostrando modal de upgrade"),H(e),void G(!0);console.log("\u2705 Validaci\xf3n pasada - Puede crear proyecto")}catch(s){console.error("\u274c Error verificando l\xedmites de suscripci\xf3n:",s)}}else console.warn("\u26a0\ufe0f No se valid\xf3 suscripci\xf3n - editingProject.id:",B.id,"organizationId:",V);try{B.id?(w(B.id,B),alert("\u2705 Proyecto actualizado exitosamente")):(N(B),alert("\u2705 Proyecto creado exitosamente")),z(!1),K(null),W({})}catch(s){alert("\u274c Error al guardar el proyecto: ".concat(s.message))}},disabled:Object.keys(_).length>0,className:"px-4 py-2 rounded transition-colors ".concat(Object.keys(_).length>0?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:["Guardar Proyecto ",Object.keys(_).length>0&&"(".concat(Object.keys(_).length," errores)")]})]})]})})}),q&&$&&(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[10000] flex items-center justify-center p-4",children:(0,m.jsx)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:(0,m.jsxs)("div",{className:"p-6",children:[(0,m.jsx)("div",{className:"flex items-center justify-center mb-4",children:(0,m.jsx)("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center",children:(0,m.jsx)("span",{className:"text-4xl",children:"\u26a0\ufe0f"})})}),(0,m.jsx)("h2",{className:"text-xl font-bold text-center mb-2",children:"L\xedmite Alcanzado"}),(0,m.jsx)("p",{className:"text-gray-600 text-center mb-4",children:$.message}),(0,m.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[(0,m.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,m.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Proyectos actuales:"}),(0,m.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:[$.currentCount," / ",$.maxCount]})]}),(0,m.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,m.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat($.currentCount/$.maxCount*100,"%")}})})]}),(0,m.jsx)("p",{className:"text-sm text-gray-600 text-center mb-6",children:$.suggestion}),(0,m.jsxs)("div",{className:"flex space-x-3",children:[(0,m.jsx)("button",{onClick:()=>{G(!1),H(null)},className:"flex-1 px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,m.jsx)("button",{onClick:()=>{alert("\ud83d\ude80 Funci\xf3n de upgrade en desarrollo. Aqu\xed se redigir\xeda a la p\xe1gina de planes."),G(!1),H(null)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Ver Planes"})]})]})})})]})},g=e=>{let{globalResources:s,setGlobalResources:t}=e;const[r,l]=(0,a.useState)(!1),[n,i]=(0,a.useState)(!1),[c,o]=(0,a.useState)(null),[d,x]=(0,a.useState)(""),[u,g]=(0,a.useState)("all"),[h,p]=(0,a.useState)("all"),[b,j]=(0,a.useState)({name:"",role:"",skills:"",availability:100,hourlyRate:0,status:"active",email:"",phone:"",department:"",experience:"",certifications:"",notes:""}),v=(0,a.useMemo)(()=>s.filter(e=>{const s=!d||e.name.toLowerCase().includes(d.toLowerCase())||e.role.toLowerCase().includes(d.toLowerCase())||e.email&&e.email.toLowerCase().includes(d.toLowerCase()),t="all"===u||e.role===u,a="all"===h||e.status===h;return s&&t&&a}),[s,d,u,h]),y=(0,a.useMemo)(()=>{const e=s.map(e=>e.role);return Array.from(new Set(e))},[s]),f=(0,a.useMemo)(()=>({totalResources:s.length,activeResources:s.filter(e=>"active"===e.status).length,inactiveResources:s.filter(e=>"inactive"===e.status).length,onLeaveResources:s.filter(e=>"on-leave"===e.status).length,totalCost:s.reduce((e,s)=>e+160*s.availability*s.hourlyRate,0)}),[s]),N=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"on-leave":return"bg-yellow-100 text-yellow-800";case"terminated":return"bg-red-100 text-red-800"}},w=e=>{switch(e){case"active":return"\u2705";case"inactive":default:return"\u23f8\ufe0f";case"on-leave":return"\ud83c\udfd6\ufe0f";case"terminated":return"\u274c"}};return(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{className:"flex items-center mb-6",children:[(0,m.jsx)("div",{className:"bg-blue-100 rounded-2xl p-3 mr-4 shadow-sm",children:(0,m.jsx)("span",{className:"text-3xl",children:"\ud83d\udc65"})}),(0,m.jsx)("div",{children:(0,m.jsx)("p",{className:"text-gray-600 text-lg",children:"Gesti\xf3n global de recursos humanos del portafolio"})})]}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,m.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-blue-200 hover:shadow-md transition-all duration-300",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,m.jsx)("span",{className:"text-lg",children:"\ud83d\udc65"}),(0,m.jsx)("span",{className:"text-sm font-medium text-blue-600",children:"Total Recursos"})]}),(0,m.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:f.totalResources})]}),(0,m.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-green-200 hover:shadow-md transition-all duration-300",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,m.jsx)("span",{className:"text-lg",children:"\u2705"}),(0,m.jsx)("span",{className:"text-sm font-medium text-green-600",children:"Activos"})]}),(0,m.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:f.activeResources})]}),(0,m.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-gray-200 hover:shadow-md transition-all duration-300",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,m.jsx)("span",{className:"text-lg",children:"\u23f8\ufe0f"}),(0,m.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Inactivos"})]}),(0,m.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:f.inactiveResources})]}),(0,m.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-yellow-200 hover:shadow-md transition-all duration-300",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,m.jsx)("span",{className:"text-lg",children:"\ud83c\udfd6\ufe0f"}),(0,m.jsx)("span",{className:"text-sm font-medium text-yellow-600",children:"En Licencia"})]}),(0,m.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:f.onLeaveResources})]}),(0,m.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-purple-200 hover:shadow-md transition-all duration-300",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,m.jsx)("span",{className:"text-lg",children:"\ud83d\udcb0"}),(0,m.jsx)("span",{className:"text-sm font-medium text-purple-600",children:"Costo Mensual"})]}),(0,m.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",(f.totalCost/1e3).toFixed(0),"K"]})]})]}),(0,m.jsx)("div",{className:"bg-white rounded-xl p-4 border border-blue-200",children:(0,m.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[(0,m.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,m.jsx)("input",{type:"text",placeholder:"Buscar recursos...",value:d,onChange:e=>x(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,m.jsxs)("select",{value:u,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,m.jsx)("option",{value:"all",children:"Todos los roles"}),y.map(e=>(0,m.jsx)("option",{value:e,children:e},e))]}),(0,m.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,m.jsx)("option",{value:"all",children:"Todos los estados"}),(0,m.jsx)("option",{value:"active",children:"Activo"}),(0,m.jsx)("option",{value:"inactive",children:"Inactivo"}),(0,m.jsx)("option",{value:"on-leave",children:"En licencia"}),(0,m.jsx)("option",{value:"terminated",children:"Terminado"})]})]}),(0,m.jsx)("div",{className:"flex space-x-2",children:(0,m.jsxs)("button",{onClick:()=>l(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,m.jsx)("span",{children:"\u2795"}),(0,m.jsx)("span",{children:"Agregar Recurso"})]})})]})}),(0,m.jsx)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200",children:(0,m.jsx)("div",{className:"overflow-x-auto",children:(0,m.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,m.jsx)("thead",{className:"bg-gray-50",children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Recurso"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rol"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Disponibilidad"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Costo/Hora"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),(0,m.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===v.length?(0,m.jsx)("tr",{children:(0,m.jsx)("td",{colSpan:"6",className:"px-6 py-12 text-center text-gray-500",children:(0,m.jsxs)("div",{className:"flex flex-col items-center",children:[(0,m.jsx)("span",{className:"text-4xl mb-2",children:"\ud83d\udc65"}),(0,m.jsx)("p",{className:"text-lg font-medium",children:"No hay recursos registrados"}),(0,m.jsx)("p",{className:"text-sm",children:"Agrega tu primer recurso para comenzar"})]})})}):v.map(e=>(0,m.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,m.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,m.jsx)("span",{className:"text-sm font-medium text-blue-700",children:e.name.split(" ").map(e=>e[0]).join("")})})}),(0,m.jsxs)("div",{className:"ml-4",children:[(0,m.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,m.jsx)("div",{className:"text-sm text-gray-500",children:e.email||"Sin email"})]})]})}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,m.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:e.role})}),(0,m.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.availability,"%"]}),(0,m.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",e.hourlyRate,"/h"]}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,m.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(N(e.status)),children:[w(e.status)," ","active"===e.status?"Activo":"inactive"===e.status?"Inactivo":"on-leave"===e.status?"Licencia":"Terminado"]})}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,m.jsxs)("div",{className:"flex space-x-2",children:[(0,m.jsx)("button",{onClick:()=>(e=>{o(Object.assign({},e,{skills:Array.isArray(e.skills)?e.skills.join(", "):e.skills,certifications:Array.isArray(e.certifications)?e.certifications.join(", "):e.certifications})),i(!0)})(e),className:"text-blue-600 hover:text-blue-900",title:"Editar recurso",children:"\u270f\ufe0f"}),(0,m.jsx)("button",{onClick:()=>{return s=e.id,void(window.confirm("\xbfEst\xe1s seguro de que quieres eliminar este recurso?")&&t(e=>e.filter(e=>e.id!==s)));var s},className:"text-red-600 hover:text-red-900",title:"Eliminar recurso",children:"\ud83d\uddd1\ufe0f"})]})})]},e.id))})]})})}),r&&(0,m.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,m.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,m.jsxs)("div",{className:"mt-3",children:[(0,m.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Agregar Nuevo Recurso"}),(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nombre *"}),(0,m.jsx)("input",{type:"text",value:b.name,onChange:e=>j({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,name:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nombre completo"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Rol *"}),(0,m.jsx)("input",{type:"text",value:b.role,onChange:e=>j({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,role:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Project Manager, Desarrollador, etc."})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,m.jsx)("input",{type:"email",value:b.email,onChange:e=>j({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,email:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"email@empresa.com"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Habilidades (separadas por comas)"}),(0,m.jsx)("input",{type:"text",value:b.skills,onChange:e=>j({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,skills:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"React, JavaScript, PMBOK, etc."})]}),(0,m.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Disponibilidad (%)"}),(0,m.jsx)("input",{type:"number",min:"0",max:"100",value:b.availability,onChange:e=>j({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,availability:Number(e.target.value)}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Costo por Hora ($)"}),(0,m.jsx)("input",{type:"number",min:"0",value:b.hourlyRate,onChange:e=>j({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,hourlyRate:Number(e.target.value)}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),(0,m.jsxs)("select",{value:b.status,onChange:e=>j({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,status:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,m.jsx)("option",{value:"active",children:"Activo"}),(0,m.jsx)("option",{value:"inactive",children:"Inactivo"}),(0,m.jsx)("option",{value:"on-leave",children:"En licencia"}),(0,m.jsx)("option",{value:"terminated",children:"Terminado"})]})]})]}),(0,m.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,m.jsx)("button",{onClick:()=>l(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors",children:"Cancelar"}),(0,m.jsx)("button",{onClick:()=>{if(!b.name||!b.role)return;const e={id:"res-"+String(Date.now()).slice(-6),name:b.name,role:b.role,skills:b.skills.split(",").map(e=>e.trim()).filter(e=>e),experience:b.experience,certifications:b.certifications?b.certifications.split(",").map(e=>e.trim()).filter(e=>e):[],notes:b.notes};console.log("\u2795 Agregando nuevo recurso:",e),console.log("\u2795 Recursos actuales antes de agregar:",s),t(s=>{const t=s.slice();return t.push(e),console.log("\u2795 Nuevos recursos despu\xe9s de agregar:",t),t}),l(!1),j({name:"",role:"",skills:"",availability:100,hourlyRate:0,status:"active",email:"",phone:"",department:"",experience:"",certifications:"",notes:""})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Agregar"})]})]})})}),n&&c&&(0,m.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,m.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,m.jsxs)("div",{className:"mt-3",children:[(0,m.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Editar Recurso"}),(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nombre *"}),(0,m.jsx)("input",{type:"text",value:c.name,onChange:e=>o({id:c.id,name:c.name,role:c.role,email:c.email,skills:c.skills,availability:c.availability,hourlyRate:c.hourlyRate,status:c.status,projectId:c.projectId,name:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Rol *"}),(0,m.jsx)("input",{type:"text",value:c.role,onChange:e=>o({id:c.id,name:c.name,role:c.role,email:c.email,skills:c.skills,availability:c.availability,hourlyRate:c.hourlyRate,status:c.status,projectId:c.projectId,role:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,m.jsx)("input",{type:"email",value:c.email,onChange:e=>o({id:c.id,name:c.name,role:c.role,email:c.email,skills:c.skills,availability:c.availability,hourlyRate:c.hourlyRate,status:c.status,projectId:c.projectId,email:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Habilidades (separadas por comas)"}),(0,m.jsx)("input",{type:"text",value:c.skills,onChange:e=>o({id:c.id,name:c.name,role:c.role,email:c.email,skills:c.skills,availability:c.availability,hourlyRate:c.hourlyRate,status:c.status,projectId:c.projectId,skills:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,m.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Disponibilidad (%)"}),(0,m.jsx)("input",{type:"number",min:"0",max:"100",value:c.availability,onChange:e=>o({id:c.id,name:c.name,role:c.role,email:c.email,skills:c.skills,availability:c.availability,hourlyRate:c.hourlyRate,status:c.status,projectId:c.projectId,availability:Number(e.target.value)}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Costo por Hora ($)"}),(0,m.jsx)("input",{type:"number",min:"0",value:c.hourlyRate,onChange:e=>o({id:c.id,name:c.name,role:c.role,email:c.email,skills:c.skills,availability:c.availability,hourlyRate:c.hourlyRate,status:c.status,projectId:c.projectId,hourlyRate:Number(e.target.value)}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),(0,m.jsxs)("select",{value:c.status,onChange:e=>o({id:c.id,name:c.name,role:c.role,email:c.email,skills:c.skills,availability:c.availability,hourlyRate:c.hourlyRate,status:c.status,projectId:c.projectId,status:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,m.jsx)("option",{value:"active",children:"Activo"}),(0,m.jsx)("option",{value:"inactive",children:"Inactivo"}),(0,m.jsx)("option",{value:"on-leave",children:"En licencia"}),(0,m.jsx)("option",{value:"terminated",children:"Terminado"})]})]})]}),(0,m.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,m.jsx)("button",{onClick:()=>{i(!1),o(null)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors",children:"Cancelar"}),(0,m.jsx)("button",{onClick:()=>{c&&(t(e=>e.map(e=>e.id===c.id?Object.assign({},e,{name:c.name,role:c.role,skills:c.skills.split(",").map(e=>e.trim()).filter(e=>e),availability:c.availability,hourlyRate:c.hourlyRate,status:c.status,email:c.email||e.email,phone:c.phone||e.phone,department:c.department||e.department,experience:c.experience||e.experience,certifications:c.certifications?c.certifications.split(",").map(e=>e.trim()).filter(e=>e):e.certifications,notes:c.notes||e.notes}):e)),i(!1),o(null))},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Guardar Cambios"})]})]})})})]})};t(8449);var h=t(9201),p=t(7255),b=t(6890),j=t(5833),v=t(7737),y=t(2828),f=t(7637),N=t(5612);const w=function(){false},k=e=>{if(!(e=>{if(!e)return!1;const s=new Date(e);return!isNaN(s.getTime())&&s.getFullYear()>1900})(e))return null;const s=new Date(e);return s.setHours(0,0,0,0),s},P=e=>{const s=new Date(e),t=s.getDay(),a=s.getDate()-t+(0===t?-6:1);return s.setDate(a),s.setHours(0,0,0,0),s},C=e=>{const s=new Date(e),t=s.getDay(),a=s.getDate()-t+(0===t?-6:1)+6;return s.setDate(a),s.setHours(0,0,0,0),s},D=e=>e?new Date(e).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A",A=function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){const s=(e.estatus||"").toLowerCase().trim();return"completado"===s||"completada"===s}return 100===e.progress},S=function(e){return!A(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1])},I=a.memo(e=>{let{project:s,currentTasks:t,overdueTasks:l}=e;const n=(0,a.useMemo)(()=>[...l.scheduleTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Cronograma",isOverdue:!0})),...l.minuteTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Minuta",name:e.tarea,description:e.responsable,endDate:e.fecha,isOverdue:!0})),...t.scheduleTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Cronograma",isOverdue:!1})),...t.minuteTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Minuta",name:e.tarea,description:e.responsable,endDate:e.fecha,isOverdue:!1}))],[t,l]);if(0===n.length)return(0,m.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,m.jsx)(f.A,{className:"mx-auto h-12 w-12 text-gray-300 mb-4"}),(0,m.jsx)("p",{children:"No hay tareas para este proyecto en el per\xedodo seleccionado."})]});const i=n.filter(e=>e.isOverdue),c=n.filter(e=>!e.isOverdue);return(0,m.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,m.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:(0,m.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,m.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-3"}),s.name,(0,m.jsxs)("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",n.length," tareas)"]})]})}),(0,m.jsxs)("div",{className:"divide-y divide-gray-200",children:[i.length>0&&(0,m.jsxs)("div",{className:"p-6 bg-red-50",children:[(0,m.jsxs)("h5",{className:"text-md font-semibold text-red-800 mb-4 flex items-center",children:[(0,m.jsx)(y.A,{className:"w-4 h-4 mr-2"}),"Tareas Vencidas (",i.length,")"]}),(0,m.jsx)("div",{className:"space-y-3",children:i.map((e,s)=>(0,m.jsx)(T,{task:e,isOverdue:!0},"overdue-".concat(s)))})]}),c.length>0&&(0,m.jsxs)("div",{className:"p-6",children:[(0,m.jsxs)("h5",{className:"text-md font-semibold text-blue-800 mb-4 flex items-center",children:[(0,m.jsx)(v.A,{className:"w-4 h-4 mr-2"}),"Tareas de la Semana (",c.length,")"]}),(0,m.jsx)("div",{className:"space-y-3",children:c.map((e,s)=>(0,m.jsx)(T,{task:e,isOverdue:!1},"current-".concat(s)))})]})]})]})}),T=a.memo(e=>{let{task:s,isOverdue:t}=e;return(0,m.jsx)("div",{className:"bg-white p-4 rounded-lg border ".concat(t?"border-red-200":"border-gray-200 hover:border-blue-300"," transition-colors"),children:(0,m.jsxs)("div",{className:"flex items-start justify-between",children:[(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsx)("h6",{className:"font-medium text-gray-900 mb-1",children:s.name}),s.description&&(0,m.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),(0,m.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,m.jsxs)("span",{className:"flex items-center",children:[(0,m.jsx)(h.A,{className:"w-3 h-3 mr-1"}),"Vence: ",D(s.endDate)]}),(0,m.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("Cronograma"===s.type?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:s.type}),s.priority&&(0,m.jsx)("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs",children:s.priority})]})]}),(0,m.jsx)("span",{className:"px-2 py-1 text-xs rounded-full font-medium ".concat(t?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:t?"Vencida":"Pendiente"})]})})});I.displayName="ProjectTasksList",T.displayName="TaskCard";const R=e=>{let{projects:s,tasksByProject:l,minutasByProject:n,weeklyPlanningData:i,setWeeklyPlanningData:c,useSupabase:o=!1}=e;const[d,x]=(0,a.useState)((null===i||void 0===i?void 0:i.dateRange)||{start:P(new Date),end:C(new Date)}),[u,g]=(0,a.useState)(null),[T,R]=(0,a.useState)(!1),[E,O]=(0,a.useState)({}),[M,F]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=e=>{const{tareaId:s,newStatus:t,projectId:a,timestamp:r}=e.detail;console.log("\ud83d\udd04 WeeklyPlanningTab: Evento minutaStatusChanged recibido:",{tareaId:s,newStatus:t,projectId:a,timestamp:r}),console.log("\ud83d\udd04 WeeklyPlanningTab: Forzando re-render de tareas de minutas...")};return window.addEventListener("minutaStatusChanged",e),()=>{window.removeEventListener("minutaStatusChanged",e)}},[]);const z=(0,a.useMemo)(()=>{const e=s.filter(e=>"active"===e.status);return w("\ud83c\udfe2 PROYECTOS ACTIVOS:",{total:s.length,active:e.length,projects:e.map(e=>({id:e.id,name:e.name}))}),w("\ud83d\udcca ESTRUCTURA DE DATOS:",{tasksByProjectKeys:Object.keys(l||{}),minutasByProjectKeys:Object.keys(E||{}),tasksByProject:l,localMinutaTasks:E}),e},[s,l,E]),B=(0,a.useMemo)(()=>{const e=new Date(d.start);e.setDate(e.getDate()-7);const s=new Date(d.end);return s.setDate(s.getDate()-7),{start:e,end:s}},[d]),L=(0,a.useMemo)(()=>{const e=new Date;return e.setHours(0,0,0,0),e},[]),_=(0,a.useCallback)(function(e,s,t){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e.filter(e=>{const r=k(a?e.fecha:e.endDate||e.startDate);return r?r>=s&&r<=t:(w("\u26a0\ufe0f Fecha inv\xe1lida en tarea:",e.name||e.tarea),!1)})},[]),W=(0,a.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.filter(e=>{const t=k(s?e.fecha:e.endDate||e.startDate);if(!t)return w("\u26a0\ufe0f Fecha inv\xe1lida en tarea vencida:",e.name||e.tarea),!1;const a=S(e,s);return t<L&&a})},[L]),V=(0,a.useCallback)(e=>{const s=l[e]||[],t=E[e]||[];w("\ud83d\udcc5 getCurrentWeekTasks:",{projectId:e,totalScheduleTasks:s.length,totalMinuteTasks:t.length,dateRange:{start:d.start.toISOString().split("T")[0],end:d.end.toISOString().split("T")[0]}}),s.length>0&&w("\ud83d\udccb Tareas de cronograma del proyecto:",s.map(e=>({id:e.id,name:e.name,endDate:e.endDate,progress:e.progress}))),t.length>0&&w("\ud83d\udccb Tareas de minutas del proyecto:",t.map(e=>({id:e.id,tarea:e.tarea,fecha:e.fecha,estatus:e.estatus})));const a=_(s,d.start,d.end).filter(e=>S(e,!1)),r=_(t,d.start,d.end,!0).filter(e=>S(e,!0));return w("\u2705 Tareas de semana actual:",{projectId:e,scheduleTasks:a.length,minuteTasks:r.length,totalFiltered:a.length+r.length}),{scheduleTasks:a,minuteTasks:r}},[l,E,d,_]),U=(0,a.useCallback)(e=>{const s=l[e]||[],t=E[e]||[];w("\ud83d\udd0d getOverdueTasks:",{projectId:e,today:L.toISOString().split("T")[0]});const a=W(s,!1),r=W(t,!0);return w("\u2705 Tareas vencidas:",{projectId:e,scheduleTasks:a.length,minuteTasks:r.length}),{scheduleTasks:a,minuteTasks:r}},[l,E,L,W]),q=(0,a.useCallback)(async()=>{const e={totalTasks:0,completedTasks:0,pendingTasks:0,overdueTasks:0,byProject:{}};for(const s of z){const t=l[s.id]||[],a=E[s.id]||[],r=_(t,B.start,B.end),n=_(a,B.start,B.end,!0),i=[...r,...n],c=i.filter((e,s)=>A(e,s>=r.length)).length,o=i.filter((e,s)=>S(e,s>=r.length)).length,d=i.filter((e,s)=>{const t=s>=r.length;return k(t?e.fecha:e.endDate||e.startDate)<L&&S(e,t)}).length;e.byProject[s.id]={projectName:s.name,total:i.length,completed:c,pending:o,overdue:d},e.totalTasks+=i.length,e.completedTasks+=c,e.pendingTasks+=o,e.overdueTasks+=d}return e},[z,l,E,B,L,_]),G=(0,a.useCallback)(async()=>{R(!0);try{const e=await q();g(e)}catch(e){console.error("Error cargando datos de la semana pasada:",e)}finally{R(!1)}},[q]);(0,a.useEffect)(()=>{G()},[G]),(0,a.useEffect)(()=>{c&&c({dateRange:d,previousWeekData:u})},[d,u,c]),(0,a.useEffect)(()=>{(async()=>{if(s&&0!==s.length){F(!0);try{w("\ud83d\udd0d WeeklyPlanningTab - Iniciando carga independiente de minutas para todos los proyectos activos");const s={};for(const r of z)try{if(o){w("\ud83d\udd0d Cargando minutas desde Supabase para proyecto: ".concat(r.id));const{default:e}=await Promise.resolve().then(t.bind(t,8103)),{success:a,minutas:l}=await e.loadMinutasByProject(r.id);a?(s[r.id]=l||[],w("\u2705 Minutas cargadas desde Supabase para ".concat(r.name,": ").concat((null===l||void 0===l?void 0:l.length)||0))):(w("\u26a0\ufe0f Error cargando minutas desde Supabase para ".concat(r.name)),s[r.id]=[])}else{var e;const t=(null===(e=JSON.parse(localStorage.getItem("portfolioData")||"{}").minutasByProject)||void 0===e?void 0:e[r.id])||[];s[r.id]=t,w("\u2705 Minutas cargadas desde localStorage para ".concat(r.name,": ").concat(t.length))}}catch(a){console.error("\u274c Error cargando minutas para proyecto ".concat(r.name,":"),a),s[r.id]=[]}O(s),w("\u2705 WeeklyPlanningTab - Carga independiente de minutas completada:",{totalProjects:z.length,minutasByProject:Object.keys(s).reduce((e,t)=>(e[t]=s[t].length,e),{})})}catch(a){console.error("\u274c Error general cargando minutas en WeeklyPlanningTab:",a),O({})}finally{F(!1)}}})()},[s,z,o]);const $=()=>u&&0!==u.totalTasks?Math.round(u.completedTasks/u.totalTasks*100):0,H=(0,a.useCallback)(()=>{try{const e=new N.uE,s=e.internal.pageSize.getWidth(),t=e.internal.pageSize.getHeight();let a=20;e.setFontSize(20),e.setFont(void 0,"bold"),e.text("Planificaci\xf3n Semanal",s/2,a,{align:"center"}),a+=10,e.setFontSize(12),e.setFont(void 0,"normal"),e.text("Per\xedodo: ".concat(D(d.start)," - ").concat(D(d.end)),s/2,a,{align:"center"}),a+=20,u&&(e.setFontSize(14),e.setFont(void 0,"bold"),e.text("Resumen Semana Pasada",20,a),a+=10,e.setFontSize(10),e.setFont(void 0,"normal"),e.text("Tareas Completadas: ".concat(u.completedTasks),20,a),a+=5,e.text("Tareas Pendientes: ".concat(u.pendingTasks),20,a),a+=5,e.text("Tareas Vencidas: ".concat(u.overdueTasks),20,a),a+=5,e.text("Cumplimiento: ".concat($(),"%"),20,a),a+=15),e.setFontSize(14),e.setFont(void 0,"bold"),e.text("Tareas de la Semana Actual",20,a),a+=15,z.forEach(s=>{const l=V(s.id),n=U(s.id),i=[...n.scheduleTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Cronograma",isOverdue:!0})),...n.minuteTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Minuta",name:e.tarea,description:e.responsable,endDate:e.fecha,isOverdue:!0})),...l.scheduleTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Cronograma",isOverdue:!1})),...l.minuteTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Minuta",name:e.tarea,description:e.responsable,endDate:e.fecha,isOverdue:!1}))];if(0===i.length)return;a>t-60&&(e.addPage(),a=20),e.setFontSize(12),e.setFont(void 0,"bold"),e.text("".concat(s.name),20,a),a+=8;const c=i.filter(e=>e.isOverdue);c.length>0&&(e.setFontSize(10),e.setFont(void 0,"bold"),e.setTextColor(220,38,38),e.text("Tareas Vencidas:",25,a),a+=6,c.forEach(s=>{a>t-20&&(e.addPage(),a=20),e.setFontSize(9),e.setFont(void 0,"normal"),e.setTextColor(0,0,0),e.text("\u2022 ".concat(s.name," (").concat(s.type,")"),30,a),a+=4,e.text("  Vence: ".concat(D(s.endDate)),30,a),a+=4}),a+=5);const o=i.filter(e=>!e.isOverdue);o.length>0&&(e.setFontSize(10),e.setFont(void 0,"bold"),e.setTextColor(59,130,246),e.text("Tareas de la Semana:",25,a),a+=6,o.forEach(s=>{a>t-20&&(e.addPage(),a=20),e.setFontSize(9),e.setFont(void 0,"normal"),e.setTextColor(0,0,0),e.text("\u2022 ".concat(s.name," (").concat(s.type,")"),30,a),a+=4,e.text("  Vence: ".concat(D(s.endDate)),30,a),s.description&&(a+=4,e.text("  Responsable: ".concat(s.description),30,a)),a+=4})),a+=10});const l="Planificacion_Semanal_".concat(D(d.start).replace(/\//g,"-"),"_").concat(D(d.end).replace(/\//g,"-"),".pdf");e.save(l)}catch(e){console.error("Error al exportar PDF:",e),alert("Error al generar el PDF. Por favor intenta de nuevo.")}},[d,u,z,V,U]);return(0,m.jsxs)("div",{className:"weekly-planning-tab bg-gray-50 min-h-screen p-6",children:[(0,m.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:(0,m.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,m.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,m.jsx)(h.A,{className:"mr-3 h-8 w-8 text-blue-600"}),"Planificaci\xf3n Semanal"]}),(0,m.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Desde:"}),(0,m.jsx)("input",{type:"date",value:d.start.toISOString().split("T")[0],onChange:e=>x(s=>(0,r.A)((0,r.A)({},s),{},{start:new Date(e.target.value)})),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Hasta:"}),(0,m.jsx)("input",{type:"date",value:d.end.toISOString().split("T")[0],onChange:e=>x(s=>(0,r.A)((0,r.A)({},s),{},{end:new Date(e.target.value)})),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,m.jsxs)("button",{onClick:H,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,m.jsx)(p.A,{className:"w-4 h-4"}),"Exportar PDF"]})]})]})}),u&&!T&&(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,m.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,m.jsx)(b.A,{className:"mr-2 h-5 w-5 text-green-600"}),"Cumplimiento Semana Pasada (",D(B.start)," - ",D(B.end),")"]}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,m.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)(j.A,{className:"h-8 w-8 text-green-600 mr-3"}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-sm font-medium text-green-800",children:"Completadas"}),(0,m.jsx)("p",{className:"text-2xl font-bold text-green-900",children:u.completedTasks})]})]})}),(0,m.jsx)("div",{className:"bg-orange-50 p-4 rounded-lg",children:(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)(v.A,{className:"h-8 w-8 text-orange-600 mr-3"}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-sm font-medium text-orange-800",children:"Pendientes"}),(0,m.jsx)("p",{className:"text-2xl font-bold text-orange-900",children:u.pendingTasks})]})]})}),(0,m.jsx)("div",{className:"bg-red-50 p-4 rounded-lg",children:(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)(y.A,{className:"h-8 w-8 text-red-600 mr-3"}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-sm font-medium text-red-800",children:"Vencidas"}),(0,m.jsx)("p",{className:"text-2xl font-bold text-red-900",children:u.overdueTasks})]})]})}),(0,m.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)(b.A,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-sm font-medium text-blue-800",children:"Cumplimiento"}),(0,m.jsxs)("p",{className:"text-2xl font-bold text-blue-900",children:[$(),"%"]})]})]})})]}),(0,m.jsxs)("div",{className:"space-y-3",children:[(0,m.jsx)("h4",{className:"font-medium text-gray-900",children:"Detalle por Proyecto:"}),Object.values(u.byProject).map((e,s)=>(0,m.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,m.jsx)("span",{className:"font-medium text-gray-900",children:e.projectName}),(0,m.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,m.jsxs)("span",{className:"text-sm text-green-600",children:["\u2713 ",e.completed]}),(0,m.jsxs)("span",{className:"text-sm text-orange-600",children:["\u23f1 ",e.pending]}),(0,m.jsxs)("span",{className:"text-sm text-red-600",children:["\u26a0 ",e.overdue]}),(0,m.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[e.total>0?Math.round(e.completed/e.total*100):0,"%"]})]})]},s))]})]}),(0,m.jsx)("div",{className:"space-y-6",children:(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,m.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[(0,m.jsx)(f.A,{className:"mr-2 h-6 w-6 text-blue-600"}),"Tareas de la Semana Actual",(0,m.jsxs)("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",D(d.start)," - ",D(d.end),")"]})]}),(0,m.jsx)("div",{className:"space-y-6",children:z.map(e=>{const s=V(e.id),t=U(e.id);return 0===s.scheduleTasks.length+s.minuteTasks.length+t.scheduleTasks.length+t.minuteTasks.length?null:(0,m.jsx)(I,{project:e,currentTasks:s,overdueTasks:t},e.id)})})]})})]})};var E=t(2367);const O=()=>{const[e,s]=(0,a.useState)([]),[t,l]=(0,a.useState)(0),[n,i]=(0,a.useState)(!0),[c,o]=(0,a.useState)(null),m=(0,a.useRef)(!1),x=(0,a.useRef)(null),u=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(m.current&&!e)return;const t=Date.now();if(!(!e&&x.current&&t-x.current<5e3))try{m.current=!0,i(!0);const e=d.default.getCurrentUser();if(!e||!e.email)return s([]),void l(0);const a=e.email,r=await(0,E.AX)(a),n=await(0,E.$M)(a);s(r),l(n),o(null),x.current=t}catch(c){console.error("Error cargando notificaciones:",c),o("Error cargando notificaciones")}finally{i(!1),m.current=!1}},[]),g=(0,a.useCallback)(async e=>{try{const t=await(0,E.aI)(e);return t.success&&(s(s=>s.filter(s=>s.id!==e)),l(e=>Math.max(0,e-1))),t}catch(c){return console.error("Error marcando notificaci\xf3n:",c),{success:!1,error:c}}},[]),h=(0,a.useCallback)(async()=>{try{const e=d.default.getCurrentUser();if(!e||!e.email)return{success:!1};const t=await(0,E.X0)(e.email);return t.success&&(s([]),l(0)),t}catch(c){return console.error("Error marcando todas como le\xeddas:",c),{success:!1,error:c}}},[]),p=(0,a.useCallback)(()=>{u(!0)},[u]);return(0,a.useEffect)(()=>{u()},[]),(0,a.useEffect)(()=>{const e=setInterval(()=>{u()},3e4);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{const e=setInterval(()=>{var e;const s=d.default.getCurrentUser(),t=null===s||void 0===s?void 0:s.email;t!==(null===(e=x.current)||void 0===e?void 0:e.email)&&(x.current=(0,r.A)((0,r.A)({},x.current),{},{email:t}),u(!0))},5e3);return()=>clearInterval(e)},[]),{notifications:e,unreadCount:t,loading:n,error:c,markAsRead:g,markAllAsRead:h,refresh:p}},M=e=>{let{notification:s,onMarkAsRead:t,onClose:a}=e;return(0,m.jsx)("div",{onClick:async()=>{await t(s.id),s.action_url&&(a&&a(),window.location.href=s.action_url)},className:"p-4 border rounded-lg cursor-pointer transition-all hover:shadow-md ".concat((e=>{switch(e){case"urgent":return"bg-red-50 border-red-200";case"high":return"bg-orange-50 border-orange-200";case"normal":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}})(s.priority)),children:(0,m.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,m.jsx)("div",{className:"text-2xl flex-shrink-0",children:(e=>{switch(e){case"assigned":return"\ud83d\udccb";case"approval_required":return"\u2705";case"ccb_vote_required":return"\ud83d\uddf3\ufe0f";case"status_changed":return"\ud83d\udd04";case"comment_added":return"\ud83d\udcac";case"implemented":return"\ud83d\ude80";default:return"\ud83d\udd14"}})(s.notification_type)}),(0,m.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,m.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-800 text-sm truncate",children:s.title}),"urgent"===s.priority&&(0,m.jsx)("span",{className:"ml-2 px-2 py-0.5 bg-red-100 text-red-800 text-xs rounded-full flex-shrink-0",children:"Urgente"})]}),(0,m.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:s.message}),(0,m.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,m.jsx)("span",{children:(e=>{const s=new Date-new Date(e),t=Math.floor(s/6e4),a=Math.floor(s/36e5),r=Math.floor(s/864e5);return t<1?"Hace un momento":t<60?"Hace ".concat(t," min"):a<24?"Hace ".concat(a,"h"):"Hace ".concat(r," d\xeda").concat(r>1?"s":"")})(s.created_at)}),s.change_number&&(0,m.jsx)("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:s.change_number})]})]})]})})},F=e=>{let{isOpen:s,onClose:t,notifications:a,unreadCount:r,loading:l,onMarkAsRead:n,onMarkAllAsRead:i}=e;if(!s)return null;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"fixed inset-0 z-40",onClick:e=>{e.target===e.currentTarget&&t()}}),(0,m.jsxs)("div",{className:"fixed right-4 top-20 w-96 max-w-full bg-white rounded-lg shadow-2xl border border-gray-200 z-[9999] max-h-[600px] flex flex-col",children:[(0,m.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-blue-50 to-indigo-50",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("span",{className:"text-xl",children:"\ud83d\udd14"}),(0,m.jsx)("h3",{className:"font-bold text-gray-800",children:"Notificaciones"}),r>0&&(0,m.jsx)("span",{className:"bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full",children:r})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[r>0&&(0,m.jsx)("button",{onClick:i,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Marcar todas"}),(0,m.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:"\u2715"})]})]}),(0,m.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:l&&0===a.length?(0,m.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,m.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent mb-4"}),(0,m.jsx)("p",{className:"text-gray-500 text-sm",children:"Cargando notificaciones..."})]}):0===a.length?(0,m.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,m.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udced"}),(0,m.jsx)("p",{className:"text-gray-600 font-medium mb-1",children:"No hay notificaciones"}),(0,m.jsx)("p",{className:"text-gray-500 text-sm",children:"Est\xe1s al d\xeda con todo"})]}):(0,m.jsx)("div",{className:"space-y-3",children:a.map(e=>(0,m.jsx)(M,{notification:e,onMarkAsRead:n,onClose:t},e.id))})}),a.length>0&&(0,m.jsx)("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:(0,m.jsx)("button",{onClick:t,className:"w-full text-center text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Ver todas las notificaciones"})})]})]})},z=e=>{let{className:s=""}=e;const[t,r]=(0,a.useState)(!1),{notifications:l,unreadCount:n,loading:i,error:c,markAsRead:o,markAllAsRead:d,refresh:x}=O();return(0,m.jsxs)("div",{className:"relative ".concat(s),children:[(0,m.jsxs)("button",{onClick:()=>{r(!t),t||x()},className:"relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Notificaciones",children:[(0,m.jsx)("span",{className:"text-2xl",children:"\ud83d\udd14"}),n>0&&(0,m.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 shadow-lg animate-pulse",children:n>99?"99+":n}),i&&(0,m.jsx)("span",{className:"absolute -bottom-1 -right-1 bg-blue-500 rounded-full w-2 h-2 animate-pulse"})]}),(0,m.jsx)(F,{isOpen:t,onClose:()=>r(!1),notifications:l,unreadCount:n,loading:i,onMarkAsRead:o,onMarkAllAsRead:d}),c&&(0,m.jsx)("div",{className:"absolute top-full right-0 mt-2 bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg text-sm shadow-lg",children:c})]})};var B=t(1946),L=t(5692),_=t(3255);const W=e=>{let{plan:s="free",status:t="active",size:a="md",showIcon:r=!0,showStatus:l=!1,className:n=""}=e;const i={legacy:{label:"Legacy",icon:B.A,bgColor:"bg-gradient-to-r from-purple-600 to-indigo-600",textColor:"text-white",description:"Plan exclusivo sin l\xedmites"},free:{label:"Free",icon:L.A,bgColor:"bg-gray-100",textColor:"text-gray-800",description:"1 proyecto, 3 usuarios"},professional:{label:"Professional",icon:_.A,bgColor:"bg-gradient-to-r from-blue-600 to-cyan-600",textColor:"text-white",description:"Proyectos ilimitados"}},c={active:{label:"Activo",color:"text-green-600",dotColor:"bg-green-600"},trialing:{label:"Periodo de prueba",color:"text-blue-600",dotColor:"bg-blue-600"},past_due:{label:"Pago pendiente",color:"text-yellow-600",dotColor:"bg-yellow-600"},canceled:{label:"Cancelado",color:"text-red-600",dotColor:"bg-red-600"},expired:{label:"Expirado",color:"text-gray-600",dotColor:"bg-gray-600"}},o={sm:{container:"px-2 py-1 text-xs",icon:"w-3 h-3",gap:"gap-1"},md:{container:"px-3 py-1.5 text-sm",icon:"w-4 h-4",gap:"gap-1.5"},lg:{container:"px-4 py-2 text-base",icon:"w-5 h-5",gap:"gap-2"}},d=i[s]||i.free,x=c[t]||c.active,u=o[a]||o.md,g=d.icon;return(0,m.jsxs)("div",{className:"inline-flex flex-col ".concat(n),children:[(0,m.jsxs)("div",{className:"\n          inline-flex items-center ".concat(u.gap,"\n          ").concat(d.bgColor," ").concat(d.textColor,"\n          ").concat(u.container,"\n          rounded-full font-semibold shadow-sm\n        "),title:d.description,children:[r&&(0,m.jsx)(g,{className:u.icon}),(0,m.jsx)("span",{children:d.label})]}),l&&(0,m.jsxs)("div",{className:"flex items-center ".concat(u.gap," mt-1 text-xs ").concat(x.color),children:[(0,m.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(x.dotColor)}),(0,m.jsx)("span",{children:x.label})]})]})},V=e=>{var s,t,r,l;let{organizationId:n,variant:i="full"}=e;const[c,d]=(0,a.useState)(null),[x,u]=(0,a.useState)(!0),[g,h]=(0,a.useState)(null);if((0,a.useEffect)(()=>{(async()=>{if(n)try{const e=await o.A.getUsageStats(n);d(e);const s=localStorage.getItem("strategiapm_portfolio_data");if(s){const e=JSON.parse(s);h(null===e||void 0===e?void 0:e.organization)}}catch(e){console.error("Error cargando estad\xedsticas de uso:",e)}finally{u(!1)}else u(!1)})()},[n]),x)return(0,m.jsx)("div",{className:"usage-indicator usage-indicator-loading",children:(0,m.jsx)("div",{className:"usage-spinner"})});if(!c||!g)return null;const p=g.subscriptionPlan||"free",b=g.subscriptionStatus||"active",j=(null===(s=c.projects)||void 0===s?void 0:s.current)||0,v=null===(t=c.projects)||void 0===t?void 0:t.max,y=(null===(r=c.users)||void 0===r?void 0:r.current)||0,f=null===(l=c.users)||void 0===l?void 0:l.max,N=null===v?0:j/v*100,w=null===f?0:y/f*100,k=e=>e>=90?"usage-danger":e>=70?"usage-warning":"usage-safe";return"compact"===i?(0,m.jsxs)("div",{className:"usage-indicator usage-indicator-compact",children:[(0,m.jsx)(W,{plan:p,status:b,size:"sm",showIcon:!1}),(0,m.jsxs)("div",{className:"usage-stats-compact",children:[(0,m.jsxs)("span",{className:"usage-stat ".concat(k(N)),children:["\ud83d\udcca ",j,null!==v?"/".concat(v):""]}),(0,m.jsxs)("span",{className:"usage-stat ".concat(k(w)),children:["\ud83d\udc65 ",y,null!==f?"/".concat(f):""]})]})]}):(0,m.jsxs)("div",{className:"usage-indicator usage-indicator-full",children:[(0,m.jsxs)("div",{className:"usage-header",children:[(0,m.jsx)("h3",{className:"usage-title",children:"Uso del Plan"}),(0,m.jsx)(W,{plan:p,status:b,size:"sm",showIcon:!0})]}),(0,m.jsxs)("div",{className:"usage-items",children:[(0,m.jsxs)("div",{className:"usage-item",children:[(0,m.jsxs)("div",{className:"usage-item-header",children:[(0,m.jsxs)("span",{className:"usage-item-label",children:[(0,m.jsx)("span",{className:"usage-item-icon",children:"\ud83d\udcca"}),"Proyectos"]}),(0,m.jsxs)("span",{className:"usage-item-count",children:[j,null!==v&&(0,m.jsxs)("span",{className:"usage-item-limit",children:[" / ",v]}),null===v&&(0,m.jsx)("span",{className:"usage-item-unlimited",children:" / ilimitados"})]})]}),null!==v&&(0,m.jsx)("div",{className:"usage-progress-bar",children:(0,m.jsx)("div",{className:"usage-progress-fill ".concat(k(N)),style:{width:"".concat(Math.min(N,100),"%")}})})]}),(0,m.jsxs)("div",{className:"usage-item",children:[(0,m.jsxs)("div",{className:"usage-item-header",children:[(0,m.jsxs)("span",{className:"usage-item-label",children:[(0,m.jsx)("span",{className:"usage-item-icon",children:"\ud83d\udc65"}),"Usuarios"]}),(0,m.jsxs)("span",{className:"usage-item-count",children:[y,null!==f&&(0,m.jsxs)("span",{className:"usage-item-limit",children:[" / ",f]}),null===f&&(0,m.jsx)("span",{className:"usage-item-unlimited",children:" / ilimitados"})]})]}),null!==f&&(0,m.jsx)("div",{className:"usage-progress-bar",children:(0,m.jsx)("div",{className:"usage-progress-fill ".concat(k(w)),style:{width:"".concat(Math.min(w,100),"%")}})})]})]}),(N>=80||w>=80)&&"free"===p&&(0,m.jsxs)("div",{className:"usage-warning-message",children:[(0,m.jsx)("span",{className:"usage-warning-icon",children:"\u26a0\ufe0f"}),(0,m.jsx)("span",{children:"Te est\xe1s acercando al l\xedmite de tu plan."}),(0,m.jsx)("button",{className:"usage-upgrade-link",onClick:()=>{console.log("Abrir modal de upgrade")},children:"Actualizar"})]})]})},U=e=>{const s=new Date(e),t=s.getDay(),a=s.getDate()-t+(0===t?-6:1);return s.setDate(a),s.setHours(0,0,0,0),s},q=e=>{const s=new Date(e),t=s.getDay(),a=s.getDate()-t+(0===t?-6:1)+6;return s.setDate(a),s.setHours(23,59,59,999),s},G=e=>{let{projects:s,setProjects:t,currentProjectId:r,setCurrentProjectId:l,portfolioMetrics:n,workPackages:i,risks:c,globalResources:o,setGlobalResources:d,createProject:x,updateProject:h,deleteProject:p,duplicateProject:b,tasks:j,tasksByProject:v,minutasByProject:y,purchaseOrders:f,advances:N,invoices:w,contracts:k,auditLogs:P,includeWeekendsByProject:C,setIncludeWeekendsByProject:D,getCurrentProjectIncludeWeekends:A,useSupabase:S}=e;const[I,T]=(0,a.useState)("overview"),[E,O]=(0,a.useState)("all"),[M,F]=(0,a.useState)(!1),[B,L]=(0,a.useState)([]),[_,W]=(0,a.useState)(null),[G,$]=(0,a.useState)(!1),[H,K]=(0,a.useState)({dateRange:{start:U(new Date),end:q(new Date)},previousWeekCompliance:null,projectTasks:{}}),[J,Y]=(0,a.useState)(null);(0,a.useEffect)(()=>{try{const s=localStorage.getItem("strategiapm_portfolio_data");if(s){var e;const t=JSON.parse(s);Y(null===t||void 0===t||null===(e=t.organization)||void 0===e?void 0:e.id)}}catch(s){console.error("Error obteniendo organizationId:",s)}},[]),(0,a.useEffect)(()=>{const e=e=>{const{tareaId:s,newStatus:t,projectId:a,timestamp:r}=e.detail;console.log("\ud83d\udd04 PortfolioStrategic: Evento minutaStatusChanged recibido:",{tareaId:s,newStatus:t,projectId:a,timestamp:r}),console.log("\ud83d\udd04 PortfolioStrategic: Forzando re-render del Dashboard resumen...")};return window.addEventListener("minutaStatusChanged",e),()=>{window.removeEventListener("minutaStatusChanged",e)}},[]);const X=s.find(e=>e.id===r),Q=e=>{const s=[];console.log("\ud83d\udd0d VALIDANDO ARCHIVADO para proyecto:",e.name),console.log("\ud83d\udcca Progreso del proyecto:",e.progress),console.log("\ud83d\udccb Total de tareas disponibles:",j.length),e.progress<100&&s.push("El proyecto debe estar 100% completado (actual: ".concat(e.progress,"%)"));const t=j.filter(s=>s.workPackageId===e.id||s.projectId===e.id);console.log("\ud83d\udccb Tareas del proyecto:",t.length);const a=t.filter(e=>e.progress<100&&"completed"!==e.status);console.log("\u274c Tareas incompletas:",a.length),a.length>0&&s.push("Todas las tareas deben estar completadas (".concat(a.length," tareas pendientes)"));t.filter(e=>e.predecessors&&e.predecessors.length>0).filter(e=>e.predecessors.map(e=>t.find(s=>s.id===e)).filter(Boolean).some(e=>e.progress<100)).length>0&&s.push("No debe haber dependencias activas con tareas incompletas");const r=[],l=["Acta de Inicio","Cronograma","Presupuesto","Acta de Cierre"].filter(e=>!r.some(s=>s.name.includes(e)));l.length>0&&s.push("Documentaci\xf3n incompleta: ".concat(l.join(", ")));const n=f.filter(s=>s.projectId===e.id||s.workPackageId===e.id),i=w.filter(s=>s.projectId===e.id||s.workPackageId===e.id),c=k.filter(s=>s.projectId===e.id||s.workPackageId===e.id),o=[];return n.some(e=>"pending"===e.status)&&o.push("\xd3rdenes de compra pendientes"),i.some(e=>"pending"===e.status)&&o.push("Facturas pendientes"),c.some(e=>"pending"===e.status)&&o.push("Contratos pendientes"),o.length>0&&s.push("Aprobaciones pendientes: ".concat(o.join(", "))),console.log("\u2705 Validaciones encontradas:",s),console.log("\ud83c\udfaf Puede archivar:",0===s.length),{canArchive:0===s.length,validations:s}},Z=e=>{const a=s.find(s=>s.id===e);if(!a)return;const n=Q(a);if(!n.canArchive){const e=n.validations.join("\n\u2022 ");return void alert('\u274c No se puede archivar el proyecto "'.concat(a.name,'"\n\nRazones:\n\u2022 ').concat(e,"\n\nPor favor, complete todos los requisitos antes de archivar."))}const i='\xbfEst\xe1 seguro de que desea archivar el proyecto "'.concat(a.name,'"?\n\nEste proyecto ser\xe1 movido al archivo y ya no estar\xe1 disponible para edici\xf3n.');if(!window.confirm(i))return;const c={id:a.id,name:a.name,description:a.description,startDate:a.startDate,endDate:a.endDate,budget:a.budget,status:a.status,priority:a.priority,manager:a.manager,team:a.team,createdAt:a.createdAt,updatedAt:a.updatedAt,version:a.version,progress:a.progress,archivedAt:(new Date).toISOString(),archivedBy:"Usuario Actual"};L(e=>{const s=e.slice();return s.push(c),s});const o=s.map(s=>s.id===e?{id:s.id,name:s.name,description:s.description,startDate:s.startDate,endDate:s.endDate,budget:s.budget,status:"archived",priority:s.priority,manager:s.manager,team:s.team,createdAt:s.createdAt,updatedAt:s.updatedAt,version:s.version,progress:s.progress,archivedAt:(new Date).toISOString()}:s);if(t(o),r===e){const e=o.filter(e=>"active"===e.status);e.length>0&&l(e[0].id)}alert('\u2705 Proyecto "'.concat(a.name,'" archivado exitosamente.'))},ee=()=>{W(null),$(!1)},se=e=>{switch(e){case"active":return"bg-green-100 text-green-800 border-green-200";case"inactive":return"bg-gray-100 text-gray-600 border-gray-300";case"completed":return"bg-blue-100 text-blue-800 border-blue-200";case"on-hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"archived":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},te=e=>{switch(e){case"active":return"\ud83d\udfe2";case"inactive":return"\u26ab";case"completed":return"\u2705";case"on-hold":default:return"\u23f8\ufe0f";case"cancelled":return"\u274c";case"archived":return"\ud83d\udcc1"}};return(0,m.jsxs)("div",{className:"space-y-6 max-w-full overflow-hidden",children:[(0,m.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-100 rounded-2xl shadow-lg p-6 text-gray-800 relative overflow-hidden",children:[(0,m.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,m.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-indigo-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,m.jsx)("div",{className:"relative z-10",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,m.jsx)("span",{className:"text-3xl",children:"\ud83c\udfe2"})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gray-800",children:"Portafolio de Proyectos"}),(0,m.jsx)("p",{className:"text-gray-600 text-lg",children:"Gesti\xf3n estrat\xe9gica y configuraci\xf3n de proyectos"})]})]}),(0,m.jsxs)("div",{className:"flex items-center gap-4",children:[J&&(0,m.jsx)(V,{organizationId:J,variant:"compact"}),(0,m.jsx)(z,{})]})]})})]}),(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,m.jsx)("div",{className:"border-b border-gray-200",children:(0,m.jsx)("nav",{className:"flex space-x-8 px-6",children:[{id:"overview",name:"Vista General",icon:"\ud83d\udcca"},{id:"projects",name:"Lista de Proyectos",icon:"\ud83d\udccb"},{id:"resources",name:"Lista de Recursos",icon:"\ud83d\udc65"},{id:"weekly-planning",name:"Planificaci\xf3n Semanal",icon:"\ud83d\udcc5"},{id:"archive",name:"Archivado de Proyectos",icon:"\ud83d\udcc1"},{id:"metrics",name:"M\xe9tricas del Portfolio",icon:"\ud83d\udcc8"}].map(e=>(0,m.jsxs)("button",{onClick:()=>T(e.id),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ".concat(I===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,m.jsx)("span",{children:e.icon}),(0,m.jsx)("span",{children:e.name})]},e.id))})}),(0,m.jsxs)("div",{className:"p-6",children:["overview"===I&&(0,m.jsxs)("div",{className:"space-y-6",children:[0===s.length&&(0,m.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[(0,m.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udcc1"}),(0,m.jsx)("h3",{className:"text-2xl font-bold text-gray-700 mb-2",children:"\xa1Bienvenido a tu Portfolio de Proyectos!"}),(0,m.jsx)("p",{className:"text-gray-600 mb-6",children:"Comienza creando tu primer proyecto para gestionar cronogramas, riesgos, presupuestos y m\xe1s."}),(0,m.jsx)("button",{onClick:()=>{T("projects"),F(!0)},className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 text-lg font-semibold shadow-lg transition-colors",children:"\u2795 Crear Primer Proyecto"})]}),s.length>0&&(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,m.jsxs)("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,m.jsx)("span",{className:"text-2xl",children:"\ud83d\udcca"}),(0,m.jsx)("h3",{className:"text-lg font-semibold text-blue-800",children:"Total Proyectos"})]}),(0,m.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:s.length}),(0,m.jsxs)("div",{className:"text-sm text-blue-600",children:[s.filter(e=>"active"===e.status).length," activos"]})]}),(0,m.jsxs)("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,m.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"}),(0,m.jsx)("h3",{className:"text-lg font-semibold text-green-800",children:"Presupuesto Total"})]}),(0,m.jsxs)("div",{className:"text-3xl font-bold text-green-600 mb-2",children:["$",(s.filter(e=>"active"===e.status).reduce((e,s)=>e+s.budget,0)/1e3).toFixed(0),"K USD"]}),(0,m.jsx)("div",{className:"text-sm text-green-600",children:"Solo proyectos activos"})]}),(0,m.jsxs)("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-200",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,m.jsx)("span",{className:"text-2xl",children:"\ud83c\udfaf"}),(0,m.jsx)("h3",{className:"text-lg font-semibold text-purple-800",children:"Proyectos Prioritarios"})]}),(0,m.jsx)("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:s.filter(e=>"high"===e.priority&&"active"===e.status).length}),(0,m.jsx)("div",{className:"text-sm text-purple-600",children:"Prioridad alta (activos)"})]})]}),!1,s.length>0&&X&&(0,m.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Proyecto Destacado"}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Informaci\xf3n General"}),(0,m.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Nombre:"})," ",X.name]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Manager:"})," ",X.manager]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Sponsor:"})," ",X.sponsor]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Estado:"}),(0,m.jsxs)("span",{className:"ml-2 px-2 py-1 rounded-full text-xs ".concat(se(X.status)),children:[te(X.status)," ",X.status]})]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"M\xe9tricas Financieras"}),(0,m.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Presupuesto:"})," $",(X.budget/1e3).toFixed(0),"K USD"]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Reserva Contingencia:"})," $",(X.contingencyReserve/1e3).toFixed(0),"K USD"]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Reserva Gesti\xf3n:"})," $",(X.managementReserve/1e3).toFixed(0),"K USD"]}),X.irr>0&&(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"font-medium",children:"TIR:"})," ",X.irr.toFixed(2),"%"]})]})]})]})]})]}),"projects"===I&&(0,m.jsx)(u,{projects:s,currentProjectId:r,setCurrentProjectId:l,portfolioMetrics:n,workPackages:i,risks:c,globalResources:o,setGlobalResources:d,tasksByProject:v,createProject:x,updateProject:h,deleteProject:p,duplicateProject:e=>{console.log("\ud83d\udccb Duplicando proyecto con ID:",e);const t=s.find(s=>s.id===e);if(!t)return void console.error("\u274c Proyecto no encontrado para duplicar");const a={id:"proj-"+String(Date.now()).slice(-6),name:"".concat(t.name," (Copia)"),description:t.description,startDate:t.startDate,endDate:t.endDate,budget:t.budget,status:t.status,priority:t.priority,manager:t.manager,team:t.team,createdAt:t.createdAt,updatedAt:t.updatedAt,version:t.version,progress:t.progress};console.log("\ud83d\udccb Proyecto duplicado creado:",a),x(a)},archiveProject:Z,includeWeekendsByProject:C,setIncludeWeekendsByProject:D,getCurrentProjectIncludeWeekends:A,triggerNewProject:M,onNewProjectTriggered:()=>{F(!1)}}),"resources"===I&&(0,m.jsx)(g,{globalResources:o,setGlobalResources:d}),"weekly-planning"===I&&(0,m.jsxs)(m.Fragment,{children:[(()=>{console.log("\ud83d\udd0d DEBUG - Datos que se pasan a WeeklyPlanningTab:"),console.log("  \ud83d\udcca projects:",s),console.log("  \ud83d\udcca tasksByProject:",v),console.log("  \ud83d\udcca minutasByProject:",y),console.log("  \ud83d\udcca Estructura minutasByProject:",Object.keys(y||{}));const e=Object.keys(y||{})[0];return e&&console.log("  \ud83d\udcca Ejemplo minutas proyecto ".concat(e,":"),y[e]),null})(),(0,m.jsx)(R,{projects:s,tasksByProject:v,minutasByProject:y,weeklyPlanningData:H,setWeeklyPlanningData:K,useSupabase:S})]}),"archive"===I&&(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6 border border-purple-200",children:(0,m.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,m.jsx)("span",{className:"text-3xl",children:"\ud83d\udcc1"}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"Archivado de Proyectos"}),(0,m.jsx)("p",{className:"text-gray-600",children:"Gesti\xf3n centralizada del ciclo de vida completo de proyectos"})]})]})}),(0,m.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,m.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,m.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 flex items-center space-x-2",children:[(0,m.jsx)("span",{children:"\ud83d\udccb"}),(0,m.jsx)("span",{children:"Proyectos Activos"})]}),(0,m.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Selecciona un proyecto para archivarlo"})]}),(0,m.jsx)("div",{className:"p-6",children:0===s.filter(e=>"active"===e.status).length?(0,m.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,m.jsx)("span",{className:"text-4xl mb-2 block",children:"\ud83d\udced"}),(0,m.jsx)("p",{children:"No hay proyectos activos para archivar"})]}):(0,m.jsx)("div",{className:"space-y-3",children:s.filter(e=>"active"===e.status).map(e=>{const s=Q(e),t=s.canArchive;return(0,m.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg border ".concat(t?"bg-gray-50 border-gray-200":"bg-red-50 border-red-200"),children:[(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsx)("h5",{className:"font-medium text-gray-800",children:e.name}),(0,m.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,m.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,m.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(se(e.status)),children:e.status}),(0,m.jsxs)("span",{className:"text-xs text-gray-500",children:["Progreso: ",e.progress,"%"]}),(0,m.jsxs)("span",{className:"text-xs text-gray-500",children:["Creado: ",new Date(e.createdAt).toLocaleDateString()]})]}),!t&&(0,m.jsxs)("div",{className:"mt-2 p-2 bg-red-100 rounded border border-red-200",children:[(0,m.jsx)("p",{className:"text-xs text-red-700 font-medium mb-1",children:"\u26a0\ufe0f Requisitos pendientes para archivado:"}),(0,m.jsx)("ul",{className:"text-xs text-red-600 space-y-1",children:s.validations.map((e,s)=>(0,m.jsxs)("li",{className:"flex items-start",children:[(0,m.jsx)("span",{className:"mr-1",children:"\u2022"}),(0,m.jsx)("span",{children:e})]},s))})]})]}),(0,m.jsxs)("div",{className:"ml-4 flex flex-col space-y-2",children:[(0,m.jsxs)("button",{onClick:()=>Z(e.id),disabled:!t,className:"px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 ".concat(t?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),title:t?"Archivar proyecto":"No cumple requisitos para archivado",children:[(0,m.jsx)("span",{children:"\ud83d\udcc1"}),(0,m.jsx)("span",{children:"Archivar"})]}),!t&&(0,m.jsx)("span",{className:"text-xs text-red-600 text-center",children:"No disponible"})]})]},e.id)})})})]}),(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,m.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,m.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 flex items-center space-x-2",children:[(0,m.jsx)("span",{children:"\ud83d\udce6"}),(0,m.jsx)("span",{children:"Proyectos Archivados"})]}),(0,m.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Historial de proyectos archivados"})]}),(0,m.jsx)("div",{className:"p-6",children:0===B.length?(0,m.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,m.jsx)("span",{className:"text-4xl mb-2 block",children:"\ud83d\udced"}),(0,m.jsx)("p",{children:"No hay proyectos archivados"})]}):(0,m.jsx)("div",{className:"space-y-3",children:B.map(e=>(0,m.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:(0,m.jsxs)("div",{className:"flex items-start justify-between",children:[(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsx)("h5",{className:"font-medium text-gray-800",children:e.name}),(0,m.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,m.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,m.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"Archivado"}),(0,m.jsxs)("span",{className:"text-xs text-gray-500",children:["Archivado: ",new Date(e.archivedAt).toLocaleDateString()]}),(0,m.jsxs)("span",{className:"text-xs text-gray-500",children:["Por: ",e.archivedBy]})]})]}),(0,m.jsx)("div",{className:"ml-4 flex space-x-2",children:(0,m.jsxs)("button",{onClick:()=>(e=>{W(e),$(!0)})(e),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors flex items-center space-x-1",title:"Ver detalles del proyecto archivado",children:[(0,m.jsx)("span",{children:"\ud83d\udc41\ufe0f"}),(0,m.jsx)("span",{children:"Ver"})]})})]})},e.id))})})]})]})]}),"metrics"===I&&(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"M\xe9tricas del Portfolio"}),(0,m.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("div",{className:"text-blue-600 text-xl mr-3",children:"\u2139\ufe0f"}),(0,m.jsxs)("div",{className:"text-blue-800 text-sm",children:[(0,m.jsx)("strong",{children:"Importante:"}),' Las m\xe9tricas financieras solo consideran proyectos con estado "Activo". Los proyectos "Inactivos" no suman al presupuesto total ni a las reservas del portfolio.']})]})}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,m.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-800 mb-4",children:"Distribuci\xf3n por Estado"}),(0,m.jsx)("div",{className:"space-y-3",children:["active","completed","on-hold","cancelled"].map(e=>{const t=s.filter(s=>s.status===e).length,a=s.length>0?t/s.length*100:0;return(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("span",{children:te(e)}),(0,m.jsx)("span",{className:"capitalize",children:e})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,m.jsx)("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:"".concat(a,"%")}})}),(0,m.jsx)("span",{className:"text-sm text-gray-600 w-8 text-right",children:t})]})]},e)})})]}),(0,m.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-800 mb-4",children:"Distribuci\xf3n por Prioridad"}),(0,m.jsx)("div",{className:"space-y-3",children:["high","medium","low"].map(e=>{const t=s.filter(s=>s.priority===e).length,a=s.length>0?t/s.length*100:0;return(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsx)("div",{className:"flex items-center space-x-2",children:(0,m.jsx)("span",{className:"capitalize",children:e})}),(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,m.jsx)("div",{className:"bg-green-500 h-2 rounded-full",style:{width:"".concat(a,"%")}})}),(0,m.jsx)("span",{className:"text-sm text-gray-600 w-8 text-right",children:t})]})]},e)})})]})]}),(0,m.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-800 mb-4",children:"An\xe1lisis Financiero (Solo Proyectos Activos)"}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:["$",(s.filter(e=>"active"===e.status).reduce((e,s)=>e+s.budget,0)/1e3).toFixed(0),"K USD"]}),(0,m.jsx)("div",{className:"text-sm text-gray-600",children:"Presupuesto Total"})]}),(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",(s.filter(e=>"active"===e.status).reduce((e,s)=>e+s.contingencyReserve+s.managementReserve,0)/1e3).toFixed(0),"K USD"]}),(0,m.jsx)("div",{className:"text-sm text-gray-600",children:"Reservas Totales"})]}),(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:s.filter(e=>"active"===e.status&&e.irr>0).length}),(0,m.jsx)("div",{className:"text-sm text-gray-600",children:"Proyectos con TIR"})]})]}),(0,m.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,m.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,m.jsx)("strong",{children:"Nota:"}),' Las m\xe9tricas financieras solo consideran proyectos con estado "Activo". Los proyectos "Inactivos" o "Completados" no influyen en los indicadores financieros.']})})]})]})]})]}),G&&_&&(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,m.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,m.jsx)("span",{className:"text-3xl",children:"\ud83d\udcc1"}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:_.name}),(0,m.jsx)("p",{className:"text-sm text-gray-600",children:"Proyecto Archivado"})]})]}),(0,m.jsx)("button",{onClick:ee,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"\xd7"})]})}),(0,m.jsxs)("div",{className:"p-6 space-y-6",children:[(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,m.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-800 mb-3",children:"\ud83d\udcca Informaci\xf3n General"}),(0,m.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsx)("span",{className:"text-gray-600",children:"Estado:"}),(0,m.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"Archivado"})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsx)("span",{className:"text-gray-600",children:"Progreso:"}),(0,m.jsxs)("span",{className:"font-medium",children:[_.progress,"%"]})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsx)("span",{className:"text-gray-600",children:"Archivado:"}),(0,m.jsx)("span",{children:new Date(_.archivedAt).toLocaleDateString()})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsx)("span",{className:"text-gray-600",children:"Archivado por:"}),(0,m.jsx)("span",{children:_.archivedBy})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsx)("span",{className:"text-gray-600",children:"Creado:"}),(0,m.jsx)("span",{children:new Date(_.createdAt).toLocaleDateString()})]})]})]}),(0,m.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,m.jsx)("h4",{className:"font-semibold text-gray-800 mb-3",children:"\ud83d\udcdd Descripci\xf3n"}),(0,m.jsx)("p",{className:"text-sm text-gray-600",children:_.description||"Sin descripci\xf3n disponible"})]})]}),(0,m.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,m.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,m.jsxs)("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center space-x-2",children:[(0,m.jsx)("span",{children:"\ud83d\udccb"}),(0,m.jsx)("span",{children:"Tareas del Cronograma"})]}),(0,m.jsx)("div",{className:"space-y-2",children:(()=>{const e=j.filter(e=>e.workPackageId===_.id||e.projectId===_.id);return 0===e.length?(0,m.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No hay tareas registradas para este proyecto"}):(0,m.jsxs)("div",{className:"space-y-1",children:[(0,m.jsxs)("p",{className:"text-sm text-gray-600",children:["Total: ",e.length," tareas"]}),(0,m.jsxs)("p",{className:"text-sm text-gray-600",children:["Completadas: ",e.filter(e=>100===e.progress).length]}),(0,m.jsxs)("p",{className:"text-sm text-gray-600",children:["Pendientes: ",e.filter(e=>e.progress<100).length]})]})})()})]}),(0,m.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,m.jsxs)("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center space-x-2",children:[(0,m.jsx)("span",{children:"\ud83d\udcce"}),(0,m.jsx)("span",{children:"Auditor\xeda Documental"})]}),(0,m.jsx)("div",{className:"space-y-2",children:(()=>{const e=P.filter(e=>e.projectId===_.id||e.workPackageId===_.id);if(0===e.length)return(0,m.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No hay registros de auditor\xeda para este proyecto"});const s=e.reduce((e,s)=>{const t=s.documentType||"Otros";return e[t]||(e[t]=[]),e[t].push(s),e},{});return(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsxs)("p",{className:"text-sm text-gray-600 font-medium",children:["Total de documentos: ",e.length]}),(0,m.jsx)("div",{className:"space-y-1",children:Object.entries(s).map(e=>{let[s,t]=e;return(0,m.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,m.jsxs)("span",{className:"text-gray-600",children:[s,":"]}),(0,m.jsx)("span",{className:"font-medium",children:t.length})]},s)})})]})})()})]})]}),(0,m.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,m.jsxs)("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center space-x-2",children:[(0,m.jsx)("span",{children:"\ud83d\udcc8"}),(0,m.jsx)("span",{children:"M\xe9tricas Finales"})]}),(0,m.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[_.progress,"%"]}),(0,m.jsx)("div",{className:"text-gray-600",children:"Progreso Final"})]}),(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-green-600",children:j.filter(e=>e.workPackageId===_.id||e.projectId===_.id).length}),(0,m.jsx)("div",{className:"text-gray-600",children:"Tareas Totales"})]}),(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:new Date(_.archivedAt).toLocaleDateString()}),(0,m.jsx)("div",{className:"text-gray-600",children:"Fecha de Archivado"})]}),(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:_.archivedBy}),(0,m.jsx)("div",{className:"text-gray-600",children:"Responsable"})]})]})]}),(0,m.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,m.jsxs)("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center space-x-2",children:[(0,m.jsx)("span",{children:"\ud83d\udccb"}),(0,m.jsx)("span",{children:"Registro de Auditor\xeda Documental"})]}),(0,m.jsx)("div",{className:"space-y-3",children:(()=>{const e=P.filter(e=>e.projectId===_.id||e.workPackageId===_.id);if(0===e.length)return(0,m.jsx)("p",{className:"text-sm text-gray-500 italic text-center py-4",children:"No hay registros de auditor\xeda documental para este proyecto"});const s=e.sort((e,s)=>new Date(s.timestamp)-new Date(e.timestamp));return(0,m.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.map((e,s)=>(0,m.jsx)("div",{className:"bg-white p-3 rounded border border-gray-200",children:(0,m.jsx)("div",{className:"flex items-start justify-between",children:(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,m.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.documentType||"Documento"}),(0,m.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("create"===e.action?"bg-green-100 text-green-800":"update"===e.action?"bg-blue-100 text-blue-800":"delete"===e.action?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"create"===e.action?"Creado":"update"===e.action?"Modificado":"delete"===e.action?"Eliminado":"Acci\xf3n"})]}),(0,m.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:e.description||"Sin descripci\xf3n"}),(0,m.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,m.jsxs)("span",{children:["Por: ",e.user||"Sistema"]}),(0,m.jsx)("span",{children:"\u2022"}),(0,m.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]})]})})},s))})})()})]}),(0,m.jsx)("div",{className:"bg-gray-100 p-4 rounded-lg border-l-4 border-gray-400",children:(0,m.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,m.jsx)("span",{className:"text-yellow-600 text-xl",children:"\u26a0\ufe0f"}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h5",{className:"font-medium text-gray-800",children:"Proyecto Archivado"}),(0,m.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Este proyecto est\xe1 archivado y es de solo lectura. Los datos se mantienen para consulta hist\xf3rica y auditor\xeda, pero no se puede modificar."})]})]})})]}),(0,m.jsx)("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3",children:(0,m.jsx)("button",{onClick:ee,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cerrar"})})]})})]})}},2367:(e,s,t)=>{t.d(s,{$$:()=>m,$M:()=>c,AX:()=>l,EL:()=>o,Kl:()=>x,X0:()=>i,aI:()=>n,iD:()=>d});var a=t(8103);const r=async e=>{let{userEmail:s,userId:t,changeId:r,changeNumber:l,changeTitle:n,notificationType:i,title:c,message:o,priority:d="normal",metadata:m={}}=e;try{a.default.getCurrentUser();const e=a.default.getCurrentOrganization();if(!e)return console.warn("No se puede crear notificaci\xf3n: organizaci\xf3n no detectada"),{success:!1,error:"Organizaci\xf3n no detectada"};const x={organization_id:e,user_id:t,user_email:s,change_id:r,change_number:l,change_title:n,notification_type:i,title:c,message:o,priority:d,status:"unread",metadata:m,action_url:"/change-management?changeId=".concat(r),created_at:(new Date).toISOString()},{data:u,error:g}=await a.default.supabase.from("change_notifications").insert(x).select().single();return g?(console.error("Error creando notificaci\xf3n:",g),{success:!1,error:g}):{success:!0,data:u}}catch(x){return console.error("Error inesperado creando notificaci\xf3n:",x),{success:!1,error:x}}},l=async e=>{try{const{data:s,error:t}=await a.default.supabase.from("change_notifications").select("*").eq("user_email",e).eq("status","unread").order("created_at",{ascending:!1});return t?(console.error("Error obteniendo notificaciones:",t),[]):s||[]}catch(s){return console.error("Error inesperado obteniendo notificaciones:",s),[]}},n=async e=>{try{const{error:s}=await a.default.supabase.from("change_notifications").update({status:"read",read_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("id",e);return s?(console.error("Error marcando notificaci\xf3n como le\xedda:",s),{success:!1,error:s}):{success:!0}}catch(s){return console.error("Error inesperado marcando notificaci\xf3n:",s),{success:!1,error:s}}},i=async e=>{try{const{error:s}=await a.default.supabase.from("change_notifications").update({status:"read",read_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("user_email",e).eq("status","unread");return s?(console.error("Error marcando todas como le\xeddas:",s),{success:!1,error:s}):{success:!0}}catch(s){return console.error("Error inesperado marcando todas como le\xeddas:",s),{success:!1,error:s}}},c=async e=>{try{const{count:s,error:t}=await a.default.supabase.from("change_notifications").select("*",{count:"exact",head:!0}).eq("user_email",e).eq("status","unread");return t?(console.error("Error obteniendo conteo:",t),0):s||0}catch(s){return console.error("Error inesperado obteniendo conteo:",s),0}},o=async e=>{let{userEmail:s,userId:t,change:a,assignedBy:l}=e;return r({userEmail:s,userId:t,changeId:a.id,changeNumber:a.changeNumber,changeTitle:a.title,notificationType:"assigned",title:"Cambio Asignado",message:"".concat(l,' te ha asignado el cambio "').concat(a.title,'"'),priority:"high",metadata:{assignedBy:l,changeStatus:a.status}})},d=async e=>{let{userEmail:s,userId:t,change:a}=e;return r({userEmail:s,userId:t,changeId:a.id,changeNumber:a.changeNumber,changeTitle:a.title,notificationType:"approval_required",title:"Aprobaci\xf3n Requerida",message:'El cambio "'.concat(a.title,'" requiere tu aprobaci\xf3n'),priority:"urgent",metadata:{costImpact:a.impactCost,scheduleImpact:a.impactSchedule}})},m=async e=>{let{userEmail:s,userId:t,change:a}=e;return r({userEmail:s,userId:t,changeId:a.id,changeNumber:a.changeNumber,changeTitle:a.title,notificationType:"ccb_vote_required",title:"Voto CCB Requerido",message:'Tu voto es requerido en el CCB para "'.concat(a.title,'"'),priority:"high",metadata:{changeStatus:a.status}})},x=async e=>{let{userEmail:s,userId:t,change:a,oldStatus:l,newStatus:n,changedBy:i}=e;return r({userEmail:s,userId:t,changeId:a.id,changeNumber:a.changeNumber,changeTitle:a.title,notificationType:"status_changed",title:"Estado de Cambio Actualizado",message:'El cambio "'.concat(a.title,'" pas\xf3 de ').concat(l," a ").concat(n),priority:"normal",metadata:{oldStatus:l,newStatus:n,changedBy:i}})}},8449:(e,s,t)=>{t.r(s),t.d(s,{default:()=>o});var a=t(9379),r=t(9950),l=t(3116),n=t(4414);const i=e=>{switch(e){case"active":return"bg-green-100 text-green-800 border-green-200";case"inactive":return"bg-gray-100 text-gray-600 border-gray-300";case"completed":return"bg-blue-100 text-blue-800 border-blue-200";case"on-hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"archived":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},c=e=>{switch(e){case"active":return"\ud83d\udfe2";case"inactive":return"\u26ab";case"completed":return"\u2705";case"on-hold":default:return"\u23f8\ufe0f";case"cancelled":return"\u274c";case"archived":return"\ud83d\udcc1"}},o=e=>{let{project:s,workPackages:t,risks:o,tasks:d,purchaseOrders:m,advances:x,invoices:u,contracts:g,resourceAssignments:h,onArchiveProject:p}=e;const[b,j]=(0,r.useState)(!1),[v,y]=(0,r.useState)(0),f=(()=>{if(!s)return[];try{const e=localStorage.getItem("audit-log-".concat(s.id));return e?JSON.parse(e):[]}catch(e){return console.error("Error loading audit log:",e),[]}})(),{files:N,getFileStats:w}=(0,l.A)(null===s||void 0===s?void 0:s.id),k=w(),P=(0,r.useMemo)(()=>{if(!s)return{};const e=t.length,a=t.filter(e=>"completed"===e.status).length,r=t.reduce((e,s)=>e+(s.budget||0),0),l=t.reduce((e,s)=>e+(s.earnedValue||0),0),n=t.reduce((e,s)=>e+(s.actualCost||0),0);return{totalWorkPackages:e,completedWorkPackages:a,completionPercentage:e>0?a/e*100:0,totalBudget:r,totalEarned:l,totalActual:n,budgetUtilization:r>0?n/r*100:0,cpi:n>0?l/n:1,totalRisks:o.length,activeRisks:o.filter(e=>"active"===e.status).length,totalTasks:d.length,completedTasks:d.filter(e=>"completed"===e.status).length,totalFinancialItems:m.length+x.length+u.length+g.length,totalResourceAssignments:h.length,totalAuditEvents:f.length,totalFiles:N.length,totalFileSize:k.totalSizeMB}},[s,t,o,d,m,x,u,g,h,f,N,k]),C=(0,r.useMemo)(()=>!!s&&("completed"===s.status&&(!(P.completionPercentage<90)&&0!==P.totalWorkPackages)),[s,P]),D=()=>{const e=[];return P.cpi<.9&&e.push("El proyecto tuvo sobrecostos significativos. Revisar estimaciones de costos para futuros proyectos similares."),P.completionPercentage<95&&e.push("Algunos entregables no se completaron al 100%. Mejorar el seguimiento de work packages."),P.activeRisks>0&&e.push("Quedaron riesgos activos al finalizar. Implementar mejor gesti\xf3n de riesgos desde el inicio."),P.totalAuditEvents>100&&e.push("El proyecto tuvo muchos cambios. Implementar mejor control de cambios."),0===e.length&&e.push("El proyecto se ejecut\xf3 exitosamente. Replicar buenas pr\xe1cticas en futuros proyectos."),e};return s?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-gradient-to-r from-purple-50 to-indigo-100 rounded-2xl shadow-lg p-6 text-gray-800 relative overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-purple-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,n.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-indigo-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,n.jsx)("div",{className:"relative z-10",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,n.jsx)("span",{className:"text-3xl",children:"\ud83d\udcc1"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gray-800",children:"Archivado de Proyecto"}),(0,n.jsxs)("p",{className:"text-gray-600 text-lg",children:['Generar expediente completo y archivar "',s.name,'"']})]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsxs)("div",{className:"text-4xl font-bold text-gray-800",children:[P.completionPercentage.toFixed(1),"%"]}),(0,n.jsx)("div",{className:"text-gray-600",children:"Completitud"})]})]})})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Estado del Proyecto"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Estado Actual"}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(i(s.status)),children:[c(s.status)," ",s.status]})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Manager"}),(0,n.jsx)("div",{className:"font-medium",children:s.manager})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Presupuesto Original"}),(0,n.jsxs)("div",{className:"font-medium",children:["$",(s.budget/1e3).toFixed(0),"K USD"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Per\xedodo"}),(0,n.jsxs)("div",{className:"font-medium",children:[s.startDate," - ",s.endDate]})]})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"M\xe9tricas Finales"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:P.totalWorkPackages}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Work Packages"}),(0,n.jsxs)("div",{className:"text-xs text-gray-500",children:[P.completedWorkPackages," completados"]})]}),(0,n.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",(P.totalBudget/1e3).toFixed(0),"K"]}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Presupuesto Total"}),(0,n.jsxs)("div",{className:"text-xs text-gray-500",children:["$",(P.totalActual/1e3).toFixed(0),"K gastado"]})]}),(0,n.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:P.totalAuditEvents}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Eventos de Auditor\xeda"}),(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"Registros completos"})]})]})]}),f.length>0&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udccb Registro de Auditor\xeda"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"Total de eventos registrados:"}),(0,n.jsx)("span",{className:"font-semibold text-purple-600",children:f.length})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"Primer evento:"}),(0,n.jsx)("span",{className:"text-sm text-gray-500",children:f.length>0?new Date(f[f.length-1].timestamp).toLocaleDateString():"N/A"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"\xdaltimo evento:"}),(0,n.jsx)("span",{className:"text-sm text-gray-500",children:f.length>0?new Date(f[0].timestamp).toLocaleDateString():"N/A"})]}),(0,n.jsx)("div",{className:"mt-3 p-3 bg-purple-50 border border-purple-200 rounded-lg",children:(0,n.jsxs)("div",{className:"text-sm text-purple-800",children:[(0,n.jsx)("strong",{children:"\u2705 Audit Log incluido:"})," El expediente incluir\xe1 todos los eventos de auditor\xeda registrados desde la activaci\xf3n del proyecto hasta su completitud."]})})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Validaci\xf3n de Archivado"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("span",{className:"text-xl ".concat("completed"===s.status?"text-green-500":"text-red-500"),children:"completed"===s.status?"\u2705":"\u274c"}),(0,n.jsx)("span",{className:"text-sm",children:"Proyecto marcado como completado"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("span",{className:"text-xl ".concat(P.completionPercentage>=90?"text-green-500":"text-red-500"),children:P.completionPercentage>=90?"\u2705":"\u274c"}),(0,n.jsxs)("span",{className:"text-sm",children:["Completitud m\xednima del 90% (",P.completionPercentage.toFixed(1),"%)"]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("span",{className:"text-xl ".concat(P.totalWorkPackages>0?"text-green-500":"text-red-500"),children:P.totalWorkPackages>0?"\u2705":"\u274c"}),(0,n.jsxs)("span",{className:"text-sm",children:["Work packages definidos (",P.totalWorkPackages,")"]})]})]}),!C&&(0,n.jsx)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,n.jsxs)("div",{className:"text-sm text-red-800",children:[(0,n.jsx)("strong",{children:"No se puede archivar:"})," El proyecto no cumple con los criterios m\xednimos de archivado."]})})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Contenido del Expediente"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,n.jsx)("span",{className:"text-sm",children:"Informaci\xf3n del proyecto"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,n.jsx)("span",{className:"text-sm",children:"Work packages completos"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,n.jsx)("span",{className:"text-sm",children:"Gesti\xf3n de riesgos"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,n.jsx)("span",{className:"text-sm",children:"Cronograma y tareas"})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,n.jsx)("span",{className:"text-sm",children:"Documentaci\xf3n financiera"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,n.jsx)("span",{className:"text-sm",children:"Asignaci\xf3n de recursos"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,n.jsxs)("span",{className:"text-sm",children:["Auditor\xeda completa (",f.length," eventos)"]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,n.jsxs)("span",{className:"text-sm",children:["Archivos adjuntos (",N.length," archivos, ",k.totalSizeMB,"MB)"]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,n.jsx)("span",{className:"text-sm",children:"Lecciones aprendidas"})]})]})]})]}),b&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Generando Expediente"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:"".concat(v,"%")}})}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 text-center",children:[v.toFixed(0),"% completado"]})]})]}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Archivar Proyecto"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:'Generar expediente completo y cambiar estado a "Archivado"'})]}),(0,n.jsx)("button",{onClick:async()=>{if(C){j(!0),y(0);try{const e=["Validando datos del proyecto...","Generando m\xe9tricas finales...","Compilando documentaci\xf3n...","Creando expediente...","Finalizando archivado..."];for(let s=0;s<e.length;s++)y(s/e.length*100),await new Promise(e=>setTimeout(e,500));const r={metadata:{archiveDate:(new Date).toISOString(),archiveVersion:"1.0.0",projectId:s.id,projectName:s.name,archiveType:"project-completion"},project:(0,a.A)((0,a.A)({},s),{},{archivedAt:(new Date).toISOString(),finalMetrics:P}),workPackages:t,risks:o,tasks:d,financial:{purchaseOrders:m,advances:x,invoices:u,contracts:g},resources:h,auditLog:f,files:N,summary:{totalDuration:Math.round((new Date(s.endDate)-new Date(s.startDate))/864e5),finalBudget:P.totalBudget,finalCost:P.totalActual,completionRate:P.completionPercentage,performanceIndex:P.cpi,lessonsLearned:D()}},l=JSON.stringify(r,null,2),n=new Blob([l],{type:"application/json"}),i=URL.createObjectURL(n),c=document.createElement("a");c.href=i,c.download="expediente-".concat(s.name.replace(/[^a-zA-Z0-9]/g,"-"),"-").concat((new Date).toISOString().split("T")[0],".json"),c.click(),URL.revokeObjectURL(i),y(100),p&&p(s.id,r)}catch(e){console.error("Error generando expediente:",e)}finally{j(!1)}}},disabled:!C||b,className:"\n              px-6 py-3 rounded-lg font-medium transition-colors\n              ".concat(C&&!b?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-300 text-gray-500 cursor-not-allowed","\n            "),children:b?"Generando...":"\ud83d\udcc1 Generar Expediente y Archivar"})]})})]}):(0,n.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,n.jsx)("div",{className:"text-4xl mb-4",children:"\ud83d\udcc1"}),(0,n.jsx)("div",{className:"text-lg mb-2",children:"Selecciona un proyecto para generar su expediente"})]})}}}]);
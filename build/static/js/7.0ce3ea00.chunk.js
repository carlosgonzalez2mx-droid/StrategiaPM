"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[7],{3007:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var s=a(9950),r=a(4414);const c=e=>{let{projects:t,workPackagesByProject:a,risksByProject:c,tasksByProject:o,purchaseOrdersByProject:i,advancesByProject:n,invoicesByProject:l,contractsByProject:d,globalResources:m,resourceAssignmentsByProject:u,viewMode:p,currentProjectId:x}=e;const[h,g]=(0,s.useState)([]),[b,j]=(0,s.useState)(!1);(0,s.useEffect)(()=>{y()},[]);const y=()=>{const e=localStorage.getItem("mi-dashboard-backups");if(e)try{g(JSON.parse(e))}catch(t){console.error("Error cargando backups:",t)}},v=e=>{localStorage.setItem("mi-dashboard-backups",JSON.stringify(e)),g(e)},k=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const s=(new Date).toISOString(),r={id:"backup-".concat(Date.now()),name:e?"Backup Autom\xe1tico - ".concat((new Date).toLocaleString()):"Backup Manual - ".concat((new Date).toLocaleString()),timestamp:s,data:{projects:t,currentProjectId:x,workPackagesByProject:a,risksByProject:c,tasksByProject:o,purchaseOrdersByProject:i,advancesByProject:n,invoicesByProject:l,contractsByProject:d,globalResources:m,resourceAssignmentsByProject:u,viewMode:p},size:JSON.stringify({projects:t,workPackagesByProject:a,risksByProject:c,tasksByProject:o,purchaseOrdersByProject:i,advancesByProject:n,invoicesByProject:l,contractsByProject:d,globalResources:m,resourceAssignmentsByProject:u}).length,isAutomatic:e},g="mi-dashboard-backup-".concat((new Date).toISOString().split("T")[0],"-").concat(Date.now(),".json"),b=JSON.stringify(r.data,null,2),j=new Blob([b],{type:"application/json"}),y=URL.createObjectURL(j),k=document.createElement("a");k.href=y,k.download=g,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(y);const w=[r,...h].slice(0,10);v(w);const f=new CustomEvent("backupCreated",{detail:{backupId:r.id,isAutomatic:e,timestamp:s,fileName:g}});return window.dispatchEvent(f),r},w=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]};return b?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udcbe Gesti\xf3n de Backups"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>k(!1),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"\ud83d\udce5 Crear Backup Manual"}),(0,r.jsx)("button",{onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{try{const a=JSON.parse(e.target.result);if(window.confirm("\xbfEst\xe1 seguro de importar este backup? Esto reemplazar\xe1 todos los datos actuales.")){const e=new CustomEvent("dataImport",{detail:{fileName:t.name,timestamp:(new Date).toISOString(),data:a}});window.dispatchEvent(e),alert('\u2705 Backup "'.concat(t.name,'" importado exitosamente. Recarga la p\xe1gina para ver los cambios.'))}}catch(a){alert("\u274c Error al importar el backup. Verifique que el archivo sea v\xe1lido."),console.error("Error importing backup:",a)}},e.readAsText(t)}},e.click()},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:"\ud83d\udce4 Importar Backup"}),(0,r.jsx)("button",{onClick:()=>j(!1),className:"bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"\u2715 Cerrar"})]})]}),(0,r.jsx)("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:0===h.length?(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"\ud83d\udcbe"}),(0,r.jsx)("div",{children:"No hay backups disponibles"}),(0,r.jsx)("div",{className:"text-sm mt-2",children:"Los backups autom\xe1ticos se crean cada 30 minutos"})]}):(0,r.jsx)("div",{className:"space-y-4",children:h.map(e=>{return(0,r.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-800",children:e.name}),e.isAutomatic&&(0,r.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Autom\xe1tico"})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[(0,r.jsxs)("div",{children:["\ud83d\udcc5 ",(t=e.timestamp,new Date(t).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}))]}),(0,r.jsxs)("div",{children:["\ud83d\udcca ",w(e.size)]}),(0,r.jsxs)("div",{children:["\ud83c\udd94 ",e.id]})]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>(e=>{const t=h.find(t=>t.id===e);if(t&&window.confirm('\xbfEst\xe1 seguro de restaurar el backup "'.concat(t.name,'"? Esto reemplazar\xe1 todos los datos actuales.'))){const{data:a}=t,s=new CustomEvent("dataRestore",{detail:{backupId:e,backupName:t.name,timestamp:(new Date).toISOString(),data:a}});window.dispatchEvent(s),alert('\u2705 Backup "'.concat(t.name,'" restaurado exitosamente. Recarga la p\xe1gina para ver los cambios.'))}})(e.id),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition-colors",title:"Restaurar este backup",children:"\ud83d\udd04 Restaurar"}),(0,r.jsx)("button",{onClick:()=>(e=>{if(window.confirm("\xbfEst\xe1 seguro de eliminar este backup?")){const t=h.filter(t=>t.id!==e);v(t)}})(e.id),className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors",title:"Eliminar este backup",children:"\ud83d\uddd1\ufe0f Eliminar"})]})]})},e.id);var t})})}),(0,r.jsx)("div",{className:"p-6 border-t bg-gray-50",children:(0,r.jsx)("div",{className:"text-sm text-gray-600",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("span",{children:["\ud83d\udcca Total de backups: ",h.length]}),(0,r.jsx)("span",{children:"\ud83d\udd04 Backups autom\xe1ticos cada 30 minutos"}),(0,r.jsx)("span",{children:"\ud83d\udcbe M\xe1ximo 10 backups guardados"})]})})})]})}):null}}}]);
"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[762],{3762:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var r=a(5043),n=a(9981),s=a(5016),o=a(8800),i=a(579);const c=e=>{let{children:t}=e;const{isAuthenticated:a,loading:c}=(0,s.As)(),[l,d]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0);(0,r.useEffect)(()=>{p()},[a]);const p=async()=>{if(!a)return d(!1),void m(!1);try{const e=await o.A.isSuperAdmin();d(e)}catch(e){console.error("Error verificando autorizaci\xf3n:",e),d(!1)}finally{m(!1)}};return c||u?(0,i.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto"}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"Verificando permisos..."})]})}):a?l?t:(0,i.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,i.jsxs)("div",{className:"text-center max-w-md",children:[(0,i.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udd12"}),(0,i.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Acceso Denegado"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"No tienes permisos de super-administrador para acceder a esta secci\xf3n."}),(0,i.jsx)("a",{href:"/",className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Volver al Dashboard"})]})}):(0,i.jsx)(n.C5,{to:"/login",replace:!0})}},8800:(e,t,a)=>{a.d(t,{A:()=>s});var r=a(9379),n=a(2416);const s=new class{async isSuperAdmin(){try{const e=n.default.getCurrentUser();if(!e)return!1;const{data:t}=await n.default.supabase.from("super_admins").select("id").eq("user_id",e.id).single();if(t)return!0;const{data:a}=await n.default.supabase.from("user_organization_roles").select("role").eq("user_id",e.id).eq("role","super_admin").single();return null!==a}catch(e){return console.error("Error verificando super-admin:",e),!1}}async listAllOrganizations(){try{const{data:e,error:t}=await n.default.supabase.from("organizations").select("\n          *,\n          members_count:organization_members(count),\n          projects_count:projects(count)\n        ").order("created_at",{ascending:!1});if(t)throw t;return{data:null===e||void 0===e?void 0:e.map(e=>{var t,a,n,s;return(0,r.A)((0,r.A)({},e),{},{member_count:(null===(t=e.members_count)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.count)||0,project_count:(null===(n=e.projects_count)||void 0===n||null===(s=n[0])||void 0===s?void 0:s.count)||0})}),error:null}}catch(e){return console.error("Error listando organizaciones:",e),{data:null,error:e}}}async getOrganizationDetails(e){try{const{data:t,error:a}=await n.default.supabase.from("organizations").select("\n          *,\n          members:organization_members(\n            id,\n            user_email,\n            user_id,\n            role,\n            status,\n            invited_at,\n            accepted_at,\n            created_at\n          ),\n          projects:projects(\n            id,\n            name,\n            status,\n            progress,\n            manager,\n            start_date,\n            end_date,\n            budget\n          )\n        ").eq("id",e).single();if(a)throw a;return{data:t,error:null}}catch(t){return console.error("Error obteniendo detalles:",t),{data:null,error:t}}}async getOrganizationMetrics(e){try{const[t,a,r,s]=await Promise.all([n.default.supabase.from("projects").select("id",{count:"exact",head:!0}).eq("organization_id",e),n.default.supabase.from("tasks").select("id",{count:"exact",head:!0}),n.default.supabase.from("organization_members").select("id",{count:"exact",head:!0}).eq("organization_id",e).eq("status","active"),n.default.supabase.from("risks").select("id",{count:"exact",head:!0})]);return{projectsCount:t.count||0,tasksCount:a.count||0,activeMembersCount:r.count||0,risksCount:s.count||0}}catch(t){return console.error("Error obteniendo m\xe9tricas:",t),{projectsCount:0,tasksCount:0,activeMembersCount:0,risksCount:0}}}async getGlobalStats(){try{var e;const{data:t,error:a}=await n.default.supabase.rpc("get_super_admin_stats");if(a&&"42883"!==a.code)throw a;if(t)return t;const[r,s,o,i]=await Promise.all([n.default.supabase.from("organizations").select("*"),n.default.supabase.from("projects").select("id",{count:"exact",head:!0}),n.default.supabase.from("tasks").select("id",{count:"exact",head:!0}),n.default.supabase.from("organization_members").select("id",{count:"exact",head:!0})]);return{total_organizations:(null===(e=r.data)||void 0===e?void 0:e.length)||0,total_projects:s.count||0,total_tasks:o.count||0,active_members:i.count||0,organizations_by_status:r.data||[]}}catch(t){return console.error("Error obteniendo estad\xedsticas globales:",t),{total_organizations:0,total_projects:0,total_tasks:0,active_members:0,organizations_by_status:[]}}}async updateOrganization(e,t){try{const{data:a,error:s}=await n.default.supabase.from("organizations").update((0,r.A)((0,r.A)({},t),{},{updated_at:(new Date).toISOString()})).eq("id",e).select().single();if(s)throw s;return{data:a,error:null}}catch(a){return console.error("Error actualizando organizaci\xf3n:",a),{data:null,error:a}}}async deleteOrganization(e){try{const{error:t}=await n.default.supabase.from("organizations").delete().eq("id",e);if(t)throw t;return{error:null}}catch(t){return console.error("Error eliminando organizaci\xf3n:",t),{error:t}}}}}}]);
//# sourceMappingURL=762.02bb8e24.chunk.js.map
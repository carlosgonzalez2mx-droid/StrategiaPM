"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[614],{6614:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var s=a(9950),n=a(7902),o=a(4414);const l=e=>{let{currentProjectId:t,currentProject:a,projects:l,workPackages:r,tasks:i,purchaseOrders:c,advances:d,invoices:m,contracts:x}=e;const h=(0,s.useMemo)(()=>Math.random().toString(36).substr(2,9),[]);console.log("\ud83d\udd0d CASHFLOW COMPONENT - INSTANCIA ".concat(h," INICIANDO:"),{currentProject:null===a||void 0===a?void 0:a.name,tasksCount:(null===i||void 0===i?void 0:i.length)||0,timestamp:(new Date).toISOString()}),console.log("\ud83d\udd0d CASHFLOW COMPONENT [".concat(h,"] - TAREAS RECIBIDAS:"),{totalTasks:(null===i||void 0===i?void 0:i.length)||0,tasksWithCosts:(null===i||void 0===i?void 0:i.filter(e=>e.cost>0).length)||0,tasksWithCostsDetails:(null===i||void 0===i?void 0:i.filter(e=>e.cost>0).map(e=>({id:e.id,name:e.name,cost:e.cost,startDate:e.startDate,endDate:e.endDate,isMilestone:e.isMilestone})))||[]});const[u,g]=(0,s.useState)("12"),[p,v]=(0,s.useState)((new Date).toISOString().split("T")[0]),[j,f]=(0,s.useState)(!1),[N,b]=(0,s.useState)({paymentTerms:"milestone",revenueRecognition:"percentage_completion"}),{addAuditEvent:D}=(0,n.A)(t);console.log("\ud83d\udd0d CASHFLOW DEBUG - currentProject recibido:",a),console.log("\ud83d\udd0d CASHFLOW DEBUG - currentProjectId:",t);const S=e=>{if(!a||!i)return console.log("\ud83d\udd0d CashFlow: No hay proyecto o tareas:",{currentProject:!!a,tasks:!!i}),0;const t=new Date(e.getFullYear(),e.getMonth(),1);t.setHours(0,0,0,0);const s=new Date(e.getFullYear(),e.getMonth()+1,0);if(s.setHours(23,59,59,999),console.log("\ud83d\udd0d CashFlow: Calculando gasto planificado para mes:",{month:e.toLocaleDateString("es-ES",{year:"numeric",month:"long"}),monthStart:t.toISOString().split("T")[0],monthEnd:s.toISOString().split("T")[0],totalTasks:i.length}),6===e.getMonth()&&2026===e.getFullYear()){console.log("\ud83d\udd0d DEBUG JULIO 2026 - AN\xc1LISIS COMPLETO DE TAREAS:"),console.log("\ud83d\udd0d Rango del mes julio 2026:",{monthStart:t.toISOString().split("T")[0],monthEnd:s.toISOString().split("T")[0]});let e=0,a=0,n=[];i.forEach((o,l)=>{if(o.cost&&o.cost>0){e+=o.cost;const r=new Date(o.startDate),i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0),c=new Date(o.endDate),d=new Date(c.getFullYear(),c.getMonth(),c.getDate(),23,59,59,999);let m=!1;m=o.isMilestone||0===o.duration?i>=t&&i<=s:i<=s&&d>=t,m?(a++,console.log("  \u2705 INCLUIDA - Tarea ".concat(l+1,":"),{name:o.name||o.title,cost:o.cost,startDate:o.startDate,endDate:o.endDate,isMilestone:o.isMilestone,duration:o.duration,taskStart:r.toISOString().split("T")[0],taskEnd:c.toISOString().split("T")[0]})):n.push({index:l+1,name:o.name||o.title,cost:o.cost,startDate:o.startDate,taskStart:r.toISOString().split("T")[0],isMilestone:o.isMilestone,razon:o.isMilestone?"Hito fuera del rango: ".concat(r.toISOString().split("T")[0]," no est\xe1 entre ").concat(t.toISOString().split("T")[0]," y ").concat(s.toISOString().split("T")[0]):"Tarea normal sin intersecci\xf3n: ".concat(r.toISOString().split("T")[0]," - ").concat(c.toISOString().split("T")[0]," no intersecta con ").concat(t.toISOString().split("T")[0]," - ").concat(s.toISOString().split("T")[0])})}}),console.log("\ud83d\udd0d JULIO 2026 - Resumen:",{totalTareas:i.length,tareasConCosto:i.filter(e=>e.cost>0).length,tareasEnJulio:a,costoTotalEsperado:e,costoPromedioPorTarea:e/i.filter(e=>e.cost>0).length}),console.log("\ud83d\udd0d JULIO 2026 - Tareas EXCLUIDAS (posibles causas del error):",n)}let n=0,o=0,l=0;return i.forEach((a,r)=>{if(console.log("\ud83d\udd0d CashFlow: Tarea ".concat(r+1,":"),{name:a.name||a.title,cost:a.cost,startDate:a.startDate,endDate:a.endDate,hasCost:!!a.cost,hasDates:!(!a.startDate||!a.endDate),isMilestone:a.isMilestone,duration:a.duration}),44===r){const n=e.toLocaleDateString("es-ES",{year:"numeric",month:"long"});console.log("\ud83d\udea8 DEBUG TAREA 45 ESPEC\xcdFICA:",{taskName:a.name||a.title,taskCost:a.cost,taskStartDate:a.startDate,taskEndDate:a.endDate,isMilestone:a.isMilestone,duration:a.duration,monthStart:t.toISOString().split("T")[0],monthEnd:s.toISOString().split("T")[0],monthName:n}),"agosto de 2026"===n&&a.cost>0&&console.log("\ud83d\udd0d CASHFLOW [".concat(h,"] - TAREA CON COSTO EN AGOSTO 2026:"),{taskIndex:r,taskId:a.id,taskName:a.name,taskCost:a.cost,taskStartDate:a.startDate,taskEndDate:a.endDate,isMilestone:a.isMilestone,duration:a.duration,monthName:n,monthStart:t.toISOString().split("T")[0],monthEnd:s.toISOString().split("T")[0]})}if(a.cost&&a.startDate&&a.endDate){o++;const i=new Date(a.startDate),c=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),d=new Date(a.endDate),m=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59,999),x=e.toLocaleDateString("es-ES",{year:"numeric",month:"long"});("julio de 2026"===x||"agosto de 2026"===x)&&a.cost>0&&console.log("\ud83d\udd0d CASHFLOW [".concat(h,"] - TAREA CON COSTO EN ").concat(x.toUpperCase(),":"),{taskIndex:r,taskId:a.id,taskName:a.name,taskCost:a.cost,taskStartDate:a.startDate,taskEndDate:a.endDate,isMilestone:a.isMilestone,duration:a.duration,monthName:x,monthStart:t.toISOString().split("T")[0],monthEnd:s.toISOString().split("T")[0]});let u=!1;if(a.isMilestone||0===a.duration?(u=c>=t&&c<=s,a.cost>0&&("julio de 2026"===x||"agosto de 2026"===x)&&console.log("\ud83c\udfaf DEBUG HITO [".concat(h,"] - Verificaci\xf3n de mes:"),{taskName:a.name||a.title,taskStartDate:a.startDate,taskStart:i.toISOString().split("T")[0],monthStart:t.toISOString().split("T")[0],monthEnd:s.toISOString().split("T")[0],isInMonth:u,monthName:x,comparison:{taskStartGreaterEqualMonthStart:c>=t,taskStartLessEqualMonthEnd:c<=s,taskStartTime:c.getTime(),monthStartTime:t.getTime(),monthEndTime:s.getTime()}})):u=c<=s&&m>=t,u)if(l++,a.isMilestone||0===a.duration){const e=a.cost||0;n+=e,console.log('\ud83d\udcb0 CashFlow: HITO "'.concat(a.name||a.title,'" en mes:'),{taskCost:a.cost,isMilestone:!0,startDate:a.startDate,endDate:a.endDate,costInMonth:e.toFixed(2)}),a.cost&&a.cost>3e5&&console.log("\ud83d\udea8 DEBUG HITO PROBLEM\xc1TICO:",{taskName:a.name||a.title,taskCost:a.cost,taskStartDate:a.startDate,taskEndDate:a.endDate,monthStart:t.toISOString().split("T")[0],monthEnd:s.toISOString().split("T")[0],isInMonth:c<=s&&m>=t,plannedExpenseBefore:n-e,plannedExpenseAfter:n})}else{const e=m-c+1,o=new Date(Math.max(c.getTime(),t.getTime())),l=new Date(Math.min(m.getTime(),s.getTime()))-o+1;if(l>0){const t=l/e,s=(a.cost||0)*t;n+=s,console.log('\ud83d\udcb0 CashFlow: Tarea "'.concat(a.name||a.title,'" en mes:'),{taskCost:a.cost,percentageInMonth:(100*t).toFixed(1)+"%",costInMonth:s.toFixed(2)})}}}}),console.log("\ud83d\udd0d CashFlow: Resumen del mes:",{totalTasks:i.length,tasksWithCosts:o,tasksInMonth:l,plannedExpense:n.toFixed(2)}),6===e.getMonth()&&2026===e.getFullYear()&&console.log("\ud83c\udfaf JULIO 2026 - VALOR FINAL CALCULADO:",{plannedExpense:n,plannedExpenseFixed:n.toFixed(3),valorEsperadoPorUsuario:385953.528,diferencia:n-385953.528,porcentajeDelEsperado:(n/385953.528*100).toFixed(2)+"%"}),n},y=(e,t)=>{if(!a)return 0;console.log("\ud83d\udd0d CASHFLOW PROJECTION - calculateMonthCommittedExpense iniciando:",{monthDate:e.toISOString().substring(0,7),purchaseOrdersLength:(null===c||void 0===c?void 0:c.length)||0,purchaseOrders:c});const s=(null===c||void 0===c?void 0:c.filter(e=>"approved"===e.status))||[];console.log("\ud83d\udd0d CASHFLOW PROJECTION - \xd3rdenes de compra aprobadas:",s.map(e=>({id:e.id,number:e.number,status:e.status,totalAmount:e.totalAmount,approvalDate:e.approvalDate,requestDate:e.requestDate,hasApprovalDate:!(!e.approvalDate||""===e.approvalDate.trim()),hasRequestDate:!(!e.requestDate||""===e.requestDate.trim())})));let n=0;const o=new Date(e.getFullYear(),e.getMonth(),1);o.setHours(0,0,0,0);const l=new Date(e.getFullYear(),e.getMonth()+1,0);l.setHours(23,59,59,999),console.log("\ud83d\udd0d CASHFLOW PROJECTION - Rango de fechas:",{monthStart:o.toISOString().split("T")[0],monthEnd:l.toISOString().split("T")[0]});const r=(null===c||void 0===c?void 0:c.filter(e=>{if("approved"!==e.status)return!1;if(!e.approvalDate||""===e.approvalDate.trim())return console.log("\u26a0\ufe0f CASHFLOW PROJECTION - OC sin fecha de aprobaci\xf3n:",{id:e.id,number:e.number,status:e.status,totalAmount:e.totalAmount,approvalDate:e.approvalDate}),!1;const a=new Date(e.approvalDate+"T00:00:00"),s=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),n=new Date(s);n.setDate(s.getDate()+t),n.setHours(0,0,0,0);const r=n>=o&&n<=l;return console.log("\ud83d\udd0d CASHFLOW PROJECTION - Evaluando OC:",{id:e.id,number:e.number,approvalDate:e.approvalDate,approvalDateParsed:a.toISOString().split("T")[0],adjustedDate:n.toISOString().split("T")[0],monthStart:o.toISOString().split("T")[0],monthEnd:l.toISOString().split("T")[0],daysToPayment:t,status:e.status,totalAmount:e.totalAmount,isInMonth:r,willInclude:r}),r}))||[];return n+=r.reduce((e,t)=>(console.log("\u2705 CASHFLOW PROJECTION - INCLUYENDO OC ".concat(t.number,": $").concat(t.totalAmount)),e+(t.totalAmount||0)),0),console.log("\ud83d\udd0d CASHFLOW PROJECTION - Resultado final:",{monthPOsCount:r.length,committedExpense:n}),n},O=e=>{if(!a)return 0;let t=0;const s=new Date(e.getFullYear(),e.getMonth(),1);s.setHours(0,0,0,0);const n=new Date(e.getFullYear(),e.getMonth()+1,0);n.setHours(23,59,59,999);t+=((null===d||void 0===d?void 0:d.filter(e=>{if("paid"!==e.status)return!1;const t=new Date(e.paymentDate||e.date),a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0);return a>=s&&a<=n}))||[]).reduce((e,t)=>e+(t.amount||0),0);return t+=((null===m||void 0===m?void 0:m.filter(e=>{if("paid"!==e.status)return!1;const t=new Date(e.paymentDate||e.date),a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0);return a>=s&&a<=n}))||[]).reduce((e,t)=>e+(t.amount||0),0),t},C=(0,s.useMemo)(()=>Date.now(),[a,i,u,p]),w=(0,s.useMemo)(()=>{if(!a)return null;console.log("\ud83d\udd04 CASHFLOW PROJECTION [".concat(h,"] - FORZANDO REC\xc1LCULO COMPLETO:"),{currentProject:null===a||void 0===a?void 0:a.name,projectionPeriod:u,projectionStartDate:p,purchaseOrders:(null===c||void 0===c?void 0:c.length)||0,advances:(null===d||void 0===d?void 0:d.length)||0,invoices:(null===m||void 0===m?void 0:m.length)||0,tasks:(null===i||void 0===i?void 0:i.length)||0,forceRecalculation:C,timestamp:(new Date).toISOString()});const e=new Date(p),t=parseInt(u),s=[],n={net30:30,net60:60,net90:90,advance:-15,milestone:0}[N.paymentTerms];console.log("\ud83d\udd0d CASHFLOW PROJECTION - CONFIGURACI\xd3N COMPLETA:",{startDate:e.toISOString().split("T")[0],months:t,projectionStartDate:p,projectionPeriod:u,currentProject:null===a||void 0===a?void 0:a.name});for(let a=0;a<t;a++){const t=new Date(e.getFullYear(),e.getMonth()+a,1),o=t.toISOString().slice(0,7),l=t.toLocaleDateString("es-ES",{year:"numeric",month:"long"});console.log("\ud83d\udd0d CASHFLOW PROJECTION - Procesando mes ".concat(a+1,": ").concat(o," (").concat(l,")")),"2026-07"===o&&console.log("\ud83c\udfaf JULIO 2026 DETECTADO - Iniciando c\xe1lculo detallado...");const r=S(t);console.log("\ud83d\udd0d CASHFLOW PROJECTION [".concat(h,"] - RESULTADO calculateMonthPlannedExpense para ").concat(o,": $").concat(r)),console.log("\ud83d\udd0d CASHFLOW PROJECTION - LLAMANDO calculateMonthCommittedExpense para mes ".concat(o));const i=y(t,n);console.log("\ud83d\udd0d CASHFLOW PROJECTION - RESULTADO calculateMonthCommittedExpense: $".concat(i));const c=O(t),d={month:a+1,monthKey:o,monthLabel:l,date:t,revenue:r,expenses:i,realExpenses:c,netCashFlow:r-c,cumulativeBalance:(a>0?s[a-1].cumulativeBalance:0)+r,cashIn:r,cashOut:c};"2026-07"!==o&&"2026-08"!==o||console.log("\ud83d\udd0d CASHFLOW PROJECTION [".concat(h,"] - ASIGNANDO VALORES para ").concat(o,":"),{monthPlannedExpense:r,revenue:d.revenue,monthLabel:d.monthLabel,monthKey:d.monthKey}),s.push(d)}return console.log("\ud83d\udd0d CASHFLOW PROJECTION [".concat(h,"] - PROYECCI\xd3N FINAL COMPLETA:"),{totalMonths:s.length,julio2026:s.find(e=>"2026-07"===e.monthKey),agosto2026:s.find(e=>"2026-08"===e.monthKey),timestamp:(new Date).toISOString()}),s},[a,u,p,N,c,d,m,x,i,C]),I=(0,s.useMemo)(()=>{if(!w)return null;const e=w.reduce((e,t)=>e+t.revenue,0),t=w.reduce((e,t)=>e+t.expenses,0),a=w.reduce((e,t)=>e+t.realExpenses,0);return{totalRevenue:e,totalPlannedExpense:e,totalCommittedExpenses:t,totalRealExpenses:a,totalExpenses:t,totalNetCashFlow:e-a,maxCashOutflow:Math.min(...w.map(e=>e.cumulativeBalance)),maxCashInflow:Math.max(...w.map(e=>e.cumulativeBalance)),positiveMonths:w.filter(e=>e.netCashFlow>0).length,negativeMonths:w.filter(e=>e.netCashFlow<0).length,averageMonthlyRevenue:e/w.length,averageMonthlyExpenses:t/w.length,averageMonthlyRealExpenses:a/w.length,projectDuration:w.length}},[w]),E=e=>{if(null===e||void 0===e||isNaN(e))return"$0,00";const t=new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:3}).format(e);return"$".concat(t)},T=e=>e>0?"text-green-600":e<0?"text-red-600":"text-gray-600",F=e=>e>0?"text-green-700":e<0?"text-red-700":"text-gray-700";return a?(0,o.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,o.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,o.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-100 rounded-2xl shadow-lg p-8 mb-8 text-gray-800 relative overflow-hidden",children:[(0,o.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-green-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,o.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-emerald-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,o.jsx)("div",{className:"relative z-10",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,o.jsx)("span",{className:"text-3xl",children:"\ud83d\udcb0"})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-4xl font-bold mb-3 text-gray-800",children:"Proyecci\xf3n de Flujo de Caja"}),(0,o.jsx)("p",{className:"text-gray-600 text-lg",children:"An\xe1lisis financiero del proyecto seg\xfan PMBOK v7 - Gesti\xf3n de Costos"}),(0,o.jsxs)("div",{className:"mt-4 flex items-center space-x-6 text-sm text-gray-700",children:[(0,o.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,o.jsx)("span",{className:"text-gray-500",children:"\ud83d\udcca"}),(0,o.jsxs)("span",{children:["Proyecto: ",a.name]})]}),(0,o.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,o.jsx)("span",{className:"text-gray-500",children:"\ud83d\udcc5"}),(0,o.jsxs)("span",{children:["Per\xedodo: ",u," meses"]})]}),(0,o.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,o.jsx)("span",{className:"text-gray-500",children:"\ud83d\udcb5"}),(0,o.jsxs)("span",{children:["Presupuesto: $",(a.budget/1e3).toFixed(0),"K"]})]}),(0,o.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,o.jsx)("span",{className:"text-gray-500",children:"\ud83d\udee1\ufe0f"}),(0,o.jsxs)("span",{children:["Reserva: $",((a.contingencyReserve+a.managementReserve)/1e3).toFixed(0),"K"]})]})]})]})]}),(0,o.jsx)("div",{className:"flex items-center space-x-4",children:(0,o.jsx)("button",{onClick:()=>{if(!w)return;const e=[["Mes","Gasto Planificado","Gasto Comprometido (OCs)","Gasto Real","Saldo Acumulado"],...w.map(e=>[e.monthLabel,E(e.revenue),E(e.expenses),E(e.realExpenses),E(e.cumulativeBalance)])].map(e=>e.join(",")).join("\n"),s=new Blob([e],{type:"text/csv"}),n=window.URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download="proyeccion-flujo-caja-".concat((null===a||void 0===a?void 0:a.name)||"proyecto",".csv"),o.click(),window.URL.revokeObjectURL(n),D("cash_flow","projection_exported",{projectId:t,period:u,startDate:p})},className:"px-6 py-3 bg-white text-green-700 rounded-xl hover:bg-green-50 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1 font-semibold border border-green-200",children:"\ud83d\udcca Exportar"})})]})})]}),I&&(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,o.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-orange-500",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:E(I.totalRevenue)}),(0,o.jsx)("div",{className:"text-sm text-gray-600",children:"Gasto Planificado Total"})]}),(0,o.jsx)("div",{className:"p-3 bg-orange-100 rounded-lg",children:(0,o.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"})})]})}),(0,o.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-red-500",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:E(I.totalExpenses)}),(0,o.jsx)("div",{className:"text-sm text-gray-600",children:"Gastos Totales"})]}),(0,o.jsx)("div",{className:"p-3 bg-red-100 rounded-lg",children:(0,o.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc9"})})]})}),(0,o.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-blue-500",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-2xl font-bold ".concat(T(I.totalNetCashFlow)),children:E(I.totalNetCashFlow)}),(0,o.jsx)("div",{className:"text-sm text-gray-600",children:"Flujo Neto"})]}),(0,o.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,o.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"})})]})}),(0,o.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-purple-500",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-2xl font-bold ".concat(F(I.maxCashOutflow)),children:E(I.maxCashOutflow)}),(0,o.jsx)("div",{className:"text-sm text-gray-600",children:"M\xe1ximo D\xe9ficit"})]}),(0,o.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg",children:(0,o.jsx)("span",{className:"text-2xl",children:"\u26a0\ufe0f"})})]})})]}),(0,o.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-8",children:(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcc5 Per\xedodo de Proyecci\xf3n (meses)"}),(0,o.jsxs)("select",{value:u,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",children:[(0,o.jsx)("option",{value:"6",children:"6 meses"}),(0,o.jsx)("option",{value:"12",children:"12 meses"}),(0,o.jsx)("option",{value:"18",children:"18 meses"}),(0,o.jsx)("option",{value:"24",children:"24 meses"}),(0,o.jsx)("option",{value:"36",children:"36 meses"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\ude80 Fecha de Inicio"}),(0,o.jsx)("input",{type:"date",value:p,onChange:e=>v(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors"})]}),(0,o.jsx)("div",{className:"flex items-end",children:(0,o.jsx)("button",{onClick:()=>f(!0),className:"w-full px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl hover:from-green-700 hover:to-emerald-700 transition-all duration-200 shadow-sm hover:shadow-md",children:"\u2699\ufe0f Configuraci\xf3n Avanzada"})})]})}),w&&(0,o.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[(0,o.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,o.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\ud83d\udcca Proyecci\xf3n Mensual de Flujo de Caja"})}),(0,o.jsx)("div",{className:"overflow-x-auto",children:(0,o.jsxs)("table",{className:"w-full",children:[(0,o.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mes"}),(0,o.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gasto Planificado"}),(0,o.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gasto Comprometido (OCs)"}),(0,o.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gasto Real"}),(0,o.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Saldo Acumulado"}),(0,o.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"})]})}),(0,o.jsx)("tbody",{className:"divide-y divide-gray-100",children:w.map(e=>("2026-07"!==e.monthKey&&"2026-08"!==e.monthKey||console.log("\ud83d\udd0d CASHFLOW RENDER [".concat(h,"] - RENDERIZANDO ").concat(e.monthKey,":"),{monthLabel:e.monthLabel,revenue:e.revenue,formattedRevenue:E(e.revenue),monthObject:e}),(0,o.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,o.jsxs)("td",{className:"px-6 py-4",children:[(0,o.jsx)("div",{className:"font-medium text-gray-900",children:e.monthLabel}),(0,o.jsxs)("div",{className:"text-sm text-gray-500",children:["Mes ",e.month]})]}),(0,o.jsx)("td",{className:"px-6 py-4",children:(0,o.jsx)("div",{className:"text-orange-600 font-medium",children:E(e.revenue)})}),(0,o.jsx)("td",{className:"px-6 py-4",children:(0,o.jsx)("div",{className:"text-blue-600 font-medium",children:E(e.expenses)})}),(0,o.jsx)("td",{className:"px-6 py-4",children:(0,o.jsx)("div",{className:"text-red-600 font-medium",children:E(e.realExpenses)})}),(0,o.jsx)("td",{className:"px-6 py-4",children:(0,o.jsx)("div",{className:"font-medium ".concat(F(e.cumulativeBalance)),children:E(e.cumulativeBalance)})}),(0,o.jsx)("td",{className:"px-6 py-4",children:(0,o.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(e.cumulativeBalance>0?"bg-green-100 text-green-800":e.cumulativeBalance<0?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.cumulativeBalance>0?"\u2705 Positivo":e.cumulativeBalance<0?"\u26a0\ufe0f D\xe9ficit":"\u2696\ufe0f Equilibrio"})})]},e.month)))})]})})]}),w&&(0,o.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 mt-8",children:[(0,o.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-6",children:"\ud83d\udcc8 Gr\xe1fico de Flujo de Caja"}),(0,o.jsxs)("div",{className:"mb-8",children:[(0,o.jsx)("h4",{className:"text-md font-medium text-gray-700 mb-4",children:"\ud83d\udcb0 Flujo Neto Mensual"}),(0,o.jsx)("div",{className:"h-48 flex items-end justify-between space-x-2",children:w.map(e=>{const t=Math.max(...w.map(e=>Math.abs(e.netCashFlow)));let a=0;return t>0&&(a=Math.abs(e.netCashFlow)/t*192),0===e.netCashFlow&&(a=2),(0,o.jsxs)("div",{className:"flex-1 flex flex-col items-center",children:[(0,o.jsx)("div",{className:"text-xs text-gray-500 mb-2 text-center",children:e.monthLabel.slice(0,3)}),(0,o.jsx)("div",{className:"w-full rounded-t transition-all duration-300 ".concat(e.netCashFlow>0?"bg-green-500":e.netCashFlow<0?"bg-red-500":"bg-gray-400"),style:{height:"".concat(a,"px")}}),(0,o.jsx)("div",{className:"text-xs font-medium mt-1 ".concat(T(e.netCashFlow)),children:E(e.netCashFlow)})]},"net-".concat(e.month))})})]}),(0,o.jsxs)("div",{className:"mb-8",children:[(0,o.jsx)("h4",{className:"text-md font-medium text-gray-700 mb-4",children:"\ud83d\udcca Saldo Acumulado (L\xednea de Tiempo)"}),(0,o.jsxs)("div",{className:"h-48 relative",children:[(0,o.jsxs)("svg",{className:"w-full h-full",viewBox:"0 0 ".concat(100*w.length," 200"),children:[(0,o.jsx)("line",{x1:"0",y1:"100",x2:100*w.length,y2:"100",stroke:"#e5e7eb",strokeWidth:"1",strokeDasharray:"5,5"}),(()=>{const e=Math.min(...w.map(e=>e.cumulativeBalance)),t=Math.max(...w.map(e=>e.cumulativeBalance))-e,a=w.map((a,s)=>{const n=200-180*(t>0?(a.cumulativeBalance-e)/t:.5);return"".concat(100*s+50,",").concat(n)}).join(" ");return(0,o.jsx)("polyline",{points:a,fill:"none",stroke:"#3b82f6",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})(),(()=>{const e=Math.min(...w.map(e=>e.cumulativeBalance)),t=Math.max(...w.map(e=>e.cumulativeBalance))-e;return w.map((a,s)=>{const n=200-180*(t>0?(a.cumulativeBalance-e)/t:.5);return(0,o.jsx)("circle",{cx:100*s+50,cy:n,r:"4",fill:a.cumulativeBalance>0?"#10b981":a.cumulativeBalance<0?"#ef4444":"#6b7280",stroke:"white",strokeWidth:"2"},"point-".concat(a.month))})})()]}),(0,o.jsx)("div",{className:"absolute bottom-0 left-0 right-0 flex justify-between px-4",children:w.map(e=>(0,o.jsx)("div",{className:"text-xs text-gray-500",children:e.monthLabel.slice(0,3)},"label-".concat(e.month)))})]})]})]})]}),j&&(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,o.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:(0,o.jsxs)("div",{className:"p-8",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,o.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"\u2699\ufe0f Configuraci\xf3n de Proyecci\xf3n"}),(0,o.jsx)("button",{onClick:()=>f(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:"\u2715"})]}),(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcca T\xe9rminos de Pago para \xd3rdenes de Compra"}),(0,o.jsxs)("select",{value:N.paymentTerms,onChange:e=>b({projectId:N.projectId,startDate:N.startDate,endDate:N.endDate,paymentTerms:e.target.value,revenueRecognition:N.revenueRecognition,expenseTiming:N.expenseTiming,cashFlowBuffer:N.cashFlowBuffer}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",children:[(0,o.jsx)("option",{value:"net30",children:"Net 30 d\xedas"}),(0,o.jsx)("option",{value:"net60",children:"Net 60 d\xedas"}),(0,o.jsx)("option",{value:"net90",children:"Net 90 d\xedas"}),(0,o.jsx)("option",{value:"advance",children:"Anticipado (15 d\xedas antes)"}),(0,o.jsx)("option",{value:"milestone",children:"Por hitos"})]}),(0,o.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Define cu\xe1ndo se registran los gastos de las \xf3rdenes de compra en el flujo de caja"}),(0,o.jsxs)("div",{className:"text-xs text-gray-400 mt-2 space-y-1",children:[(0,o.jsxs)("div",{children:["\u2022 ",(0,o.jsx)("strong",{children:"Por hitos:"})," Usa la fecha de aprobaci\xf3n directamente"]}),(0,o.jsxs)("div",{children:["\u2022 ",(0,o.jsx)("strong",{children:"Net 30/60/90:"})," Fecha de aprobaci\xf3n + d\xedas de pago"]}),(0,o.jsxs)("div",{children:["\u2022 ",(0,o.jsx)("strong",{children:"Anticipado:"})," Fecha de aprobaci\xf3n - 15 d\xedas"]})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcc8 Reconocimiento de Ingresos"}),(0,o.jsxs)("select",{value:N.revenueRecognition,onChange:e=>b({projectId:N.projectId,startDate:N.startDate,endDate:N.endDate,paymentTerms:N.paymentTerms,revenueRecognition:e.target.value,expenseTiming:N.expenseTiming,cashFlowBuffer:N.cashFlowBuffer}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",children:[(0,o.jsx)("option",{value:"uniform",children:"Distribuci\xf3n Uniforme"}),(0,o.jsx)("option",{value:"percentage_completion",children:"Por Progreso del Proyecto"})]}),(0,o.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"C\xf3mo se distribuye el presupuesto del proyecto a lo largo del tiempo"})]})]}),(0,o.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t mt-8",children:[(0,o.jsx)("button",{onClick:()=>f(!1),className:"px-6 py-3 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-xl transition-colors font-medium",children:"Cancelar"}),(0,o.jsx)("button",{onClick:()=>f(!1),className:"px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl hover:from-green-700 hover:to-emerald-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl",children:"\ud83d\udcbe Guardar Configuraci\xf3n"})]})]})})})]}):(0,o.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,o.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,o.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-12 text-center",children:[(0,o.jsx)("div",{className:"text-6xl mb-6",children:"\ud83d\udcb0"}),(0,o.jsx)("div",{className:"text-2xl font-bold text-gray-700 mb-2",children:"Proyecto no seleccionado"}),(0,o.jsx)("div",{className:"text-gray-500",children:"Selecciona un proyecto para ver la proyecci\xf3n de flujo de caja"})]})})})}}}]);
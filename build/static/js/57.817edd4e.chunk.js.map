{"version":3,"file":"static/js/57.817edd4e.chunk.js","mappings":"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","sources":["components/subscription/UpgradeModal.js"],"sourcesContent":["import React, { useState } from 'react';\nimport './UpgradeModal.css';\nimport subscriptionService from '../../services/SubscriptionService';\nimport { createClient } from '@supabase/supabase-js';\n\n// Inicializar Supabase client\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL;\nconst supabaseAnonKey = process.env.REACT_APP_SUPABASE_ANON_KEY;\nconst supabase = supabaseUrl && supabaseAnonKey ? createClient(supabaseUrl, supabaseAnonKey) : null;\n\n// IMPORTANTE: Este es tu Price ID de Stripe\n// Debes reemplazarlo con el real despu√©s de crear el producto en Stripe Dashboard\nconst STRIPE_PRICE_ID = process.env.REACT_APP_STRIPE_PRICE_ID || 'price_XXXXXX';\n\nconst UpgradeModal = ({\n  isOpen,\n  onClose,\n  limitType = 'project', // 'project' or 'user'\n  currentPlan = 'free',\n  currentCount = 0,\n  maxCount = 0,\n  organizationId = null,\n  onUpgradeSuccess = null\n}) => {\n  const [isUpgrading, setIsUpgrading] = useState(false);\n  const [paymentMode, setPaymentMode] = useState('stripe'); // 'stripe' or 'simulation'\n\n  if (!isOpen) return null;\n\n  const messages = {\n    project: {\n      title: '¬°Alcanzaste el l√≠mite de proyectos!',\n      current: `Tienes ${currentCount} de ${maxCount} proyectos`,\n      benefit: 'Proyectos ilimitados'\n    },\n    user: {\n      title: '¬°Alcanzaste el l√≠mite de usuarios!',\n      current: `Tienes ${currentCount} de ${maxCount} usuarios`,\n      benefit: 'Usuarios ilimitados'\n    }\n  };\n\n  const message = messages[limitType] || messages.project;\n\n  // Funci√≥n para crear sesi√≥n de Stripe Checkout\n  const handleStripeCheckout = async () => {\n    if (!organizationId) {\n      alert('‚ùå Error: No se pudo identificar la organizaci√≥n. Intenta recargar la p√°gina.');\n      return;\n    }\n\n    if (!supabase) {\n      alert('‚ùå Error: Supabase no est√° configurado correctamente.');\n      return;\n    }\n\n    setIsUpgrading(true);\n\n    try {\n      // Obtener el usuario actual de Supabase\n      const { data: { user } } = await supabase.auth.getUser();\n      const userEmail = user?.email || 'noemail@example.com';\n\n      // Obtener informaci√≥n de la organizaci√≥n desde localStorage\n      const portfolioData = localStorage.getItem('strategiapm_portfolio_data');\n      let organizationName = 'Organization';\n\n      if (portfolioData) {\n        const portfolio = JSON.parse(portfolioData);\n        organizationName = portfolio?.organization?.name || organizationName;\n      }\n\n      console.log('[UpgradeModal] Creando sesi√≥n de checkout para:', {\n        organizationId,\n        organizationName,\n        userEmail\n      });\n\n      // Llamar a la Edge Function para crear sesi√≥n de checkout\n      const { data, error } = await supabase.functions.invoke('create-checkout-session', {\n        body: {\n          organizationId,\n          organizationName,\n          userEmail,\n          priceId: STRIPE_PRICE_ID,\n          plan: 'professional'\n        }\n      });\n\n      if (error) {\n        throw new Error(error.message || 'Error al crear sesi√≥n de checkout');\n      }\n\n      if (!data || !data.url) {\n        throw new Error('No se recibi√≥ URL de checkout de Stripe');\n      }\n\n      console.log('[UpgradeModal] Sesi√≥n creada, redirigiendo a Stripe...');\n\n      // Redirigir a Stripe Checkout\n      window.location.href = data.url;\n\n    } catch (error) {\n      console.error('[UpgradeModal] Error en checkout:', error);\n      alert(`‚ùå Error al procesar el pago: ${error.message}\\n\\nPor favor intenta de nuevo o contacta con soporte.`);\n      setIsUpgrading(false);\n    }\n  };\n\n  // Funci√≥n para simulaci√≥n (desarrollo/testing)\n  const handleSimulatedUpgrade = async () => {\n    if (!organizationId) {\n      alert('‚ùå Error: No se pudo identificar la organizaci√≥n. Intenta recargar la p√°gina.');\n      return;\n    }\n\n    // Confirmar con el usuario\n    const confirmMessage = '‚ö†Ô∏è MODO SIMULACI√ìN (Solo para desarrollo)\\n\\n¬øConfirmas que deseas actualizar al Plan Professional?\\n\\nüìä Beneficios:\\n‚Ä¢ Proyectos ilimitados\\n‚Ä¢ Usuarios ilimitados\\n‚Ä¢ Soporte prioritario\\n‚Ä¢ Reportes avanzados\\n\\nNOTA: Esto es una simulaci√≥n SIN PAGO REAL.\\n\\n¬øContinuar?';\n\n    if (!window.confirm(confirmMessage)) {\n      return;\n    }\n\n    setIsUpgrading(true);\n\n    try {\n      // Obtener el usuario actual desde localStorage\n      const portfolioData = localStorage.getItem('strategiapm_portfolio_data');\n      let userId = null;\n\n      if (portfolioData) {\n        const portfolio = JSON.parse(portfolioData);\n        userId = portfolio?.user?.id;\n      }\n\n      // Cambiar plan usando el servicio\n      const result = await subscriptionService.changePlan(organizationId, 'professional', userId);\n\n      if (result.success) {\n        alert('‚úÖ ¬°Plan actualizado exitosamente a Professional!\\n\\nBeneficios activados:\\n‚Ä¢ Proyectos ilimitados ‚úì\\n‚Ä¢ Usuarios ilimitados ‚úì\\n‚Ä¢ Soporte prioritario ‚úì\\n\\nüîÑ Recarga la p√°gina para ver los cambios reflejados.');\n\n        // Llamar callback si existe\n        if (onUpgradeSuccess) {\n          onUpgradeSuccess();\n        }\n\n        // Cerrar modal\n        onClose();\n\n        // Recargar la p√°gina despu√©s de 2 segundos\n        setTimeout(() => {\n          window.location.reload();\n        }, 2000);\n      } else {\n        throw new Error(result.error || 'Error desconocido');\n      }\n    } catch (error) {\n      console.error('Error actualizando plan:', error);\n      alert(`‚ùå Error al actualizar el plan: ${error.message}\\n\\nPor favor intenta de nuevo o contacta con soporte.`);\n    } finally {\n      setIsUpgrading(false);\n    }\n  };\n\n  // Funci√≥n principal que decide qu√© m√©todo usar\n  const handleUpgrade = () => {\n    if (paymentMode === 'stripe') {\n      handleStripeCheckout();\n    } else {\n      handleSimulatedUpgrade();\n    }\n  };\n\n  return (\n    <div className=\"upgrade-modal-overlay\" onClick={onClose}>\n      <div className=\"upgrade-modal-content\" onClick={(e) => e.stopPropagation()}>\n        <button className=\"upgrade-modal-close\" onClick={onClose}>√ó</button>\n\n        <div className=\"upgrade-modal-icon\">\n          <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" fill=\"none\">\n            <circle cx=\"32\" cy=\"32\" r=\"30\" fill=\"#FEF3C7\" />\n            <path d=\"M32 16L38 28H26L32 16Z\" fill=\"#F59E0B\" />\n            <circle cx=\"32\" cy=\"36\" r=\"2\" fill=\"#F59E0B\" />\n            <rect x=\"30\" y=\"42\" width=\"4\" height=\"8\" rx=\"2\" fill=\"#F59E0B\" />\n          </svg>\n        </div>\n\n        <h2 className=\"upgrade-modal-title\">{message.title}</h2>\n        <p className=\"upgrade-modal-subtitle\">{message.current}</p>\n\n        <div className=\"upgrade-plans-comparison\">\n          {/* Plan Actual */}\n          <div className=\"upgrade-plan-card upgrade-plan-current\">\n            <div className=\"upgrade-plan-header\">\n              <h3>Plan Free</h3>\n              <span className=\"upgrade-plan-badge\">Plan Actual</span>\n            </div>\n            <div className=\"upgrade-plan-price\">$0<span>/mes</span></div>\n            <ul className=\"upgrade-plan-features\">\n              <li className=\"upgrade-feature-limited\">\n                <span className=\"upgrade-feature-icon\">üìä</span>\n                <span>1 proyecto</span>\n              </li>\n              <li className=\"upgrade-feature-limited\">\n                <span className=\"upgrade-feature-icon\">üë•</span>\n                <span>3 usuarios</span>\n              </li>\n              <li className=\"upgrade-feature-included\">\n                <span className=\"upgrade-feature-icon\">‚úì</span>\n                <span>Todas las funciones b√°sicas</span>\n              </li>\n            </ul>\n          </div>\n\n          {/* Plan Professional */}\n          <div className=\"upgrade-plan-card upgrade-plan-recommended\">\n            <div className=\"upgrade-plan-header\">\n              <h3>Plan Professional</h3>\n              <span className=\"upgrade-plan-badge upgrade-plan-badge-pro\">Recomendado</span>\n            </div>\n            <div className=\"upgrade-plan-price\">$39<span>/mes</span></div>\n            <ul className=\"upgrade-plan-features\">\n              <li className=\"upgrade-feature-included\">\n                <span className=\"upgrade-feature-icon\">‚úì</span>\n                <span><strong>Proyectos ilimitados</strong></span>\n              </li>\n              <li className=\"upgrade-feature-included\">\n                <span className=\"upgrade-feature-icon\">‚úì</span>\n                <span><strong>Usuarios ilimitados</strong></span>\n              </li>\n              <li className=\"upgrade-feature-included\">\n                <span className=\"upgrade-feature-icon\">‚úì</span>\n                <span>Soporte prioritario</span>\n              </li>\n              <li className=\"upgrade-feature-included\">\n                <span className=\"upgrade-feature-icon\">‚úì</span>\n                <span>Reportes avanzados</span>\n              </li>\n            </ul>\n            <button\n              className=\"upgrade-btn-primary\"\n              onClick={handleUpgrade}\n              disabled={isUpgrading}\n            >\n              {isUpgrading\n                ? (paymentMode === 'stripe' ? 'Procesando...' : 'Actualizando...')\n                : (paymentMode === 'stripe' ? 'Ir a Checkout de Stripe' : 'Actualizar a Professional (Simulaci√≥n)')\n              }\n            </button>\n          </div>\n        </div>\n\n        {/* Toggle para modo de pago (solo visible en desarrollo) */}\n        {process.env.NODE_ENV === 'development' && (\n          <div style={{\n            marginTop: '20px',\n            padding: '12px',\n            backgroundColor: '#f3f4f6',\n            borderRadius: '8px',\n            border: '1px dashed #9ca3af'\n          }}>\n            <label style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: '10px',\n              fontSize: '14px',\n              color: '#4b5563',\n              cursor: 'pointer'\n            }}>\n              <input\n                type=\"checkbox\"\n                checked={paymentMode === 'simulation'}\n                onChange={(e) => setPaymentMode(e.target.checked ? 'simulation' : 'stripe')}\n                style={{ width: '16px', height: '16px' }}\n              />\n              <span>\n                {paymentMode === 'stripe'\n                  ? 'üí≥ Modo: Stripe (Pago real)'\n                  : '‚ö†Ô∏è Modo: Simulaci√≥n (Sin pago)'\n                }\n              </span>\n            </label>\n          </div>\n        )}\n\n        <p className=\"upgrade-modal-footer\">\n          ¬øPreguntas? <a href=\"mailto:soporte@strategiapm.com\">Contacta con soporte</a>\n        </p>\n\n        <button className=\"upgrade-btn-secondary\" onClick={onClose}>\n          Ahora no\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default UpgradeModal;\n"],"names":["supabaseUrl","process","supabaseAnonKey","supabase","createClient","_ref","isOpen","onClose","limitType","currentPlan","currentCount","maxCount","organizationId","onUpgradeSuccess","isUpgrading","setIsUpgrading","useState","paymentMode","setPaymentMode","messages","project","title","current","concat","benefit","user","message","_jsx","className","onClick","children","_jsxs","e","stopPropagation","width","height","viewBox","fill","cx","cy","r","d","x","y","rx","handleUpgrade","async","data","auth","getUser","userEmail","email","portfolioData","localStorage","getItem","organizationName","_portfolio$organizati","portfolio","JSON","parse","organization","name","console","log","error","functions","invoke","body","priceId","plan","Error","url","window","location","href","alert","handleStripeCheckout","confirm","userId","_portfolio$user","id","result","subscriptionService","changePlan","success","setTimeout","reload","handleSimulatedUpgrade","disabled"],"sourceRoot":""}
/*! For license information please see 492.ed9dfb20.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[492],{492:(e,a,t)=>{t.r(a),t.d(a,{default:()=>j});var s=t(9950),r=t(7306),n=t(3081),i=t(6230);const l=(0,i.A)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var o=t(9284),c=t(4267),d=t(3769),m=t(9975),u=t(4867),x=t(3147);const h=(0,i.A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var p=t(4814),g=t(2828),y=t(4414);const b=e=>{let{organizations:a,onRefresh:t}=e;const n=(0,r.Zp)(),[i,l]=(0,s.useState)(""),[d,b]=(0,s.useState)(null),[j,f]=(0,s.useState)(!1),[v,N]=(0,s.useState)(!1),w=(null===a||void 0===a?void 0:a.filter(e=>{var a;return null===(a=e.name)||void 0===a?void 0:a.toLowerCase().includes(i.toLowerCase())}))||[];return(0,y.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,y.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,y.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"\ud83d\udcca Organizaciones"}),(0,y.jsxs)("span",{className:"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium",children:[w.length," total"]})]}),(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)(x.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,y.jsx)("input",{type:"text",placeholder:"Buscar organizaci\xf3n...",value:i,onChange:e=>l(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"})]})]}),(0,y.jsx)("div",{className:"overflow-x-auto",children:(0,y.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,y.jsx)("thead",{className:"bg-gray-50",children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Organizaci\xf3n"}),(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Miembros"}),(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proyectos"}),(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha Creaci\xf3n"}),(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),(0,y.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===w.length?(0,y.jsx)("tr",{children:(0,y.jsxs)("td",{colSpan:"5",className:"px-6 py-12 text-center",children:[(0,y.jsx)(o.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,y.jsx)("p",{className:"text-gray-500",children:i?"No se encontraron organizaciones":"No hay organizaciones registradas"})]})}):w.map(e=>(0,y.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("div",{className:"flex-shrink-0",children:(0,y.jsx)(o.A,{className:"w-8 h-8 text-purple-600"})}),(0,y.jsxs)("div",{className:"ml-4",children:[(0,y.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,y.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.id.substring(0,8),"..."]})]})]})}),(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)(m.A,{className:"w-4 h-4 text-gray-400 mr-2"}),(0,y.jsx)("span",{className:"text-sm text-gray-900 font-medium",children:e.member_count||0})]})}),(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)(c.A,{className:"w-4 h-4 text-gray-400 mr-2"}),(0,y.jsx)("span",{className:"text-sm text-gray-900 font-medium",children:e.project_count||0})]})}),(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("es-MX")}),(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,y.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,y.jsx)("button",{onClick:()=>(e=>{n("/admin/organizations/".concat(e.id))})(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:(0,y.jsx)(h,{className:"w-4 h-4"})}),(0,y.jsx)("button",{onClick:()=>(e=>{b(e),f(!0)})(e),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:(0,y.jsx)(p.A,{className:"w-4 h-4"})})]})})]},e.id))})]})}),j&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,y.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,y.jsxs)("div",{className:"flex items-center mb-4",children:[(0,y.jsx)(g.A,{className:"w-6 h-6 text-red-600 mr-3"}),(0,y.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Confirmar Eliminaci\xf3n"})]}),(0,y.jsxs)("p",{className:"text-gray-600 mb-4",children:["\xbfEst\xe1s seguro que deseas eliminar la organizaci\xf3n ",(0,y.jsxs)("strong",{children:['"',null===d||void 0===d?void 0:d.name,'"']}),"?"]}),(0,y.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:[(0,y.jsx)("p",{className:"text-sm text-red-800",children:"\u26a0\ufe0f Esta acci\xf3n eliminar\xe1:"}),(0,y.jsxs)("ul",{className:"text-sm text-red-700 ml-4 mt-2 list-disc",children:[(0,y.jsx)("li",{children:"Todos los proyectos"}),(0,y.jsx)("li",{children:"Todas las tareas"}),(0,y.jsx)("li",{children:"Todos los miembros"}),(0,y.jsx)("li",{children:"Todos los archivos"})]}),(0,y.jsx)("p",{className:"text-sm text-red-800 font-bold mt-2",children:"Esta acci\xf3n NO se puede deshacer."})]}),(0,y.jsxs)("div",{className:"flex space-x-3",children:[(0,y.jsx)("button",{onClick:()=>{f(!1),b(null)},disabled:v,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancelar"}),(0,y.jsx)("button",{onClick:async()=>{if(d){N(!0);try{const{error:e}=await u.A.deleteOrganization(d.id);e?alert("Error al eliminar: ".concat(e.message)):(alert("Organizaci\xf3n eliminada exitosamente"),f(!1),b(null),null===t||void 0===t||t())}catch(e){console.error("Error eliminando organizaci\xf3n:",e),alert("Error al eliminar la organizaci\xf3n")}finally{N(!1)}}},disabled:v,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:v?"Eliminando...":"Eliminar"})]})]})})]})},j=()=>{const e=(0,r.Zp)(),[a,t]=(0,s.useState)(null),[i,x]=(0,s.useState)(!0);(0,s.useEffect)(()=>{h()},[]);const h=async()=>{x(!0);try{const e=await u.A.getGlobalStats();t(e)}catch(e){console.error("Error cargando estad\xedsticas:",e)}finally{x(!1)}},p=e=>{let{title:a,value:t,icon:s,color:r,subtitle:n}=e;return(0,y.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:a}),(0,y.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:t}),n&&(0,y.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:n})]}),(0,y.jsx)("div",{className:"p-3 rounded-lg bg-gradient-to-r ".concat(r),children:(0,y.jsx)(s,{className:"w-6 h-6 text-white"})})]})})};return i?(0,y.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,y.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}):(0,y.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,y.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,y.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,y.jsx)("button",{onClick:()=>e("/"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,y.jsx)(n.A,{className:"w-5 h-5 text-gray-600"})}),(0,y.jsxs)("div",{children:[(0,y.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"\ud83d\udd27 Panel de Super-Admin"}),(0,y.jsx)("p",{className:"text-gray-600 mt-1",children:"Gesti\xf3n global de StrategiaPM"})]})]}),(0,y.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,y.jsx)(l,{className:"w-5 h-5 text-green-600"}),(0,y.jsx)("span",{className:"text-sm text-green-600 font-medium",children:"Sistema Operativo"})]})]})})}),(0,y.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,y.jsx)(p,{title:"Organizaciones Totales",value:(null===a||void 0===a?void 0:a.total_organizations)||0,icon:o.A,color:"from-blue-600 to-cyan-600"}),(0,y.jsx)(p,{title:"Proyectos Totales",value:(null===a||void 0===a?void 0:a.total_projects)||0,icon:c.A,color:"from-purple-600 to-indigo-600"}),(0,y.jsx)(p,{title:"Tareas Totales",value:(null===a||void 0===a?void 0:a.total_tasks)||0,icon:d.A,color:"from-green-600 to-emerald-600"}),(0,y.jsx)(p,{title:"Miembros Activos",value:(null===a||void 0===a?void 0:a.active_members)||0,icon:m.A,color:"from-orange-600 to-red-600"})]}),(0,y.jsx)(b,{organizations:(null===a||void 0===a?void 0:a.organizations_by_status)||[],onRefresh:h})]})]})}},3081:(e,a,t)=>{t.d(a,{A:()=>s});const s=(0,t(6230).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3147:(e,a,t)=>{t.d(a,{A:()=>s});const s=(0,t(6230).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},3769:(e,a,t)=>{t.d(a,{A:()=>s});const s=(0,t(6230).A)("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},4267:(e,a,t)=>{t.d(a,{A:()=>s});const s=(0,t(6230).A)("folder-kanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]])},4814:(e,a,t)=>{t.d(a,{A:()=>s});const s=(0,t(6230).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},4867:(e,a,t)=>{t.d(a,{A:()=>n});var s=t(9379),r=t(9874);const n=new class{async isSuperAdmin(){try{const e=r.default.getCurrentUser();if(!e)return!1;const{data:a}=await r.default.supabase.from("super_admins").select("id").eq("user_id",e.id).single();if(a)return!0;const{data:t}=await r.default.supabase.from("user_organization_roles").select("role").eq("user_id",e.id).eq("role","super_admin").single();return null!==t}catch(e){return console.error("Error verificando super-admin:",e),!1}}async listAllOrganizations(){try{const{data:e,error:a}=await r.default.supabase.from("organizations").select("\n          *,\n          members_count:organization_members(count),\n          projects_count:projects(count)\n        ").order("created_at",{ascending:!1});if(a)throw a;return{data:null===e||void 0===e?void 0:e.map(e=>{var a,t,r,n;return(0,s.A)((0,s.A)({},e),{},{member_count:(null===(a=e.members_count)||void 0===a||null===(t=a[0])||void 0===t?void 0:t.count)||0,project_count:(null===(r=e.projects_count)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.count)||0})}),error:null}}catch(e){return console.error("Error listando organizaciones:",e),{data:null,error:e}}}async getOrganizationDetails(e){try{const{data:a,error:t}=await r.default.supabase.from("organizations").select("\n          *,\n          members:organization_members(\n            id,\n            user_email,\n            user_id,\n            role,\n            status,\n            invited_at,\n            accepted_at,\n            created_at\n          ),\n          projects:projects(\n            id,\n            name,\n            status,\n            progress,\n            manager,\n            start_date,\n            end_date,\n            budget\n          )\n        ").eq("id",e).single();if(t)throw t;return{data:a,error:null}}catch(a){return console.error("Error obteniendo detalles:",a),{data:null,error:a}}}async getOrganizationMetrics(e){try{const[a,t,s,n]=await Promise.all([r.default.supabase.from("projects").select("id",{count:"exact",head:!0}).eq("organization_id",e),r.default.supabase.from("tasks").select("id",{count:"exact",head:!0}),r.default.supabase.from("organization_members").select("id",{count:"exact",head:!0}).eq("organization_id",e).eq("status","active"),r.default.supabase.from("risks").select("id",{count:"exact",head:!0})]);return{projectsCount:a.count||0,tasksCount:t.count||0,activeMembersCount:s.count||0,risksCount:n.count||0}}catch(a){return console.error("Error obteniendo m\xe9tricas:",a),{projectsCount:0,tasksCount:0,activeMembersCount:0,risksCount:0}}}async getGlobalStats(){try{var e;const{data:a,error:t}=await r.default.supabase.rpc("get_super_admin_stats");if(t&&"42883"!==t.code)throw t;if(a)return a;const[s,n,i,l]=await Promise.all([r.default.supabase.from("organizations").select("*"),r.default.supabase.from("projects").select("id",{count:"exact",head:!0}),r.default.supabase.from("tasks").select("id",{count:"exact",head:!0}),r.default.supabase.from("organization_members").select("id",{count:"exact",head:!0})]);return{total_organizations:(null===(e=s.data)||void 0===e?void 0:e.length)||0,total_projects:n.count||0,total_tasks:i.count||0,active_members:l.count||0,organizations_by_status:s.data||[]}}catch(a){return console.error("Error obteniendo estad\xedsticas globales:",a),{total_organizations:0,total_projects:0,total_tasks:0,active_members:0,organizations_by_status:[]}}}async updateOrganization(e,a){try{const{data:t,error:n}=await r.default.supabase.from("organizations").update((0,s.A)((0,s.A)({},a),{},{updated_at:(new Date).toISOString()})).eq("id",e).select().single();if(n)throw n;return{data:t,error:null}}catch(t){return console.error("Error actualizando organizaci\xf3n:",t),{data:null,error:t}}}async deleteOrganization(e){try{const{error:a}=await r.default.supabase.from("organizations").delete().eq("id",e);if(a)throw a;return{error:null}}catch(a){return console.error("Error eliminando organizaci\xf3n:",a),{error:a}}}}},9284:(e,a,t)=>{t.d(a,{A:()=>s});const s=(0,t(6230).A)("building-2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},9975:(e,a,t)=>{t.d(a,{A:()=>s});const s=(0,t(6230).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])}}]);
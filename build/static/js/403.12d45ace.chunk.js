"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[403],{1403:(e,s,t)=>{t.r(s),t.d(s,{default:()=>o});var a=t(9950),r=t(3116),l=t(4321),i=t(4414);const o=e=>{let{projectId:s,category:t="general",relatedItemId:o=null,onFileUploaded:n=null,showUploadArea:c=!0,isContextual:d=!1,title:x="\ud83d\udcce Gesti\xf3n de Archivos"}=e;const{permissions:m}=(0,l.A)(),{files:h,isLoading:g,error:p,uploadFile:u,deleteFile:v,getFilesByCategory:b,getFilesByRelatedItem:y,searchFiles:j,getFileStats:f,fileLimits:N}=(0,r.A)(s),[w,k]=(0,a.useState)(!1),[C,D]=(0,a.useState)(""),[S,F]=(0,a.useState)(t),[A,M]=(0,a.useState)(!1),[B,z]=(0,a.useState)(""),T=c&&m.canEdit,[E,L]=(0,a.useState)([]),[G,P]=(0,a.useState)("grid"),I=(0,a.useRef)(null),W=(0,a.useMemo)(()=>{let e=h;return console.log("\ud83d\udd0d FileManager - Filtrado:",{totalFiles:h.length,category:t,selectedCategory:S,isContextual:d,searchTerm:C}),"general"!==t&&d?(e=b(t),console.log("\ud83d\udcc2 Filtrado por categor\xeda contextual:",t,"archivos:",e.length)):"general"!==S&&(e=b(S),console.log("\ud83d\udcc2 Filtrado por categor\xeda seleccionada:",S,"archivos:",e.length)),o&&(e=y(o),console.log("\ud83d\udd17 Filtrado por item relacionado:",o,"archivos:",e.length)),C&&(e=j(C),console.log("\ud83d\udd0d Filtrado por b\xfasqueda:",C,"archivos:",e.length)),console.log("\u2705 Archivos finales filtrados:",e.length),e.sort((e,s)=>new Date(s.uploadDate)-new Date(e.uploadDate))},[h,t,S,o,C,d,b,y,j]),X=(0,a.useMemo)(()=>f(),[f]),q=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?k(!0):"dragleave"===e.type&&k(!1)},O=async e=>{L(Array.from(e)),M(!0)},R=e=>{const s=document.createElement("a");s.href=e.content,s.download=e.fileName,document.body.appendChild(s),s.click(),document.body.removeChild(s)},V=e=>{const s=e.mimeType||e.type||"";s.startsWith("image/")||"application/pdf"===s?window.open(e.content,"_blank"):R(e)},_=e=>{const s=e.mimeType||e.type||"";return s.startsWith("image/")?"\ud83d\uddbc\ufe0f":"application/pdf"===s?"\ud83d\udcc4":s.includes("word")?"\ud83d\udcdd":s.includes("excel")?"\ud83d\udcca":"\ud83d\udcce"},U=e=>{const s=e.type||"";return s.startsWith("image/")?"\ud83d\uddbc\ufe0f":"application/pdf"===s?"\ud83d\udcc4":s.includes("word")?"\ud83d\udcdd":s.includes("excel")?"\ud83d\udcca":"\ud83d\udcce"},J=e=>{const s=e.mimeType||e.type||"";return s.startsWith("image/")?"from-pink-500 to-rose-500":"application/pdf"===s?"from-red-500 to-pink-500":s.includes("word")?"from-blue-500 to-indigo-500":s.includes("excel")?"from-green-500 to-emerald-500":"from-gray-500 to-slate-500"},K=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},H=[{id:"purchase-order",name:"\xd3rdenes de Compra",icon:"\ud83d\uded2",color:"bg-blue-100 text-blue-800"},{id:"invoice",name:"Facturas",icon:"\ud83e\uddfe",color:"bg-green-100 text-green-800"},{id:"advance",name:"Anticipos",icon:"\ud83d\udcb0",color:"bg-yellow-100 text-yellow-800"},{id:"contract",name:"Contratos",icon:"\ud83d\udccb",color:"bg-purple-100 text-purple-800"},{id:"risk-evidence",name:"Evidencia de Riesgos",icon:"\ud83d\udee1\ufe0f",color:"bg-red-100 text-red-800"},{id:"general",name:"General",icon:"\ud83d\udcc1",color:"bg-gray-100 text-gray-800"}],Q=H.find(e=>e.id===S);return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"bg-gradient-to-r from-slate-50 to-gray-50 rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl text-white",children:(0,i.jsx)("span",{className:"text-2xl",children:"\ud83d\udcce"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:x}),(0,i.jsx)("p",{className:"text-sm text-gray-600",children:d?"Archivos relacionados con este contexto":"Gesti\xf3n completa de documentos del proyecto"})]})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:X.totalFiles}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"archivos"})]}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsxs)("div",{className:"text-lg font-semibold text-gray-800",children:[X.totalSizeMB,"MB"]}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:"total"})]}),T&&(0,i.jsxs)("button",{onClick:()=>{var e;return null===(e=I.current)||void 0===e?void 0:e.click()},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:[(0,i.jsx)("span",{className:"mr-2",children:"\ud83d\udce4"}),"Subir Archivos"]})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,i.jsx)("div",{className:"lg:col-span-2",children:(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,i.jsx)("span",{className:"text-gray-400",children:"\ud83d\udd0d"})}),(0,i.jsx)("input",{type:"text",placeholder:"Buscar archivos por nombre, descripci\xf3n o categor\xeda...",value:C,onChange:e=>D(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white shadow-sm transition-all duration-200"})]})}),"general"===t&&(0,i.jsx)("div",{children:(0,i.jsx)("select",{value:S,onChange:e=>F(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white shadow-sm transition-all duration-200",children:H.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))})})]}),Q&&(0,i.jsxs)("div",{className:"mt-4 flex items-center space-x-2",children:[(0,i.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(Q.color),children:[Q.icon," ",Q.name]}),(0,i.jsxs)("span",{className:"text-sm text-gray-500",children:[W.length," archivo",1!==W.length?"s":""," encontrado",1!==W.length?"s":""]})]})]}),!m.canEdit&&c&&(0,i.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-6 text-center",children:(0,i.jsxs)("div",{className:"flex items-center justify-center space-x-3 text-orange-700",children:[(0,i.jsx)("span",{className:"text-2xl",children:"\ud83d\udc40"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-medium text-lg",children:"Modo Solo Lectura"}),(0,i.jsx)("p",{className:"text-sm text-orange-600",children:"Puedes visualizar y descargar archivos, pero no subir nuevos"})]})]})}),T&&(0,i.jsx)("div",{className:"border-2 border-dashed rounded-xl p-12 text-center transition-all duration-300 ".concat(w?"border-blue-500 bg-gradient-to-r from-blue-50 to-indigo-50 scale-105":"border-gray-300 hover:border-blue-400 hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50"),onDragEnter:q,onDragLeave:q,onDragOver:q,onDrop:e=>{e.preventDefault(),e.stopPropagation(),k(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&O(e.dataTransfer.files)},children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)("div",{className:"text-6xl",children:"\ud83d\udcc1"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-gray-700",children:"Arrastra archivos aqu\xed"}),(0,i.jsx)("div",{className:"text-lg text-gray-600",children:"o haz clic para seleccionar"})]}),(0,i.jsxs)("div",{className:"text-sm text-gray-500 max-w-md mx-auto",children:["Tipos permitidos: PDF, JPG, PNG, DOC, DOCX, XLS, XLSX",(0,i.jsx)("br",{}),"Tama\xf1o m\xe1ximo: ",N.maxFileSize/1048576,"MB por archivo"]}),(0,i.jsx)("button",{onClick:()=>{var e;return null===(e=I.current)||void 0===e?void 0:e.click()},className:"px-8 py-4 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-xl hover:from-gray-200 hover:to-gray-300 transition-all duration-200 font-medium shadow-sm hover:shadow-md",children:"Seleccionar Archivos"})]})}),W.length>0&&(0,i.jsx)("div",{className:"flex items-center justify-between",children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("span",{className:"text-sm text-gray-600",children:"Vista:"}),(0,i.jsx)("button",{onClick:()=>P("grid"),className:"p-2 rounded-lg transition-colors ".concat("grid"===G?"bg-blue-100 text-blue-600":"text-gray-400 hover:text-gray-600"),children:"\u2b1b\u2b1b"}),(0,i.jsx)("button",{onClick:()=>P("list"),className:"p-2 rounded-lg transition-colors ".concat("list"===G?"bg-blue-100 text-blue-600":"text-gray-400 hover:text-gray-600"),children:"\u2630"})]})}),W.length>0?(0,i.jsx)("div",{className:"space-y-4",children:"grid"===G?(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:W.map(e=>(0,i.jsxs)("div",{className:"group bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-lg transition-all duration-200 hover:-translate-y-1",children:[(0,i.jsx)("div",{className:"p-4 bg-gradient-to-r ".concat(J(e)," rounded-t-xl text-white"),children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-2xl",children:_(e)}),(0,i.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,i.jsx)("button",{onClick:()=>v(e.id),className:"p-1 bg-white bg-opacity-20 rounded hover:bg-opacity-30 transition-colors",title:"Eliminar",children:"\ud83d\uddd1\ufe0f"})})]})}),(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-semibold text-gray-900 truncate",title:e.fileName,children:e.fileName}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:K(e.fileSize)})]}),e.description&&(0,i.jsx)("div",{className:"text-sm text-gray-600 line-clamp-2",children:e.description}),(0,i.jsx)("div",{className:"text-xs text-gray-400",children:new Date(e.uploadDate).toLocaleDateString()})]}),(0,i.jsxs)("div",{className:"mt-4 flex items-center justify-between opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[(0,i.jsx)("button",{onClick:()=>V(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Vista previa",children:"\ud83d\udc41\ufe0f"}),(0,i.jsx)("button",{onClick:()=>R(e),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Descargar",children:"\u2b07\ufe0f"})]})]})]},e.id))}):(0,i.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full",children:[(0,i.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Archivo"}),(0,i.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tama\xf1o"}),(0,i.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),(0,i.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-gray-100",children:W.map(e=>(0,i.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,i.jsx)("td",{className:"px-6 py-4",children:(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"p-2 rounded-lg bg-gradient-to-r ".concat(J(e)," text-white"),children:_(e)}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-gray-900",children:e.fileName}),e.description&&(0,i.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]})}),(0,i.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:K(e.fileSize)}),(0,i.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:new Date(e.uploadDate).toLocaleDateString()}),(0,i.jsx)("td",{className:"px-6 py-4",children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("button",{onClick:()=>V(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Vista previa",children:"\ud83d\udc41\ufe0f"}),(0,i.jsx)("button",{onClick:()=>R(e),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Descargar",children:"\u2b07\ufe0f"}),(0,i.jsx)("button",{onClick:()=>v(e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:"\ud83d\uddd1\ufe0f"})]})})]},e.id))})]})})})}):(0,i.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center",children:[(0,i.jsx)("div",{className:"text-6xl mb-6",children:"\ud83d\udcc1"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-gray-700",children:"No hay archivos"}),(0,i.jsx)("div",{className:"text-gray-500 max-w-md mx-auto",children:C?"No se encontraron archivos con esa b\xfasqueda":"Sube tu primer archivo para comenzar"})]})]}),(0,i.jsx)("input",{ref:I,type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx",onChange:e=>{e.target.files&&e.target.files[0]&&O(e.target.files)},className:"hidden"}),A&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,i.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,i.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\ud83d\udce4 Subir Archivos"}),(0,i.jsx)("button",{onClick:()=>{M(!1),L([]),z("")},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:"\u2715"})]}),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcc2 Categor\xeda"}),(0,i.jsx)("select",{value:S,onChange:e=>F(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:H.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcdd Descripci\xf3n (opcional)"}),(0,i.jsx)("textarea",{value:B,onChange:e=>z(e.target.value),placeholder:"Describe brevemente estos archivos...",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors resize-none",rows:"3"})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\ud83d\udcce Archivos seleccionados (",E.length,")"]}),(0,i.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-2",children:E.map((e,s)=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("span",{className:"text-lg",children:U(e)}),(0,i.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name})]}),(0,i.jsx)("span",{className:"text-xs text-gray-500",children:K(e.size)})]},s))})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-3 mt-8",children:[(0,i.jsx)("button",{onClick:()=>{M(!1),L([]),z("")},className:"px-6 py-3 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-xl transition-colors font-medium",children:"Cancelar"}),(0,i.jsx)("button",{onClick:async()=>{try{for(const e of E)await u(e,S,o,B);M(!1),L([]),z(""),n&&n()}catch(p){console.error("Error uploading files:",p)}},disabled:g,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:transform-none",children:g?(0,i.jsxs)("span",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"animate-spin mr-2",children:"\u23f3"}),"Subiendo..."]}):(0,i.jsxs)("span",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"mr-2",children:"\ud83d\udce4"}),"Subir Archivos"]})})]})]})})}),p&&(0,i.jsx)("div",{className:"bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-xl p-4",children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("span",{className:"text-red-600 text-lg",children:"\u274c"}),(0,i.jsx)("span",{className:"text-red-800 font-medium",children:p})]})})]})}}}]);
"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[941],{7322:(e,a,r)=>{r.r(a),r.d(a,{default:()=>d});var s=r(9950),n=r(3286),i=r(2838),o=r(4414);const l="https://ogqpsrsssrrytrqoyyph.supabase.co",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ncXBzcnNzc3JyeXRycW95eXBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3Nzc5NjAsImV4cCI6MjA3MzM1Mzk2MH0.EqXjG1iefYMZ84Tw-4po98gBV7uRuPoz0idQgJ03pzg",t=l&&c?(0,i.UU)(l,c):null,d=e=>{let{isOpen:a,onClose:r,limitType:i="project",currentPlan:l="free",currentCount:c=0,maxCount:d=0,organizationId:p=null,onUpgradeSuccess:u=null}=e;const[m,g]=(0,s.useState)(!1),[h,f]=(0,s.useState)("stripe");if(!a)return null;const j={project:{title:"\xa1Alcanzaste el l\xedmite de proyectos!",current:"Tienes ".concat(c," de ").concat(d," proyectos"),benefit:"Proyectos ilimitados"},user:{title:"\xa1Alcanzaste el l\xedmite de usuarios!",current:"Tienes ".concat(c," de ").concat(d," usuarios"),benefit:"Usuarios ilimitados"}},x=j[i]||j.project;return(0,o.jsx)("div",{className:"upgrade-modal-overlay",onClick:r,children:(0,o.jsxs)("div",{className:"upgrade-modal-content",onClick:e=>e.stopPropagation(),children:[(0,o.jsx)("button",{className:"upgrade-modal-close",onClick:r,children:"\xd7"}),(0,o.jsx)("div",{className:"upgrade-modal-icon",children:(0,o.jsxs)("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",children:[(0,o.jsx)("circle",{cx:"32",cy:"32",r:"30",fill:"#FEF3C7"}),(0,o.jsx)("path",{d:"M32 16L38 28H26L32 16Z",fill:"#F59E0B"}),(0,o.jsx)("circle",{cx:"32",cy:"36",r:"2",fill:"#F59E0B"}),(0,o.jsx)("rect",{x:"30",y:"42",width:"4",height:"8",rx:"2",fill:"#F59E0B"})]})}),(0,o.jsx)("h2",{className:"upgrade-modal-title",children:x.title}),(0,o.jsx)("p",{className:"upgrade-modal-subtitle",children:x.current}),(0,o.jsxs)("div",{className:"upgrade-plans-comparison",children:[(0,o.jsxs)("div",{className:"upgrade-plan-card upgrade-plan-current",children:[(0,o.jsxs)("div",{className:"upgrade-plan-header",children:[(0,o.jsx)("h3",{children:"Plan Free"}),(0,o.jsx)("span",{className:"upgrade-plan-badge",children:"Plan Actual"})]}),(0,o.jsxs)("div",{className:"upgrade-plan-price",children:["$0",(0,o.jsx)("span",{children:"/mes"})]}),(0,o.jsxs)("ul",{className:"upgrade-plan-features",children:[(0,o.jsxs)("li",{className:"upgrade-feature-limited",children:[(0,o.jsx)("span",{className:"upgrade-feature-icon",children:"\ud83d\udcca"}),(0,o.jsx)("span",{children:"1 proyecto"})]}),(0,o.jsxs)("li",{className:"upgrade-feature-limited",children:[(0,o.jsx)("span",{className:"upgrade-feature-icon",children:"\ud83d\udc65"}),(0,o.jsx)("span",{children:"3 usuarios"})]}),(0,o.jsxs)("li",{className:"upgrade-feature-included",children:[(0,o.jsx)("span",{className:"upgrade-feature-icon",children:"\u2713"}),(0,o.jsx)("span",{children:"Todas las funciones b\xe1sicas"})]})]})]}),(0,o.jsxs)("div",{className:"upgrade-plan-card upgrade-plan-recommended",children:[(0,o.jsxs)("div",{className:"upgrade-plan-header",children:[(0,o.jsx)("h3",{children:"Plan Professional"}),(0,o.jsx)("span",{className:"upgrade-plan-badge upgrade-plan-badge-pro",children:"Recomendado"})]}),(0,o.jsxs)("div",{className:"upgrade-plan-price",children:["$39",(0,o.jsx)("span",{children:"/mes"})]}),(0,o.jsxs)("ul",{className:"upgrade-plan-features",children:[(0,o.jsxs)("li",{className:"upgrade-feature-included",children:[(0,o.jsx)("span",{className:"upgrade-feature-icon",children:"\u2713"}),(0,o.jsx)("span",{children:(0,o.jsx)("strong",{children:"Proyectos ilimitados"})})]}),(0,o.jsxs)("li",{className:"upgrade-feature-included",children:[(0,o.jsx)("span",{className:"upgrade-feature-icon",children:"\u2713"}),(0,o.jsx)("span",{children:(0,o.jsx)("strong",{children:"Usuarios ilimitados"})})]}),(0,o.jsxs)("li",{className:"upgrade-feature-included",children:[(0,o.jsx)("span",{className:"upgrade-feature-icon",children:"\u2713"}),(0,o.jsx)("span",{children:"Soporte prioritario"})]}),(0,o.jsxs)("li",{className:"upgrade-feature-included",children:[(0,o.jsx)("span",{className:"upgrade-feature-icon",children:"\u2713"}),(0,o.jsx)("span",{children:"Reportes avanzados"})]})]}),(0,o.jsx)("button",{className:"upgrade-btn-primary",onClick:()=>{"stripe"===h?(async()=>{if(p)if(t){g(!0);try{const{data:{user:a}}=await t.auth.getUser(),r=(null===a||void 0===a?void 0:a.email)||"noemail@example.com",s=localStorage.getItem("strategiapm_portfolio_data");let n="Organization";if(s){var e;const a=JSON.parse(s);n=(null===a||void 0===a||null===(e=a.organization)||void 0===e?void 0:e.name)||n}console.log("[UpgradeModal] Creando sesi\xf3n de checkout para:",{organizationId:p,organizationName:n,userEmail:r});const{data:i,error:o}=await t.functions.invoke("create-checkout-session",{body:{organizationId:p,organizationName:n,userEmail:r,priceId:"price_1SPALq48wwYDYLlkLRP4SFG6",plan:"professional"}});if(o)throw new Error(o.message||"Error al crear sesi\xf3n de checkout");if(!i||!i.url)throw new Error("No se recibi\xf3 URL de checkout de Stripe");console.log("[UpgradeModal] Sesi\xf3n creada, redirigiendo a Stripe..."),window.location.href=i.url}catch(a){console.error("[UpgradeModal] Error en checkout:",a),alert("\u274c Error al procesar el pago: ".concat(a.message,"\n\nPor favor intenta de nuevo o contacta con soporte.")),g(!1)}}else alert("\u274c Error: Supabase no est\xe1 configurado correctamente.");else alert("\u274c Error: No se pudo identificar la organizaci\xf3n. Intenta recargar la p\xe1gina.")})():(async()=>{if(!p)return void alert("\u274c Error: No se pudo identificar la organizaci\xf3n. Intenta recargar la p\xe1gina.");if(window.confirm("\u26a0\ufe0f MODO SIMULACI\xd3N (Solo para desarrollo)\n\n\xbfConfirmas que deseas actualizar al Plan Professional?\n\n\ud83d\udcca Beneficios:\n\u2022 Proyectos ilimitados\n\u2022 Usuarios ilimitados\n\u2022 Soporte prioritario\n\u2022 Reportes avanzados\n\nNOTA: Esto es una simulaci\xf3n SIN PAGO REAL.\n\n\xbfContinuar?")){g(!0);try{const a=localStorage.getItem("strategiapm_portfolio_data");let s=null;if(a){var e;const r=JSON.parse(a);s=null===r||void 0===r||null===(e=r.user)||void 0===e?void 0:e.id}const i=await n.A.changePlan(p,"professional",s);if(!i.success)throw new Error(i.error||"Error desconocido");alert("\u2705 \xa1Plan actualizado exitosamente a Professional!\n\nBeneficios activados:\n\u2022 Proyectos ilimitados \u2713\n\u2022 Usuarios ilimitados \u2713\n\u2022 Soporte prioritario \u2713\n\n\ud83d\udd04 Recarga la p\xe1gina para ver los cambios reflejados."),u&&u(),r(),setTimeout(()=>{window.location.reload()},2e3)}catch(a){console.error("Error actualizando plan:",a),alert("\u274c Error al actualizar el plan: ".concat(a.message,"\n\nPor favor intenta de nuevo o contacta con soporte."))}finally{g(!1)}}})()},disabled:m,children:m?"stripe"===h?"Procesando...":"Actualizando...":"stripe"===h?"Ir a Checkout de Stripe":"Actualizar a Professional (Simulaci\xf3n)"})]})]}),!1,(0,o.jsxs)("p",{className:"upgrade-modal-footer",children:["\xbfPreguntas? ",(0,o.jsx)("a",{href:"mailto:soporte@strategiapm.com",children:"Contacta con soporte"})]}),(0,o.jsx)("button",{className:"upgrade-btn-secondary",onClick:r,children:"Ahora no"})]})})}}}]);
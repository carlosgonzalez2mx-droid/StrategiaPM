"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[241,283,521,664,902],{6241:(e,a,t)=>{t.r(a),t.d(a,{default:()=>R});var s=t(9379),r=t(9950),o=t(5271),n=t(4414);const i=e=>{let{isOpen:a,onClose:t,hitos:o,onSave:i}=e;const[l,c]=(0,r.useState)([{id:1,tarea:"",responsable:"",fecha:"",hitoId:""},{id:2,tarea:"",responsable:"",fecha:"",hitoId:""},{id:3,tarea:"",responsable:"",fecha:"",hitoId:""},{id:4,tarea:"",responsable:"",fecha:"",hitoId:""},{id:5,tarea:"",responsable:"",fecha:"",hitoId:""},{id:6,tarea:"",responsable:"",fecha:"",hitoId:""}]);(0,r.useEffect)(()=>{a&&c([{id:1,tarea:"",responsable:"",fecha:"",hitoId:""},{id:2,tarea:"",responsable:"",fecha:"",hitoId:""},{id:3,tarea:"",responsable:"",fecha:"",hitoId:""},{id:4,tarea:"",responsable:"",fecha:"",hitoId:""},{id:5,tarea:"",responsable:"",fecha:"",hitoId:""},{id:6,tarea:"",responsable:"",fecha:"",hitoId:""}])},[a]);const d=(e,a,t)=>{c(r=>r.map(r=>r.id===e?(0,s.A)((0,s.A)({},r),{},{[a]:t}):r))};return a?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 p-6 max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"\ud83d\udccb Nueva Minuta"}),(0,n.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"\xd7"})]}),(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("p",{className:"text-gray-600 text-sm",children:"Complete las tareas derivadas de la reuni\xf3n. Los campos marcados son obligatorios."})}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-blue-50",children:[(0,n.jsx)("th",{className:"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700",children:"#"}),(0,n.jsx)("th",{className:"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700",children:"Tarea *"}),(0,n.jsx)("th",{className:"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700",children:"Responsable *"}),(0,n.jsx)("th",{className:"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700",children:"Fecha *"}),(0,n.jsx)("th",{className:"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700",children:"Hito relacionado *"})]})}),(0,n.jsx)("tbody",{children:l.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"border border-gray-300 px-4 py-3 text-center font-medium text-gray-600",children:e.id}),(0,n.jsxs)("td",{className:"border border-gray-300 px-2 py-2",children:[(0,n.jsx)("textarea",{value:e.tarea,onChange:a=>d(e.id,"tarea",a.target.value),placeholder:"Descripci\xf3n de la tarea...",maxLength:70,rows:2,className:"w-full p-2 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-sm"}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.tarea.length,"/70 caracteres"]})]}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-2",children:(0,n.jsx)("input",{type:"text",value:e.responsable,onChange:a=>d(e.id,"responsable",a.target.value),placeholder:"Nombre del responsable",className:"w-full p-2 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-2",children:(0,n.jsx)("input",{type:"date",value:e.fecha,onChange:a=>d(e.id,"fecha",a.target.value),className:"w-full p-2 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-2",children:(0,n.jsxs)("select",{value:e.hitoId,onChange:a=>d(e.id,"hitoId",a.target.value),className:"w-full p-2 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,n.jsx)("option",{value:"",children:"Seleccionar hito..."}),o.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.wbsCode," - ",e.name]},e.id))]})})]},e.id))})]})}),(0,n.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,n.jsx)("button",{onClick:t,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,n.jsx)("button",{onClick:()=>{const e=l.filter(e=>""!==e.tarea.trim());if(0===e.length)return void alert("Debe agregar al menos una tarea para guardar la minuta.");if(e.filter(e=>!e.responsable.trim()||!e.fecha||!e.hitoId).length>0)return void alert("Todas las tareas deben tener: Responsable, Fecha y Hito relacionado.");const a=e.map(e=>(0,s.A)((0,s.A)({},e),{},{id:crypto.randomUUID(),fechaCreacion:(new Date).toISOString(),estatus:"Pendiente"}));i(a),t()},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"\ud83d\udcbe Guardar Minuta"})]})]})}):null},l=e=>{let{isOpen:a,onClose:t,minuta:o,hitos:i,onUpdate:l}=e;const[c,d]=(0,r.useState)({id:"",tarea:"",responsable:"",fecha:"",hitoId:"",estatus:"Pendiente"});(0,r.useEffect)(()=>{a&&o&&d({id:o.id,tarea:o.tarea||"",responsable:o.responsable||"",fecha:o.fecha||"",hitoId:o.hitoId||"",estatus:o.estatus||"Pendiente"})},[a,o]);const u=(e,a)=>{d(t=>(0,s.A)((0,s.A)({},t),{},{[e]:a}))};return a?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 p-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"\u270f\ufe0f Editar Minuta"}),(0,n.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"\xd7"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tarea *"}),(0,n.jsx)("textarea",{value:c.tarea,onChange:e=>u("tarea",e.target.value),placeholder:"Descripci\xf3n de la tarea...",maxLength:70,rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[c.tarea.length,"/70 caracteres"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Responsable *"}),(0,n.jsx)("input",{type:"text",value:c.responsable,onChange:e=>u("responsable",e.target.value),placeholder:"Nombre del responsable",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha *"}),(0,n.jsx)("input",{type:"date",value:c.fecha,onChange:e=>u("fecha",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hito relacionado *"}),(0,n.jsxs)("select",{value:c.hitoId,onChange:e=>u("hitoId",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"",children:"Seleccionar hito..."}),i.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.wbsCode," - ",e.name]},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estatus"}),(0,n.jsxs)("select",{value:c.estatus,onChange:e=>u("estatus",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"Pendiente",children:"Pendiente"}),(0,n.jsx)("option",{value:"En Proceso",children:"En Proceso"}),(0,n.jsx)("option",{value:"Completado",children:"Completado"})]})]})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,n.jsx)("button",{onClick:t,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,n.jsx)("button",{onClick:()=>{c.tarea.trim()?c.responsable.trim()?c.fecha?c.hitoId?(l(c),t()):alert("El hito relacionado es requerido"):alert("La fecha es requerida"):alert("El responsable es requerido"):alert("La tarea es requerida")},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"\ud83d\udcbe Guardar Cambios"})]})]})}):null},c=e=>{var a,t,s;let{wizardData:o,onUpdate:i,availableTemplates:l}=e;const[c,d]=(0,r.useState)(null),[u,m]=(0,r.useState)(""),p=[{value:"development",label:"Desarrollo de Software",icon:"\ud83d\udcbb"},{value:"equipment_installation",label:"Compra e Instalaci\xf3n de Equipos",icon:"\ud83c\udfed"},{value:"construction",label:"Construcci\xf3n",icon:"\ud83c\udfd7\ufe0f"},{value:"campaign",label:"Campa\xf1a de Marketing",icon:"\ud83d\udce2"},{value:"research",label:"Proyecto de Investigaci\xf3n",icon:"\ud83d\udd2c"},{value:"custom",label:"Personalizado",icon:"\u2699\ufe0f"}],g=[{value:"agile",label:"Agile/Scrum",description:"Iterativo, adaptativo"},{value:"waterfall",label:"Waterfall",description:"Secuencial, planificado"},{value:"hybrid",label:"H\xedbrido",description:"Combinaci\xf3n de ambos"},{value:"kanban",label:"Kanban",description:"Flujo continuo"}],h=[{value:"software",label:"Software/Tecnolog\xeda"},{value:"equipment",label:"Maquinaria/Equipos"},{value:"construction",label:"Construcci\xf3n"},{value:"marketing",label:"Marketing/Publicidad"},{value:"research",label:"Investigaci\xf3n/Desarrollo"},{value:"manufacturing",label:"Manufactura"},{value:"services",label:"Servicios"},{value:"other",label:"Otro"}];(0,r.useEffect)(()=>{if(c){const e={projectType:c.project_type,industry:c.industry,methodology:c.methodology,templateId:c.id,templateName:c.name};Object.keys(e).some(a=>o[a]!==e[a])&&i(e)}},[c]),(0,r.useEffect)(()=>{if("custom"===o.projectType&&u){const e=u.toLowerCase().replace(/\s+/g,"_");o.customProjectType!==u&&i({projectType:e,customProjectType:u})}},[u,o.projectType]);return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"\ud83d\udccb An\xe1lisis del Proyecto"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Proporciona informaci\xf3n b\xe1sica sobre tu proyecto para generar el cronograma m\xe1s apropiado"})]}),(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83d\udcdd"}),"Informaci\xf3n B\xe1sica"]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre del Proyecto *"}),(0,n.jsx)("input",{type:"text",value:o.projectName||"",onChange:e=>i({projectName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ej: Sistema de Gesti\xf3n de Inventarios"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gerente del Proyecto"}),(0,n.jsx)("input",{type:"text",value:o.projectManager||"",onChange:e=>i({projectManager:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ej: Juan P\xe9rez"})]})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripci\xf3n del Proyecto"}),(0,n.jsx)("textarea",{value:o.projectDescription||"",onChange:e=>i({projectDescription:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Describe brevemente los objetivos y alcance del proyecto..."})]})]}),(0,n.jsxs)("div",{className:"bg-blue-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83c\udfaf"}),"Tipo de Proyecto *"]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:p.map(e=>(0,n.jsx)("button",{onClick:()=>(e=>{i({projectType:e});const a=l.find(a=>a.project_type===e);d(a||null)})(e.value),className:"p-4 rounded-lg border-2 transition-all text-left ".concat(o.projectType===e.value?"border-purple-500 bg-purple-50 text-purple-800":"border-gray-200 hover:border-purple-300 hover:bg-purple-25"),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-2xl mr-3",children:e.icon}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold",children:e.label}),"equipment_installation"===e.value&&(0,n.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Incluye compra, instalaci\xf3n y puesta en marcha"})]})]})},e.value))}),"custom"===o.projectType&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Especifica el tipo de proyecto"}),(0,n.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ej: Migraci\xf3n de Datos, Implementaci\xf3n de ERP"})]})]}),(0,n.jsxs)("div",{className:"bg-green-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83c\udfe2"}),"Industria"]}),(0,n.jsxs)("select",{value:o.industry||"",onChange:e=>i({industry:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[(0,n.jsx)("option",{value:"",children:"Selecciona una industria"}),h.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,n.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83d\udcca"}),"Metodolog\xeda Preferida"]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:g.map(e=>(0,n.jsxs)("button",{onClick:()=>i({methodology:e.value}),className:"p-4 rounded-lg border-2 transition-all text-left ".concat(o.methodology===e.value?"border-purple-500 bg-purple-50 text-purple-800":"border-gray-200 hover:border-purple-300 hover:bg-purple-25"),children:[(0,n.jsx)("div",{className:"font-semibold",children:e.label}),(0,n.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:e.description})]},e.value))})]}),l.length>0&&(0,n.jsxs)("div",{className:"bg-purple-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83d\udccb"}),"Templates Disponibles"]}),(0,n.jsx)("div",{className:"space-y-3",children:l.filter(e=>!o.projectType||e.project_type===o.projectType||e.industry===o.industry).map(e=>(0,n.jsx)("button",{onClick:()=>(e=>{d(e)})(e),className:"w-full p-4 rounded-lg border-2 transition-all text-left ".concat((null===c||void 0===c?void 0:c.id)===e.id?"border-purple-500 bg-purple-100 text-purple-800":"border-gray-200 hover:border-purple-300 hover:bg-purple-25"),children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold",children:e.name}),(0,n.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.methodology," \u2022 ",e.estimated_duration_days," d\xedas \u2022 Equipo: ",e.team_size_min,"-",e.team_size_max," personas"]})]}),(null===c||void 0===c?void 0:c.id)===e.id&&(0,n.jsx)("span",{className:"text-purple-600 text-xl",children:"\u2713"})]})},e.id))})]}),(0,n.jsxs)("div",{className:"bg-orange-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83d\udcc5"}),"Fechas del Proyecto"]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Inicio"}),(0,n.jsx)("input",{type:"date",value:o.startDate||"",onChange:e=>i({startDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha L\xedmite (Opcional)"}),(0,n.jsx)("input",{type:"date",value:o.endDate||"",onChange:e=>i({endDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]})]}),(o.projectName||o.projectType)&&(0,n.jsxs)("div",{className:"bg-gray-100 rounded-lg p-4",children:[(0,n.jsx)("h5",{className:"font-semibold text-gray-800 mb-2",children:"Resumen de Selecci\xf3n:"}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[o.projectName&&(0,n.jsxs)("div",{children:["\u2022 Proyecto: ",o.projectName]}),o.projectType&&(0,n.jsxs)("div",{children:["\u2022 Tipo: ",null===(a=p.find(e=>e.value===o.projectType))||void 0===a?void 0:a.label]}),o.industry&&(0,n.jsxs)("div",{children:["\u2022 Industria: ",null===(t=h.find(e=>e.value===o.industry))||void 0===t?void 0:t.label]}),o.methodology&&(0,n.jsxs)("div",{children:["\u2022 Metodolog\xeda: ",null===(s=g.find(e=>e.value===o.methodology))||void 0===s?void 0:s.label]}),c&&(0,n.jsxs)("div",{children:["\u2022 Template: ",c.name]})]})]})]})},d=e=>{var a,t;let{wizardData:o,onUpdate:i}=e;const[l,c]=(0,r.useState)([]),[d,u]=(0,r.useState)({name:"",role:"",experience:"intermediate"}),m=[{value:"junior",label:"Junior (0-2 a\xf1os)",description:"Reci\xe9n iniciado, necesita supervisi\xf3n"},{value:"intermediate",label:"Intermedio (2-5 a\xf1os)",description:"Experiencia moderada, trabajo independiente"},{value:"senior",label:"Senior (5-10 a\xf1os)",description:"Experiencia s\xf3lida, puede liderar"},{value:"expert",label:"Experto (10+ a\xf1os)",description:"Experiencia avanzada, mentor\xeda"}],p=[{value:"project_manager",label:"Project Manager",icon:"\ud83d\udc68\u200d\ud83d\udcbc"},{value:"team_lead",label:"Team Lead",icon:"\ud83d\udc68\u200d\ud83d\udcbb"},{value:"buyer",label:"Comprador(a)",icon:"\ud83d\uded2"},{value:"developer",label:"Desarrollador",icon:"\ud83d\udcbb"},{value:"designer",label:"Dise\xf1ador",icon:"\ud83c\udfa8"},{value:"qa_tester",label:"QA/Tester",icon:"\ud83d\udd0d"},{value:"devops",label:"DevOps",icon:"\u2699\ufe0f"},{value:"analyst",label:"Analista",icon:"\ud83d\udcca"},{value:"engineer",label:"Ingeniero",icon:"\ud83d\udd27"},{value:"technician",label:"T\xe9cnico",icon:"\ud83d\udee0\ufe0f"},{value:"specialist",label:"Especialista",icon:"\ud83c\udfaf"},{value:"other",label:"Otro",icon:"\ud83d\udc64"}],g=[{value:"low",label:"Bajo",description:"Prefiero estimaciones conservadoras con m\xe1s tiempo"},{value:"medium",label:"Medio",description:"Equilibrio entre tiempo y riesgo"},{value:"high",label:"Alto",description:"Estimaciones agresivas, menos tiempo"}];(0,r.useEffect)(()=>{if(l.length>0){const e={junior:1,intermediate:2,senior:3,expert:4},a=l.reduce((a,t)=>a+(e[t.experience]||2),0)/l.length;let t="intermediate";a<=1.5?t="junior":a>=3.5?t="expert":a>=2.5&&(t="senior"),i({teamSize:l.length,teamExperience:t,teamMembers:l})}else i({teamSize:o.teamSize||1,teamExperience:o.teamExperience||"intermediate",teamMembers:[]})},[l]);const h=e=>{const a=p.find(a=>a.value===e);return a?a.icon:"\ud83d\udc64"},x=e=>{const a=p.find(a=>a.value===e);return a?a.label:e};return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"\ud83d\udc65 Configuraci\xf3n de Recursos"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Define el equipo y recursos disponibles para optimizar el cronograma"})]}),(0,n.jsxs)("div",{className:"bg-blue-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83d\udc65"}),"Tama\xf1o del Equipo"]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3,4,5,6,7,8,9,10].map(e=>(0,n.jsxs)("button",{onClick:()=>i({teamSize:e}),className:"p-4 rounded-lg border-2 transition-all text-center ".concat(o.teamSize===e?"border-blue-500 bg-blue-100 text-blue-800":"border-gray-200 hover:border-blue-300 hover:bg-blue-25"),children:[(0,n.jsx)("div",{className:"text-2xl font-bold",children:e}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:1===e?"persona":"personas"})]},e))})]}),(0,n.jsxs)("div",{className:"bg-green-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc66"}),"Composici\xf3n del Equipo"]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-4 border border-gray-200",children:[(0,n.jsx)("h5",{className:"font-semibold text-gray-700 mb-3",children:"Agregar Miembro del Equipo"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),(0,n.jsx)("input",{type:"text",value:d.name,onChange:e=>u(a=>(0,s.A)((0,s.A)({},a),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ej: Mar\xeda Garc\xeda"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rol"}),(0,n.jsxs)("select",{value:d.role,onChange:e=>u(a=>(0,s.A)((0,s.A)({},a),{},{role:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,n.jsx)("option",{value:"",children:"Seleccionar rol"}),p.map(e=>(0,n.jsxs)("option",{value:e.value,children:[e.icon," ",e.label]},e.value))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Experiencia"}),(0,n.jsx)("select",{value:d.experience,onChange:e=>u(a=>(0,s.A)((0,s.A)({},a),{},{experience:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:m.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,n.jsx)("button",{onClick:()=>{if(d.name.trim()&&d.role){const e={id:Date.now(),name:d.name.trim(),role:d.role,experience:d.experience};c(a=>[...a,e]),u({name:"",role:"",experience:"intermediate"})}},disabled:!d.name.trim()||!d.role,className:"mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"+ Agregar Miembro"})]}),l.length>0&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("h5",{className:"font-semibold text-gray-700",children:["Miembros del Equipo (",l.length,")"]}),l.map(e=>{var a;return(0,n.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-gray-200 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-3",children:h(e.role)}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold",children:e.name}),(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:[x(e.role)," \u2022 ",null===(a=m.find(a=>a.value===e.experience))||void 0===a?void 0:a.label]})]})]}),(0,n.jsx)("button",{onClick:()=>{return a=e.id,void c(e=>e.filter(e=>e.id!==a));var a},className:"text-red-500 hover:text-red-700 transition-colors",children:"\ud83d\uddd1\ufe0f"})]},e.id)})]})]}),(0,n.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83c\udf93"}),"Nivel de Experiencia del Equipo"]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:m.map(e=>(0,n.jsxs)("button",{onClick:()=>i({teamExperience:e.value}),className:"p-4 rounded-lg border-2 transition-all text-left ".concat(o.teamExperience===e.value?"border-yellow-500 bg-yellow-100 text-yellow-800":"border-gray-200 hover:border-yellow-300 hover:bg-yellow-25"),children:[(0,n.jsx)("div",{className:"font-semibold",children:e.label}),(0,n.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:e.description})]},e.value))})]}),(0,n.jsxs)("div",{className:"bg-purple-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\u23f0"}),"Disponibilidad del Equipo"]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{value:25,label:"25%",description:"Tiempo parcial"},{value:50,label:"50%",description:"Medio tiempo"},{value:75,label:"75%",description:"Tiempo completo"},{value:100,label:"100%",description:"Dedicaci\xf3n total"}].map(e=>(0,n.jsxs)("button",{onClick:()=>i({teamAvailability:e.value}),className:"p-4 rounded-lg border-2 transition-all text-center ".concat(o.teamAvailability===e.value?"border-purple-500 bg-purple-100 text-purple-800":"border-gray-200 hover:border-purple-300 hover:bg-purple-25"),children:[(0,n.jsx)("div",{className:"text-2xl font-bold",children:e.label}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:e.description})]},e.value))})]}),(0,n.jsxs)("div",{className:"bg-red-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\u26a0\ufe0f"}),"Tolerancia al Riesgo"]}),(0,n.jsx)("div",{className:"space-y-3",children:g.map(e=>(0,n.jsxs)("button",{onClick:()=>i({riskTolerance:e.value}),className:"w-full p-4 rounded-lg border-2 transition-all text-left ".concat(o.riskTolerance===e.value?"border-red-500 bg-red-100 text-red-800":"border-gray-200 hover:border-red-300 hover:bg-red-25"),children:[(0,n.jsx)("div",{className:"font-semibold",children:e.label}),(0,n.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:e.description})]},e.value))})]}),(0,n.jsxs)("div",{className:"bg-indigo-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83d\udcb0"}),"Presupuesto del Proyecto"]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Presupuesto Total (USD)"}),(0,n.jsx)("input",{type:"number",value:o.budget||"",onChange:e=>i({budget:parseFloat(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Ej: 50000"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Presupuesto por Mes (USD)"}),(0,n.jsx)("input",{type:"number",value:o.monthlyBudget||"",onChange:e=>i({monthlyBudget:parseFloat(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Ej: 10000"})]})]})]}),(0,n.jsxs)("div",{className:"bg-gray-100 rounded-lg p-4",children:[(0,n.jsx)("h5",{className:"font-semibold text-gray-800 mb-2",children:"Resumen de Configuraci\xf3n:"}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,n.jsxs)("div",{children:["\u2022 Equipo: ",o.teamSize||1," personas"]}),(0,n.jsxs)("div",{children:["\u2022 Experiencia: ",null===(a=m.find(e=>e.value===o.teamExperience))||void 0===a?void 0:a.label]}),o.teamAvailability&&(0,n.jsxs)("div",{children:["\u2022 Disponibilidad: ",o.teamAvailability,"%"]}),o.riskTolerance&&(0,n.jsxs)("div",{children:["\u2022 Riesgo: ",null===(t=g.find(e=>e.value===o.riskTolerance))||void 0===t?void 0:t.label]}),o.budget&&(0,n.jsxs)("div",{children:["\u2022 Presupuesto: $",o.budget.toLocaleString()]}),l.length>0&&(0,n.jsxs)("div",{children:["\u2022 Miembros definidos: ",l.length]})]})]})]})},u=e=>{let{wizardData:a,onUpdate:t}=e;const[o,i]=(0,r.useState)([]),[l,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{const e=m(a.projectType);i(e)},[a.projectType]),(0,r.useEffect)(()=>{t({milestones:o})},[o,t]);const m=e=>{const a={construccion:[{id:"milestone-1",name:"HITO: Aprobaci\xf3n de planos",description:"Aprobaci\xf3n final de planos arquitect\xf3nicos y estructurales"},{id:"milestone-2",name:"HITO: Inicio de obra",description:"Inicio formal de la construcci\xf3n"},{id:"milestone-3",name:"HITO: Estructura terminada",description:"Completar estructura principal"},{id:"milestone-4",name:"HITO: Instalaciones completadas",description:"Instalaciones el\xe9ctricas, hidr\xe1ulicas y sanitarias"},{id:"milestone-5",name:"HITO: Obra terminada",description:"Construcci\xf3n completamente terminada"}],software:[{id:"milestone-1",name:"HITO: An\xe1lisis completado",description:"An\xe1lisis de requisitos y dise\xf1o de sistema"},{id:"milestone-2",name:"HITO: Prototipo funcional",description:"Primera versi\xf3n funcional del software"},{id:"milestone-3",name:"HITO: Desarrollo terminado",description:"Desarrollo completo de funcionalidades"},{id:"milestone-4",name:"HITO: Pruebas completadas",description:"Testing y correcci\xf3n de errores"},{id:"milestone-5",name:"HITO: Despliegue en producci\xf3n",description:"Lanzamiento oficial del software"}],manufactura:[{id:"milestone-1",name:"HITO: Dise\xf1o de producto",description:"Dise\xf1o final del producto a manufacturar"},{id:"milestone-2",name:"HITO: Prototipo validado",description:"Prototipo aprobado y validado"},{id:"milestone-3",name:"HITO: L\xednea de producci\xf3n",description:"Configuraci\xf3n de l\xednea de producci\xf3n"},{id:"milestone-4",name:"HITO: Producci\xf3n piloto",description:"Primera producci\xf3n de prueba"},{id:"milestone-5",name:"HITO: Producci\xf3n en masa",description:"Inicio de producci\xf3n comercial"}],general:[{id:"milestone-1",name:"HITO: Proyecto iniciado",description:"Kickoff formal del proyecto"},{id:"milestone-2",name:"HITO: Planificaci\xf3n completada",description:"Plan detallado del proyecto aprobado"},{id:"milestone-3",name:"HITO: Fase de ejecuci\xf3n",description:"Inicio de la fase principal de ejecuci\xf3n"},{id:"milestone-4",name:"HITO: Entregables completados",description:"Todos los entregables principales terminados"},{id:"milestone-5",name:"HITO: Proyecto cerrado",description:"Cierre formal del proyecto"}]};return a[e]||a.general},p=()=>{if(!l.trim())return;const e={id:"milestone-".concat(Date.now()),name:l.trim(),description:"",isCustom:!0};i(a=>[...a,e]),c(""),u(!1)},g=(e,a,t)=>{i(r=>r.map(r=>r.id===e?(0,s.A)((0,s.A)({},r),{},{[a]:t}):r))},h=(e,a)=>{i(t=>{const s=[...t],[r]=s.splice(e,1);return s.splice(a,0,r),s})};return(0,n.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsxs)("h2",{className:"text-3xl font-bold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-4xl mr-3",children:"\ud83c\udfaf"}),"Definir hitos del proyecto"]}),(0,n.jsx)("p",{className:"text-gray-600 text-lg leading-relaxed",children:"Los hitos son puntos clave en tu proyecto que marcan el progreso y la entrega de resultados importantes. Hemos predefinido algunos hitos comunes para tu tipo de proyecto, pero puedes personalizarlos."})]}),(0,n.jsx)("div",{className:"space-y-4 mb-6",children:o.map((e,a)=>(0,n.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,n.jsx)("span",{className:"text-2xl",children:"\ud83c\udfaf"}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)("input",{type:"text",value:e.name,onChange:a=>g(e.id,"name",a.target.value),className:"w-full text-lg font-semibold text-gray-800 border-none bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-2 py-1",placeholder:"Nombre del hito"})})]}),(0,n.jsx)("textarea",{value:e.description,onChange:a=>g(e.id,"description",a.target.value),className:"w-full text-gray-600 border border-gray-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Descripci\xf3n del hito (opcional)",rows:2}),e.isCustom&&(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"\u2728 Personalizado"})})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[a>0&&(0,n.jsx)("button",{onClick:()=>h(a,a-1),className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Mover hacia arriba",children:"\u2b06\ufe0f"}),a<o.length-1&&(0,n.jsx)("button",{onClick:()=>h(a,a+1),className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Mover hacia abajo",children:"\u2b07\ufe0f"}),(0,n.jsx)("button",{onClick:()=>{return a=e.id,void i(e=>e.filter(e=>e.id!==a));var a},className:"text-red-400 hover:text-red-600 transition-colors",title:"Eliminar hito",children:"\ud83d\uddd1\ufe0f"})]})]})},e.id))}),d?(0,n.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-blue-800 mb-3",children:"Agregar nuevo hito"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("input",{type:"text",value:l,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nombre del nuevo hito",onKeyPress:e=>"Enter"===e.key&&p(),autoFocus:!0}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("button",{onClick:p,disabled:!l.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Agregar hito"}),(0,n.jsx)("button",{onClick:()=>{u(!1),c("")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})]}):(0,n.jsxs)("button",{onClick:()=>u(!0),className:"w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-colors",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\u2795"}),"Agregar hito personalizado"]}),(0,n.jsxs)("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,n.jsxs)("h4",{className:"font-semibold text-yellow-800 mb-2 flex items-center",children:[(0,n.jsx)("span",{className:"mr-2",children:"\ud83d\udca1"}),"Consejos para definir hitos"]}),(0,n.jsxs)("ul",{className:"text-sm text-yellow-700 space-y-1",children:[(0,n.jsx)("li",{children:"\u2022 Los hitos deben ser medibles y verificables"}),(0,n.jsx)("li",{children:"\u2022 Deben representar entregables tangibles"}),(0,n.jsx)("li",{children:"\u2022 Considera las dependencias entre hitos"}),(0,n.jsx)("li",{children:"\u2022 Incluye hitos de aprobaci\xf3n y validaci\xf3n"})]})]}),(0,n.jsx)("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-semibold text-gray-800",children:"Resumen de hitos"}),(0,n.jsxs)("p",{className:"text-gray-600 text-sm",children:[o.length," hitos definidos para el proyecto"]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:o.length}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:"hitos"})]})]})})]})},m=e=>{let{wizardData:a,onUpdate:t}=e;const[o,i]=(0,r.useState)({deliveryTime:a.deliveryTime||"",deliveryTimeUnit:a.deliveryTimeUnit||"weeks",requiresInfrastructure:a.requiresInfrastructure||!1,isForeignEquipment:a.isForeignEquipment||!1,numberOfAdvancePayments:a.numberOfAdvancePayments||2,advancePayments:a.advancePayments||[{percentage:30,description:"Anticipo inicial",timing:"order"},{percentage:70,description:"Pago final",timing:"delivery"}]}),[l,c]=(0,r.useState)({});(0,r.useEffect)(()=>{t(o)},[o,t]);const d=(e,a)=>{i(t=>(0,s.A)((0,s.A)({},t),{},{[e]:a})),l[e]&&c(a=>(0,s.A)((0,s.A)({},a),{},{[e]:null}))},u=(e,a,t)=>{const r=[...o.advancePayments];r[e]=(0,s.A)((0,s.A)({},r[e]),{},{[a]:t}),d("advancePayments",r)},m=e=>{switch(e){case 1:return[{percentage:100,description:"Pago completo",timing:"delivery"}];case 2:default:return[{percentage:30,description:"Anticipo inicial",timing:"order"},{percentage:70,description:"Pago final",timing:"delivery"}];case 3:return[{percentage:30,description:"Anticipo inicial",timing:"order"},{percentage:50,description:"Pago pre-embarque",timing:"shipping"},{percentage:20,description:"Pago final",timing:"delivery"}]}};return(0,r.useEffect)(()=>{(()=>{const e={};(!o.deliveryTime||o.deliveryTime<=0)&&(e.deliveryTime="El tiempo de entrega es requerido"),(!o.numberOfAdvancePayments||o.numberOfAdvancePayments<1)&&(e.numberOfAdvancePayments="Debe seleccionar al menos 1 anticipo");const a=o.advancePayments.reduce((e,a)=>e+(parseFloat(a.percentage)||0),0);Math.abs(a-100)>.01&&(e.advancePayments="Los anticipos deben sumar 100%"),c(e),Object.keys(e).length})()},[o]),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Configuraci\xf3n Espec\xedfica de Maquinaria"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Configura los detalles espec\xedficos para la compra e instalaci\xf3n de equipos"})]}),(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[(0,n.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"\ud83d\udce6 Tiempo de Entrega de Equipos"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tiempo de entrega"}),(0,n.jsx)("input",{type:"number",min:"1",value:o.deliveryTime,onChange:e=>d("deliveryTime",parseInt(e.target.value)||""),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(l.deliveryTime?"border-red-500":"border-gray-300"),placeholder:"Ej: 12"}),l.deliveryTime&&(0,n.jsx)("p",{className:"text-red-500 text-sm mt-1",children:l.deliveryTime})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Unidad de tiempo"}),(0,n.jsxs)("select",{value:o.deliveryTimeUnit,onChange:e=>d("deliveryTimeUnit",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"days",children:"D\xedas"}),(0,n.jsx)("option",{value:"weeks",children:"Semanas"}),(0,n.jsx)("option",{value:"months",children:"Meses"})]})]})]}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Este tiempo ser\xe1 utilizado para ajustar la duraci\xf3n de las actividades de compra y entrega."})]}),(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[(0,n.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"\ud83d\udd27 Requisitos Especiales"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"font-medium text-gray-800",children:"\xbfRequiere modificaci\xf3n de infraestructura?"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Preparaci\xf3n del sitio, instalaciones el\xe9ctricas, cimentaciones, etc."})]}),(0,n.jsxs)("label",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",checked:o.requiresInfrastructure,onChange:e=>d("requiresInfrastructure",e.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),(0,n.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"S\xed"})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"font-medium text-gray-800",children:"\xbfEl equipo viene del extranjero?"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Incluir\xe1 procesos de importaci\xf3n, aduanas y documentaci\xf3n"})]}),(0,n.jsxs)("label",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",checked:o.isForeignEquipment,onChange:e=>d("isForeignEquipment",e.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),(0,n.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"S\xed"})]})]})]})]}),(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[(0,n.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"\ud83d\udcb0 Estructura de Anticipos"}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"\xbfCu\xe1ntos anticipos tendr\xe1 este proyecto?"}),(0,n.jsx)("div",{className:"grid grid-cols-3 gap-4",children:[1,2,3].map(e=>(0,n.jsxs)("button",{type:"button",onClick:()=>(e=>{d("numberOfAdvancePayments",e);const a=m(e);d("advancePayments",a)})(e),className:"p-4 border-2 rounded-lg text-center transition-colors ".concat(o.numberOfAdvancePayments===e?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-blue-300 text-gray-700"),children:[(0,n.jsx)("div",{className:"font-semibold text-lg",children:e}),(0,n.jsx)("div",{className:"text-sm",children:1===e?"Pago \xfanico":2===e?"Dos anticipos":"Tres anticipos"})]},e))}),l.numberOfAdvancePayments&&(0,n.jsx)("p",{className:"text-red-500 text-sm mt-2",children:l.numberOfAdvancePayments})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[o.advancePayments.map((e,a)=>(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porcentaje (%)"}),(0,n.jsx)("input",{type:"number",min:"0",max:"100",step:"0.01",value:e.percentage,onChange:e=>u(a,"percentage",parseFloat(e.target.value)||""),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"30"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,n.jsx)("input",{type:"text",value:e.description,onChange:e=>u(a,"description",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Anticipo inicial"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Momento del pago"}),(0,n.jsxs)("select",{value:e.timing,onChange:e=>u(a,"timing",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"order",children:"Al realizar la orden de compra"}),(0,n.jsx)("option",{value:"production",children:"Durante la fabricaci\xf3n"}),(0,n.jsx)("option",{value:"shipping",children:"Antes de liberar para env\xedo"}),(0,n.jsx)("option",{value:"delivery",children:"Al entregar equipo funcionando"}),(0,n.jsx)("option",{value:"installation",children:"Al completar la instalaci\xf3n"}),(0,n.jsx)("option",{value:"performance",children:"Al finalizar pruebas de performance"})]})]})]},a)),l.advancePayments&&(0,n.jsx)("p",{className:"text-red-500 text-sm",children:l.advancePayments}),(0,n.jsxs)("div",{className:"text-sm text-gray-500 text-center",children:["Total: ",o.advancePayments.reduce((e,a)=>e+(parseFloat(a.percentage)||0),0).toFixed(1),"%"]})]})]})]})},p=e=>{var a,t,s,o,i,l,c,d;let{wizardData:u,generatedSchedule:m,isGenerating:p,onGenerate:g}=e;const[h,x]=(0,r.useState)("overview"),[b,f]=(0,r.useState)(!0);console.log("\ud83d\udd0d SchedulePreview props:",{wizardData:u,generatedSchedule:m?"Presente":"Ausente",isGenerating:p,hasOnGenerate:!!g});const y=e=>e<7?"".concat(e," d\xedas"):e<30?"".concat(Math.round(e/7)," semanas"):"".concat(Math.round(e/30)," meses"),v=(e=>{var a;if(!e)return null;const t=e.activities||[],s=e.milestones||[],r=t.reduce((e,a)=>e+(a.duration||0),0),o=t.filter(e=>"high"===e.priority).length,n=(null===(a=e.criticalPath)||void 0===a?void 0:a.length)||0;return{totalActivities:t.length,totalMilestones:s.length,totalDuration:r,highPriorityActivities:o,criticalPathActivities:n,averageActivityDuration:t.length>0?Math.round(r/t.length):0}})(m);return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"\ud83d\udcca Vista Previa del Cronograma"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Revisa el cronograma generado por IA antes de aplicarlo a tu proyecto"})]}),!m&&!p&&(0,n.jsxs)("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-8 text-center",children:[(0,n.jsx)("div",{className:"text-6xl mb-4",children:"\ud83e\udd16"}),(0,n.jsx)("h4",{className:"text-xl font-semibold text-gray-800 mb-2",children:"\xa1Listo para Generar tu Cronograma!"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"Con la informaci\xf3n proporcionada, nuestro asistente de IA generar\xe1 un cronograma optimizado para tu proyecto."}),(0,n.jsx)("button",{onClick:()=>{m||p||g()},className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition-all transform hover:scale-105",children:"\ud83d\ude80 Generar Cronograma con IA"})]}),p&&(0,n.jsxs)("div",{className:"bg-blue-50 rounded-lg p-8 text-center",children:[(0,n.jsx)("div",{className:"animate-spin text-6xl mb-4",children:"\ud83e\udd16"}),(0,n.jsx)("h4",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Generando Cronograma..."}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"Nuestro asistente de IA est\xe1 analizando tu proyecto y generando el cronograma m\xe1s apropiado."}),(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)("div",{className:"animate-bounce w-2 h-2 bg-blue-600 rounded-full"}),(0,n.jsx)("div",{className:"animate-bounce w-2 h-2 bg-blue-600 rounded-full",style:{animationDelay:"0.1s"}}),(0,n.jsx)("div",{className:"animate-bounce w-2 h-2 bg-blue-600 rounded-full",style:{animationDelay:"0.2s"}})]})]}),m&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83d\udccb"}),"Informaci\xf3n del Proyecto"]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Proyecto"}),(0,n.jsx)("p",{className:"text-gray-900 font-semibold",children:u.projectName})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Tipo"}),(0,n.jsx)("p",{className:"text-gray-900",children:u.projectType})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Metodolog\xeda"}),(0,n.jsx)("p",{className:"text-gray-900",children:u.methodology})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Equipo"}),(0,n.jsxs)("p",{className:"text-gray-900",children:[u.teamSize," personas"]})]})]})]}),v&&(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:v.totalActivities}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Actividades"})]}),(0,n.jsxs)("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:v.totalMilestones}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Hitos"})]}),(0,n.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4 text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:y(v.totalDuration)}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Duraci\xf3n Total"})]}),(0,n.jsxs)("div",{className:"bg-orange-50 rounded-lg p-4 text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:v.criticalPathActivities}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Ruta Cr\xedtica"})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200",children:[(0,n.jsx)("div",{className:"flex border-b border-gray-200",children:[{id:"overview",label:"Resumen",icon:"\ud83d\udcca"},{id:"activities",label:"Actividades",icon:"\ud83d\udccb"},{id:"milestones",label:"Hitos",icon:"\ud83c\udfaf"},{id:"timeline",label:"Cronograma",icon:"\ud83d\udcc5"}].map(e=>(0,n.jsxs)("button",{onClick:()=>x(e.id),className:"flex-1 px-4 py-3 text-sm font-medium transition-colors ".concat(h===e.id?"text-purple-600 border-b-2 border-purple-600 bg-purple-50":"text-gray-600 hover:text-gray-800 hover:bg-gray-50"),children:[(0,n.jsx)("span",{className:"mr-2",children:e.icon}),e.label]},e.id))}),(0,n.jsxs)("div",{className:"p-6",children:["overview"===h&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"font-semibold text-gray-800 mb-3",children:"Resumen del Cronograma"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,n.jsx)("h6",{className:"font-semibold text-gray-700 mb-2",children:"Duraci\xf3n del Proyecto"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:y(v.totalDuration)}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:[v.averageActivityDuration," d\xedas promedio por actividad"]})]}),(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,n.jsx)("h6",{className:"font-semibold text-gray-700 mb-2",children:"Complejidad"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-gray-900 capitalize",children:(null===(a=m.metadata)||void 0===a?void 0:a.complexity)||"medium"}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:[v.highPriorityActivities," actividades de alta prioridad"]})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"font-semibold text-gray-800 mb-3",children:"Template Utilizado"}),(0,n.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,n.jsx)("p",{className:"font-semibold text-blue-800",children:(null===(t=m.metadata)||void 0===t?void 0:t.templateUsed)||"Template Gen\xe9rico de Proyecto"}),(0,n.jsxs)("p",{className:"text-sm text-blue-600 mt-1",children:["Generado el ",(j=null===(s=m.metadata)||void 0===s?void 0:s.generatedAt,j?new Date(j).toLocaleDateString("es-ES"):"No definida")]}),!(null!==(o=m.metadata)&&void 0!==o&&o.templateUsed)&&(0,n.jsx)("p",{className:"text-xs text-blue-500 mt-2",children:"\u2139\ufe0f Se utiliz\xf3 un template gen\xe9rico basado en mejores pr\xe1cticas"})]})]})]}),"activities"===h&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("h5",{className:"font-semibold text-gray-800 mb-4",children:["Actividades Generadas (",(null===(i=m.activities)||void 0===i?void 0:i.length)||0,")"]}),(0,n.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:null===(l=m.activities)||void 0===l?void 0:l.map((e,a)=>(0,n.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h6",{className:"font-semibold text-gray-800",children:e.name}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[(0,n.jsxs)("span",{children:["\u23f1\ufe0f ",e.duration," d\xedas"]}),(0,n.jsxs)("span",{children:["\ud83d\udcc2 ",e.category]}),(0,n.jsxs)("span",{children:["\ud83c\udfaf ",e.priority]}),(0,n.jsxs)("span",{children:["\ud83d\udc64 ",e.assignedTo]})]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat("high"===e.priority?"bg-red-100 text-red-800":"medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.priority}),e.confidence&&(0,n.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Confianza: ",Math.round(100*e.confidence),"%"]})]})]})},e.id))})]}),"milestones"===h&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("h5",{className:"font-semibold text-gray-800 mb-4",children:["Hitos Generados (",(null===(c=m.milestones)||void 0===c?void 0:c.length)||0,")"]}),(0,n.jsx)("div",{className:"space-y-3",children:null===(d=m.milestones)||void 0===d?void 0:d.map((e,a)=>(0,n.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-4 border border-purple-200",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-2xl mr-3",children:"\ud83c\udfaf"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h6",{className:"font-semibold text-gray-800",children:e.name}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[(0,n.jsxs)("span",{children:["\ud83d\udcc2 ",e.phase]}),(0,n.jsxs)("span",{children:["\ud83d\udc64 ",e.assignedTo]})]}),e.criteria&&(0,n.jsx)("div",{className:"mt-2 p-2 bg-white rounded border border-gray-200",children:(0,n.jsxs)("p",{className:"text-xs text-gray-600",children:[(0,n.jsx)("strong",{children:"Criterio:"})," ",e.criteria]})})]})]})},e.id))})]}),"timeline"===h&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"font-semibold text-gray-800 mb-4",children:"Cronograma Temporal"}),(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,n.jsx)("p",{className:"text-gray-600 text-center",children:"\ud83d\udcc5 Vista de cronograma temporal disponible despu\xe9s de aplicar el cronograma"}),(0,n.jsx)("p",{className:"text-sm text-gray-500 text-center mt-2",children:"Una vez aplicado, podr\xe1s ver el cronograma completo en la vista Gantt"})]})]})]})]}),m.recommendations&&m.recommendations.length>0&&(0,n.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,n.jsx)("span",{className:"text-xl mr-2",children:"\ud83d\udca1"}),"Recomendaciones de IA"]}),(0,n.jsx)("button",{onClick:()=>f(!b),className:"text-gray-600 hover:text-gray-800 transition-colors",children:b?"\ud83d\udc41\ufe0f\u200d\ud83d\udde8\ufe0f Ocultar":"\ud83d\udc41\ufe0f Mostrar"})]}),b&&(0,n.jsx)("div",{className:"space-y-3",children:m.recommendations.map((e,a)=>(0,n.jsx)("div",{className:"p-4 rounded-lg border-l-4 ".concat("high"===e.priority?"border-red-500 bg-red-50":"medium"===e.priority?"border-yellow-500 bg-yellow-50":"border-green-500 bg-green-50"),children:(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("span",{className:"text-lg mr-3",children:"high"===e.priority?"\u26a0\ufe0f":"medium"===e.priority?"\ud83d\udca1":"\u2705"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-semibold text-gray-800",children:e.title}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),e.action&&(0,n.jsxs)("p",{className:"text-sm text-gray-700 mt-2 font-medium",children:[(0,n.jsx)("strong",{children:"Acci\xf3n sugerida:"})," ",e.action]})]})]})},a))})]}),(0,n.jsx)("div",{className:"bg-blue-50 rounded-lg p-4",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-2xl mr-3",children:"\ud83e\udd16"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-semibold text-blue-800",children:"Generado por Asistente de IA"}),(0,n.jsx)("p",{className:"text-sm text-blue-600",children:"Este cronograma fue generado autom\xe1ticamente bas\xe1ndose en las mejores pr\xe1cticas y patrones de proyectos similares. Puedes modificarlo despu\xe9s de aplicarlo a tu proyecto."})]})]})})]})]});var j};const g=new class{constructor(){this.templateData=null,this.templatePath="./template-compra-equipos.xlsx"}async loadTemplate(){try{console.log("\ud83d\udccb Cargando template de compra de equipos...");const e=[["#","Nombre","Duraci\xf3n","Prioridad","Asignado","Predecesoras","Hitos"],[1,"Aprobaci\xf3n y alta del activo en sistema","22 d\xedas","Alta","Team leader","","No"],[2,"Elaboraci\xf3n de edital t\xe9cnico","5 d\xedas","Alta","Team leader","","No"],[3,"Env\xedo de edital a proveedores para participar en el proyecto","5 d\xedas","Media","Comprador(a)",2,"No"],[4,"Soluci\xf3n de dudas t\xe9cnicas","11 d\xedas","Media","Proveedores",3,"No"],[5,"Selecci\xf3n de proveedor","3 d\xedas","Alta","Comprador(a)",4,"No"],[6,"Preparaci\xf3n de contrato con \xe1rea legal","7 d\xedas","Alta","Comprador(a)",5,"No"],[7,"Alta del proveedor en sistema para pago","10 d\xedas","Alta","Comprador(a)",5,"No"],[8,"Definir el equipo de proyecto","1 d\xeda","Media","Project Manager",5,"No"],[9,"Kick-off meeting con proveedor seleccionado","1 d\xeda","Media","Comprador(a)",8,"No"],[10,"Hito: Orden de compra realizada","0 d\xedas","Alta","Comprador(a)",9,"Si"],[11,"Programaci\xf3n de 1er anticipo","12 d\xedas","Alta","Comprador(a)",10,"No"],[12,"Ajuste del cronograma","1 d\xeda","Media","Project Manager",11,"No"],[13,"HITO: 1er anticipo pagado","0 d\xedas","Alta","Tesorero",11,"Si"],[14,"Estudio de sitio","2 d\xedas","Media","Team leader",9,"No"],[15,"Dise\xf1o de layout y distribuci\xf3n de equipos","5 d\xedas","Media","Team leader",14,"No"],[16,"Especificaciones t\xe9cnicas finales","3 d\xedas","Alta","Team leader",15,"No"],[17,"Ingenier\xeda de servicios (vapor, aire, electricidad)","4 d\xedas","Media","Team leader",16,"No"],[18,"Plan de instalaci\xf3n y cronograma detallado","1 d\xeda","Media","Team leader",17,"No"],[19,"An\xe1lisis de riesgos de importaci\xf3n","1 d\xeda","Media","Project Manager",18,"No"],[20,"HITO: Dise\xf1o Aprobado","0 d\xedas","Alta","Team leader",19,"Si"],[21,"Licitaci\xf3n para instalaci\xf3n de servicios e infraestructura","20 d\xedas","Media","Comprador(a)",20,"No"],[22,"HITO: Orden de compra para servicios e infraestructura","0 d\xedas","Alta","Comprador(a)",21,"Si"],[23,"Gesti\xf3n para pago de 1er anticipo de servicios e infraestructura","12 d\xedas","Alta","Comprador(a)",22,"No"],[24,"HITO: 1er anticipo serv e infraestructura pagado","0 d\xedas","Alta","Tesorero",23,"Si"],[25,"Preparaci\xf3n de cimentaci\xf3n y bases (piso)","21 d\xedas","Media","Proveedores",24,"No"],[26,"Instalaci\xf3n de servicios el\xe9ctricos (220V/440V)","5 d\xedas","Media","Proveedores",25,"No"],[27,"Instalaci\xf3n de l\xedneas de vapor","5 d\xedas","Media","Proveedores",25,"No"],[28,"Preparaci\xf3n de conexiones de aire comprimido","3 d\xedas","Media","Proveedores",27,"No"],[29,"Instalaci\xf3n de sistemas de drenaje","5 d\xedas","Media","Proveedores",26,"No"],[30,"Adecuaciones de espacio y accesos","4 d\xedas","Media","Proveedores",29,"No"],[31,"Instalaci\xf3n de sistemas de seguridad","2 d\xedas","Media","Proveedores",30,"No"],[32,"HITO: Sitio Preparado","0 d\xedas","Alta","Team leader",31,"Si"],[33,"Gesti\xf3n para pago 2o anticipo de serv e infraestructura","12 d\xedas","Alta","Comprador(a)",32,"No"],[34,"HITO: 2o anticipo pagado serv e infraestructura","0 d\xedas","Alta","Tesorero",33,"Si"],[35,"Gesti\xf3n entrada \xfaltima factura de serv e infraestructura","100 d\xedas","Alta","Team leader",32,"No"],[36,"HITO: Factura pagada de serv e infraestructura","0 d\xedas","Alta","Tesorero",35,"Si"],[37,"Inicio de fabricaci\xf3n de maquinaria","1 d\xeda","Alta","Proveedores",13,"No"],[38,"Control de calidad durante fabricaci\xf3n","100 d\xedas","Media","Proveedores",37,"No"],[39,"Inspecci\xf3n intermedia","5 d\xedas","Media","Team leader",38,"No"],[40,"Pruebas de f\xe1brica (FAT)","10 d\xedas","Alta","Project Manager",38,"No"],[41,"Gesti\xf3n de 2o anticipo de pago","12 d\xedas","Alta","Comprador(a)",40,"No"],[42,"HITO: 2o anticipo linea de salsas pagado","0 d\xedas","Alta","Tesorero",41,"Si"],[43,"Preparaci\xf3n para env\xedo y embalaje","10 d\xedas","Media","Proveedores",38,"No"],[44,"HITO: FAT Completado","0 d\xedas","Alta","Project Manager",43,"Si"],[45,"Transporte terrestre a puerto","2 d\xedas","Media","Proveedores",44,"No"],[46,"Tr\xe1mites de exportaci\xf3n en origen","1 d\xeda","Media","Proveedores",45,"No"],[47,"Transporte a\xe9reo Origen - Destino","2 d\xedas","Media","Proveedores",46,"No"],[48,"Tr\xe1mites de importaci\xf3n","5 d\xedas","Media","Proveedores",47,"No"],[49,"Liberaci\xf3n aduanal","5 d\xedas","Media","Proveedores",48,"No"],[50,"Transporte hacia Destino","2 d\xedas","Alta","Proveedores",49,"No"],[51,"HITO: Maquinaria entregada a Destino","0 d\xedas","Alta","Proveedores",50,"Si"],[52,"Recepci\xf3n e inspecci\xf3n de equipos","1 d\xeda","Media","Team leader",50,"No"],[53,"Descarga y posicionamiento","2 d\xedas","Media","Team leader",32,"No"],[54,"Montaje de equipos","3 d\xedas","Media","Team leader",53,"No"],[55,"Conexiones el\xe9ctricas y de control","2 d\xedas","Media","Team leader",54,"No"],[56,"Conexiones de vapor y aire comprimido","2 d\xedas","Media","Team leader",55,"No"],[57,"Integraci\xf3n de maquinaria","2 d\xedas","Media","Team leader",56,"No"],[58,"Instalaci\xf3n de sistemas de seguridad","2 d\xedas","Media","Team leader",57,"No"],[59,"HITO: Instalaci\xf3n de maquinaria completada","0 d\xedas","Alta","Team leader",58,"Si"],[60,"Pruebas de integraci\xf3n","1 d\xeda","Alta","Team leader",59,"No"],[61,"Validaci\xf3n de procesos","1 d\xeda","Alta","Team leader",60,"No"],[62,"Documentaci\xf3n de resultados","0 d\xedas","Alta","Team leader",61,"No"],[63,"HITO: Pruebas Exitosas","0 d\xedas","Alta","Team leader",62,"Si"],[64,"Gesti\xf3n de pago de 3er anticipo","12 d\xedas","Alta","Comprador(a)",63,"No"],[65,"HITO: 3er anticipo pagado","0 d\xedas","Alta","Comprador(a)",64,"Si"],[66,"Capacitaci\xf3n a operadores","2 d\xedas","Media","Proveedores",65,"No"],[67,"Capacitaci\xf3n a personal de mantenimiento","2 d\xedas","Media","Proveedores",63,"No"],[68,"Capacitaci\xf3n en control de calidad","1 d\xeda","Media","Proveedores",63,"No"],[69,"Entrega de manuales y documentaci\xf3n","0 d\xedas","Media","Proveedores",68,"No"],[70,"Certificaci\xf3n final de equipos","1 d\xeda","Media","Project Manager",69,"No"],[71,"HITO: Personal Capacitado","0 d\xedas","Alta","Team leader",70,"Si"],[72,"Evaluaci\xf3n post-implementaci\xf3n","2 d\xedas","Media","Project Manager",71,"No"],[73,"Documentaci\xf3n de lecciones aprendidas","2 d\xedas","Media","Team leader",72,"No"],[74,"Entrega de garant\xedas y seguros","1 d\xeda","Media","Team leader",73,"No"],[75,"Cierre administrativo y financiero","1 d\xeda","Media","Project Manager",73,"No"],[76,"HITO: Proyecto completado","0 d\xedas","Media","Project Manager",75,"Si"]];return this.templateData=this.parseTemplateData(e),console.log("\u2705 Template cargado exitosamente:",this.templateData.activities.length,"actividades"),this.templateData}catch(e){throw console.error("\u274c Error cargando template:",e),e}}parseTemplateData(e){const a=[],t=[];return e.slice(1).forEach((e,s)=>{if(e&&e.length>0&&e[1]&&""!==e[1].trim()){var r;const s={id:e[0],originalId:e[0],name:e[1].trim(),duration:this.parseDuration(e[2]),priority:this.parsePriority(e[3]),responsible:(null===(r=e[4])||void 0===r?void 0:r.trim())||"Sin asignar",predecessor:e[5]||null,isMilestone:"Si"===e[6]||e[1].toLowerCase().includes("hito"),category:this.categorizeActivity(e[1]),phase:this.determinePhase(e[1],e[0]),templateBased:!0,customizable:this.isCustomizable(e[1],e[0])};a.push(s),s.isMilestone&&t.push({id:s.id,name:s.name,phase:s.phase,description:"Hito: ".concat(s.name)})}}),{activities:a,milestones:t,metadata:{totalActivities:a.length,totalMilestones:t.length,templateVersion:"1.0",loadedAt:(new Date).toISOString()}}}parseDuration(e){if(!e)return 1;const a=e.toString().match(/(\d+)/);return a?parseInt(a[1]):1}parsePriority(e){if(!e)return"medium";const a=e.toLowerCase();return a.includes("alta")?"high":a.includes("media")?"medium":a.includes("baja")?"low":"medium"}categorizeActivity(e){const a=e.toLowerCase();return a.includes("hito")||a.includes("aprobaci\xf3n")||a.includes("contrato")?"milestone":a.includes("fabricaci\xf3n")||a.includes("producci\xf3n")||a.includes("manufactura")?"manufacturing":a.includes("importaci\xf3n")||a.includes("aduana")||a.includes("embarque")?"import":a.includes("instalaci\xf3n")||a.includes("montaje")||a.includes("conexi\xf3n")?"installation":a.includes("prueba")||a.includes("test")||a.includes("validaci\xf3n")?"testing":a.includes("capacitaci\xf3n")||a.includes("entrenamiento")?"training":a.includes("infraestructura")||a.includes("servicios")||a.includes("cimentaci\xf3n")?"infrastructure":a.includes("anticipo")||a.includes("pago")?"financial":"general"}determinePhase(e,a){const t=parseInt(a);return t>=1&&t<=13?"Planificaci\xf3n":t>=14&&t<=20?"Dise\xf1o":t>=21&&t<=36?"Infraestructura":t>=37&&t<=44?"Fabricaci\xf3n":t>=45&&t<=51?"Importaci\xf3n":t>=52&&t<=63?"Instalaci\xf3n":t>=64&&t<=76?"Cierre":"General"}isCustomizable(e,a){const t=e.toLowerCase(),s=parseInt(a);return 38===s&&t.includes("fabricaci\xf3n")?{type:"manufacturing_time",field:"duration"}:11===s&&t.includes("anticipo")||41===s&&t.includes("anticipo")||64===s&&t.includes("anticipo")?{type:"payment_timing",field:"predecessor"}:s>=45&&s<=50?{type:"conditional",field:"include",condition:"isForeignEquipment"}:s>=25&&s<=31?{type:"conditional",field:"include",condition:"requiresInfrastructure"}:null}mapTeamRoles(e,a){const t={"Team leader":["team_lead","engineer","analyst","technician"],"Comprador(a)":["buyer","specialist","analyst"],"Project Manager":["project_manager"],Proveedores:["external"],Tesorero:["other","specialist"]}[e]||["other"];for(const s of t){const e=a.find(e=>e.role===s);if(e)return{assignedTo:e.name,role:e.role,experience:e.experience}}if(a.length>0){const e=a[0];return{assignedTo:e.name,role:e.role,experience:e.experience}}return{assignedTo:"Sin asignar",role:"other",experience:"intermediate"}}customizeActivities(e,a){return console.log("\ud83d\udd27 Personalizando actividades del template..."),e.map(e=>{var t,r;const o=(0,s.A)({},e);if(a.teamMembers&&a.teamMembers.length>0){const t=this.mapTeamRoles(e.responsible,a.teamMembers);o.assignedTo=t.assignedTo,o.assignedRole=t.role,o.assignedExperience=t.experience}else o.assignedTo=e.responsible;if("manufacturing_time"===(null===(t=e.customizable)||void 0===t?void 0:t.type)&&a.deliveryTime&&a.deliveryTimeUnit){const t=this.convertToDays(a.deliveryTime,a.deliveryTimeUnit);o.duration=t,console.log('\ud83d\udd27 Ajustando "'.concat(e.name,'": ').concat(e.duration,"d \u2192 ").concat(t,"d (tiempo de entrega)"))}if("payment_timing"===(null===(r=e.customizable)||void 0===r?void 0:r.type)&&a.advancePayments&&a.advancePayments.length>0){const t=this.getPaymentTimingFromActivity(e.originalId),s=a.advancePayments.find(e=>e.timing===t);s&&console.log('\ud83d\udcb0 Ajustando timing de "'.concat(e.name,'" seg\xfan configuraci\xf3n: ').concat(s.timing))}return o})}getPaymentTimingFromActivity(e){switch(parseInt(e)){case 11:default:return"order";case 41:return"shipping";case 64:return"delivery"}}convertToDays(e,a){switch(a){case"days":default:return e;case"weeks":return 7*e;case"months":return 30*e}}filterConditionalActivities(e,a){return console.log("\ud83d\udd0d Filtrando actividades condicionales..."),e.filter(e=>{if(!e.customizable)return!0;if("conditional"===e.customizable.type){const t=e.customizable.condition;if("isForeignEquipment"===t){const t=!0===a.isForeignEquipment;return console.log("".concat(t?"\u2705":"\u274c"," ").concat(t?"Incluyendo":"Excluyendo"," actividad de importaci\xf3n: ").concat(e.name)),t}if("requiresInfrastructure"===t){const t=!0===a.requiresInfrastructure;return console.log("".concat(t?"\u2705":"\u274c"," ").concat(t?"Incluyendo":"Excluyendo"," actividad de infraestructura: ").concat(e.name)),t}}return!0})}async generateTemplateBasedSchedule(e){try{var a;console.log("\ud83d\ude80 TEMPLATE-BASED SCHEDULER: Iniciando generaci\xf3n..."),console.log("\ud83d\udccb Wizard Data:",e),this.templateData||(console.log("\ud83d\udccb Cargando template..."),await this.loadTemplate()),console.log("\ud83d\udd27 Personalizando actividades...");let t=this.customizeActivities(this.templateData.activities,e);console.log("\ud83d\udd27 Actividades personalizadas:",t.length),console.log("\ud83d\udd27 Filtrando actividades condicionales..."),t=this.filterConditionalActivities(t,e),console.log("\ud83d\udd27 Actividades filtradas:",t.length),console.log("\ud83d\udd27 Filtrando hitos...");const s=this.templateData.milestones.filter(e=>void 0!==t.find(a=>a.id===e.id));console.log("\ud83d\udd27 Hitos filtrados:",s.length),console.log("\ud83d\udd27 Calculando ruta cr\xedtica y dependencias...");const r=this.calculateCriticalPath(t),o=r.activities,n=r.criticalPath;console.log("\ud83d\udd27 Actividades con dependencias:",o.length);const i={activities:o,milestones:s,criticalPath:n,recommendations:this.generateRecommendations(e,o),metadata:{templateUsed:"Template compra de equipos.xlsx",templateId:"template-compra-equipos-v1",generatedAt:(new Date).toISOString(),wizardData:e,estimatedDuration:this.calculateTotalDuration(t),complexity:this.assessComplexity(e,t),customizationApplied:{manufacturingTime:e.deliveryTime?"".concat(e.deliveryTime," ").concat(e.deliveryTimeUnit):"default",advancePayments:(null===(a=e.advancePayments)||void 0===a?void 0:a.length)||0,infrastructureIncluded:e.requiresInfrastructure||!1,importIncluded:e.isForeignEquipment||!1}}};return console.log("\u2705 TEMPLATE-BASED SCHEDULER: Cronograma generado exitosamente"),console.log("\ud83d\udcca Actividades: ".concat(t.length,", Hitos: ").concat(s.length)),console.log("\ud83d\udcc5 Primeras 5 actividades con fechas:"),o.slice(0,5).forEach((e,a)=>{console.log("  ".concat(a+1,". ").concat(e.name,": ").concat(e.startDate," - ").concat(e.endDate))}),i}catch(t){throw console.error("\u274c TEMPLATE-BASED SCHEDULER: Error generando cronograma:",t),t}}calculateCriticalPath(e){const a=this.applyDependencies(e),t=this.calculateDates(a);return{activities:t,criticalPath:this.identifyCriticalPath(t)}}applyDependencies(e){console.log("\ud83d\udd17 Aplicando dependencias del template...");const a=e.map(a=>{const t=[];if(a.predecessor&&""!==a.predecessor){const s=e.find(e=>e.originalId===a.predecessor);s?(t.push(s.id),console.log("\ud83d\udd17 ".concat(a.name," (ID: ").concat(a.id,") depende de ").concat(s.name," (ID: ").concat(s.id,")"))):console.warn("\u26a0\ufe0f Predecesora ".concat(a.predecessor," no encontrada para ").concat(a.name))}return(0,s.A)((0,s.A)({},a),{},{dependencies:t})});console.log("\ud83d\udd0d Verificando dependencias circulares...");return this.checkCircularDependencies(a)?console.error("\u274c Se detectaron dependencias circulares en el template!"):console.log("\u2705 No se detectaron dependencias circulares"),a}checkCircularDependencies(e){const a=new Set,t=new Set,s=r=>{if(t.has(r))return console.error("\u274c Dependencia circular detectada: ".concat(r)),!0;if(a.has(r))return!1;a.add(r),t.add(r);const o=e.find(e=>e.id===r);if(o)for(const e of o.dependencies)if(s(e))return!0;return t.delete(r),!1};for(const r of e)if(!a.has(r.id)&&s(r.id))return!0;return!1}calculateDates(e){console.log("\ud83d\udcc5 Calculando fechas basadas en dependencias (algoritmo robusto)...");const a=[...e],t=new Date("2025-09-28");a.forEach(e=>{e.startDate=null,e.endDate=null});const s=new Map;a.forEach(e=>{s.set(e.id,e)});const r=e=>{if(e.startDate&&e.endDate)return;console.log("\ud83d\udd0d Calculando: ".concat(e.name," (ID: ").concat(e.originalId,")"));let a=new Date(t);if(e.dependencies.length>0){console.log("\ud83d\udd17 Dependencias de ".concat(e.name,":"),e.dependencies),e.dependencies.forEach(e=>{const a=s.get(e);a&&r(a)});let t=null;e.dependencies.forEach(e=>{const a=s.get(e);a&&a.endDate&&(console.log("  \ud83d\udcc5 Dependencia ".concat(a.name," termina: ").concat(a.endDate.toLocaleDateString())),(!t||a.endDate>t)&&(t=new Date(a.endDate)))}),t&&(a=new Date(t),a.setDate(a.getDate()+1),console.log("\u2705 ".concat(e.name," inicia despu\xe9s de dependencias: ").concat(a.toLocaleDateString())))}else console.log("\ud83d\udcc5 ".concat(e.name," sin dependencias, inicia en: ").concat(a.toLocaleDateString()));const o=new Date(a);o.setDate(o.getDate()+e.duration-1),e.startDate=a,e.endDate=o,e.earlyStart=a,e.earlyFinish=o,e.templateCalculated=!0,console.log("\ud83d\udcc5 ".concat(e.name,": ").concat(a.toLocaleDateString()," - ").concat(o.toLocaleDateString()," (").concat(e.duration," d\xedas)"))};return[...a].sort((e,a)=>e.originalId-a.originalId).forEach(e=>{r(e)}),console.log("\ud83d\udd0d Verificando dependencias..."),a.forEach(e=>{e.dependencies.length>0&&e.dependencies.forEach(a=>{const t=s.get(a);t&&t.endDate&&e.startDate&&(e.startDate<=t.endDate?console.error("\u274c ERROR: ".concat(e.name," inicia ").concat(e.startDate.toLocaleDateString()," pero su dependencia ").concat(t.name," termina ").concat(t.endDate.toLocaleDateString())):console.log("\u2705 OK: ".concat(e.name," inicia ").concat(e.startDate.toLocaleDateString()," despu\xe9s de ").concat(t.name," que termina ").concat(t.endDate.toLocaleDateString())))})}),a}topologicalSort(e){console.log("\ud83d\udd04 Iniciando ordenamiento topol\xf3gico...");const a=new Set,t=new Set,s=[],r=o=>{if(t.has(o.id))throw new Error("Dependencia circular detectada");a.has(o.id)||(t.add(o.id),console.log("\ud83d\udd0d Visitando: ".concat(o.name," (ID: ").concat(o.id,")")),o.dependencies.forEach(a=>{const t=e.find(e=>e.id===a);t&&(console.log("  \u21b3 Dependencia: ".concat(t.name," (ID: ").concat(a,")")),r(t))}),t.delete(o.id),a.add(o.id),s.push(o),console.log("\u2705 Agregado a resultado: ".concat(o.name)))};return[...e].sort((e,a)=>e.originalId-a.originalId).forEach(e=>{a.has(e.id)||r(e)}),console.log("\ud83d\udd04 Ordenamiento topol\xf3gico completado. Orden final:"),s.forEach((e,a)=>{console.log("  ".concat(a+1,". ").concat(e.name," (ID: ").concat(e.id,")"))}),s}identifyCriticalPath(e){return e.filter(e=>"high"===e.priority||e.isMilestone)}generateRecommendations(e,a){const t=[];return e.isForeignEquipment&&t.push({type:"info",title:"Equipo Extranjero",message:"Se incluyeron actividades de importaci\xf3n y aduanas en el cronograma."}),e.requiresInfrastructure&&t.push({type:"info",title:"Infraestructura Requerida",message:"Se incluyeron actividades de preparaci\xf3n de sitio e infraestructura."}),e.advancePayments&&e.advancePayments.length>0&&t.push({type:"financial",title:"Anticipos Configurados",message:"Se configuraron ".concat(e.advancePayments.length," anticipos seg\xfan tus especificaciones.")}),t}calculateTotalDuration(e){return e.reduce((e,a)=>e+a.duration,0)}assessComplexity(e,a){let t="medium";return a.length>50?t="high":a.length<30&&(t="low"),e.isForeignEquipment&&e.requiresInfrastructure&&(t="high"),t}};const h=new class{constructor(){this.supabase=null,this.organizationId=null,this.currentUser=null}async initialize(e,a,t){this.supabase=e,this.organizationId=a,this.currentUser=t,console.log("\ud83e\udd16 SmartSchedulerService inicializado:",{organizationId:a,userId:null===t||void 0===t?void 0:t.id})}async generateSmartSchedule(e){try{var a;if(console.log("\ud83e\udd16 AISchedulerService: Generando cronograma inteligente:",e),console.log("\ud83d\udd0d AISchedulerService: projectType =",e.projectType),console.log('\ud83d\udd0d AISchedulerService: projectType === "equipment_installation"?',"equipment_installation"===e.projectType),"equipment_installation"===e.projectType)return console.log("\ud83c\udfed AISchedulerService: Proyecto de compra de equipos detectado - usando template real"),await g.generateTemplateBasedSchedule(e);const t=await this.getBaseTemplate(e);if(console.log("\ud83d\udccb Template seleccionado:",null===t||void 0===t?void 0:t.name),!t)throw new Error("No se pudo seleccionar un template v\xe1lido");console.log("\ud83d\udd0d Template antes de ajustar actividades:",{hasTemplateData:!!t.template_data,hasActivities:!!t.activities,activitiesLength:(null===(a=t.activities)||void 0===a?void 0:a.length)||0,templateKeys:Object.keys(t)}),console.log("\ud83d\udccb Usando actividades del template base");const s=await this.extractActivitiesFromTemplate(t,e),r=await this.adjustActivitiesByContext(t,e,s);console.log("\u2699\ufe0f Actividades ajustadas:",r.length);const o=await this.generateSmartMilestones(r,e);console.log("\ud83c\udfaf Hitos generados:",o.length);const n=this.calculateCriticalPath(r);console.log("\ud83d\udd17 Ruta cr\xedtica calculada:",n.length,"actividades");const i=this.generateRecommendations(e,r);console.log("\ud83d\udca1 Recomendaciones generadas:",i.length);let l=r;"equipment_installation"===e.projectType&&(l=this.sortMachineryActivities(r,e),console.log("\ud83d\udccb Actividades ordenadas l\xf3gicamente"));const c={activities:l,milestones:o,criticalPath:n,recommendations:i,metadata:{templateUsed:null===t||void 0===t?void 0:t.name,templateId:null===t||void 0===t?void 0:t.id,generatedAt:(new Date).toISOString(),wizardData:e,estimatedDuration:this.calculateTotalDuration(l),complexity:this.assessComplexity(e,l)}};return await this.saveGenerationHistory(e,c),console.log("\u2705 Cronograma generado exitosamente"),c}catch(t){throw console.error("\u274c Error generando cronograma:",t),new Error("Error generando cronograma: ".concat(t.message))}}async getBaseTemplate(e){try{const{projectType:a,industry:t,methodology:s}=e;if(!this.supabase){console.log("\ud83d\udccb Usando template gen\xe9rico (Sin Supabase)");const a={id:"generic-template",name:"Template Gen\xe9rico de Proyecto",description:"Template gen\xe9rico basado en mejores pr\xe1cticas de gesti\xf3n de proyectos",project_type:e.projectType||"general",industry:e.industry||"general",methodology:e.methodology||"waterfall",template_data:this.getGenericTemplateData(e)};return a.template_data&&a.template_data.phases&&(a.activities=this.extractActivitiesFromPhases(a.template_data.phases),a.milestones=this.extractMilestonesFromPhases(a.template_data.phases)),a}let r=this.supabase.from("schedule_templates").select("*");r=this.organizationId?r.or("organization_id.eq.".concat(this.organizationId,",organization_id.is.null")):r.is("organization_id",null),a&&(r=r.eq("project_type",a)),t&&(r=r.eq("industry",t)),s&&(r=r.eq("methodology",s));const{data:o,error:n}=await r;if(n)throw console.error("Error obteniendo templates:",n),n;if(console.log("\ud83d\udccb Templates encontrados:",(null===o||void 0===o?void 0:o.length)||0),!o||0===o.length){console.warn("No se encontraron templates espec\xedficos, usando template gen\xe9rico");let a=this.supabase.from("schedule_templates").select("*");a=this.organizationId?a.or("organization_id.eq.".concat(this.organizationId,",organization_id.is.null")):a.is("organization_id",null);const{data:t}=await a.limit(1);if(null!==t&&void 0!==t&&t[0])return t[0];console.log("\ud83d\udccb Creando template gen\xe9rico para el proyecto");const s={id:"generic-template",name:"Template Gen\xe9rico de Proyecto",description:"Template gen\xe9rico basado en mejores pr\xe1cticas de gesti\xf3n de proyectos",project_type:e.projectType||"general",industry:e.industry||"general",methodology:e.methodology||"waterfall",template_data:this.getGenericTemplateData(e)};return s.template_data&&s.template_data.phases&&(s.activities=this.extractActivitiesFromPhases(s.template_data.phases),s.milestones=this.extractMilestonesFromPhases(s.template_data.phases)),s}const i=this.rankTemplates(o,e)[0];return i&&i.template_data&&i.template_data.phases&&(i.activities=this.extractActivitiesFromPhases(i.template_data.phases),i.milestones=this.extractMilestonesFromPhases(i.template_data.phases)),i}catch(a){return console.error("Error obteniendo template base:",a),null}}async adjustActivitiesByContext(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return console.warn("Template no v\xe1lido para ajustar actividades"),[];let s=t;if(s||(s=e.activities,!s&&e.template_data&&e.template_data.phases&&(s=this.extractActivitiesFromPhases(e.template_data.phases))),!s||0===s.length)return console.warn("No hay actividades disponibles en el template"),[];const r=[];let o=1;const n=this.calculateTeamSizeMultiplier(a.teamSize),i=this.calculateExperienceMultiplier(a.teamExperience);return s.forEach((e,t)=>{let s=e.duration;s=Math.ceil(s*n*i),"equipment_installation"===a.projectType&&(s=this.adjustMachineryActivityDuration(e,s,a)),"low"===a.riskTolerance?s=Math.ceil(1.2*s):"high"===a.riskTolerance&&(s=Math.ceil(.8*s));const l={id:"ai-".concat(o++),name:e.name,description:this.generateActivityDescription(e,a),duration:Math.max(1,s),category:e.category||"execution",phase:e.phase||"General",phaseIndex:e.phaseIndex||0,activityIndex:t,isMilestone:e.isMilestone||!1,priority:this.determinePriority(e,a),assignedTo:this.suggestAssignee(e,a),dependencies:e.dependencies||[],estimatedCost:this.estimateCost(e,a),requiredSkills:e.requiredSkills||[],parallel:e.parallel||!1,generatedBy:"ai",confidence:this.calculateConfidence(e,a)};r.push(l)}),r.forEach((e,a)=>{e.dependencies&&e.dependencies.length>0?e.dependencies=this.adjustDependencies(e.dependencies,r):a>0&&(e.dependencies=[r[a-1].id],console.log("\ud83d\udd17 Agregando dependencia secuencial: ".concat(e.name," depende de ").concat(r[a-1].name)))}),r}async generateSmartMilestones(e,a){const t=[];let s=1;const r={};e.forEach(e=>{r[e.phase]||(r[e.phase]=[]),r[e.phase].push(e)}),Object.entries(r).forEach(e=>{let[r,o]=e;const n={id:"milestone-".concat(s++),name:"HITO: ".concat(r," Completada"),description:"Completar todas las actividades de la fase: ".concat(r),phase:r,isMilestone:!0,duration:0,startDate:null,endDate:null,progress:0,status:"pending",priority:"high",assignedTo:a.projectManager||"Pendiente",dependencies:[],criteria:this.generateMilestoneCriteria(r,o),generatedBy:"ai",confidence:.9};t.push(n)});const o=this.generateSpecificMilestones(a,e);return t.push(...o),t}calculateCriticalPath(e){return e.filter(e=>"high"===e.priority||e.dependencies.length>2||e.estimatedCost>1e4).map(e=>e.id)}generateRecommendations(e,a){const t=[];e.teamSize<3&&t.push({type:"team",priority:"high",title:"Equipo Peque\xf1o",description:"Con un equipo peque\xf1o, considera reducir el paralelismo de actividades para evitar sobrecarga.",action:"Revisar actividades paralelas y secuencializar si es necesario"}),"junior"===e.teamExperience&&t.push({type:"experience",priority:"medium",title:"Equipo Junior",description:"Equipo con poca experiencia. Considera agregar tiempo de capacitaci\xf3n y mentor\xeda.",action:"Agregar actividades de capacitaci\xf3n y revisi\xf3n adicional"});this.calculateTotalDuration(a)>180&&t.push({type:"duration",priority:"high",title:"Proyecto de Larga Duraci\xf3n",description:"Proyecto de m\xe1s de 6 meses. Considera dividir en fases m\xe1s peque\xf1as.",action:"Implementar hitos de control mensuales"});return a.filter(e=>"high"===e.priority).length>.3*a.length&&t.push({type:"complexity",priority:"medium",title:"Alta Complejidad",description:"Muchas actividades de alta complejidad. Considera agregar buffers de tiempo.",action:"Agregar 15% de buffer en estimaciones de tiempo"}),t}async saveGenerationHistory(e,a){try{const t={project_id:e.projectId,template_id:a.metadata.templateId||null,input_data:e,generated_schedule:a,created_by:this.currentUser.id,organization_id:this.organizationId},{error:s}=await this.supabase.from("ai_schedule_generations").insert(t);s?console.error("Error guardando historial de generaci\xf3n:",s):console.log("\u2705 Historial de generaci\xf3n guardado")}catch(t){console.error("Error guardando historial:",t)}}calculateTeamSizeMultiplier(e){return e<=2?1.3:e<=5?1:e<=8?.9:.8}calculateExperienceMultiplier(e){switch(e){case"junior":return 1.4;case"intermediate":return 1.1;case"senior":return.9;case"expert":return.8;default:return 1}}generateActivityDescription(e,a){const t=e.description||"Ejecutar ".concat(e.name);return a.projectDescription?"".concat(t," para el proyecto: ").concat(a.projectDescription):t}determinePriority(e,a){return"planning"===e.category||"testing"===e.category||e.isMilestone?"high":(e.parallel,"medium")}suggestAssignee(e,a){if(a.projectManager)return a.projectManager;switch(e.category){case"planning":case"delivery":return"Project Manager";case"execution":return"Team Lead";case"testing":return"QA Lead";default:return"Pendiente"}}adjustDependencies(e,a){if(!e||!Array.isArray(e))return console.log("\ud83d\udd17 Dependencias no definidas o inv\xe1lidas, usando array vac\xedo"),[];const t=e.map(e=>{if("string"===typeof e&&e.startsWith("activity-"))return e;if("number"===typeof e)return e;const t=a.find(a=>a.name===e);return t?(console.log('\ud83d\udd17 Mapeando dependencia "'.concat(e,'" a ID "').concat(t.id,'"')),t.id):(console.warn('\u26a0\ufe0f Dependencia "'.concat(e,'" no encontrada en actividades existentes')),null)}).filter(e=>null!==e);return console.log("\ud83d\udd17 Dependencias ajustadas: [".concat(t.join(", "),"]")),t}estimateCost(e,a){return(e.estimatedCost||1e3)*(a.teamSize||1)*(e.duration||1)*.1}calculateConfidence(e,a){let t=.7;return a.projectType&&a.industry&&(t+=.2),"senior"!==a.teamExperience&&"expert"!==a.teamExperience||(t+=.1),Math.min(1,t)}generateMilestoneCriteria(e,a){const t=a.map(e=>e.name).join(", ");return"Completar exitosamente: ".concat(t)}generateSpecificMilestones(e,a){const t=[];let s=1e3;switch(e.projectType){case"equipment_installation":t.push({id:"milestone-".concat(s++),name:"HITO: Equipo Recibido y Verificado",description:"Equipo recibido, inspeccionado y verificado seg\xfan especificaciones",isMilestone:!0,duration:0,progress:0,status:"pending",priority:"high",assignedTo:"Quality Inspector",criteria:"Equipo recibido, inspecci\xf3n de calidad aprobada, documentaci\xf3n verificada",generatedBy:"ai",confidence:.9});break;case"development":t.push({id:"milestone-".concat(s++),name:"HITO: C\xf3digo en Producci\xf3n",description:"C\xf3digo desplegado y funcionando en ambiente de producci\xf3n",isMilestone:!0,duration:0,progress:0,status:"pending",priority:"high",assignedTo:"DevOps Lead",criteria:"Deployment exitoso, pruebas de humo pasando, monitoreo activo",generatedBy:"ai",confidence:.9})}return t}calculateTotalDuration(e){return e.reduce((e,a)=>e+(a.duration||0),0)}assessComplexity(e,a){let t="medium";const s=this.calculateTotalDuration(a),r=a.filter(e=>"high"===e.priority).length,o=e.teamSize||1;return s>120||r>5||o<3?t="high":s<30&&r<3&&o>=5&&(t="low"),t}rankTemplates(e,a){return e.sort((e,t)=>{let s=0,r=0;return e.project_type===a.projectType&&(s+=3),t.project_type===a.projectType&&(r+=3),e.industry===a.industry&&(s+=2),t.industry===a.industry&&(r+=2),e.methodology===a.methodology&&(s+=1),t.methodology===a.methodology&&(r+=1),r-s})}getGenericTemplateData(e){const{projectType:a="general",teamSize:t=5}=e,s={manufacturing:[{name:"Planificaci\xf3n",activities:[{name:"Definici\xf3n de requerimientos",duration:5,category:"planning"},{name:"Dise\xf1o conceptual",duration:10,category:"design"},{name:"Planificaci\xf3n de recursos",duration:3,category:"planning"}]},{name:"Dise\xf1o y Desarrollo",activities:[{name:"Dise\xf1o detallado",duration:15,category:"design"},{name:"Especificaciones t\xe9cnicas",duration:8,category:"design"},{name:"Prototipo",duration:20,category:"development"}]},{name:"Implementaci\xf3n",activities:[{name:"Compra e instalaci\xf3n de maquinas y equipos",duration:30,category:"procurement",isMilestone:!0},{name:"Instalaci\xf3n y configuraci\xf3n",duration:15,category:"implementation"},{name:"Pruebas de funcionamiento",duration:10,category:"testing"}]},{name:"Cierre",activities:[{name:"Capacitaci\xf3n del personal",duration:5,category:"training"},{name:"Documentaci\xf3n final",duration:3,category:"documentation"},{name:"Entrega del proyecto",duration:2,category:"delivery",isMilestone:!0}]}],general:[{name:"Inicio",activities:[{name:"Kick-off del proyecto",duration:1,category:"planning",isMilestone:!0},{name:"Definici\xf3n de alcance",duration:5,category:"planning"},{name:"Planificaci\xf3n inicial",duration:7,category:"planning"}]},{name:"Ejecuci\xf3n",activities:[{name:"Desarrollo de actividades principales",duration:20,category:"execution"},{name:"Seguimiento y control",duration:15,category:"monitoring"},{name:"Gesti\xf3n de cambios",duration:8,category:"management"}]},{name:"Cierre",activities:[{name:"Pruebas finales",duration:5,category:"testing"},{name:"Entrega del proyecto",duration:3,category:"delivery",isMilestone:!0}]}]};return{phases:s[a]||s.general,estimatedDuration:60,complexity:"medium",riskLevel:"medium"}}async getAvailableTemplates(){try{let e=this.supabase.from("schedule_templates").select("*");e=this.organizationId?e.or("organization_id.eq.".concat(this.organizationId,",organization_id.is.null")):e.is("organization_id",null);const{data:a,error:t}=await e.order("name");return t?(console.error("Error obteniendo templates:",t),[]):a||[]}catch(e){return console.error("Error obteniendo templates:",e),[]}}async getGenerationHistory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let a=this.supabase.from("ai_schedule_generations").select("*").eq("organization_id",this.organizationId).order("created_at",{ascending:!1});e&&(a=a.eq("project_id",e));const{data:t,error:s}=await a;return s?(console.error("Error obteniendo historial:",s),[]):t||[]}catch(a){return console.error("Error obteniendo historial:",a),[]}}async provideFeedback(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{const{error:s}=await this.supabase.from("ai_schedule_generations").update({feedback_score:a,feedback_comments:t,updated_at:(new Date).toISOString()}).eq("id",e).eq("organization_id",this.organizationId);return s?(console.error("Error guardando feedback:",s),!1):(console.log("\u2705 Feedback guardado exitosamente"),!0)}catch(s){return console.error("Error guardando feedback:",s),!1}}extractActivitiesFromPhases(e){if(!e||!Array.isArray(e))return[];const a=[];let t=1;return e.forEach((e,s)=>{e.activities&&Array.isArray(e.activities)&&e.activities.forEach((r,o)=>{a.push({id:"activity-".concat(t),name:r.name,duration:r.duration||1,category:r.category||"general",phase:e.name,phaseIndex:s,activityIndex:o,isMilestone:r.isMilestone||!1,priority:r.priority||"medium",dependencies:r.dependencies||[]}),t++})}),a.forEach((e,t)=>{e.dependencies&&0!==e.dependencies.length||(e.dependencies=0===t?[]:[a[t-1].id])}),console.log("\ud83d\udccb Actividades extra\xeddas de fases: ".concat(a.length)),console.log("\ud83d\udd17 Dependencias generadas autom\xe1ticamente para ".concat(a.length," actividades")),a}async extractActivitiesFromTemplate(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=[];if(e.activities&&e.activities.length>0)t=e.activities;else{if(!e.template_data||!e.template_data.phases)return console.warn("No se pudieron extraer actividades del template"),[];t=this.extractActivitiesFromPhases(e.template_data.phases)}return a&&"equipment_installation"===a.projectType&&(t=this.addMachinerySpecificActivities(t,a)),t}extractMilestonesFromPhases(e){if(!e||!Array.isArray(e))return[];const a=[];let t=1;return e.forEach((e,s)=>{e.activities&&Array.isArray(e.activities)&&e.activities.forEach((r,o)=>{r.isMilestone&&(a.push({id:"milestone-".concat(t),name:r.name,phase:e.name,phaseIndex:s,activityIndex:o,description:r.description||"Hito: ".concat(r.name)}),t++)})}),console.log("\ud83d\udccb Hitos extra\xeddos de fases: ".concat(a.length)),a}adjustMachineryActivityDuration(e,a,t){const s=e.name.toLowerCase();let r=a;if(s.includes("fabricaci\xf3n")||s.includes("manufactura")||s.includes("producci\xf3n")||s.includes("manufacturing"))if(t.deliveryTime&&t.deliveryTimeUnit){r=this.convertToDays(t.deliveryTime,t.deliveryTimeUnit),console.log('\ud83d\udd27 Ajustando "'.concat(e.name,'": ').concat(a,"d \u2192 ").concat(r,"d (tiempo de entrega: ").concat(t.deliveryTime," ").concat(t.deliveryTimeUnit,")"))}else console.log('\u26a0\ufe0f No se pudo ajustar "'.concat(e.name,'": deliveryTime=').concat(t.deliveryTime,", deliveryTimeUnit=").concat(t.deliveryTimeUnit));return(s.includes("aprobaci\xf3n")||s.includes("aprobaci\xf3n de compras")||s.includes("autorizaci\xf3n")||s.includes("firma de contratos"))&&(r=Math.min(r,5),console.log('\ud83d\udccb Ajustando "'.concat(e.name,'": ').concat(a,"d \u2192 ").concat(r,"d (actividad administrativa)"))),t.isForeignEquipment&&(s.includes("importaci\xf3n")||s.includes("aduana")||s.includes("embarque")||s.includes("transporte"))&&(r=Math.max(r,15),console.log('\ud83c\udf0d Ajustando "'.concat(e.name,'": ').concat(a,"d \u2192 ").concat(r,"d (importaci\xf3n)"))),t.requiresInfrastructure&&(s.includes("instalaci\xf3n")||s.includes("infraestructura")||s.includes("preparaci\xf3n")||s.includes("cimentaci\xf3n"))&&(r=Math.max(r,10),console.log('\ud83d\udd27 Ajustando "'.concat(e.name,'": ').concat(a,"d \u2192 ").concat(r,"d (infraestructura)"))),r}convertToDays(e,a){switch(a){case"days":default:return e;case"weeks":return 7*e;case"months":return 30*e}}addMachinerySpecificActivities(e,a){const t=[...e];let s=e.length+1;if(a.isForeignEquipment){const e=[{id:"activity-".concat(s++),name:"Proceso de importaci\xf3n y aduanas",duration:15,category:"procurement",phase:"Adquisici\xf3n",isMilestone:!1,priority:"high"},{id:"activity-".concat(s++),name:"Embarque y transporte internacional",duration:Math.max(10,this.convertToDays(a.deliveryTime||4,a.deliveryTimeUnit||"weeks")/3),category:"procurement",phase:"Adquisici\xf3n",isMilestone:!1,priority:"high"}];t.push(...e),console.log("\ud83c\udf0d Agregadas ".concat(e.length," actividades de importaci\xf3n"))}if(a.requiresInfrastructure){const e=[{id:"activity-".concat(s++),name:"Preparaci\xf3n del sitio de instalaci\xf3n",duration:10,category:"preparation",phase:"Implementaci\xf3n",isMilestone:!1,priority:"high"},{id:"activity-".concat(s++),name:"Modificaciones de infraestructura el\xe9ctrica",duration:8,category:"infrastructure",phase:"Implementaci\xf3n",isMilestone:!1,priority:"high"},{id:"activity-".concat(s++),name:"Cimentaci\xf3n y bases para equipos",duration:12,category:"infrastructure",phase:"Implementaci\xf3n",isMilestone:!1,priority:"high"}];t.push(...e),console.log("\ud83d\udd27 Agregadas ".concat(e.length," actividades de infraestructura"))}if(a.advancePayments&&a.advancePayments.length>0){const e=a.advancePayments.map((e,a)=>({id:"activity-".concat(s++),name:"".concat(e.percentage,"% - ").concat(e.description),duration:2,category:"financial",phase:this.getPaymentPhase(e.timing),isMilestone:!0,priority:"high",paymentInfo:{percentage:e.percentage,timing:e.timing,description:e.description}}));t.push(...e),console.log("\ud83d\udcb0 Agregadas ".concat(e.length," actividades de anticipos"))}return console.log("\ud83d\udcca Total actividades despu\xe9s de agregar espec\xedficas de maquinaria: ".concat(t.length)),t}getPaymentPhase(e){switch(e){case"order":default:return"Planificaci\xf3n";case"production":case"shipping":return"Adquisici\xf3n";case"delivery":case"installation":return"Implementaci\xf3n";case"performance":return"Cierre"}}getPaymentTimingOrder(e){switch(e){case"order":return 1;case"production":return 2;case"shipping":return 3;case"delivery":return 4;case"installation":return 5;case"performance":return 6;default:return 999}}sortMachineryActivities(e,a){console.log("\ud83d\udd04 Iniciando ordenamiento de actividades:",e.length);const t=e=>{const a=e.name.toLowerCase();if(a.includes("an\xe1lisis")||a.includes("necesidades")||a.includes("requerimientos"))return 100;if(e.paymentInfo)switch(e.paymentInfo.timing){case"order":default:return 200;case"production":return 800;case"shipping":return 900;case"delivery":return 1200;case"installation":return 1300;case"performance":return 1400}return a.includes("aprobaci\xf3n")||a.includes("autorizaci\xf3n")||a.includes("planificaci\xf3n")?300:a.includes("b\xfasqueda")||a.includes("proveedor")||a.includes("cotizaci\xf3n")?400:a.includes("compra")||a.includes("contrato")||a.includes("firma")?500:a.includes("fabricaci\xf3n")||a.includes("producci\xf3n")||a.includes("manufactura")?600:a.includes("importaci\xf3n")||a.includes("aduana")||a.includes("embarque")?700:a.includes("infraestructura")||a.includes("preparaci\xf3n")||a.includes("sitio")?1e3:a.includes("instalaci\xf3n")||a.includes("montaje")||a.includes("configuraci\xf3n")?1100:a.includes("capacitaci\xf3n")||a.includes("documentaci\xf3n")||a.includes("garant\xeda")||a.includes("soporte")?1500:a.includes("entrega")?1250:100*this.getPhaseOrder(e.phase)},s=e.sort((e,a)=>{const s=t(e),r=t(a);return console.log("\ud83d\udccb Ordenando: ".concat(e.name," (").concat(s,") vs ").concat(a.name," (").concat(r,")")),s!==r?s-r:e.name.localeCompare(a.name)});return console.log("\ud83d\udccb Actividades ordenadas:"),s.forEach((e,a)=>{console.log("".concat(a+1,". ").concat(e.name," (").concat(t(e),")"))}),s}getActivityOrder(e,a){const t={"Planificaci\xf3n":["an\xe1lisis","requerimientos","planificaci\xf3n","aprobaci\xf3n","orden","cotizaci\xf3n"],"Adquisici\xf3n":["cotizaci\xf3n","proveedor","compra","fabricaci\xf3n","producci\xf3n","importaci\xf3n","aduana","embarque","transporte"],"Implementaci\xf3n":["infraestructura","preparaci\xf3n","sitio","cimentaci\xf3n","el\xe9ctrica","instalaci\xf3n","configuraci\xf3n","prueba","entrega"],Cierre:["capacitaci\xf3n","documentaci\xf3n","garant\xeda","soporte","performance"]}[a]||[];for(let s=0;s<t.length;s++)if(e.includes(t[s]))return s;return 999}getPhaseOrder(e){return{"Planificaci\xf3n":1,"Adquisici\xf3n":2,"Implementaci\xf3n":3,Cierre:4,General:5}[e]||5}getPaymentRelativePosition(e){switch(e){case"order":return 500;case"production":return 2500;case"shipping":return 2800;case"delivery":return 3500;case"installation":return 3800;case"performance":return 4500;default:return 9999}}},x=e=>{let{isOpen:a,onClose:t,onComplete:o,projectId:i,currentProject:l=null,organizationId:g,userId:x}=e;const[b,f]=(0,r.useState)(1),[y,v]=(0,r.useState)({}),[j,N]=(0,r.useState)(null),[D,w]=(0,r.useState)(!1),[C,S]=(0,r.useState)(null),[T,I]=(0,r.useState)([]),[E,A]=(0,r.useState)(!1);(0,r.useEffect)(()=>{a&&k()},[a]),(0,r.useEffect)(()=>{4!==b||R()&&E||j||D||(console.log("\ud83e\udd16 Generando cronograma autom\xe1ticamente en paso 4..."),F())},[b,y,j,D,E]);const k=async()=>{try{f(1),v({}),N(null),S(null),w(!1),A(!1),await M(),v(l?{projectId:i,projectName:l.name,projectDescription:l.description,projectManager:l.manager||"Pendiente",startDate:l.startDate||(new Date).toISOString().split("T")[0],endDate:l.endDate||null}:{projectId:i,startDate:(new Date).toISOString().split("T")[0]})}catch(C){console.error("Error inicializando wizard:",C),S("Error inicializando el asistente de cronogramas")}},M=async()=>{try{const e=await h.getAvailableTemplates();I(e),console.log("\ud83d\udccb Templates cargados:",e.length)}catch(C){console.error("Error cargando templates:",C)}},P=(0,r.useCallback)(e=>{v(a=>(0,s.A)((0,s.A)({},a),e))},[]),F=async()=>{try{var e,a;if(w(!0),S(null),console.log("\ud83e\udd16 Iniciando generaci\xf3n de cronograma..."),console.log("\ud83d\udcca Datos del wizard:",y),!y.projectType)throw new Error("Tipo de proyecto no definido");const t=await h.generateSmartSchedule(y);if(!t)throw new Error("No se pudo generar el cronograma");N(t),f(5),console.log("\u2705 Cronograma generado exitosamente:",t),console.log("\ud83d\udcca Actividades generadas:",(null===(e=t.activities)||void 0===e?void 0:e.length)||0),console.log("\ud83c\udfaf Hitos generados:",(null===(a=t.milestones)||void 0===a?void 0:a.length)||0)}catch(C){console.error("\u274c Error generando cronograma:",C),S("Error generando cronograma: ".concat(C.message))}finally{w(!1)}},O=()=>{f(1),v({}),N(null),S(null),w(!1),t()},R=()=>"equipment_installation"===y.projectType,L=()=>{switch(b){case 1:return y.projectName&&y.projectType;case 2:return y.teamSize&&y.teamExperience;case 3:return y.milestones&&y.milestones.length>0;case 4:return R()&&E?y.deliveryTime&&y.advancePayments:null!==j;default:return!1}};return a?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl h-[95vh] max-h-[95vh] overflow-hidden flex flex-col",children:[(0,n.jsxs)("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold flex items-center",children:[(0,n.jsx)("span",{className:"text-3xl mr-3",children:"\ud83e\udd16"}),"Asistente Inteligente de Cronogramas"]}),(0,n.jsx)("p",{className:"text-purple-100 mt-1",children:"Genera cronogramas autom\xe1ticamente con IA"})]}),(0,n.jsx)("button",{onClick:O,className:"text-white hover:text-purple-200 transition-colors",children:(0,n.jsx)("span",{className:"text-2xl",children:"\xd7"})})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm text-purple-100 mb-2",children:[(0,n.jsxs)("span",{children:["Paso ",b," de ",4]}),(0,n.jsxs)("span",{children:[Math.round(b/4*100),"% completado"]})]}),(0,n.jsx)("div",{className:"w-full bg-purple-300 rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-white h-2 rounded-full transition-all duration-300",style:{width:"".concat(b/4*100,"%")}})})]})]}),(0,n.jsxs)("div",{className:"p-6 overflow-y-auto flex-1",children:[C&&(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-red-500 text-xl mr-3",children:"\u26a0\ufe0f"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-red-800 font-semibold",children:"Error"}),(0,n.jsx)("p",{className:"text-red-600",children:C})]})]})}),1===b&&(0,n.jsx)(c,{wizardData:y,onUpdate:P,availableTemplates:T}),2===b&&(0,n.jsx)(d,{wizardData:y,onUpdate:P}),3===b&&(0,n.jsx)(u,{wizardData:y,onUpdate:P}),4===b&&R()&&E&&(0,n.jsx)(m,{wizardData:y,onUpdate:P}),4===b&&(!R()||!E)&&(0,n.jsx)(p,{wizardData:y,generatedSchedule:j,isGenerating:D,onGenerate:F})]}),(0,n.jsxs)("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-between border-t",children:[(0,n.jsx)("div",{className:"flex items-center space-x-4",children:b>1&&(0,n.jsx)("button",{onClick:()=>{b>1&&f(e=>e-1)},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"\u2190 Anterior"})}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("button",{onClick:O,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancelar"}),b<4||4===b&&R()&&E?(0,n.jsx)("button",{onClick:()=>{b<4?f(e=>e+1):4===b&&R()&&!E?A(!0):4===b&&R()&&E&&A(!1)},disabled:!L(),className:"px-6 py-2 rounded-lg font-semibold transition-colors ".concat(L()?"bg-purple-600 hover:bg-purple-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Siguiente \u2192"}):(0,n.jsx)("button",{onClick:()=>{j&&o&&(o(j),t())},disabled:!j,className:"px-6 py-2 rounded-lg font-semibold transition-colors ".concat(j?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"\u2705 Aplicar Cronograma"})]})]})]})}):null};var b=t(9874),f=t(7902);const y=864e5,v=50,j=e=>"string"!==typeof e?e:e.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").replace(/[<>]/g,"").trim().substring(0,1e3),N=e=>e&&"string"===typeof e?e.length<2?{valid:!1,error:"Nombre debe tener al menos 2 caracteres"}:e.length>255?{valid:!1,error:"Nombre muy largo (m\xe1ximo 255 caracteres)"}:{valid:!0,sanitized:j(e)}:{valid:!1,error:"Nombre de tarea requerido"},D=e=>{const a=parseInt(e);return isNaN(a)||a<0||a>365?{valid:!1,error:"Duraci\xf3n debe ser un n\xfamero entre 0 y 365 d\xedas"}:{valid:!0,value:a}},w=e=>{if(!e)return{valid:!1,error:"Fecha requerida"};const a=new Date(e);if(isNaN(a.getTime()))return{valid:!1,error:"Fecha inv\xe1lida"};const t=(new Date).getFullYear();return a.getFullYear()<2020||a.getFullYear()>t+10?{valid:!1,error:"Fecha fuera del rango permitido (2020-"+(t+10)+")"}:{valid:!0,value:(e=>{if(!e)return(new Date).toISOString().split("T")[0];const a=new Date(e);return isNaN(a.getTime())?(console.warn("Invalid date in toISO:",e),(new Date).toISOString().split("T")[0]):a.toISOString().split("T")[0]})(a)}},C=e=>[...e].sort((e,a)=>{const t=e=>{if(!e)return 0;if("number"===typeof e)return e;const a=String(e).match(/\d+/);return a?parseInt(a[0],10):String(e).toLowerCase().includes("sin")?999999:0},s=t(e.wbsCode),r=t(a.wbsCode);return s===r?0:s-r}),S=e=>{if(!e)return(new Date).toISOString().split("T")[0];const a=new Date(e);return isNaN(a.getTime())?(console.warn("Invalid date in toISO:",e),(new Date).toISOString().split("T")[0]):a.toISOString().split("T")[0]},T=e=>{const a=new Date(e).getDay();return a>=1&&a<=5},I=function(e,a){if(0===a)return e;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){const t=new Date(e);return t.setDate(t.getDate()+a),S(t)}return((e,a)=>{if(0===a)return e;let t=new Date(e+"T00:00:00"),s=0;if(T(t)&&(s=1),s>=a)return S(t);for(;s<a;)t.setDate(t.getDate()+1),T(t)&&s++;return S(t)})(e,a)},E=function(e,a){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){const t=new Date(S(e)),s=new Date(S(a));return Math.max(0,Math.round((s.getTime()-t.getTime())/y))}return A(e,a)},A=(e,a)=>{const t=new Date(S(e)),s=new Date(S(a));return Math.max(0,Math.round((s.getTime()-t.getTime())/y))},k=(e,a,t)=>{const s=new Date(S(e)),r=new Date(a);let o=0,n=new Date(r);const i=S(e).includes("2025-09-01");if(i&&(console.log("\ud83d\udd0d findColumnIndex DEBUG:"),console.log("   targetDate:",S(e)),console.log("   referenceStartDate:",a),console.log("   includeWeekends:",t),console.log("   isTargetBeforeStart:",s<r)),s<r){let e=new Date(s);for(;e<r;)(t||T(e))&&(o--,i&&console.log("\ud83d\udcc5 Columna negativa:",S(e),"\xedndice:",o)),e.setDate(e.getDate()+1)}else for(;n<=s;)t||T(n)?(o++,i&&console.log("\ud83d\udcc5 Columna contada:",S(n),"\xedndice:",o)):i&&console.log("\ud83d\udcc5 D\xeda saltado (fin de semana):",S(n)),n.setDate(n.getDate()+1);return i&&console.log("\ud83c\udfaf findColumnIndex resultado final:",o),o},M=function(e,a){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?E(e,I(a,1,!0),!0):((e,a)=>{const t=new Date(S(e)),s=new Date(S(a));return Math.max(1,Math.round((s.getTime()-t.getTime())/y)+1)})(e,a)},P=(e,a)=>{let t=0;e.isCritical&&(t+=3),0===e.predecessors.length&&(t+=1),0===e.successors.length&&(t+=1),e.resources.length>2&&(t+=2),e.duration>10&&(t+=1);return t+=e.predecessors.filter(e=>{const t=a.find(a=>a.id===e);return t&&t.successors.length>1}).length,Math.min(10,t)},F=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t=[],s=new Set;let r=0;for(const c of e)s.has(c.id)?(console.warn("\u26a0\ufe0f Tarea duplicada detectada en CPM: ".concat(c.id," - ").concat(c.name)),r++):(s.add(c.id),t.push(c));r>0&&console.warn("\ud83d\udd27 Se eliminaron ".concat(r," tareas duplicadas en CPM"));const o=new Map(t.map(e=>[e.id,{id:e.id,wbsCode:e.wbsCode,name:e.name,duration:e.duration,startDate:e.startDate,endDate:e.endDate,progress:e.progress,predecessors:[...e.predecessors||[]],cost:e.cost,priority:e.priority,assignedTo:e.assignedTo,isMilestone:e.isMilestone,isCritical:e.isCritical,originalDuration:e.originalDuration,earlyStart:e.earlyStart,earlyFinish:e.earlyFinish,lateStart:e.lateStart,lateFinish:e.lateFinish,totalFloat:e.totalFloat,freeFloat:e.freeFloat,description:e.description,resources:[...e.resources||[]],workPackageId:e.workPackageId,status:e.status,successors:[...e.successors||[]]}])),n=Array.from(o.values()),i=()=>{const e=new Set,t=new Set,s=r=>{if(e.has(r))return;if(t.has(r))return console.warn("Dependencia circular detectada en la tarea: ".concat(r,". Saltando c\xe1lculo.")),e.add(r),void t.delete(r);t.add(r);const n=o.get(r);if(!n)return;if(n.templateCalculated&&0===n.predecessors.length)return void console.log("\ud83d\udd12 Respetando fechas calculadas por template para tarea sin predecesoras: ".concat(n.name));let i;i=0===n.predecessors.length?new Date(n.startDate):new Date("1900-01-01");for(const e of n.predecessors){s(e);const a=o.get(e);if(a){let e=new Date(a.earlyFinish);e>i&&(i=e)}}n.predecessors.length>0&&!n.isMilestone&&i.setDate(i.getDate()+1),a||(i=(e=>{let a=new Date(e);for(;!T(a);)a.setDate(a.getDate()+1);return a})(i)),n.earlyStart=S(i),n.isMilestone?(n.earlyFinish=n.earlyStart,n.startDate=n.earlyStart,n.endDate=n.earlyFinish):(n.earlyFinish=I(n.earlyStart,n.duration,a),n.startDate=n.earlyStart,n.endDate=n.earlyFinish),t.delete(r),e.add(r)};for(const a of n)s(a.id)};try{i(),(()=>{const e=n.filter(e=>0===e.successors.length);let a=new Date("1900-01-01");for(const r of e){const e=new Date(r.earlyFinish);e>a&&(a=e)}const t=new Set,s=e=>{if(t.has(e))return;const a=o.get(e);if(a){if(0===a.successors.length)a.lateFinish=a.earlyFinish;else{let e=new Date("2100-01-01");for(const t of a.successors){s(t);const a=o.get(t);if(a){let t=new Date(a.lateStart);a.isMilestone||t.setDate(t.getDate()-1),t<e&&(e=t)}}a.lateFinish=S(e)}if(a.isMilestone)a.lateStart=a.lateFinish;else{const e=new Date(a.lateFinish);e.setDate(e.getDate()-a.duration),a.lateStart=S(e)}t.add(e)}};for(const r of e)s(r.id);for(const r of n)t.has(r.id)||s(r.id);for(const r of n)if(0===r.predecessors.length)if(r.lateStart=r.earlyStart,r.isMilestone)r.lateFinish=r.earlyStart;else{const e=new Date(r.earlyStart);e.setDate(e.getDate()+r.duration),r.lateFinish=S(e)}})();let e=0;const a=[];for(const r of n){const e=new Date(r.earlyStart),t=new Date(r.lateStart),s=Math.round((t-e)/y);r.totalFloat=Math.max(0,s),r.isCritical=0===r.totalFloat;let i=new Date("2100-01-01");if(0===r.successors.length)r.freeFloat=r.totalFloat;else{for(const t of r.successors){const e=o.get(t);if(e){const a=new Date(e.earlyStart);a<i&&(i=a)}}const e=new Date(r.earlyFinish),a=Math.round((i-e)/y);r.freeFloat=Math.max(0,a)}r.isCritical&&(a.push(r.id),r.criticalImpact={delayCost:.1*r.cost,resourceImpact:r.resources.length>0?"Alto":"Bajo",successorImpact:r.successors.length}),r.safetyFloat=Math.max(0,r.totalFloat-r.freeFloat),r.sensitivity=P(r,n)}if(n.length>0){const t=n.map(e=>new Date(e.startDate)),s=n.map(e=>new Date(e.endDate)),r=new Date(Math.min(...t)),o=new Date(Math.max(...s)),i=o.getTime()-r.getTime();e=Math.max(0,Math.round(i/864e5)),console.log("\ud83d\udd0d CPM DEBUG - Ruta Cr\xedtica:",{totalTasks:n.length,criticalTasks:a.length,minStart:r&&!isNaN(r.getTime())?r.toISOString().split("T")[0]:"N/A",maxEnd:o&&!isNaN(o.getTime())?o.toISOString().split("T")[0]:"N/A",criticalPathLength:e})}const t=(e=>{const a=[],t=new Set,s=(r,o)=>{if(t.has(r))return;const n=e.find(e=>e.id===r);if(n){if(t.add(r),o.push(r),0===n.successors.length){const t=o.reduce((a,t)=>{const s=e.find(e=>e.id===t);return a+(s?s.duration:0)},0);t===Math.max(...e.map(e=>new Date(e.earlyFinish)-new Date(e.startDate)/y))&&a.push(o.slice())}else for(const e of n.successors)s(e,o);o.pop(),t.delete(r)}},r=e.filter(e=>0===e.predecessors.length);for(const o of r)s(o.id,[]);return a})(n),s=((e,a)=>{let t=0;if(e.length>0){const a=e.map(e=>new Date(e.startDate)),s=e.map(e=>new Date(e.endDate)),r=new Date(Math.min(...a)),o=new Date(Math.max(...s)).getTime()-r.getTime();t=Math.max(0,Math.round(o/864e5))}const s=a.reduce((a,t)=>{const s=e.find(e=>e.id===t);return a+(s?s.duration:0)},0),r=Math.max(t,s),o=e.reduce((e,a)=>e+(a.cost||0),0),n=a.reduce((a,t)=>{const s=e.find(e=>e.id===t);return a+(s&&s.cost||0)},0);return{totalDuration:r,criticalDuration:Math.round(s),totalCost:o,criticalCost:n,criticalPercentage:Math.round(n/o*100),averageFloat:Math.round(e.reduce((e,a)=>e+a.totalFloat,0)/e.length),maxFloat:Math.max(...e.map(e=>e.totalFloat)),criticalTasksCount:a.length,originalDuration:t,criticalPathLength:s,durationDifference:r-t}})(n,a);return console.log("\ud83d\udd0d DEBUG - Tareas y fechas de fin:",n.map(e=>({name:e.name,endDate:e.endDate,endDateObj:e.endDate&&null!==e.endDate&&void 0!==e.endDate?new Date(e.endDate).toISOString().split("T")[0]:"N/A"}))),{tasks:n,error:null,criticalPath:a,criticalPathLength:e,criticalPaths:t,projectMetrics:s}}catch(l){return{tasks:n,error:l.message}}},O=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t=new Map;for(const[s,r]of e.entries()){let e=0;for(const t of r)e+=E(t.startDate,I(t.endDate,1,a),a);t.set(s,e)}return Object.fromEntries(t)},R=e=>{var a,t,c,d,u,m;let{tasks:p,setTasks:g,importTasks:y,projectData:A,onScheduleDataChange:P,includeWeekends:R,setIncludeWeekends:L,useSupabase:U=!0,updateProjectMinutas:z}=e;(0,r.useCallback)(e=>{if(!Array.isArray(e)||0===e.length)return e;console.log("\ud83d\udd04 MIGRACI\xd3N AUTOM\xc1TICA - Iniciando migraci\xf3n de proyecto existente..."),console.log("\ud83d\udcca Tareas a migrar: ".concat(e.length));if(e.every((e,a)=>parseInt(e.wbsCode)===a+1))return console.log("\u2705 MIGRACI\xd3N AUTOM\xc1TICA - Proyecto ya migrado, no se requiere migraci\xf3n"),e;const a=new Map;e.forEach((e,t)=>{const s="".concat(t+1);a.set(e.id,s)}),console.log("\ud83d\udd04 MIGRACI\xd3N AUTOM\xc1TICA - Mapeo de ID a wbsCode:",Array.from(a.entries()));const t=e.map((a,t)=>{const r="".concat(t+1);let o=[];a.predecessors&&a.predecessors.length>0&&(o=a.predecessors.map(a=>{const t=e.find(e=>e.id===a);return t?(console.log("\u2705 Predecesora v\xe1lida encontrada: ".concat(t.name," (ID: ").concat(a,")")),a):(console.warn("\u26a0\ufe0f Predecesora no encontrada: ID ".concat(a)),null)}).filter(Boolean));const n=(0,s.A)((0,s.A)({},a),{},{wbsCode:r,predecessors:o});return o.length>0&&console.log('\ud83d\udd04 Tarea "'.concat(a.name,'": wbsCode ').concat(a.wbsCode," \u2192 ").concat(r,", predecesoras: [").concat(o.join(", "),"]")),n});return console.log("\u2705 MIGRACI\xd3N AUTOM\xc1TICA - Migraci\xf3n completada exitosamente"),t},[]);(0,r.useEffect)(()=>{if(console.log("\ud83d\udd27 useEffect EJECUT\xc1NDOSE - TAREAS:",(null===p||void 0===p?void 0:p.length)||0),p&&p.length>0){const e=p.filter(e=>e.isMilestone&&e.startDate!==e.endDate);console.log("\ud83d\udd27 HITOS CON FECHAS INCORRECTAS DETECTADOS:",e.length),e.length>0&&(console.log("\ud83d\udd27 EJECUTANDO CORRECCI\xd3N AUTOM\xc1TICA DE HITOS"),g(e=>e.map(e=>e.isMilestone&&e.startDate!==e.endDate?(console.log("\ud83d\udd27 CORRIGIENDO HITO AUTOM\xc1TICAMENTE:",{taskId:e.id,taskName:e.name,startDateOriginal:e.startDate,endDateOriginal:e.endDate,endDateCorregida:e.startDate}),(0,s.A)((0,s.A)({},e),{},{endDate:e.startDate,updatedAt:(new Date).toISOString()})):e)))}},[p.length]),(0,r.useEffect)(()=>{if(P&&p.length>0){const e={tasks:p,projectStart:null===A||void 0===A?void 0:A.startDate,projectEnd:null===A||void 0===A?void 0:A.endDate,totalTasks:p.length,completedTasks:p.filter(e=>"completed"===e.status).length,inProgressTasks:p.filter(e=>"in-progress"===e.status).length,delayedTasks:p.filter(e=>"delayed"===e.status).length,totalProgress:p.reduce((e,a)=>e+(a.progress||0),0)/p.length};P(e),console.log("\ud83d\udcca Datos del cronograma enviados a FinancialManagement")}},[p,P,A]);const q={projectName:A.projectName,startDate:A.startDate,plannedEndDate:A.endDate,totalInvestment:A.totalBudget},[B,G]=(0,r.useState)(null),[_,H]=(0,r.useState)(""),[V,W]=(0,r.useState)("excel"),[K,J]=(0,r.useState)(null),[Y,Z]=(0,r.useState)(""),[X,$]=(0,r.useState)(null),[Q,ee]=(0,r.useState)(""),[ae,te]=(0,r.useState)(""),se=(0,r.useRef)(null),[re,oe]=((0,r.useRef)(null),(0,r.useState)("days")),[ne,ie]=(0,r.useState)(!0),[le,ce]=(0,r.useState)(!0),[de,ue]=(0,r.useState)([]),[me,pe]=(0,r.useState)(!1),[ge,he]=(0,r.useState)(!1),[xe,be]=(0,r.useState)(!1),[fe,ye]=(0,r.useState)(null),[ve,je]=(0,r.useState)(!1),[Ne,De]=(0,r.useState)([]),[we,Ce]=(0,r.useState)(!1),[Se,Te]=(0,r.useState)(null),[Ie,Ee]=(0,r.useState)(!1),[Ae,ke]=(0,r.useState)(!1),{logMinutaTaskCreated:Me,logMinutaTaskUpdated:Pe,addAuditEvent:Fe}=(0,f.A)(null===A||void 0===A?void 0:A.id,U),[Oe,Re]=(0,r.useState)("hierarchical"),[Le,Ue]=(0,r.useState)("TB"),[ze,qe]=(0,r.useState)(!1),[Be,Ge]=(0,r.useState)(!0),[_e,He]=(0,r.useState)(!1),[Ve,We]=(0,r.useState)(!1),[Ke,Je]=(0,r.useState)(!0),[Ye,Ze]=(0,r.useState)(1),[Xe,$e]=(0,r.useState)({x:0,y:0}),[Qe,ea]=(0,r.useState)(null),[aa,ta]=(0,r.useState)({x:0,y:0}),[sa,ra]=(0,r.useState)(!1),[oa,na]=(0,r.useState)({x:0,y:0}),[ia,la]=(0,r.useState)({x:0,y:0}),ca=(0,r.useRef)(null),da=(0,r.useRef)(null),ua=(0,r.useRef)(null),ma=(0,r.useRef)(null),pa=(0,r.useMemo)(()=>new Map(de.map(e=>[e.id,e])),[de]),ga=(0,r.useMemo)(()=>{console.log("\ud83d\udd04 Recalculando CPM con tareas:",p.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors,endDate:e.endDate}))),console.log("\ud83d\ude80 DEBUG - Tareas ANTES de calculateCPM:",p.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors,endDate:e.endDate})));const e=F(p,R);console.log("\ud83d\ude80 DEBUG - Tareas DESPU\xc9S de calculateCPM:",e.tasks.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors,endDate:e.endDate}))),console.log("\ud83d\ude80 DEBUG - Resultado CPM:",{criticalPath:e.criticalPath,criticalPathLength:e.criticalPathLength,totalTasks:e.tasks.length}),console.log("\ud83d\ude80 CORRECCI\xd3N SCHEDULE - Aplicando fechas calculadas por CPM como MS Project");const a=p.map(a=>{const t=e.tasks.find(e=>e.id===a.id);return t?{id:t.id,wbsCode:t.wbsCode,name:t.name,duration:t.duration,startDate:t.earlyStart,endDate:t.earlyFinish,progress:t.progress,predecessors:t.predecessors||[],cost:t.cost,priority:t.priority,assignedTo:t.assignedTo,isMilestone:t.isMilestone,isCritical:t.isCritical,originalDuration:t.originalDuration,earlyStart:t.earlyStart,earlyFinish:t.earlyFinish,lateStart:t.lateStart,lateFinish:t.lateFinish,totalFloat:t.totalFloat,freeFloat:t.freeFloat,description:t.description,resources:[...t.resources||[]],workPackageId:t.workPackageId,status:t.status,successors:t.successors||[]}:(console.warn("\u26a0\ufe0f Tarea no encontrada en resultado CPM: ".concat(a.name," (").concat(a.id,")")),a)});return console.log("\ud83d\udd04 Tareas con dependencias FORZADAS despu\xe9s de CPM:",a.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors,endDate:e.endDate}))),{criticalPath:e.criticalPath,criticalPathLength:e.criticalPathLength,tasks:a}},[p,R,p.length]),ha=(0,r.useMemo)(()=>ga.tasks.map(e=>{const a=(0,s.A)((0,s.A)({},e),{},{startDate:e.earlyStart,endDate:e.earlyFinish});return e.isMilestone&&(console.log("\ud83d\udd0d HITO DETECTADO:",{id:e.id,name:e.name,startDate:e.startDate,endDate:e.endDate,isMilestone:e.isMilestone}),a.startDate!==a.endDate)?(console.log("\ud83d\udd27 CORRIGIENDO HITO - FORZANDO endDate = startDate"),(0,s.A)((0,s.A)({},a),{},{endDate:a.startDate})):a}),[ga.tasks]);(0,r.useEffect)(()=>{if(ha.length>0&&g){ha.some(e=>{const a=p.find(a=>a.id===e.id);return!!a&&(a.startDate!==e.startDate||a.endDate!==e.endDate)})&&(console.log("\ud83d\udd04 Actualizando tareas con fechas calculadas por CPM..."),g(ha))}},[ha,p,g]);(0,r.useEffect)(()=>{ye(ga.error)},[ga.error]),(0,r.useEffect)(()=>{if(p&&p.length>0){const e=new Set,a=new Set,t=[],s=function(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(a.has(r)){const e=o.indexOf(r),a=o.slice(e).concat([r]);return t.push({taskId:r,cycle:a}),!0}if(e.has(r))return!1;a.add(r),e.add(r);const n=p.find(e=>e.id===r);if(n)for(const e of n.predecessors)if(s(e,[...o,r]))return!0;return a.delete(r),!1};p.forEach(a=>{e.has(a.id)||s(a.id)}),t.length>0?(console.warn("\ud83d\udea8 DEPENDENCIAS CIRCULARES REALES detectadas: ".concat(t.length)),t.forEach(e=>{console.warn("  \u2022 Tarea ".concat(e.taskId,": Ciclo ").concat(e.cycle.join(" \u2192 ")))}),console.warn('\ud83d\udca1 Usa el bot\xf3n "Limpiar Dependencias Circulares" para corregir manualmente')):console.log("\u2705 Sin dependencias circulares detectadas")}},[p]);const xa=(0,r.useMemo)(()=>function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t=new Map,s=[];for(const r of e)if(r&&r.resources&&Array.isArray(r.resources))for(const e of r.resources)t.has(e)||t.set(e,[]),t.get(e).push({taskId:r.id,taskName:r.name,startDate:r.startDate,endDate:r.endDate,allocation:100});for(const[r,o]of t.entries()){const e=o.sort((e,a)=>new Date(e.startDate)-new Date(a.startDate));for(let t=0;t<e.length-1;t++){const o=e[t],n=e[t+1];new Date(o.endDate)>new Date(n.startDate)&&s.push({resource:r,task1:o.taskId,task2:n.taskId,overlapDays:E(n.startDate,o.endDate,a)})}}return{resourceLoad:Object.fromEntries(t),conflicts:s,utilization:O(t,a)}}(ha,R),[ha,R]),ba=(0,r.useRef)(R);(0,r.useEffect)(()=>{const e=e=>{console.log("\ud83d\udd04 EVENTO tasksUpdated recibido:",e.detail),g(e=>[...e])};return window.addEventListener("tasksUpdated",e),()=>{window.removeEventListener("tasksUpdated",e)}},[]),(0,r.useEffect)(()=>{if(console.log("\ud83d\udd04 CHECKBOX CAMBI\xd3:",R),ba.current!==R&&p&&p.length>0){console.log("\ud83d\udd04 RECALCULANDO FECHAS..."),ba.current=R;const e=p.map((e,a)=>{if(e.isMilestone)return(0,s.A)((0,s.A)({},e),{},{endDate:e.startDate});if(e.startDate&&e.duration){const a=I(e.startDate,e.duration,R);return(0,s.A)((0,s.A)({},e),{},{endDate:a})}return e}),a=e.some((e,a)=>e.endDate!==p[a].endDate);console.log("\ud83d\udd04 hasChanges:",a),a?(console.log("\ud83d\udd04 ACTUALIZANDO TABLA..."),g(e)):console.log("\ud83d\udd04 NO HAY CAMBIOS - las fechas son iguales")}},[R]);const fa=(0,r.useMemo)(()=>{if(0===ha.length)return[];let e=ha;_e&&(e=e.filter(e=>e.isCritical));const a=Ve?100:140,t=Ve?60:80,s=Ve?150:200,r=Ve?100:120,o=[],n=new Map,i=new Set,l=function(a){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(i.has(a))return n.get(a)||0;if(t.has(a))return console.warn("Dependencia circular detectada en tarea:",a),n.set(a,0),i.add(a),0;const s=e.find(e=>e.id===a);if(!s)return 0;if(0===s.predecessors.length)return n.set(a,0),i.add(a),0;t.add(a);try{const e=(s.predecessors&&s.predecessors.length>0?Math.max(...s.predecessors.map(e=>l(e,t))):0)+1;return n.set(a,e),i.add(a),e}finally{t.delete(a)}};e.forEach(e=>l(e.id));const c=new Map;e.forEach(e=>{const a=n.get(e.id);c.has(a)||c.set(a,[]),c.get(a).push(e)});const d=Math.max(...Array.from(c.keys()));return c.forEach((e,n)=>{const i=(e.length-1)*s,l=100+50*(d-n);e.forEach((e,c)=>{const d=l+i/2-i/2+c*s,u=100+n*r;o.push({id:e.id,x:d,y:u,width:a,height:t,level:n,task:e})})}),console.log("\ud83d\udccd NODOS GENERADOS MEJORADOS:",o.map(e=>({id:e.id,x:e.x,y:e.y,level:e.level,center:"".concat(e.x+e.width/2,",").concat(e.y+e.height/2)}))),o},[ha,_e,Ve]),ya=fa,va=()=>{if(!ya||!Array.isArray(ya))return console.log("\u26a0\ufe0f networkNodes no disponible a\xfan, usando fallback"),$e({x:0,y:0}),void Ze(1);if(console.log("\ud83c\udfaf centerNetwork llamado:",{hasSvgRef:!!ma.current,nodesLength:ya.length,nodes:ya.slice(0,3).map(e=>({id:e.id,x:e.x,y:e.y}))}),ma.current&&ya.length>0){let e=1/0,a=1/0,t=-1/0,s=-1/0;ya.forEach(r=>{e=Math.min(e,r.x),a=Math.min(a,r.y),t=Math.max(t,r.x+r.width),s=Math.max(s,r.y+r.height)}),console.log("\ud83d\udcd0 Bounding box calculado:",{minX:e,minY:a,maxX:t,maxY:s});const r=100,o=t-e+2*r,n=s-a+2*r,i=e-r,l=a-r;console.log("\ud83c\udfaf Centrando en:",{centerX:i,centerY:l,contentWidth:o,contentHeight:n}),$e({x:i,y:l}),Ze(1)}else console.log("\u26a0\ufe0f Fallback: no hay nodos o SVG ref"),$e({x:0,y:0}),Ze(1)};(0,r.useEffect)(()=>{"network"===V&&ma.current&&setTimeout(()=>{va()},100)},[V]),(0,r.useEffect)(()=>{"network"===V&&ya.length>0&&setTimeout(()=>{va()},100)},[ya,V]),(0,r.useEffect)(()=>{"network"===V&&setTimeout(()=>{Ke?tt():va()},200)},[_e,Ve,V,Ke,ya]),(0,r.useEffect)(()=>{if("network"===V&&ma.current){ma.current.setAttribute("viewBox","".concat(Xe.x," ").concat(Xe.y," ").concat(1200/Ye," ").concat(600/Ye))}},[Ye,Xe,V]),(0,r.useEffect)(()=>{(async()=>{if(null!==A&&void 0!==A&&A.id){Ce(!0);try{if(U){console.log("\ud83d\udd0d DEBUG: Cargando minutas para proyecto:",A.id);const{success:e,minutas:a}=await b.default.loadMinutasByProject(A.id);e?(console.log("\ud83d\udd0d DEBUG: Minutas recibidas de Supabase:",a),De(a),z&&z(A.id,a),console.log("\u2705 Minutas cargadas desde Supabase: ".concat(a.length))):console.warn("\u26a0\ufe0f Error cargando minutas desde Supabase")}else{var e;const a=(null===(e=JSON.parse(localStorage.getItem("portfolioData")||"{}").minutasByProject)||void 0===e?void 0:e[A.id])||[];De(a),console.log("\u2705 Minutas cargadas desde localStorage: ".concat(a.length))}}catch(a){console.error("\u274c Error cargando minutas:",a)}finally{Ce(!1)}}})()},[null===A||void 0===A?void 0:A.id,U]);const ja=(0,r.useRef)(null),Na=(0,r.useRef)(!1),Da=(0,r.useCallback)((e,a,t)=>{console.log("\ud83d\udd04 updateTask llamado:",{taskId:e,field:a,value:t,selectedTaskId:null===B||void 0===B?void 0:B.id}),e?(g(s=>s.map(s=>{if(s.id!==e)return s;const r={id:s.id,wbsCode:s.wbsCode,name:s.name,duration:s.duration,startDate:s.startDate,endDate:s.endDate,progress:s.progress,predecessors:[...s.predecessors||[]],cost:s.cost,priority:s.priority,assignedTo:s.assignedTo,isMilestone:s.isMilestone,isCritical:s.isCritical,originalDuration:s.originalDuration,earlyStart:s.earlyStart,earlyFinish:s.earlyFinish,lateStart:s.lateStart,lateFinish:s.lateFinish,totalFloat:s.totalFloat,freeFloat:s.freeFloat,description:s.description,resources:[...s.resources||[]],workPackageId:s.workPackageId,status:s.status,successors:[...s.successors||[]]},o=parseFloat(t);switch(a){case"duration":{const e=Number.isFinite(o)?Math.max(0,Math.round(o)):0;r.duration=e,r.isMilestone?r.endDate=r.startDate:r.endDate=I(r.startDate,e,R);break}case"startDate":r.startDate=t,r.isMilestone?r.endDate=t:r.endDate=I(t,r.duration,R);break;case"progress":{const e=Number.isFinite(o)?Math.round(o):0;r.progress=Math.min(100,Math.max(0,e));break}case"cost":r.cost=Number.isFinite(o)?o:0;break;case"resources":r.resources=Array.isArray(t)?t:[];break;default:r[a]=t,"name"===a?console.log("\ud83d\udd24 CAMPO NOMBRE - Actualizando en tasks array:",{taskId:e,valorAnterior:s[a],valorNuevo:t,taskCompleta:r}):console.log("\ud83d\udd04 Campo '".concat(a,"' actualizado a:"),t)}return r})),B&&B.id===e&&(console.log("\ud83d\udd04 Actualizando selectedTask para:",e),G(s=>{const r={id:s.id,wbsCode:s.wbsCode,name:s.name,duration:s.duration,startDate:s.startDate,endDate:s.endDate,progress:s.progress,predecessors:[...s.predecessors||[]],cost:s.cost,priority:s.priority,assignedTo:s.assignedTo,isMilestone:s.isMilestone,isCritical:s.isCritical,originalDuration:s.originalDuration,earlyStart:s.earlyStart,earlyFinish:s.earlyFinish,lateStart:s.lateStart,lateFinish:s.lateFinish,totalFloat:s.totalFloat,freeFloat:s.freeFloat,description:s.description,resources:[...s.resources||[]],workPackageId:s.workPackageId,status:s.status,successors:[...s.successors||[]]},o=parseFloat(t);switch(a){case"duration":{const e=Number.isFinite(o)?Math.max(0,Math.round(o)):0;r.duration=e,r.isMilestone?r.endDate=r.startDate:r.endDate=I(r.startDate,e,R);break}case"startDate":r.startDate=t,r.isMilestone?r.endDate=t:r.endDate=I(t,r.duration,R);break;case"progress":{const e=Number.isFinite(o)?Math.round(o):0;r.progress=Math.min(100,Math.max(0,e));break}case"cost":r.cost=Number.isFinite(o)?o:0;break;case"resources":r.resources=Array.isArray(t)?t:[];break;default:r[a]=t,"name"===a?console.log("\ud83d\udd24 CAMPO NOMBRE - Actualizando selectedTask:",{taskId:e,valorAnterior:s[a],valorNuevo:t,selectedTaskCompleta:r}):console.log("\ud83d\udd04 selectedTask campo '".concat(a,"' actualizado a:"),t)}return console.log("\ud83d\udd04 selectedTask actualizado:",r),r}))):console.error("\u274c taskId es null o undefined")},[B]),wa={FS:{name:"Finish-to-Start",description:"La tarea predecesora debe terminar antes de que la sucesora pueda comenzar",color:"#3b82f6"},SS:{name:"Start-to-Start",description:"La tarea sucesora puede comenzar cuando la predecesora comience",color:"#10b981"},FF:{name:"Finish-to-Finish",description:"La tarea sucesora debe terminar cuando la predecesora termine",color:"#f59e0b"},SF:{name:"Start-to-Finish",description:"La tarea sucesora debe terminar cuando la predecesora comience",color:"#8b5cf6"}},Ca=(0,r.useCallback)((e,a)=>{const t=new Set,s=new Set,r=e=>{if(s.has(e))return!0;if(t.has(e))return!1;t.add(e),s.add(e);const a=ha.find(a=>a.id===e);if(a)for(const t of a.predecessors)if(r(t))return!0;return s.delete(e),!1},o=ha.find(a=>a.id===e),n=o?{id:o.id,wbsCode:o.wbsCode,name:o.name,duration:o.duration,startDate:o.startDate,endDate:o.endDate,progress:o.progress,predecessors:[...o.predecessors||[]],cost:o.cost,priority:o.priority,assignedTo:o.assignedTo,isMilestone:o.isMilestone,isCritical:o.isCritical,originalDuration:o.originalDuration,earlyStart:o.earlyStart,earlyFinish:o.earlyFinish,lateStart:o.lateStart,lateFinish:o.lateFinish,totalFloat:o.totalFloat,freeFloat:o.freeFloat,description:o.description,resources:[...o.resources||[]],workPackageId:o.workPackageId,status:o.status,successors:[...o.successors||[]]}:null;return!!n&&(n.predecessors=[...n.predecessors||[],a],r(a))},[ha]),Sa=(0,r.useCallback)(()=>{console.log("\ud83e\uddf9 Limpiando dependencias circulares...");const e=new Set,a=new Set,t=new Set,r=s=>{if(a.has(s))return t.add(s),!0;if(e.has(s))return!1;a.add(s),e.add(s);const o=p.find(e=>e.id===s);if(o)for(const e of o.predecessors)if(r(e))return t.add(s),!0;return a.delete(s),!1};if(p.forEach(a=>{e.has(a.id)||r(a.id)}),t.size>0){console.warn("\ud83d\udea8 Se encontraron ".concat(t.size," tareas con dependencias circulares:"),Array.from(t));const e=p.map(e=>t.has(e.id)?(console.warn("\ud83d\udd27 Limpiando dependencias circulares de tarea: ".concat(e.name," (").concat(e.id,")")),(0,s.A)((0,s.A)({},e),{},{predecessors:[],successors:[]})):e);return g(e),!0}return!1},[p]);(0,r.useEffect)(()=>{const e=()=>{const e=document.getElementById("newDependencyType"),a=document.getElementById("dependencyTypeInfo");if(e&&a){const t=e.value,s=wa[t];s&&(a.textContent=s.description)}},a=document.getElementById("newDependencyType");if(a)return a.addEventListener("change",e),e(),()=>{a.removeEventListener("change",e)}},[B]);(0,r.useCallback)((e,a)=>{console.log("\ud83c\udd95 NUEVA FUNCI\xd3N handleTaskEdit - INICIANDO:",{taskId:e,updates:a}),g(t=>{console.log("\ud83d\udd0d SETTASKS #3 - NUEVA FUNCI\xd3N handleTaskEdit:",e,a),console.log("\ud83d\udd0d SETTASKS #3 - Estado ANTES:",JSON.stringify(t.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors})),null,2));const r=t.map(t=>{if(t.id===e){const e=(0,s.A)({id:t.id,wbsCode:t.wbsCode,name:t.name,duration:t.duration,startDate:t.startDate,endDate:t.endDate,progress:t.progress,predecessors:[...t.predecessors||[]],cost:t.cost,priority:t.priority,assignedTo:t.assignedTo,isMilestone:t.isMilestone,isCritical:t.isCritical,originalDuration:t.originalDuration,earlyStart:t.earlyStart,earlyFinish:t.earlyFinish,lateStart:t.lateStart,lateFinish:t.lateFinish,totalFloat:t.totalFloat,freeFloat:t.freeFloat,description:t.description,resources:[...t.resources||[]],workPackageId:t.workPackageId,status:t.status,successors:[...t.successors||[]]},a||{});return console.log("\ud83c\udd95 NUEVA FUNCI\xd3N - Tarea actualizada:",{id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors}),e}return t});return console.log("\ud83d\udd0d SETTASKS #3 - Estado DESPU\xc9S:",JSON.stringify(r.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors})),null,2)),console.log("\ud83c\udd95 NUEVA FUNCI\xd3N - Estado actualizado correctamente"),r})},[]),(0,r.useCallback)(function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"FS";console.warn("\ud83d\udea8 updateSuccessors INICIADO:",{taskId:e,successorsString:a,dependencyType:t}),console.error("\ud83d\udea8 updateSuccessors INICIADO:",{taskId:e,successorsString:a,dependencyType:t});const s=a.split(",").map(e=>e.trim()).filter(a=>a&&a!==e);console.log("\ud83d\udd04 Sucesoras procesadas:",s);for(const r of s)if(Ca(e,r))return console.error("\u274c DEPENDENCIA CIRCULAR DETECTADA:",{taskId:e,succId:r}),void alert("\u274c No se puede crear la dependencia: se detectar\xeda una dependencia circular entre ".concat(e," y ").concat(r));g(a=>{console.log("\ud83d\udd04 Estado anterior de tareas:",a.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors})));const t=new Map(a.map(e=>[e.id,new Set(e.predecessors)]));for(const[,s]of t)s.delete(e);for(const n of s){var r;null===(r=t.get(n))||void 0===r||r.add(e)}const o=a.map(a=>({id:a.id,wbsCode:a.wbsCode,name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,progress:a.progress,predecessors:Array.from(t.get(a.id)||[]),cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:a.id===e?s:a.successors}));return console.log("\ud83d\udd04 Estado actualizado de tareas:",o.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors}))),o}),console.warn("\ud83d\udea8 updateSuccessors COMPLETADO"),console.error("\ud83d\udea8 updateSuccessors COMPLETADO")},[Ca]);const Ta=(0,r.useCallback)(function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"FS";console.warn("\ud83d\udea8 updatePredecessors INICIADO:",{taskId:e,predecessorsString:a,dependencyType:t}),console.error("\ud83d\udea8 updatePredecessors INICIADO:",{taskId:e,predecessorsString:a,dependencyType:t});const s=a.split(",").map(e=>e.trim()).filter(a=>a&&a!==e);console.log("\ud83d\udd04 Predecesoras procesadas:",s);for(const r of s){const a=Ea(e,r);if(!a.valid)return console.error("\u274c VALIDACI\xd3N FALLIDA:",{taskId:e,predId:r,error:a.error}),void alert(a.error)}g(a=>{console.log("\ud83d\udd04 Estado anterior de tareas:",a.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors})));const r=a.map(a=>a.id===e?{id:a.id,wbsCode:a.wbsCode,name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,progress:a.progress,predecessors:s,cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:[...a.successors||[]],dependencyType:t}:s.includes(a.id)&&!a.successors.includes(e)?{id:a.id,wbsCode:a.wbsCode,name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,progress:a.progress,predecessors:[...a.predecessors||[]],cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:a.successors.slice().concat([e])}:a);if(console.log("\ud83d\udd04 Estado actualizado de tareas:",r.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,successors:e.successors,dependencyType:e.dependencyType}))),B&&B.id===e){const a=r.find(a=>a.id===e);a&&G(a)}return r})},[Ca]),Ia=((0,r.useCallback)(e=>{const a=e.target.value;console.log("\ud83d\udd24 CAMPO NOMBRE - handleNameChange:",{valorAnterior:_,valorNuevo:a,taskId:null===B||void 0===B?void 0:B.id}),H(a)},[_,null===B||void 0===B?void 0:B.id]),(0,r.useCallback)(()=>{B&&_!==B.name&&(console.log("\ud83d\udd24 CAMPO NOMBRE - handleNameBlur - Guardando:",{valorAnterior:B.name,valorNuevo:_,taskId:B.id}),Da(B.id,"name",_))},[B,_,Da]),(0,r.useCallback)(()=>{B&&(console.log("\ud83d\udd24 CAMPO NOMBRE - handleNameFocus - Restaurando:",{valor:B.name,taskId:B.id}),H(B.name))},[B]),(0,r.useCallback)(e=>{const a=[],t=[];for(const s of e)if(s.predecessors&&0!==s.predecessors.length)for(const r of s.predecessors){let o=e.find(e=>e.id===r);if(!o&&!isNaN(r)){const a=parseInt(r);a>0&&a<=e.length&&(o=e[a-1])}if(!o){a.push('\u274c Tarea "'.concat(s.name,'": La predecesora "').concat(r,'" no existe'));continue}if(s.id===r||s===o){a.push('\u274c Tarea "'.concat(s.name,'": No puede ser predecesora de s\xed misma'));continue}if(Ca(s.id,o.id)){a.push('\u274c Tarea "'.concat(s.name,'": Dependencia circular con "').concat(o.name,'"'));continue}const n=new Date(s.startDate);new Date(o.endDate)>n&&t.push('\u26a0\ufe0f Tarea "'.concat(s.name,'": La predecesora "').concat(o.name,'" termina despu\xe9s de que inicia la tarea actual'))}return{errors:a,warnings:t}},[Ca])),Ea=(0,r.useCallback)((e,a)=>{const t=p.find(e=>e.id===a);if(!t)return{valid:!1,error:"\u274c La tarea predecesora ".concat(a," no existe")};if(e===a)return{valid:!1,error:"\u274c Una tarea no puede ser predecesora de s\xed misma"};const s=p.find(a=>a.id===e);if(s&&t){const e=new Date(s.startDate);if(new Date(t.endDate)>e)return{valid:!1,error:"\u274c La tarea predecesora termina despu\xe9s de que inicia la tarea actual"}}return Ca(e,a)?{valid:!1,error:"\u274c Se detectar\xeda una dependencia circular entre ".concat(e," y ").concat(a)}:{valid:!0,error:null}},[p,Ca]);(0,r.useCallback)(e=>{console.log("\ud83d\udd17 SELECT PREDECESORA - EVENTO CAPTURADO:",{event:e,type:e.type,target:e.target,value:e.target.value,selectedTask:null===B||void 0===B?void 0:B.id});const a=e.target.value;if(ee(a),a&&B&&!B.predecessors.includes(a)){var t;const e=Ea(B.id,a);if(!e.valid)return alert(e.error),void(se.current&&(se.current.value=""));const s=[...B.predecessors||[],a],r=(null===(t=document.getElementById("newDependencyType"))||void 0===t?void 0:t.value)||"FS";console.log("\ud83d\udd04 Agregando predecesora desde select:",{tarea:B.id,nuevaPredecesora:a,predecesorasAntes:B.predecessors,predecesorasDespues:s,dependencyType:r}),console.log("\ud83d\udd04 ACTUALIZANDO selectedTask con nuevas predecesoras:",{tarea:B.id,predecesorasAntes:B.predecessors,predecesorasDespues:s,dependencyType:r});const o={id:B.id,wbsCode:B.wbsCode,name:B.name,duration:B.duration,startDate:B.startDate,endDate:B.endDate,progress:B.progress,predecessors:s,cost:B.cost,priority:B.priority,assignedTo:B.assignedTo,isMilestone:B.isMilestone,isCritical:B.isCritical,originalDuration:B.originalDuration,earlyStart:B.earlyStart,earlyFinish:B.earlyFinish,lateStart:B.lateStart,lateFinish:B.lateFinish,totalFloat:B.totalFloat,freeFloat:B.freeFloat,description:B.description,resources:[...B.resources||[]],workPackageId:B.workPackageId,status:B.status,successors:[...B.successors||[]]};console.warn("\ud83d\udea8 ACTUALIZANDO selectedTask:",{antes:B.predecessors,despues:o.predecessors,count:o.predecessors.length}),g(e=>{console.log("\ud83d\udd0d SETTASKS #2 - ACTUALIZANDO ESTADO GLOBAL:",B.id);const a=e.map(e=>e.id===B.id?o:e),t=a.find(e=>e.id===B.id);return t&&G(t),a}),se.current&&(se.current.value="")}},[Ca]);(0,r.useEffect)(()=>{const e=document.getElementById("newSuccessor");if(e){const a=e=>{console.log("\ud83c\udfaf EVENT LISTENER DIRECTO - SUCESORA:",e.target.value,"TIPO:",e.type);const a=e.target.value;if(a&&""!==a.trim()&&"Seleccionar tarea sucesora..."!==a){console.log("\ud83c\udfaf PROCESANDO SUCESORA V\xc1LIDA DIRECTO:",a);let e=B;if(!e){var t;const s=null===(t=document.querySelector("[data-task-id]"))||void 0===t?void 0:t.getAttribute("data-task-id");e=s?p.find(e=>e.id===s):p.find(e=>e.id&&e.id!==a)}if(e&&!e.successors.includes(a)){const t=e.successors.slice().concat([a]);console.log("\ud83c\udfaf Agregando sucesora desde event listener directo:",{tarea:e.id,nuevaSucesora:a,sucesorasAntes:e.successors,sucesorasDespues:t});const s={id:e.id,wbsCode:e.wbsCode,name:e.name,duration:e.duration,startDate:e.startDate,endDate:e.endDate,progress:e.progress,predecessors:[...e.predecessors||[]],cost:e.cost,priority:e.priority,assignedTo:e.assignedTo,isMilestone:e.isMilestone,isCritical:e.isCritical,originalDuration:e.originalDuration,earlyStart:e.earlyStart,earlyFinish:e.earlyFinish,lateStart:e.lateStart,lateFinish:e.lateFinish,totalFloat:e.totalFloat,freeFloat:e.freeFloat,description:e.description,resources:[...e.resources||[]],workPackageId:e.workPackageId,status:e.status,successors:t};G(s),console.log("\ud83c\udfaf SUCESORA AGREGADA A selectedTask (NO al estado global a\xfan)"),console.log("\ud83c\udfaf SUCESORA AGREGADA EXITOSAMENTE DESDE EVENT LISTENER DIRECTO")}}};return e.addEventListener("change",a),e.addEventListener("input",a),()=>{e.removeEventListener("change",a),e.removeEventListener("input",a)}}},[B,p]);const Aa=(0,r.useRef)(B),ka=(0,r.useRef)(Ca),Ma=(0,r.useRef)(Ta);(0,r.useEffect)(()=>{Aa.current=B,ka.current=Ca,Ma.current=Ta},[B,Ca]),(0,r.useEffect)(()=>{console.log("\ud83d\udd27 EVENT DELEGATION GLOBAL DESHABILITADO TEMPORALMENTE")},[]);(0,r.useCallback)((e,a)=>{console.log("updateBusinessCase called:",e,a)},[]);const Pa=(0,r.useCallback)(()=>{const e=ha.map(e=>{var a;return{ID:e.id,WBS:e.wbsCode,Name:e.name,Duration:e.duration,StartDate:e.startDate,EndDate:e.endDate,Progress:e.progress,Predecessors:(null===(a=e.predecessors)||void 0===a?void 0:a.join(", "))||"",Resources:e.resources.join(", "),Cost:e.cost,IsMilestone:e.isMilestone,IsCritical:e.isCritical,Status:e.status,EarlyStart:e.earlyStart,EarlyFinish:e.earlyFinish,LateStart:e.lateStart,LateFinish:e.lateFinish,TotalFloat:e.totalFloat,FreeFloat:e.freeFloat}}),a=o.Wp.json_to_sheet(e),t=o.Wp.book_new();o.Wp.book_append_sheet(t,a,"Cronograma");const s=[["Campo","Valor"],["Nombre del Proyecto",q.projectName],["Objetivo",q.objective],["Patrocinador",q.sponsor],["Gerente del Proyecto",q.manager],["Inversi\xf3n Total",q.totalInvestment],["Beneficios Esperados",q.expectedBenefits],["TIR (%)",q.irr],["ROI (%)",q.roi],["Tiempo de Retorno (a\xf1os)",q.paybackPeriod],["VPN",q.npv]],r=o.Wp.aoa_to_sheet(s);o.Wp.book_append_sheet(t,r,"Caso de Negocio"),o._h(t,"".concat(A.projectName,"-").concat((new Date).toISOString().split("T")[0],".xlsx"))},[ha,A]),Fa=(0,r.useCallback)(()=>{const e=o.Wp.book_new(),a=[["#","Tarea","Duraci\xf3n","Inicio","Fin","Progreso (%)","Prioridad","Asignado","Costo","Predecesoras","Hito","Cr\xedtica","Ruta Cr\xedtica"]];ha.forEach((e,t)=>{var s;a.push([t+1,e.name,"".concat(e.duration,"d"),e.startDate,e.endDate,e.progress||0,e.priority||"Media",e.assignedTo||"Sin asignar",e.cost||0,(null===(s=e.predecessors)||void 0===s?void 0:s.join(", "))||"Sin",e.isMilestone?"S\xed":"No",e.isCritical?"S\xed":"No",e.isCritical?"S\xed":"No"])});const t=o.Wp.aoa_to_sheet(a);t["!cols"]=[{wch:5},{wch:40},{wch:10},{wch:12},{wch:12},{wch:12},{wch:12},{wch:20},{wch:12},{wch:30},{wch:8},{wch:8},{wch:12}],o.Wp.book_append_sheet(e,t,"Cronograma");const s=[["INFORMACI\xd3N DEL PROYECTO"],["Nombre del Proyecto",A.projectName],["Fecha de Inicio",A.startDate],["Fecha de Fin",A.endDate],["Presupuesto Total",A.totalBudget],[""],["ESTAD\xcdSTICAS DEL CRONOGRAMA"],["Total de Tareas",ha.length],["Tareas Cr\xedticas",ha.filter(e=>e.isCritical).length],["Hitos",ha.filter(e=>e.isMilestone).length],["Duraci\xf3n Total (d\xedas)",Math.max(...ha.map(e=>new Date(e.endDate).getTime()))-Math.min(...ha.map(e=>new Date(e.startDate).getTime()))/864e5],[""],["FECHA DE EXPORTACI\xd3N"],["Exportado el",(new Date).toLocaleString("es-ES")]],r=o.Wp.aoa_to_sheet(s);r["!cols"]=[{wch:25},{wch:30}],o.Wp.book_append_sheet(e,r,"Resumen"),o._h(e,"Cronograma-".concat(A.projectName,"-").concat((new Date).toISOString().split("T")[0],".xlsx"))},[ha,A]),Oa=((0,r.useCallback)(e=>{var a;const t=null===(a=e.target.files)||void 0===a?void 0:a[0];if(!t)return;const s=new FileReader;s.onload=e=>{try{const r=JSON.parse(e.target.result);var a,t,s;if(r.tasks&&g(r.tasks),r.baseline&&ue(r.baseline),r.settings)W(r.settings.viewMode||"excel"),oe(r.settings.ganttScale||"days"),ie(null===(a=r.settings.showCriticalPath)||void 0===a||a),ce(null===(t=r.settings.showDependencies)||void 0===t||t),pe(null!==(s=r.settings.showBaseline)&&void 0!==s&&s);alert("Proyecto cargado exitosamente")}catch(r){alert("Error al cargar el proyecto. Verifica el formato del archivo.")}},s.readAsText(t)},[]),(0,r.useMemo)(()=>{var e,a;if(0===p.length)return{start:new Date,end:new Date};const t=p.flatMap(e=>[new Date(e.startDate),new Date(e.endDate)]),s={start:new Date(Math.min(...t.map(e=>e.getTime()))),end:new Date(Math.max(...t.map(e=>e.getTime())))};return console.log("\ud83d\udcc5 PROJECT DATES CALCULADO (FECHAS ORIGINALES):",{start:S(s.start),end:S(s.end),totalTasks:p.length,firstTaskDate:null===(e=p[0])||void 0===e?void 0:e.startDate,lastTaskDate:null===(a=p[p.length-1])||void 0===a?void 0:a.endDate,allStartDates:p.map(e=>e.startDate),minStartDate:Math.min(...p.map(e=>new Date(e.startDate).getTime())),minStartDateISO:S(new Date(Math.min(...p.map(e=>new Date(e.startDate).getTime()))))}),s},[p])),Ra=(0,r.useMemo)(()=>{const e=S(Oa.start),a=S(Oa.end);return Math.max(1,E(e,I(a,1,R),R))},[Oa]),La=(0,r.useMemo)(()=>{switch(re){case"days":return 28;case"weeks":return 10;case"months":return 4;default:return 20}},[re]),Ua=(0,r.useMemo)(()=>Ra*La,[Ra,La]),za=(0,r.useMemo)(()=>{const e=ha.filter(e=>e.isCritical).length,a=ha.filter(e=>100===e.progress).length,t=ha.reduce((e,a)=>e+a.cost,0),s=S(new Date),r=ha.reduce((e,a)=>{const t=Math.max(1,M(a.startDate,a.endDate,R)),r=(o=E(a.startDate,s,R)/t,Math.min(1,Math.max(0,o)));var o;return e+a.cost*r},0),o=ha.reduce((e,a)=>e+a.cost*(a.progress/100),0),n=r>0?o/r:1,i=o>0?o/o:1,l=ha.length>0?a/ha.length*100:0,c=t,d=A.totalBudget>0?t/A.totalBudget*100:0;return{totalTasks:ha.length,criticalTasks:e,completedTasks:a,totalCost:t,earnedValue:Math.round(o),plannedValue:Math.round(r),spi:n.toFixed(2),cpi:i.toFixed(2),progressPercentage:l.toFixed(1),investmentToDate:c,projectedROI:d.toFixed(1)}},[ha,A]),[qa,Ba]=(0,r.useState)(!1),[Ga,_a]=(0,r.useState)({name:"",duration:5,startDate:S(new Date),endDate:I(S(new Date),5),description:"",priority:"medium",assignedTo:"",cost:0,selectedPredecessors:[]}),Ha=e=>{console.log("\ud83d\udcca FALLBACK: Intentando con FileReader...");const a=new FileReader;a.onload=e=>{try{console.log("\ud83d\udcca FileReader fallback: datos recibidos");const a=new Uint8Array(e.target.result);if(console.log("\ud83d\udcca Datos convertidos a Uint8Array, tama\xf1o:",a.length),0===a.length)throw new Error("El archivo est\xe1 vac\xedo");const t=o.LF(a,{type:"array"});console.log("\ud83d\udcca Workbook creado exitosamente en fallback"),Va(t)}catch(a){console.error("\u274c Error procesando en fallback:",a),alert("\u274c No se pudo procesar el archivo Excel. Verifica que el archivo no est\xe9 corrupto y que sea un formato v\xe1lido (.xlsx o .xls).")}},a.onerror=e=>{var a;console.error("\u274c Error en FileReader fallback:",e),console.error("\u274c Detalles del error fallback:",null===(a=e.target)||void 0===a?void 0:a.error),alert("\u274c No se pudo leer el archivo con ning\xfan m\xe9todo. Por favor intenta con otro archivo o verifica que no est\xe9 corrupto.")},a.readAsDataURL(e)},Va=e=>{try{console.log("\ud83d\udcca Procesando workbook, hojas disponibles:",e.SheetNames);const a=e.Sheets[e.SheetNames[0]],t=o.Wp.sheet_to_json(a,{header:1});if(console.log("\ud83d\udcca Datos convertidos a JSON, filas:",t.length),console.log("\ud83d\udcca Datos Excel importados:",t),t.length<2)return void alert("El archivo Excel debe tener al menos una fila de encabezados y una fila de datos");const s=t[0];console.log("\ud83d\udcca Encabezados encontrados:",s);const r={nombre:s.findIndex(e=>e&&e.toString().toLowerCase().includes("nombre")),duracion:s.findIndex(e=>e&&e.toString().toLowerCase().includes("duraci")),inicio:s.findIndex(e=>e&&e.toString().toLowerCase().includes("inicio")),fin:s.findIndex(e=>e&&e.toString().toLowerCase().includes("fin")),progreso:s.findIndex(e=>e&&e.toString().toLowerCase().includes("progreso")),prioridad:s.findIndex(e=>e&&e.toString().toLowerCase().includes("prioridad")),asignado:s.findIndex(e=>e&&e.toString().toLowerCase().includes("asignado")),costo:s.findIndex(e=>e&&e.toString().toLowerCase().includes("costo")),predecesoras:s.findIndex(e=>e&&e.toString().toLowerCase().includes("predecesor")),hitos:s.findIndex(e=>e&&e.toString().toLowerCase().includes("hito"))};console.log("\ud83d\udcca Mapeo de columnas:",r);const n=[];(new Date).toISOString();for(let e=1;e<t.length;e++){const a=t[e];if(!a||a.every(e=>!e))continue;const s=parseInt(a[r.duracion])||5;let i=0===s;if(-1!==r.hitos&&a[r.hitos]){const e=a[r.hitos].toString().toLowerCase().trim();i="s\xed"===e||"si"===e||"yes"===e||"1"===e||"true"===e}const l=e=>{if(!e)return(new Date).toISOString().split("T")[0];if("number"===typeof e)try{return o.tF.parse_date_code(e)}catch(a){return console.warn("Error parsing date code:",e,a),(new Date).toISOString().split("T")[0]}try{const a=new Date(e);return isNaN(a.getTime())?(console.warn("Invalid date value:",e),(new Date).toISOString().split("T")[0]):a.toISOString().split("T")[0]}catch(a){return console.warn("Error parsing date:",e,a),(new Date).toISOString().split("T")[0]}},c=l(a[r.inicio]),d=i?c:l(a[r.fin]),u=a[r.nombre]||"Tarea ".concat(e),m=N(u);if(!m.valid){console.error("\u274c Error en fila ".concat(e+1,": ").concat(m.error));continue}const p=D(s);if(!p.valid){console.error("\u274c Error en fila ".concat(e+1,": ").concat(p.error));continue}const g=w(c);if(!g.valid){console.error("\u274c Error en fila ".concat(e+1,": ").concat(g.error));continue}const h={id:crypto.randomUUID(),wbsCode:"".concat(e),name:m.sanitized,duration:i?0:Math.max(1,M(c,d,R)),startDate:g.value,endDate:d,progress:Math.max(0,Math.min(100,parseInt(a[r.progreso])||0)),priority:j(a[r.prioridad]||"medium"),assignedTo:j(a[r.asignado]||""),cost:Math.max(0,parseFloat(a[r.costo])||0),predecessors:[],successors:[],isMilestone:i,originalDuration:i?1:s,description:"",resources:[],status:"pending"};if(a[r.predecesoras]){const t=a[r.predecesoras].toString();console.log("\ud83d\udd0d Procesando predecesoras para tarea ".concat(e,': "').concat(t,'"'));const s=t.split(",").map(e=>e.trim()).filter(Boolean);console.log("\ud83d\udd0d Valores de predecesoras procesados: [".concat(s.join(", "),"]")),h.predecessors=s,console.log("\ud83d\udd0d Predecesoras temporales (wbsCode): [".concat(h.predecessors.join(", "),"]"))}n.push(h)}if(console.log("\ud83d\udcca Tareas procesadas:",n),0===n.length)return void alert("No se encontraron tareas v\xe1lidas en el archivo Excel");console.log("\ud83d\udd04 Procesando predecesoras con wbsCode como referencia..."),n.forEach(e=>{if(e.predecessors&&e.predecessors.length>0){const a=e.predecessors.map(e=>{const a=n.find(a=>a.wbsCode===e);return a?(console.log("\u2705 Predecesora encontrada: wbsCode ".concat(e," \u2192 ID ").concat(a.id)),a.id):(console.warn("\u26a0\ufe0f Predecesora no encontrada: wbsCode ".concat(e)),null)}).filter(Boolean);e.predecessors=a,console.log('\ud83d\udd17 Tarea "'.concat(e.name,'": predecesoras convertidas a IDs: [').concat(a.join(", "),"]"))}}),console.log("\ud83d\udd0d Validando predecesoras del Excel...");const i=Ia(n);if(i.errors.length>0){const e="\u274c ERRORES ENCONTRADOS EN EL ARCHIVO EXCEL:\n\n".concat(i.errors.join("\n"));return void alert(e)}if(i.warnings.length>0){const e="\u26a0\ufe0f ADVERTENCIAS ENCONTRADAS:\n\n".concat(i.warnings.join("\n"),"\n\n\xbfDeseas continuar con la importaci\xf3n?");if(!window.confirm(e))return}console.log("\u2705 Validaci\xf3n de predecesoras completada exitosamente"),console.log("\ud83d\udcca IMPORTACI\xd3N - REEMPLAZANDO CRONOGRAMA COMPLETO"),console.log("\ud83d\udcca IMPORTACI\xd3N - Tareas anteriores:",(null===p||void 0===p?void 0:p.length)||0),console.log("\ud83d\udcca IMPORTACI\xd3N - Nuevas tareas:",n.length),console.log("\ud83d\udcca IMPORTACI\xd3N - Primeras 3 tareas nuevas:",n.slice(0,3)),console.log("\ud83d\udcca IMPORTACI\xd3N - importTasks es funci\xf3n?",typeof y);const l="\u26a0\ufe0f IMPORTACI\xd3N DE CRONOGRAMA COMPLETO\n\n"+"Tareas actuales: ".concat((null===p||void 0===p?void 0:p.length)||0,"\n")+"Nuevas tareas: ".concat(n.length,"\n\n")+"Esto REEMPLAZAR\xc1 COMPLETAMENTE el cronograma actual.\nLas tareas de minuta existentes podr\xedan quedar sin hito asignado.\n\n\xbfContinuar con la importaci\xf3n?";if(!window.confirm(l))return void console.log("\ud83d\udcca IMPORTACI\xd3N - Cancelada por el usuario");const c=C(n);if(console.log("\ud83d\udcca IMPORTACI\xd3N - Tareas ordenadas por wbsCode:",c.map(e=>({name:e.name,wbsCode:e.wbsCode}))),"function"===typeof y)y(c),console.log("\ud83d\udcca IMPORTACI\xd3N - importTasks llamado exitosamente - CRONOGRAMA REEMPLAZADO");else{if(console.error("\u274c IMPORTACI\xd3N - importTasks no est\xe1 disponible, usando setTasks como fallback"),"function"!==typeof g)return console.error("\u274c IMPORTACI\xd3N - Ni importTasks ni setTasks est\xe1n disponibles"),void alert("Error: No se puede completar la importaci\xf3n. Las funciones de actualizaci\xf3n no est\xe1n disponibles.");g(c),console.log("\ud83d\udcca IMPORTACI\xd3N - setTasks llamado como fallback - CRONOGRAMA REEMPLAZADO")}const d=new CustomEvent("dataChange",{detail:{type:"schedule_imported",taskCount:n.length,timestamp:(new Date).toISOString()}});window.dispatchEvent(d);const u=n.map(e=>new Date(e.startDate)),m=n.map(e=>new Date(e.endDate)),h=new Date(Math.min(...u)),x=new Date(Math.max(...m));P&&P({tasks:n,projectStart:h.toISOString().split("T")[0],projectEnd:x.toISOString().split("T")[0],totalTasks:n.length,completedTasks:n.filter(e=>"completed"===e.status).length,totalCost:n.reduce((e,a)=>e+(a.cost||0),0)}),alert("\u2705 CRONOGRAMA REEMPLAZADO EXITOSAMENTE!\n\n\ud83d\udcca ".concat(n.length," tareas cargadas (cronograma anterior eliminado)\n\ud83d\udcc5 Proyecto: ").concat(h.toLocaleDateString("es")," - ").concat(x.toLocaleDateString("es"),"\n\n\u26a0\ufe0f Las tareas de minuta existentes podr\xedan necesitar reasignaci\xf3n de hitos."))}catch(a){console.error("\u274c Error al procesar workbook:",a),alert("Error al procesar el archivo Excel. Verifica que tenga el formato correcto.")}},Wa=(e,a,t)=>{if(J({taskId:e,field:a}),"startDate"===a||"endDate"===a)if(t)if(t.match(/^\d{4}-\d{2}-\d{2}$/))Z(t);else{const e=t.split("/");if(3===e.length){const a=e[0].padStart(2,"0"),t=e[1].padStart(2,"0"),s=e[2];Z("".concat(s,"-").concat(t,"-").concat(a))}else Z(t)}else Z("");else Z(t)},Ka=()=>{je(!0)},Ja=e=>{Te(e),Ee(!0)};(0,r.useEffect)(()=>{(async()=>{if(U&&null!==A&&void 0!==A&&A.id)try{var e;console.log("\ud83d\udd0d DEBUG - Inicializando servicio de IA:",{projectId:A.id,organizationId:A.organizationId,organizationIdType:typeof A.organizationId,hasOrganizationId:!!A.organizationId,currentUser:null===(e=b.default.currentUser)||void 0===e?void 0:e.email}),await h.initialize(b.default.supabase,A.organizationId,b.default.currentUser),console.log("\ud83e\udd16 Servicio de IA inicializado para proyecto:",A.id)}catch(a){console.error("\u274c Error inicializando servicio de IA:",a)}else console.log("\u26a0\ufe0f No se puede inicializar servicio de IA:",{useSupabase:U,hasProjectId:!(null===A||void 0===A||!A.id),projectData:A})})()},[U,null===A||void 0===A?void 0:A.id,null===A||void 0===A?void 0:A.organizationId]);const Ya=()=>{if(!K)return;const{taskId:e,field:a}=K,t=Y;if(console.log("\ud83d\udcbe SAVEEDIT - INICIANDO:",{taskId:e,field:a,newValue:t,tasksLength:p?p.length:"UNDEFINED"}),"dependencies"===a)return void $a();g(s=>(console.log("\ud83d\udcbe SAVEEDIT - Estado ANTES de actualizar:",{prevLength:s?s.length:"UNDEFINED",prevTasks:s?s.map(e=>({id:e.id,name:e.name})):"UNDEFINED"}),s.map(s=>{if(s.id===e){const e={id:s.id,wbsCode:s.wbsCode,name:s.name,duration:s.duration,startDate:s.startDate,endDate:s.endDate,progress:s.progress,predecessors:[...s.predecessors||[]],cost:s.cost,priority:s.priority,assignedTo:s.assignedTo,isMilestone:s.isMilestone,isCritical:s.isCritical,originalDuration:s.originalDuration,earlyStart:s.earlyStart,earlyFinish:s.earlyFinish,lateStart:s.lateStart,lateFinish:s.lateFinish,totalFloat:s.totalFloat,freeFloat:s.freeFloat,description:s.description,resources:[...s.resources||[]],workPackageId:s.workPackageId,status:s.status,successors:[...s.successors||[]]};switch(a){case"name":e.name=t;break;case"duration":const a=parseInt(t)||1;if(e.duration=a,e.isMilestone)e.endDate=e.startDate;else if(R){const t=new Date(e.startDate);t.setDate(t.getDate()+a-1),e.endDate=S(t)}else e.endDate=I(e.startDate,a,R);break;case"startDate":if(e.startDate=t,e.isMilestone)e.endDate=t;else if(R){const a=new Date(t);a.setDate(a.getDate()+e.duration-1),e.endDate=S(a)}else e.endDate=I(t,e.duration,R);break;case"endDate":e.endDate=t;break;case"progress":e.progress=Math.max(0,Math.min(100,parseInt(t)||0));break;case"priority":e.priority=t;break;case"assignedTo":e.assignedTo=t;break;case"cost":e.cost=parseFloat(t)||0}return e}return s})));const s=new CustomEvent("dataChange",{detail:{type:"taskUpdated",taskId:e,field:a,newValue:t,timestamp:(new Date).toISOString()}});window.dispatchEvent(s),console.log("\ud83d\udcbe SAVEEDIT - COMPLETADO"),J(null),Z("")},Za=()=>{J(null),Z("")},Xa=e=>{K&&("Enter"===e.key?(e.preventDefault(),Ya()):"Escape"===e.key&&(e.preventDefault(),Za()))},$a=()=>{if(!K||"dependencies"!==K.field)return;const{taskId:e}=K;try{const a=Y.split(",").map(e=>parseInt(e.trim())).filter(e=>!isNaN(e)&&e>0);console.log("\ud83d\udcbe Guardando dependencias para tarea ".concat(e,": n\xfameros wbsCode [").concat(a.join(", "),"]"));const t=a.map(e=>{const a=p.find(a=>parseInt(a.wbsCode)===e);return a?(console.log("\u2705 Predecesora encontrada: wbsCode ".concat(e," \u2192 ID ").concat(a.id)),a.id):(console.warn("\u26a0\ufe0f Predecesora no encontrada: wbsCode ".concat(e)),null)}).filter(e=>e);g(a=>a.map(a=>{if(a.id===e){const s={id:a.id,wbsCode:a.wbsCode,name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,progress:a.progress,predecessors:[...a.predecessors||[]],cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:[...a.successors||[]]};return s.predecessors=t,s.successors=[],((e,a)=>{g(t=>t.map(t=>{if(t.id===e)return{id:t.id,wbsCode:t.wbsCode,name:t.name,duration:t.duration,startDate:t.startDate,endDate:t.endDate,progress:t.progress,predecessors:[...a||[]],cost:t.cost,priority:t.priority,assignedTo:t.assignedTo,isMilestone:t.isMilestone,isCritical:t.isCritical,originalDuration:t.originalDuration,earlyStart:t.earlyStart,earlyFinish:t.earlyFinish,lateStart:t.lateStart,lateFinish:t.lateFinish,totalFloat:t.totalFloat,freeFloat:t.freeFloat,description:t.description,resources:[...t.resources||[]],workPackageId:t.workPackageId,status:t.status,successors:[]};let s={id:t.id,wbsCode:t.wbsCode,name:t.name,duration:t.duration,startDate:t.startDate,endDate:t.endDate,progress:t.progress,predecessors:[...t.predecessors||[]],cost:t.cost,priority:t.priority,assignedTo:t.assignedTo,isMilestone:t.isMilestone,isCritical:t.isCritical,originalDuration:t.originalDuration,earlyStart:t.earlyStart,earlyFinish:t.earlyFinish,lateStart:t.lateStart,lateFinish:t.lateFinish,totalFloat:t.totalFloat,freeFloat:t.freeFloat,description:t.description,resources:[...t.resources||[]],workPackageId:t.workPackageId,status:t.status,successors:[...t.successors||[]]};return a.includes(t.id)?s.successors.includes(e)||(s.successors=s.successors.slice().concat([e])):s.successors=s.successors.filter(a=>a!==e),s}))})(e,t),s}return a})),J(null),Z("")}catch(a){console.error("Error al guardar dependencias:",a),J(null),Z("")}},Qa=(0,r.useMemo)(()=>{const e=S(Oa.start),a=e;return console.log("\ud83c\udfaf TIMELINE REFERENCE DATE CALCULADO (CORREGIDO):",{originalProjectStart:e,includeWeekends:R,referenceDate:a,isShifted:e!==a,shiftDays:e!==a?Math.round((new Date(a)-new Date(e))/864e5):0,note:"Usando fecha original sin aplicar findFirstWorkingDay para alineaci\xf3n perfecta con tabla"}),a},[Oa.start,R]),et=(0,r.useMemo)(()=>{const e=S(new Date),a=k(e,Qa,R);return Math.min(Math.max(0,a*La),Ua)},[Qa,La,Ua,R]),at=()=>{const e=Qa;return console.log("\ud83c\udfaf GANTT BARS REFERENCIA:",{pStart:e,projectDatesStart:S(Oa.start),includeWeekends:R,pxPerDay:La}),ha.map(a=>{const t=a.startDate,s=a.endDate,r=k(t,e,R),o=k(s,e,R),n=Math.max(1,o-r+1);if(a.name.includes("Aprobaci\xf3n")||a.name.includes("Generaci\xf3n")||a.name.includes("Env\xedo")||a.name.includes("Soluci\xf3n")){console.log("\ud83c\udd95 GANTT USANDO FECHAS DE TABLA (CORREGIDO DEFINITIVAMENTE):"),console.log("   taskName:",a.name),console.log("   \ud83d\udccb FECHAS DE TABLA (las que rigen):"),console.log("   - tableStartDate:",t),console.log("   - tableEndDate:",s),console.log("   \ud83e\uddee FECHAS CALCULADAS POR CPM (solo informativas):"),console.log("   - earlyStart:",a.earlyStart),console.log("   - earlyFinish:",a.earlyFinish),console.log("   \ud83d\udcca C\xc1LCULOS GANTT (usando findColumnIndex corregido para alineaci\xf3n perfecta):"),console.log("   - projectStart:",e),console.log("   - includeWeekends:",R),console.log("   - leftDays (findColumnIndex corregido):",r),console.log("   - endColumnIndex (findColumnIndex corregido):",o),console.log("   - durDays (diferencia de columnas):",n),console.log("   - leftPx calculado:",r*La),console.log("   - widthPx calculado:",n*La),a.name.includes("Aprobaci\xf3n")&&(console.log("\ud83d\udd0d DEBUG ESPEC\xcdFICO TAREA 1:"),console.log("   - Fecha inicio tabla:",t),console.log("   - Fecha referencia proyecto:",e),console.log("   - includeWeekends:",R),console.log("   - leftDays (findColumnIndex corregido):",r),console.log("   - leftPx calculado:",r*La),console.log("   - \xbfDeber\xeda ser 1?",t===e?"S\xcd (ahora corregido)":"NO"));const i=new Date(t).toLocaleDateString("es-ES"),l=new Date(s).toLocaleDateString("es-ES");console.log("   \ud83d\udcc5 FECHAS MOSTRADAS EN TABLA:"),console.log("   - Inicio:",i),console.log("   - Fin:",l),console.log("   - \xbfLas barras se alinean con estas fechas?","S\xcd (usando findColumnIndex corregido)"),console.log("   - \xbfRespeta includeWeekends?","S\xcd (usando findColumnIndex corregido)"),console.log("   - \xbfDesfase de un d\xeda corregido?","S\xcd (cambio de < a <= en findColumnIndex)"),t===a.earlyStart&&s===a.earlyFinish||(console.log("   \u26a0\ufe0f DIFERENCIA ENTRE TABLA Y CPM:"),console.log("   - Tabla inicio:",t,"vs CPM inicio:",a.earlyStart),console.log("   - Tabla fin:",s,"vs CPM fin:",a.earlyFinish),console.log("   \u2705 GANTT USAR\xc1 FECHAS DE TABLA (correcto)"))}return{id:a.id,wbsCode:a.wbsCode,name:a.name,duration:a.duration,startDate:t,endDate:s,progress:a.progress,predecessors:[...a.predecessors||[]],cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:[...a.successors||[]],leftPx:r*La,widthPx:a.isMilestone?12:Math.max(1,n*La)}})},tt=((0,r.useMemo)(()=>{if(0===ha.length)return[];const e=[];return ha.forEach(a=>{a.predecessors.forEach(t=>{const s=ha.find(e=>e.id===t);s&&e.push({id:"".concat(t,"-").concat(a.id),source:t,target:a.id,type:"predecessor",isCritical:a.isCritical&&s.isCritical})})}),e},[ha]),()=>{if(!ma.current||0===ya.length)return;let e=1/0,a=1/0,t=-1/0,s=-1/0;ya.forEach(r=>{e=Math.min(e,r.x),a=Math.min(a,r.y),t=Math.max(t,r.x+r.width),s=Math.max(s,r.y+r.height)});const r=t-e,o=s-a;if(0===r||0===o)return;const n=1200/r,i=600/o,l=Math.min(n,i,2),c=Math.max(.3,l);Ze(c);$e({x:(e+t)/2-1200/(2*c),y:(a+s)/2-600/(2*c)})});(0,r.useMemo)(()=>{const e=ha.length,a=ha.reduce((e,a)=>e+a.predecessors.length,0),t=ha.filter(e=>e.isCritical).length;console.log("\ud83d\udcca M\xc9TRICAS DEL DIAGRAMA:",{totalNodes:e,totalEdges:a,criticalPathLength:t,tareasConDeps:ha.filter(e=>e.predecessors.length>0).length,detalleDeps:ha.map(e=>({id:e.id,name:e.name,predecessors:e.predecessors,count:e.predecessors.length}))});const s=new Map,r=new Set,o=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;if(r.has(e))return s.get(e)||0;if(t.has(e))return console.warn("Dependencia circular detectada en tarea (an\xe1lisis):",e),s.set(e,a),r.add(e),a;t.add(e),r.add(e);const n=ha.find(a=>a.id===e);if(!n)return t.delete(e),a;let i=a;for(const s of n.predecessors){const e=o(s,a+1,t);i=Math.max(i,e)}return s.set(e,i),t.delete(e),i};for(const n of ha)o(n.id);return{totalNodes:e,totalEdges:a,criticalPathLength:t,maxDepth:Math.max(...s.values(),0)}},[ha]);return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 rounded-2xl shadow-lg p-6 mb-8 border border-blue-200 relative overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,n.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-indigo-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,n.jsxs)("div",{className:"relative z-10",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6 mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"bg-blue-100 rounded-2xl p-3 mr-4",children:(0,n.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc5"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Cronograma del Proyecto"}),(0,n.jsx)("p",{className:"text-gray-600 text-lg",children:"Gesti\xf3n de tiempo, dependencias y recursos integrada con EVM"})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,n.jsxs)("button",{onClick:Pa,className:"bg-white text-gray-700 px-4 py-2 rounded-xl hover:bg-blue-50 flex items-center space-x-2 transition-all duration-300 border border-gray-300 hover:border-blue-300 text-sm shadow-sm",children:[(0,n.jsx)("span",{children:"\ud83d\udce5"}),(0,n.jsx)("span",{children:"Exportar"})]}),(0,n.jsxs)("button",{onClick:()=>(()=>{const e=ha.filter(e=>e.isCritical);if(0===e.length)return void alert("No hay tareas cr\xedticas para comprimir");const a=e.map(e=>({id:e.id,wbsCode:e.wbsCode,name:e.name,duration:e.duration,startDate:e.startDate,endDate:e.endDate,progress:e.progress,predecessors:[...e.predecessors||[]],cost:e.cost,priority:e.priority,assignedTo:e.assignedTo,isMilestone:e.isMilestone,isCritical:e.isCritical,originalDuration:e.originalDuration,earlyStart:e.earlyStart,earlyFinish:e.earlyFinish,lateStart:e.lateStart,lateFinish:e.lateFinish,totalFloat:e.totalFloat,freeFloat:e.freeFloat,description:e.description,resources:[...e.resources||[]],workPackageId:e.workPackageId,status:e.status,successors:[...e.successors||[]],compressionPotential:Math.min(.3*e.duration,5),compressionCost:.2*e.cost})).sort((e,a)=>a.compressionPotential-e.compressionPotential).slice(0,3).map(e=>"".concat(e.name,": -").concat(e.compressionPotential," d\xedas ($").concat(e.compressionCost.toFixed(2),"/d\xeda)")).join("\n"),t=prompt("\xbfCu\xe1ntos d\xedas quieres comprimir del cronograma?\n\nOpciones de compresi\xf3n:\n".concat(a,"\n\nIngresa el n\xfamero de d\xedas:"),"1");if(t&&!isNaN(t)){const e=parseInt(t);let a=0,s=0;const r=ha.map(t=>{if(t.isCritical&&a<e){const r=Math.min(t.compressionPotential,e-a);if(r>0)return a+=r,s+=r*t.compressionCost,{id:t.id,wbsCode:t.wbsCode,name:t.name,duration:Math.max(1,t.duration-r),startDate:t.startDate,endDate:t.endDate,progress:t.progress,predecessors:[...t.predecessors||[]],cost:t.cost,priority:t.priority,assignedTo:t.assignedTo,isMilestone:t.isMilestone,isCritical:t.isCritical,originalDuration:t.originalDuration,earlyStart:t.earlyStart,earlyFinish:t.earlyFinish,lateStart:t.lateStart,lateFinish:t.lateFinish,totalFloat:t.totalFloat,freeFloat:t.freeFloat,description:t.description,resources:[...t.resources||[]],workPackageId:t.workPackageId,status:t.status,successors:[...t.successors||[]],compressedDays:(t.compressedDays||0)+r,compressionCost:(t.compressionCost||0)+r*t.compressionCost}}return t});a>0?(g(r),alert("\u2705 Cronograma comprimido ".concat(a," d\xedas\n\ud83d\udcb0 Costo adicional: $").concat(s.toFixed(2)))):alert("No se pudo comprimir el cronograma con los par\xe1metros especificados")}})(),className:"bg-white text-gray-700 px-4 py-2 rounded-xl hover:bg-blue-50 flex items-center space-x-2 transition-all duration-300 border border-gray-300 hover:border-blue-300 text-sm shadow-sm",title:"Comprimir cronograma (en desarrollo)",children:[(0,n.jsx)("span",{children:"\ud83d\ude80"}),(0,n.jsx)("span",{children:"Comprimir"})]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4 mb-6",children:[(0,n.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-blue-200 hover:shadow-md transition-all duration-300",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,n.jsx)("span",{className:"text-lg",children:"\ud83d\udcc5"}),(0,n.jsx)("span",{className:"text-sm font-medium text-blue-600",children:"Inicio"})]}),(0,n.jsx)("div",{className:"text-lg font-bold text-gray-800",children:ha.length>0?(()=>{const e=ha.map(e=>new Date(e.startDate));return new Date(Math.min(...e)).toLocaleDateString("es")})():null!==A&&void 0!==A&&A.startDate?new Date(A.startDate).toLocaleDateString("es"):"N/A"})]}),(0,n.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-blue-200 hover:shadow-md transition-all duration-300",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,n.jsx)("span",{className:"text-lg",children:"\ud83d\udcc5"}),(0,n.jsx)("span",{className:"text-sm font-medium text-blue-600",children:"Fin"})]}),(0,n.jsx)("div",{className:"text-lg font-bold text-gray-800",children:(()=>{if(ha.length>0){const e=ha.filter(e=>e.endDate&&null!==e.endDate&&void 0!==e.endDate).map(e=>{const[a,t,s]=e.endDate.split("-");return new Date(parseInt(a),parseInt(t)-1,parseInt(s))}).filter(e=>!isNaN(e.getTime())),a=new Date(Math.max(...e)),t=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0"),o="".concat(r,"/").concat(s,"/").concat(t);return console.log("\ud83d\udd0d DEBUG - Fecha de fin del cronograma (usando fechas de tabla):",{totalTasks:ha.length,originalEndDates:e.map(e=>e&&!isNaN(e.getTime())?e.toISOString().split("T")[0]:"N/A"),maxEndDate:a&&!isNaN(a.getTime())?a.toISOString().split("T")[0]:"N/A",year:t,month:s,day:r,formattedDate:o}),o}return null!==A&&void 0!==A&&A.endDate?new Date(A.endDate).toLocaleDateString("es"):"N/A"})()})]}),(0,n.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-blue-200 hover:shadow-md transition-all duration-300",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,n.jsx)("span",{className:"text-lg",children:"\ud83d\udcb0"}),(0,n.jsx)("span",{className:"text-sm font-medium text-blue-600",children:"Presupuesto"})]}),(0,n.jsxs)("div",{className:"text-lg font-bold text-gray-800",children:["$",ha.reduce((e,a)=>e+(a.cost||0),0).toLocaleString()]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-red-200 hover:shadow-md transition-all duration-300",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,n.jsx)("span",{className:"text-lg",children:"\ud83d\udd25"}),(0,n.jsx)("span",{className:"text-sm font-medium text-red-600",children:"Ruta Cr\xedtica"})]}),(0,n.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:(null===ga||void 0===ga?void 0:ga.criticalPathLength)||0}),(0,n.jsx)("div",{className:"text-sm text-red-600",children:"d\xedas"})]}),(0,n.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-red-200 hover:shadow-md transition-all duration-300",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,n.jsx)("span",{className:"text-lg",children:"\u26a0\ufe0f"}),(0,n.jsx)("span",{className:"text-sm font-medium text-red-600",children:"Tareas Cr\xedticas"})]}),(0,n.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:(null===ga||void 0===ga||null===(a=ga.criticalPath)||void 0===a?void 0:a.length)||0}),(0,n.jsx)("div",{className:"text-sm text-red-600",children:"tareas"})]})]}),(0,n.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-xl p-4 border border-blue-200 mb-4",children:(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-4",children:[(0,n.jsxs)("div",{className:"text-center lg:text-left",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-1 flex items-center justify-center lg:justify-start",children:[(0,n.jsx)("span",{className:"mr-2 text-xl",children:"\ud83d\udcca"}),"Selecciona la Vista"]}),(0,n.jsx)("p",{className:"text-gray-600 text-sm",children:"Elige la visualizaci\xf3n que mejor se adapte a tu an\xe1lisis"})]}),(0,n.jsxs)("div",{className:"flex flex-wrap justify-center lg:justify-end gap-2",children:[(0,n.jsxs)("button",{onClick:()=>W("gantt"),className:"px-4 py-2 rounded-lg font-medium text-sm transition-all duration-300 flex items-center space-x-2 ".concat("gantt"===V?"bg-indigo-600 text-white shadow-md hover:shadow-lg":"bg-white text-gray-600 hover:bg-indigo-50 hover:text-indigo-700 border border-gray-300 hover:border-indigo-300"),children:[(0,n.jsx)("span",{children:"\ud83d\udcca"}),(0,n.jsx)("span",{children:"Gantt"})]}),(0,n.jsxs)("button",{onClick:()=>W("excel"),className:"px-4 py-2 rounded-lg font-medium text-sm transition-all duration-300 flex items-center space-x-2 ".concat("excel"===V?"bg-indigo-600 text-white shadow-md hover:shadow-lg":"bg-white text-gray-600 hover:bg-indigo-50 hover:text-indigo-700 border border-gray-300 hover:border-indigo-300"),children:[(0,n.jsx)("span",{children:"\ud83d\udccb"}),(0,n.jsx)("span",{children:"Tabla"})]}),(0,n.jsxs)("button",{onClick:()=>W("minutas"),className:"px-4 py-2 rounded-lg font-medium text-sm transition-all duration-300 flex items-center space-x-2 ".concat("minutas"===V?"bg-indigo-600 text-white shadow-md hover:shadow-lg":"bg-white text-gray-600 hover:bg-indigo-50 hover:text-indigo-700 border border-gray-300 hover:border-indigo-300"),children:[(0,n.jsx)("span",{children:"\ud83d\udccb"}),(0,n.jsx)("span",{children:"Tareas de minutas"})]})]})]})}),(0,n.jsxs)("div",{className:"space-y-3",children:[fe&&(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"mr-2 text-red-500",children:"\u26a0\ufe0f"}),(0,n.jsxs)("span",{className:"text-sm text-red-700",children:["Error CPM: ",fe]})]})}),xa.conflicts.length>0&&(0,n.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-3",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"mr-2 text-yellow-500",children:"\u26a0\ufe0f"}),(0,n.jsxs)("span",{className:"text-sm text-yellow-700",children:[xa.conflicts.length," conflicto(s) de recursos detectado(s)"]})]})})]})]})]}),"excel"===V&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:"\ud83d\udccb Vista Tabla - Cronograma"}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-50 rounded-lg px-3 py-2",children:[(0,n.jsx)("input",{type:"checkbox",id:"includeWeekends",checked:R,onChange:e=>{e.stopPropagation(),console.log("\ud83d\udd04 CHECKBOX CLICK:",e.target.checked),L(e.target.checked)},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),(0,n.jsx)("label",{htmlFor:"includeWeekends",className:"text-sm font-medium text-gray-700",children:"S\xe1bados y domingos son laborables"})]}),(0,n.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg px-3 py-2",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,n.jsx)("span",{className:"text-blue-600",children:"\ud83d\udcc5 Configuraci\xf3n actual:"}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(R?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:R?"Lunes a Domingo":"Lunes a Viernes"})]})}),(0,n.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg px-3 py-2",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,n.jsx)("span",{className:"text-green-600",children:"\ud83d\udd17 Validaci\xf3n:"}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Predecesoras validadas"})]})})]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsxs)("button",{onClick:()=>{console.log("\ud83d\udcca GENERANDO ARCHIVO EXCEL DE EJEMPLO");const e=o.Wp.book_new(),a=o.Wp.aoa_to_sheet([["#","Nombre","Duraci\xf3n","Inicio","Fin","Progreso","Prioridad","Asignado","Costo","Predecesoras","Hitos"],[1,"Inicio del Proyecto",0,"2024-01-01","2024-01-01",100,"Alta","PM",0,"","S\xed"],[2,"An\xe1lisis de Requisitos",5,"2024-01-02","2024-01-08",80,"Alta","Analista",5e3,"1","No"],[3,"Dise\xf1o del Sistema",7,"2024-01-09","2024-01-17",60,"Alta","Arquitecto",8e3,"2","No"],[4,"Aprobaci\xf3n del Dise\xf1o",0,"2024-01-18","2024-01-18",0,"Alta","Cliente",0,"3","S\xed"],[5,"Desarrollo Frontend",10,"2024-01-19","2024-01-30",40,"Media","Dev Frontend",12e3,"4","No"],[6,"Desarrollo Backend",12,"2024-01-22","2024-02-06",30,"Media","Dev Backend",15e3,"4","No"],[7,"Integraci\xf3n",3,"2024-02-07","2024-02-11",0,"Alta","Dev Lead",3e3,"5,6","No"],[8,"Pruebas Unitarias",4,"2024-02-12","2024-02-17",0,"Media","QA",2e3,"7","No"],[9,"Pruebas de Integraci\xf3n",0,"2024-02-18","2024-02-18",0,"Alta","QA Lead",0,"8","S\xed"],[10,"Despliegue en Producci\xf3n",2,"2024-02-19","2024-02-22",0,"Alta","DevOps",1e3,"9","No"],[11,"Cierre del Proyecto",0,"2024-02-23","2024-02-23",0,"Alta","PM",0,"10","S\xed"]]);a["!cols"]=[{wch:5},{wch:25},{wch:10},{wch:12},{wch:12},{wch:10},{wch:12},{wch:15},{wch:10},{wch:15},{wch:8}],o.Wp.book_append_sheet(e,a,"Cronograma");const t="Cronograma_Ejemplo_".concat((new Date).toISOString().split("T")[0],".xlsx");o._h(e,t),console.log("\ud83d\udcca Archivo Excel de ejemplo generado:",t)},className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center space-x-2",title:"Descargar archivo Excel de ejemplo con hitos",children:[(0,n.jsx)("span",{children:"\ud83d\udccb"}),(0,n.jsx)("span",{children:"Descargar Ejemplo"})]}),(0,n.jsxs)("button",{onClick:()=>{var e;return null===(e=ua.current)||void 0===e?void 0:e.click()},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center space-x-2",title:"Importar cronograma desde Excel (reemplaza datos existentes)",children:[(0,n.jsx)("span",{children:"\ud83d\udcca"}),(0,n.jsx)("span",{children:"Importar Cronograma"})]}),(0,n.jsxs)("button",{onClick:()=>ke(!0),className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-2 rounded-lg hover:from-purple-700 hover:to-pink-700 flex items-center space-x-2 transition-all transform hover:scale-105",title:"Generar cronograma autom\xe1ticamente con Asistente de IA",children:[(0,n.jsx)("span",{children:"\ud83e\udd16"}),(0,n.jsx)("span",{children:"Asistente de IA"})]}),(0,n.jsx)("input",{ref:ua,type:"file",accept:".xlsx,.xls",onChange:e=>{var a;const t=null===(a=e.target.files)||void 0===a?void 0:a[0];t&&(e=>{if(console.log("\ud83d\udcca IMPORTANDO CRONOGRAMA COMPLETO desde:",e.name),console.log("\ud83d\udcca Tama\xf1o del archivo:",e.size,"bytes"),console.log("\ud83d\udcca Tipo de archivo:",e.type),e)if(e.size>10485760)alert("\u274c El archivo es demasiado grande. El tama\xf1o m\xe1ximo es 10MB");else if(0!==e.size)if(e.type.includes("sheet")||e.type.includes("excel")||e.name.endsWith(".xlsx")||e.name.endsWith(".xls")){console.log("\u2705 Validaciones de archivo pasadas, iniciando lectura...");try{const a=URL.createObjectURL(e);console.log("\ud83d\udcca URL del archivo creada:",a),fetch(a).then(e=>{if(console.log("\ud83d\udcca Fetch response status:",e.status),!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return e.arrayBuffer()}).then(e=>{console.log("\ud83d\udcca ArrayBuffer recibido, tama\xf1o:",e.byteLength);try{const t=new Uint8Array(e);if(console.log("\ud83d\udcca Datos convertidos a Uint8Array, tama\xf1o:",t.length),0===t.length)throw new Error("El archivo est\xe1 vac\xedo");const s=o.LF(t,{type:"array"});console.log("\ud83d\udcca Workbook creado exitosamente, hojas disponibles:",s.SheetNames),Va(s),URL.revokeObjectURL(a)}catch(t){console.error("\u274c Error procesando datos:",t),URL.revokeObjectURL(a),alert("\u274c No se pudo procesar el archivo Excel. Verifica que el archivo no est\xe9 corrupto y que sea un formato v\xe1lido (.xlsx o .xls).")}}).catch(t=>{console.error("\u274c Error en fetch:",t),URL.revokeObjectURL(a),console.log("\ud83d\udcca Intentando fallback con FileReader..."),Ha(e)})}catch(a){console.error("\u274c Error creando URL del objeto:",a),console.log("\ud83d\udcca Intentando fallback con FileReader..."),Ha(e)}}else alert("\u274c Por favor selecciona un archivo Excel v\xe1lido (.xlsx o .xls)");else alert("\u274c El archivo est\xe1 vac\xedo");else alert("\u274c No se seleccion\xf3 ning\xfan archivo")})(t)},style:{display:"none"}}),(0,n.jsxs)("button",{onClick:Fa,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center space-x-2",children:[(0,n.jsx)("span",{children:"\ud83d\udcca"}),(0,n.jsx)("span",{children:"Descargar Excel"})]})]})]}),(0,n.jsx)("div",{className:"overflow-x-auto overflow-y-auto max-h-[85vh] border border-gray-200 rounded-lg",children:(0,n.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-50",children:[(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-8",children:"#"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-12",children:"Acci\xf3n"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-48",children:"Tarea"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-12",children:"\ud83c\udff9"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-16",children:"Duraci\xf3n"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-24",children:"Inicio"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-24",children:"Fin"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-16",children:"Progreso"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-16",children:"Prioridad"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-24",children:"Asignado"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-16",children:"Costo"}),(0,n.jsx)("th",{className:"border border-gray-300 px-2 py-1.5 text-left text-sm font-medium text-gray-700 w-20",children:"Predecesoras"})]})}),(0,n.jsx)("tbody",{onKeyDown:Xa,children:(()=>{console.log("\ud83d\udd0d DEBUG - Valores de wbsCode antes del ordenamiento:",ha.map(e=>({name:e.name,wbsCode:e.wbsCode,wbsCodeType:typeof e.wbsCode})));const e=C(ha);return console.log("\ud83d\udd0d DEBUG - Valores de wbsCode despu\xe9s del ordenamiento:",e.map(e=>({name:e.name,wbsCode:e.wbsCode,wbsCodeType:typeof e.wbsCode}))),e})().concat([{id:"add-new-task",isAddButton:!0}]).map((e,a)=>e.isAddButton?(0,n.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1 text-sm text-gray-400 text-center",children:"+"}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsxs)("button",{onClick:e=>{e.stopPropagation(),(()=>{console.log("\ud83d\ude80 AGREGANDO TAREA AL FINAL");let e=S(new Date),a=I(e,5,R);if(p.length>0){const t=p[p.length-1];e=I(t.endDate,1,R),a=I(e,5,R)}const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const a=16*Math.random()|0;return("x"===e?a:3&a|8).toString(16)}),r=(()=>{let e,a=1;do{e=a,a++}while(p.some(a=>a.wbsCode===e));return e})(),o={id:t,wbsCode:r,name:"Nueva Tarea ".concat(r),duration:5,startDate:e,endDate:a,progress:0,predecessors:p.length>0?[p[p.length-1].id]:[],successors:[],resources:[],cost:0,isMilestone:!1,isCritical:!1,originalDuration:5,earlyStart:e,earlyFinish:a,lateStart:e,lateFinish:a,totalFloat:0,freeFloat:0,status:"pending",workPackageId:t,plannedValue:0,earnedValue:0,actualCost:0,description:"",priority:"medium",assignedTo:"",createdDate:S(new Date),lastModified:S(new Date)};console.log("\ud83d\ude80 NUEVA TAREA AL FINAL CREADA:",o),g(e=>{const a=[...e,o];if(e.length>0){const r=e[e.length-1].id,o=a.map(e=>e.id===r?(0,s.A)((0,s.A)({},e),{},{successors:[...e.successors||[],t]}):e);return console.log("\u2705 Tarea agregada al final exitosamente"),o}return console.log("\u2705 Primera tarea agregada exitosamente"),a})})()},className:"bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded-md shadow-sm transition-colors duration-200 flex items-center space-x-2",title:"Agregar nueva tarea al final",children:[(0,n.jsx)("span",{children:"\u2795"}),(0,n.jsx)("span",{children:"Nueva Tarea"})]})})}),(0,n.jsx)("td",{colSpan:"10",className:"border border-gray-300 px-2 py-1 text-sm text-gray-400 text-center",children:"Agregar nueva tarea al final del cronograma"})]},"add-new-task"):(0,n.jsxs)("tr",{className:"hover:bg-gray-50 ".concat(X===e.id?"bg-blue-50":""),onClick:()=>$(e.id),children:[(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1 text-sm text-gray-600 text-center",children:a+1}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:(0,n.jsxs)("div",{className:"flex space-x-1 justify-center",children:[(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;console.log("\ud83d\ude80 AGREGANDO TAREA - Insertando despu\xe9s de:",e,"en \xedndice visual:",a);const t=p.find(a=>a.id===e);if(!t)return void console.error("\u274c No se encontr\xf3 la tarea de referencia");const r=I(t.endDate,1,R),o=I(r,5,R),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const a=16*Math.random()|0;return("x"===e?a:3&a|8).toString(16)}),i=(e=>{if(0===e)return 1;const a=p[e-1];if(a&&a.wbsCode){if("number"===typeof a.wbsCode)return a.wbsCode+1;const t=String(a.wbsCode).split(".");if(2===t.length){const e=parseInt(t[0]),a=parseInt(t[1])+1;return"".concat(e,".").concat(a)}return e+1}return e+1})(null!==a?a+1:p.length),l={id:n,wbsCode:i,name:"Nueva Tarea ".concat(i),duration:5,startDate:r,endDate:o,progress:0,predecessors:[e],successors:[],resources:[],cost:0,isMilestone:!1,isCritical:!1,originalDuration:5,earlyStart:r,earlyFinish:o,lateStart:r,lateFinish:o,totalFloat:0,freeFloat:0,status:"pending",workPackageId:n,plannedValue:0,earnedValue:0,actualCost:0,description:"",priority:"medium",assignedTo:"",createdDate:S(new Date),lastModified:S(new Date)};console.log("\ud83d\ude80 NUEVA TAREA CREADA:",l),g(a=>{console.log("\ud83d\udd0d DEBUG - Array antes de inserci\xf3n:",a.map((e,a)=>({index:a,id:e.id,name:e.name,wbsCode:e.wbsCode})));const t=a.findIndex(a=>a.id===e);if(-1===t)return console.error("\u274c No se encontr\xf3 la tarea de referencia en el array"),a;const r=t+1,o=[...a.slice(0,r),l,...a.slice(r)];console.log("\ud83d\udd0d DEBUG - Tarea insertada en posici\xf3n:",r),console.log("\ud83d\udd0d DEBUG - Array despu\xe9s de inserci\xf3n:",o.map((e,a)=>({index:a,id:e.id,name:e.name,wbsCode:e.wbsCode})));const i=o.map(a=>a.id===e?(0,s.A)((0,s.A)({},a),{},{successors:[...a.successors||[],n]}):a).map((e,a)=>(0,s.A)((0,s.A)({},e),{},{wbsCode:a+1}));return console.log("\ud83d\udd0d DEBUG - Array final con wbsCode actualizado:",i.map((e,a)=>({index:a,id:e.id,name:e.name,wbsCode:e.wbsCode}))),console.log("\u2705 Tarea agregada exitosamente en posici\xf3n correcta"),i})}(e.id,a)},className:"bg-green-500 hover:bg-green-600 text-white text-sm px-2 py-1 rounded-md shadow-sm transition-colors duration-200 flex items-center justify-center min-w-[32px]",title:"Insertar fila despu\xe9s (como MS Project)",children:"\u2795"}),(0,n.jsx)("button",{onClick:a=>{a.stopPropagation(),(e=>{const a=p.find(a=>a.id===e);if(!a)return void console.error("\u274c Tarea no encontrada para eliminar");const t=p.filter(a=>{var t,s;return(null===(t=a.predecessors)||void 0===t?void 0:t.includes(e))||(null===(s=a.successors)||void 0===s?void 0:s.includes(e))});let r='\xbfEst\xe1s seguro de que quieres eliminar la tarea "'.concat(a.name,'"?');t.length>0&&(r+="\n\n\u26a0\ufe0f ADVERTENCIA: Esta tarea tiene dependencias:\n",t.forEach(a=>{var t,s;null!==(t=a.predecessors)&&void 0!==t&&t.includes(e)&&(r+='\u2022 "'.concat(a.name,'" depende de esta tarea\n')),null!==(s=a.successors)&&void 0!==s&&s.includes(e)&&(r+='\u2022 Esta tarea depende de "'.concat(a.name,'"\n'))}),r+="\nLas dependencias se limpiar\xe1n autom\xe1ticamente."),r+="\n\nEsta acci\xf3n no se puede deshacer.",window.confirm(r)&&(console.log("\ud83d\uddd1\ufe0f ELIMINANDO TAREA:",a.name,"ID:",e),console.log("\ud83d\udd17 Tareas dependientes encontradas:",t.length),g(a=>{const t=a.filter(a=>a.id!==e).map(a=>{var t,r;return(0,s.A)((0,s.A)({},a),{},{predecessors:(null===(t=a.predecessors)||void 0===t?void 0:t.filter(a=>a!==e))||[],successors:(null===(r=a.successors)||void 0===r?void 0:r.filter(a=>a!==e))||[]})}).map((e,a)=>(0,s.A)((0,s.A)({},e),{},{wbsCode:a+1}));return console.log("\u2705 Tarea eliminada exitosamente"),console.log("\ud83d\udd27 wbsCode reasignados despu\xe9s de eliminaci\xf3n:",t.map(e=>({name:e.name,wbsCode:e.wbsCode}))),t}))})(e.id)},className:"bg-red-500 hover:bg-red-600 text-white text-sm px-2 py-1 rounded-md shadow-sm transition-colors duration-200 flex items-center justify-center min-w-[32px]",title:"Eliminar tarea (como MS Project)",children:"\ud83d\uddd1\ufe0f"})]})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:(null===K||void 0===K?void 0:K.taskId)===e.id&&"name"===(null===K||void 0===K?void 0:K.field)?(0,n.jsx)("input",{type:"text",value:Y,onChange:e=>Z(e.target.value),onBlur:Ya,onKeyDown:Xa,className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,n.jsx)("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center",onClick:()=>Wa(e.id,"name",e.name),title:"Click para editar nombre (como MS Project)",children:e.name})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1 text-center",children:(0,n.jsx)("button",{onClick:()=>(e=>{g(a=>a.map(a=>{if(a.id!==e)return a;if(!a.isMilestone)return console.log("\ud83d\udd0d DEBUG - Creando hito:",{taskId:e,taskName:a.name,startDate:a.startDate,endDate:a.startDate,duration:0}),{id:a.id,wbsCode:a.wbsCode,name:a.name,duration:0,startDate:a.startDate,endDate:a.startDate,progress:a.progress,predecessors:[...a.predecessors||[]],cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:!0,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:[...a.successors||[]],updatedAt:(new Date).toISOString()};{const e=a.originalDuration||1,t=I(a.startDate,e,R);return{id:a.id,wbsCode:a.wbsCode,name:a.name,duration:e,startDate:a.startDate,endDate:t,progress:a.progress,predecessors:[...a.predecessors||[]],cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:!1,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:[...a.successors||[]],updatedAt:(new Date).toISOString()}}}));const a=new CustomEvent("dataChange",{detail:{type:"milestone_toggled",taskId:e,timestamp:(new Date).toISOString()}});window.dispatchEvent(a)})(e.id),className:"w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all duration-200 ".concat(e.isMilestone?"bg-indigo-500 border-indigo-500 text-white shadow-lg":"bg-white border-gray-300 text-gray-400 hover:border-indigo-300 hover:text-indigo-400"),title:e.isMilestone?"Quitar hito":"Marcar como hito",children:"\ud83c\udff9"})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:e.isMilestone?(0,n.jsx)("div",{className:"px-2 py-1 rounded bg-purple-100 text-purple-800 text-center font-medium",children:"0d"}):(null===K||void 0===K?void 0:K.taskId)===e.id&&"duration"===(null===K||void 0===K?void 0:K.field)?(0,n.jsx)("input",{type:"number",value:Y,onChange:e=>Z(e.target.value),onBlur:Ya,onKeyDown:Xa,className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,n.jsxs)("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center",onClick:()=>Wa(e.id,"duration",e.duration),title:"Click para editar duraci\xf3n (como MS Project)",children:[e.duration,"d"]})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:(null===K||void 0===K?void 0:K.taskId)===e.id&&"startDate"===(null===K||void 0===K?void 0:K.field)?(0,n.jsx)("input",{type:"date",value:Y,onChange:e=>Z(e.target.value),onBlur:Ya,onKeyDown:Xa,className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,n.jsx)("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center text-sm",onClick:()=>Wa(e.id,"startDate",e.startDate),title:"Click para editar fecha de inicio (como MS Project)",children:e.startDate&&null!==e.startDate&&void 0!==e.startDate?e.startDate.split("-").reverse().join("/"):""})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:e.isMilestone?(0,n.jsx)("div",{className:"px-2 py-1 rounded bg-purple-100 text-purple-800 text-center font-medium text-sm",children:(()=>{if(!e.startDate||null===e.startDate||void 0===e.startDate)return"";const[a,t,s]=e.startDate.split("-");return new Date(a,t-1,s).toLocaleDateString("es")})()}):(null===K||void 0===K?void 0:K.taskId)===e.id&&"endDate"===(null===K||void 0===K?void 0:K.field)?(0,n.jsx)("input",{type:"date",value:Y,onChange:e=>Z(e.target.value),onBlur:Ya,onKeyDown:Xa,className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,n.jsx)("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center text-sm",onClick:()=>Wa(e.id,"endDate",e.endDate),title:"Click para editar fecha de fin (como MS Project)",children:e.isMilestone?e.startDate&&null!==e.startDate&&void 0!==e.startDate?e.startDate.split("-").reverse().join("/"):"":e.endDate&&null!==e.endDate&&void 0!==e.endDate?e.endDate.split("-").reverse().join("/"):""})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:(null===K||void 0===K?void 0:K.taskId)===e.id&&"progress"===(null===K||void 0===K?void 0:K.field)?(0,n.jsx)("input",{type:"number",min:"0",max:"100",value:Y,onChange:e=>Z(e.target.value),onBlur:Ya,onKeyDown:Xa,className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,n.jsx)("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center",onClick:()=>Wa(e.id,"progress",e.progress),children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(e.progress,"%")}})}),(0,n.jsxs)("span",{className:"text-xs",children:[e.progress,"%"]})]})})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:(null===K||void 0===K?void 0:K.taskId)===e.id&&"priority"===(null===K||void 0===K?void 0:K.field)?(0,n.jsxs)("select",{value:Y,onChange:e=>Z(e.target.value),onBlur:Ya,className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,children:[(0,n.jsx)("option",{value:"low",children:"Baja"}),(0,n.jsx)("option",{value:"medium",children:"Media"}),(0,n.jsx)("option",{value:"high",children:"Alta"}),(0,n.jsx)("option",{value:"critical",children:"Cr\xedtica"})]}):(0,n.jsx)("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center",onClick:()=>Wa(e.id,"priority",e.priority),children:(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("critical"===e.priority?"bg-red-100 text-red-800":"high"===e.priority?"bg-orange-100 text-orange-800":"medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:"critical"===e.priority?"Cr\xedtica":"high"===e.priority?"Alta":"medium"===e.priority?"Media":"Baja"})})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:(null===K||void 0===K?void 0:K.taskId)===e.id&&"assignedTo"===(null===K||void 0===K?void 0:K.field)?(0,n.jsx)("input",{type:"text",value:Y,onChange:e=>Z(e.target.value),onBlur:Ya,onKeyDown:Xa,className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,n.jsx)("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center",onClick:()=>Wa(e.id,"assignedTo",e.assignedTo),children:e.assignedTo||"Sin asignar"})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:(null===K||void 0===K?void 0:K.taskId)===e.id&&"cost"===(null===K||void 0===K?void 0:K.field)?(0,n.jsx)("input",{type:"number",step:"0.01",value:Y,onChange:e=>Z(e.target.value),onBlur:Ya,onKeyDown:Xa,className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,n.jsxs)("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center",onClick:()=>Wa(e.id,"cost",e.cost),children:["$",e.cost.toLocaleString()]})}),(0,n.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:(null===K||void 0===K?void 0:K.taskId)===e.id&&"dependencies"===(null===K||void 0===K?void 0:K.field)?(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Escribe los n\xfameros de fila separados por comas (ej: 1, 2, 3)"}),(0,n.jsx)("input",{type:"text",value:Y,onChange:e=>Z(e.target.value),onBlur:Ya,onKeyDown:Xa,className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"1, 2, 3",autoFocus:!0}),(0,n.jsxs)("div",{className:"flex space-x-1",children:[(0,n.jsx)("button",{onClick:Ya,className:"text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600",children:"Guardar"}),(0,n.jsx)("button",{onClick:Za,className:"text-xs bg-gray-500 text-white px-2 py-1 rounded hover:bg-gray-600",children:"Cancelar"})]})]}):(0,n.jsx)("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center",onClick:()=>(e=>{const a=p.find(a=>a.id===e);if(!a)return;const t=a.predecessors.map(e=>{const a=p.find(a=>a.id===e);return a?parseInt(a.wbsCode):null}).filter(Boolean);J({taskId:e,field:"dependencies"}),Z(t.join(", ")),console.log("\ud83d\udd0d Editando dependencias de tarea ".concat(a.wbsCode,": mostrando n\xfameros wbsCode [").concat(t.join(", "),"]"))})(e.id),title:"Click para editar predecesoras",children:(0,n.jsx)("div",{className:"flex items-center space-x-2 text-xs",children:e.predecessors.length>0?(0,n.jsx)("div",{className:"flex flex-wrap gap-1",children:e.predecessors.map(e=>{const a=p.find(a=>a.id===e),t=a?parseInt(a.wbsCode):e;return(0,n.jsx)("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-medium",children:t},e)})}):(0,n.jsx)("span",{className:"text-gray-400",children:"Sin predecesoras"})})})})]},e.id))})]})}),(0,n.jsx)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-700",children:"Total Tareas:"}),(0,n.jsx)("span",{className:"ml-2 text-gray-600",children:ha.length})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-700",children:"Duraci\xf3n Total:"}),(0,n.jsxs)("span",{className:"ml-2 text-gray-600",children:[ha.reduce((e,a)=>e+a.duration,0)," d\xedas"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-700",children:"Progreso Promedio:"}),(0,n.jsxs)("span",{className:"ml-2 text-gray-600",children:[Math.round(ha.reduce((e,a)=>e+a.progress,0)/ha.length),"%"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-700",children:"Costo Total:"}),(0,n.jsxs)("span",{className:"ml-2 text-gray-600",children:["$",ha.reduce((e,a)=>e+a.cost,0).toLocaleString()]})]})]})})]}),"gantt"===V&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:"Diagrama Gantt"}),(0,n.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg px-3 py-2",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-blue-700",children:[(0,n.jsx)("span",{children:"\ud83d\udc41\ufe0f"}),(0,n.jsx)("span",{children:"Solo lectura - Edita desde la Vista Tabla"})]})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsxs)("select",{value:re,onChange:e=>oe(e.target.value),className:"px-3 py-2 border rounded-lg",children:[(0,n.jsx)("option",{value:"days",children:"D\xedas"}),(0,n.jsx)("option",{value:"weeks",children:"Semanas"}),(0,n.jsx)("option",{value:"months",children:"Meses"})]}),(0,n.jsx)("button",{onClick:()=>pe(!me),className:"px-3 py-2 rounded-lg transition-colors duration-200 ".concat(me?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"),disabled:0===de.length,children:"Baseline"}),(0,n.jsxs)("button",{onClick:()=>{try{const e=ha.map(e=>({id:e.id,wbsCode:e.wbsCode,name:e.name,duration:e.duration,startDate:e.startDate,endDate:e.endDate,progress:e.progress,priority:e.priority,assignedTo:e.assignedTo,cost:e.cost,predecessors:[...e.predecessors||[]],successors:[...e.successors||[]],isMilestone:e.isMilestone,originalDuration:e.originalDuration,description:e.description,resources:[...e.resources||[]],earlyStart:e.earlyStart,earlyFinish:e.earlyFinish,lateStart:e.lateStart,lateFinish:e.lateFinish,isCritical:e.isCritical,slack:e.slack}));ue(e),pe(!0),alert("Baseline guardado exitosamente")}catch(e){console.error("Error al guardar baseline:",e),alert("Error al guardar el baseline. Por favor intenta de nuevo.")}},className:"bg-indigo-600 text-white px-3 py-2 rounded-lg hover:bg-indigo-700 flex items-center space-x-2",children:[(0,n.jsx)("span",{children:"\ud83d\udcbe"}),(0,n.jsx)("span",{children:"Guardar Baseline"})]})]}),(0,n.jsx)("div",{className:"flex space-x-2",children:(0,n.jsxs)("button",{onClick:Sa,className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 flex items-center space-x-2",title:"Limpiar dependencias circulares que causan duplicaci\xf3n de tareas",children:[(0,n.jsx)("span",{children:"\ud83e\uddf9"}),(0,n.jsx)("span",{children:"Limpiar Dependencias Circulares"})]})})]}),(0,n.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden max-w-full",children:[(0,n.jsx)("div",{className:"bg-blue-50 border-b border-blue-200 p-2",children:(0,n.jsxs)("div",{className:"flex items-center justify-center text-sm text-blue-700",children:[(0,n.jsx)("span",{className:"mr-2",children:"\u2194\ufe0f"}),(0,n.jsx)("span",{children:"Usa el scroll horizontal para navegar por el cronograma completo"})]})}),(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{ref:ca,onScroll:e=>{da.current&&(da.current.scrollTop=e.currentTarget.scrollTop)},className:"w-80 bg-gray-50 border-r overflow-y-auto",style:{height:"600px"},children:(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"TAREAS DEL PROYECTO"}),(0,n.jsxs)("div",{className:"text-xs text-gray-500",children:[ha.length," tareas"]})]}),at().map((e,a)=>(0,n.jsx)("div",{className:"mb-2",children:(0,n.jsxs)("div",{className:"group flex items-center p-3 rounded-lg transition-all duration-200 border ".concat((null===B||void 0===B?void 0:B.id)===e.id?"bg-indigo-100 border-indigo-300 shadow-md":"hover:bg-white hover:border-gray-300 hover:shadow-sm"),onClick:()=>{console.log("\ud83d\udd24 SELECCI\xd3N TAREA - Tarea seleccionada para ver:",{taskId:e.id,nombre:e.name,tareaCompleta:e}),G(e)},style:{height:v},children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"font-medium text-sm text-gray-900 truncate mb-1",children:[e.name,e.isMilestone&&(0,n.jsx)("span",{className:"ml-2 text-indigo-600 text-lg",children:"\ud83c\udff9"})]}),e.isCritical&&(0,n.jsx)("div",{className:"text-xs text-red-600 font-medium",children:"\ud83d\udd25 Tarea Cr\xedtica"})]}),e.isCritical&&(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("span",{className:"inline-block bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full",children:"\ud83d\udd25 Cr\xedtica"})})]})},e.id)),(0,n.jsxs)("div",{className:"mt-4 p-3 bg-white rounded-lg border border-gray-200",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"RESUMEN"}),(0,n.jsxs)("div",{className:"space-y-1 text-xs text-gray-600",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Progreso Total:"}),(0,n.jsxs)("span",{className:"font-medium",children:[za.progressPercentage,"%"]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Tareas Cr\xedticas:"}),(0,n.jsx)("span",{className:"font-medium text-red-600",children:za.criticalTasks})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Completadas:"}),(0,n.jsx)("span",{className:"font-medium text-green-600",children:za.completedTasks})]})]})]})]})}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col max-w-full",style:{height:"600px",maxWidth:"calc(100vw - 400px)"},children:[(0,n.jsx)("div",{className:"bg-gray-100 border-b p-2 flex-shrink-0",style:{backgroundColor:"#f9fafb",borderBottom:"1px solid #e5e7eb"},children:(0,n.jsx)("div",{ref:ja,onScroll:e=>{da.current&&!Na.current&&(Na.current=!0,console.log("\ud83d\udd04 SINCRONIZANDO CONTENIDO - scrollLeft:",e.currentTarget.scrollLeft),console.log("\ud83d\udccf ANCHOS CONTENEDORES (desde headers):",{headerContainerWidth:e.currentTarget.scrollWidth,headerContainerClientWidth:e.currentTarget.clientWidth,rightContainerWidth:da.current.scrollWidth,rightContainerClientWidth:da.current.clientWidth,chartWidthPx:Ua}),da.current.scrollLeft=e.currentTarget.scrollLeft,setTimeout(()=>{Na.current=!1},10))},className:"overflow-x-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200",style:{width:"100%",maxWidth:"100%"},children:(0,n.jsx)("div",{className:"flex",style:{width:Math.max(Ua+100,800),minWidth:Math.max(Ua+100,800)},children:(()=>{const e=[],a=Qa,t=new Date(a),s=new Date(S(Oa.end));if(console.log("\ud83c\udfc1 TIMELINE HEADERS RANGO:",{startDate:S(t),endDate:S(s),ganttScale:re,projectDatesStart:S(Oa.start),projectDatesEnd:S(Oa.end),includeWeekends:R,startReference:S(a),pxPerDay:La,chartWidthPx:Ua}),"days"===re){const a=new Date(t);for(;a<=s;)(R||T(a))&&e.push({label:a.getDate(),sub:a.toLocaleDateString("es",{month:"short"}),width:La}),a.setDate(a.getDate()+1)}else if("weeks"===re){const a=new Date(t);for(;a<=s;){const t=new Date(a),r=new Date(a);r.setDate(r.getDate()+6);const o=Math.min(7,E(t,I(s,1,R),R));e.push({label:"S ".concat(t.getDate(),"\u2014").concat(r.getDate()),sub:t.toLocaleDateString("es",{month:"short"}),width:o*La}),a.setDate(a.getDate()+7)}}else{const a=new Date(t.getFullYear(),t.getMonth(),1);for(;a<=s;){const t=new Date(a.getFullYear(),a.getMonth()+1,1),s=E(S(a),S(t),R);e.push({label:a.toLocaleDateString("es",{month:"short"}),sub:a.getFullYear(),width:s*La}),a.setMonth(a.getMonth()+1)}}return console.log("\ud83c\udfc1 TIMELINE HEADERS GENERADOS:",{totalHeaders:e.length,totalWidth:e.reduce((e,a)=>e+a.width,0),firstHeader:e[0],lastHeader:e[e.length-1]}),e})().map((e,a)=>(0,n.jsxs)("div",{className:"text-xs text-gray-600 text-center border-r border-gray-200 flex-shrink-0",style:{width:e.width,minWidth:e.width},children:[(0,n.jsx)("div",{className:"font-medium",children:e.label}),(0,n.jsx)("div",{className:"text-gray-400",children:e.sub})]},a))})})}),(0,n.jsx)("div",{ref:da,onScroll:e=>{ca.current&&(ca.current.scrollTop=e.currentTarget.scrollTop),ja.current&&!Na.current&&(Na.current=!0,console.log("\ud83d\udd04 SINCRONIZANDO HEADERS - scrollLeft:",e.currentTarget.scrollLeft),console.log("\ud83d\udccf ANCHOS CONTENEDORES:",{headerContainerWidth:ja.current.scrollWidth,headerContainerClientWidth:ja.current.clientWidth,rightContainerWidth:e.currentTarget.scrollWidth,rightContainerClientWidth:e.currentTarget.clientWidth,chartWidthPx:Ua}),ja.current.scrollLeft=e.currentTarget.scrollLeft,setTimeout(()=>{Na.current=!1},10))},className:"flex-1 overflow-x-auto overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200",children:(0,n.jsx)("div",{style:{width:Math.max(Ua+100,800)},children:(0,n.jsxs)("div",{className:"relative",children:[et>0&&et<Ua&&(0,n.jsx)("div",{className:"absolute z-10 w-0.5 bg-red-500",style:{left:et,top:0,height:"600px"},children:(0,n.jsx)("div",{className:"bg-red-500 text-white text-xs px-1 py-0.5 rounded -mt-2 -ml-6",children:"HOY"})}),at().map((e,a)=>(0,n.jsxs)("div",{className:"absolute",style:{left:e.leftPx,top:58*a+10+5,width:e.widthPx,height:40},children:[(0,n.jsxs)("div",{className:"h-8 transition-all duration-200 cursor-default hover:opacity-80 ".concat(e.isMilestone?"rounded-full":"rounded-lg"),title:"Solo lectura - Edita desde la Vista Tabla",style:{width:e.isMilestone?"12px":"100%",height:"100%",background:e.isMilestone?"linear-gradient(45deg, #8b5cf6, #7c3aed)":e.isCritical&&ne?"linear-gradient(45deg, #ef4444, #dc2626)":e.isCritical?"linear-gradient(45deg, #f97316, #ea580c)":"linear-gradient(45deg, #6366f1, #4f46e5)",border:e.isCritical&&ne?"2px solid #dc2626":"none",boxShadow:e.isCritical&&ne?"0 0 10px rgba(239, 68, 68, 0.5)":"none"},children:[(0,n.jsx)("div",{className:"h-full bg-green-400 rounded-l transition-all duration-200",style:{width:"".concat(e.progress,"%"),background:"linear-gradient(45deg, #4ade80, #22c55e)"}}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-white text-xs font-medium px-2",children:(0,n.jsx)("span",{className:"truncate",children:e.name})})]}),me&&pa.has(e.id)&&(0,n.jsx)("div",{className:"absolute top-0 h-full border-2 border-dashed border-gray-700 opacity-90",style:{left:"".concat(E(S(Oa.start),pa.get(e.id).startDate,R)*La,"px"),width:"".concat(Math.max(1,M(pa.get(e.id).startDate,pa.get(e.id).endDate,R)*La),"px"),boxShadow:"0 0 4px rgba(55, 65, 81, 0.4)"}}),le&&e.predecessors.length>0&&(0,n.jsx)("div",{className:"absolute -top-2 left-0 w-full",children:e.predecessors.map((t,s)=>{if(!ha.find(e=>e.id===t))return null;const r=at().find(e=>e.id===t);if(!r)return null;const o=r.leftPx+r.widthPx,i=58*ha.findIndex(e=>e.id===t)+10+5+20,l=e.leftPx,c=58*a+10+5+20;return(0,n.jsxs)("svg",{className:"absolute pointer-events-none",style:{left:0,top:0,width:"100%",height:"100%"},children:[(0,n.jsx)("defs",{children:(0,n.jsx)("marker",{id:"arrow-".concat(e.id,"-").concat(t),markerWidth:"10",markerHeight:"10",refX:"9",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:(0,n.jsx)("polygon",{points:"0,0 0,6 9,3",fill:e.isCritical?"#ef4444":"#6366f1"})})}),(0,n.jsx)("line",{x1:o,y1:i,x2:l,y2:c,stroke:e.isCritical?"#ef4444":"#6366f1",strokeWidth:"2",markerEnd:"url(#arrow-".concat(e.id,"-").concat(t,")"),strokeDasharray:e.isCritical?"none":"5,5"})]},s)})})]},e.id))]})})})]})]})]})]}),!1,"minutas"===V&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6 pb-32",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udccb Tareas de Minutas"}),(0,n.jsxs)("button",{onClick:Ka,className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 flex items-center space-x-2 transition-all duration-300",children:[(0,n.jsx)("span",{children:"\u2795"}),(0,n.jsx)("span",{children:"Nueva Minuta"})]})]}),we?(0,n.jsx)("div",{className:"text-center py-12",children:(0,n.jsxs)("div",{className:"bg-gray-100 rounded-xl p-8",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Cargando minutas..."}),(0,n.jsxs)("p",{className:"text-gray-500",children:["Obteniendo datos desde ",U?"Supabase":"localStorage"]})]})}):0===Ne.length?(0,n.jsx)("div",{className:"text-center py-12",children:(0,n.jsxs)("div",{className:"bg-gray-100 rounded-xl p-8",children:[(0,n.jsx)("span",{className:"text-6xl mb-4 block",children:"\ud83d\udcdd"}),(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No hay tareas de minutas"}),(0,n.jsx)("p",{className:"text-gray-500 mb-4",children:'Crea tu primera minuta haciendo clic en "Nueva Minuta"'}),(0,n.jsx)("button",{onClick:Ka,className:"bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors",children:"\u2795 Crear Primera Minuta"})]})}):(0,n.jsxs)("div",{className:"space-y-6",children:[p.filter(e=>e.isMilestone).map(e=>{const a=Ne.filter(a=>a.hitoId===e.id);return 0===a.length?null:(0,n.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,n.jsx)("div",{className:"bg-blue-50 px-4 py-3 border-b border-gray-200",children:(0,n.jsxs)("h3",{className:"font-semibold text-gray-800",children:["\ud83c\udfaf ",e.wbsCode," - ",e.name]})}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/3",children:"Tarea"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/6",children:"Responsable"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8",children:"Fecha"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8",children:"Estatus"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8",children:"Creada"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8",children:"Acciones"})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-gray-200",children:a.sort((e,a)=>new Date(e.fecha)-new Date(a.fecha)).map((e,a)=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.tarea}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700",children:e.responsable}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700",children:(()=>{try{const a=new Date(e.fecha);return isNaN(a.getTime())?"Fecha inv\xe1lida":a.toLocaleDateString("es-ES")}catch(a){return"Fecha inv\xe1lida"}})()}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,n.jsxs)("select",{value:e.estatus,onChange:async a=>{const t=a.target.value;if(De(a=>{const r=a.map(a=>a.id===e.id?(0,s.A)((0,s.A)({},a),{},{estatus:t}):a);return z&&z(null===A||void 0===A?void 0:A.id,r),r}),U)try{const a=await b.default.updateMinutaStatus(e.id,t);a.success?(console.log("\ud83d\udd04 Disparando evento minutaStatusChanged:",{tareaId:e.id,newStatus:t}),window.dispatchEvent(new CustomEvent("minutaStatusChanged",{detail:{tareaId:e.id,newStatus:t,projectId:null===A||void 0===A?void 0:A.id,timestamp:Date.now()}})),console.log("\ud83d\udd04 Disparando evento autoSaveTrigger para minuta"),window.dispatchEvent(new CustomEvent("autoSaveTrigger",{detail:{source:"minutaUpdate",data:{minutasTasks:Ne}}}))):(console.error("\u274c Error actualizando estatus en Supabase:",a.error),De(a=>a.map(a=>a.id===e.id?(0,s.A)((0,s.A)({},a),{},{estatus:t}):a)))}catch(r){console.error("\u274c Error actualizando estatus:",r)}else console.log("\ud83d\udd04 Disparando evento minutaStatusChanged (modo local):",{tareaId:e.id,newStatus:t}),window.dispatchEvent(new CustomEvent("minutaStatusChanged",{detail:{tareaId:e.id,newStatus:t,projectId:null===A||void 0===A?void 0:A.id,timestamp:Date.now()}})),window.dispatchEvent(new CustomEvent("autoSaveTrigger",{detail:{source:"minutaUpdate",data:{minutasTasks:Ne}}}))},className:"px-3 py-1 rounded-full text-xs font-medium border-none ".concat("Pendiente"===e.estatus?"bg-yellow-100 text-yellow-800":"En Proceso"===e.estatus?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:[(0,n.jsx)("option",{value:"Pendiente",children:"Pendiente"}),(0,n.jsx)("option",{value:"En Proceso",children:"En Proceso"}),(0,n.jsx)("option",{value:"Completado",children:"Completado"})]})}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:(()=>{try{const a=new Date(e.fechaCreacion);return isNaN(a.getTime())?"Fecha inv\xe1lida":a.toLocaleDateString("es-ES")}catch(a){return"Fecha inv\xe1lida"}})()}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,n.jsx)("button",{onClick:()=>Ja(e),className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Editar minuta",children:"\u270f\ufe0f Editar"})})]},e.id))})]})})]},e.id)}),Ne.filter(e=>{if(!e.hitoId)return!0;const a=p.find(a=>a.id===e.hitoId&&a.isMilestone);return a||(console.log("\ud83d\udd0d DEBUG: Tarea ".concat(e.id," busca hito ").concat(e.hitoId," pero no se encuentra")),console.log("\ud83d\udd0d DEBUG: Hitos disponibles:",p.filter(e=>e.isMilestone).map(e=>({id:e.id,name:e.name})))),!a}).length>0&&(0,n.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,n.jsx)("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:(0,n.jsx)("h3",{className:"font-semibold text-gray-800",children:"\ud83d\udccb Sin hito asignado"})}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/3",children:"Tarea"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/6",children:"Responsable"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8",children:"Fecha"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8",children:"Estatus"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8",children:"Creada"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8",children:"Acciones"})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-gray-200",children:Ne.filter(e=>{if(!e.hitoId)return!0;return!p.find(a=>a.id===e.hitoId&&a.isMilestone)}).sort((e,a)=>new Date(e.fecha)-new Date(a.fecha)).map(e=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.tarea}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700",children:e.responsable}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700",children:(()=>{try{const a=new Date(e.fecha);return isNaN(a.getTime())?"Fecha inv\xe1lida":a.toLocaleDateString("es-ES")}catch(a){return"Fecha inv\xe1lida"}})()}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,n.jsxs)("select",{value:e.estatus,onChange:async a=>{const t=a.target.value;if(De(a=>a.map(a=>a.id===e.id?(0,s.A)((0,s.A)({},a),{},{estatus:t}):a)),U)try{const a=await b.default.updateMinutaStatus(e.id,t);a.success?(console.log("\ud83d\udd04 Disparando evento minutaStatusChanged (tabla 2):",{tareaId:e.id,newStatus:t}),window.dispatchEvent(new CustomEvent("minutaStatusChanged",{detail:{tareaId:e.id,newStatus:t,projectId:null===A||void 0===A?void 0:A.id,timestamp:Date.now()}})),window.dispatchEvent(new CustomEvent("autoSaveTrigger",{detail:{source:"minutaUpdate",data:{minutasTasks:Ne}}}))):(console.error("\u274c Error actualizando estatus en Supabase:",a.error),De(a=>a.map(a=>a.id===e.id?(0,s.A)((0,s.A)({},a),{},{estatus:t}):a)))}catch(r){console.error("\u274c Error actualizando estatus:",r)}else console.log("\ud83d\udd04 Disparando evento minutaStatusChanged (modo local, tabla 2):",{tareaId:e.id,newStatus:t}),window.dispatchEvent(new CustomEvent("minutaStatusChanged",{detail:{tareaId:e.id,newStatus:t,projectId:null===A||void 0===A?void 0:A.id,timestamp:Date.now()}})),window.dispatchEvent(new CustomEvent("autoSaveTrigger",{detail:{source:"minutaUpdate",data:{minutasTasks:Ne}}}))},className:"px-3 py-1 rounded-full text-xs font-medium border-none ".concat("Pendiente"===e.estatus?"bg-yellow-100 text-yellow-800":"En Proceso"===e.estatus?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:[(0,n.jsx)("option",{value:"Pendiente",children:"Pendiente"}),(0,n.jsx)("option",{value:"En Proceso",children:"En Proceso"}),(0,n.jsx)("option",{value:"Completado",children:"Completado"})]})}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:(()=>{try{const a=new Date(e.fechaCreacion);return isNaN(a.getTime())?"Fecha inv\xe1lida":a.toLocaleDateString("es-ES")}catch(a){return"Fecha inv\xe1lida"}})()}),(0,n.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,n.jsx)("button",{onClick:()=>Ja(e),className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Editar minuta",children:"\u270f\ufe0f Editar"})})]},e.id))})]})})]})]})]}),B&&"gantt"===V&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"\ud83d\udcca Vista Solo Lectura"}),(0,n.jsx)("button",{onClick:()=>G(null),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\u2715"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-4xl mb-4",children:"\ud83d\udc41\ufe0f"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:B.name}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"Esta es la vista de solo lectura del diagrama Gantt."}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 mb-6",children:["Para editar esta tarea, cambia a la ",(0,n.jsx)("strong",{children:"Vista Tabla"}),"."]}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("button",{onClick:()=>W("excel"),className:"flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors",children:"\ud83d\udccb Ir a Vista Tabla"}),(0,n.jsx)("button",{onClick:()=>G(null),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cerrar"})]})]})]})}),B&&"gantt"!==V&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:B.name}),(0,n.jsx)("button",{onClick:()=>G(null),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\u2715"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Informaci\xf3n B\xe1sica"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Tarea"}),(0,n.jsx)("input",{type:"text",value:B.name,onChange:e=>G(a=>({id:a.id,wbsCode:a.wbsCode,name:e.target.value,duration:a.duration,startDate:a.startDate,endDate:a.endDate,progress:a.progress,predecessors:[...a.predecessors||[]],cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:[...a.successors||[]]})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duraci\xf3n (d\xedas)"}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("button",{onClick:()=>G(e=>({id:e.id,wbsCode:e.wbsCode,name:e.name,duration:Math.max(1,e.duration-1),startDate:e.startDate,endDate:e.endDate,progress:e.progress,predecessors:[...e.predecessors||[]],cost:e.cost,priority:e.priority,assignedTo:e.assignedTo,isMilestone:e.isMilestone,isCritical:e.isCritical,originalDuration:e.originalDuration,earlyStart:e.earlyStart,earlyFinish:e.earlyFinish,lateStart:e.lateStart,lateFinish:e.lateFinish,totalFloat:e.totalFloat,freeFloat:e.freeFloat,description:e.description,resources:[...e.resources||[]],workPackageId:e.workPackageId,status:e.status,successors:[...e.successors||[]]})),className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:"-"}),(0,n.jsx)("input",{type:"number",value:B.duration,onChange:e=>G(a=>({id:a.id,wbsCode:a.wbsCode,name:a.name,duration:parseInt(e.target.value)||1,startDate:a.startDate,endDate:a.endDate,progress:a.progress,predecessors:[...a.predecessors||[]],cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:[...a.successors||[]]})),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-indigo-500",min:"1"}),(0,n.jsx)("button",{onClick:()=>G(e=>({id:e.id,wbsCode:e.wbsCode,name:e.name,duration:e.duration+1,startDate:e.startDate,endDate:e.endDate,progress:e.progress,predecessors:[...e.predecessors||[]],cost:e.cost,priority:e.priority,assignedTo:e.assignedTo,isMilestone:e.isMilestone,isCritical:e.isCritical,originalDuration:e.originalDuration,earlyStart:e.earlyStart,earlyFinish:e.earlyFinish,lateStart:e.lateStart,lateFinish:e.lateFinish,totalFloat:e.totalFloat,freeFloat:e.freeFloat,description:e.description,resources:[...e.resources||[]],workPackageId:e.workPackageId,status:e.status,successors:[...e.successors||[]]})),className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:"+"})]})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Dependencias"}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Predecesoras (",(null===(t=B.predecessors)||void 0===t?void 0:t.length)||0,")"]}),(0,n.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-2",children:p.filter(e=>e.id!==B.id).map(e=>{var a;return(0,n.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[(0,n.jsx)("input",{type:"checkbox",checked:(null===(a=B.predecessors)||void 0===a?void 0:a.includes(e.id))||!1,onChange:a=>{const t=B.predecessors||[];a.target.checked?G(a=>({id:a.id,wbsCode:a.wbsCode,name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,progress:a.progress,predecessors:[...t||[],e.id],cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:[...a.successors||[]]})):G(a=>({id:a.id,wbsCode:a.wbsCode,name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,progress:a.progress,predecessors:t.filter(a=>a!==e.id),cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:[...a.successors||[]]}))},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,n.jsxs)("span",{className:"text-sm",children:[e.wbsCode," - ",e.name]})]},e.id)})})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Sucesoras (",(null===(c=B.successors)||void 0===c?void 0:c.length)||0,")"]}),(0,n.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-2",children:p.filter(e=>e.id!==B.id).map(e=>{var a;return(0,n.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[(0,n.jsx)("input",{type:"checkbox",checked:(null===(a=B.successors)||void 0===a?void 0:a.includes(e.id))||!1,onChange:a=>{const t=B.successors||[];a.target.checked?G(a=>({id:a.id,wbsCode:a.wbsCode,name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,progress:a.progress,predecessors:[...a.predecessors||[]],cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:t.slice().concat([e.id])})):G(a=>({id:a.id,wbsCode:a.wbsCode,name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,progress:a.progress,predecessors:[...a.predecessors||[]],cost:a.cost,priority:a.priority,assignedTo:a.assignedTo,isMilestone:a.isMilestone,isCritical:a.isCritical,originalDuration:a.originalDuration,earlyStart:a.earlyStart,earlyFinish:a.earlyFinish,lateStart:a.lateStart,lateFinish:a.lateFinish,totalFloat:a.totalFloat,freeFloat:a.freeFloat,description:a.description,resources:[...a.resources||[]],workPackageId:a.workPackageId,status:a.status,successors:t.filter(a=>a!==e.id)}))},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,n.jsxs)("span",{className:"text-sm",children:[e.wbsCode," - ",e.name]})]},e.id)})})]})]})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200",children:[(0,n.jsx)("button",{onClick:()=>G(null),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancelar"}),(0,n.jsx)("button",{onClick:()=>{console.log("\ud83c\udd95 MODAL NUEVO - Guardando tarea:",B),g(e=>e.map(e=>e.id===B.id?{id:e.id,wbsCode:e.wbsCode,name:B.name,duration:B.duration,startDate:e.startDate,endDate:e.endDate,progress:e.progress,predecessors:[...e.predecessors||[]],cost:e.cost,priority:e.priority,assignedTo:e.assignedTo,isMilestone:e.isMilestone,isCritical:e.isCritical,originalDuration:e.originalDuration,earlyStart:e.earlyStart,earlyFinish:e.earlyFinish,lateStart:e.lateStart,lateFinish:e.lateFinish,totalFloat:e.totalFloat,freeFloat:e.freeFloat,description:e.description,resources:[...e.resources||[]],workPackageId:e.workPackageId,status:e.status,successors:[...e.successors||[]],predecessors:B.predecessors||[],successors:B.successors||[]}:e)),G(null)},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Guardar Cambios"})]})]})}),!1,console.log("\ud83d\udd0d RENDERIZADO - selectedTask existe?",!!B,B),!1,ge&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Caso de Negocio"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Informaci\xf3n del Proyecto"}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Nombre:"})," ",q.projectName]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Fecha de Inicio:"})," ",new Date(q.startDate).toLocaleDateString("es")]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Fecha de Fin Planificada:"})," ",new Date(q.plannedEndDate).toLocaleDateString("es")]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Inversi\xf3n Total:"})," $",q.totalInvestment.toLocaleString()]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Beneficios Esperados"}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Objetivo:"})," ",q.objective]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Patrocinador:"})," ",q.sponsor]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Gerente del Proyecto:"})," ",q.manager]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Beneficios:"})," ",q.expectedBenefits]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"TIR (%):"})," ",q.irr]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"ROI (%):"})," ",q.roi]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Tiempo de Retorno (a\xf1os):"})," ",q.paybackPeriod]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"VPN:"})," $",q.npv.toLocaleString()]})]})]}),(0,n.jsx)("div",{className:"flex justify-end mt-4",children:(0,n.jsx)("button",{onClick:()=>he(!1),className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Cerrar"})})]}),xe&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"An\xe1lisis de Recursos"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Carga de Recursos"}),Object.entries(xa.resourceLoad).map(e=>{let[a,t]=e;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:[(0,n.jsxs)("strong",{children:[a,":"]})," ",t.length," tareas"]}),(0,n.jsx)("ul",{children:t.map(e=>(0,n.jsxs)("li",{children:[e.taskName," (D\xedas: ",E(e.startDate,I(e.endDate,1,R),R),")"]},e.taskId))})]},a)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Conflictos de Recursos"}),xa.conflicts.map(e=>(0,n.jsxs)("p",{className:"text-red-600 text-sm",children:["Conflicto entre ",e.task1," y ",e.task2,' por el recurso "',e.resource,'" por ',e.overlapDays," d\xedas."]},e.resource))]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Utilizaci\xf3n de Recursos"}),Object.entries(xa.utilization).map(e=>{let[a,t]=e;return(0,n.jsxs)("p",{children:[(0,n.jsxs)("strong",{children:[a,":"]})," ",t," d\xedas"]},a)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"M\xe9tricas de Recursos"}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Total de Recursos:"})," ",Object.keys(xa.utilization).length]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Total de D\xedas Asignados:"})," ",Object.values(xa.utilization).reduce((e,a)=>e+a,0)," d\xedas"]})]})]}),(0,n.jsx)("div",{className:"flex justify-end mt-4",children:(0,n.jsx)("button",{onClick:()=>be(!1),className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Cerrar"})})]}),!1,qa&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:Ga.insertAfterTaskId?"\ud83d\ude80 Insertar Nueva Tarea":"\ud83d\ude80 Agregar Nueva Tarea"}),Ga.insertAfterTaskId&&(0,n.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["La tarea se insertar\xe1 despu\xe9s de: ",(0,n.jsx)("span",{className:"font-medium text-indigo-600",children:(null===(d=ha.find(e=>e.id===Ga.insertAfterTaskId))||void 0===d?void 0:d.name)||"Tarea anterior"})]})]}),(0,n.jsx)("button",{onClick:()=>Ba(!1),className:"text-gray-400 hover:text-gray-600 text-2xl",children:"\xd7"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-700 border-b pb-2",children:"\ud83d\udccb Informaci\xf3n B\xe1sica"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la Tarea *"}),(0,n.jsx)("input",{type:"text",value:Ga.name,onChange:e=>_a(a=>({name:e.target.value,duration:a.duration,startDate:a.startDate,endDate:a.endDate,description:a.description,priority:a.priority,assignedTo:a.assignedTo,cost:a.cost,selectedPredecessors:[...a.selectedPredecessors||[]],selectedSuccessors:[...a.selectedSuccessors||[]]})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ingresa el nombre de la tarea"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,n.jsx)("textarea",{value:Ga.description,onChange:e=>_a(a=>({name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,description:e.target.value,priority:a.priority,assignedTo:a.assignedTo,cost:a.cost,selectedPredecessors:[...a.selectedPredecessors||[]],selectedSuccessors:[...a.selectedSuccessors||[]]})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"3",placeholder:"Describe la tarea..."})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duraci\xf3n (d\xedas) *"}),(0,n.jsx)("input",{type:"number",min:"1",value:Ga.duration,onChange:e=>{const a=parseInt(e.target.value)||1,t=I(Ga.startDate,a,R);_a(e=>({name:e.name,duration:a,startDate:e.startDate,endDate:t,description:e.description,priority:e.priority,assignedTo:e.assignedTo,cost:e.cost,selectedPredecessors:[...e.selectedPredecessors||[]],selectedSuccessors:[...e.selectedSuccessors||[]]}))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Costo ($)"}),(0,n.jsx)("input",{type:"number",min:"0",step:"0.01",value:Ga.cost,onChange:e=>_a(a=>({name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,description:a.description,priority:a.priority,assignedTo:a.assignedTo,cost:parseFloat(e.target.value)||0,selectedPredecessors:[...a.selectedPredecessors||[]],selectedSuccessors:[...a.selectedSuccessors||[]]})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Inicio *"}),(0,n.jsx)("input",{type:"date",value:Ga.startDate,onChange:e=>{const a=e.target.value,t=I(a,Ga.duration,R);_a(e=>({name:e.name,duration:e.duration,startDate:a,endDate:t,description:e.description,priority:e.priority,assignedTo:e.assignedTo,cost:e.cost,selectedPredecessors:[...e.selectedPredecessors||[]],selectedSuccessors:[...e.selectedSuccessors||[]]}))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Fin"}),(0,n.jsx)("input",{type:"date",value:Ga.endDate,onChange:e=>{const a=e.target.value,t=Math.ceil((new Date(a)-new Date(Ga.startDate))/864e5);_a(e=>({name:e.name,duration:t>0?t:1,startDate:e.startDate,endDate:a,description:e.description,priority:e.priority,assignedTo:e.assignedTo,cost:e.cost,selectedPredecessors:[...e.selectedPredecessors||[]],selectedSuccessors:[...e.selectedSuccessors||[]]}))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prioridad"}),(0,n.jsxs)("select",{value:Ga.priority,onChange:e=>_a(a=>({name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,description:a.description,priority:e.target.value,assignedTo:a.assignedTo,cost:a.cost,selectedPredecessors:[...a.selectedPredecessors||[]],selectedSuccessors:[...a.selectedSuccessors||[]]})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,n.jsx)("option",{value:"low",children:"\ud83d\udfe2 Baja"}),(0,n.jsx)("option",{value:"medium",children:"\ud83d\udfe1 Media"}),(0,n.jsx)("option",{value:"high",children:"\ud83d\udd34 Alta"}),(0,n.jsx)("option",{value:"critical",children:"\ud83d\udea8 Cr\xedtica"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Asignado a"}),(0,n.jsx)("input",{type:"text",value:Ga.assignedTo,onChange:e=>_a(a=>({name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,description:a.description,priority:a.priority,assignedTo:e.target.value,cost:a.cost,selectedPredecessors:[...a.selectedPredecessors||[]],selectedSuccessors:[...a.selectedSuccessors||[]]})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del responsable"})]})]})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-700 border-b pb-2",children:"\ud83d\udd17 Dependencias"}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Predecesoras (",Ga.selectedPredecessors.length,")"]}),(0,n.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50",children:0===p.length?(0,n.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No hay tareas existentes"}):p.map(e=>(0,n.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-white p-2 rounded",children:[(0,n.jsx)("input",{type:"checkbox",checked:Ga.selectedPredecessors.includes(e.id),onChange:a=>{a.target.checked?(console.log("\ud83d\ude80 NUEVO SISTEMA - Agregando predecesora:",e.id,e.wbsCode,e.name),_a(a=>{const t=a.selectedPredecessors.slice().concat([e.id]);return console.log("\ud83d\ude80 NUEVO SISTEMA - Predecesoras actualizadas:",t),{name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,description:a.description,priority:a.priority,assignedTo:a.assignedTo,cost:a.cost,selectedPredecessors:t,selectedSuccessors:[...a.selectedSuccessors||[]]}})):(console.log("\ud83d\ude80 NUEVO SISTEMA - Removiendo predecesora:",e.id,e.wbsCode,e.name),_a(a=>{const t=a.selectedPredecessors.filter(a=>a!==e.id);return console.log("\ud83d\ude80 NUEVO SISTEMA - Predecesoras actualizadas:",t),{name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,description:a.description,priority:a.priority,assignedTo:a.assignedTo,cost:a.cost,selectedPredecessors:t,selectedSuccessors:[...a.selectedSuccessors||[]]}}))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,n.jsxs)("span",{className:"text-sm",children:[(0,n.jsx)("span",{className:"font-medium",children:e.wbsCode})," - ",e.name]})]},e.id))})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Sucesoras (",Ga.selectedSuccessors.length,")"]}),(0,n.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50",children:0===p.length?(0,n.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No hay tareas existentes"}):p.map(e=>(0,n.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-white p-2 rounded",children:[(0,n.jsx)("input",{type:"checkbox",checked:Ga.selectedSuccessors.includes(e.id),onChange:a=>{a.target.checked?(console.log("\ud83d\ude80 NUEVO SISTEMA - Agregando sucesora:",e.id,e.wbsCode,e.name),_a(a=>{const t=a.selectedSuccessors.slice().concat([e.id]);return console.log("\ud83d\ude80 NUEVO SISTEMA - Sucesoras actualizadas:",t),{name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,description:a.description,priority:a.priority,assignedTo:a.assignedTo,cost:a.cost,selectedPredecessors:[...a.selectedPredecessors||[]],selectedSuccessors:t}})):(console.log("\ud83d\ude80 NUEVO SISTEMA - Removiendo sucesora:",e.id,e.wbsCode,e.name),_a(a=>{const t=a.selectedSuccessors.filter(a=>a!==e.id);return console.log("\ud83d\ude80 NUEVO SISTEMA - Sucesoras actualizadas:",t),{name:a.name,duration:a.duration,startDate:a.startDate,endDate:a.endDate,description:a.description,priority:a.priority,assignedTo:a.assignedTo,cost:a.cost,selectedPredecessors:[...a.selectedPredecessors||[]],selectedSuccessors:t}}))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,n.jsxs)("span",{className:"text-sm",children:[(0,n.jsx)("span",{className:"font-medium",children:e.wbsCode})," - ",e.name]})]},e.id))})]}),(0,n.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"\ud83d\udca1 Informaci\xf3n sobre Dependencias"}),(0,n.jsxs)("ul",{className:"text-xs text-blue-700 space-y-1",children:[(0,n.jsxs)("li",{children:["\u2022 ",(0,n.jsx)("strong",{children:"Predecesoras:"})," Tareas que deben completarse antes de esta"]}),(0,n.jsxs)("li",{children:["\u2022 ",(0,n.jsx)("strong",{children:"Sucesoras:"})," Tareas que dependen de esta tarea"]}),(0,n.jsx)("li",{children:"\u2022 Las dependencias se sincronizan autom\xe1ticamente"})]})]})]})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200",children:[(0,n.jsx)("button",{onClick:()=>Ba(!1),className:"px-6 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,n.jsxs)("button",{onClick:()=>{const e=p||[],a=Ga.insertAfterTaskId;let t=null;if(a){const s=e.findIndex(e=>e.id===a);-1!==s&&(t=s+1,console.log("\ud83d\ude80 DEBUG - Calculando insertIndex en el momento del clic:",{insertAfterTaskId:a,insertAfterIndex:s,calculatedInsertIndex:t,totalTasks:e.length}))}!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{console.log("\ud83d\ude80 NUEVO SISTEMA - Creando tarea desde modal"),console.log("\ud83d\ude80 NUEVO SISTEMA - Datos completos del modal:",Ga),console.log("\ud83d\ude80 NUEVO SISTEMA - Predecesoras seleccionadas:",Ga.selectedPredecessors),console.log("\ud83d\ude80 NUEVO SISTEMA - Sucesoras seleccionadas:",Ga.selectedSuccessors);const a=null!==e?e:Ga.insertIndex;if(Ga.insertAfterTaskId,console.log("\ud83d\ude80 DEBUG - Valores de inserci\xf3n:",{insertIndex:Ga.insertIndex,insertAfterTaskId:Ga.insertAfterTaskId,insertIndexType:typeof Ga.insertIndex,insertAfterTaskIdType:typeof Ga.insertAfterTaskId,insertIndexOverride:e,finalInsertIndex:a}),!Ga.name.trim())return void alert("Por favor ingresa un nombre para la tarea");if(Ga.duration<=0)return void alert("La duraci\xf3n debe ser mayor a 0");const t=()=>{let e,a=1;do{e="1.".concat(a),a++}while(p.some(a=>a.wbsCode===e));return e},r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const a=16*Math.random()|0;return("x"===e?a:3&a|8).toString(16)}),o=t();console.log("\ud83d\ude80 DEBUG - IDs generados:",{newTaskId:r,newWbsCode:o,insertIndex:Ga.insertIndex,insertAfterTaskId:Ga.insertAfterTaskId}),console.log("\ud83d\ude80 DEBUG - Creando tarea con dependencias:",{selectedPredecessors:Ga.selectedPredecessors,selectedSuccessors:Ga.selectedSuccessors,predecessorsLength:Ga.selectedPredecessors.length,successorsLength:Ga.selectedSuccessors.length});const n={id:r,wbsCode:o,name:Ga.name.trim(),duration:Ga.duration,startDate:Ga.startDate,endDate:Ga.endDate,progress:0,predecessors:Ga.selectedPredecessors.slice(),successors:Ga.selectedSuccessors.slice(),resources:[],cost:Ga.cost,isMilestone:!1,isCritical:!1,originalDuration:Ga.duration,earlyStart:Ga.startDate,earlyFinish:Ga.endDate,lateStart:Ga.startDate,lateFinish:Ga.endDate,totalFloat:0,freeFloat:0,status:"pending",workPackageId:r,plannedValue:0,earnedValue:0,actualCost:0,description:Ga.description,priority:Ga.priority,assignedTo:Ga.assignedTo,createdDate:S(new Date),lastModified:S(new Date)};console.log("\ud83d\ude80 NUEVO SISTEMA - Tarea creada:",n),console.log("\ud83d\ude80 DEBUG - Dependencias en la tarea creada:",{predecessors:n.predecessors,successors:n.successors,predecessorsLength:n.predecessors.length,successorsLength:n.successors.length}),console.log("\ud83d\ude80 NUEVO SISTEMA - Dependencias seleccionadas:",{predecessors:Ga.selectedPredecessors,successors:Ga.selectedSuccessors}),console.log("\ud83d\ude80 NUEVO SISTEMA - Llamando a setTasks con nueva tarea"),console.log("\ud83d\ude80 NUEVO SISTEMA - Tareas actuales antes de agregar:",p.length),g(e=>{var t,o;let i;if(console.log("\ud83d\ude80 NUEVO SISTEMA - setTasks ejecut\xe1ndose, tareas previas:",e.length),console.log("\ud83d\ude80 DEBUG - Tarea a insertar:",{id:n.id,name:n.name,wbsCode:n.wbsCode}),console.log("\ud83d\ude80 DEBUG - Verificando insertIndex:",{insertIndex:Ga.insertIndex,insertIndexUndefined:void 0===Ga.insertIndex,insertAfterTaskId:Ga.insertAfterTaskId,finalInsertIndex:a,finalInsertIndexUndefined:void 0===a}),void 0!==a&&null!==a){const t=e.slice();t.splice(a,0,n),i=t,console.log("\ud83d\ude80 NUEVA FUNCI\xd3N - Tarea insertada en posici\xf3n:",a)}else if(Ga.insertAfterTaskId){const a=e.findIndex(e=>e.id===Ga.insertAfterTaskId);if(-1!==a){const t=e.slice();t.splice(a+1,0,n),i=t,console.log("\ud83d\ude80 NUEVA FUNCI\xd3N - Tarea insertada despu\xe9s de:",a+1)}else{const a=e.slice();a.push(n),i=a,console.log("\ud83d\ude80 NUEVA FUNCI\xd3N - Tarea agregada al final (posici\xf3n no encontrada)")}}else{const a=e.slice();a.push(n),i=a,console.log("\ud83d\ude80 NUEVO SISTEMA - Tarea agregada al final. Total tareas:",i.length)}i=C(i),i=i.map((e,a)=>(0,s.A)((0,s.A)({},e),{},{wbsCode:a+1})),console.log("\ud83d\ude80 NUEVA FUNCI\xd3N - wbsCode actualizados para mantener secuencia:",i.map(e=>({name:e.name,wbsCode:e.wbsCode})));const l=i.find(e=>e.id===r),c=i.findIndex(e=>e.id===r);return console.log("\ud83d\ude80 DEBUG - Tarea en el estado despu\xe9s de agregar:",{id:null===l||void 0===l?void 0:l.id,name:null===l||void 0===l?void 0:l.name,position:c,wbsCode:null===l||void 0===l?void 0:l.wbsCode,predecessors:null===l||void 0===l?void 0:l.predecessors,successors:null===l||void 0===l?void 0:l.successors,predecessorsLength:null===l||void 0===l||null===(t=l.predecessors)||void 0===t?void 0:t.length,successorsLength:null===l||void 0===l||null===(o=l.successors)||void 0===o?void 0:o.length}),console.log("\ud83d\ude80 DEBUG - Primeras 15 tareas despu\xe9s de inserci\xf3n:",i.slice(0,15).map((e,a)=>({position:a,wbsCode:e.wbsCode,name:e.name,id:e.id}))),Ga.selectedPredecessors.length>0||Ga.selectedSuccessors.length>0?(console.log("\ud83d\ude80 NUEVO SISTEMA - Sincronizando dependencias..."),i.map(e=>{if(e.id===r)return e;let a={id:e.id,wbsCode:e.wbsCode,name:e.name,duration:e.duration,startDate:e.startDate,endDate:e.endDate,progress:e.progress,predecessors:[...e.predecessors||[]],cost:e.cost,priority:e.priority,assignedTo:e.assignedTo,isMilestone:e.isMilestone,isCritical:e.isCritical,originalDuration:e.originalDuration,earlyStart:e.earlyStart,earlyFinish:e.earlyFinish,lateStart:e.lateStart,lateFinish:e.lateFinish,totalFloat:e.totalFloat,freeFloat:e.freeFloat,description:e.description,resources:[...e.resources||[]],workPackageId:e.workPackageId,status:e.status,successors:[...e.successors||[]]};return Ga.selectedPredecessors.includes(e.id)&&(a.successors.includes(r)||(a.successors=a.successors.slice().concat([r]),console.log("\ud83d\ude80 NUEVO SISTEMA - Agregando ".concat(r," como sucesora de ").concat(e.id)))),Ga.selectedSuccessors.includes(e.id)&&(a.predecessors.includes(r)||(a.predecessors=[...a.predecessors||[],r],console.log("\ud83d\ude80 NUEVO SISTEMA - Agregando ".concat(r," como predecesora de ").concat(e.id)))),a})):(console.log("\ud83d\ude80 DEBUG - setTasks retornando:",{totalTasks:i.length,newTaskIncluded:i.some(e=>e.id===r),newTaskPosition:i.findIndex(e=>e.id===r)}),i)}),setTimeout(()=>{console.log("\ud83d\ude80 DEBUG - Estado despu\xe9s de setTasks:",{tasksLength:p.length,newTaskExists:p.some(e=>e.id===r)})},100),Ba(!1),_a({name:"",duration:5,startDate:S(new Date),endDate:I(S(new Date),5),description:"",priority:"medium",assignedTo:"",cost:0,selectedPredecessors:[],insertAfterTaskId:null}),console.log("\ud83d\ude80 NUEVO SISTEMA - Proceso completado exitosamente"),setTimeout(()=>{console.log("\ud83d\ude80 DEBUG - Estado final de todas las tareas:"),g(e=>(console.log("\ud83d\ude80 DEBUG - Total de tareas despu\xe9s de crear:",e.length),console.log("\ud83d\ude80 DEBUG - \xdaltimas 3 tareas:",e.slice(-3).map(e=>({name:e.name,wbsCode:e.wbsCode,id:e.id}))),e.forEach(e=>{var a,t;console.log("\ud83d\ude80 DEBUG - Tarea ".concat(e.name," (").concat(e.id,"):"),{predecessors:e.predecessors,successors:e.successors,predecessorsLength:(null===(a=e.predecessors)||void 0===a?void 0:a.length)||0,successorsLength:(null===(t=e.successors)||void 0===t?void 0:t.length)||0})}),e))},100)}catch(a){console.error("\u274c NUEVO SISTEMA - Error al crear tarea:",a),alert("Error al crear la tarea. Por favor intenta de nuevo.")}}(t)},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,n.jsx)("span",{children:"\u2705"}),(0,n.jsx)("span",{children:"Crear Tarea"})]})]})]})})}),(0,n.jsx)(i,{isOpen:ve,onClose:()=>{je(!1)},hitos:p.filter(e=>e.isMilestone),onSave:async e=>{console.log("\ud83d\udcbe Guardando tareas de minuta:",e);try{if(U&&null!==A&&void 0!==A&&A.id){const a=await b.default.saveMinutas(A.id,e);if(!a.success)return console.error("\u274c Error guardando en Supabase:",a.error),void alert("\u274c Error guardando las minutas: ".concat(a.error.message||"Error desconocido"));if(De(a=>[...a,...e]),z){const a=[...Ne||[],...e];z(A.id,a)}e.forEach(e=>{Me(e,A)}),alert("\u2705 Se han guardado ".concat(e.length," tareas de la minuta en Supabase."))}else De(a=>[...a,...e]),alert("\ud83d\udcdd Se han guardado ".concat(e.length," tareas de la minuta localmente."));if("undefined"!==typeof window){const a=new CustomEvent("dataChange",{detail:{type:"minutasUpdated",projectId:null===A||void 0===A?void 0:A.id,minutasCount:e.length}});window.dispatchEvent(a)}}catch(a){console.error("\u274c Error guardando minutas:",a),alert("\u274c Error guardando las minutas: ".concat(a.message))}}}),(0,n.jsx)(l,{isOpen:Ie,onClose:()=>{Te(null),Ee(!1)},minuta:Se,hitos:p.filter(e=>e.isMilestone),onUpdate:async e=>{try{if(U){const a=await b.default.updateMinuta(e.id,{task_description:e.tarea,responsible_person:e.responsable,due_date:e.fecha,milestone_id:e.hitoId,status:e.estatus});if(a.success){if(De(a=>a.map(a=>a.id===e.id?(0,s.A)((0,s.A)({},e),{},{fechaCreacion:a.fechaCreacion}):a)),z){const a=(Ne||[]).map(a=>a.id===e.id?(0,s.A)((0,s.A)({},e),{},{fechaCreacion:a.fechaCreacion}):a);z(A.id,a)}const a={task_description:e.tarea,responsible_person:e.responsable,due_date:e.fecha,milestone_id:e.hitoId,status:e.estatus};Pe(e,a,A),alert("\u2705 Minuta actualizada correctamente")}else console.error("\u274c Error actualizando minuta:",a.error),alert("\u274c Error actualizando minuta: ".concat(a.error.message||"Error desconocido"))}else De(a=>a.map(a=>a.id===e.id?(0,s.A)((0,s.A)({},e),{},{fechaCreacion:a.fechaCreacion}):a)),alert("\u2705 Minuta actualizada localmente")}catch(a){console.error("\u274c Error actualizando minuta:",a),alert("\u274c Error actualizando minuta: ".concat(a.message))}}}),Ae&&console.log("\ud83d\udd0d DEBUG - ScheduleWizard props:",{projectId:null===A||void 0===A?void 0:A.id,organizationId:null===A||void 0===A?void 0:A.organizationId,userId:null===(u=b.default.currentUser)||void 0===u?void 0:u.id,projectDataKeys:A?Object.keys(A):"null",projectData:A}),(0,n.jsx)(x,{isOpen:Ae,onClose:()=>ke(!1),onComplete:async e=>{try{var a,t,s,r;console.log("\ud83e\udd16 Aplicando cronograma generado por IA:",e);const i=new Date,l=S(i),c=e.activities.map((e,a)=>{const t=I(l,a,R),s=I(t,(e.duration||1)-1,R);return{id:e.id,name:e.name,description:e.description||"",duration:e.duration||1,startDate:t,endDate:s,progress:0,status:"pending",priority:e.priority||"medium",assignedTo:e.assignedTo||"Pendiente",dependencies:e.dependencies||[],predecessors:e.dependencies||[],successors:[],isMilestone:!1,estimatedCost:e.estimatedCost||0,category:e.category||"execution",phase:e.phase||"General",generatedBy:"ai",confidence:e.confidence||.8,criteria:e.criteria||""}}),d=(e.milestones||[]).map((e,a)=>{const t=I(l,c.length+a,R);return{id:e.id,name:e.name,description:e.description||"",duration:0,startDate:t,endDate:t,progress:0,status:"pending",priority:e.priority||"high",assignedTo:e.assignedTo||"Pendiente",dependencies:e.dependencies||[],predecessors:e.dependencies||[],successors:[],isMilestone:!0,estimatedCost:e.estimatedCost||0,category:e.category||"milestone",phase:e.phase||"General",generatedBy:"ai",confidence:e.confidence||.9,criteria:e.criteria||""}}),u=[],m=new Set,p={};c.forEach(e=>{const a=e.phase||"General";p[a]||(p[a]=[]),p[a].push(e)}),Object.entries(p).forEach(e=>{let[a,t]=e;u.push(...t);const s=d.filter(e=>e.phase===a&&!m.has(e.id));u.push(...s),s.forEach(e=>m.add(e.id))});const h=d.filter(e=>!e.phase||"General"===e.phase);u.push(...h),console.log("\ud83d\udd04 Cronograma IA procesado:",{totalItems:u.length,activities:u.filter(e=>!e.isMilestone).length,milestones:u.filter(e=>e.isMilestone).length,phases:[...new Set(u.map(e=>e.phase))]}),console.log("\ud83d\udd0d DEBUG - Orden de tareas antes de CPM:",{activitiesByPhase:Object.keys(p),allAITasksOrder:u.map((e,a)=>({index:a,id:e.id,name:e.name,isMilestone:e.isMilestone,phase:e.phase}))});const x=u.filter(e=>!e.isMilestone).length,b=u.filter(e=>e.isMilestone).length,f="\ud83e\udd16 CRONOGRAMA GENERADO POR IA\n\n"+"Actividades: ".concat(x,"\n")+"Hitos: ".concat(b,"\n")+"Duraci\xf3n estimada: ".concat(Math.round((null===(a=e.metadata)||void 0===a?void 0:a.estimatedDuration)||0)," d\xedas\n\n")+"Esto REEMPLAZAR\xc1 COMPLETAMENTE el cronograma actual.\n\xbfContinuar con la aplicaci\xf3n del cronograma generado por IA?";if(!window.confirm(f))return void console.log("\ud83e\udd16 Aplicaci\xf3n de cronograma IA cancelada por el usuario");const y=F(u,R),v=y.tasks||y,j=[],N=new Map(v.map(e=>[e.id,e]));if(u.forEach(e=>{const a=N.get(e.id);a&&j.push(a)}),v.forEach(e=>{N.has(e.id)&&u.find(a=>a.id===e.id)||j.push(e)}),console.log("\ud83d\udd0d DEBUG - Resultado CPM:",{cpmResultType:typeof y,cpmResultKeys:Object.keys(y),tasksType:typeof v,tasksIsArray:Array.isArray(v),tasksLength:Array.isArray(v)?v.length:"N/A",orderedTasksLength:j.length,orderPreserved:u.length===j.length}),console.log("\ud83d\udd04 Orden preservado despu\xe9s de CPM:",{originalOrder:u.map(e=>({id:e.id,name:e.name,isMilestone:e.isMilestone})),finalOrder:j.map(e=>({id:e.id,name:e.name,isMilestone:e.isMilestone}))}),console.log("\ud83d\udd0d DEBUG - Verificaci\xf3n de intercalado:",{milestonesPositions:j.map((e,a)=>e.isMilestone?{index:a,name:e.name,phase:e.phase}:null).filter(Boolean),activitiesBeforeMilestones:j.map((e,a)=>{if(e.isMilestone){const t=j.slice(0,a).filter(e=>!e.isMilestone);return{milestone:e.name,activitiesBefore:t.length}}return null}).filter(Boolean),sampleTasksWithDates:j.slice(0,5).map(e=>({id:e.id,name:e.name,startDate:e.startDate,endDate:e.endDate,isMilestone:e.isMilestone}))}),g(j),Fe({category:"ai-scheduler",action:"schedule-applied",description:"Cronograma generado por IA aplicado al proyecto",details:{activitiesCount:x,milestonesCount:b,templateUsed:null===(t=e.metadata)||void 0===t?void 0:t.templateUsed,estimatedDuration:null===(s=e.metadata)||void 0===s?void 0:s.estimatedDuration,complexity:null===(r=e.metadata)||void 0===r?void 0:r.complexity}}),e.recommendations&&e.recommendations.length>0){var o;const a=e.recommendations.map(e=>"\u2022 ".concat(e.title,": ").concat(e.description)).join("\n");alert("\u2705 CRONOGRAMA DE IA APLICADO EXITOSAMENTE!\n\n"+"\ud83d\udcca ".concat(u.length," elementos generados\n")+"\ud83c\udfaf ".concat(b," hitos creados\n")+"\u23f1\ufe0f Duraci\xf3n estimada: ".concat(Math.round((null===(o=e.metadata)||void 0===o?void 0:o.estimatedDuration)||0)," d\xedas\n\n")+"\ud83d\udca1 RECOMENDACIONES:\n".concat(a))}else{var n;alert("\u2705 CRONOGRAMA DE IA APLICADO EXITOSAMENTE!\n\n"+"\ud83d\udcca ".concat(u.length," elementos generados\n")+"\ud83c\udfaf ".concat(b," hitos creados\n")+"\u23f1\ufe0f Duraci\xf3n estimada: ".concat(Math.round((null===(n=e.metadata)||void 0===n?void 0:n.estimatedDuration)||0)," d\xedas"))}console.log("\u2705 Cronograma de IA aplicado exitosamente")}catch(i){console.error("\u274c Error aplicando cronograma de IA:",i),alert("\u274c Error aplicando cronograma de IA: ".concat(i.message))}},projectId:null===A||void 0===A?void 0:A.id,currentProject:A,organizationId:null===A||void 0===A?void 0:A.organizationId,userId:null===(m=b.default.currentUser)||void 0===m?void 0:m.id})]})}},7902:(e,a,t)=>{t.d(a,{A:()=>o});var s=t(9379),r=t(9950);const o=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[o,n]=(0,r.useState)([]),[i,l]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(e){l(!0);try{if(a){const{default:a}=await Promise.resolve().then(t.bind(t,9874));if(a.isAuthenticated()){const t=await a.loadAuditEvents(e);if(t.success)n(t.events),console.log("\u2705 Logs de auditor\xeda cargados desde Supabase para proyecto ".concat(e,": ").concat(t.events.length," eventos"));else{const a=localStorage.getItem("audit-log-".concat(e));n(a?JSON.parse(a):[])}}else{const a=localStorage.getItem("audit-log-".concat(e));n(a?JSON.parse(a):[])}}else{const a=localStorage.getItem("audit-log-".concat(e));n(a?JSON.parse(a):[])}}catch(s){console.error("Error loading audit log:",s);const a=localStorage.getItem("audit-log-".concat(e));a&&n(JSON.parse(a))}finally{l(!1)}}})()},[e,a]);const c=(0,r.useCallback)(async a=>{localStorage.setItem("audit-log-".concat(e),JSON.stringify(a)),console.log("\ud83d\udccb Logs de auditor\xeda guardados en localStorage para proyecto ".concat(e,": ").concat(a.length," eventos"))},[e]),d=(0,r.useCallback)(async s=>{if(a)try{const{default:a}=await Promise.resolve().then(t.bind(t,9874));if(a.isAuthenticated()){const t=await a.saveAuditEvents(e,[s]);t.success?console.log("\u2705 Evento de auditor\xeda guardado en Supabase: ".concat(s.action)):console.warn("\u26a0\ufe0f Error guardando evento en Supabase:",t.error)}}catch(r){console.error("Error guardando evento en Supabase:",r)}},[e,a]),u=(0,r.useCallback)(async a=>{const t=(0,s.A)({id:crypto.randomUUID(),timestamp:(new Date).toISOString(),projectId:e},a);return n(e=>{const a=[t,...e];return c(a),a}),d(t),t},[e,c,d]),m=(0,r.useCallback)((e,a,t)=>{u({category:"project-status",action:"status-changed",description:'Estado del proyecto cambiado de "'.concat(e,'" a "').concat(a,'"'),details:{previousStatus:e,newStatus:a,projectName:t.name,manager:t.manager,budget:t.budget},severity:"high",user:t.manager||"Sistema"})},[u]),p=(0,r.useCallback)((e,a)=>{u({category:"work-package",action:"created",description:'Work Package "'.concat(e.name,'" creado'),details:{workPackageId:e.id,name:e.name,budget:e.budget,status:e.status},severity:"medium",user:a.manager||"Sistema"})},[u]),g=(0,r.useCallback)((e,a,t)=>{u({category:"work-package",action:"modified",description:'Work Package "'.concat(e.name,'" modificado'),details:{workPackageId:e.id,name:e.name,changes:Object.keys(a),previousValues:a},severity:"medium",user:t.manager||"Sistema"})},[u]),h=(0,r.useCallback)((e,a)=>{u({category:"risk",action:"created",description:'Riesgo "'.concat(e.name,'" identificado'),details:{riskId:e.id,name:e.name,probability:e.probability,impact:e.impact,priority:e.priority},severity:"high"===e.priority?"high":"medium",user:a.manager||"Sistema"})},[u]),x=(0,r.useCallback)((e,a,t)=>{const s={"purchase-order":{action:"created",description:'Orden de Compra "'.concat(a.description,'" creada'),details:{poId:a.id,description:a.description,amount:a.amount,supplier:a.supplier}},advance:{action:"created",description:'Anticipo "'.concat(a.description,'" creado'),details:{advanceId:a.id,description:a.description,amount:a.amount,recipient:a.recipient}},invoice:{action:"created",description:'Factura "'.concat(a.description,'" creada'),details:{invoiceId:a.id,description:a.description,amount:a.amount,supplier:a.supplier}},contract:{action:"created",description:'Contrato "'.concat(a.name,'" creado'),details:{contractId:a.id,name:a.name,value:a.value,contractor:a.contractor}}}[e];s&&u({category:"financial",action:s.action,description:s.description,details:s.details,severity:"high",user:t.manager||"Sistema"})},[u]),b=(0,r.useCallback)((e,a)=>{u({category:"resources",action:"assigned",description:"Recurso asignado al proyecto",details:{assignmentId:e.id,resourceId:e.resourceId,role:e.role,allocation:e.allocation},severity:"medium",user:a.manager||"Sistema"})},[u]),f=(0,r.useCallback)((e,a)=>{u({category:"minutes",action:"minute-task-created",description:'Tarea de minuta "'.concat(e.tarea,'" creada'),details:{taskId:e.id,tarea:e.tarea,responsable:e.responsable,fecha:e.fecha,hitoId:e.hitoId,estatus:e.estatus},severity:"medium",user:a.manager||"Sistema"})},[u]),y=(0,r.useCallback)((e,a,t)=>{u({category:"minutes",action:"minute-task-updated",description:'Tarea de minuta "'.concat(e.tarea,'" actualizada'),details:{taskId:e.id,tarea:e.tarea,changes:a,newStatus:e.estatus},severity:"medium",user:t.manager||"Sistema"})},[u]),v=(0,r.useCallback)(()=>{n([]),localStorage.removeItem("audit-log-".concat(e))},[e]),j=(0,r.useCallback)(()=>{const a={projectId:e,exportDate:(new Date).toISOString(),totalEvents:o.length,events:o},t=JSON.stringify(a,null,2),s=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.download="audit-log-".concat(e,"-").concat((new Date).toISOString().split("T")[0],".json"),n.click(),URL.revokeObjectURL(r)},[o,e]);return{auditLog:o,isLoading:i,addAuditEvent:u,logProjectStatusChange:m,logWorkPackageCreated:p,logWorkPackageModified:g,logRiskCreated:h,logFinancialEvent:x,logResourceAssignment:b,logMinutaTaskCreated:f,logMinutaTaskUpdated:y,clearAuditLog:v,exportAuditLog:j}}}}]);
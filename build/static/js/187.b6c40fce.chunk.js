"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[187],{187:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var s=a(5452),n=a(5043),o=a(9543),r=a(579);const l=e=>{let{currentProjectId:t,currentProject:a,projects:l,workPackages:i,tasks:c,purchaseOrders:d,advances:m,invoices:u,contracts:x}=e;const h=(0,n.useMemo)(()=>Math.random().toString(36).substr(2,9),[]);s.vF.debug("\ud83d\udd0d CASHFLOW COMPONENT - INSTANCIA ".concat(h," INICIANDO:"),{currentProject:null===a||void 0===a?void 0:a.name,tasksCount:(null===c||void 0===c?void 0:c.length)||0,timestamp:(new Date).toISOString()}),s.vF.debug("\ud83d\udd0d CASHFLOW COMPONENT [".concat(h,"] - TAREAS RECIBIDAS:"),{totalTasks:(null===c||void 0===c?void 0:c.length)||0,tasksWithCosts:(null===c||void 0===c?void 0:c.filter(e=>e.cost>0).length)||0,tasksWithCostsDetails:(null===c||void 0===c?void 0:c.filter(e=>e.cost>0).map(e=>({id:e.id,name:e.name,cost:e.cost,startDate:e.startDate,endDate:e.endDate,isMilestone:e.isMilestone})))||[]});const[g,p]=(0,n.useState)("12"),[v,j]=(0,n.useState)((new Date).toISOString().split("T")[0]),[b,f]=(0,n.useState)(!1),[N,D]=(0,n.useState)({paymentTerms:"milestone",revenueRecognition:"percentage_completion"}),{addAuditEvent:S}=(0,o.A)(t);s.vF.debug("\ud83d\udd0d CASHFLOW DEBUG - currentProject recibido:",a),s.vF.debug("\ud83d\udd0d CASHFLOW DEBUG - currentProjectId:",t);const y=e=>{if(!a||!c)return s.vF.debug("\ud83d\udd0d CashFlow: No hay proyecto o tareas:",{currentProject:!!a,tasks:!!c}),0;const t=new Date(e.getFullYear(),e.getMonth(),1);t.setHours(0,0,0,0);const n=new Date(e.getFullYear(),e.getMonth()+1,0);if(n.setHours(23,59,59,999),s.vF.debug("\ud83d\udd0d CashFlow: Calculando gasto planificado para mes:",{month:e.toLocaleDateString("es-ES",{year:"numeric",month:"long"}),monthStart:t.toISOString().split("T")[0],monthEnd:n.toISOString().split("T")[0],totalTasks:c.length}),6===e.getMonth()&&2026===e.getFullYear()){s.vF.debug("\ud83d\udd0d DEBUG JULIO 2026 - AN\xc1LISIS COMPLETO DE TAREAS:"),s.vF.debug("\ud83d\udd0d Rango del mes julio 2026:",{monthStart:t.toISOString().split("T")[0],monthEnd:n.toISOString().split("T")[0]});let e=0,a=0,o=[];c.forEach((r,l)=>{if(r.cost&&r.cost>0){e+=r.cost;const i=new Date(r.startDate),c=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),d=new Date(r.endDate),m=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59,999);let u=!1;u=r.isMilestone||0===r.duration?c>=t&&c<=n:c<=n&&m>=t,u?(a++,s.vF.debug("  \u2705 INCLUIDA - Tarea ".concat(l+1,":"),{name:r.name||r.title,cost:r.cost,startDate:r.startDate,endDate:r.endDate,isMilestone:r.isMilestone,duration:r.duration,taskStart:i.toISOString().split("T")[0],taskEnd:d.toISOString().split("T")[0]})):o.push({index:l+1,name:r.name||r.title,cost:r.cost,startDate:r.startDate,taskStart:i.toISOString().split("T")[0],isMilestone:r.isMilestone,razon:r.isMilestone?"Hito fuera del rango: ".concat(i.toISOString().split("T")[0]," no est\xe1 entre ").concat(t.toISOString().split("T")[0]," y ").concat(n.toISOString().split("T")[0]):"Tarea normal sin intersecci\xf3n: ".concat(i.toISOString().split("T")[0]," - ").concat(d.toISOString().split("T")[0]," no intersecta con ").concat(t.toISOString().split("T")[0]," - ").concat(n.toISOString().split("T")[0])})}}),s.vF.debug("\ud83d\udd0d JULIO 2026 - Resumen:",{totalTareas:c.length,tareasConCosto:c.filter(e=>e.cost>0).length,tareasEnJulio:a,costoTotalEsperado:e,costoPromedioPorTarea:e/c.filter(e=>e.cost>0).length}),s.vF.debug("\ud83d\udd0d JULIO 2026 - Tareas EXCLUIDAS (posibles causas del error):",o)}let o=0,r=0,l=0;return c.forEach((a,i)=>{if(s.vF.debug("\ud83d\udd0d CashFlow: Tarea ".concat(i+1,":"),{name:a.name||a.title,cost:a.cost,startDate:a.startDate,endDate:a.endDate,hasCost:!!a.cost,hasDates:!(!a.startDate||!a.endDate),isMilestone:a.isMilestone,duration:a.duration}),44===i){const o=e.toLocaleDateString("es-ES",{year:"numeric",month:"long"});s.vF.debug("\ud83d\udea8 DEBUG TAREA 45 ESPEC\xcdFICA:",{taskName:a.name||a.title,taskCost:a.cost,taskStartDate:a.startDate,taskEndDate:a.endDate,isMilestone:a.isMilestone,duration:a.duration,monthStart:t.toISOString().split("T")[0],monthEnd:n.toISOString().split("T")[0],monthName:o}),"agosto de 2026"===o&&a.cost>0&&s.vF.debug("\ud83d\udd0d CASHFLOW [".concat(h,"] - TAREA CON COSTO EN AGOSTO 2026:"),{taskIndex:i,taskId:a.id,taskName:a.name,taskCost:a.cost,taskStartDate:a.startDate,taskEndDate:a.endDate,isMilestone:a.isMilestone,duration:a.duration,monthName:o,monthStart:t.toISOString().split("T")[0],monthEnd:n.toISOString().split("T")[0]})}if(a.cost&&a.startDate&&a.endDate){r++;const c=new Date(a.startDate),d=new Date(c.getFullYear(),c.getMonth(),c.getDate(),0,0,0,0),m=new Date(a.endDate),u=new Date(m.getFullYear(),m.getMonth(),m.getDate(),23,59,59,999),x=e.toLocaleDateString("es-ES",{year:"numeric",month:"long"});("julio de 2026"===x||"agosto de 2026"===x)&&a.cost>0&&s.vF.debug("\ud83d\udd0d CASHFLOW [".concat(h,"] - TAREA CON COSTO EN ").concat(x.toUpperCase(),":"),{taskIndex:i,taskId:a.id,taskName:a.name,taskCost:a.cost,taskStartDate:a.startDate,taskEndDate:a.endDate,isMilestone:a.isMilestone,duration:a.duration,monthName:x,monthStart:t.toISOString().split("T")[0],monthEnd:n.toISOString().split("T")[0]});let g=!1;if(a.isMilestone||0===a.duration?(g=d>=t&&d<=n,a.cost>0&&("julio de 2026"===x||"agosto de 2026"===x)&&s.vF.debug("\ud83c\udfaf DEBUG HITO [".concat(h,"] - Verificaci\xf3n de mes:"),{taskName:a.name||a.title,taskStartDate:a.startDate,taskStart:c.toISOString().split("T")[0],monthStart:t.toISOString().split("T")[0],monthEnd:n.toISOString().split("T")[0],isInMonth:g,monthName:x,comparison:{taskStartGreaterEqualMonthStart:d>=t,taskStartLessEqualMonthEnd:d<=n,taskStartTime:d.getTime(),monthStartTime:t.getTime(),monthEndTime:n.getTime()}})):g=d<=n&&u>=t,g)if(l++,a.isMilestone||0===a.duration){const e=a.cost||0;o+=e,s.vF.debug('\ud83d\udcb0 CashFlow: HITO "'.concat(a.name||a.title,'" en mes:'),{taskCost:a.cost,isMilestone:!0,startDate:a.startDate,endDate:a.endDate,costInMonth:e.toFixed(2)}),a.cost&&a.cost>3e5&&s.vF.debug("\ud83d\udea8 DEBUG HITO PROBLEM\xc1TICO:",{taskName:a.name||a.title,taskCost:a.cost,taskStartDate:a.startDate,taskEndDate:a.endDate,monthStart:t.toISOString().split("T")[0],monthEnd:n.toISOString().split("T")[0],isInMonth:d<=n&&u>=t,plannedExpenseBefore:o-e,plannedExpenseAfter:o})}else{const e=u-d+1,r=new Date(Math.max(d.getTime(),t.getTime())),l=new Date(Math.min(u.getTime(),n.getTime()))-r+1;if(l>0){const t=l/e,n=(a.cost||0)*t;o+=n,s.vF.debug('\ud83d\udcb0 CashFlow: Tarea "'.concat(a.name||a.title,'" en mes:'),{taskCost:a.cost,percentageInMonth:(100*t).toFixed(1)+"%",costInMonth:n.toFixed(2)})}}}}),s.vF.debug("\ud83d\udd0d CashFlow: Resumen del mes:",{totalTasks:c.length,tasksWithCosts:r,tasksInMonth:l,plannedExpense:o.toFixed(2)}),6===e.getMonth()&&2026===e.getFullYear()&&s.vF.debug("\ud83c\udfaf JULIO 2026 - VALOR FINAL CALCULADO:",{plannedExpense:o,plannedExpenseFixed:o.toFixed(3),valorEsperadoPorUsuario:385953.528,diferencia:o-385953.528,porcentajeDelEsperado:(o/385953.528*100).toFixed(2)+"%"}),o},O=(e,t)=>{if(!a)return 0;s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION - calculateMonthCommittedExpense iniciando:",{monthDate:e.toISOString().substring(0,7),purchaseOrdersLength:(null===d||void 0===d?void 0:d.length)||0,purchaseOrders:d});const n=(null===d||void 0===d?void 0:d.filter(e=>"approved"===e.status))||[];s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION - \xd3rdenes de compra aprobadas:",n.map(e=>({id:e.id,number:e.number,status:e.status,totalAmount:e.totalAmount,approvalDate:e.approvalDate,requestDate:e.requestDate,hasApprovalDate:!(!e.approvalDate||""===e.approvalDate.trim()),hasRequestDate:!(!e.requestDate||""===e.requestDate.trim())})));let o=0;const r=new Date(e.getFullYear(),e.getMonth(),1);r.setHours(0,0,0,0);const l=new Date(e.getFullYear(),e.getMonth()+1,0);l.setHours(23,59,59,999),s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION - Rango de fechas:",{monthStart:r.toISOString().split("T")[0],monthEnd:l.toISOString().split("T")[0]});const i=(null===d||void 0===d?void 0:d.filter(e=>{if("approved"!==e.status)return!1;if(!e.approvalDate||""===e.approvalDate.trim())return s.vF.debug("\u26a0\ufe0f CASHFLOW PROJECTION - OC sin fecha de aprobaci\xf3n:",{id:e.id,number:e.number,status:e.status,totalAmount:e.totalAmount,approvalDate:e.approvalDate}),!1;const a=new Date(e.approvalDate+"T00:00:00"),n=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),o=new Date(n);o.setDate(n.getDate()+t),o.setHours(0,0,0,0);const i=o>=r&&o<=l;return s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION - Evaluando OC:",{id:e.id,number:e.number,approvalDate:e.approvalDate,approvalDateParsed:a.toISOString().split("T")[0],adjustedDate:o.toISOString().split("T")[0],monthStart:r.toISOString().split("T")[0],monthEnd:l.toISOString().split("T")[0],daysToPayment:t,status:e.status,totalAmount:e.totalAmount,isInMonth:i,willInclude:i}),i}))||[];return o+=i.reduce((e,t)=>(s.vF.debug("\u2705 CASHFLOW PROJECTION - INCLUYENDO OC ".concat(t.number,": $").concat(t.totalAmount)),e+(t.totalAmount||0)),0),s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION - Resultado final:",{monthPOsCount:i.length,committedExpense:o}),o},C=e=>{if(!a)return 0;let t=0;const s=new Date(e.getFullYear(),e.getMonth(),1);s.setHours(0,0,0,0);const n=new Date(e.getFullYear(),e.getMonth()+1,0);n.setHours(23,59,59,999);t+=((null===m||void 0===m?void 0:m.filter(e=>{if("paid"!==e.status)return!1;const t=new Date(e.paymentDate||e.date),a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0);return a>=s&&a<=n}))||[]).reduce((e,t)=>e+(t.amount||0),0);return t+=((null===u||void 0===u?void 0:u.filter(e=>{if("paid"!==e.status)return!1;const t=new Date(e.paymentDate||e.date),a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0);return a>=s&&a<=n}))||[]).reduce((e,t)=>e+(t.amount||0),0),t},w=(0,n.useMemo)(()=>Date.now(),[a,c,g,v]),F=(0,n.useMemo)(()=>{if(!a)return null;s.vF.debug("\ud83d\udd04 CASHFLOW PROJECTION [".concat(h,"] - FORZANDO REC\xc1LCULO COMPLETO:"),{currentProject:null===a||void 0===a?void 0:a.name,projectionPeriod:g,projectionStartDate:v,purchaseOrders:(null===d||void 0===d?void 0:d.length)||0,advances:(null===m||void 0===m?void 0:m.length)||0,invoices:(null===u||void 0===u?void 0:u.length)||0,tasks:(null===c||void 0===c?void 0:c.length)||0,forceRecalculation:w,timestamp:(new Date).toISOString()});const e=new Date(v),t=parseInt(g),n=[],o={net30:30,net60:60,net90:90,advance:-15,milestone:0}[N.paymentTerms];s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION - CONFIGURACI\xd3N COMPLETA:",{startDate:e.toISOString().split("T")[0],months:t,projectionStartDate:v,projectionPeriod:g,currentProject:null===a||void 0===a?void 0:a.name});for(let a=0;a<t;a++){const t=new Date(e.getFullYear(),e.getMonth()+a,1),r=t.toISOString().slice(0,7),l=t.toLocaleDateString("es-ES",{year:"numeric",month:"long"});s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION - Procesando mes ".concat(a+1,": ").concat(r," (").concat(l,")")),"2026-07"===r&&s.vF.debug("\ud83c\udfaf JULIO 2026 DETECTADO - Iniciando c\xe1lculo detallado...");const i=y(t);s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION [".concat(h,"] - RESULTADO calculateMonthPlannedExpense para ").concat(r,": $").concat(i)),s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION - LLAMANDO calculateMonthCommittedExpense para mes ".concat(r));const c=O(t,o);s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION - RESULTADO calculateMonthCommittedExpense: $".concat(c));const d=C(t),m={month:a+1,monthKey:r,monthLabel:l,date:t,revenue:i,expenses:c,realExpenses:d,netCashFlow:i-d,cumulativeBalance:(a>0?n[a-1].cumulativeBalance:0)+i,cashIn:i,cashOut:d};"2026-07"!==r&&"2026-08"!==r||s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION [".concat(h,"] - ASIGNANDO VALORES para ").concat(r,":"),{monthPlannedExpense:i,revenue:m.revenue,monthLabel:m.monthLabel,monthKey:m.monthKey}),n.push(m)}return s.vF.debug("\ud83d\udd0d CASHFLOW PROJECTION [".concat(h,"] - PROYECCI\xd3N FINAL COMPLETA:"),{totalMonths:n.length,julio2026:n.find(e=>"2026-07"===e.monthKey),agosto2026:n.find(e=>"2026-08"===e.monthKey),timestamp:(new Date).toISOString()}),n},[a,g,v,N,d,m,u,x,c,w]),I=(0,n.useMemo)(()=>{if(!F)return null;const e=F.reduce((e,t)=>e+t.revenue,0),t=F.reduce((e,t)=>e+t.expenses,0),a=F.reduce((e,t)=>e+t.realExpenses,0);return{totalRevenue:e,totalPlannedExpense:e,totalCommittedExpenses:t,totalRealExpenses:a,totalExpenses:t,totalNetCashFlow:e-a,maxCashOutflow:Math.min(...F.map(e=>e.cumulativeBalance)),maxCashInflow:Math.max(...F.map(e=>e.cumulativeBalance)),positiveMonths:F.filter(e=>e.netCashFlow>0).length,negativeMonths:F.filter(e=>e.netCashFlow<0).length,averageMonthlyRevenue:e/F.length,averageMonthlyExpenses:t/F.length,averageMonthlyRealExpenses:a/F.length,projectDuration:F.length}},[F]),E=e=>{if(null===e||void 0===e||isNaN(e))return"$0,00";const t=new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:3}).format(e);return"$".concat(t)},T=e=>e>0?"text-green-600":e<0?"text-red-600":"text-gray-600",M=e=>e>0?"text-green-700":e<0?"text-red-700":"text-gray-700";return a?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-100 rounded-2xl shadow-lg p-8 mb-8 text-gray-800 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-green-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-emerald-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,r.jsx)("div",{className:"relative z-10",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,r.jsx)("span",{className:"text-3xl",children:"\ud83d\udcb0"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold mb-3 text-gray-800",children:"Proyecci\xf3n de Flujo de Caja"}),(0,r.jsx)("p",{className:"text-gray-600 text-lg",children:"An\xe1lisis financiero del proyecto seg\xfan PMBOK v7 - Gesti\xf3n de Costos"}),(0,r.jsxs)("div",{className:"mt-4 flex items-center space-x-6 text-sm text-gray-700",children:[(0,r.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"\ud83d\udcca"}),(0,r.jsxs)("span",{children:["Proyecto: ",a.name]})]}),(0,r.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"\ud83d\udcc5"}),(0,r.jsxs)("span",{children:["Per\xedodo: ",g," meses"]})]}),(0,r.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"\ud83d\udcb5"}),(0,r.jsxs)("span",{children:["Presupuesto: $",(a.budget/1e3).toFixed(0),"K"]})]}),(0,r.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"\ud83d\udee1\ufe0f"}),(0,r.jsxs)("span",{children:["Reserva: $",((a.contingencyReserve+a.managementReserve)/1e3).toFixed(0),"K"]})]})]})]})]}),(0,r.jsx)("div",{className:"flex items-center space-x-4",children:(0,r.jsx)("button",{onClick:()=>{if(!F)return;const e=[["Mes","Gasto Planificado","Gasto Comprometido (OCs)","Gasto Real","Saldo Acumulado"],...F.map(e=>[e.monthLabel,E(e.revenue),E(e.expenses),E(e.realExpenses),E(e.cumulativeBalance)])].map(e=>e.join(",")).join("\n"),s=new Blob([e],{type:"text/csv"}),n=window.URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download="proyeccion-flujo-caja-".concat((null===a||void 0===a?void 0:a.name)||"proyecto",".csv"),o.click(),window.URL.revokeObjectURL(n),S("cash_flow","projection_exported",{projectId:t,period:g,startDate:v})},className:"px-6 py-3 bg-white text-green-700 rounded-xl hover:bg-green-50 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1 font-semibold border border-green-200",children:"\ud83d\udcca Exportar"})})]})})]}),I&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-orange-500",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:E(I.totalRevenue)}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Gasto Planificado Total"})]}),(0,r.jsx)("div",{className:"p-3 bg-orange-100 rounded-lg",children:(0,r.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"})})]})}),(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-red-500",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:E(I.totalExpenses)}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Gastos Totales"})]}),(0,r.jsx)("div",{className:"p-3 bg-red-100 rounded-lg",children:(0,r.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc9"})})]})}),(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-blue-500",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-2xl font-bold ".concat(T(I.totalNetCashFlow)),children:E(I.totalNetCashFlow)}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Flujo Neto"})]}),(0,r.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,r.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"})})]})}),(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-purple-500",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-2xl font-bold ".concat(M(I.maxCashOutflow)),children:E(I.maxCashOutflow)}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"M\xe1ximo D\xe9ficit"})]}),(0,r.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg",children:(0,r.jsx)("span",{className:"text-2xl",children:"\u26a0\ufe0f"})})]})})]}),(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-8",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcc5 Per\xedodo de Proyecci\xf3n (meses)"}),(0,r.jsxs)("select",{value:g,onChange:e=>p(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",children:[(0,r.jsx)("option",{value:"6",children:"6 meses"}),(0,r.jsx)("option",{value:"12",children:"12 meses"}),(0,r.jsx)("option",{value:"18",children:"18 meses"}),(0,r.jsx)("option",{value:"24",children:"24 meses"}),(0,r.jsx)("option",{value:"36",children:"36 meses"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\ude80 Fecha de Inicio"}),(0,r.jsx)("input",{type:"date",value:v,onChange:e=>j(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors"})]}),(0,r.jsx)("div",{className:"flex items-end",children:(0,r.jsx)("button",{onClick:()=>f(!0),className:"w-full px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl hover:from-green-700 hover:to-emerald-700 transition-all duration-200 shadow-sm hover:shadow-md",children:"\u2699\ufe0f Configuraci\xf3n Avanzada"})})]})}),F&&(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\ud83d\udcca Proyecci\xf3n Mensual de Flujo de Caja"})}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mes"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gasto Comprometido (OCs)"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gasto Planificado"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gasto Real"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Saldo Acumulado"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-100",children:F.map(e=>("2026-07"!==e.monthKey&&"2026-08"!==e.monthKey||s.vF.debug("\ud83d\udd0d CASHFLOW RENDER [".concat(h,"] - RENDERIZANDO ").concat(e.monthKey,":"),{monthLabel:e.monthLabel,revenue:e.revenue,formattedRevenue:E(e.revenue),monthObject:e}),(0,r.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,r.jsxs)("td",{className:"px-6 py-4",children:[(0,r.jsx)("div",{className:"font-medium text-gray-900",children:e.monthLabel}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["Mes ",e.month]})]}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-blue-600 font-medium",children:E(e.expenses)})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-orange-600 font-medium",children:E(e.revenue)})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-red-600 font-medium",children:E(e.realExpenses)})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"font-medium ".concat(M(e.cumulativeBalance)),children:E(e.cumulativeBalance)})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(e.cumulativeBalance>0?"bg-green-100 text-green-800":e.cumulativeBalance<0?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.cumulativeBalance>0?"\u2705 Positivo":e.cumulativeBalance<0?"\u26a0\ufe0f D\xe9ficit":"\u2696\ufe0f Equilibrio"})})]},e.month)))})]})})]}),F&&(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 mt-8",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-6",children:"\ud83d\udcc8 Gr\xe1fico de Flujo de Caja"}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h4",{className:"text-md font-medium text-gray-700 mb-4",children:"\ud83d\udcb0 Flujo Neto Mensual"}),(0,r.jsx)("div",{className:"h-48 flex items-end justify-between space-x-2",children:F.map(e=>{const t=Math.max(...F.map(e=>Math.abs(e.netCashFlow)));let a=0;return t>0&&(a=Math.abs(e.netCashFlow)/t*192),0===e.netCashFlow&&(a=2),(0,r.jsxs)("div",{className:"flex-1 flex flex-col items-center",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-2 text-center",children:e.monthLabel.slice(0,3)}),(0,r.jsx)("div",{className:"w-full rounded-t transition-all duration-300 ".concat(e.netCashFlow>0?"bg-green-500":e.netCashFlow<0?"bg-red-500":"bg-gray-400"),style:{height:"".concat(a,"px")}}),(0,r.jsx)("div",{className:"text-xs font-medium mt-1 ".concat(T(e.netCashFlow)),children:E(e.netCashFlow)})]},"net-".concat(e.month))})})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h4",{className:"text-md font-medium text-gray-700 mb-4",children:"\ud83d\udcca Saldo Acumulado (L\xednea de Tiempo)"}),(0,r.jsxs)("div",{className:"h-48 relative",children:[(0,r.jsxs)("svg",{className:"w-full h-full",viewBox:"0 0 ".concat(100*F.length," 200"),children:[(0,r.jsx)("line",{x1:"0",y1:"100",x2:100*F.length,y2:"100",stroke:"#e5e7eb",strokeWidth:"1",strokeDasharray:"5,5"}),(()=>{const e=Math.min(...F.map(e=>e.cumulativeBalance)),t=Math.max(...F.map(e=>e.cumulativeBalance))-e,a=F.map((a,s)=>{const n=200-180*(t>0?(a.cumulativeBalance-e)/t:.5);return"".concat(100*s+50,",").concat(n)}).join(" ");return(0,r.jsx)("polyline",{points:a,fill:"none",stroke:"#3b82f6",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})(),(()=>{const e=Math.min(...F.map(e=>e.cumulativeBalance)),t=Math.max(...F.map(e=>e.cumulativeBalance))-e;return F.map((a,s)=>{const n=200-180*(t>0?(a.cumulativeBalance-e)/t:.5);return(0,r.jsx)("circle",{cx:100*s+50,cy:n,r:"4",fill:a.cumulativeBalance>0?"#10b981":a.cumulativeBalance<0?"#ef4444":"#6b7280",stroke:"white",strokeWidth:"2"},"point-".concat(a.month))})})()]}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 flex justify-between px-4",children:F.map(e=>(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.monthLabel.slice(0,3)},"label-".concat(e.month)))})]})]})]})]}),b&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"\u2699\ufe0f Configuraci\xf3n de Proyecci\xf3n"}),(0,r.jsx)("button",{onClick:()=>f(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:"\u2715"})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcca T\xe9rminos de Pago para \xd3rdenes de Compra"}),(0,r.jsxs)("select",{value:N.paymentTerms,onChange:e=>D({projectId:N.projectId,startDate:N.startDate,endDate:N.endDate,paymentTerms:e.target.value,revenueRecognition:N.revenueRecognition,expenseTiming:N.expenseTiming,cashFlowBuffer:N.cashFlowBuffer}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",children:[(0,r.jsx)("option",{value:"net30",children:"Net 30 d\xedas"}),(0,r.jsx)("option",{value:"net60",children:"Net 60 d\xedas"}),(0,r.jsx)("option",{value:"net90",children:"Net 90 d\xedas"}),(0,r.jsx)("option",{value:"advance",children:"Anticipado (15 d\xedas antes)"}),(0,r.jsx)("option",{value:"milestone",children:"Por hitos"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Define cu\xe1ndo se registran los gastos de las \xf3rdenes de compra en el flujo de caja"}),(0,r.jsxs)("div",{className:"text-xs text-gray-400 mt-2 space-y-1",children:[(0,r.jsxs)("div",{children:["\u2022 ",(0,r.jsx)("strong",{children:"Por hitos:"})," Usa la fecha de aprobaci\xf3n directamente"]}),(0,r.jsxs)("div",{children:["\u2022 ",(0,r.jsx)("strong",{children:"Net 30/60/90:"})," Fecha de aprobaci\xf3n + d\xedas de pago"]}),(0,r.jsxs)("div",{children:["\u2022 ",(0,r.jsx)("strong",{children:"Anticipado:"})," Fecha de aprobaci\xf3n - 15 d\xedas"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcc8 Reconocimiento de Ingresos"}),(0,r.jsxs)("select",{value:N.revenueRecognition,onChange:e=>D({projectId:N.projectId,startDate:N.startDate,endDate:N.endDate,paymentTerms:N.paymentTerms,revenueRecognition:e.target.value,expenseTiming:N.expenseTiming,cashFlowBuffer:N.cashFlowBuffer}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",children:[(0,r.jsx)("option",{value:"uniform",children:"Distribuci\xf3n Uniforme"}),(0,r.jsx)("option",{value:"percentage_completion",children:"Por Progreso del Proyecto"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"C\xf3mo se distribuye el presupuesto del proyecto a lo largo del tiempo"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t mt-8",children:[(0,r.jsx)("button",{onClick:()=>f(!1),className:"px-6 py-3 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-xl transition-colors font-medium",children:"Cancelar"}),(0,r.jsx)("button",{onClick:()=>f(!1),className:"px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl hover:from-green-700 hover:to-emerald-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl",children:"\ud83d\udcbe Guardar Configuraci\xf3n"})]})]})})})]}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-12 text-center",children:[(0,r.jsx)("div",{className:"text-6xl mb-6",children:"\ud83d\udcb0"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-700 mb-2",children:"Proyecto no seleccionado"}),(0,r.jsx)("div",{className:"text-gray-500",children:"Selecciona un proyecto para ver la proyecci\xf3n de flujo de caja"})]})})})}}}]);
//# sourceMappingURL=187.b6c40fce.chunk.js.map
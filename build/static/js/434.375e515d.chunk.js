"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[434,449],{434:(e,t,s)=>{s.r(t),s.d(t,{default:()=>q});var a=s(9950),r=s(9379),n=s(2331),l=s(4634),i=s(1403),o=s(4321),d=s(4414);const c=e=>{let{error:t}=e;return t?(0,d.jsx)("p",{className:"text-red-500 text-xs mt-1",children:t}):null},m=e=>{var t,s;let{projects:m,currentProjectId:u,setCurrentProjectId:x,portfolioMetrics:g,workPackages:p,risks:h,globalResources:b,setGlobalResources:v,tasksByProject:j,createProject:y,updateProject:f,deleteProject:N,duplicateProject:w,archiveProject:k,includeWeekendsByProject:D,setIncludeWeekendsByProject:A,getCurrentProjectIncludeWeekends:P}=e;const[C,S]=(0,a.useState)(!1),[I,T]=(0,a.useState)(null),[R,E]=(0,a.useState)(!1),[M,O]=(0,a.useState)(null),[L,F]=(0,a.useState)({}),{permissions:B,isReadOnly:z,isLoading:q}=(0,o.A)(),_=e=>{switch(e){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},W=e=>{switch(e){case"active":return"bg-blue-100 text-blue-800 border-blue-200";case"completed":return"bg-green-100 text-green-800 border-green-200";case"on-hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},V=e=>{switch(e){case"active":return"\ud83d\udd04";case"completed":return"\u2705";case"on-hold":default:return"\u23f8\ufe0f";case"cancelled":return"\u274c"}},G=(e,t)=>{O(s=>(0,r.A)((0,r.A)({},s),{},{[e]:t}))},U=(e,t)=>{const s=Object.assign({},L);switch(e){case"name":!t||t.trim().length<3?s.name="El nombre debe tener al menos 3 caracteres":delete s.name;break;case"manager":!t||t.trim().length<2?s.manager="El manager debe tener al menos 2 caracteres":delete s.manager;break;case"sponsor":!t||t.trim().length<2?s.sponsor="El sponsor debe tener al menos 2 caracteres":delete s.sponsor;break;case"startDate":t?delete s.startDate:s.startDate="La fecha de inicio es requerida";break;case"endDate":t?null!==M&&void 0!==M&&M.startDate&&t<=M.startDate?s.endDate="La fecha de fin debe ser posterior a la fecha de inicio":delete s.endDate:s.endDate="La fecha de fin es requerida";break;case"budget":!t||t<=0?s.budget="El presupuesto debe ser mayor a 0":delete s.budget;break;case"irr":t&&(t<0||t>100)?s.irr="La TIR debe estar entre 0% y 100%":delete s.irr}return F(s),0===Object.keys(s).length},$=()=>{O({id:"",name:"",description:"",status:"inactive",priority:"medium",startDate:(new Date).toISOString().split("T")[0],endDate:new Date(Date.now()+7776e6).toISOString().split("T")[0],budget:1e5,contingencyReserve:1e4,managementReserve:5e3,manager:"",sponsor:"",objective:"",businessCase:"",irr:0,roi:0,kickoffDate:"",stakeholders:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),version:"1.0.0"}),F({}),E(!0)},H=(0,a.useMemo)(()=>{if(!m||0===m.length)return{totalProjects:0,activeProjects:0,completedProjects:0,totalBudget:0,averageProgress:0,totalWorkPackages:0,totalRisks:0,activeRisks:0};const e=m.length,t=m.filter(e=>"active"===e.status).length,s=m.filter(e=>"completed"===e.status).length,a=m.filter(e=>"active"===e.status),r=a.reduce((e,t)=>e+(t.budget||0),0),n=a.length>0?a.reduce((e,t)=>e+(t.progress||0),0)/a.length:0,l=p?p.length:0,i=h?h.length:0,o=h?h.filter(e=>"active"===e.status).length:0;return{totalProjects:e,activeProjects:t,completedProjects:s,totalBudget:r,averageProgress:Math.round(n),totalWorkPackages:l,totalRisks:i,activeRisks:o}},[m,p,h]),K=g||H;return(0,d.jsxs)("div",{className:"space-y-6 max-w-full overflow-hidden",children:[(0,d.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"text-blue-600 text-xl mr-3",children:"\u2139\ufe0f"}),(0,d.jsxs)("div",{className:"text-blue-800",children:[(0,d.jsx)("strong",{children:"Nota:"}),' Las m\xe9tricas financieras y KPIs solo consideran proyectos con estado "Activo". Los proyectos "Inactivos" o "Completados" no influyen en los indicadores financieros.']})]})}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-blue-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Total Proyectos"}),(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:K.totalProjects})]}),(0,d.jsx)("div",{className:"text-blue-500 text-2xl",children:"\ud83d\udcca"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-green-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Proyectos Activos"}),(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:K.activeProjects})]}),(0,d.jsx)("div",{className:"text-green-500 text-2xl",children:"\ud83d\udd04"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-purple-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Completados"}),(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:K.completedProjects})]}),(0,d.jsx)("div",{className:"text-purple-500 text-2xl",children:"\u2705"})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-indigo-500",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Presupuesto Proyectos Activos"}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",(K.totalBudget/1e3).toFixed(0),"K"]})]}),(0,d.jsx)("div",{className:"text-indigo-500 text-2xl",children:"\ud83d\udcb0"})]})})]}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"Acciones del Portfolio"}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[B.canEdit&&(0,d.jsxs)("button",{onClick:$,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center space-x-2",children:[(0,d.jsx)("span",{children:"\u2795"}),(0,d.jsx)("span",{children:"Nuevo Proyecto"})]}),z()&&(0,d.jsxs)("div",{className:"text-sm text-gray-500 italic bg-gray-50 px-3 py-2 rounded-lg border",children:[(0,d.jsx)("span",{children:"\ud83d\udc40"})," Modo solo lectura"]})]})]})}),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Proyectos del Portfolio"}),0===m.length?(0,d.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,d.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udcc1"}),(0,d.jsx)("div",{children:"No hay proyectos en el portfolio"}),(0,d.jsx)("button",{onClick:$,className:"mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Crear Primer Proyecto"})]}):(0,d.jsx)("div",{className:"space-y-3",children:m.map(e=>(0,d.jsx)("div",{className:"border rounded-lg p-4 transition-all duration-200 cursor-pointer hover:shadow-md ".concat(u===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>x(e.id),children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,d.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(_(e.priority)),children:e.priority}),(0,d.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(W(e.status)),children:[V(e.status)," ",e.status]})]}),(0,d.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,d.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,d.jsxs)("span",{children:["\ud83d\udcc5 ",e.startDate," - ",e.endDate]}),(0,d.jsxs)("span",{children:["\ud83d\udcb0 $",(e.budget/1e3).toFixed(0),"K"]}),(0,d.jsxs)("span",{children:["\ud83d\udc64 ",e.manager]})]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),T(e),S(!0)},className:"p-2 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors",title:"Ver archivos del proyecto",children:"\ud83d\udcce"}),(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),w(e.id)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded",title:"Duplicar proyecto",children:"\ud83d\udccb"}),(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{console.log("\ud83d\udd0d Proyecto original para editar:",e),console.log("\ud83d\udd0d Estado del proyecto original:",e.status);const t=(0,r.A)((0,r.A)({},e),{},{description:e.description||"",objective:e.objective||"",businessCase:e.businessCase||"",kickoffDate:e.kickoffDate||"",stakeholders:e.stakeholders||[]});console.log("\ud83d\udd0d Proyecto preparado para editar:",t),console.log("\ud83d\udd0d Estado del proyecto preparado:",t.status),O(t),F({}),E(!0)})(e)},className:"p-2 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded",title:"Editar proyecto",children:"\u270f\ufe0f"}),(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),window.confirm('\xbfArchivar proyecto "'.concat(e.name,'"? Se mover\xe1 al archivo y se limpiar\xe1n sus datos del sistema activo.'))&&k(e.id)},className:"p-2 text-gray-400 hover:text-orange-600 hover:bg-orange-50 rounded",title:"Archivar proyecto",children:"\ud83d\udcc1"}),(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),window.confirm('\xbfEliminar proyecto "'.concat(e.name,'"? Esta acci\xf3n no se puede deshacer.'))&&N(e.id)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded",title:"Eliminar proyecto",children:"\ud83d\uddd1\ufe0f"})]})]})},e.id))})]}),u&&(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"M\xe9tricas del Proyecto Actual"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,d.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:(null===g||void 0===g||null===(t=g.currentProjectCPI)||void 0===t?void 0:t.toFixed(2))||"N/A"}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"CPI"})]}),(0,d.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:(null===g||void 0===g||null===(s=g.currentProjectSPI)||void 0===s?void 0:s.toFixed(2))||"N/A"}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"SPI"})]}),(0,d.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,d.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",((null===g||void 0===g?void 0:g.currentProjectCV)/1e3).toFixed(0),"K"]}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"CV"})]}),(0,d.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,d.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",((null===g||void 0===g?void 0:g.currentProjectSV)/1e3).toFixed(0),"K"]}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"SV"})]})]})]}),(0,d.jsx)(l.A,{projects:m,portfolioMetrics:g}),(0,d.jsx)(n.A,{projects:m,portfolioMetrics:g,workPackages:p,risks:h,tasksByProject:j,includeWeekendsByProject:D,setIncludeWeekendsByProject:A,getCurrentProjectIncludeWeekends:P}),C&&I&&(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl text-white",children:(0,d.jsx)("span",{className:"text-2xl",children:"\ud83d\udcce"})}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("h3",{className:"text-xl font-bold text-gray-800",children:["Archivos del Proyecto: ",I.name]}),(0,d.jsx)("p",{className:"text-sm text-gray-600",children:"Gesti\xf3n completa de documentos y archivos adjuntos"})]})]}),(0,d.jsx)("button",{onClick:()=>{S(!1),T(null)},className:"px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-200 shadow-sm hover:shadow-md",children:"\u2715 Cerrar"})]}),(0,d.jsx)(i.default,{projectId:I.id,category:"general",isContextual:!0,title:"\ud83d\udcce Archivos de ".concat(I.name),onFileUploaded:()=>{}})]}),R&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center p-4",children:(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:(0,d.jsxs)("div",{className:"p-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h2",{className:"text-xl font-bold",children:null!==M&&void 0!==M&&M.id?"Editar Proyecto":"Nuevo Proyecto"}),(0,d.jsx)("button",{onClick:()=>{E(!1),O(null)},className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Proyecto *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(L.name?"border-red-500":"border-gray-300"),value:(null===M||void 0===M?void 0:M.name)||"",onChange:e=>{O({id:M.id,name:M.name,manager:M.manager,sponsor:M.sponsor,priority:M.priority,status:M.status,startDate:M.startDate,endDate:M.endDate,budget:M.budget,irr:M.irr,description:M.description,objectives:M.objectives,scope:M.scope,deliverables:M.deliverables,assumptions:M.assumptions,constraints:M.constraints,dependencies:M.dependencies,risks:M.risks,stakeholders:M.stakeholders,team:M.team,resources:M.resources,timeline:M.timeline,milestones:M.milestones,successCriteria:M.successCriteria,qualityStandards:M.qualityStandards,communicationPlan:M.communicationPlan,riskManagement:M.riskManagement,changeManagement:M.changeManagement,lessonsLearned:M.lessonsLearned,createdAt:M.createdAt,updatedAt:M.updatedAt,version:M.version,progress:M.progress,name:e.target.value}),U("name",e.target.value)},onBlur:e=>U("name",e.target.value),placeholder:"Nombre del proyecto"}),(0,d.jsx)(c,{error:L.name})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Manager *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(L.manager?"border-red-500":"border-gray-300"),value:(null===M||void 0===M?void 0:M.manager)||"",onChange:e=>{O({id:M.id,name:M.name,manager:M.manager,sponsor:M.sponsor,priority:M.priority,status:M.status,startDate:M.startDate,endDate:M.endDate,budget:M.budget,irr:M.irr,description:M.description,objectives:M.objectives,scope:M.scope,deliverables:M.deliverables,assumptions:M.assumptions,constraints:M.constraints,dependencies:M.dependencies,risks:M.risks,stakeholders:M.stakeholders,team:M.team,resources:M.resources,timeline:M.timeline,milestones:M.milestones,successCriteria:M.successCriteria,qualityStandards:M.qualityStandards,communicationPlan:M.communicationPlan,riskManagement:M.riskManagement,changeManagement:M.changeManagement,lessonsLearned:M.lessonsLearned,createdAt:M.createdAt,updatedAt:M.updatedAt,version:M.version,progress:M.progress,manager:e.target.value}),U("manager",e.target.value)},onBlur:e=>U("manager",e.target.value),placeholder:"Gerente del proyecto"}),(0,d.jsx)(c,{error:L.manager})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sponsor *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(L.sponsor?"border-red-500":"border-gray-300"),value:(null===M||void 0===M?void 0:M.sponsor)||"",onChange:e=>{G("sponsor",e.target.value),U("sponsor",e.target.value)},onBlur:e=>U("sponsor",e.target.value),placeholder:"Patrocinador del proyecto"}),(0,d.jsx)(c,{error:L.sponsor})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prioridad"}),(0,d.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:(null===M||void 0===M?void 0:M.priority)||"medium",onChange:e=>O({id:M.id,name:M.name,manager:M.manager,sponsor:M.sponsor,priority:M.priority,status:M.status,startDate:M.startDate,endDate:M.endDate,budget:M.budget,irr:M.irr,description:M.description,objectives:M.objectives,scope:M.scope,deliverables:M.deliverables,assumptions:M.assumptions,constraints:M.constraints,dependencies:M.dependencies,risks:M.risks,stakeholders:M.stakeholders,team:M.team,resources:M.resources,timeline:M.timeline,milestones:M.milestones,successCriteria:M.successCriteria,qualityStandards:M.qualityStandards,communicationPlan:M.communicationPlan,riskManagement:M.riskManagement,changeManagement:M.changeManagement,lessonsLearned:M.lessonsLearned,createdAt:M.createdAt,updatedAt:M.updatedAt,version:M.version,progress:M.progress,priority:e.target.value}),children:[(0,d.jsx)("option",{value:"low",children:"Baja"}),(0,d.jsx)("option",{value:"medium",children:"Media"}),(0,d.jsx)("option",{value:"high",children:"Alta"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado del Proyecto *"}),(0,d.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:(null===M||void 0===M?void 0:M.status)||"inactive",onChange:e=>O({id:M.id,name:M.name,manager:M.manager,sponsor:M.sponsor,priority:M.priority,status:M.status,startDate:M.startDate,endDate:M.endDate,budget:M.budget,irr:M.irr,description:M.description,objectives:M.objectives,scope:M.scope,deliverables:M.deliverables,assumptions:M.assumptions,constraints:M.constraints,dependencies:M.dependencies,risks:M.risks,stakeholders:M.stakeholders,team:M.team,resources:M.resources,timeline:M.timeline,milestones:M.milestones,successCriteria:M.successCriteria,qualityStandards:M.qualityStandards,communicationPlan:M.communicationPlan,riskManagement:M.riskManagement,changeManagement:M.changeManagement,lessonsLearned:M.lessonsLearned,createdAt:M.createdAt,updatedAt:M.updatedAt,version:M.version,progress:M.progress,status:e.target.value}),children:[(0,d.jsx)("option",{value:"inactive",children:"\u26ab Inactivo"}),(0,d.jsx)("option",{value:"active",children:"\ud83d\udfe2 Activo"})]}),(0,d.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[(0,d.jsx)("strong",{children:"Por defecto:"}),' Los proyectos nuevos y duplicados aparecen como "Inactivos" para revisi\xf3n. Solo los proyectos "Activos" suman al dashboard consolidado y aparecen en Gesti\xf3n de Proyectos.']})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Inicio *"}),(0,d.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2 ".concat(L.startDate?"border-red-500":"border-gray-300"),value:(null===M||void 0===M?void 0:M.startDate)||"",onChange:e=>{O({id:M.id,name:M.name,manager:M.manager,sponsor:M.sponsor,priority:M.priority,status:M.status,startDate:M.startDate,endDate:M.endDate,budget:M.budget,irr:M.irr,description:M.description,objectives:M.objectives,scope:M.scope,deliverables:M.deliverables,assumptions:M.assumptions,constraints:M.constraints,dependencies:M.dependencies,risks:M.risks,stakeholders:M.stakeholders,team:M.team,resources:M.resources,timeline:M.timeline,milestones:M.milestones,successCriteria:M.successCriteria,qualityStandards:M.qualityStandards,communicationPlan:M.communicationPlan,riskManagement:M.riskManagement,changeManagement:M.changeManagement,lessonsLearned:M.lessonsLearned,createdAt:M.createdAt,updatedAt:M.updatedAt,version:M.version,progress:M.progress,startDate:e.target.value}),U("startDate",e.target.value),null!==M&&void 0!==M&&M.endDate&&U("endDate",M.endDate)},onBlur:e=>U("startDate",e.target.value)}),(0,d.jsx)(c,{error:L.startDate})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Fin *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(L.endDate?"border-red-500":"border-gray-300"),value:(null===M||void 0===M?void 0:M.endDate)||"",onChange:e=>{O({id:M.id,name:M.name,manager:M.manager,sponsor:M.sponsor,priority:M.priority,status:M.status,startDate:M.startDate,endDate:M.endDate,budget:M.budget,irr:M.irr,description:M.description,objectives:M.objectives,scope:M.scope,deliverables:M.deliverables,assumptions:M.assumptions,constraints:M.constraints,dependencies:M.dependencies,risks:M.risks,stakeholders:M.stakeholders,team:M.team,resources:M.resources,timeline:M.timeline,milestones:M.milestones,successCriteria:M.successCriteria,qualityStandards:M.qualityStandards,communicationPlan:M.communicationPlan,riskManagement:M.riskManagement,changeManagement:M.changeManagement,lessonsLearned:M.lessonsLearned,createdAt:M.createdAt,updatedAt:M.updatedAt,version:M.version,progress:M.progress,endDate:e.target.value}),U("endDate",e.target.value)},onBlur:e=>U("endDate",e.target.value),placeholder:"YYYY-MM-DD"}),(0,d.jsx)(c,{error:L.endDate})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Presupuesto (USD) *"}),(0,d.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 ".concat(L.budget?"border-red-500":"border-gray-300"),value:(null===M||void 0===M?void 0:M.budget)||"",onChange:e=>{const t=e.target.value;if(""===t||/^\d+$/.test(t)){const e=""===t?"":Number(t);O({id:M.id,name:M.name,manager:M.manager,sponsor:M.sponsor,priority:M.priority,status:M.status,startDate:M.startDate,endDate:M.endDate,budget:M.budget,irr:M.irr,description:M.description,objectives:M.objectives,scope:M.scope,deliverables:M.deliverables,assumptions:M.assumptions,constraints:M.constraints,dependencies:M.dependencies,risks:M.risks,stakeholders:M.stakeholders,team:M.team,resources:M.resources,timeline:M.timeline,milestones:M.milestones,successCriteria:M.successCriteria,qualityStandards:M.qualityStandards,communicationPlan:M.communicationPlan,riskManagement:M.riskManagement,changeManagement:M.changeManagement,lessonsLearned:M.lessonsLearned,createdAt:M.createdAt,updatedAt:M.updatedAt,version:M.version,progress:M.progress,budget:e}),U("budget",e)}},onBlur:e=>{const t=""===e.target.value?"":Number(e.target.value);U("budget",t)},placeholder:"Presupuesto en USD (ej: 100000)",min:"0"}),(0,d.jsx)(c,{error:L.budget})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"TIR (%)"}),(0,d.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 ".concat(L.irr?"border-red-500":"border-gray-300"),value:(null===M||void 0===M?void 0:M.irr)||"",onChange:e=>{const t=e.target.value;if(""===t||/^\d*\.?\d*$/.test(t)){const e=""===t?"":Number(t);G("irr",e),U("irr",e)}},onBlur:e=>{const t=""===e.target.value?"":Number(e.target.value);U("irr",t)},placeholder:"Tasa Interna de Retorno (ej: 15.5)",min:"0",max:"100",step:"0.01"}),(0,d.jsx)(c,{error:L.irr})]}),(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,d.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===M||void 0===M?void 0:M.description)||"",onChange:e=>O({id:M.id,name:M.name,manager:M.manager,sponsor:M.sponsor,priority:M.priority,status:M.status,startDate:M.startDate,endDate:M.endDate,budget:M.budget,irr:M.irr,description:M.description,objectives:M.objectives,scope:M.scope,deliverables:M.deliverables,assumptions:M.assumptions,constraints:M.constraints,dependencies:M.dependencies,risks:M.risks,stakeholders:M.stakeholders,team:M.team,resources:M.resources,timeline:M.timeline,milestones:M.milestones,successCriteria:M.successCriteria,qualityStandards:M.qualityStandards,communicationPlan:M.communicationPlan,riskManagement:M.riskManagement,changeManagement:M.changeManagement,lessonsLearned:M.lessonsLearned,createdAt:M.createdAt,updatedAt:M.updatedAt,version:M.version,progress:M.progress,description:e.target.value}),placeholder:"Descripci\xf3n detallada del proyecto"})]}),(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Objetivo del Proyecto"}),(0,d.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===M||void 0===M?void 0:M.objective)||"",onChange:e=>G("objective",e.target.value),placeholder:"\xbfQu\xe9 se busca lograr con este proyecto?"})]}),(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Caso de Negocio"}),(0,d.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===M||void 0===M?void 0:M.businessCase)||"",onChange:e=>G("businessCase",e.target.value),placeholder:"Justificaci\xf3n del proyecto desde el punto de vista del negocio"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,d.jsx)("button",{onClick:()=>{E(!1),O(null)},className:"px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,d.jsxs)("button",{onClick:()=>{F({});const e={};if((!M.name||M.name.trim().length<3)&&(e.name="El nombre debe tener al menos 3 caracteres"),(!M.manager||M.manager.trim().length<2)&&(e.manager="El manager debe tener al menos 2 caracteres"),(!M.sponsor||M.sponsor.trim().length<2)&&(e.sponsor="El sponsor debe tener al menos 2 caracteres"),M.startDate||(e.startDate="La fecha de inicio es requerida"),M.endDate?M.startDate&&M.endDate<=M.startDate&&(e.endDate="La fecha de fin debe ser posterior a la fecha de inicio"):e.endDate="La fecha de fin es requerida",(!M.budget||M.budget<=0)&&(e.budget="El presupuesto debe ser mayor a 0"),M.irr&&(M.irr<0||M.irr>100)&&(e.irr="La TIR debe estar entre 0% y 100%"),Object.keys(e).length>0)return F(e),void alert("\u274c No se puede guardar el proyecto. Hay ".concat(Object.keys(e).length," errores de validaci\xf3n."));try{M.id?(f(M.id,M),alert("\u2705 Proyecto actualizado exitosamente")):(y(M),alert("\u2705 Proyecto creado exitosamente")),E(!1),O(null),F({})}catch(t){alert("\u274c Error al guardar el proyecto: ".concat(t.message))}},disabled:Object.keys(L).length>0,className:"px-4 py-2 rounded transition-colors ".concat(Object.keys(L).length>0?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:["Guardar Proyecto ",Object.keys(L).length>0&&"(".concat(Object.keys(L).length," errores)")]})]})]})})})]})},u=e=>{let{globalResources:t,setGlobalResources:s}=e;const[r,n]=(0,a.useState)(!1),[l,i]=(0,a.useState)(!1),[o,c]=(0,a.useState)(null),[m,u]=(0,a.useState)(""),[x,g]=(0,a.useState)("all"),[p,h]=(0,a.useState)("all"),[b,v]=(0,a.useState)({name:"",role:"",skills:"",availability:100,hourlyRate:0,status:"active",email:"",phone:"",department:"",experience:"",certifications:"",notes:""}),j=(0,a.useMemo)(()=>t.filter(e=>{const t=!m||e.name.toLowerCase().includes(m.toLowerCase())||e.role.toLowerCase().includes(m.toLowerCase())||e.email&&e.email.toLowerCase().includes(m.toLowerCase()),s="all"===x||e.role===x,a="all"===p||e.status===p;return t&&s&&a}),[t,m,x,p]),y=(0,a.useMemo)(()=>{const e=t.map(e=>e.role);return Array.from(new Set(e))},[t]),f=(0,a.useMemo)(()=>({totalResources:t.length,activeResources:t.filter(e=>"active"===e.status).length,inactiveResources:t.filter(e=>"inactive"===e.status).length,onLeaveResources:t.filter(e=>"on-leave"===e.status).length,totalCost:t.reduce((e,t)=>e+160*t.availability*t.hourlyRate,0)}),[t]),N=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"on-leave":return"bg-yellow-100 text-yellow-800";case"terminated":return"bg-red-100 text-red-800"}},w=e=>{switch(e){case"active":return"\u2705";case"inactive":default:return"\u23f8\ufe0f";case"on-leave":return"\ud83c\udfd6\ufe0f";case"terminated":return"\u274c"}};return(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"flex items-center mb-6",children:[(0,d.jsx)("div",{className:"bg-blue-100 rounded-2xl p-3 mr-4 shadow-sm",children:(0,d.jsx)("span",{className:"text-3xl",children:"\ud83d\udc65"})}),(0,d.jsx)("div",{children:(0,d.jsx)("p",{className:"text-gray-600 text-lg",children:"Gesti\xf3n global de recursos humanos del portafolio"})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,d.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-blue-200 hover:shadow-md transition-all duration-300",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,d.jsx)("span",{className:"text-lg",children:"\ud83d\udc65"}),(0,d.jsx)("span",{className:"text-sm font-medium text-blue-600",children:"Total Recursos"})]}),(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:f.totalResources})]}),(0,d.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-green-200 hover:shadow-md transition-all duration-300",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,d.jsx)("span",{className:"text-lg",children:"\u2705"}),(0,d.jsx)("span",{className:"text-sm font-medium text-green-600",children:"Activos"})]}),(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:f.activeResources})]}),(0,d.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-gray-200 hover:shadow-md transition-all duration-300",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,d.jsx)("span",{className:"text-lg",children:"\u23f8\ufe0f"}),(0,d.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Inactivos"})]}),(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:f.inactiveResources})]}),(0,d.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-yellow-200 hover:shadow-md transition-all duration-300",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,d.jsx)("span",{className:"text-lg",children:"\ud83c\udfd6\ufe0f"}),(0,d.jsx)("span",{className:"text-sm font-medium text-yellow-600",children:"En Licencia"})]}),(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:f.onLeaveResources})]}),(0,d.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-purple-200 hover:shadow-md transition-all duration-300",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,d.jsx)("span",{className:"text-lg",children:"\ud83d\udcb0"}),(0,d.jsx)("span",{className:"text-sm font-medium text-purple-600",children:"Costo Mensual"})]}),(0,d.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",(f.totalCost/1e3).toFixed(0),"K"]})]})]}),(0,d.jsx)("div",{className:"bg-white rounded-xl p-4 border border-blue-200",children:(0,d.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,d.jsx)("input",{type:"text",placeholder:"Buscar recursos...",value:m,onChange:e=>u(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,d.jsxs)("select",{value:x,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,d.jsx)("option",{value:"all",children:"Todos los roles"}),y.map(e=>(0,d.jsx)("option",{value:e,children:e},e))]}),(0,d.jsxs)("select",{value:p,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,d.jsx)("option",{value:"all",children:"Todos los estados"}),(0,d.jsx)("option",{value:"active",children:"Activo"}),(0,d.jsx)("option",{value:"inactive",children:"Inactivo"}),(0,d.jsx)("option",{value:"on-leave",children:"En licencia"}),(0,d.jsx)("option",{value:"terminated",children:"Terminado"})]})]}),(0,d.jsx)("div",{className:"flex space-x-2",children:(0,d.jsxs)("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[(0,d.jsx)("span",{children:"\u2795"}),(0,d.jsx)("span",{children:"Agregar Recurso"})]})})]})}),(0,d.jsx)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200",children:(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,d.jsx)("thead",{className:"bg-gray-50",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Recurso"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rol"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Disponibilidad"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Costo/Hora"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),(0,d.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===j.length?(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:"6",className:"px-6 py-12 text-center text-gray-500",children:(0,d.jsxs)("div",{className:"flex flex-col items-center",children:[(0,d.jsx)("span",{className:"text-4xl mb-2",children:"\ud83d\udc65"}),(0,d.jsx)("p",{className:"text-lg font-medium",children:"No hay recursos registrados"}),(0,d.jsx)("p",{className:"text-sm",children:"Agrega tu primer recurso para comenzar"})]})})}):j.map(e=>(0,d.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,d.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,d.jsx)("span",{className:"text-sm font-medium text-blue-700",children:e.name.split(" ").map(e=>e[0]).join("")})})}),(0,d.jsxs)("div",{className:"ml-4",children:[(0,d.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,d.jsx)("div",{className:"text-sm text-gray-500",children:e.email||"Sin email"})]})]})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:e.role})}),(0,d.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.availability,"%"]}),(0,d.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",e.hourlyRate,"/h"]}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(N(e.status)),children:[w(e.status)," ","active"===e.status?"Activo":"inactive"===e.status?"Inactivo":"on-leave"===e.status?"Licencia":"Terminado"]})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsx)("button",{onClick:()=>(e=>{c(Object.assign({},e,{skills:Array.isArray(e.skills)?e.skills.join(", "):e.skills,certifications:Array.isArray(e.certifications)?e.certifications.join(", "):e.certifications})),i(!0)})(e),className:"text-blue-600 hover:text-blue-900",title:"Editar recurso",children:"\u270f\ufe0f"}),(0,d.jsx)("button",{onClick:()=>{return t=e.id,void(window.confirm("\xbfEst\xe1s seguro de que quieres eliminar este recurso?")&&s(e=>e.filter(e=>e.id!==t)));var t},className:"text-red-600 hover:text-red-900",title:"Eliminar recurso",children:"\ud83d\uddd1\ufe0f"})]})})]},e.id))})]})})}),r&&(0,d.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,d.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,d.jsxs)("div",{className:"mt-3",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Agregar Nuevo Recurso"}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nombre *"}),(0,d.jsx)("input",{type:"text",value:b.name,onChange:e=>v({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,name:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nombre completo"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Rol *"}),(0,d.jsx)("input",{type:"text",value:b.role,onChange:e=>v({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,role:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Project Manager, Desarrollador, etc."})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,d.jsx)("input",{type:"email",value:b.email,onChange:e=>v({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,email:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"email@empresa.com"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Habilidades (separadas por comas)"}),(0,d.jsx)("input",{type:"text",value:b.skills,onChange:e=>v({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,skills:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"React, JavaScript, PMBOK, etc."})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Disponibilidad (%)"}),(0,d.jsx)("input",{type:"number",min:"0",max:"100",value:b.availability,onChange:e=>v({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,availability:Number(e.target.value)}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Costo por Hora ($)"}),(0,d.jsx)("input",{type:"number",min:"0",value:b.hourlyRate,onChange:e=>v({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,hourlyRate:Number(e.target.value)}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),(0,d.jsxs)("select",{value:b.status,onChange:e=>v({id:b.id,name:b.name,role:b.role,email:b.email,skills:b.skills,availability:b.availability,hourlyRate:b.hourlyRate,status:b.status,projectId:b.projectId,status:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,d.jsx)("option",{value:"active",children:"Activo"}),(0,d.jsx)("option",{value:"inactive",children:"Inactivo"}),(0,d.jsx)("option",{value:"on-leave",children:"En licencia"}),(0,d.jsx)("option",{value:"terminated",children:"Terminado"})]})]})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,d.jsx)("button",{onClick:()=>n(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors",children:"Cancelar"}),(0,d.jsx)("button",{onClick:()=>{if(!b.name||!b.role)return;const e={id:"res-"+String(Date.now()).slice(-6),name:b.name,role:b.role,skills:b.skills.split(",").map(e=>e.trim()).filter(e=>e),experience:b.experience,certifications:b.certifications?b.certifications.split(",").map(e=>e.trim()).filter(e=>e):[],notes:b.notes};console.log("\u2795 Agregando nuevo recurso:",e),console.log("\u2795 Recursos actuales antes de agregar:",t),s(t=>{const s=t.slice();return s.push(e),console.log("\u2795 Nuevos recursos despu\xe9s de agregar:",s),s}),n(!1),v({name:"",role:"",skills:"",availability:100,hourlyRate:0,status:"active",email:"",phone:"",department:"",experience:"",certifications:"",notes:""})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Agregar"})]})]})})}),l&&o&&(0,d.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,d.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,d.jsxs)("div",{className:"mt-3",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Editar Recurso"}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nombre *"}),(0,d.jsx)("input",{type:"text",value:o.name,onChange:e=>c({id:o.id,name:o.name,role:o.role,email:o.email,skills:o.skills,availability:o.availability,hourlyRate:o.hourlyRate,status:o.status,projectId:o.projectId,name:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Rol *"}),(0,d.jsx)("input",{type:"text",value:o.role,onChange:e=>c({id:o.id,name:o.name,role:o.role,email:o.email,skills:o.skills,availability:o.availability,hourlyRate:o.hourlyRate,status:o.status,projectId:o.projectId,role:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,d.jsx)("input",{type:"email",value:o.email,onChange:e=>c({id:o.id,name:o.name,role:o.role,email:o.email,skills:o.skills,availability:o.availability,hourlyRate:o.hourlyRate,status:o.status,projectId:o.projectId,email:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Habilidades (separadas por comas)"}),(0,d.jsx)("input",{type:"text",value:o.skills,onChange:e=>c({id:o.id,name:o.name,role:o.role,email:o.email,skills:o.skills,availability:o.availability,hourlyRate:o.hourlyRate,status:o.status,projectId:o.projectId,skills:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Disponibilidad (%)"}),(0,d.jsx)("input",{type:"number",min:"0",max:"100",value:o.availability,onChange:e=>c({id:o.id,name:o.name,role:o.role,email:o.email,skills:o.skills,availability:o.availability,hourlyRate:o.hourlyRate,status:o.status,projectId:o.projectId,availability:Number(e.target.value)}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Costo por Hora ($)"}),(0,d.jsx)("input",{type:"number",min:"0",value:o.hourlyRate,onChange:e=>c({id:o.id,name:o.name,role:o.role,email:o.email,skills:o.skills,availability:o.availability,hourlyRate:o.hourlyRate,status:o.status,projectId:o.projectId,hourlyRate:Number(e.target.value)}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),(0,d.jsxs)("select",{value:o.status,onChange:e=>c({id:o.id,name:o.name,role:o.role,email:o.email,skills:o.skills,availability:o.availability,hourlyRate:o.hourlyRate,status:o.status,projectId:o.projectId,status:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,d.jsx)("option",{value:"active",children:"Activo"}),(0,d.jsx)("option",{value:"inactive",children:"Inactivo"}),(0,d.jsx)("option",{value:"on-leave",children:"En licencia"}),(0,d.jsx)("option",{value:"terminated",children:"Terminado"})]})]})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,d.jsx)("button",{onClick:()=>{i(!1),c(null)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors",children:"Cancelar"}),(0,d.jsx)("button",{onClick:()=>{o&&(s(e=>e.map(e=>e.id===o.id?Object.assign({},e,{name:o.name,role:o.role,skills:o.skills.split(",").map(e=>e.trim()).filter(e=>e),availability:o.availability,hourlyRate:o.hourlyRate,status:o.status,email:o.email||e.email,phone:o.phone||e.phone,department:o.department||e.department,experience:o.experience||e.experience,certifications:o.certifications?o.certifications.split(",").map(e=>e.trim()).filter(e=>e):e.certifications,notes:o.notes||e.notes}):e)),i(!1),c(null))},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Guardar Cambios"})]})]})})})]})};s(8449);var x=s(9201),g=s(7255),p=s(6890),h=s(5833),b=s(7737),v=s(2828),j=s(7637),y=s(5612);const f=function(){false},N=e=>{if(!(e=>{if(!e)return!1;const t=new Date(e);return!isNaN(t.getTime())&&t.getFullYear()>1900})(e))return null;const t=new Date(e);return t.setHours(0,0,0,0),t},w=e=>{const t=new Date(e),s=t.getDay(),a=t.getDate()-s+(0===s?-6:1);return t.setDate(a),t.setHours(0,0,0,0),t},k=e=>{const t=new Date(e),s=t.getDay(),a=t.getDate()-s+(0===s?-6:1)+6;return t.setDate(a),t.setHours(0,0,0,0),t},D=e=>e?new Date(e).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A",A=function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){const t=(e.estatus||"").toLowerCase().trim();return"completado"===t||"completada"===t}return 100===e.progress},P=function(e){return!A(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1])},C=a.memo(e=>{let{project:t,currentTasks:s,overdueTasks:n}=e;const l=(0,a.useMemo)(()=>[...n.scheduleTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Cronograma",isOverdue:!0})),...n.minuteTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Minuta",name:e.tarea,description:e.responsable,endDate:e.fecha,isOverdue:!0})),...s.scheduleTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Cronograma",isOverdue:!1})),...s.minuteTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Minuta",name:e.tarea,description:e.responsable,endDate:e.fecha,isOverdue:!1}))],[s,n]);if(0===l.length)return(0,d.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,d.jsx)(j.A,{className:"mx-auto h-12 w-12 text-gray-300 mb-4"}),(0,d.jsx)("p",{children:"No hay tareas para este proyecto en el per\xedodo seleccionado."})]});const i=l.filter(e=>e.isOverdue),o=l.filter(e=>!e.isOverdue);return(0,d.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,d.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:(0,d.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,d.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-3"}),t.name,(0,d.jsxs)("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",l.length," tareas)"]})]})}),(0,d.jsxs)("div",{className:"divide-y divide-gray-200",children:[i.length>0&&(0,d.jsxs)("div",{className:"p-6 bg-red-50",children:[(0,d.jsxs)("h5",{className:"text-md font-semibold text-red-800 mb-4 flex items-center",children:[(0,d.jsx)(v.A,{className:"w-4 h-4 mr-2"}),"Tareas Vencidas (",i.length,")"]}),(0,d.jsx)("div",{className:"space-y-3",children:i.map((e,t)=>(0,d.jsx)(S,{task:e,isOverdue:!0},"overdue-".concat(t)))})]}),o.length>0&&(0,d.jsxs)("div",{className:"p-6",children:[(0,d.jsxs)("h5",{className:"text-md font-semibold text-blue-800 mb-4 flex items-center",children:[(0,d.jsx)(b.A,{className:"w-4 h-4 mr-2"}),"Tareas de la Semana (",o.length,")"]}),(0,d.jsx)("div",{className:"space-y-3",children:o.map((e,t)=>(0,d.jsx)(S,{task:e,isOverdue:!1},"current-".concat(t)))})]})]})]})}),S=a.memo(e=>{let{task:t,isOverdue:s}=e;return(0,d.jsx)("div",{className:"bg-white p-4 rounded-lg border ".concat(s?"border-red-200":"border-gray-200 hover:border-blue-300"," transition-colors"),children:(0,d.jsxs)("div",{className:"flex items-start justify-between",children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("h6",{className:"font-medium text-gray-900 mb-1",children:t.name}),t.description&&(0,d.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:t.description}),(0,d.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,d.jsxs)("span",{className:"flex items-center",children:[(0,d.jsx)(x.A,{className:"w-3 h-3 mr-1"}),"Vence: ",D(t.endDate)]}),(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("Cronograma"===t.type?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:t.type}),t.priority&&(0,d.jsx)("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs",children:t.priority})]})]}),(0,d.jsx)("span",{className:"px-2 py-1 text-xs rounded-full font-medium ".concat(s?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:s?"Vencida":"Pendiente"})]})})});C.displayName="ProjectTasksList",S.displayName="TaskCard";const I=e=>{let{projects:t,tasksByProject:n,minutasByProject:l,weeklyPlanningData:i,setWeeklyPlanningData:o,useSupabase:c=!1}=e;const[m,u]=(0,a.useState)((null===i||void 0===i?void 0:i.dateRange)||{start:w(new Date),end:k(new Date)}),[S,I]=(0,a.useState)(null),[T,R]=(0,a.useState)(!1),[E,M]=(0,a.useState)({}),[O,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=e=>{const{tareaId:t,newStatus:s,projectId:a,timestamp:r}=e.detail;console.log("\ud83d\udd04 WeeklyPlanningTab: Evento minutaStatusChanged recibido:",{tareaId:t,newStatus:s,projectId:a,timestamp:r}),console.log("\ud83d\udd04 WeeklyPlanningTab: Forzando re-render de tareas de minutas...")};return window.addEventListener("minutaStatusChanged",e),()=>{window.removeEventListener("minutaStatusChanged",e)}},[]);const F=(0,a.useMemo)(()=>{const e=t.filter(e=>"active"===e.status);return f("\ud83c\udfe2 PROYECTOS ACTIVOS:",{total:t.length,active:e.length,projects:e.map(e=>({id:e.id,name:e.name}))}),f("\ud83d\udcca ESTRUCTURA DE DATOS:",{tasksByProjectKeys:Object.keys(n||{}),minutasByProjectKeys:Object.keys(E||{}),tasksByProject:n,localMinutaTasks:E}),e},[t,n,E]),B=(0,a.useMemo)(()=>{const e=new Date(m.start);e.setDate(e.getDate()-7);const t=new Date(m.end);return t.setDate(t.getDate()-7),{start:e,end:t}},[m]),z=(0,a.useMemo)(()=>{const e=new Date;return e.setHours(0,0,0,0),e},[]),q=(0,a.useCallback)(function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e.filter(e=>{const r=N(a?e.fecha:e.endDate||e.startDate);return r?r>=t&&r<=s:(f("\u26a0\ufe0f Fecha inv\xe1lida en tarea:",e.name||e.tarea),!1)})},[]),_=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.filter(e=>{const s=N(t?e.fecha:e.endDate||e.startDate);if(!s)return f("\u26a0\ufe0f Fecha inv\xe1lida en tarea vencida:",e.name||e.tarea),!1;const a=P(e,t);return s<z&&a})},[z]),W=(0,a.useCallback)(e=>{const t=n[e]||[],s=E[e]||[];f("\ud83d\udcc5 getCurrentWeekTasks:",{projectId:e,totalScheduleTasks:t.length,totalMinuteTasks:s.length,dateRange:{start:m.start.toISOString().split("T")[0],end:m.end.toISOString().split("T")[0]}}),t.length>0&&f("\ud83d\udccb Tareas de cronograma del proyecto:",t.map(e=>({id:e.id,name:e.name,endDate:e.endDate,progress:e.progress}))),s.length>0&&f("\ud83d\udccb Tareas de minutas del proyecto:",s.map(e=>({id:e.id,tarea:e.tarea,fecha:e.fecha,estatus:e.estatus})));const a=q(t,m.start,m.end).filter(e=>P(e,!1)),r=q(s,m.start,m.end,!0).filter(e=>P(e,!0));return f("\u2705 Tareas de semana actual:",{projectId:e,scheduleTasks:a.length,minuteTasks:r.length,totalFiltered:a.length+r.length}),{scheduleTasks:a,minuteTasks:r}},[n,E,m,q]),V=(0,a.useCallback)(e=>{const t=n[e]||[],s=E[e]||[];f("\ud83d\udd0d getOverdueTasks:",{projectId:e,today:z.toISOString().split("T")[0]});const a=_(t,!1),r=_(s,!0);return f("\u2705 Tareas vencidas:",{projectId:e,scheduleTasks:a.length,minuteTasks:r.length}),{scheduleTasks:a,minuteTasks:r}},[n,E,z,_]),G=(0,a.useCallback)(async()=>{const e={totalTasks:0,completedTasks:0,pendingTasks:0,overdueTasks:0,byProject:{}};for(const t of F){const s=n[t.id]||[],a=E[t.id]||[],r=q(s,B.start,B.end),l=q(a,B.start,B.end,!0),i=[...r,...l],o=i.filter((e,t)=>A(e,t>=r.length)).length,d=i.filter((e,t)=>P(e,t>=r.length)).length,c=i.filter((e,t)=>{const s=t>=r.length;return N(s?e.fecha:e.endDate||e.startDate)<z&&P(e,s)}).length;e.byProject[t.id]={projectName:t.name,total:i.length,completed:o,pending:d,overdue:c},e.totalTasks+=i.length,e.completedTasks+=o,e.pendingTasks+=d,e.overdueTasks+=c}return e},[F,n,E,B,z,q]),U=(0,a.useCallback)(async()=>{R(!0);try{const e=await G();I(e)}catch(e){console.error("Error cargando datos de la semana pasada:",e)}finally{R(!1)}},[G]);(0,a.useEffect)(()=>{U()},[U]),(0,a.useEffect)(()=>{o&&o({dateRange:m,previousWeekData:S})},[m,S,o]),(0,a.useEffect)(()=>{(async()=>{if(t&&0!==t.length){L(!0);try{f("\ud83d\udd0d WeeklyPlanningTab - Iniciando carga independiente de minutas para todos los proyectos activos");const t={};for(const r of F)try{if(c){f("\ud83d\udd0d Cargando minutas desde Supabase para proyecto: ".concat(r.id));const{default:e}=await Promise.resolve().then(s.bind(s,9874)),{success:a,minutas:n}=await e.loadMinutasByProject(r.id);a?(t[r.id]=n||[],f("\u2705 Minutas cargadas desde Supabase para ".concat(r.name,": ").concat((null===n||void 0===n?void 0:n.length)||0))):(f("\u26a0\ufe0f Error cargando minutas desde Supabase para ".concat(r.name)),t[r.id]=[])}else{var e;const s=(null===(e=JSON.parse(localStorage.getItem("portfolioData")||"{}").minutasByProject)||void 0===e?void 0:e[r.id])||[];t[r.id]=s,f("\u2705 Minutas cargadas desde localStorage para ".concat(r.name,": ").concat(s.length))}}catch(a){console.error("\u274c Error cargando minutas para proyecto ".concat(r.name,":"),a),t[r.id]=[]}M(t),f("\u2705 WeeklyPlanningTab - Carga independiente de minutas completada:",{totalProjects:F.length,minutasByProject:Object.keys(t).reduce((e,s)=>(e[s]=t[s].length,e),{})})}catch(a){console.error("\u274c Error general cargando minutas en WeeklyPlanningTab:",a),M({})}finally{L(!1)}}})()},[t,F,c]);const $=()=>S&&0!==S.totalTasks?Math.round(S.completedTasks/S.totalTasks*100):0,H=(0,a.useCallback)(()=>{try{const e=new y.uE,t=e.internal.pageSize.getWidth(),s=e.internal.pageSize.getHeight();let a=20;e.setFontSize(20),e.setFont(void 0,"bold"),e.text("Planificaci\xf3n Semanal",t/2,a,{align:"center"}),a+=10,e.setFontSize(12),e.setFont(void 0,"normal"),e.text("Per\xedodo: ".concat(D(m.start)," - ").concat(D(m.end)),t/2,a,{align:"center"}),a+=20,S&&(e.setFontSize(14),e.setFont(void 0,"bold"),e.text("Resumen Semana Pasada",20,a),a+=10,e.setFontSize(10),e.setFont(void 0,"normal"),e.text("Tareas Completadas: ".concat(S.completedTasks),20,a),a+=5,e.text("Tareas Pendientes: ".concat(S.pendingTasks),20,a),a+=5,e.text("Tareas Vencidas: ".concat(S.overdueTasks),20,a),a+=5,e.text("Cumplimiento: ".concat($(),"%"),20,a),a+=15),e.setFontSize(14),e.setFont(void 0,"bold"),e.text("Tareas de la Semana Actual",20,a),a+=15,F.forEach(t=>{const n=W(t.id),l=V(t.id),i=[...l.scheduleTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Cronograma",isOverdue:!0})),...l.minuteTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Minuta",name:e.tarea,description:e.responsable,endDate:e.fecha,isOverdue:!0})),...n.scheduleTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Cronograma",isOverdue:!1})),...n.minuteTasks.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"Minuta",name:e.tarea,description:e.responsable,endDate:e.fecha,isOverdue:!1}))];if(0===i.length)return;a>s-60&&(e.addPage(),a=20),e.setFontSize(12),e.setFont(void 0,"bold"),e.text("".concat(t.name),20,a),a+=8;const o=i.filter(e=>e.isOverdue);o.length>0&&(e.setFontSize(10),e.setFont(void 0,"bold"),e.setTextColor(220,38,38),e.text("Tareas Vencidas:",25,a),a+=6,o.forEach(t=>{a>s-20&&(e.addPage(),a=20),e.setFontSize(9),e.setFont(void 0,"normal"),e.setTextColor(0,0,0),e.text("\u2022 ".concat(t.name," (").concat(t.type,")"),30,a),a+=4,e.text("  Vence: ".concat(D(t.endDate)),30,a),a+=4}),a+=5);const d=i.filter(e=>!e.isOverdue);d.length>0&&(e.setFontSize(10),e.setFont(void 0,"bold"),e.setTextColor(59,130,246),e.text("Tareas de la Semana:",25,a),a+=6,d.forEach(t=>{a>s-20&&(e.addPage(),a=20),e.setFontSize(9),e.setFont(void 0,"normal"),e.setTextColor(0,0,0),e.text("\u2022 ".concat(t.name," (").concat(t.type,")"),30,a),a+=4,e.text("  Vence: ".concat(D(t.endDate)),30,a),t.description&&(a+=4,e.text("  Responsable: ".concat(t.description),30,a)),a+=4})),a+=10});const n="Planificacion_Semanal_".concat(D(m.start).replace(/\//g,"-"),"_").concat(D(m.end).replace(/\//g,"-"),".pdf");e.save(n)}catch(e){console.error("Error al exportar PDF:",e),alert("Error al generar el PDF. Por favor intenta de nuevo.")}},[m,S,F,W,V]);return(0,d.jsxs)("div",{className:"weekly-planning-tab bg-gray-50 min-h-screen p-6",children:[(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:(0,d.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,d.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,d.jsx)(x.A,{className:"mr-3 h-8 w-8 text-blue-600"}),"Planificaci\xf3n Semanal"]}),(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Desde:"}),(0,d.jsx)("input",{type:"date",value:m.start.toISOString().split("T")[0],onChange:e=>u(t=>(0,r.A)((0,r.A)({},t),{},{start:new Date(e.target.value)})),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Hasta:"}),(0,d.jsx)("input",{type:"date",value:m.end.toISOString().split("T")[0],onChange:e=>u(t=>(0,r.A)((0,r.A)({},t),{},{end:new Date(e.target.value)})),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,d.jsxs)("button",{onClick:H,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,d.jsx)(g.A,{className:"w-4 h-4"}),"Exportar PDF"]})]})]})}),S&&!T&&(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,d.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,d.jsx)(p.A,{className:"mr-2 h-5 w-5 text-green-600"}),"Cumplimiento Semana Pasada (",D(B.start)," - ",D(B.end),")"]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,d.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)(h.A,{className:"h-8 w-8 text-green-600 mr-3"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-medium text-green-800",children:"Completadas"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-green-900",children:S.completedTasks})]})]})}),(0,d.jsx)("div",{className:"bg-orange-50 p-4 rounded-lg",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)(b.A,{className:"h-8 w-8 text-orange-600 mr-3"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-medium text-orange-800",children:"Pendientes"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-orange-900",children:S.pendingTasks})]})]})}),(0,d.jsx)("div",{className:"bg-red-50 p-4 rounded-lg",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)(v.A,{className:"h-8 w-8 text-red-600 mr-3"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-medium text-red-800",children:"Vencidas"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-red-900",children:S.overdueTasks})]})]})}),(0,d.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)(p.A,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-medium text-blue-800",children:"Cumplimiento"}),(0,d.jsxs)("p",{className:"text-2xl font-bold text-blue-900",children:[$(),"%"]})]})]})})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("h4",{className:"font-medium text-gray-900",children:"Detalle por Proyecto:"}),Object.values(S.byProject).map((e,t)=>(0,d.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,d.jsx)("span",{className:"font-medium text-gray-900",children:e.projectName}),(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsxs)("span",{className:"text-sm text-green-600",children:["\u2713 ",e.completed]}),(0,d.jsxs)("span",{className:"text-sm text-orange-600",children:["\u23f1 ",e.pending]}),(0,d.jsxs)("span",{className:"text-sm text-red-600",children:["\u26a0 ",e.overdue]}),(0,d.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[e.total>0?Math.round(e.completed/e.total*100):0,"%"]})]})]},t))]})]}),(0,d.jsx)("div",{className:"space-y-6",children:(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,d.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[(0,d.jsx)(j.A,{className:"mr-2 h-6 w-6 text-blue-600"}),"Tareas de la Semana Actual",(0,d.jsxs)("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",D(m.start)," - ",D(m.end),")"]})]}),(0,d.jsx)("div",{className:"space-y-6",children:F.map(e=>{const t=W(e.id),s=V(e.id);return 0===t.scheduleTasks.length+t.minuteTasks.length+s.scheduleTasks.length+s.minuteTasks.length?null:(0,d.jsx)(C,{project:e,currentTasks:t,overdueTasks:s},e.id)})})]})})]})};var T=s(9874),R=s(2367);const E=()=>{const[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(0),[l,i]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null),c=(0,a.useRef)(!1),m=(0,a.useRef)(null),u=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(c.current&&!e)return;const s=Date.now();if(!(!e&&m.current&&s-m.current<5e3))try{c.current=!0,i(!0);const e=T.default.getCurrentUser();if(!e||!e.email)return t([]),void n(0);const a=e.email,r=await(0,R.AX)(a),l=await(0,R.$M)(a);t(r),n(l),d(null),m.current=s}catch(o){console.error("Error cargando notificaciones:",o),d("Error cargando notificaciones")}finally{i(!1),c.current=!1}},[]),x=(0,a.useCallback)(async e=>{try{const s=await(0,R.aI)(e);return s.success&&(t(t=>t.filter(t=>t.id!==e)),n(e=>Math.max(0,e-1))),s}catch(o){return console.error("Error marcando notificaci\xf3n:",o),{success:!1,error:o}}},[]),g=(0,a.useCallback)(async()=>{try{const e=T.default.getCurrentUser();if(!e||!e.email)return{success:!1};const s=await(0,R.X0)(e.email);return s.success&&(t([]),n(0)),s}catch(o){return console.error("Error marcando todas como le\xeddas:",o),{success:!1,error:o}}},[]),p=(0,a.useCallback)(()=>{u(!0)},[u]);return(0,a.useEffect)(()=>{u()},[]),(0,a.useEffect)(()=>{const e=setInterval(()=>{u()},3e4);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{const e=setInterval(()=>{var e;const t=T.default.getCurrentUser(),s=null===t||void 0===t?void 0:t.email;s!==(null===(e=m.current)||void 0===e?void 0:e.email)&&(m.current=(0,r.A)((0,r.A)({},m.current),{},{email:s}),u(!0))},5e3);return()=>clearInterval(e)},[]),{notifications:e,unreadCount:s,loading:l,error:o,markAsRead:x,markAllAsRead:g,refresh:p}},M=e=>{let{notification:t,onMarkAsRead:s,onClose:a}=e;return(0,d.jsx)("div",{onClick:async()=>{await s(t.id),t.action_url&&(a&&a(),window.location.href=t.action_url)},className:"p-4 border rounded-lg cursor-pointer transition-all hover:shadow-md ".concat((e=>{switch(e){case"urgent":return"bg-red-50 border-red-200";case"high":return"bg-orange-50 border-orange-200";case"normal":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}})(t.priority)),children:(0,d.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,d.jsx)("div",{className:"text-2xl flex-shrink-0",children:(e=>{switch(e){case"assigned":return"\ud83d\udccb";case"approval_required":return"\u2705";case"ccb_vote_required":return"\ud83d\uddf3\ufe0f";case"status_changed":return"\ud83d\udd04";case"comment_added":return"\ud83d\udcac";case"implemented":return"\ud83d\ude80";default:return"\ud83d\udd14"}})(t.notification_type)}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,d.jsx)("h4",{className:"font-semibold text-gray-800 text-sm truncate",children:t.title}),"urgent"===t.priority&&(0,d.jsx)("span",{className:"ml-2 px-2 py-0.5 bg-red-100 text-red-800 text-xs rounded-full flex-shrink-0",children:"Urgente"})]}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:t.message}),(0,d.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,d.jsx)("span",{children:(e=>{const t=new Date-new Date(e),s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);return s<1?"Hace un momento":s<60?"Hace ".concat(s," min"):a<24?"Hace ".concat(a,"h"):"Hace ".concat(r," d\xeda").concat(r>1?"s":"")})(t.created_at)}),t.change_number&&(0,d.jsx)("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:t.change_number})]})]})]})})},O=e=>{let{isOpen:t,onClose:s,notifications:a,unreadCount:r,loading:n,onMarkAsRead:l,onMarkAllAsRead:i}=e;if(!t)return null;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"fixed inset-0 z-40",onClick:e=>{e.target===e.currentTarget&&s()}}),(0,d.jsxs)("div",{className:"fixed right-4 top-20 w-96 max-w-full bg-white rounded-lg shadow-2xl border border-gray-200 z-[9999] max-h-[600px] flex flex-col",children:[(0,d.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-blue-50 to-indigo-50",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("span",{className:"text-xl",children:"\ud83d\udd14"}),(0,d.jsx)("h3",{className:"font-bold text-gray-800",children:"Notificaciones"}),r>0&&(0,d.jsx)("span",{className:"bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full",children:r})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[r>0&&(0,d.jsx)("button",{onClick:i,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Marcar todas"}),(0,d.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:"\u2715"})]})]}),(0,d.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:n&&0===a.length?(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,d.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent mb-4"}),(0,d.jsx)("p",{className:"text-gray-500 text-sm",children:"Cargando notificaciones..."})]}):0===a.length?(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,d.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udced"}),(0,d.jsx)("p",{className:"text-gray-600 font-medium mb-1",children:"No hay notificaciones"}),(0,d.jsx)("p",{className:"text-gray-500 text-sm",children:"Est\xe1s al d\xeda con todo"})]}):(0,d.jsx)("div",{className:"space-y-3",children:a.map(e=>(0,d.jsx)(M,{notification:e,onMarkAsRead:l,onClose:s},e.id))})}),a.length>0&&(0,d.jsx)("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:(0,d.jsx)("button",{onClick:s,className:"w-full text-center text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Ver todas las notificaciones"})})]})]})},L=e=>{let{className:t=""}=e;const[s,r]=(0,a.useState)(!1),{notifications:n,unreadCount:l,loading:i,error:o,markAsRead:c,markAllAsRead:m,refresh:u}=E();return(0,d.jsxs)("div",{className:"relative ".concat(t),children:[(0,d.jsxs)("button",{onClick:()=>{r(!s),s||u()},className:"relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Notificaciones",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\ud83d\udd14"}),l>0&&(0,d.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 shadow-lg animate-pulse",children:l>99?"99+":l}),i&&(0,d.jsx)("span",{className:"absolute -bottom-1 -right-1 bg-blue-500 rounded-full w-2 h-2 animate-pulse"})]}),(0,d.jsx)(O,{isOpen:s,onClose:()=>r(!1),notifications:n,unreadCount:l,loading:i,onMarkAsRead:c,onMarkAllAsRead:m}),o&&(0,d.jsx)("div",{className:"absolute top-full right-0 mt-2 bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg text-sm shadow-lg",children:o})]})},F=e=>{let{error:t}=e;return t?(0,d.jsxs)("div",{className:"text-red-600 text-xs mt-1 flex items-center",children:[(0,d.jsx)("span",{className:"mr-1",children:"\u26a0\ufe0f"}),t]}):null},B=e=>{const t=new Date(e),s=t.getDay(),a=t.getDate()-s+(0===s?-6:1);return t.setDate(a),t.setHours(0,0,0,0),t},z=e=>{const t=new Date(e),s=t.getDay(),a=t.getDate()-s+(0===s?-6:1)+6;return t.setDate(a),t.setHours(23,59,59,999),t},q=e=>{let{projects:t,setProjects:s,currentProjectId:r,setCurrentProjectId:n,portfolioMetrics:l,workPackages:i,risks:o,globalResources:c,setGlobalResources:x,createProject:g,updateProject:p,deleteProject:h,duplicateProject:b,tasks:v,tasksByProject:j,minutasByProject:y,purchaseOrders:f,advances:N,invoices:w,contracts:k,auditLogs:D,includeWeekendsByProject:A,setIncludeWeekendsByProject:P,getCurrentProjectIncludeWeekends:C,useSupabase:S}=e;const[T,R]=(0,a.useState)(!1),[E,M]=(0,a.useState)(null),[O,q]=(0,a.useState)("overview"),[_,W]=(0,a.useState)({}),[V,G]=(0,a.useState)("all"),[U,$]=(0,a.useState)([]),[H,K]=(0,a.useState)(null),[J,Y]=(0,a.useState)(!1),[X,Q]=(0,a.useState)({dateRange:{start:B(new Date),end:z(new Date)},previousWeekCompliance:null,projectTasks:{}});a.useEffect(()=>{Object.keys(_).length>0&&console.log("\u274c Errores de validaci\xf3n:",_)},[_]),(0,a.useEffect)(()=>{const e=e=>{const{tareaId:t,newStatus:s,projectId:a,timestamp:r}=e.detail;console.log("\ud83d\udd04 PortfolioStrategic: Evento minutaStatusChanged recibido:",{tareaId:t,newStatus:s,projectId:a,timestamp:r}),console.log("\ud83d\udd04 PortfolioStrategic: Forzando re-render del Dashboard resumen...")};return window.addEventListener("minutaStatusChanged",e),()=>{window.removeEventListener("minutaStatusChanged",e)}},[]);const Z=t.find(e=>e.id===r),ee=e=>{const t=[];console.log("\ud83d\udd0d VALIDANDO ARCHIVADO para proyecto:",e.name),console.log("\ud83d\udcca Progreso del proyecto:",e.progress),console.log("\ud83d\udccb Total de tareas disponibles:",v.length),e.progress<100&&t.push("El proyecto debe estar 100% completado (actual: ".concat(e.progress,"%)"));const s=v.filter(t=>t.workPackageId===e.id||t.projectId===e.id);console.log("\ud83d\udccb Tareas del proyecto:",s.length);const a=s.filter(e=>e.progress<100&&"completed"!==e.status);console.log("\u274c Tareas incompletas:",a.length),a.length>0&&t.push("Todas las tareas deben estar completadas (".concat(a.length," tareas pendientes)"));s.filter(e=>e.predecessors&&e.predecessors.length>0).filter(e=>e.predecessors.map(e=>s.find(t=>t.id===e)).filter(Boolean).some(e=>e.progress<100)).length>0&&t.push("No debe haber dependencias activas con tareas incompletas");const r=[],n=["Acta de Inicio","Cronograma","Presupuesto","Acta de Cierre"].filter(e=>!r.some(t=>t.name.includes(e)));n.length>0&&t.push("Documentaci\xf3n incompleta: ".concat(n.join(", ")));const l=f.filter(t=>t.projectId===e.id||t.workPackageId===e.id),i=w.filter(t=>t.projectId===e.id||t.workPackageId===e.id),o=k.filter(t=>t.projectId===e.id||t.workPackageId===e.id),d=[];return l.some(e=>"pending"===e.status)&&d.push("\xd3rdenes de compra pendientes"),i.some(e=>"pending"===e.status)&&d.push("Facturas pendientes"),o.some(e=>"pending"===e.status)&&d.push("Contratos pendientes"),d.length>0&&t.push("Aprobaciones pendientes: ".concat(d.join(", "))),console.log("\u2705 Validaciones encontradas:",t),console.log("\ud83c\udfaf Puede archivar:",0===t.length),{canArchive:0===t.length,validations:t}},te=()=>{K(null),Y(!1)},se=e=>{switch(e){case"active":return"bg-green-100 text-green-800 border-green-200";case"inactive":return"bg-gray-100 text-gray-600 border-gray-300";case"completed":return"bg-blue-100 text-blue-800 border-blue-200";case"on-hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"archived":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},ae=e=>{switch(e){case"active":return"\ud83d\udfe2";case"inactive":return"\u26ab";case"completed":return"\u2705";case"on-hold":default:return"\u23f8\ufe0f";case"cancelled":return"\u274c";case"archived":return"\ud83d\udcc1"}},re=(e,t)=>{const s=Object.assign({},_);switch(e){case"name":t&&""!==t.trim()?t.length<3?s.name="El nombre debe tener al menos 3 caracteres":delete s.name:s.name="El nombre del proyecto es obligatorio";break;case"manager":t&&""!==t.trim()?delete s.manager:s.manager="El manager es obligatorio";break;case"sponsor":t&&""!==t.trim()?delete s.sponsor:s.sponsor="El sponsor es obligatorio";break;case"startDate":t?delete s.startDate:s.startDate="La fecha de inicio es obligatoria";break;case"endDate":t?null!==E&&void 0!==E&&E.startDate&&new Date(t)<=new Date(E.startDate)?s.endDate="La fecha de fin debe ser posterior a la fecha de inicio":delete s.endDate:s.endDate="La fecha de fin es obligatoria";break;case"budget":""===t||isNaN(t)?s.budget="El presupuesto debe ser un n\xfamero v\xe1lido":!t||t<=0?s.budget="El presupuesto debe ser mayor a 0":t>1e9?s.budget="El presupuesto no puede exceder 1,000,000,000":delete s.budget;break;case"irr":""===t||isNaN(t)?s.irr="La TIR debe ser un n\xfamero v\xe1lido":t<0||t>100?s.irr="La TIR debe estar entre 0% y 100%":delete s.irr}return W(s),0===Object.keys(s).length};return(0,d.jsxs)("div",{className:"space-y-6 max-w-full overflow-hidden",children:[(0,d.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-100 rounded-2xl shadow-lg p-6 text-gray-800 relative overflow-hidden",children:[(0,d.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,d.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-indigo-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,d.jsx)("div",{className:"relative z-10",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,d.jsx)("span",{className:"text-3xl",children:"\ud83c\udfe2"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gray-800",children:"Portafolio de Proyectos"}),(0,d.jsx)("p",{className:"text-gray-600 text-lg",children:"Gesti\xf3n estrat\xe9gica y configuraci\xf3n de proyectos"})]})]}),(0,d.jsx)("div",{className:"flex items-center",children:(0,d.jsx)(L,{})})]})})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,d.jsx)("div",{className:"border-b border-gray-200",children:(0,d.jsx)("nav",{className:"flex space-x-8 px-6",children:[{id:"overview",name:"Vista General",icon:"\ud83d\udcca"},{id:"projects",name:"Lista de Proyectos",icon:"\ud83d\udccb"},{id:"resources",name:"Lista de Recursos",icon:"\ud83d\udc65"},{id:"weekly-planning",name:"Planificaci\xf3n Semanal",icon:"\ud83d\udcc5"},{id:"archive",name:"Archivado de Proyectos",icon:"\ud83d\udcc1"},{id:"metrics",name:"M\xe9tricas del Portfolio",icon:"\ud83d\udcc8"}].map(e=>(0,d.jsxs)("button",{onClick:()=>q(e.id),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ".concat(O===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,d.jsx)("span",{children:e.icon}),(0,d.jsx)("span",{children:e.name})]},e.id))})}),(0,d.jsxs)("div",{className:"p-6",children:["overview"===O&&(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,d.jsxs)("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\ud83d\udcca"}),(0,d.jsx)("h3",{className:"text-lg font-semibold text-blue-800",children:"Total Proyectos"})]}),(0,d.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:t.length}),(0,d.jsxs)("div",{className:"text-sm text-blue-600",children:[t.filter(e=>"active"===e.status).length," activos"]})]}),(0,d.jsxs)("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"}),(0,d.jsx)("h3",{className:"text-lg font-semibold text-green-800",children:"Presupuesto Total"})]}),(0,d.jsxs)("div",{className:"text-3xl font-bold text-green-600 mb-2",children:["$",(t.filter(e=>"active"===e.status).reduce((e,t)=>e+t.budget,0)/1e3).toFixed(0),"K USD"]}),(0,d.jsx)("div",{className:"text-sm text-green-600",children:"Solo proyectos activos"})]}),(0,d.jsxs)("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-200",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\ud83c\udfaf"}),(0,d.jsx)("h3",{className:"text-lg font-semibold text-purple-800",children:"Proyectos Prioritarios"})]}),(0,d.jsx)("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:t.filter(e=>"high"===e.priority&&"active"===e.status).length}),(0,d.jsx)("div",{className:"text-sm text-purple-600",children:"Prioridad alta (activos)"})]})]}),Z&&(0,d.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Proyecto Destacado"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Informaci\xf3n General"}),(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:"Nombre:"})," ",Z.name]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:"Manager:"})," ",Z.manager]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:"Sponsor:"})," ",Z.sponsor]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:"Estado:"}),(0,d.jsxs)("span",{className:"ml-2 px-2 py-1 rounded-full text-xs ".concat(se(Z.status)),children:[ae(Z.status)," ",Z.status]})]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"M\xe9tricas Financieras"}),(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:"Presupuesto:"})," $",(Z.budget/1e3).toFixed(0),"K USD"]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:"Reserva Contingencia:"})," $",(Z.contingencyReserve/1e3).toFixed(0),"K USD"]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:"Reserva Gesti\xf3n:"})," $",(Z.managementReserve/1e3).toFixed(0),"K USD"]}),Z.irr>0&&(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:"TIR:"})," ",Z.irr.toFixed(2),"%"]})]})]})]})]})]}),"projects"===O&&(0,d.jsx)(m,{projects:t,currentProjectId:r,setCurrentProjectId:n,portfolioMetrics:l,workPackages:i,risks:o,globalResources:c,setGlobalResources:x,tasksByProject:j,createProject:g,updateProject:p,deleteProject:h,duplicateProject:e=>{console.log("\ud83d\udccb Duplicando proyecto con ID:",e);const s=t.find(t=>t.id===e);if(!s)return void console.error("\u274c Proyecto no encontrado para duplicar");const a={id:"proj-"+String(Date.now()).slice(-6),name:"".concat(s.name," (Copia)"),description:s.description,startDate:s.startDate,endDate:s.endDate,budget:s.budget,status:s.status,priority:s.priority,manager:s.manager,team:s.team,createdAt:s.createdAt,updatedAt:s.updatedAt,version:s.version,progress:s.progress};console.log("\ud83d\udccb Proyecto duplicado creado:",a),g(a)},includeWeekendsByProject:A,setIncludeWeekendsByProject:P,getCurrentProjectIncludeWeekends:C}),"resources"===O&&(0,d.jsx)(u,{globalResources:c,setGlobalResources:x}),"weekly-planning"===O&&(0,d.jsxs)(d.Fragment,{children:[(()=>{console.log("\ud83d\udd0d DEBUG - Datos que se pasan a WeeklyPlanningTab:"),console.log("  \ud83d\udcca projects:",t),console.log("  \ud83d\udcca tasksByProject:",j),console.log("  \ud83d\udcca minutasByProject:",y),console.log("  \ud83d\udcca Estructura minutasByProject:",Object.keys(y||{}));const e=Object.keys(y||{})[0];return e&&console.log("  \ud83d\udcca Ejemplo minutas proyecto ".concat(e,":"),y[e]),null})(),(0,d.jsx)(I,{projects:t,tasksByProject:j,minutasByProject:y,weeklyPlanningData:X,setWeeklyPlanningData:Q,useSupabase:S})]}),"archive"===O&&(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6 border border-purple-200",children:(0,d.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,d.jsx)("span",{className:"text-3xl",children:"\ud83d\udcc1"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"Archivado de Proyectos"}),(0,d.jsx)("p",{className:"text-gray-600",children:"Gesti\xf3n centralizada del ciclo de vida completo de proyectos"})]})]})}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,d.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,d.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 flex items-center space-x-2",children:[(0,d.jsx)("span",{children:"\ud83d\udccb"}),(0,d.jsx)("span",{children:"Proyectos Activos"})]}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Selecciona un proyecto para archivarlo"})]}),(0,d.jsx)("div",{className:"p-6",children:0===t.filter(e=>"active"===e.status).length?(0,d.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,d.jsx)("span",{className:"text-4xl mb-2 block",children:"\ud83d\udced"}),(0,d.jsx)("p",{children:"No hay proyectos activos para archivar"})]}):(0,d.jsx)("div",{className:"space-y-3",children:t.filter(e=>"active"===e.status).map(e=>{const a=ee(e),l=a.canArchive;return(0,d.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg border ".concat(l?"bg-gray-50 border-gray-200":"bg-red-50 border-red-200"),children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("h5",{className:"font-medium text-gray-800",children:e.name}),(0,d.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,d.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(se(e.status)),children:e.status}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["Progreso: ",e.progress,"%"]}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["Creado: ",new Date(e.createdAt).toLocaleDateString()]})]}),!l&&(0,d.jsxs)("div",{className:"mt-2 p-2 bg-red-100 rounded border border-red-200",children:[(0,d.jsx)("p",{className:"text-xs text-red-700 font-medium mb-1",children:"\u26a0\ufe0f Requisitos pendientes para archivado:"}),(0,d.jsx)("ul",{className:"text-xs text-red-600 space-y-1",children:a.validations.map((e,t)=>(0,d.jsxs)("li",{className:"flex items-start",children:[(0,d.jsx)("span",{className:"mr-1",children:"\u2022"}),(0,d.jsx)("span",{children:e})]},t))})]})]}),(0,d.jsxs)("div",{className:"ml-4 flex flex-col space-y-2",children:[(0,d.jsxs)("button",{onClick:()=>(e=>{const a=t.find(t=>t.id===e);if(!a)return;const l=ee(a);if(!l.canArchive){const e=l.validations.join("\n\u2022 ");return void alert('\u274c No se puede archivar el proyecto "'.concat(a.name,'"\n\nRazones:\n\u2022 ').concat(e,"\n\nPor favor, complete todos los requisitos antes de archivar."))}const i='\xbfEst\xe1 seguro de que desea archivar el proyecto "'.concat(a.name,'"?\n\nEste proyecto ser\xe1 movido al archivo y ya no estar\xe1 disponible para edici\xf3n.');if(!window.confirm(i))return;const o={id:a.id,name:a.name,description:a.description,startDate:a.startDate,endDate:a.endDate,budget:a.budget,status:a.status,priority:a.priority,manager:a.manager,team:a.team,createdAt:a.createdAt,updatedAt:a.updatedAt,version:a.version,progress:a.progress,archivedAt:(new Date).toISOString(),archivedBy:"Usuario Actual"};$(e=>{const t=e.slice();return t.push(o),t});const d=t.map(t=>t.id===e?{id:t.id,name:t.name,description:t.description,startDate:t.startDate,endDate:t.endDate,budget:t.budget,status:"archived",priority:t.priority,manager:t.manager,team:t.team,createdAt:t.createdAt,updatedAt:t.updatedAt,version:t.version,progress:t.progress,archivedAt:(new Date).toISOString()}:t);if(s(d),r===e){const e=d.filter(e=>"active"===e.status);e.length>0&&n(e[0].id)}alert('\u2705 Proyecto "'.concat(a.name,'" archivado exitosamente.'))})(e.id),disabled:!l,className:"px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 ".concat(l?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),title:l?"Archivar proyecto":"No cumple requisitos para archivado",children:[(0,d.jsx)("span",{children:"\ud83d\udcc1"}),(0,d.jsx)("span",{children:"Archivar"})]}),!l&&(0,d.jsx)("span",{className:"text-xs text-red-600 text-center",children:"No disponible"})]})]},e.id)})})})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,d.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,d.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 flex items-center space-x-2",children:[(0,d.jsx)("span",{children:"\ud83d\udce6"}),(0,d.jsx)("span",{children:"Proyectos Archivados"})]}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Historial de proyectos archivados"})]}),(0,d.jsx)("div",{className:"p-6",children:0===U.length?(0,d.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,d.jsx)("span",{className:"text-4xl mb-2 block",children:"\ud83d\udced"}),(0,d.jsx)("p",{children:"No hay proyectos archivados"})]}):(0,d.jsx)("div",{className:"space-y-3",children:U.map(e=>(0,d.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:(0,d.jsxs)("div",{className:"flex items-start justify-between",children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("h5",{className:"font-medium text-gray-800",children:e.name}),(0,d.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,d.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"Archivado"}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["Archivado: ",new Date(e.archivedAt).toLocaleDateString()]}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["Por: ",e.archivedBy]})]})]}),(0,d.jsx)("div",{className:"ml-4 flex space-x-2",children:(0,d.jsxs)("button",{onClick:()=>(e=>{K(e),Y(!0)})(e),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors flex items-center space-x-1",title:"Ver detalles del proyecto archivado",children:[(0,d.jsx)("span",{children:"\ud83d\udc41\ufe0f"}),(0,d.jsx)("span",{children:"Ver"})]})})]})},e.id))})})]})]})]}),"metrics"===O&&(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"M\xe9tricas del Portfolio"}),(0,d.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"text-blue-600 text-xl mr-3",children:"\u2139\ufe0f"}),(0,d.jsxs)("div",{className:"text-blue-800 text-sm",children:[(0,d.jsx)("strong",{children:"Importante:"}),' Las m\xe9tricas financieras solo consideran proyectos con estado "Activo". Los proyectos "Inactivos" no suman al presupuesto total ni a las reservas del portfolio.']})]})}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,d.jsx)("h4",{className:"font-semibold text-gray-800 mb-4",children:"Distribuci\xf3n por Estado"}),(0,d.jsx)("div",{className:"space-y-3",children:["active","completed","on-hold","cancelled"].map(e=>{const s=t.filter(t=>t.status===e).length,a=t.length>0?s/t.length*100:0;return(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("span",{children:ae(e)}),(0,d.jsx)("span",{className:"capitalize",children:e})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,d.jsx)("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:"".concat(a,"%")}})}),(0,d.jsx)("span",{className:"text-sm text-gray-600 w-8 text-right",children:s})]})]},e)})})]}),(0,d.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,d.jsx)("h4",{className:"font-semibold text-gray-800 mb-4",children:"Distribuci\xf3n por Prioridad"}),(0,d.jsx)("div",{className:"space-y-3",children:["high","medium","low"].map(e=>{const s=t.filter(t=>t.priority===e).length,a=t.length>0?s/t.length*100:0;return(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("div",{className:"flex items-center space-x-2",children:(0,d.jsx)("span",{className:"capitalize",children:e})}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,d.jsx)("div",{className:"bg-green-500 h-2 rounded-full",style:{width:"".concat(a,"%")}})}),(0,d.jsx)("span",{className:"text-sm text-gray-600 w-8 text-right",children:s})]})]},e)})})]})]}),(0,d.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,d.jsx)("h4",{className:"font-semibold text-gray-800 mb-4",children:"An\xe1lisis Financiero (Solo Proyectos Activos)"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:["$",(t.filter(e=>"active"===e.status).reduce((e,t)=>e+t.budget,0)/1e3).toFixed(0),"K USD"]}),(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"Presupuesto Total"})]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",(t.filter(e=>"active"===e.status).reduce((e,t)=>e+t.contingencyReserve+t.managementReserve,0)/1e3).toFixed(0),"K USD"]}),(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"Reservas Totales"})]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:t.filter(e=>"active"===e.status&&e.irr>0).length}),(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"Proyectos con TIR"})]})]}),(0,d.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,d.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,d.jsx)("strong",{children:"Nota:"}),' Las m\xe9tricas financieras solo consideran proyectos con estado "Activo". Los proyectos "Inactivos" o "Completados" no influyen en los indicadores financieros.']})})]})]})]})]}),console.log("\ud83c\udfad Renderizando modal - showNewProjectModal:",T),T&&(0,d.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center p-4",children:[console.log("\ud83c\udfad Modal renderizado - editingProject:",E),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:(0,d.jsxs)("div",{className:"p-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h2",{className:"text-xl font-bold",children:null!==E&&void 0!==E&&E.id?"Editar Proyecto":"Nuevo Proyecto"}),(0,d.jsx)("button",{onClick:()=>{R(!1),M(null)},className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Proyecto *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(_.name?"border-red-500":"border-gray-300"),value:(null===E||void 0===E?void 0:E.name)||"",onChange:e=>{M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,name:e.target.value}),re("name",e.target.value)},onBlur:e=>re("name",e.target.value),placeholder:"Nombre del proyecto"}),(0,d.jsx)(F,{error:_.name})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Manager *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(_.manager?"border-red-500":"border-gray-300"),value:(null===E||void 0===E?void 0:E.manager)||"",onChange:e=>{M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,manager:e.target.value}),re("manager",e.target.value)},onBlur:e=>re("manager",e.target.value),placeholder:"Gerente del proyecto"}),(0,d.jsx)(F,{error:_.manager})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sponsor *"}),(0,d.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 ".concat(_.sponsor?"border-red-500":"border-gray-300"),value:(null===E||void 0===E?void 0:E.sponsor)||"",onChange:e=>{M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,sponsor:e.target.value}),re("sponsor",e.target.value)},onBlur:e=>re("sponsor",e.target.value),placeholder:"Patrocinador del proyecto"}),(0,d.jsx)(F,{error:_.sponsor})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prioridad"}),(0,d.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:(null===E||void 0===E?void 0:E.priority)||"medium",onChange:e=>M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,priority:e.target.value}),children:[(0,d.jsx)("option",{value:"low",children:"Baja"}),(0,d.jsx)("option",{value:"medium",children:"Media"}),(0,d.jsx)("option",{value:"high",children:"Alta"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado del Proyecto *"}),(0,d.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:(null===E||void 0===E?void 0:E.status)||"inactive",onChange:e=>M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,status:e.target.value}),children:[(0,d.jsx)("option",{value:"inactive",children:"\u26ab Inactivo"}),(0,d.jsx)("option",{value:"active",children:"\ud83d\udfe2 Activo"})]}),(0,d.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[(0,d.jsx)("strong",{children:"Por defecto:"}),' Los proyectos nuevos y duplicados aparecen como "Inactivos" para revisi\xf3n. Solo los proyectos "Activos" suman al dashboard consolidado y aparecen en Gesti\xf3n de Proyectos.']})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Inicio *"}),(0,d.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2 ".concat(_.startDate?"border-red-500":"border-gray-300"),value:(null===E||void 0===E?void 0:E.startDate)||"",onChange:e=>{M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,startDate:e.target.value}),re("startDate",e.target.value),null!==E&&void 0!==E&&E.endDate&&re("endDate",E.endDate)},onBlur:e=>re("startDate",e.target.value)}),(0,d.jsx)(F,{error:_.startDate})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Fin *"}),(0,d.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2 ".concat(_.endDate?"border-red-500":"border-gray-300"),value:(null===E||void 0===E?void 0:E.endDate)||"",onChange:e=>{M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,endDate:e.target.value}),re("endDate",e.target.value)},onBlur:e=>re("endDate",e.target.value)}),(0,d.jsx)(F,{error:_.endDate})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Presupuesto (USD) *"}),(0,d.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 ".concat(_.budget?"border-red-500":"border-gray-300"),value:(null===E||void 0===E?void 0:E.budget)||"",onChange:e=>{const t=e.target.value;if(""===t||/^\d+$/.test(t)){const e=""===t?"":Number(t);M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,budget:e}),re("budget",e)}},onBlur:e=>{const t=""===e.target.value?"":Number(e.target.value);re("budget",t)},placeholder:"Presupuesto en USD (ej: 100000)",min:"0"}),(0,d.jsx)(F,{error:_.budget})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"TIR (%)"}),(0,d.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 ".concat(_.irr?"border-red-500":"border-gray-300"),value:(null===E||void 0===E?void 0:E.irr)||"",onChange:e=>{const t=e.target.value;if(""===t||/^\d*\.?\d*$/.test(t)){const e=""===t?"":Number(t);M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,irr:e}),re("irr",e)}},onBlur:e=>{const t=""===e.target.value?"":Number(e.target.value);re("irr",t)},placeholder:"Tasa Interna de Retorno (ej: 15.5)",min:"0",max:"100",step:"0.01"}),(0,d.jsx)(F,{error:_.irr})]}),(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,d.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===E||void 0===E?void 0:E.description)||"",onChange:e=>M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,description:e.target.value}),placeholder:"Descripci\xf3n detallada del proyecto"})]}),(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Objetivo del Proyecto"}),(0,d.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===E||void 0===E?void 0:E.objective)||"",onChange:e=>M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,objective:e.target.value}),placeholder:"\xbfQu\xe9 se busca lograr con este proyecto?"})]}),(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Caso de Negocio"}),(0,d.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:"3",value:(null===E||void 0===E?void 0:E.businessCase)||"",onChange:e=>M({id:E.id,name:E.name,description:E.description,startDate:E.startDate,endDate:E.endDate,budget:E.budget,status:E.status,priority:E.priority,manager:E.manager,team:E.team,createdAt:E.createdAt,updatedAt:E.updatedAt,version:E.version,progress:E.progress,businessCase:e.target.value}),placeholder:"Justificaci\xf3n del proyecto desde el punto de vista del negocio"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,d.jsx)("button",{onClick:()=>{R(!1),M(null)},className:"px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,d.jsxs)("button",{onClick:()=>{console.log("\ud83d\udcbe Guardando proyecto:",E),console.log("\ud83d\udcbe ID del proyecto a guardar:",null===E||void 0===E?void 0:E.id),console.log("\ud83d\udcbe \xbfEs edici\xf3n?",!(null===E||void 0===E||!E.id));const e=re("name",E.name),t=re("manager",E.manager),s=re("sponsor",E.sponsor),a=re("startDate",E.startDate),r=re("endDate",E.endDate),n=re("budget",E.budget),l=re("irr",E.irr);console.log("\u2705 Validaciones:",{isNameValid:e,isManagerValid:t,isSponsorValid:s,isStartDateValid:a,isEndDateValid:r,isBudgetValid:n,isIRRValid:l}),e&&t&&s&&a&&r&&n&&l?(E.id&&""!==E.id?(console.log("\ud83d\udd04 Actualizando proyecto existente con ID:",E.id),console.log("\ud83d\udd04 Datos a actualizar:",E),p(E.id,E)):(console.log("\u2795 Creando nuevo proyecto (sin ID)"),console.log("\u2795 Datos del nuevo proyecto:",E),g(E)),R(!1),M(null),W({})):console.log("\u274c Errores de validaci\xf3n:",_)},disabled:Object.keys(_).length>0,className:"px-4 py-2 rounded transition-colors ".concat(Object.keys(_).length>0?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:["Guardar Proyecto ",Object.keys(_).length>0&&"(".concat(Object.keys(_).length," errores)")]})]})]})})]}),J&&H&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,d.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("span",{className:"text-3xl",children:"\ud83d\udcc1"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:H.name}),(0,d.jsx)("p",{className:"text-sm text-gray-600",children:"Proyecto Archivado"})]})]}),(0,d.jsx)("button",{onClick:te,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"\xd7"})]})}),(0,d.jsxs)("div",{className:"p-6 space-y-6",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,d.jsx)("h4",{className:"font-semibold text-gray-800 mb-3",children:"\ud83d\udcca Informaci\xf3n General"}),(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Estado:"}),(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"Archivado"})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Progreso:"}),(0,d.jsxs)("span",{className:"font-medium",children:[H.progress,"%"]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Archivado:"}),(0,d.jsx)("span",{children:new Date(H.archivedAt).toLocaleDateString()})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Archivado por:"}),(0,d.jsx)("span",{children:H.archivedBy})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Creado:"}),(0,d.jsx)("span",{children:new Date(H.createdAt).toLocaleDateString()})]})]})]}),(0,d.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,d.jsx)("h4",{className:"font-semibold text-gray-800 mb-3",children:"\ud83d\udcdd Descripci\xf3n"}),(0,d.jsx)("p",{className:"text-sm text-gray-600",children:H.description||"Sin descripci\xf3n disponible"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,d.jsxs)("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center space-x-2",children:[(0,d.jsx)("span",{children:"\ud83d\udccb"}),(0,d.jsx)("span",{children:"Tareas del Cronograma"})]}),(0,d.jsx)("div",{className:"space-y-2",children:(()=>{const e=v.filter(e=>e.workPackageId===H.id||e.projectId===H.id);return 0===e.length?(0,d.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No hay tareas registradas para este proyecto"}):(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsxs)("p",{className:"text-sm text-gray-600",children:["Total: ",e.length," tareas"]}),(0,d.jsxs)("p",{className:"text-sm text-gray-600",children:["Completadas: ",e.filter(e=>100===e.progress).length]}),(0,d.jsxs)("p",{className:"text-sm text-gray-600",children:["Pendientes: ",e.filter(e=>e.progress<100).length]})]})})()})]}),(0,d.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,d.jsxs)("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center space-x-2",children:[(0,d.jsx)("span",{children:"\ud83d\udcce"}),(0,d.jsx)("span",{children:"Auditor\xeda Documental"})]}),(0,d.jsx)("div",{className:"space-y-2",children:(()=>{const e=D.filter(e=>e.projectId===H.id||e.workPackageId===H.id);if(0===e.length)return(0,d.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No hay registros de auditor\xeda para este proyecto"});const t=e.reduce((e,t)=>{const s=t.documentType||"Otros";return e[s]||(e[s]=[]),e[s].push(t),e},{});return(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("p",{className:"text-sm text-gray-600 font-medium",children:["Total de documentos: ",e.length]}),(0,d.jsx)("div",{className:"space-y-1",children:Object.entries(t).map(e=>{let[t,s]=e;return(0,d.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,d.jsxs)("span",{className:"text-gray-600",children:[t,":"]}),(0,d.jsx)("span",{className:"font-medium",children:s.length})]},t)})})]})})()})]})]}),(0,d.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,d.jsxs)("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center space-x-2",children:[(0,d.jsx)("span",{children:"\ud83d\udcc8"}),(0,d.jsx)("span",{children:"M\xe9tricas Finales"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[H.progress,"%"]}),(0,d.jsx)("div",{className:"text-gray-600",children:"Progreso Final"})]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-green-600",children:v.filter(e=>e.workPackageId===H.id||e.projectId===H.id).length}),(0,d.jsx)("div",{className:"text-gray-600",children:"Tareas Totales"})]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:new Date(H.archivedAt).toLocaleDateString()}),(0,d.jsx)("div",{className:"text-gray-600",children:"Fecha de Archivado"})]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:H.archivedBy}),(0,d.jsx)("div",{className:"text-gray-600",children:"Responsable"})]})]})]}),(0,d.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,d.jsxs)("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center space-x-2",children:[(0,d.jsx)("span",{children:"\ud83d\udccb"}),(0,d.jsx)("span",{children:"Registro de Auditor\xeda Documental"})]}),(0,d.jsx)("div",{className:"space-y-3",children:(()=>{const e=D.filter(e=>e.projectId===H.id||e.workPackageId===H.id);if(0===e.length)return(0,d.jsx)("p",{className:"text-sm text-gray-500 italic text-center py-4",children:"No hay registros de auditor\xeda documental para este proyecto"});const t=e.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));return(0,d.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.map((e,t)=>(0,d.jsx)("div",{className:"bg-white p-3 rounded border border-gray-200",children:(0,d.jsx)("div",{className:"flex items-start justify-between",children:(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,d.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.documentType||"Documento"}),(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("create"===e.action?"bg-green-100 text-green-800":"update"===e.action?"bg-blue-100 text-blue-800":"delete"===e.action?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"create"===e.action?"Creado":"update"===e.action?"Modificado":"delete"===e.action?"Eliminado":"Acci\xf3n"})]}),(0,d.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:e.description||"Sin descripci\xf3n"}),(0,d.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,d.jsxs)("span",{children:["Por: ",e.user||"Sistema"]}),(0,d.jsx)("span",{children:"\u2022"}),(0,d.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]})]})})},t))})})()})]}),(0,d.jsx)("div",{className:"bg-gray-100 p-4 rounded-lg border-l-4 border-gray-400",children:(0,d.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,d.jsx)("span",{className:"text-yellow-600 text-xl",children:"\u26a0\ufe0f"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h5",{className:"font-medium text-gray-800",children:"Proyecto Archivado"}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Este proyecto est\xe1 archivado y es de solo lectura. Los datos se mantienen para consulta hist\xf3rica y auditor\xeda, pero no se puede modificar."})]})]})})]}),(0,d.jsx)("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3",children:(0,d.jsx)("button",{onClick:te,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cerrar"})})]})})]})}},2367:(e,t,s)=>{s.d(t,{$$:()=>m,$M:()=>o,AX:()=>n,EL:()=>d,Kl:()=>u,X0:()=>i,aI:()=>l,iD:()=>c});var a=s(9874);const r=async e=>{let{userEmail:t,userId:s,changeId:r,changeNumber:n,changeTitle:l,notificationType:i,title:o,message:d,priority:c="normal",metadata:m={}}=e;try{a.default.getCurrentUser();const e=a.default.getCurrentOrganization();if(!e)return console.warn("No se puede crear notificaci\xf3n: organizaci\xf3n no detectada"),{success:!1,error:"Organizaci\xf3n no detectada"};const u={organization_id:e,user_id:s,user_email:t,change_id:r,change_number:n,change_title:l,notification_type:i,title:o,message:d,priority:c,status:"unread",metadata:m,action_url:"/change-management?changeId=".concat(r),created_at:(new Date).toISOString()},{data:x,error:g}=await a.default.supabase.from("change_notifications").insert(u).select().single();return g?(console.error("Error creando notificaci\xf3n:",g),{success:!1,error:g}):{success:!0,data:x}}catch(u){return console.error("Error inesperado creando notificaci\xf3n:",u),{success:!1,error:u}}},n=async e=>{try{const{data:t,error:s}=await a.default.supabase.from("change_notifications").select("*").eq("user_email",e).eq("status","unread").order("created_at",{ascending:!1});return s?(console.error("Error obteniendo notificaciones:",s),[]):t||[]}catch(t){return console.error("Error inesperado obteniendo notificaciones:",t),[]}},l=async e=>{try{const{error:t}=await a.default.supabase.from("change_notifications").update({status:"read",read_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("id",e);return t?(console.error("Error marcando notificaci\xf3n como le\xedda:",t),{success:!1,error:t}):{success:!0}}catch(t){return console.error("Error inesperado marcando notificaci\xf3n:",t),{success:!1,error:t}}},i=async e=>{try{const{error:t}=await a.default.supabase.from("change_notifications").update({status:"read",read_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("user_email",e).eq("status","unread");return t?(console.error("Error marcando todas como le\xeddas:",t),{success:!1,error:t}):{success:!0}}catch(t){return console.error("Error inesperado marcando todas como le\xeddas:",t),{success:!1,error:t}}},o=async e=>{try{const{count:t,error:s}=await a.default.supabase.from("change_notifications").select("*",{count:"exact",head:!0}).eq("user_email",e).eq("status","unread");return s?(console.error("Error obteniendo conteo:",s),0):t||0}catch(t){return console.error("Error inesperado obteniendo conteo:",t),0}},d=async e=>{let{userEmail:t,userId:s,change:a,assignedBy:n}=e;return r({userEmail:t,userId:s,changeId:a.id,changeNumber:a.changeNumber,changeTitle:a.title,notificationType:"assigned",title:"Cambio Asignado",message:"".concat(n,' te ha asignado el cambio "').concat(a.title,'"'),priority:"high",metadata:{assignedBy:n,changeStatus:a.status}})},c=async e=>{let{userEmail:t,userId:s,change:a}=e;return r({userEmail:t,userId:s,changeId:a.id,changeNumber:a.changeNumber,changeTitle:a.title,notificationType:"approval_required",title:"Aprobaci\xf3n Requerida",message:'El cambio "'.concat(a.title,'" requiere tu aprobaci\xf3n'),priority:"urgent",metadata:{costImpact:a.impactCost,scheduleImpact:a.impactSchedule}})},m=async e=>{let{userEmail:t,userId:s,change:a}=e;return r({userEmail:t,userId:s,changeId:a.id,changeNumber:a.changeNumber,changeTitle:a.title,notificationType:"ccb_vote_required",title:"Voto CCB Requerido",message:'Tu voto es requerido en el CCB para "'.concat(a.title,'"'),priority:"high",metadata:{changeStatus:a.status}})},u=async e=>{let{userEmail:t,userId:s,change:a,oldStatus:n,newStatus:l,changedBy:i}=e;return r({userEmail:t,userId:s,changeId:a.id,changeNumber:a.changeNumber,changeTitle:a.title,notificationType:"status_changed",title:"Estado de Cambio Actualizado",message:'El cambio "'.concat(a.title,'" pas\xf3 de ').concat(n," a ").concat(l),priority:"normal",metadata:{oldStatus:n,newStatus:l,changedBy:i}})}},8449:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var a=s(9379),r=s(9950),n=s(3116),l=s(4414);const i=e=>{switch(e){case"active":return"bg-green-100 text-green-800 border-green-200";case"inactive":return"bg-gray-100 text-gray-600 border-gray-300";case"completed":return"bg-blue-100 text-blue-800 border-blue-200";case"on-hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"archived":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},o=e=>{switch(e){case"active":return"\ud83d\udfe2";case"inactive":return"\u26ab";case"completed":return"\u2705";case"on-hold":default:return"\u23f8\ufe0f";case"cancelled":return"\u274c";case"archived":return"\ud83d\udcc1"}},d=e=>{let{project:t,workPackages:s,risks:d,tasks:c,purchaseOrders:m,advances:u,invoices:x,contracts:g,resourceAssignments:p,onArchiveProject:h}=e;const[b,v]=(0,r.useState)(!1),[j,y]=(0,r.useState)(0),f=(()=>{if(!t)return[];try{const e=localStorage.getItem("audit-log-".concat(t.id));return e?JSON.parse(e):[]}catch(e){return console.error("Error loading audit log:",e),[]}})(),{files:N,getFileStats:w}=(0,n.A)(null===t||void 0===t?void 0:t.id),k=w(),D=(0,r.useMemo)(()=>{if(!t)return{};const e=s.length,a=s.filter(e=>"completed"===e.status).length,r=s.reduce((e,t)=>e+(t.budget||0),0),n=s.reduce((e,t)=>e+(t.earnedValue||0),0),l=s.reduce((e,t)=>e+(t.actualCost||0),0);return{totalWorkPackages:e,completedWorkPackages:a,completionPercentage:e>0?a/e*100:0,totalBudget:r,totalEarned:n,totalActual:l,budgetUtilization:r>0?l/r*100:0,cpi:l>0?n/l:1,totalRisks:d.length,activeRisks:d.filter(e=>"active"===e.status).length,totalTasks:c.length,completedTasks:c.filter(e=>"completed"===e.status).length,totalFinancialItems:m.length+u.length+x.length+g.length,totalResourceAssignments:p.length,totalAuditEvents:f.length,totalFiles:N.length,totalFileSize:k.totalSizeMB}},[t,s,d,c,m,u,x,g,p,f,N,k]),A=(0,r.useMemo)(()=>!!t&&("completed"===t.status&&(!(D.completionPercentage<90)&&0!==D.totalWorkPackages)),[t,D]),P=()=>{const e=[];return D.cpi<.9&&e.push("El proyecto tuvo sobrecostos significativos. Revisar estimaciones de costos para futuros proyectos similares."),D.completionPercentage<95&&e.push("Algunos entregables no se completaron al 100%. Mejorar el seguimiento de work packages."),D.activeRisks>0&&e.push("Quedaron riesgos activos al finalizar. Implementar mejor gesti\xf3n de riesgos desde el inicio."),D.totalAuditEvents>100&&e.push("El proyecto tuvo muchos cambios. Implementar mejor control de cambios."),0===e.length&&e.push("El proyecto se ejecut\xf3 exitosamente. Replicar buenas pr\xe1cticas en futuros proyectos."),e};return t?(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"bg-gradient-to-r from-purple-50 to-indigo-100 rounded-2xl shadow-lg p-6 text-gray-800 relative overflow-hidden",children:[(0,l.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-purple-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,l.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-indigo-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,l.jsx)("div",{className:"relative z-10",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,l.jsx)("span",{className:"text-3xl",children:"\ud83d\udcc1"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gray-800",children:"Archivado de Proyecto"}),(0,l.jsxs)("p",{className:"text-gray-600 text-lg",children:['Generar expediente completo y archivar "',t.name,'"']})]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsxs)("div",{className:"text-4xl font-bold text-gray-800",children:[D.completionPercentage.toFixed(1),"%"]}),(0,l.jsx)("div",{className:"text-gray-600",children:"Completitud"})]})]})})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Estado del Proyecto"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Estado Actual"}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(i(t.status)),children:[o(t.status)," ",t.status]})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Manager"}),(0,l.jsx)("div",{className:"font-medium",children:t.manager})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Presupuesto Original"}),(0,l.jsxs)("div",{className:"font-medium",children:["$",(t.budget/1e3).toFixed(0),"K USD"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Per\xedodo"}),(0,l.jsxs)("div",{className:"font-medium",children:[t.startDate," - ",t.endDate]})]})]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"M\xe9tricas Finales"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,l.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:D.totalWorkPackages}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"Work Packages"}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[D.completedWorkPackages," completados"]})]}),(0,l.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",(D.totalBudget/1e3).toFixed(0),"K"]}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"Presupuesto Total"}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:["$",(D.totalActual/1e3).toFixed(0),"K gastado"]})]}),(0,l.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[(0,l.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:D.totalAuditEvents}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"Eventos de Auditor\xeda"}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:"Registros completos"})]})]})]}),f.length>0&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udccb Registro de Auditor\xeda"}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"Total de eventos registrados:"}),(0,l.jsx)("span",{className:"font-semibold text-purple-600",children:f.length})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"Primer evento:"}),(0,l.jsx)("span",{className:"text-sm text-gray-500",children:f.length>0?new Date(f[f.length-1].timestamp).toLocaleDateString():"N/A"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"\xdaltimo evento:"}),(0,l.jsx)("span",{className:"text-sm text-gray-500",children:f.length>0?new Date(f[0].timestamp).toLocaleDateString():"N/A"})]}),(0,l.jsx)("div",{className:"mt-3 p-3 bg-purple-50 border border-purple-200 rounded-lg",children:(0,l.jsxs)("div",{className:"text-sm text-purple-800",children:[(0,l.jsx)("strong",{children:"\u2705 Audit Log incluido:"})," El expediente incluir\xe1 todos los eventos de auditor\xeda registrados desde la activaci\xf3n del proyecto hasta su completitud."]})})]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Validaci\xf3n de Archivado"}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("span",{className:"text-xl ".concat("completed"===t.status?"text-green-500":"text-red-500"),children:"completed"===t.status?"\u2705":"\u274c"}),(0,l.jsx)("span",{className:"text-sm",children:"Proyecto marcado como completado"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("span",{className:"text-xl ".concat(D.completionPercentage>=90?"text-green-500":"text-red-500"),children:D.completionPercentage>=90?"\u2705":"\u274c"}),(0,l.jsxs)("span",{className:"text-sm",children:["Completitud m\xednima del 90% (",D.completionPercentage.toFixed(1),"%)"]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("span",{className:"text-xl ".concat(D.totalWorkPackages>0?"text-green-500":"text-red-500"),children:D.totalWorkPackages>0?"\u2705":"\u274c"}),(0,l.jsxs)("span",{className:"text-sm",children:["Work packages definidos (",D.totalWorkPackages,")"]})]})]}),!A&&(0,l.jsx)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,l.jsxs)("div",{className:"text-sm text-red-800",children:[(0,l.jsx)("strong",{children:"No se puede archivar:"})," El proyecto no cumple con los criterios m\xednimos de archivado."]})})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Contenido del Expediente"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,l.jsx)("span",{className:"text-sm",children:"Informaci\xf3n del proyecto"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,l.jsx)("span",{className:"text-sm",children:"Work packages completos"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,l.jsx)("span",{className:"text-sm",children:"Gesti\xf3n de riesgos"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,l.jsx)("span",{className:"text-sm",children:"Cronograma y tareas"})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,l.jsx)("span",{className:"text-sm",children:"Documentaci\xf3n financiera"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,l.jsx)("span",{className:"text-sm",children:"Asignaci\xf3n de recursos"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,l.jsxs)("span",{className:"text-sm",children:["Auditor\xeda completa (",f.length," eventos)"]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,l.jsxs)("span",{className:"text-sm",children:["Archivos adjuntos (",N.length," archivos, ",k.totalSizeMB,"MB)"]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,l.jsx)("span",{className:"text-sm",children:"Lecciones aprendidas"})]})]})]})]}),b&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Generando Expediente"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:"".concat(j,"%")}})}),(0,l.jsxs)("div",{className:"text-sm text-gray-600 text-center",children:[j.toFixed(0),"% completado"]})]})]}),(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Archivar Proyecto"}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:'Generar expediente completo y cambiar estado a "Archivado"'})]}),(0,l.jsx)("button",{onClick:async()=>{if(A){v(!0),y(0);try{const e=["Validando datos del proyecto...","Generando m\xe9tricas finales...","Compilando documentaci\xf3n...","Creando expediente...","Finalizando archivado..."];for(let t=0;t<e.length;t++)y(t/e.length*100),await new Promise(e=>setTimeout(e,500));const r={metadata:{archiveDate:(new Date).toISOString(),archiveVersion:"1.0.0",projectId:t.id,projectName:t.name,archiveType:"project-completion"},project:(0,a.A)((0,a.A)({},t),{},{archivedAt:(new Date).toISOString(),finalMetrics:D}),workPackages:s,risks:d,tasks:c,financial:{purchaseOrders:m,advances:u,invoices:x,contracts:g},resources:p,auditLog:f,files:N,summary:{totalDuration:Math.round((new Date(t.endDate)-new Date(t.startDate))/864e5),finalBudget:D.totalBudget,finalCost:D.totalActual,completionRate:D.completionPercentage,performanceIndex:D.cpi,lessonsLearned:P()}},n=JSON.stringify(r,null,2),l=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(l),o=document.createElement("a");o.href=i,o.download="expediente-".concat(t.name.replace(/[^a-zA-Z0-9]/g,"-"),"-").concat((new Date).toISOString().split("T")[0],".json"),o.click(),URL.revokeObjectURL(i),y(100),h&&h(t.id,r)}catch(e){console.error("Error generando expediente:",e)}finally{v(!1)}}},disabled:!A||b,className:"\n              px-6 py-3 rounded-lg font-medium transition-colors\n              ".concat(A&&!b?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-300 text-gray-500 cursor-not-allowed","\n            "),children:b?"Generando...":"\ud83d\udcc1 Generar Expediente y Archivar"})]})})]}):(0,l.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,l.jsx)("div",{className:"text-4xl mb-4",children:"\ud83d\udcc1"}),(0,l.jsx)("div",{className:"text-lg mb-2",children:"Selecciona un proyecto para generar su expediente"})]})}}}]);
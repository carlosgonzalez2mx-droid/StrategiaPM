{"version":3,"file":"static/js/762.02bb8e24.chunk.js","mappings":"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","sources":["components/admin/SuperAdminRoute.js","services/SuperAdminService.js"],"sourcesContent":["// src/components/admin/SuperAdminRoute.js\nimport React, { useState, useEffect } from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { useAuth } from '../../contexts/AuthContext';\nimport SuperAdminService from '../../services/SuperAdminService';\n\nconst SuperAdminRoute = ({ children }) => {\n  const { isAuthenticated, loading: authLoading } = useAuth();\n  const [isAuthorized, setIsAuthorized] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    checkAuthorization();\n  }, [isAuthenticated]);\n\n  const checkAuthorization = async () => {\n    if (!isAuthenticated) {\n      setIsAuthorized(false);\n      setLoading(false);\n      return;\n    }\n\n    try {\n      const isSuperAdmin = await SuperAdminService.isSuperAdmin();\n      setIsAuthorized(isSuperAdmin);\n    } catch (error) {\n      console.error('Error verificando autorizaci贸n:', error);\n      setIsAuthorized(false);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (authLoading || loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Verificando permisos...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return <Navigate to=\"/login\" replace />;\n  }\n\n  if (!isAuthorized) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-gray-50\">\n        <div className=\"text-center max-w-md\">\n          <div className=\"text-6xl mb-4\"></div>\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n            Acceso Denegado\n          </h1>\n          <p className=\"text-gray-600 mb-6\">\n            No tienes permisos de super-administrador para acceder a esta secci贸n.\n          </p>\n          <a\n            href=\"/\"\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors\"\n          >\n            Volver al Dashboard\n          </a>\n        </div>\n      </div>\n    );\n  }\n\n  return children;\n};\n\nexport default SuperAdminRoute;\n\n","// src/services/SuperAdminService.js\nimport supabaseService from './SupabaseService';\n\nclass SuperAdminService {\n  \n  async isSuperAdmin() {\n    try {\n      const user = supabaseService.getCurrentUser();\n      if (!user) return false;\n\n      const { data: superAdminData } = await supabaseService.supabase\n        .from('super_admins')\n        .select('id')\n        .eq('user_id', user.id)\n        .single();\n\n      if (superAdminData) return true;\n\n      const { data: roleData } = await supabaseService.supabase\n        .from('user_organization_roles')\n        .select('role')\n        .eq('user_id', user.id)\n        .eq('role', 'super_admin')\n        .single();\n\n      return roleData !== null;\n    } catch (error) {\n      console.error('Error verificando super-admin:', error);\n      return false;\n    }\n  }\n\n  async listAllOrganizations() {\n    try {\n      const { data, error } = await supabaseService.supabase\n        .from('organizations')\n        .select(`\n          *,\n          members_count:organization_members(count),\n          projects_count:projects(count)\n        `)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      // Formatear los datos\n      const formatted = data?.map(org => ({\n        ...org,\n        member_count: org.members_count?.[0]?.count || 0,\n        project_count: org.projects_count?.[0]?.count || 0\n      }));\n\n      return { data: formatted, error: null };\n    } catch (error) {\n      console.error('Error listando organizaciones:', error);\n      return { data: null, error };\n    }\n  }\n\n  async getOrganizationDetails(orgId) {\n    try {\n      const { data, error } = await supabaseService.supabase\n        .from('organizations')\n        .select(`\n          *,\n          members:organization_members(\n            id,\n            user_email,\n            user_id,\n            role,\n            status,\n            invited_at,\n            accepted_at,\n            created_at\n          ),\n          projects:projects(\n            id,\n            name,\n            status,\n            progress,\n            manager,\n            start_date,\n            end_date,\n            budget\n          )\n        `)\n        .eq('id', orgId)\n        .single();\n\n      if (error) throw error;\n      return { data, error: null };\n    } catch (error) {\n      console.error('Error obteniendo detalles:', error);\n      return { data: null, error };\n    }\n  }\n\n  async getOrganizationMetrics(orgId) {\n    try {\n      const [projects, tasks, members, risks] = await Promise.all([\n        supabaseService.supabase\n          .from('projects')\n          .select('id', { count: 'exact', head: true })\n          .eq('organization_id', orgId),\n        supabaseService.supabase\n          .from('tasks')\n          .select('id', { count: 'exact', head: true }),\n        supabaseService.supabase\n          .from('organization_members')\n          .select('id', { count: 'exact', head: true })\n          .eq('organization_id', orgId)\n          .eq('status', 'active'),\n        supabaseService.supabase\n          .from('risks')\n          .select('id', { count: 'exact', head: true })\n      ]);\n\n      return {\n        projectsCount: projects.count || 0,\n        tasksCount: tasks.count || 0,\n        activeMembersCount: members.count || 0,\n        risksCount: risks.count || 0\n      };\n    } catch (error) {\n      console.error('Error obteniendo m茅tricas:', error);\n      return {\n        projectsCount: 0,\n        tasksCount: 0,\n        activeMembersCount: 0,\n        risksCount: 0\n      };\n    }\n  }\n\n  async getGlobalStats() {\n    try {\n      // Intentar usar funci贸n RPC si existe\n      const { data, error } = await supabaseService.supabase\n        .rpc('get_super_admin_stats');\n\n      if (error && error.code !== '42883') { // 42883 = funci贸n no existe\n        throw error;\n      }\n      \n      if (data) return data;\n\n      // Fallback: calcular manualmente\n      const [orgs, projects, tasks, members] = await Promise.all([\n        supabaseService.supabase.from('organizations').select('*'),\n        supabaseService.supabase.from('projects').select('id', { count: 'exact', head: true }),\n        supabaseService.supabase.from('tasks').select('id', { count: 'exact', head: true }),\n        supabaseService.supabase.from('organization_members').select('id', { count: 'exact', head: true })\n      ]);\n\n      return {\n        total_organizations: orgs.data?.length || 0,\n        total_projects: projects.count || 0,\n        total_tasks: tasks.count || 0,\n        active_members: members.count || 0,\n        organizations_by_status: orgs.data || []\n      };\n    } catch (error) {\n      console.error('Error obteniendo estad铆sticas globales:', error);\n      return {\n        total_organizations: 0,\n        total_projects: 0,\n        total_tasks: 0,\n        active_members: 0,\n        organizations_by_status: []\n      };\n    }\n  }\n\n  async updateOrganization(orgId, updates) {\n    try {\n      const { data, error } = await supabaseService.supabase\n        .from('organizations')\n        .update({\n          ...updates,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', orgId)\n        .select()\n        .single();\n\n      if (error) throw error;\n      return { data, error: null };\n    } catch (error) {\n      console.error('Error actualizando organizaci贸n:', error);\n      return { data: null, error };\n    }\n  }\n\n  async deleteOrganization(orgId) {\n    try {\n      // Advertencia: Esto eliminar谩 todos los datos relacionados\n      const { error } = await supabaseService.supabase\n        .from('organizations')\n        .delete()\n        .eq('id', orgId);\n\n      if (error) throw error;\n      return { error: null };\n    } catch (error) {\n      console.error('Error eliminando organizaci贸n:', error);\n      return { error };\n    }\n  }\n}\n\nconst superAdminService = new SuperAdminService();\n\nexport default superAdminService;\n\n"],"names":["_ref","children","isAuthenticated","loading","authLoading","useAuth","isAuthorized","setIsAuthorized","useState","setLoading","useEffect","checkAuthorization","async","isSuperAdmin","SuperAdminService","error","console","_jsx","className","_jsxs","href","Navigate","to","replace","user","supabaseService","getCurrentUser","data","superAdminData","supabase","from","select","eq","id","single","roleData","listAllOrganizations","order","ascending","map","org","_org$members_count","_org$members_count$","_org$projects_count","_org$projects_count$","_objectSpread","member_count","members_count","count","project_count","projects_count","getOrganizationDetails","orgId","getOrganizationMetrics","projects","tasks","members","risks","Promise","all","head","projectsCount","tasksCount","activeMembersCount","risksCount","getGlobalStats","_orgs$data","rpc","code","orgs","total_organizations","length","total_projects","total_tasks","active_members","organizations_by_status","updateOrganization","updates","update","updated_at","Date","toISOString","deleteOrganization","delete"],"sourceRoot":""}
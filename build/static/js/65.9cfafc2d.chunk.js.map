{"version":3,"file":"static/js/65.9cfafc2d.chunk.js","mappings":"mMAEA,MAsLA,EAtLoBA,IAAyC,IAAxC,OAAEC,EAAM,QAAEC,EAAO,MAAEC,EAAK,OAAEC,GAAQJ,EACrD,MAAOK,EAAaC,IAAkBC,EAAAA,EAAAA,UAAS,CAC7C,CAAEC,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,IACxD,CAAEJ,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,IACxD,CAAEJ,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,IACxD,CAAEJ,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,IACxD,CAAEJ,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,IACxD,CAAEJ,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,OAI1DC,EAAAA,EAAAA,WAAU,KACJZ,GACFK,EAAe,CACb,CAAEE,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,IACxD,CAAEJ,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,IACxD,CAAEJ,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,IACxD,CAAEJ,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,IACxD,CAAEJ,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,IACxD,CAAEJ,GAAI,EAAGC,MAAO,GAAIC,YAAa,GAAIC,MAAO,GAAIC,OAAQ,OAG3D,CAACX,IAEJ,MAAMa,EAAoBA,CAACN,EAAIO,EAAOC,KACpCV,EAAeW,GACbA,EAAKC,IAAIC,GACPA,EAAKX,KAAOA,GAAEY,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQD,GAAI,IAAE,CAACJ,GAAQC,IAAUG,KAoCrD,OAAKlB,GAGHoB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6EAA4EC,UACzFC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,uFAAsFC,SAAA,EACnGC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,+BACjDF,EAAAA,EAAAA,KAAA,UACEI,QAASvB,EACToB,UAAU,uDAAsDC,SACjE,aAKHF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,OAAMC,UACnBF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,wBAAuBC,SAAC,6FAMvCF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,kBAAiBC,UAC9BC,EAAAA,EAAAA,MAAA,SAAOF,UAAU,gDAA+CC,SAAA,EAC9DF,EAAAA,EAAAA,KAAA,SAAAE,UACEC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,aAAYC,SAAA,EACxBF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yEAAwEC,SAAC,OAGvFF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yEAAwEC,SAAC,aAGvFF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yEAAwEC,SAAC,mBAGvFF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yEAAwEC,SAAC,aAGvFF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yEAAwEC,SAAC,6BAK3FF,EAAAA,EAAAA,KAAA,SAAAE,SACGlB,EAAYa,IAAKC,IAChBK,EAAAA,EAAAA,MAAA,MAAkBF,UAAU,mBAAkBC,SAAA,EAC5CF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yEAAwEC,SACnFJ,EAAKX,MAERgB,EAAAA,EAAAA,MAAA,MAAIF,UAAU,mCAAkCC,SAAA,EAC9CF,EAAAA,EAAAA,KAAA,YACEL,MAAOG,EAAKV,MACZiB,SAAWC,GAAMb,EAAkBK,EAAKX,GAAI,QAASmB,EAAEC,OAAOZ,OAC9Da,YAAY,gCACZC,UAAW,GACXC,KAAM,EACNT,UAAU,uHAEZE,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,CACxCJ,EAAKV,MAAMuB,OAAO,wBAGvBX,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAC9CF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOG,EAAKT,YACZgB,SAAWC,GAAMb,EAAkBK,EAAKX,GAAI,cAAemB,EAAEC,OAAOZ,OACpEa,YAAY,yBACZP,UAAU,6GAGdD,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAC9CF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOG,EAAKR,MACZe,SAAWC,GAAMb,EAAkBK,EAAKX,GAAI,QAASmB,EAAEC,OAAOZ,OAC9DM,UAAU,6GAGdD,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAC9CC,EAAAA,EAAAA,MAAA,UACER,MAAOG,EAAKP,OACZc,SAAWC,GAAMb,EAAkBK,EAAKX,GAAI,SAAUmB,EAAEC,OAAOZ,OAC/DM,UAAU,wGAAuGC,SAAA,EAEjHF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,GAAEO,SAAC,wBAChBpB,EAAMe,IAAKgB,IACVV,EAAAA,EAAAA,MAAA,UAAsBR,MAAOkB,EAAK1B,GAAGe,SAAA,CAClCW,EAAKC,QAAQ,MAAID,EAAKE,OADZF,EAAK1B,YA1CjBW,EAAKX,aAuDtBgB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kCAAiCC,SAAA,EAC9CF,EAAAA,EAAAA,KAAA,UACEI,QAASvB,EACToB,UAAU,+FAA8FC,SACzG,cAGDF,EAAAA,EAAAA,KAAA,UACEI,QA3ISY,KAEjB,MAAMC,EAAgBjC,EAAYkC,OAAOpB,GAA8B,KAAtBA,EAAKV,MAAM+B,QAE5D,GAA6B,IAAzBF,EAAcN,OAEhB,YADAS,MAAM,2DASR,GAJ0BH,EAAcC,OAAOpB,IAC5CA,EAAKT,YAAY8B,SAAWrB,EAAKR,QAAUQ,EAAKP,QAG7BoB,OAAS,EAE7B,YADAS,MAAM,wEAKR,MAAMC,EAAoBJ,EAAcpB,IAAIC,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC3CD,GAAI,IACPX,GAAImC,OAAOC,aACXC,eAAe,IAAIC,MAAOC,cAC1BC,QAAS,eAGX5C,EAAOsC,GACPxC,KAgHQoB,UAAU,kFAAiFC,SAC5F,wCA9GW,MCgHtB,EA/KwBvB,IAAmD,IAAlD,OAAEC,EAAM,QAAEC,EAAO,OAAE+C,EAAM,MAAE9C,EAAK,SAAE+C,GAAUlD,EACnE,MAAOmD,EAAcC,IAAmB7C,EAAAA,EAAAA,UAAS,CAC/CC,GAAI,GACJC,MAAO,GACPC,YAAa,GACbC,MAAO,GACPC,OAAQ,GACRoC,QAAS,eAIXnC,EAAAA,EAAAA,WAAU,KACJZ,GAAUgD,GACZG,EAAgB,CACd5C,GAAIyC,EAAOzC,GACXC,MAAOwC,EAAOxC,OAAS,GACvBC,YAAauC,EAAOvC,aAAe,GACnCC,MAAOsC,EAAOtC,OAAS,GACvBC,OAAQqC,EAAOrC,QAAU,GACzBoC,QAASC,EAAOD,SAAW,eAG9B,CAAC/C,EAAQgD,IAEZ,MAAMnC,EAAoBA,CAACC,EAAOC,KAChCoC,EAAgBnC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACfH,GAAI,IACP,CAACF,GAAQC,MA+Bb,OAAKf,GAGHoB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6EAA4EC,UACzFC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,0DAAyDC,SAAA,EACtEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,gCACjDF,EAAAA,EAAAA,KAAA,UACEI,QAASvB,EACToB,UAAU,uDAAsDC,SACjE,aAKHC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EAExBC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,aAGhEF,EAAAA,EAAAA,KAAA,YACEL,MAAOmC,EAAa1C,MACpBiB,SAAWC,GAAMb,EAAkB,QAASa,EAAEC,OAAOZ,OACrDa,YAAY,gCACZC,UAAW,GACXC,KAAM,EACNT,UAAU,kHAEZE,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,CACxC4B,EAAa1C,MAAMuB,OAAO,wBAK/BR,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,mBAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOmC,EAAazC,YACpBgB,SAAWC,GAAMb,EAAkB,cAAea,EAAEC,OAAOZ,OAC3Da,YAAY,yBACZP,UAAU,yGAKdE,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,aAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOmC,EAAaxC,MACpBe,SAAWC,GAAMb,EAAkB,QAASa,EAAEC,OAAOZ,OACrDM,UAAU,yGAKdE,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,wBAGhEC,EAAAA,EAAAA,MAAA,UACER,MAAOmC,EAAavC,OACpBc,SAAWC,GAAMb,EAAkB,SAAUa,EAAEC,OAAOZ,OACtDM,UAAU,mGAAkGC,SAAA,EAE5GF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,GAAEO,SAAC,wBAChBpB,EAAMe,IAAKgB,IACVV,EAAAA,EAAAA,MAAA,UAAsBR,MAAOkB,EAAK1B,GAAGe,SAAA,CAClCW,EAAKC,QAAQ,MAAID,EAAKE,OADZF,EAAK1B,YAQxBgB,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,aAGhEC,EAAAA,EAAAA,MAAA,UACER,MAAOmC,EAAaH,QACpBtB,SAAWC,GAAMb,EAAkB,UAAWa,EAAEC,OAAOZ,OACvDM,UAAU,mGAAkGC,SAAA,EAE5GF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,YAAWO,SAAC,eAC1BF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,aAAYO,SAAC,gBAC3BF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,aAAYO,SAAC,yBAMjCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kCAAiCC,SAAA,EAC9CF,EAAAA,EAAAA,KAAA,UACEI,QAASvB,EACToB,UAAU,+FAA8FC,SACzG,cAGDF,EAAAA,EAAAA,KAAA,UACEI,QArISY,KAEZc,EAAa1C,MAAM+B,OAKnBW,EAAazC,YAAY8B,OAKzBW,EAAaxC,MAKbwC,EAAavC,QAMlBsC,EAASC,GACTjD,KANEuC,MAAM,oCALNA,MAAM,yBALNA,MAAM,+BALNA,MAAM,0BAmIAnB,UAAU,kFAAiFC,SAC5F,yCA5GW,MCiStB,EAtV4BvB,IAAmD,IAADqD,EAAAC,EAAAC,EAAA,IAAjD,WAAEC,EAAU,SAAEN,EAAQ,mBAAEO,GAAoBzD,EACvE,MAAO0D,EAAkBC,IAAuBpD,EAAAA,EAAAA,UAAS,OAClDqD,EAAmBC,IAAwBtD,EAAAA,EAAAA,UAAS,IAGrDuD,EAAe,CACnB,CAAE9C,MAAO,cAAe+C,MAAO,yBAA0BC,KAAM,gBAC/D,CAAEhD,MAAO,yBAA0B+C,MAAO,qCAAmCC,KAAM,gBACnF,CAAEhD,MAAO,eAAgB+C,MAAO,kBAAgBC,KAAM,sBACtD,CAAEhD,MAAO,WAAY+C,MAAO,0BAAwBC,KAAM,gBAC1D,CAAEhD,MAAO,WAAY+C,MAAO,+BAA6BC,KAAM,gBAC/D,CAAEhD,MAAO,SAAU+C,MAAO,gBAAiBC,KAAM,iBAG7CC,EAAgB,CACpB,CAAEjD,MAAO,QAAS+C,MAAO,cAAeG,YAAa,yBACrD,CAAElD,MAAO,YAAa+C,MAAO,YAAaG,YAAa,2BACvD,CAAElD,MAAO,SAAU+C,MAAO,aAAWG,YAAa,2BAClD,CAAElD,MAAO,SAAU+C,MAAO,SAAUG,YAAa,mBAG7CC,EAAa,CACjB,CAAEnD,MAAO,WAAY+C,MAAO,0BAC5B,CAAE/C,MAAO,YAAa+C,MAAO,sBAC7B,CAAE/C,MAAO,eAAgB+C,MAAO,mBAChC,CAAE/C,MAAO,YAAa+C,MAAO,wBAC7B,CAAE/C,MAAO,WAAY+C,MAAO,+BAC5B,CAAE/C,MAAO,gBAAiB+C,MAAO,eACjC,CAAE/C,MAAO,WAAY+C,MAAO,aAC5B,CAAE/C,MAAO,QAAS+C,MAAO,UAI3BlD,EAAAA,EAAAA,WAAU,KACR,GAAI6C,EAAkB,CAEpB,MAAMU,EAAU,CACdC,YAAaX,EAAiBY,aAC9BC,SAAUb,EAAiBa,SAC3BC,YAAad,EAAiBc,YAC9BC,WAAYf,EAAiBlD,GAC7BkE,aAAchB,EAAiBtB,MAIduC,OAAOC,KAAKR,GAASS,KAAKC,GAC3CtB,EAAWsB,KAASV,EAAQU,KAI5B5B,EAASkB,EAEb,GACC,CAACV,KAGJ7C,EAAAA,EAAAA,WAAU,KACR,GAA+B,WAA3B2C,EAAWa,aAA4BT,EAAmB,CAC5D,MAAMmB,EAAiBnB,EAAkBoB,cAAcC,QAAQ,OAAQ,KAGnEzB,EAAWI,oBAAsBA,GACnCV,EAAS,CACPmB,YAAaU,EACbnB,kBAAmBA,GAGzB,GACC,CAACA,EAAmBJ,EAAWa,cAqBlC,OACE7C,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,cAAaC,SAAA,EAC1BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,2CAA0CC,SAAC,2CAGzDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,gBAAeC,SAAC,2GAM/BC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4BAA2BC,SAAA,EACxCC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,+BAI1CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,2BAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOwC,EAAW0B,aAAe,GACjCxD,SAAWC,GAAMuB,EAAS,CAAEgC,YAAavD,EAAEC,OAAOZ,QAClDM,UAAU,iHACVO,YAAY,iDAIhBL,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,0BAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOwC,EAAW2B,gBAAkB,GACpCzD,SAAWC,GAAMuB,EAAS,CAAEiC,eAAgBxD,EAAEC,OAAOZ,QACrDM,UAAU,iHACVO,YAAY,6BAKlBL,EAAAA,EAAAA,MAAA,OAAKF,UAAU,OAAMC,SAAA,EACnBF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,iCAGhEF,EAAAA,EAAAA,KAAA,YACEL,MAAOwC,EAAW4B,oBAAsB,GACxC1D,SAAWC,GAAMuB,EAAS,CAAEkC,mBAAoBzD,EAAEC,OAAOZ,QACzDe,KAAM,EACNT,UAAU,iHACVO,YAAY,uEAMlBL,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4BAA2BC,SAAA,EACxCC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,yBAI1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wCAAuCC,SACnDuC,EAAa5C,IAAKe,IACjBZ,EAAAA,EAAAA,KAAA,UAEEI,QAASA,IA1FY4C,KAC/BnB,EAAS,CAAEmB,gBAGX,MAAMgB,EAAmB5B,EAAmB6B,KAAKC,GAC/CA,EAASjB,eAAiBD,GAI1BV,EADE0B,GAGkB,OA+EGG,CAAwBvD,EAAKjB,OAC5CM,UAAS,oDAAAmE,OACPjC,EAAWa,cAAgBpC,EAAKjB,MAC5B,iDACA,8DACHO,UAEHC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oBAAmBC,SAAA,EAChCF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,gBAAeC,SAAEU,EAAK+B,QACtCxC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAEU,EAAK8B,QACrB,2BAAf9B,EAAKjB,QACJK,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6BAA4BC,SAAC,6DAb7CU,EAAKjB,UAwBY,WAA3BwC,EAAWa,cACV7C,EAAAA,EAAAA,MAAA,OAAKF,UAAU,OAAMC,SAAA,EACnBF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,oCAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAO4C,EACPlC,SAAWC,GAAMkC,EAAqBlC,EAAEC,OAAOZ,OAC/CM,UAAU,iHACVO,YAAY,+DAOpBL,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,EACzCC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,gBAI1CC,EAAAA,EAAAA,MAAA,UACER,MAAOwC,EAAWe,UAAY,GAC9B7C,SAAWC,GAAMuB,EAAS,CAAEqB,SAAU5C,EAAEC,OAAOZ,QAC/CM,UAAU,iHAAgHC,SAAA,EAE1HF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,GAAEO,SAAC,6BAChB4C,EAAWjD,IAAKqD,IACflD,EAAAA,EAAAA,KAAA,UAA6BL,MAAOuD,EAASvD,MAAMO,SAChDgD,EAASR,OADCQ,EAASvD,eAQ5BQ,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,+BAI1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wCAAuCC,SACnD0C,EAAc/C,IAAKwE,IAClBlE,EAAAA,EAAAA,MAAA,UAEEC,QAASA,IAAMyB,EAAS,CAAEsB,YAAakB,EAAO1E,QAC9CM,UAAS,oDAAAmE,OACPjC,EAAWgB,cAAgBkB,EAAO1E,MAC9B,iDACA,8DACHO,SAAA,EAEHF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAEmE,EAAO3B,SACvC1C,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6BAA4BC,SAAEmE,EAAOxB,gBAT/CwB,EAAO1E,aAgBnByC,EAAmBzB,OAAS,IAC3BR,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,4BAI1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,YAAWC,SACvBkC,EACElB,OAAOgD,IACL/B,EAAWa,aACZkB,EAASjB,eAAiBd,EAAWa,aACrCkB,EAAShB,WAAaf,EAAWe,UAElCrD,IAAKqE,IACJlE,EAAAA,EAAAA,KAAA,UAEEI,QAASA,IAlLK8D,KAC5B5B,EAAoB4B,IAiLSI,CAAqBJ,GACpCjE,UAAS,2DAAAmE,QACS,OAAhB/B,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkBlD,MAAO+E,EAAS/E,GAC9B,kDACA,8DACHe,UAEHC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oCAAmCC,SAAA,EAChDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAEgE,EAASnD,QACzCf,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6BAA4BC,SACxCgE,EAASrB,eAEZ1C,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,CACxCgE,EAASf,YAAY,WAAIe,EAASK,wBAAwB,2BAClDL,EAASM,cAAc,IAAEN,EAASO,cAAc,mBAG5C,OAAhBpC,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkBlD,MAAO+E,EAAS/E,KACjCa,EAAAA,EAAAA,KAAA,QAAMC,UAAU,0BAAyBC,SAAC,eApBzCgE,EAAS/E,WA8B1BgB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,0BAI1CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,qBAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOwC,EAAWuC,WAAa,GAC/BrE,SAAWC,GAAMuB,EAAS,CAAE6C,UAAWpE,EAAEC,OAAOZ,QAChDM,UAAU,uHAIdE,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,gCAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOwC,EAAWwC,SAAW,GAC7BtE,SAAWC,GAAMuB,EAAS,CAAE8C,QAASrE,EAAEC,OAAOZ,QAC9CM,UAAU,6HAOhBkC,EAAW0B,aAAe1B,EAAWa,eACrC7C,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,EACzCF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,8BACjDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kCAAiCC,SAAA,CAC7CiC,EAAW0B,cAAe1D,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,oBAAaiC,EAAW0B,eACvD1B,EAAWa,cAAe7C,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,gBAAmE,QAA3D8B,EAACS,EAAawB,KAAKW,GAAKA,EAAEjF,QAAUwC,EAAWa,oBAAY,IAAAhB,OAAA,EAA1DA,EAA4DU,SACpGP,EAAWe,WAAY/C,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,qBAAmE,QAAtD+B,EAACa,EAAWmB,KAAKY,GAAKA,EAAElF,QAAUwC,EAAWe,iBAAS,IAAAjB,OAAA,EAArDA,EAAuDS,SACjGP,EAAWgB,cAAehD,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,0BAA2E,QAA5DgC,EAACU,EAAcqB,KAAKa,GAAKA,EAAEnF,QAAUwC,EAAWgB,oBAAY,IAAAjB,OAAA,EAA3DA,EAA6DQ,SAC5GL,IAAoBlC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,oBAAamC,EAAiBtB,kBCiCpE,EA/W2BpC,IAA+B,IAADoG,EAAAC,EAAA,IAA7B,WAAE7C,EAAU,SAAEN,GAAUlD,EAClD,MAAOsG,EAAaC,IAAkBhG,EAAAA,EAAAA,UAAS,KACxCiG,EAAWC,IAAgBlG,EAAAA,EAAAA,UAAS,CAAE6B,KAAM,GAAIsE,KAAM,GAAIC,WAAY,iBAGvEC,EAAmB,CACvB,CAAE5F,MAAO,SAAU+C,MAAO,uBAAqBG,YAAa,+CAC5D,CAAElD,MAAO,eAAgB+C,MAAO,2BAAyBG,YAAa,+CACtE,CAAElD,MAAO,SAAU+C,MAAO,wBAAsBG,YAAa,wCAC7D,CAAElD,MAAO,SAAU+C,MAAO,wBAAsBG,YAAa,sCAGzD2C,EAAY,CAChB,CAAE7F,MAAO,kBAAmB+C,MAAO,kBAAmBC,KAAM,kCAC5D,CAAEhD,MAAO,YAAa+C,MAAO,YAAaC,KAAM,kCAChD,CAAEhD,MAAO,QAAS+C,MAAO,eAAgBC,KAAM,gBAC/C,CAAEhD,MAAO,YAAa+C,MAAO,gBAAiBC,KAAM,gBACpD,CAAEhD,MAAO,WAAY+C,MAAO,eAAaC,KAAM,gBAC/C,CAAEhD,MAAO,YAAa+C,MAAO,YAAaC,KAAM,gBAChD,CAAEhD,MAAO,SAAU+C,MAAO,SAAUC,KAAM,gBAC1C,CAAEhD,MAAO,UAAW+C,MAAO,WAAYC,KAAM,gBAC7C,CAAEhD,MAAO,WAAY+C,MAAO,YAAaC,KAAM,gBAC/C,CAAEhD,MAAO,aAAc+C,MAAO,aAAWC,KAAM,sBAC/C,CAAEhD,MAAO,aAAc+C,MAAO,eAAgBC,KAAM,gBACpD,CAAEhD,MAAO,QAAS+C,MAAO,OAAQC,KAAM,iBAGnC8C,EAAiB,CACrB,CAAE9F,MAAO,MAAO+C,MAAO,OAAQG,YAAa,yDAC5C,CAAElD,MAAO,SAAU+C,MAAO,QAASG,YAAa,oCAChD,CAAElD,MAAO,OAAQ+C,MAAO,OAAQG,YAAa,0CAI/CrD,EAAAA,EAAAA,WAAU,KACR,GAAIyF,EAAYtE,OAAS,EAAG,CAC1B,MAAM+E,EAAmB,CACvB,OAAU,EACV,aAAgB,EAChB,OAAU,EACV,OAAU,GAONC,EAJaV,EAAYW,OAAO,CAACC,EAAKC,IAC1CD,GAAOH,EAAiBI,EAAOR,aAAe,GAAI,GAGlBL,EAAYtE,OAC9C,IAAIoF,EAAiB,eAEjBJ,GAAgB,IAAKI,EAAiB,SACjCJ,GAAgB,IAAKI,EAAiB,SACtCJ,GAAgB,MAAKI,EAAiB,UAE/ClE,EAAS,CACPmE,SAAUf,EAAYtE,OACtBoF,eAAgBA,EAChBd,YAAaA,GAEjB,MACEpD,EAAS,CACPmE,SAAU7D,EAAW6D,UAAY,EACjCD,eAAgB5D,EAAW4D,gBAAkB,eAC7Cd,YAAa,MAGhB,CAACA,IAGJ,MAoBMgB,EAAeC,IACnB,MAAMb,EAAOG,EAAUvB,KAAKkC,GAAKA,EAAExG,QAAUuG,GAC7C,OAAOb,EAAOA,EAAK1C,KAAO,gBAItByD,EAAgBF,IACpB,MAAMb,EAAOG,EAAUvB,KAAKkC,GAAKA,EAAExG,QAAUuG,GAC7C,OAAOb,EAAOA,EAAK3C,MAAQwD,GAG7B,OACE/F,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,cAAaC,SAAA,EAC1BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,2CAA0CC,SAAC,+CAGzDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,gBAAeC,SAAC,6EAM/BC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4BAA2BC,SAAA,EACxCC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,2BAI1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wCAAuCC,SACnD,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAIL,IAAKwG,IACpClG,EAAAA,EAAAA,MAAA,UAEEC,QAASA,IAAMyB,EAAS,CAAEmE,SAAUK,IACpCpG,UAAS,sDAAAmE,OACPjC,EAAW6D,WAAaK,EACpB,4CACA,0DACHnG,SAAA,EAEHF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,qBAAoBC,SAAEmG,KACrCrG,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wBAAuBC,SAC1B,IAATmG,EAAa,UAAY,eAVvBA,UAkBblG,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,EACzCC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,uEAAkB,gCAKnDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,sDAAqDC,SAAA,EAClEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,gCAEjDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,YAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOwF,EAAUpE,KACjBV,SAAWC,GAAM8E,EAAaxF,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUH,GAAI,IAAEmB,KAAMT,EAAEC,OAAOZ,SACjEM,UAAU,gHACVO,YAAY,+BAIhBL,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,SAGhEC,EAAAA,EAAAA,MAAA,UACER,MAAOwF,EAAUE,KACjBhF,SAAWC,GAAM8E,EAAaxF,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUH,GAAI,IAAEyF,KAAM/E,EAAEC,OAAOZ,SACjEM,UAAU,gHAA+GC,SAAA,EAEzHF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,GAAEO,SAAC,oBAChBsF,EAAU3F,IAAKwF,IACdlF,EAAAA,EAAAA,MAAA,UAAyBR,MAAO0F,EAAK1F,MAAMO,SAAA,CACxCmF,EAAK1C,KAAK,IAAE0C,EAAK3C,QADP2C,EAAK1F,eAOxBQ,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,iBAGhEF,EAAAA,EAAAA,KAAA,UACEL,MAAOwF,EAAUG,WACjBjF,SAAWC,GAAM8E,EAAaxF,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUH,GAAI,IAAE0F,WAAYhF,EAAEC,OAAOZ,SACvEM,UAAU,gHAA+GC,SAExHqF,EAAiB1F,IAAKyG,IACrBtG,EAAAA,EAAAA,KAAA,UAA0BL,MAAO2G,EAAM3G,MAAMO,SAC1CoG,EAAM5D,OADI4D,EAAM3G,iBAQ3BK,EAAAA,EAAAA,KAAA,UACEI,QAnIYmG,KACpB,GAAIpB,EAAUpE,KAAKI,QAAUgE,EAAUE,KAAM,CAC3C,MAAMS,EAAS,CACb3G,GAAIsC,KAAK+E,MACTzF,KAAMoE,EAAUpE,KAAKI,OACrBkE,KAAMF,EAAUE,KAChBC,WAAYH,EAAUG,YAGxBJ,EAAetF,GAAQ,IAAIA,EAAMkG,IACjCV,EAAa,CAAErE,KAAM,GAAIsE,KAAM,GAAIC,WAAY,gBACjD,GAyHQmB,UAAWtB,EAAUpE,KAAKI,SAAWgE,EAAUE,KAC/CpF,UAAU,0IAAyIC,SACpJ,yBAMF+E,EAAYtE,OAAS,IACpBR,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,8BAA6BC,SAAA,CAAC,wBAAsB+E,EAAYtE,OAAO,OACpFsE,EAAYpF,IAAKiG,IAAM,IAAAY,EAAA,OACtBvG,EAAAA,EAAAA,MAAA,OAAqBF,UAAU,mFAAkFC,SAAA,EAC/GC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oBAAmBC,SAAA,EAChCF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAE+F,EAAYH,EAAOT,SACnDlF,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAE4F,EAAO/E,QACvCZ,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wBAAuBC,SAAA,CACnCkG,EAAaN,EAAOT,MAAM,WAA6D,QAA1DqB,EAACnB,EAAiBtB,KAAK3D,GAAKA,EAAEX,QAAUmG,EAAOR,mBAAW,IAAAoB,OAAA,EAAzDA,EAA2DhE,gBAIhG1C,EAAAA,EAAAA,KAAA,UACEI,QAASA,KAAMuG,OA5ILC,EA4IsBd,EAAO3G,QA3IrD+F,EAAetF,GAAQA,EAAKsB,OAAO4E,GAAUA,EAAO3G,KAAOyH,IADnCA,OA6IV3G,UAAU,oDAAmDC,SAC9D,yBAbO4F,EAAO3G,aAuBzBgB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,sCAI1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wCAAuCC,SACnDqF,EAAiB1F,IAAKyG,IACrBnG,EAAAA,EAAAA,MAAA,UAEEC,QAASA,IAAMyB,EAAS,CAAEkE,eAAgBO,EAAM3G,QAChDM,UAAS,oDAAAmE,OACPjC,EAAW4D,iBAAmBO,EAAM3G,MAChC,kDACA,8DACHO,SAAA,EAEHF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAEoG,EAAM5D,SACtC1C,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6BAA4BC,SAAEoG,EAAMzD,gBAT9CyD,EAAM3G,cAgBnBQ,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,WAAQ,gCAIzCF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wCAAuCC,SACnD,CACC,CAAEP,MAAO,GAAI+C,MAAO,MAAOG,YAAa,kBACxC,CAAElD,MAAO,GAAI+C,MAAO,MAAOG,YAAa,gBACxC,CAAElD,MAAO,GAAI+C,MAAO,MAAOG,YAAa,mBACxC,CAAElD,MAAO,IAAK+C,MAAO,OAAQG,YAAa,wBAC1ChD,IAAKgH,IACL1G,EAAAA,EAAAA,MAAA,UAEEC,QAASA,IAAMyB,EAAS,CAAEiF,iBAAkBD,EAAalH,QACzDM,UAAS,sDAAAmE,OACPjC,EAAW2E,mBAAqBD,EAAalH,MACzC,kDACA,8DACHO,SAAA,EAEHF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,qBAAoBC,SAAE2G,EAAanE,SAClD1C,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wBAAuBC,SAAE2G,EAAahE,gBAThDgE,EAAalH,cAgB1BQ,EAAAA,EAAAA,MAAA,OAAKF,UAAU,2BAA0BC,SAAA,EACvCC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,2BAI1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,YAAWC,SACvBuF,EAAe5F,IAAKkH,IACnB5G,EAAAA,EAAAA,MAAA,UAEEC,QAASA,IAAMyB,EAAS,CAAEmF,cAAeD,EAAKpH,QAC9CM,UAAS,2DAAAmE,OACPjC,EAAW6E,gBAAkBD,EAAKpH,MAC9B,yCACA,wDACHO,SAAA,EAEHF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAE6G,EAAKrE,SACrC1C,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6BAA4BC,SAAE6G,EAAKlE,gBAT7CkE,EAAKpH,cAgBlBQ,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,+BAI1CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,6BAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACLjB,MAAOwC,EAAW8E,QAAU,GAC5B5G,SAAWC,GAAMuB,EAAS,CAAEoF,OAAQC,WAAW5G,EAAEC,OAAOZ,QAAU,IAClEM,UAAU,iHACVO,YAAY,kBAIhBL,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,+BAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACLjB,MAAOwC,EAAWgF,eAAiB,GACnC9G,SAAWC,GAAMuB,EAAS,CAAEsF,cAAeD,WAAW5G,EAAEC,OAAOZ,QAAU,IACzEM,UAAU,iHACVO,YAAY,wBAOpBL,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,EACzCF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,kCACjDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kCAAiCC,SAAA,EAC9CC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,kBAAWiC,EAAW6D,UAAY,EAAE,gBACzC7F,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,uBAAiF,QAAlE6E,EAACQ,EAAiBtB,KAAK3D,GAAKA,EAAEX,QAAUwC,EAAW4D,uBAAe,IAAAhB,OAAA,EAAjEA,EAAmErC,SACvFP,EAAW2E,mBAAoB3G,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,0BAAmBiC,EAAW2E,iBAAiB,OACnF3E,EAAW6E,gBAAiB7G,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,kBAAyE,QAA/D8E,EAACS,EAAexB,KAAKkC,GAAKA,EAAExG,QAAUwC,EAAW6E,sBAAc,IAAAhC,OAAA,EAA9DA,EAAgEtC,SAC5GP,EAAW8E,SAAU9G,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,wBAAiBiC,EAAW8E,OAAOG,oBAC7DnC,EAAYtE,OAAS,IAAKR,EAAAA,EAAAA,MAAA,OAAAD,SAAA,CAAK,8BAAuB+E,EAAYtE,oBCzG7E,EA/PgChC,IAGzB,IAH0B,WAC/BwD,EAAU,SACVN,GACDlD,EACC,MAAO0I,EAAYC,IAAiBpI,EAAAA,EAAAA,UAAS,KACtCqI,EAAcC,IAAmBtI,EAAAA,EAAAA,UAAS,KAC1CuI,EAAaC,IAAkBxI,EAAAA,EAAAA,WAAS,IAG/CM,EAAAA,EAAAA,WAAU,KACR,MAAMmI,EAAuBC,EAAwBzF,EAAWa,aAChEsE,EAAcK,IACb,CAACxF,EAAWa,eAGfxD,EAAAA,EAAAA,WAAU,KACRqC,EAAS,CAAEwF,gBACV,CAACA,EAAYxF,IAGhB,MAAM+F,EAA2B5E,IAC/B,MAAM6E,EAAqB,CACzB,aAAgB,CACd,CAAE1I,GAAI,cAAe4B,KAAM,gCAA8B8B,YAAa,oEACtE,CAAE1D,GAAI,cAAe4B,KAAM,uBAAwB8B,YAAa,uCAChE,CAAE1D,GAAI,cAAe4B,KAAM,6BAA8B8B,YAAa,kCACtE,CAAE1D,GAAI,cAAe4B,KAAM,kCAAmC8B,YAAa,4DAC3E,CAAE1D,GAAI,cAAe4B,KAAM,uBAAwB8B,YAAa,4CAElE,SAAY,CACV,CAAE1D,GAAI,cAAe4B,KAAM,+BAA6B8B,YAAa,oDACrE,CAAE1D,GAAI,cAAe4B,KAAM,4BAA6B8B,YAAa,6CACrE,CAAE1D,GAAI,cAAe4B,KAAM,6BAA8B8B,YAAa,0CACtE,CAAE1D,GAAI,cAAe4B,KAAM,4BAA6B8B,YAAa,sCACrE,CAAE1D,GAAI,cAAe4B,KAAM,oCAAkC8B,YAAa,qCAE5E,YAAe,CACb,CAAE1D,GAAI,cAAe4B,KAAM,8BAA4B8B,YAAa,+CACpE,CAAE1D,GAAI,cAAe4B,KAAM,2BAA4B8B,YAAa,iCACpE,CAAE1D,GAAI,cAAe4B,KAAM,kCAA6B8B,YAAa,iDACrE,CAAE1D,GAAI,cAAe4B,KAAM,6BAA2B8B,YAAa,mCACnE,CAAE1D,GAAI,cAAe4B,KAAM,8BAA4B8B,YAAa,sCAEtE,QAAW,CACT,CAAE1D,GAAI,cAAe4B,KAAM,0BAA2B8B,YAAa,+BACnE,CAAE1D,GAAI,cAAe4B,KAAM,oCAAkC8B,YAAa,wCAC1E,CAAE1D,GAAI,cAAe4B,KAAM,6BAA2B8B,YAAa,+CACnE,CAAE1D,GAAI,cAAe4B,KAAM,gCAAiC8B,YAAa,gDACzE,CAAE1D,GAAI,cAAe4B,KAAM,yBAA0B8B,YAAa,gCAItE,OAAOgF,EAAmB7E,IAAgB6E,EAAmBC,SAIzDC,EAAeA,KACnB,IAAKR,EAAapG,OAAQ,OAE1B,MAAM6G,EAAY,CAChB7I,GAAG,aAADiF,OAAe3C,KAAK+E,OACtBzF,KAAMwG,EAAapG,OACnB0B,YAAa,GACboF,UAAU,GAGZX,EAAc1H,GAAQ,IAAIA,EAAMoI,IAChCR,EAAgB,IAChBE,GAAe,IASXQ,EAAgBA,CAACC,EAAazI,EAAOC,KACzC2H,EAAc1H,GAAQA,EAAKC,IAAIiF,GAC7BA,EAAE3F,KAAOgJ,GAAWpI,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ+E,GAAC,IAAE,CAACpF,GAAQC,IAAUmF,KAKhDsD,EAAoBA,CAACC,EAAWC,KACpChB,EAAc1H,IACZ,MAAM2I,EAAgB,IAAI3I,IACnB4I,GAASD,EAAcE,OAAOJ,EAAW,GAEhD,OADAE,EAAcE,OAAOH,EAAS,EAAGE,GAC1BD,KAIX,OACEpI,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wBAAuBC,SAAA,EACpCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,OAAMC,SAAA,EACnBC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,0DAAyDC,SAAA,EACrEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,gBAAeC,SAAC,iBAAS,iCAG3CF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,wCAAuCC,SAAC,gNAOvDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,iBAAgBC,SAC5BmH,EAAWxH,IAAI,CAACmI,EAAWU,KAC1B1I,EAAAA,EAAAA,KAAA,OAAwBC,UAAU,2DAA0DC,UAC1FC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mCAAkCC,SAAA,EAC/CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,SAAQC,SAAA,EACrBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mCAAkCC,SAAA,EAC/CF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,WAAUC,SAAC,kBAC3BF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,SAAQC,UACrBF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOqI,EAAUjH,KACjBV,SAAWC,GAAM4H,EAAcF,EAAU7I,GAAI,OAAQmB,EAAEC,OAAOZ,OAC9DM,UAAU,8IACVO,YAAY,0BAKlBR,EAAAA,EAAAA,KAAA,YACEL,MAAOqI,EAAUnF,YACjBxC,SAAWC,GAAM4H,EAAcF,EAAU7I,GAAI,cAAemB,EAAEC,OAAOZ,OACrEM,UAAU,oHACVO,YAAY,qCACZE,KAAM,IAGPsH,EAAUC,WACTjI,EAAAA,EAAAA,KAAA,OAAKC,UAAU,OAAMC,UACnBF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,gGAA+FC,SAAC,+BAOtHC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mCAAkCC,SAAA,CAE9CwI,EAAQ,IACP1I,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMgI,EAAkBM,EAAOA,EAAQ,GAChDzI,UAAU,sDACV0I,MAAM,qBAAoBzI,SAC3B,iBAKFwI,EAAQrB,EAAW1G,OAAS,IAC3BX,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMgI,EAAkBM,EAAOA,EAAQ,GAChDzI,UAAU,sDACV0I,MAAM,oBAAmBzI,SAC1B,kBAMHF,EAAAA,EAAAA,KAAA,UACEI,QAASA,KAAMwI,OA9FNT,EA8FsBH,EAAU7I,QA7FvDmI,EAAc1H,GAAQA,EAAKsB,OAAO4D,GAAKA,EAAE3F,KAAOgJ,IADzBA,OA+FTlI,UAAU,oDACV0I,MAAM,gBAAezI,SACtB,8BA5DG8H,EAAU7I,OAsEvBsI,GACCtH,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wDAAuDC,SAAA,EACpEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,2CAA0CC,SAAC,wBACzDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAO4H,EACPlH,SAAWC,GAAMkH,EAAgBlH,EAAEC,OAAOZ,OAC1CM,UAAU,yGACVO,YAAY,wBACZqI,WAAavI,GAAgB,UAAVA,EAAEmD,KAAmBsE,IACxCe,WAAS,KAEX3I,EAAAA,EAAAA,MAAA,OAAKF,UAAU,iBAAgBC,SAAA,EAC7BF,EAAAA,EAAAA,KAAA,UACEI,QAAS2H,EACTtB,UAAWc,EAAapG,OACxBlB,UAAU,kIAAiIC,SAC5I,kBAGDF,EAAAA,EAAAA,KAAA,UACEI,QAASA,KACPsH,GAAe,GACfF,EAAgB,KAElBvH,UAAU,+FAA8FC,SACzG,uBAOPC,EAAAA,EAAAA,MAAA,UACEC,QAASA,IAAMsH,GAAe,GAC9BzH,UAAU,0IAAyIC,SAAA,EAEnJF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,WAAQ,iCAM3CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4DAA2DC,SAAA,EACxEC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,uDAAsDC,SAAA,EAClEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,OAAMC,SAAC,iBAAS,kCAGlCC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,oCAAmCC,SAAA,EAC/CF,EAAAA,EAAAA,KAAA,MAAAE,SAAI,wDACJF,EAAAA,EAAAA,KAAA,MAAAE,SAAI,oDACJF,EAAAA,EAAAA,KAAA,MAAAE,SAAI,mDACJF,EAAAA,EAAAA,KAAA,MAAAE,SAAI,iEAKRF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wDAAuDC,UACpEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oCAAmCC,SAAA,EAChDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8BAA6BC,SAAC,sBAC5CC,EAAAA,EAAAA,MAAA,KAAGF,UAAU,wBAAuBC,SAAA,CACjCmH,EAAW1G,OAAO,2CAGvBR,EAAAA,EAAAA,MAAA,OAAKF,UAAU,aAAYC,SAAA,EACzBF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,mCAAkCC,SAAEmH,EAAW1G,UAC9DX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wBAAuBC,SAAC,sBCsFnD,EA7U4BvB,IAA+B,IAA9B,WAAEwD,EAAU,SAAEN,GAAUlD,EACnD,MAAOoK,EAAeC,IAAoB9J,EAAAA,EAAAA,UAAS,CACjD+J,aAAc9G,EAAW8G,cAAgB,GACzCC,iBAAkB/G,EAAW+G,kBAAoB,QACjDC,uBAAwBhH,EAAWgH,yBAA0B,EAC7DC,mBAAoBjH,EAAWiH,qBAAsB,EACrDC,wBAAyBlH,EAAWkH,yBAA2B,EAC/DC,gBAAiBnH,EAAWmH,iBAAmB,CAC7C,CAAEC,WAAY,GAAI1G,YAAa,mBAAoB2G,OAAQ,SAC3D,CAAED,WAAY,GAAI1G,YAAa,aAAc2G,OAAQ,gBAIlDC,EAAQC,IAAaxK,EAAAA,EAAAA,UAAS,CAAC,IAEtCM,EAAAA,EAAAA,WAAU,KACRqC,EAASkH,IACR,CAACA,EAAelH,IAEnB,MAAMpC,EAAoBA,CAACC,EAAOC,KAChCqJ,EAAiBpJ,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBH,GAAI,IACP,CAACF,GAAQC,KAIP8J,EAAO/J,IACTgK,EAAU9J,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACTH,GAAI,IACP,CAACF,GAAQ,SAKTiK,EAA6BA,CAACjB,EAAOhJ,EAAOC,KAChD,MAAMiK,EAAqB,IAAIb,EAAcO,iBAC7CM,EAAmBlB,IAAM3I,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACpB6J,EAAmBlB,IAAM,IAC5B,CAAChJ,GAAQC,IAGXF,EAAkB,kBAAmBmK,IAWjCC,EAA2BC,IAC/B,OAAQA,GACN,KAAK,EACH,MAAO,CAAC,CAAEP,WAAY,IAAK1G,YAAa,gBAAiB2G,OAAQ,aACnE,KAAK,EAWL,QACE,MAAO,CACL,CAAED,WAAY,GAAI1G,YAAa,mBAAoB2G,OAAQ,SAC3D,CAAED,WAAY,GAAI1G,YAAa,aAAc2G,OAAQ,aATzD,KAAK,EACH,MAAO,CACL,CAAED,WAAY,GAAI1G,YAAa,mBAAoB2G,OAAQ,SAC3D,CAAED,WAAY,GAAI1G,YAAa,oBAAqB2G,OAAQ,YAC5D,CAAED,WAAY,GAAI1G,YAAa,aAAc2G,OAAQ,eAsD7D,OALAhK,EAAAA,EAAAA,WAAU,KAvBWuK,MACnB,MAAMC,EAAY,CAAC,IAEdjB,EAAcE,cAAgBF,EAAcE,cAAgB,KAC/De,EAAUf,aAAe,uCAGtBF,EAAcM,yBAA2BN,EAAcM,wBAA0B,KACpFW,EAAUX,wBAA0B,wCAGtC,MAAMY,EAAkBlB,EAAcO,gBAAgB1D,OAAO,CAACC,EAAKqE,IACjErE,GAAOqB,WAAWgD,EAAQX,aAAe,GAAI,GAG3CY,KAAKC,IAAIH,EAAkB,KAAO,MACpCD,EAAUV,gBAAkB,kCAG9BI,EAAUM,GACH1G,OAAOC,KAAKyG,GAAWrJ,QAK9BoJ,IACC,CAAChB,KAGF5I,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,cAAaC,SAAA,EAC1BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,2CAA0CC,SAAC,kDAGzDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,gBAAeC,SAAC,yFAM/BC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,iDAAgDC,SAAA,EAC7DF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yCAAwCC,SAAC,+CAIvDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,uBAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACLyJ,IAAI,IACJ1K,MAAOoJ,EAAcE,aACrB5I,SAAWC,GAAMb,EAAkB,eAAgB6K,SAAShK,EAAEC,OAAOZ,QAAU,IAC/EM,UAAS,0FAAAmE,OACPqF,EAAOR,aAAe,iBAAmB,mBAE3CzI,YAAY,WAEbiJ,EAAOR,eACNjJ,EAAAA,EAAAA,KAAA,KAAGC,UAAU,4BAA2BC,SAAEuJ,EAAOR,mBAIrD9I,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,sBAGhEC,EAAAA,EAAAA,MAAA,UACER,MAAOoJ,EAAcG,iBACrB7I,SAAWC,GAAMb,EAAkB,mBAAoBa,EAAEC,OAAOZ,OAChEM,UAAU,yGAAwGC,SAAA,EAElHF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,OAAMO,SAAC,aACrBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,QAAOO,SAAC,aACtBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,SAAQO,SAAC,oBAK7BF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,6BAA4BC,SAAC,0GAM5CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,iDAAgDC,SAAA,EAC7DF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yCAAwCC,SAAC,wCAIvDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EAExBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8DAA6DC,SAAA,EAC1EC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,4BAA2BC,SAAC,sDAG1CF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,wBAAuBC,SAAC,mFAIvCC,EAAAA,EAAAA,MAAA,SAAOF,UAAU,oBAAmBC,SAAA,EAClCF,EAAAA,EAAAA,KAAA,SACEY,KAAK,WACL2J,QAASxB,EAAcI,uBACvB9I,SAAWC,GAAMb,EAAkB,yBAA0Ba,EAAEC,OAAOgK,SACtEtK,UAAU,uDAEZD,EAAAA,EAAAA,KAAA,QAAMC,UAAU,6BAA4BC,SAAC,iBAKjDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8DAA6DC,SAAA,EAC1EC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,4BAA2BC,SAAC,yCAG1CF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,wBAAuBC,SAAC,2EAIvCC,EAAAA,EAAAA,MAAA,SAAOF,UAAU,oBAAmBC,SAAA,EAClCF,EAAAA,EAAAA,KAAA,SACEY,KAAK,WACL2J,QAASxB,EAAcK,mBACvB/I,SAAWC,GAAMb,EAAkB,qBAAsBa,EAAEC,OAAOgK,SAClEtK,UAAU,uDAEZD,EAAAA,EAAAA,KAAA,QAAMC,UAAU,6BAA4BC,SAAC,uBAOrDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,iDAAgDC,SAAA,EAC7DF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yCAAwCC,SAAC,0CAKvDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,OAAMC,SAAA,EACnBF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,uDAGhEF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,yBAAwBC,SACpC,CAAC,EAAG,EAAG,GAAGL,IAAKiK,IACd3J,EAAAA,EAAAA,MAAA,UAEES,KAAK,SACLR,QAASA,IAxMsB0J,KAC3CrK,EAAkB,0BAA2BqK,GAG7C,MAAMU,EAAkBX,EAAwBC,GAChDrK,EAAkB,kBAAmB+K,IAmMVC,CAAoCX,GACnD7J,UAAS,yDAAAmE,OACP2E,EAAcM,0BAA4BS,EACtC,2CACA,uDACH5J,SAAA,EAEHF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wBAAuBC,SAAE4J,KACxC9J,EAAAA,EAAAA,KAAA,OAAKC,UAAU,UAASC,SACV,IAAX4J,EAAe,gBACJ,IAAXA,EAAe,gBACf,qBAbEA,MAkBVL,EAAOJ,0BACNrJ,EAAAA,EAAAA,KAAA,KAAGC,UAAU,4BAA2BC,SAAEuJ,EAAOJ,8BAKrDlJ,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,CACvB6I,EAAcO,gBAAgBzJ,IAAI,CAACqK,EAASxB,KAC3CvI,EAAAA,EAAAA,MAAA,OAAiBF,UAAU,kEAAiEC,SAAA,EAC1FC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,oBAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACLyJ,IAAI,IACJK,IAAI,MACJC,KAAK,OACLhL,MAAOuK,EAAQX,WACflJ,SAAWC,GAAMqJ,EAA2BjB,EAAO,aAAcxB,WAAW5G,EAAEC,OAAOZ,QAAU,IAC/FM,UAAU,yGACVO,YAAY,WAIhBL,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,oBAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOuK,EAAQrH,YACfxC,SAAWC,GAAMqJ,EAA2BjB,EAAO,cAAepI,EAAEC,OAAOZ,OAC3EM,UAAU,yGACVO,YAAY,yBAIhBL,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,sBAGhEC,EAAAA,EAAAA,MAAA,UACER,MAAOuK,EAAQV,OACfnJ,SAAWC,GAAMqJ,EAA2BjB,EAAO,SAAUpI,EAAEC,OAAOZ,OACtEM,UAAU,yGAAwGC,SAAA,EAElHF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,QAAOO,SAAC,oCACtBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,aAAYO,SAAC,+BAC3BF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,WAAUO,SAAC,oCACzBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,WAAUO,SAAC,oCACzBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,eAAcO,SAAC,oCAC7BF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,cAAaO,SAAC,gDA5CxBwI,IAkDXe,EAAOH,kBACNtJ,EAAAA,EAAAA,KAAA,KAAGC,UAAU,uBAAsBC,SAAEuJ,EAAOH,mBAG9CnJ,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oCAAmCC,SAAA,CAAC,UACzC6I,EAAcO,gBAAgB1D,OAAO,CAACC,EAAKqE,IACjDrE,GAAOqB,WAAWgD,EAAQX,aAAe,GAAI,GAC7CqB,QAAQ,GAAG,iBCmDzB,EAxXwBjM,IAAkE,IAADkM,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,IAAhE,WAAEjJ,EAAU,kBAAEkJ,EAAiB,aAAEC,EAAY,WAAEC,GAAY5M,EAClF,MAAO6M,EAAcC,IAAmBvM,EAAAA,EAAAA,UAAS,aAC1CwM,EAAqBC,IAA0BzM,EAAAA,EAAAA,WAAS,GAG/D0M,QAAQC,IAAI,sCAA6B,CACvC1J,aACAkJ,kBAAmBA,EAAoB,WAAa,UACpDC,eACAQ,gBAAiBP,IAInB,MAOMQ,EAAkBC,GAClBA,EAAO,EAAS,GAAN5H,OAAU4H,EAAI,YACxBA,EAAO,GAAU,GAAN5H,OAAU+F,KAAK8B,MAAMD,EAAO,GAAE,YACvC,GAAN5H,OAAU+F,KAAK8B,MAAMD,EAAO,IAAG,UA8B3BE,EApBkBC,KAAc,IAADC,EACnC,IAAKD,EAAU,OAAO,KAEtB,MAAME,EAAaF,EAASE,YAAc,GACpChF,EAAa8E,EAAS9E,YAAc,GAEpCiF,EAAgBD,EAAWzG,OAAO,CAACC,EAAK0G,IAAa1G,GAAO0G,EAASC,UAAY,GAAI,GACrFC,EAAyBJ,EAAWnL,OAAOwL,GAAoB,SAAfA,EAAEC,UAAqBhM,OACvEiM,GAA8C,QAArBR,EAAAD,EAASU,oBAAY,IAAAT,OAAA,EAArBA,EAAuBzL,SAAU,EAEhE,MAAO,CACLmM,gBAAiBT,EAAW1L,OAC5BoM,gBAAiB1F,EAAW1G,OAC5B2L,cAAeA,EACfG,uBAAwBA,EACxBG,uBAAwBA,EACxBI,wBAAyBX,EAAW1L,OAAS,EAAIwJ,KAAK8B,MAAMK,EAAgBD,EAAW1L,QAAU,IAIvFsM,CAAe5B,GAE7B,OACElL,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,cAAaC,SAAA,EAC1BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,2CAA0CC,SAAC,8CAGzDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,gBAAeC,SAAC,8EAM7BmL,IAAsBC,IACtBnL,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wEAAuEC,SAAA,EACpFF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAC,kBAC/BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,2CAA0CC,SAAC,2CAGzDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,qBAAoBC,SAAC,yHAGlCF,EAAAA,EAAAA,KAAA,UACEI,QAhEa8M,KAChB7B,GAAsBC,GACzBC,KA+DMtL,UAAU,8KAA6KC,SACxL,8CAOJoL,IACCnL,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6BAA4BC,SAAC,kBAC5CF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,2CAA0CC,SAAC,6BAGzDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,qBAAoBC,SAAC,wGAGlCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6CAA4CC,SAAA,EACzDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,qDACfD,EAAAA,EAAAA,KAAA,OAAKC,UAAU,kDAAkDkN,MAAO,CAAEC,eAAgB,WAC1FpN,EAAAA,EAAAA,KAAA,OAAKC,UAAU,kDAAkDkN,MAAO,CAAEC,eAAgB,gBAM/F/B,IACClL,EAAAA,EAAAA,MAAAkN,EAAAA,SAAA,CAAAnN,SAAA,EAEEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4BAA2BC,SAAA,EACxCC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6DAA4DC,SAAA,EACxEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,kCAI1CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,0CAAyCC,SAAC,cAC3DF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,8BAA6BC,SAAEiC,EAAW0B,kBAEzD1D,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,0CAAyCC,SAAC,UAC3DF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,gBAAeC,SAAEiC,EAAWa,kBAE3C7C,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,0CAAyCC,SAAC,oBAC3DF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,gBAAeC,SAAEiC,EAAWgB,kBAE3ChD,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,0CAAyCC,SAAC,YAC3DC,EAAAA,EAAAA,MAAA,KAAGF,UAAU,gBAAeC,SAAA,CAAEiC,EAAW6D,SAAS,wBAMvDkG,IACC/L,EAAAA,EAAAA,MAAA,OAAKF,UAAU,uDAAsDC,SAAA,EACnEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,mCAAkCC,SAAEgM,EAAMY,mBACzD9M,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wBAAuBC,SAAC,oBAEzCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,oCAAmCC,SAAEgM,EAAMa,mBAC1D/M,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wBAAuBC,SAAC,cAEzCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,0CAAyCC,SAAA,EACtDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,qCAAoCC,SAAE6L,EAAeG,EAAMI,kBAC1EtM,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wBAAuBC,SAAC,0BAEzCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,0CAAyCC,SAAA,EACtDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,qCAAoCC,SAAEgM,EAAMU,0BAC3D5M,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wBAAuBC,SAAC,2BAM7CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6CAA4CC,SAAA,EACzDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gCAA+BC,SAC3C,CACC,CAAEf,GAAI,WAAYuD,MAAO,UAAWC,KAAM,gBAC1C,CAAExD,GAAI,aAAcuD,MAAO,cAAeC,KAAM,gBAChD,CAAExD,GAAI,aAAcuD,MAAO,QAASC,KAAM,gBAC1C,CAAExD,GAAI,WAAYuD,MAAO,aAAcC,KAAM,iBAC7C9C,IAAKyN,IACLnN,EAAAA,EAAAA,MAAA,UAEEC,QAASA,IAAMqL,EAAgB6B,EAAKnO,IACpCc,UAAS,0DAAAmE,OACPoH,IAAiB8B,EAAKnO,GAClB,4DACA,sDACHe,SAAA,EAEHF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,OAAMC,SAAEoN,EAAK3K,OAC5B2K,EAAK5K,QATD4K,EAAKnO,QAchBgB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,MAAKC,SAAA,CAEA,aAAjBsL,IACCrL,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,4BACjDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4BAA2BC,SAAA,EACxCF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,8BACjDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,mCAAkCC,SAAE6L,EAAeG,EAAMI,kBACtEnM,EAAAA,EAAAA,MAAA,KAAGF,UAAU,wBAAuBC,SAAA,CACjCgM,EAAMc,wBAAwB,yCAGnC7M,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4BAA2BC,SAAA,EACxCF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,iBACjDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,8CAA6CC,UAC7B,QAA1B2K,EAAAQ,EAAkBkC,gBAAQ,IAAA1C,OAAA,EAA1BA,EAA4B2C,aAAc,YAE7CrN,EAAAA,EAAAA,MAAA,KAAGF,UAAU,wBAAuBC,SAAA,CACjCgM,EAAMO,uBAAuB,8CAMtCtM,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,wBACjDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4BAA2BC,SAAA,EACxCF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,8BAA6BC,UACb,QAA1B4K,EAAAO,EAAkBkC,gBAAQ,IAAAzC,OAAA,EAA1BA,EAA4B2C,eAAgB,sCAE/CtN,EAAAA,EAAAA,MAAA,KAAGF,UAAU,6BAA4BC,SAAA,CAAC,gBAxL1CwN,EAyLoD,QAA3B3C,EAACM,EAAkBkC,gBAAQ,IAAAxC,OAAA,EAA1BA,EAA4B4C,YAxLnED,EACE,IAAIjM,KAAKiM,GAAYE,mBAAmB,SADvB,oBA0LsB,QAA3B5C,EAACK,EAAkBkC,gBAAQ,IAAAvC,GAA1BA,EAA4ByC,gBAC5BzN,EAAAA,EAAAA,KAAA,KAAGC,UAAU,6BAA4BC,SAAC,+FAUlC,eAAjBsL,IACCrL,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,mCAAkCC,SAAA,CAAC,2BAAoD,QAA5B+K,EAAAI,EAAkBgB,kBAAU,IAAApB,OAAA,EAA5BA,EAA8BtK,SAAU,EAAE,QACnHX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,qCAAoCC,SACpB,QADoBgL,EAChDG,EAAkBgB,kBAAU,IAAAnB,OAAA,EAA5BA,EAA8BrL,IAAI,CAAC0M,EAAU7D,KAC5C1I,EAAAA,EAAAA,KAAA,OAAuBC,UAAU,mDAAkDC,UACjFC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oCAAmCC,SAAA,EAChDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,SAAQC,SAAA,EACrBF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8BAA6BC,SAAEqM,EAASxL,QACtDf,EAAAA,EAAAA,KAAA,KAAGC,UAAU,6BAA4BC,SAAEqM,EAAS1J,eACpD1C,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yDAAwDC,SAAA,EACrEC,EAAAA,EAAAA,MAAA,QAAAD,SAAA,CAAM,gBAAIqM,EAASC,SAAS,eAC5BrM,EAAAA,EAAAA,MAAA,QAAAD,SAAA,CAAM,gBAAIqM,EAASsB,aACnB1N,EAAAA,EAAAA,MAAA,QAAAD,SAAA,CAAM,gBAAIqM,EAASI,aACnBxM,EAAAA,EAAAA,MAAA,QAAAD,SAAA,CAAM,gBAAIqM,EAASuB,qBAGvB3N,EAAAA,EAAAA,MAAA,OAAKF,UAAU,aAAYC,SAAA,EACzBF,EAAAA,EAAAA,KAAA,OAAKC,UAAS,gDAAAmE,OACU,SAAtBmI,EAASI,SAAsB,0BACT,WAAtBJ,EAASI,SAAwB,gCACjC,+BACCzM,SACAqM,EAASI,WAEXJ,EAASwB,aACR5N,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,CAAC,cAC9BiK,KAAK8B,MAA4B,IAAtBM,EAASwB,YAAkB,cAtBlDxB,EAASpN,UAkCT,eAAjBqM,IACCrL,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,mCAAkCC,SAAA,CAAC,qBAA8C,QAA5BiL,EAAAE,EAAkBhE,kBAAU,IAAA8D,OAAA,EAA5BA,EAA8BxK,SAAU,EAAE,QAC7GX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,YAAWC,SACK,QADLkL,EACvBC,EAAkBhE,kBAAU,IAAA+D,OAAA,EAA5BA,EAA8BvL,IAAI,CAACmI,EAAWU,KAC7C1I,EAAAA,EAAAA,KAAA,OAAwBC,UAAU,qFAAoFC,UACpHC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oBAAmBC,SAAA,EAChCF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,gBAAeC,SAAC,kBAChCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,SAAQC,SAAA,EACrBF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8BAA6BC,SAAE8H,EAAUjH,QACvDf,EAAAA,EAAAA,KAAA,KAAGC,UAAU,6BAA4BC,SAAE8H,EAAUnF,eACrD1C,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yDAAwDC,SAAA,EACrEC,EAAAA,EAAAA,MAAA,QAAAD,SAAA,CAAM,gBAAI8H,EAAUgG,UACpB7N,EAAAA,EAAAA,MAAA,QAAAD,SAAA,CAAM,gBAAI8H,EAAU8F,iBAErB9F,EAAUiG,WACTjO,EAAAA,EAAAA,KAAA,OAAKC,UAAU,mDAAkDC,UAC/DC,EAAAA,EAAAA,MAAA,KAAGF,UAAU,wBAAuBC,SAAA,EAClCF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,cAAkB,IAAE8H,EAAUiG,qBAbxCjG,EAAU7I,UA0BV,aAAjBqM,IACCrL,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,yBACjDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4BAA2BC,SAAA,EACxCF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,4BAA2BC,SAAC,8FAGzCF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,yCAAwCC,SAAC,yFAU/DmL,EAAkB6C,iBAAmB7C,EAAkB6C,gBAAgBvN,OAAS,IAC/ER,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,wDAAuDC,SAAA,EACnEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,4BAG1CF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMuL,GAAwBD,GACvCzL,UAAU,sDAAqDC,SAE9DwL,EAAsB,qDAAoB,kCAI9CA,IACC1L,EAAAA,EAAAA,KAAA,OAAKC,UAAU,YAAWC,SACvBmL,EAAkB6C,gBAAgBrO,IAAI,CAACsO,EAAgBzF,KACtD1I,EAAAA,EAAAA,KAAA,OAAiBC,UAAS,6BAAAmE,OACI,SAA5B+J,EAAexB,SAAsB,2BACT,WAA5BwB,EAAexB,SAAwB,iCACvC,gCACCzM,UACDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mBAAkBC,SAAA,EAC/BF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SACC,SAA5BiO,EAAexB,SAAsB,eACT,WAA5BwB,EAAexB,SAAwB,eAAO,YAEjDxM,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8BAA6BC,SAAEiO,EAAexF,SAC5D3I,EAAAA,EAAAA,KAAA,KAAGC,UAAU,6BAA4BC,SAAEiO,EAAetL,cACzDsL,EAAeC,SACdjO,EAAAA,EAAAA,MAAA,KAAGF,UAAU,yCAAwCC,SAAA,EACnDF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,wBAAyB,IAAEiO,EAAeC,iBAflD1F,UA4BpB1I,EAAAA,EAAAA,KAAA,OAAKC,UAAU,4BAA2BC,UACxCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oBAAmBC,SAAA,EAChCF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,gBAAeC,SAAC,kBAChCC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8BAA6BC,SAAC,kCAC5CF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,wBAAuBC,SAAC,wMAhV/BwN,OCmwBtB,MACA,EADsC,IA9xBtC,MACEW,WAAAA,GACEC,KAAKC,aAAe,KACpBD,KAAKE,aAAe,gCACtB,CAKA,kBAAMC,GACJ,IACE7C,QAAQC,IAAI,0DAGZ,MAAM0C,EAAe,CACnB,CAAC,IAAK,SAAU,cAAY,YAAa,WAAY,eAAgB,SACrE,CAAC,EAAG,6CAA2C,aAAW,OAAQ,cAAe,GAAI,MACrF,CAAC,EAAG,sCAAiC,YAAU,OAAQ,cAAe,GAAI,MAC1E,CAAC,EAAG,kEAAgE,YAAU,QAAS,eAAgB,EAAG,MAC1G,CAAC,EAAG,mCAA8B,aAAW,QAAS,cAAe,EAAG,MACxE,CAAC,EAAG,4BAA0B,YAAU,OAAQ,eAAgB,EAAG,MACnE,CAAC,EAAG,+CAA0C,YAAU,OAAQ,eAAgB,EAAG,MACnF,CAAC,EAAG,0CAA2C,aAAW,OAAQ,eAAgB,EAAG,MACrF,CAAC,EAAG,gCAAiC,WAAS,QAAS,kBAAmB,EAAG,MAC7E,CAAC,EAAG,8CAA+C,WAAS,QAAS,eAAgB,EAAG,MACxF,CAAC,GAAI,kCAAmC,YAAU,OAAQ,eAAgB,EAAG,MAC7E,CAAC,GAAI,kCAAgC,aAAW,OAAQ,eAAgB,GAAI,MAC5E,CAAC,GAAI,wBAAyB,WAAS,QAAS,kBAAmB,GAAI,MACvE,CAAC,GAAI,4BAA6B,YAAU,OAAQ,WAAY,GAAI,MACpE,CAAC,GAAI,mBAAoB,YAAU,QAAS,cAAe,EAAG,MAC9D,CAAC,GAAI,mDAA8C,YAAU,QAAS,cAAe,GAAI,MACzF,CAAC,GAAI,uCAAqC,YAAU,OAAQ,cAAe,GAAI,MAC/E,CAAC,GAAI,yDAAuD,YAAU,QAAS,cAAe,GAAI,MAClG,CAAC,GAAI,gDAA8C,WAAS,QAAS,cAAe,GAAI,MACxF,CAAC,GAAI,2CAAsC,WAAS,QAAS,kBAAmB,GAAI,MACpF,CAAC,GAAI,2BAAyB,YAAU,OAAQ,cAAe,GAAI,MACnE,CAAC,GAAI,mEAA8D,aAAW,QAAS,eAAgB,GAAI,MAC3G,CAAC,GAAI,yDAA0D,YAAU,OAAQ,eAAgB,GAAI,MACrG,CAAC,GAAI,sEAAoE,aAAW,OAAQ,eAAgB,GAAI,MAChH,CAAC,GAAI,mDAAoD,YAAU,OAAQ,WAAY,GAAI,MAC3F,CAAC,GAAI,kDAA6C,aAAW,QAAS,cAAe,GAAI,MACzF,CAAC,GAAI,wDAAmD,YAAU,QAAS,cAAe,GAAI,MAC9F,CAAC,GAAI,uCAAkC,YAAU,QAAS,cAAe,GAAI,MAC7E,CAAC,GAAI,kDAAgD,YAAU,QAAS,cAAe,GAAI,MAC3F,CAAC,GAAI,wCAAsC,YAAU,QAAS,cAAe,GAAI,MACjF,CAAC,GAAI,oCAAqC,YAAU,QAAS,cAAe,GAAI,MAChF,CAAC,GAAI,0CAAwC,YAAU,QAAS,cAAe,GAAI,MACnF,CAAC,GAAI,wBAAyB,YAAU,OAAQ,cAAe,GAAI,MACnE,CAAC,GAAI,6DAA2D,aAAW,OAAQ,eAAgB,GAAI,MACvG,CAAC,GAAI,kDAAmD,YAAU,OAAQ,WAAY,GAAI,MAC1F,CAAC,GAAI,iEAA4D,cAAY,OAAQ,cAAe,GAAI,MACxG,CAAC,GAAI,iDAAkD,YAAU,OAAQ,WAAY,GAAI,MACzF,CAAC,GAAI,yCAAuC,WAAS,OAAQ,cAAe,GAAI,MAChF,CAAC,GAAI,4CAA0C,cAAY,QAAS,cAAe,GAAI,MACvF,CAAC,GAAI,2BAAyB,YAAU,QAAS,cAAe,GAAI,MACpE,CAAC,GAAI,8BAA4B,aAAW,OAAQ,kBAAmB,GAAI,MAC3E,CAAC,GAAI,oCAAkC,aAAW,OAAQ,eAAgB,GAAI,MAC9E,CAAC,GAAI,2CAA4C,YAAU,OAAQ,WAAY,GAAI,MACnF,CAAC,GAAI,0CAAqC,aAAW,QAAS,cAAe,GAAI,MACjF,CAAC,GAAI,uBAAwB,YAAU,OAAQ,kBAAmB,GAAI,MACtE,CAAC,GAAI,gCAAiC,YAAU,QAAS,cAAe,GAAI,MAC5E,CAAC,GAAI,0CAAqC,WAAS,QAAS,cAAe,GAAI,MAC/E,CAAC,GAAI,uCAAqC,YAAU,QAAS,cAAe,GAAI,MAChF,CAAC,GAAI,gCAA2B,YAAU,QAAS,cAAe,GAAI,MACtE,CAAC,GAAI,wBAAsB,YAAU,QAAS,cAAe,GAAI,MACjE,CAAC,GAAI,2BAA4B,YAAU,OAAQ,cAAe,GAAI,MACtE,CAAC,GAAI,uCAAwC,YAAU,OAAQ,cAAe,GAAI,MAClF,CAAC,GAAI,0CAAqC,WAAS,QAAS,cAAe,GAAI,MAC/E,CAAC,GAAI,6BAA8B,YAAU,QAAS,cAAe,GAAI,MACzE,CAAC,GAAI,qBAAsB,YAAU,QAAS,cAAe,GAAI,MACjE,CAAC,GAAI,wCAAsC,YAAU,QAAS,cAAe,GAAI,MACjF,CAAC,GAAI,wCAAyC,YAAU,QAAS,cAAe,GAAI,MACpF,CAAC,GAAI,+BAA6B,YAAU,QAAS,cAAe,GAAI,MACxE,CAAC,GAAI,0CAAwC,YAAU,QAAS,cAAe,GAAI,MACnF,CAAC,GAAI,gDAA8C,YAAU,OAAQ,cAAe,GAAI,MACxF,CAAC,GAAI,4BAA0B,WAAS,OAAQ,cAAe,GAAI,MACnE,CAAC,GAAI,4BAA0B,WAAS,OAAQ,cAAe,GAAI,MACnE,CAAC,GAAI,iCAA+B,YAAU,OAAQ,cAAe,GAAI,MACzE,CAAC,GAAI,yBAA0B,YAAU,OAAQ,cAAe,GAAI,MACpE,CAAC,GAAI,qCAAmC,aAAW,OAAQ,eAAgB,GAAI,MAC/E,CAAC,GAAI,4BAA6B,YAAU,OAAQ,eAAgB,GAAI,MACxE,CAAC,GAAI,+BAA6B,YAAU,QAAS,cAAe,GAAI,MACxE,CAAC,GAAI,8CAA4C,YAAU,QAAS,cAAe,GAAI,MACvF,CAAC,GAAI,wCAAsC,WAAS,QAAS,cAAe,GAAI,MAChF,CAAC,GAAI,yCAAuC,YAAU,QAAS,cAAe,GAAI,MAClF,CAAC,GAAI,oCAAkC,WAAS,QAAS,kBAAmB,GAAI,MAChF,CAAC,GAAI,4BAA6B,YAAU,OAAQ,cAAe,GAAI,MACvE,CAAC,GAAI,uCAAkC,YAAU,QAAS,kBAAmB,GAAI,MACjF,CAAC,GAAI,2CAAyC,YAAU,QAAS,cAAe,GAAI,MACpF,CAAC,GAAI,oCAAkC,WAAS,QAAS,cAAe,GAAI,MAC5E,CAAC,GAAI,qCAAsC,WAAS,QAAS,kBAAmB,GAAI,MACpF,CAAC,GAAI,4BAA6B,YAAU,QAAS,kBAAmB,GAAI,OAM9E,OAHAD,KAAKC,aAAeD,KAAKI,kBAAkBH,GAC3C3C,QAAQC,IAAI,wCAAoCyC,KAAKC,aAAalC,WAAW1L,OAAQ,eAE9E2N,KAAKC,YACd,CAAE,MAAOI,GAEP,MADA/C,QAAQ+C,MAAM,kCAA8BA,GACtCA,CACR,CACF,CAKAD,iBAAAA,CAAkBE,GAChB,MAAMvC,EAAa,GACbhF,EAAa,GAgCnB,OA9BAuH,EAAKC,MAAM,GAAGC,QAAQ,CAACC,EAAKrG,KAC1B,GAAIqG,GAAOA,EAAIpO,OAAS,GAAKoO,EAAI,IAAwB,KAAlBA,EAAI,GAAG5N,OAAe,CAAC,IAAD6N,EAC3D,MAAMzC,EAAW,CACfpN,GAAI4P,EAAI,GACRE,WAAYF,EAAI,GAChBhO,KAAMgO,EAAI,GAAG5N,OACbqL,SAAU8B,KAAKY,cAAcH,EAAI,IACjCpC,SAAU2B,KAAKa,cAAcJ,EAAI,IACjCK,aAAmB,QAANJ,EAAAD,EAAI,UAAE,IAAAC,OAAA,EAANA,EAAQ7N,SAAU,cAC/BkO,YAAaN,EAAI,IAAM,KACvBO,YAAwB,OAAXP,EAAI,IAAeA,EAAI,GAAGpL,cAAc4L,SAAS,QAC9D1B,SAAUS,KAAKkB,mBAAmBT,EAAI,IACtCf,MAAOM,KAAKmB,eAAeV,EAAI,GAAIA,EAAI,IACvCW,eAAe,EACfC,aAAcrB,KAAKsB,eAAeb,EAAI,GAAIA,EAAI,KAGhD1C,EAAWwD,KAAKtD,GAEZA,EAAS+C,aACXjI,EAAWwI,KAAK,CACd1Q,GAAIoN,EAASpN,GACb4B,KAAMwL,EAASxL,KACfiN,MAAOzB,EAASyB,MAChBnL,YAAY,SAADuB,OAAWmI,EAASxL,OAGrC,IAGK,CACLsL,aACAhF,aACAkG,SAAU,CACRT,gBAAiBT,EAAW1L,OAC5BoM,gBAAiB1F,EAAW1G,OAC5BmP,gBAAiB,MACjBC,UAAU,IAAItO,MAAOC,eAG3B,CAKAwN,aAAAA,CAAcc,GACZ,IAAKA,EAAa,OAAO,EAEzB,MAAMC,EAAQD,EAAYE,WAAWD,MAAM,SAC3C,OAAOA,EAAQ3F,SAAS2F,EAAM,IAAM,CACtC,CAKAd,aAAAA,CAAcgB,GACZ,IAAKA,EAAa,MAAO,SAEzB,MAAMxD,EAAWwD,EAAYxM,cAC7B,OAAIgJ,EAAS4C,SAAS,QAAgB,OAClC5C,EAAS4C,SAAS,SAAiB,SACnC5C,EAAS4C,SAAS,QAAgB,MAC/B,QACT,CAKAC,kBAAAA,CAAmBY,GACjB,MAAMrP,EAAOqP,EAAazM,cAE1B,OAAI5C,EAAKwO,SAAS,SAAWxO,EAAKwO,SAAS,kBAAiBxO,EAAKwO,SAAS,YACjE,YACExO,EAAKwO,SAAS,mBAAkBxO,EAAKwO,SAAS,kBAAiBxO,EAAKwO,SAAS,eAC/E,gBACExO,EAAKwO,SAAS,mBAAkBxO,EAAKwO,SAAS,WAAaxO,EAAKwO,SAAS,YAC3E,SACExO,EAAKwO,SAAS,mBAAkBxO,EAAKwO,SAAS,YAAcxO,EAAKwO,SAAS,eAC5E,eACExO,EAAKwO,SAAS,WAAaxO,EAAKwO,SAAS,SAAWxO,EAAKwO,SAAS,iBACpE,UACExO,EAAKwO,SAAS,oBAAmBxO,EAAKwO,SAAS,iBACjD,WACExO,EAAKwO,SAAS,oBAAsBxO,EAAKwO,SAAS,cAAgBxO,EAAKwO,SAAS,kBAClF,iBACExO,EAAKwO,SAAS,aAAexO,EAAKwO,SAAS,QAC7C,YAGF,SACT,CAKAE,cAAAA,CAAeW,EAAcC,GAC3B,MAAMlR,EAAKmL,SAAS+F,GAEpB,OAAIlR,GAAM,GAAKA,GAAM,GAAW,mBAC5BA,GAAM,IAAMA,GAAM,GAAW,YAC7BA,GAAM,IAAMA,GAAM,GAAW,kBAC7BA,GAAM,IAAMA,GAAM,GAAW,iBAC7BA,GAAM,IAAMA,GAAM,GAAW,iBAC7BA,GAAM,IAAMA,GAAM,GAAW,iBAC7BA,GAAM,IAAMA,GAAM,GAAW,SAE1B,SACT,CAKAyQ,cAAAA,CAAeQ,EAAcC,GAC3B,MAAMtP,EAAOqP,EAAazM,cACpBxE,EAAKmL,SAAS+F,GAGpB,OAAW,KAAPlR,GAAa4B,EAAKwO,SAAS,kBAAuB,CAAE3O,KAAM,qBAAsBlB,MAAO,YAGhF,KAAPP,GAAa4B,EAAKwO,SAAS,aACpB,KAAPpQ,GAAa4B,EAAKwO,SAAS,aACpB,KAAPpQ,GAAa4B,EAAKwO,SAAS,YAFoB,CAAE3O,KAAM,iBAAkBlB,MAAO,eAKhFP,GAAM,IAAMA,GAAM,GAAW,CAAEyB,KAAM,cAAelB,MAAO,UAAW4Q,UAAW,sBACjFnR,GAAM,IAAMA,GAAM,GAAW,CAAEyB,KAAM,cAAelB,MAAO,UAAW4Q,UAAW,0BAE9E,IACT,CAKAC,YAAAA,CAAaC,EAAcvL,GACzB,MAQMwL,EARc,CAClB,cAAe,CAAC,YAAa,WAAY,UAAW,cACpD,eAAgB,CAAC,QAAS,aAAc,WACxC,kBAAmB,CAAC,mBACpB,YAAe,CAAC,YAChB,SAAY,CAAC,QAAS,eAGUD,IAAiB,CAAC,SAGpD,IAAK,MAAMnL,KAAQoL,EAAe,CAChC,MAAM3K,EAASb,EAAYhB,KAAKa,GAAKA,EAAEO,OAASA,GAChD,GAAIS,EACF,MAAO,CACLgI,WAAYhI,EAAO/E,KACnBsE,KAAMS,EAAOT,KACbC,WAAYQ,EAAOR,WAGzB,CAGA,GAAIL,EAAYtE,OAAS,EAAG,CAC1B,MAAMmF,EAASb,EAAY,GAC3B,MAAO,CACL6I,WAAYhI,EAAO/E,KACnBsE,KAAMS,EAAOT,KACbC,WAAYQ,EAAOR,WAEvB,CAGA,MAAO,CACLwI,WAAY,cACZzI,KAAM,QACNC,WAAY,eAEhB,CAKAoL,mBAAAA,CAAoBrE,EAAYlK,GAG9B,OAFAyJ,QAAQC,IAAI,2DAELQ,EAAWxM,IAAI0M,IAAa,IAADoE,EAAAC,EAChC,MAAMC,GAAU9Q,EAAAA,EAAAA,GAAA,GAAQwM,GAGxB,GAAIpK,EAAW8C,aAAe9C,EAAW8C,YAAYtE,OAAS,EAAG,CAC/D,MAAMmQ,EAAaxC,KAAKiC,aAAahE,EAAS6C,YAAajN,EAAW8C,aACtE4L,EAAW/C,WAAagD,EAAWhD,WACnC+C,EAAWE,aAAeD,EAAWzL,KACrCwL,EAAWG,mBAAqBF,EAAWxL,UAC7C,MACEuL,EAAW/C,WAAavB,EAAS6C,YAInC,GAAoC,wBAAX,QAArBuB,EAAApE,EAASoD,oBAAY,IAAAgB,OAAA,EAArBA,EAAuB/P,OACrBuB,EAAW8G,cAAgB9G,EAAW+G,iBAAkB,CAC1D,MAAM+H,EAAe3C,KAAK4C,cAAc/O,EAAW8G,aAAc9G,EAAW+G,kBAC5E2H,EAAWrE,SAAWyE,EACtBrF,QAAQC,IAAI,2BAADzH,OAAkBmI,EAASxL,KAAI,OAAAqD,OAAMmI,EAASC,SAAQ,aAAApI,OAAO6M,EAAY,yBACtF,CAIF,GAAoC,oBAAX,QAArBL,EAAArE,EAASoD,oBAAY,IAAAiB,OAAA,EAArBA,EAAuBhQ,OAErBuB,EAAWmH,iBAAmBnH,EAAWmH,gBAAgB3I,OAAS,EAAG,CACvE,MAAMwQ,EAAgB7C,KAAK8C,6BAA6B7E,EAAS0C,YAC3DoC,EAAuBlP,EAAWmH,gBAAgBrF,KAAKqN,GAAKA,EAAE9H,SAAW2H,GAE3EE,GACFzF,QAAQC,IAAI,qCAADzH,OAA4BmI,EAASxL,KAAI,iCAAAqD,OAA0BiN,EAAqB7H,QAEvG,CAGF,OAAOqH,GAEX,CAKAO,4BAAAA,CAA6Bf,GAC3B,OAAQ/F,SAAS+F,IACf,KAAK,GAGL,QAAS,MAAO,QAFhB,KAAK,GAAI,MAAO,WAChB,KAAK,GAAI,MAAO,WAGpB,CAKAa,aAAAA,CAAcK,EAAQC,GACpB,OAAQA,GACN,IAAK,OAML,QACE,OAAOD,EALT,IAAK,QACH,OAAgB,EAATA,EACT,IAAK,SACH,OAAgB,GAATA,EAIb,CAKAE,2BAAAA,CAA4BpF,EAAYlK,GAGtC,OAFAyJ,QAAQC,IAAI,uDAELQ,EAAWnL,OAAOqL,IACvB,IAAKA,EAASoD,aAAc,OAAO,EAEnC,GAAmC,gBAA/BpD,EAASoD,aAAa/O,KAAwB,CAChD,MAAM0P,EAAY/D,EAASoD,aAAaW,UAExC,GAAkB,uBAAdA,EAAoC,CACtC,MAAMoB,GAA4C,IAAlCvP,EAAWiH,mBAE3B,OADAwC,QAAQC,IAAI,GAADzH,OAAIsN,EAAU,SAAM,SAAG,KAAAtN,OAAIsN,EAAU,aAAe,aAAY,kCAAAtN,OAA8BmI,EAASxL,OAC3G2Q,CACT,CAEA,GAAkB,2BAAdpB,EAAwC,CAC1C,MAAMoB,GAAgD,IAAtCvP,EAAWgH,uBAE3B,OADAyC,QAAQC,IAAI,GAADzH,OAAIsN,EAAU,SAAM,SAAG,KAAAtN,OAAIsN,EAAU,aAAe,aAAY,mCAAAtN,OAAkCmI,EAASxL,OAC/G2Q,CACT,CACF,CAEA,OAAO,GAEX,CAKA,mCAAMC,CAA8BxP,GAClC,IAAK,IAADyP,EACFhG,QAAQC,IAAI,qEACZD,QAAQC,IAAI,4BAAmB1J,GAG1BmM,KAAKC,eACR3C,QAAQC,IAAI,2CACNyC,KAAKG,gBAIb7C,QAAQC,IAAI,8CACZ,IAAIQ,EAAaiC,KAAKoC,oBAAoBpC,KAAKC,aAAalC,WAAYlK,GACxEyJ,QAAQC,IAAI,2CAAkCQ,EAAW1L,QAGzDiL,QAAQC,IAAI,uDACZQ,EAAaiC,KAAKmD,4BAA4BpF,EAAYlK,GAC1DyJ,QAAQC,IAAI,sCAA6BQ,EAAW1L,QAGpDiL,QAAQC,IAAI,mCACZ,MAAMxE,EAAaiH,KAAKC,aAAalH,WAAWnG,OAAO8G,QAEjC6J,IADHxF,EAAWpI,KAAKyI,GAAKA,EAAEvN,KAAO6I,EAAU7I,KAG3DyM,QAAQC,IAAI,gCAAuBxE,EAAW1G,QAG9CiL,QAAQC,IAAI,6DACZ,MAAMiG,EAAqBxD,KAAKyD,sBAAsB1F,GAChD2F,EAA6BF,EAAmBzF,WAChDQ,EAAeiF,EAAmBjF,aACxCjB,QAAQC,IAAI,6CAAoCmG,EAA2BrR,QAG3E,MAEM0K,EAAoB,CACxBgB,WAAY2F,EACZ3K,aACAwF,eACAqB,gBANsBI,KAAK2D,wBAAwB9P,EAAY6P,GAO/DzE,SAAU,CACRE,aAAc,kCACdrK,WAAY,6BACZuK,aAAa,IAAIlM,MAAOC,cACxBS,aACA+P,kBAAmB5D,KAAK6D,uBAAuB9F,GAC/CmB,WAAYc,KAAK8D,iBAAiBjQ,EAAYkK,GAC9CgG,qBAAsB,CACpBC,kBAAmBnQ,EAAW8G,aAAY,GAAA7E,OAAMjC,EAAW8G,aAAY,KAAA7E,OAAIjC,EAAW+G,kBAAqB,UAC3GI,iBAA2C,QAA1BsI,EAAAzP,EAAWmH,uBAAe,IAAAsI,OAAA,EAA1BA,EAA4BjR,SAAU,EACvD4R,uBAAwBpQ,EAAWgH,yBAA0B,EAC7DqJ,eAAgBrQ,EAAWiH,qBAAsB,KAYvD,OAPAwC,QAAQC,IAAI,qEACZD,QAAQC,IAAI,6BAADzH,OAAoBiI,EAAW1L,OAAM,aAAAyD,OAAYiD,EAAW1G,SACvEiL,QAAQC,IAAI,mDACZmG,EAA2BnD,MAAM,EAAG,GAAGC,QAAQ,CAACvC,EAAU7D,KACxDkD,QAAQC,IAAI,KAADzH,OAAMsE,EAAQ,EAAC,MAAAtE,OAAKmI,EAASxL,KAAI,MAAAqD,OAAKmI,EAAS7H,UAAS,OAAAN,OAAMmI,EAAS5H,YAG7E0G,CAET,CAAE,MAAOsD,GAEP,MADA/C,QAAQ+C,MAAM,+DAA2DA,GACnEA,CACR,CACF,CAKAoD,qBAAAA,CAAsB1F,GAEpB,MAAM2F,EAA6B1D,KAAKmE,kBAAkBpG,GAGpDqG,EAAsBpE,KAAKqE,eAAeX,GAKhD,MAAO,CACL3F,WAAYqG,EACZ7F,aAJmByB,KAAKsE,qBAAqBF,GAMjD,CAKAD,iBAAAA,CAAkBpG,GAChBT,QAAQC,IAAI,uDAEZ,MAAMgH,EAASxG,EAAWxM,IAAI0M,IAC5B,MAAMuG,EAAe,GAErB,GAAIvG,EAAS8C,aAAwC,KAAzB9C,EAAS8C,YAAoB,CAEvD,MAAM0D,EAAsB1G,EAAWpI,KAAKyI,GAAKA,EAAEuC,aAAe1C,EAAS8C,aACvE0D,GACFD,EAAajD,KAAKkD,EAAoB5T,IACtCyM,QAAQC,IAAI,gBAADzH,OAAOmI,EAASxL,KAAI,UAAAqD,OAASmI,EAASpN,GAAE,iBAAAiF,OAAgB2O,EAAoBhS,KAAI,UAAAqD,OAAS2O,EAAoB5T,GAAE,OAE1HyM,QAAQoH,KAAK,4BAAD5O,OAAmBmI,EAAS8C,YAAW,wBAAAjL,OAAuBmI,EAASxL,MAEvF,CAEA,OAAAhB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKwM,GAAQ,IACXuG,aAAcA,MAKlBlH,QAAQC,IAAI,uDAQZ,OAP8ByC,KAAK2E,0BAA0BJ,GAE3DjH,QAAQ+C,MAAM,gEAEd/C,QAAQC,IAAI,mDAGPgH,CACT,CAKAI,yBAAAA,CAA0B5G,GACxB,MAAM6G,EAAU,IAAIC,IACdC,EAAiB,IAAID,IAErBE,EAAYhD,IAChB,GAAI+C,EAAeE,IAAIjD,GAErB,OADAzE,QAAQ+C,MAAM,0CAADvK,OAAsCiM,KAC5C,EAET,GAAI6C,EAAQI,IAAIjD,GACd,OAAO,EAGT6C,EAAQK,IAAIlD,GACZ+C,EAAeG,IAAIlD,GAEnB,MAAM9D,EAAWF,EAAWpI,KAAKyI,GAAKA,EAAEvN,KAAOkR,GAC/C,GAAI9D,EACF,IAAK,MAAMiH,KAASjH,EAASuG,aAC3B,GAAIO,EAASG,GACX,OAAO,EAMb,OADAJ,EAAeK,OAAOpD,IACf,GAGT,IAAK,MAAM9D,KAAYF,EACrB,IAAK6G,EAAQI,IAAI/G,EAASpN,KACpBkU,EAAS9G,EAASpN,IACpB,OAAO,EAKb,OAAO,CACT,CAKAwT,cAAAA,CAAetG,GACbT,QAAQC,IAAI,iFAEZ,MAAM6G,EAAsB,IAAIrG,GAC1B3H,EAAY,IAAIjD,KAAK,cAG3BiR,EAAoB5D,QAAQvC,IAC1BA,EAAS7H,UAAY,KACrB6H,EAAS5H,QAAU,OAIrB,MAAM+O,EAAc,IAAIC,IACxBjB,EAAoB5D,QAAQvC,IAC1BmH,EAAYE,IAAIrH,EAASpN,GAAIoN,KAI/B,MAAMsH,EAA0BtH,IAC9B,GAAIA,EAAS7H,WAAa6H,EAAS5H,QACjC,OAGFiH,QAAQC,IAAI,4BAADzH,OAAmBmI,EAASxL,KAAI,UAAAqD,OAASmI,EAAS0C,WAAU,MAEvE,IAAI6E,EAAoB,IAAIrS,KAAKiD,GAEjC,GAAI6H,EAASuG,aAAanS,OAAS,EAAG,CACpCiL,QAAQC,IAAI,gCAADzH,OAAuBmI,EAASxL,KAAI,KAAKwL,EAASuG,cAG7DvG,EAASuG,aAAahE,QAAQ0E,IAC5B,MAAMO,EAAcL,EAAYM,IAAIR,GAChCO,GACFF,EAAuBE,KAK3B,IAAIE,EAAsB,KAE1B1H,EAASuG,aAAahE,QAAQ0E,IAC5B,MAAMO,EAAcL,EAAYM,IAAIR,GAChCO,GAAeA,EAAYpP,UAC7BiH,QAAQC,IAAI,8BAADzH,OAAqB2P,EAAYhT,KAAI,cAAAqD,OAAa2P,EAAYpP,QAAQiJ,yBAC5EqG,GAAuBF,EAAYpP,QAAUsP,KAChDA,EAAsB,IAAIxS,KAAKsS,EAAYpP,aAK7CsP,IAEFH,EAAoB,IAAIrS,KAAKwS,GAC7BH,EAAkBI,QAAQJ,EAAkBK,UAAY,GACxDvI,QAAQC,IAAI,UAADzH,OAAMmI,EAASxL,KAAI,wCAAAqD,OAAoC0P,EAAkBlG,uBAExF,MACEhC,QAAQC,IAAI,gBAADzH,OAAOmI,EAASxL,KAAI,kCAAAqD,OAAiC0P,EAAkBlG,uBAIpF,MAAMwG,EAAkB,IAAI3S,KAAKqS,GACjCM,EAAgBF,QAAQE,EAAgBD,UAAY5H,EAASC,SAAW,GAGxED,EAAS7H,UAAYoP,EACrBvH,EAAS5H,QAAUyP,EAGnB7H,EAAS8H,WAAaP,EACtBvH,EAAS+H,YAAcF,EAGvB7H,EAASgI,oBAAqB,EAE9B3I,QAAQC,IAAI,gBAADzH,OAAOmI,EAASxL,KAAI,MAAAqD,OAAK0P,EAAkBlG,qBAAoB,OAAAxJ,OAAMgQ,EAAgBxG,qBAAoB,MAAAxJ,OAAKmI,EAASC,SAAQ,eA4B5I,MAxByB,IAAIkG,GAAqB8B,KAAK,CAAC9H,EAAG+H,IAAM/H,EAAEuC,WAAawF,EAAExF,YAGjEH,QAAQvC,IACvBsH,EAAuBtH,KAIzBX,QAAQC,IAAI,4CACZ6G,EAAoB5D,QAAQvC,IACtBA,EAASuG,aAAanS,OAAS,GACjC4L,EAASuG,aAAahE,QAAQ0E,IAC5B,MAAMO,EAAcL,EAAYM,IAAIR,GAChCO,GAAeA,EAAYpP,SAAW4H,EAAS7H,YAC7C6H,EAAS7H,WAAaqP,EAAYpP,QACpCiH,QAAQ+C,MAAM,iBAADvK,OAAamI,EAASxL,KAAI,YAAAqD,OAAWmI,EAAS7H,UAAUkJ,qBAAoB,yBAAAxJ,OAAwB2P,EAAYhT,KAAI,aAAAqD,OAAY2P,EAAYpP,QAAQiJ,uBAEjKhC,QAAQC,IAAI,cAADzH,OAAUmI,EAASxL,KAAI,YAAAqD,OAAWmI,EAAS7H,UAAUkJ,qBAAoB,mBAAAxJ,OAAe2P,EAAYhT,KAAI,iBAAAqD,OAAgB2P,EAAYpP,QAAQiJ,4BAO1J8E,CACT,CAKAgC,eAAAA,CAAgBrI,GACdT,QAAQC,IAAI,wDAEZ,MAAMqH,EAAU,IAAIC,IACdwB,EAAO,IAAIxB,IACXN,EAAS,GAET+B,EAASrI,IACb,GAAIoI,EAAKrB,IAAI/G,EAASpN,IACpB,MAAM,IAAI0V,MAAM,kCAEd3B,EAAQI,IAAI/G,EAASpN,MAIzBwV,EAAKpB,IAAIhH,EAASpN,IAClByM,QAAQC,IAAI,2BAADzH,OAAkBmI,EAASxL,KAAI,UAAAqD,OAASmI,EAASpN,GAAE,MAG9DoN,EAASuG,aAAahE,QAAQ0E,IAC5B,MAAMO,EAAc1H,EAAWpI,KAAKyI,GAAKA,EAAEvN,KAAOqU,GAC9CO,IACFnI,QAAQC,IAAI,yBAADzH,OAAqB2P,EAAYhT,KAAI,UAAAqD,OAASoP,EAAK,MAC9DoB,EAAMb,MAIVY,EAAKlB,OAAOlH,EAASpN,IACrB+T,EAAQK,IAAIhH,EAASpN,IACrB0T,EAAOhD,KAAKtD,GACZX,QAAQC,IAAI,gCAADzH,OAA4BmI,EAASxL,SAiBlD,MAb2B,IAAIsL,GAAYmI,KAAK,CAAC9H,EAAG+H,IAAM/H,EAAEuC,WAAawF,EAAExF,YAExDH,QAAQvC,IACpB2G,EAAQI,IAAI/G,EAASpN,KACxByV,EAAMrI,KAIVX,QAAQC,IAAI,oEACZgH,EAAO/D,QAAQ,CAACvC,EAAU7D,KACxBkD,QAAQC,IAAI,KAADzH,OAAMsE,EAAQ,EAAC,MAAAtE,OAAKmI,EAASxL,KAAI,UAAAqD,OAASmI,EAASpN,GAAE,QAG3D0T,CACT,CAKAD,oBAAAA,CAAqBvG,GAEnB,OAAOA,EAAWnL,OAAOqL,GACD,SAAtBA,EAASI,UAAuBJ,EAAS+C,YAE7C,CAKA2C,uBAAAA,CAAwB9P,EAAYkK,GAClC,MAAM6B,EAAkB,GA0BxB,OAxBI/L,EAAWiH,oBACb8E,EAAgB2B,KAAK,CACnBjP,KAAM,OACN+H,MAAO,oBACPmM,QAAS,4EAIT3S,EAAWgH,wBACb+E,EAAgB2B,KAAK,CACnBjP,KAAM,OACN+H,MAAO,4BACPmM,QAAS,4EAIT3S,EAAWmH,iBAAmBnH,EAAWmH,gBAAgB3I,OAAS,GACpEuN,EAAgB2B,KAAK,CACnBjP,KAAM,YACN+H,MAAO,yBACPmM,QAAQ,mBAAD1Q,OAAqBjC,EAAWmH,gBAAgB3I,OAAM,+CAI1DuN,CACT,CAKAiE,sBAAAA,CAAuB9F,GACrB,OAAOA,EAAWzG,OAAO,CAACmP,EAAOxI,IAAawI,EAAQxI,EAASC,SAAU,EAC3E,CAKA4F,gBAAAA,CAAiBjQ,EAAYkK,GAC3B,IAAImB,EAAa,SASjB,OAPInB,EAAW1L,OAAS,GAAI6M,EAAa,OAChCnB,EAAW1L,OAAS,KAAI6M,EAAa,OAE1CrL,EAAWiH,oBAAsBjH,EAAWgH,yBAC9CqE,EAAa,QAGRA,CACT,G,cC4iBF,MACA,EAD8B,IAj0C9B,MACEa,WAAAA,GACEC,KAAK0G,SAAW,KAChB1G,KAAK2G,eAAiB,KACtB3G,KAAK4G,YAAc,IACrB,CAGA,gBAAMC,CAAWH,EAAUC,EAAgBC,GACzC5G,KAAK0G,SAAWA,EAChB1G,KAAK2G,eAAiBA,EACtB3G,KAAK4G,YAAcA,EAKnBE,EAAAA,GAAeC,MAAM,mDAA0C,CAAEJ,iBAAgBK,OAAmB,OAAXJ,QAAW,IAAXA,OAAW,EAAXA,EAAa/V,IACxG,CAOA,2BAAMoW,CAAsBpT,GAC1B,IAAK,IAADqT,EAMF,GALAJ,EAAAA,GAAeC,MAAM,qEAA4DlT,GACjFiT,EAAAA,GAAeC,MAAM,iDAAwClT,EAAWa,aACxEoS,EAAAA,GAAeC,MAAM,6EAA+F,2BAA3BlT,EAAWa,aAGrE,2BAA3Bb,EAAWa,YAEb,OADAoS,EAAAA,GAAeC,MAAM,yGACRI,EAA8B9D,8BAA8BxP,GAI3E,MAAM+B,QAAiBoK,KAAKoH,gBAAgBvT,GAG5C,GAFAiT,EAAAA,GAAeC,MAAM,sCAAqC,OAARnR,QAAQ,IAARA,OAAQ,EAARA,EAAUnD,OAEvDmD,EACH,MAAM,IAAI2Q,MAAM,gDAIlBO,EAAAA,GAAeC,MAAM,sDAA6C,CAChEM,kBAAmBzR,EAAS0R,cAC5BC,gBAAiB3R,EAASmI,WAC1ByJ,kBAAqC,QAAnBN,EAAAtR,EAASmI,kBAAU,IAAAmJ,OAAA,EAAnBA,EAAqB7U,SAAU,EACjDoV,aAAczS,OAAOC,KAAKW,KAI5BkR,EAAAA,GAAeC,MAAM,qDACrB,MAAMW,QAA2B1H,KAAK2H,8BAA8B/R,EAAU/B,GAExE+T,QAA2B5H,KAAK6H,0BAA0BjS,EAAU/B,EAAY6T,GACtFZ,EAAAA,GAAeC,MAAM,sCAA6Ba,EAAmBvV,QAGrE,MAAMyV,QAAwB9H,KAAK+H,wBAAwBH,EAAoB/T,GAC/EiT,EAAAA,GAAeC,MAAM,gCAAuBe,EAAgBzV,QAG5D,MAAMkM,EAAeyB,KAAKyD,sBAAsBmE,GAChDd,EAAAA,GAAeC,MAAM,0CAA8BxI,EAAalM,OAAQ,eAGxE,MAAMuN,EAAkBI,KAAK2D,wBAAwB9P,EAAY+T,GACjEd,EAAAA,GAAeC,MAAM,0CAAiCnH,EAAgBvN,QAGtE,IAAI2V,EAAkBJ,EACS,2BAA3B/T,EAAWa,cACbsT,EAAkBhI,KAAKiI,wBAAwBL,EAAoB/T,GACnEiT,EAAAA,GAAeC,MAAM,sDAIvB,MAAMhK,EAAoB,CACxBgB,WAAYiK,EACZjP,WAAY+O,EACZvJ,aAAcA,EACdqB,gBAAiBA,EACjBX,SAAU,CACRE,aAAsB,OAARvJ,QAAQ,IAARA,OAAQ,EAARA,EAAUnD,KACxBqC,WAAoB,OAARc,QAAQ,IAARA,OAAQ,EAARA,EAAU/E,GACtBwO,aAAa,IAAIlM,MAAOC,cACxBS,WAAYA,EACZ+P,kBAAmB5D,KAAK6D,uBAAuBmE,GAC/C9I,WAAYc,KAAK8D,iBAAiBjQ,EAAYmU,KAQlD,aAHMhI,KAAKkI,sBAAsBrU,EAAYkJ,GAE7C+J,EAAAA,GAAeC,MAAM,2CACdhK,CAET,CAAE,MAAOsD,GAEP,MADAyG,EAAAA,GAAezG,MAAM,qCAAiCA,GAChD,IAAIkG,MAAM,+BAADzQ,OAAgCuK,EAAMmG,SACvD,CACF,CAOA,qBAAMY,CAAgBvT,GACpB,IACE,MAAM,YAAEa,EAAW,SAAEE,EAAQ,YAAEC,GAAgBhB,EAE/C,IAAKmM,KAAK0G,SAAU,CAClBI,EAAAA,GAAeC,MAAM,2DACrB,MAAMoB,EAAkB,CACtBtX,GAAI,mBACJ4B,KAAM,mCACN8B,YAAa,iFACbI,aAAcd,EAAWa,aAAe,UACxCE,SAAUf,EAAWe,UAAY,UACjCC,YAAahB,EAAWgB,aAAe,YACvCyS,cAAetH,KAAKoI,uBAAuBvU,IAS7C,OALIsU,EAAgBb,eAAiBa,EAAgBb,cAAce,SACjEF,EAAgBpK,WAAaiC,KAAKsI,4BAA4BH,EAAgBb,cAAce,QAC5FF,EAAgBpP,WAAaiH,KAAKuI,4BAA4BJ,EAAgBb,cAAce,SAGvFF,CACT,CAGA,IAAIK,EAAQxI,KAAK0G,SACd+B,KAAK,sBACLC,OAAO,KAIRF,EADExI,KAAK2G,eACC6B,EAAMG,GAAG,sBAAD7S,OAAuBkK,KAAK2G,eAAc,6BAElD6B,EAAMI,GAAG,kBAAmB,MAIlClU,IACF8T,EAAQA,EAAMK,GAAG,eAAgBnU,IAI/BE,IACF4T,EAAQA,EAAMK,GAAG,WAAYjU,IAI3BC,IACF2T,EAAQA,EAAMK,GAAG,cAAehU,IAGlC,MAAQyL,KAAMwI,EAAS,MAAEzI,SAAgBmI,EAEzC,GAAInI,EAEF,MADAyG,EAAAA,GAAezG,MAAM,8BAA+BA,GAC9CA,EAKR,GAFAyG,EAAAA,GAAeC,MAAM,uCAAsC,OAAT+B,QAAS,IAATA,OAAS,EAATA,EAAWzW,SAAU,IAElEyW,GAAkC,IAArBA,EAAUzW,OAAc,CACxCyU,EAAAA,GAAepC,KAAK,2EAEpB,IAAIqE,EAAe/I,KAAK0G,SACrB+B,KAAK,sBACLC,OAAO,KAGRK,EADE/I,KAAK2G,eACQoC,EAAaJ,GAAG,sBAAD7S,OAAuBkK,KAAK2G,eAAc,6BAEzDoC,EAAaH,GAAG,kBAAmB,MAGpD,MAAQtI,KAAM0I,SAA2BD,EAAaE,MAAM,GAE5D,GAAoB,OAAhBD,QAAgB,IAAhBA,GAAAA,EAAmB,GACrB,OAAOA,EAAiB,GAI1BlC,EAAAA,GAAeC,MAAM,8DACrB,MAAMoB,EAAkB,CACtBtX,GAAI,mBACJ4B,KAAM,mCACN8B,YAAa,iFACbI,aAAcd,EAAWa,aAAe,UACxCE,SAAUf,EAAWe,UAAY,UACjCC,YAAahB,EAAWgB,aAAe,YACvCyS,cAAetH,KAAKoI,uBAAuBvU,IAS7C,OALIsU,EAAgBb,eAAiBa,EAAgBb,cAAce,SACjEF,EAAgBpK,WAAaiC,KAAKsI,4BAA4BH,EAAgBb,cAAce,QAC5FF,EAAgBpP,WAAaiH,KAAKuI,4BAA4BJ,EAAgBb,cAAce,SAGvFF,CACT,CAGA,MAAMe,EAAelJ,KAAKmJ,cAAcL,EAAWjV,GAAY,GAQ/D,OALIqV,GAAgBA,EAAa5B,eAAiB4B,EAAa5B,cAAce,SAC3Ea,EAAanL,WAAaiC,KAAKsI,4BAA4BY,EAAa5B,cAAce,QACtFa,EAAanQ,WAAaiH,KAAKuI,4BAA4BW,EAAa5B,cAAce,SAGjFa,CAET,CAAE,MAAO7I,GAEP,OADAyG,EAAAA,GAAezG,MAAM,kCAAmCA,GACjD,IACT,CACF,CAKA,+BAAMwH,CAA0BjS,EAAUwT,GAAqC,IAA5B1B,EAAkB2B,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,KACtE,IAAKzT,EAEH,OADAkR,EAAAA,GAAepC,KAAK,kDACb,GAIT,IAAI3G,EAAa2J,EAQjB,GAPK3J,IACHA,EAAanI,EAASmI,YACjBA,GAAcnI,EAAS0R,eAAiB1R,EAAS0R,cAAce,SAClEtK,EAAaiC,KAAKsI,4BAA4B1S,EAAS0R,cAAce,WAIpEtK,GAAoC,IAAtBA,EAAW1L,OAE5B,OADAyU,EAAAA,GAAepC,KAAK,iDACb,GAGT,MAAMkD,EAAqB,GAC3B,IAAI7F,EAAa,EAGjB,MAAMuH,EAAqBtJ,KAAKuJ,4BAA4BH,EAAQ1R,UAG9D8R,EAAuBxJ,KAAKyJ,8BAA8BL,EAAQ3R,gBAwDxE,OAtDAsG,EAAWyC,QAAQ,CAACvC,EAAUyL,KAE5B,IAAIC,EAAmB1L,EAASC,SAGhCyL,EAAmB9N,KAAK+N,KAAKD,EAAmBL,EAAqBE,GAGzC,2BAAxBJ,EAAQ1U,cACViV,EAAmB3J,KAAK6J,gCAAgC5L,EAAU0L,EAAkBP,IAIxD,QAA1BA,EAAQ1Q,cACViR,EAAmB9N,KAAK+N,KAAwB,IAAnBD,GACM,SAA1BP,EAAQ1Q,gBACjBiR,EAAmB9N,KAAK+N,KAAwB,GAAnBD,IAI/B,MAAMG,EAAmB,CACvBjZ,GAAG,MAADiF,OAAQiM,KACVtP,KAAMwL,EAASxL,KACf8B,YAAayL,KAAK+J,4BAA4B9L,EAAUmL,GACxDlL,SAAUrC,KAAKO,IAAI,EAAGuN,GACtBpK,SAAUtB,EAASsB,UAAY,YAC/BG,MAAOzB,EAASyB,OAAS,UACzBsK,WAAY/L,EAAS+L,YAAc,EACnCN,cAAeA,EACf1I,YAAa/C,EAAS+C,cAAe,EACrC3C,SAAU2B,KAAKiK,kBAAkBhM,EAAUmL,GAC3C5J,WAAYQ,KAAKkK,gBAAgBjM,EAAUmL,GAC3C5E,aAAcvG,EAASuG,cAAgB,GACvC2F,cAAenK,KAAKoK,aAAanM,EAAUmL,GAC3CiB,eAAgBpM,EAASoM,gBAAkB,GAC3CC,SAAUrM,EAASqM,WAAY,EAC/BC,YAAa,KACb9K,WAAYO,KAAKwK,oBAAoBvM,EAAUmL,IAGjDxB,EAAmBrG,KAAKuI,KAI1BlC,EAAmBpH,QAAQ,CAACvC,EAAU7D,KAChC6D,EAASuG,cAAgBvG,EAASuG,aAAanS,OAAS,EAC1D4L,EAASuG,aAAexE,KAAKyK,mBAAmBxM,EAASuG,aAAcoD,GAC9DxN,EAAQ,IAEjB6D,EAASuG,aAAe,CAACoD,EAAmBxN,EAAQ,GAAGvJ,IACvDiW,EAAAA,GAAeC,MAAM,kDAADjR,OAAyCmI,EAASxL,KAAI,gBAAAqD,OAAe8R,EAAmBxN,EAAQ,GAAG3H,UAIpHmV,CACT,CAKA,6BAAMG,CAAwBhK,EAAYqL,GACxC,MAAMrQ,EAAa,GACnB,IAAIc,EAAc,EAGlB,MAAM6Q,EAAoB,CAAC,EAC3B3M,EAAWyC,QAAQvC,IACZyM,EAAkBzM,EAASyB,SAC9BgL,EAAkBzM,EAASyB,OAAS,IAEtCgL,EAAkBzM,EAASyB,OAAO6B,KAAKtD,KAIzCjJ,OAAO2V,QAAQD,GAAmBlK,QAAQnQ,IAAmC,IAAjCua,EAAWC,GAAgBxa,EACrE,MAAMya,EAAiB,CACrBja,GAAG,aAADiF,OAAe+D,KACjBpH,KAAK,SAADqD,OAAW8U,EAAS,eACxBrW,YAAY,+CAADuB,OAAiD8U,GAC5DlL,MAAOkL,EACP5J,aAAa,EACb9C,SAAU,EACV9H,UAAW,KACXC,QAAS,KACT0U,SAAU,EACVC,OAAQ,UACR3M,SAAU,OACVmB,WAAY4J,EAAQ5T,gBAAkB,YACtCgP,aAAc,GACd7E,SAAUK,KAAKiL,0BAA0BL,EAAWC,GACpDN,YAAa,KACb9K,WAAY,IAGd1G,EAAWwI,KAAKuJ,KAIlB,MAAMI,EAAqBlL,KAAKmL,2BAA2B/B,EAASrL,GAGpE,OAFAhF,EAAWwI,QAAQ2J,GAEZnS,CACT,CAKA0K,qBAAAA,CAAsB1F,GASpB,OAP2BA,EAAWnL,OAAOqL,GAEd,SAAtBA,EAASI,UACdJ,EAASuG,aAAanS,OAAS,GAC/B4L,EAASkM,cAAgB,KAGH5Y,IAAI0M,GAAYA,EAASpN,GACrD,CAKA8S,uBAAAA,CAAwB9P,EAAYkK,GAClC,MAAM6B,EAAkB,GAGpB/L,EAAW6D,SAAW,GACxBkI,EAAgB2B,KAAK,CACnBjP,KAAM,OACN+L,SAAU,OACVhE,MAAO,oBACP9F,YAAa,oGACbuL,OAAQ,mEAKsB,WAA9BjM,EAAW4D,gBACbmI,EAAgB2B,KAAK,CACnBjP,KAAM,aACN+L,SAAU,SACVhE,MAAO,gBACP9F,YAAa,0FACbuL,OAAQ,mEAKUE,KAAK6D,uBAAuB9F,GAC9B,KAClB6B,EAAgB2B,KAAK,CACnBjP,KAAM,WACN+L,SAAU,OACVhE,MAAO,gCACP9F,YAAa,gFACbuL,OAAQ,2CAgBZ,OAXiC/B,EAAWnL,OAAOwL,GAAoB,SAAfA,EAAEC,UAAqBhM,OAC5B,GAApB0L,EAAW1L,QACxCuN,EAAgB2B,KAAK,CACnBjP,KAAM,aACN+L,SAAU,SACVhE,MAAO,mBACP9F,YAAa,+EACbuL,OAAQ,oDAILF,CACT,CAKA,2BAAMsI,CAAsBrU,EAAYkJ,GACtC,IACE,MAAMqO,EAAmB,CACvBC,WAAYxX,EAAWyX,UACvBC,YAAaxO,EAAkBkC,SAASnK,YAAc,KACtD0W,WAAY3X,EACZ4X,mBAAoB1O,EACpB2O,WAAY1L,KAAK4G,YAAY/V,GAC7B8a,gBAAiB3L,KAAK2G,iBAGlB,MAAEtG,SAAgBL,KAAK0G,SAC1B+B,KAAK,2BACLmD,OAAOR,GAEN/K,EACFyG,EAAAA,GAAezG,MAAM,8CAA4CA,GAEjEyG,EAAAA,GAAeC,MAAM,6CAEzB,CAAE,MAAO1G,GACPyG,EAAAA,GAAezG,MAAM,6BAA8BA,EACrD,CACF,CASAkJ,2BAAAA,CAA4B7R,GAC1B,OAAIA,GAAY,EAAU,IACtBA,GAAY,EAAU,EACtBA,GAAY,EAAU,GACnB,EACT,CAKA+R,6BAAAA,CAA8BzS,GAC5B,OAAQA,GACN,IAAK,SAAU,OAAO,IACtB,IAAK,eAAgB,OAAO,IAC5B,IAAK,SAAU,MAAO,GACtB,IAAK,SAAU,MAAO,GACtB,QAAS,OAAO,EAEpB,CAKA+S,2BAAAA,CAA4B9L,EAAUmL,GACpC,MAAMyC,EAAkB5N,EAAS1J,aAAW,YAAAuB,OAAgBmI,EAASxL,MAErE,OAAI2W,EAAQ3T,mBACJ,GAANK,OAAU+V,EAAe,uBAAA/V,OAAsBsT,EAAQ3T,oBAGlDoW,CACT,CAKA5B,iBAAAA,CAAkBhM,EAAUmL,GAC1B,MAA0B,aAAtBnL,EAASsB,UACa,YAAtBtB,EAASsB,UACTtB,EAAS+C,YAFgC,QAGzC/C,EAASqM,SAAiB,SAEhC,CAKAJ,eAAAA,CAAgBjM,EAAUmL,GACxB,GAAIA,EAAQ5T,eAAgB,OAAO4T,EAAQ5T,eAG3C,OAAQyI,EAASsB,UACf,IAAK,WAGL,IAAK,WAAY,MAAO,kBAFxB,IAAK,YAAa,MAAO,YACzB,IAAK,UAAW,MAAO,UAEvB,QAAS,MAAO,YAEpB,CAKAkL,kBAAAA,CAAmBjG,EAAcsH,GAE/B,IAAKtH,IAAiBuH,MAAMC,QAAQxH,GAElC,OADAsC,EAAAA,GAAeC,MAAM,gFACd,GAIT,MAAMkF,EAAezH,EAAajT,IAAI2a,IAEpC,GAAmB,kBAARA,GAAoBA,EAAIC,WAAW,aAC5C,OAAOD,EAET,GAAmB,kBAARA,EACT,OAAOA,EAIT,MAAME,EAAmBN,EAAmBnW,KAAKyI,GAAKA,EAAE3L,OAASyZ,GACjE,OAAIE,GACFtF,EAAAA,GAAeC,MAAM,sCAADjR,OAA6BoW,EAAG,YAAApW,OAAWsW,EAAiBvb,GAAE,MAC3Eub,EAAiBvb,KAG1BiW,EAAAA,GAAepC,KAAK,6BAAD5O,OAAoBoW,EAAG,8CACnC,QACNtZ,OAAOsZ,GAAe,OAARA,GAGjB,OADApF,EAAAA,GAAeC,MAAM,yCAADjR,OAAgCmW,EAAaI,KAAK,MAAK,MACpEJ,CACT,CAKA7B,YAAAA,CAAanM,EAAUmL,GAKrB,OAJiBnL,EAASkM,eAAiB,MAC1Bf,EAAQ1R,UAAY,IACpBuG,EAASC,UAAY,GAEE,EAC1C,CAKAsM,mBAAAA,CAAoBvM,EAAUmL,GAC5B,IAAI3J,EAAa,GAUjB,OAPI2J,EAAQ1U,aAAe0U,EAAQxU,WAAU6K,GAAc,IAG5B,WAA3B2J,EAAQ3R,gBAA0D,WAA3B2R,EAAQ3R,iBACjDgI,GAAc,IAGT5D,KAAKE,IAAI,EAAK0D,EACvB,CAKAwL,yBAAAA,CAA0BL,EAAW7M,GACnC,MAAMuO,EAAgBvO,EAAWxM,IAAI6M,GAAKA,EAAE3L,MAAM4Z,KAAK,MACvD,MAAM,2BAANvW,OAAkCwW,EACpC,CAKAnB,0BAAAA,CAA2B/B,EAASrL,GAClC,MAAMmN,EAAqB,GAC3B,IAAIrR,EAAc,IAElB,OAAQuP,EAAQ1U,aACd,IAAK,yBACHwW,EAAmB3J,KAAK,CACtB1Q,GAAG,aAADiF,OAAe+D,KACjBpH,KAAM,qCACN8B,YAAa,wEACbyM,aAAa,EACb9C,SAAU,EACV6M,SAAU,EACVC,OAAQ,UACR3M,SAAU,OACVmB,WAAY,oBACZG,SAAU,kFACV4K,YAAa,KACb9K,WAAY,KAEd,MAEF,IAAK,cACHyL,EAAmB3J,KAAK,CACtB1Q,GAAG,aAADiF,OAAe+D,KACjBpH,KAAM,mCACN8B,YAAa,kEACbyM,aAAa,EACb9C,SAAU,EACV6M,SAAU,EACVC,OAAQ,UACR3M,SAAU,OACVmB,WAAY,cACZG,SAAU,gEACV4K,YAAa,KACb9K,WAAY,KAKlB,OAAOyL,CACT,CAMArH,sBAAAA,CAAuB9F,GACrB,OAAOA,EAAWzG,OAAO,CAACmP,EAAOxI,IAAawI,GAASxI,EAASC,UAAY,GAAI,EAClF,CAKA4F,gBAAAA,CAAiBjQ,EAAYkK,GAC3B,IAAImB,EAAa,SAEjB,MAAMlB,EAAgBgC,KAAK6D,uBAAuB9F,GAC5CI,EAAyBJ,EAAWnL,OAAOwL,GAAoB,SAAfA,EAAEC,UAAqBhM,OACvEqF,EAAW7D,EAAW6D,UAAY,EAQxC,OANIsG,EAAgB,KAAOG,EAAyB,GAAKzG,EAAW,EAClEwH,EAAa,OACJlB,EAAgB,IAAMG,EAAyB,GAAKzG,GAAY,IACzEwH,EAAa,OAGRA,CACT,CAKAiK,aAAAA,CAAcL,EAAWjV,GACvB,OAAOiV,EAAU5C,KAAK,CAAC9H,EAAG+H,KACxB,IAAIoG,EAAS,EACTC,EAAS,EAcb,OAXIpO,EAAEzJ,eAAiBd,EAAWa,cAAa6X,GAAU,GACrDpG,EAAExR,eAAiBd,EAAWa,cAAa8X,GAAU,GAGrDpO,EAAExJ,WAAaf,EAAWe,WAAU2X,GAAU,GAC9CpG,EAAEvR,WAAaf,EAAWe,WAAU4X,GAAU,GAG9CpO,EAAEvJ,cAAgBhB,EAAWgB,cAAa0X,GAAU,GACpDpG,EAAEtR,cAAgBhB,EAAWgB,cAAa2X,GAAU,GAEjDA,EAASD,GAEpB,CAKAnE,sBAAAA,CAAuBvU,GACrB,MAAM,YAAEa,EAAc,UAAS,SAAEgD,EAAW,GAAM7D,EAG5C4Y,EAAgB,CACpB,cAAiB,CACf,CACEha,KAAM,mBACNsL,WAAY,CACV,CAAEtL,KAAM,kCAAgCyL,SAAU,EAAGqB,SAAU,YAC/D,CAAE9M,KAAM,uBAAqByL,SAAU,GAAIqB,SAAU,UACrD,CAAE9M,KAAM,+BAA6ByL,SAAU,EAAGqB,SAAU,cAGhE,CACE9M,KAAM,yBACNsL,WAAY,CACV,CAAEtL,KAAM,sBAAoByL,SAAU,GAAIqB,SAAU,UACpD,CAAE9M,KAAM,+BAA6ByL,SAAU,EAAGqB,SAAU,UAC5D,CAAE9M,KAAM,YAAayL,SAAU,GAAIqB,SAAU,iBAGjD,CACE9M,KAAM,oBACNsL,WAAY,CACV,CAAEtL,KAAM,gDAA8CyL,SAAU,GAAIqB,SAAU,cAAeyB,aAAa,GAC1G,CAAEvO,KAAM,oCAA+ByL,SAAU,GAAIqB,SAAU,kBAC/D,CAAE9M,KAAM,4BAA6ByL,SAAU,GAAIqB,SAAU,aAGjE,CACE9M,KAAM,SACNsL,WAAY,CACV,CAAEtL,KAAM,+BAA6ByL,SAAU,EAAGqB,SAAU,YAC5D,CAAE9M,KAAM,yBAAuByL,SAAU,EAAGqB,SAAU,iBACtD,CAAE9M,KAAM,uBAAwByL,SAAU,EAAGqB,SAAU,WAAYyB,aAAa,MAItF,QAAW,CACT,CACEvO,KAAM,SACNsL,WAAY,CACV,CAAEtL,KAAM,wBAAyByL,SAAU,EAAGqB,SAAU,WAAYyB,aAAa,GACjF,CAAEvO,KAAM,2BAAyByL,SAAU,EAAGqB,SAAU,YACxD,CAAE9M,KAAM,2BAAyByL,SAAU,EAAGqB,SAAU,cAG5D,CACE9M,KAAM,eACNsL,WAAY,CACV,CAAEtL,KAAM,wCAAyCyL,SAAU,GAAIqB,SAAU,aACzE,CAAE9M,KAAM,wBAAyByL,SAAU,GAAIqB,SAAU,cACzD,CAAE9M,KAAM,wBAAsByL,SAAU,EAAGqB,SAAU,gBAGzD,CACE9M,KAAM,SACNsL,WAAY,CACV,CAAEtL,KAAM,kBAAmByL,SAAU,EAAGqB,SAAU,WAClD,CAAE9M,KAAM,uBAAwByL,SAAU,EAAGqB,SAAU,WAAYyB,aAAa,OAMxF,MAAO,CACLqH,OAAQoE,EAAc/X,IAAgB+X,EAAcjT,QACpDoK,kBAAmB,GACnB1E,WAAY,SACZwN,UAAW,SAEf,CAKA,2BAAMC,GACJ,IACE,IAAInE,EAAQxI,KAAK0G,SACd+B,KAAK,sBACLC,OAAO,KAGRF,EADExI,KAAK2G,eACC6B,EAAMG,GAAG,sBAAD7S,OAAuBkK,KAAK2G,eAAc,6BAElD6B,EAAMI,GAAG,kBAAmB,MAGtC,MAAQtI,KAAMwI,EAAS,MAAEzI,SAAgBmI,EAAMoE,MAAM,QAErD,OAAIvM,GACFyG,EAAAA,GAAezG,MAAM,8BAA+BA,GAC7C,IAGFyI,GAAa,EACtB,CAAE,MAAOzI,GAEP,OADAyG,EAAAA,GAAezG,MAAM,8BAA+BA,GAC7C,EACT,CACF,CAKA,0BAAMwM,GAAwC,IAAnBvB,EAASjC,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,KACrC,IACE,IAAIb,EAAQxI,KAAK0G,SACd+B,KAAK,2BACLC,OAAO,KACPG,GAAG,kBAAmB7I,KAAK2G,gBAC3BiG,MAAM,aAAc,CAAEE,WAAW,IAEhCxB,IACF9C,EAAQA,EAAMK,GAAG,aAAcyC,IAGjC,MAAQhL,KAAMyM,EAAO,MAAE1M,SAAgBmI,EAEvC,OAAInI,GACFyG,EAAAA,GAAezG,MAAM,8BAA+BA,GAC7C,IAGF0M,GAAW,EACpB,CAAE,MAAO1M,GAEP,OADAyG,EAAAA,GAAezG,MAAM,8BAA+BA,GAC7C,EACT,CACF,CAKA,qBAAM2M,CAAgBC,EAAcC,GAAuC,IAAxBC,EAAgB9D,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,GACpE,IACE,MAAM,MAAEhJ,SAAgBL,KAAK0G,SAC1B+B,KAAK,2BACL2E,OAAO,CACNC,eAAgBH,EAChBI,kBAAmBH,EACnBI,YAAY,IAAIpa,MAAOC,gBAExByV,GAAG,KAAMoE,GACTpE,GAAG,kBAAmB7I,KAAK2G,gBAE9B,OAAItG,GACFyG,EAAAA,GAAezG,MAAM,4BAA6BA,IAC3C,IAGTyG,EAAAA,GAAeC,MAAM,0CACd,EACT,CAAE,MAAO1G,GAEP,OADAyG,EAAAA,GAAezG,MAAM,4BAA6BA,IAC3C,CACT,CACF,CAKAiI,2BAAAA,CAA4BD,GAC1B,IAAKA,IAAW0D,MAAMC,QAAQ3D,GAC5B,MAAO,GAGT,MAAMtK,EAAa,GACnB,IAAIgE,EAAa,EAsCjB,OApCAsG,EAAO7H,QAAQ,CAACd,EAAOsK,KACjBtK,EAAM3B,YAAcgO,MAAMC,QAAQtM,EAAM3B,aAC1C2B,EAAM3B,WAAWyC,QAAQ,CAACvC,EAAUyL,KAClC3L,EAAWwD,KAAK,CACd1Q,GAAG,YAADiF,OAAciM,GAChBtP,KAAMwL,EAASxL,KACfyL,SAAUD,EAASC,UAAY,EAC/BqB,SAAUtB,EAASsB,UAAY,UAC/BG,MAAOA,EAAMjN,KACbuX,WAAYA,EACZN,cAAeA,EACf1I,YAAa/C,EAAS+C,cAAe,EACrC3C,SAAUJ,EAASI,UAAY,SAC/BmG,aAAcvG,EAASuG,cAAgB,KAEzCzC,QAMNhE,EAAWyC,QAAQ,CAACvC,EAAU7D,KACvB6D,EAASuG,cAAiD,IAAjCvG,EAASuG,aAAanS,SAIhD4L,EAASuG,aAFG,IAAVpK,EAEsB,GAGA,CAAC2D,EAAW3D,EAAQ,GAAGvJ,OAKrDiW,EAAAA,GAAeC,MAAM,mDAADjR,OAAuCiI,EAAW1L,SACtEyU,EAAAA,GAAeC,MAAM,+DAADjR,OAAmDiI,EAAW1L,OAAM,iBACjF0L,CACT,CAKA,mCAAM4J,CAA8B/R,GAA2B,IAAjBwT,EAAOC,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,KAClDtL,EAAa,GAEjB,GAAInI,EAASmI,YAAcnI,EAASmI,WAAW1L,OAAS,EACtD0L,EAAanI,EAASmI,eACjB,KAAInI,EAAS0R,gBAAiB1R,EAAS0R,cAAce,OAI1D,OADAvB,EAAAA,GAAepC,KAAK,mDACb,GAHP3G,EAAaiC,KAAKsI,4BAA4B1S,EAAS0R,cAAce,OAIvE,CAOA,OAJIe,GAAmC,2BAAxBA,EAAQ1U,cACrBqJ,EAAaiC,KAAKwN,+BAA+BzP,EAAYqL,IAGxDrL,CACT,CAKAwK,2BAAAA,CAA4BF,GAC1B,IAAKA,IAAW0D,MAAMC,QAAQ3D,GAC5B,MAAO,GAGT,MAAMtP,EAAa,GACnB,IAAIc,EAAc,EAqBlB,OAnBAwO,EAAO7H,QAAQ,CAACd,EAAOsK,KACjBtK,EAAM3B,YAAcgO,MAAMC,QAAQtM,EAAM3B,aAC1C2B,EAAM3B,WAAWyC,QAAQ,CAACvC,EAAUyL,KAC9BzL,EAAS+C,cACXjI,EAAWwI,KAAK,CACd1Q,GAAG,aAADiF,OAAe+D,GACjBpH,KAAMwL,EAASxL,KACfiN,MAAOA,EAAMjN,KACbuX,WAAYA,EACZN,cAAeA,EACfnV,YAAa0J,EAAS1J,aAAW,SAAAuB,OAAamI,EAASxL,QAEzDoH,SAMRiN,EAAAA,GAAeC,MAAM,6CAADjR,OAAiCiD,EAAW1G,SACzD0G,CACT,CAKA8Q,+BAAAA,CAAgC5L,EAAUwP,EAAcrE,GACtD,MAAMtH,EAAe7D,EAASxL,KAAK4C,cACnC,IAAIsU,EAAmB8D,EAGvB,GAAI3L,EAAab,SAAS,mBAAkBa,EAAab,SAAS,gBAChEa,EAAab,SAAS,kBAAiBa,EAAab,SAAS,iBAE7D,GAAImI,EAAQzO,cAAgByO,EAAQxO,iBAAkB,CAEpD+O,EADqB3J,KAAK4C,cAAcwG,EAAQzO,aAAcyO,EAAQxO,kBAEtEkM,EAAAA,GAAeC,MAAM,2BAADjR,OAAkBmI,EAASxL,KAAI,OAAAqD,OAAM2X,EAAY,aAAA3X,OAAO6T,EAAgB,0BAAA7T,OAAyBsT,EAAQzO,aAAY,KAAA7E,OAAIsT,EAAQxO,iBAAgB,KACvK,MACEkM,EAAAA,GAAeC,MAAM,oCAADjR,OAA2BmI,EAASxL,KAAI,oBAAAqD,OAAmBsT,EAAQzO,aAAY,uBAAA7E,OAAsBsT,EAAQxO,mBA8BrI,OAzBIkH,EAAab,SAAS,kBAAiBa,EAAab,SAAS,6BAC/Da,EAAab,SAAS,oBAAmBa,EAAab,SAAS,yBAE/D0I,EAAmB9N,KAAKE,IAAI4N,EAAkB,GAC9C7C,EAAAA,GAAeC,MAAM,2BAADjR,OAAkBmI,EAASxL,KAAI,OAAAqD,OAAM2X,EAAY,aAAA3X,OAAO6T,EAAgB,kCAI1FP,EAAQtO,qBACTgH,EAAab,SAAS,mBAAkBa,EAAab,SAAS,WAC7Da,EAAab,SAAS,aAAea,EAAab,SAAS,iBAE7D0I,EAAmB9N,KAAKO,IAAIuN,EAAkB,IAC9C7C,EAAAA,GAAeC,MAAM,2BAADjR,OAAkBmI,EAASxL,KAAI,OAAAqD,OAAM2X,EAAY,aAAA3X,OAAO6T,EAAgB,wBAI1FP,EAAQvO,yBACTiH,EAAab,SAAS,mBAAkBa,EAAab,SAAS,oBAC7Da,EAAab,SAAS,mBAAkBa,EAAab,SAAS,qBAEhE0I,EAAmB9N,KAAKO,IAAIuN,EAAkB,IAC9C7C,EAAAA,GAAeC,MAAM,2BAADjR,OAAkBmI,EAASxL,KAAI,OAAAqD,OAAM2X,EAAY,aAAA3X,OAAO6T,EAAgB,yBAGvFA,CACT,CAKA/G,aAAAA,CAAcK,EAAQC,GACpB,OAAQA,GACN,IAAK,OAML,QACE,OAAOD,EALT,IAAK,QACH,OAAgB,EAATA,EACT,IAAK,SACH,OAAgB,GAATA,EAIb,CAKAuK,8BAAAA,CAA+BzP,EAAYqL,GACzC,MAAMsE,EAAgB,IAAI3P,GAC1B,IAAIgE,EAAahE,EAAW1L,OAAS,EAGrC,GAAI+W,EAAQtO,mBAAoB,CAC9B,MAAM6S,EAAmB,CACvB,CACE9c,GAAG,YAADiF,OAAciM,KAChBtP,KAAM,sCACNyL,SAAU,GACVqB,SAAU,cACVG,MAAO,iBACPsB,aAAa,EACb3C,SAAU,QAEZ,CACExN,GAAG,YAADiF,OAAciM,KAChBtP,KAAM,sCACNyL,SAAUrC,KAAKO,IAAI,GAAI4D,KAAK4C,cAAcwG,EAAQzO,cAAgB,EAAGyO,EAAQxO,kBAAoB,SAAW,GAC5G2E,SAAU,cACVG,MAAO,iBACPsB,aAAa,EACb3C,SAAU,SAIdqP,EAAcnM,QAAQoM,GACtB7G,EAAAA,GAAeC,MAAM,0BAADjR,OAAiB6X,EAAiBtb,OAAM,kCAC9D,CAGA,GAAI+W,EAAQvO,uBAAwB,CAClC,MAAM+S,EAA2B,CAC/B,CACE/c,GAAG,YAADiF,OAAciM,KAChBtP,KAAM,6CACNyL,SAAU,GACVqB,SAAU,cACVG,MAAO,oBACPsB,aAAa,EACb3C,SAAU,QAEZ,CACExN,GAAG,YAADiF,OAAciM,KAChBtP,KAAM,iDACNyL,SAAU,EACVqB,SAAU,iBACVG,MAAO,oBACPsB,aAAa,EACb3C,SAAU,QAEZ,CACExN,GAAG,YAADiF,OAAciM,KAChBtP,KAAM,sCACNyL,SAAU,GACVqB,SAAU,iBACVG,MAAO,oBACPsB,aAAa,EACb3C,SAAU,SAIdqP,EAAcnM,QAAQqM,GACtB9G,EAAAA,GAAeC,MAAM,0BAADjR,OAAiB8X,EAAyBvb,OAAM,mCACtE,CAGA,GAAI+W,EAAQpO,iBAAmBoO,EAAQpO,gBAAgB3I,OAAS,EAAG,CACjE,MAAMwb,EAAoBzE,EAAQpO,gBAAgBzJ,IAAI,CAACqK,EAASxB,KAAK,CACnEvJ,GAAG,YAADiF,OAAciM,KAChBtP,KAAK,GAADqD,OAAK8F,EAAQX,WAAU,QAAAnF,OAAO8F,EAAQrH,aAC1C2J,SAAU,EACVqB,SAAU,YACVG,MAAOM,KAAK8N,gBAAgBlS,EAAQV,QACpC8F,aAAa,EACb3C,SAAU,OACV0P,YAAa,CACX9S,WAAYW,EAAQX,WACpBC,OAAQU,EAAQV,OAChB3G,YAAaqH,EAAQrH,gBAIzBmZ,EAAcnM,QAAQsM,GACtB/G,EAAAA,GAAeC,MAAM,0BAADjR,OAAiB+X,EAAkBxb,OAAM,6BAC/D,CAGA,OADAyU,EAAAA,GAAeC,MAAM,sFAADjR,OAAuE4X,EAAcrb,SAClGqb,CACT,CAKAI,eAAAA,CAAgB5S,GACd,OAAQA,GACN,IAAK,QAYL,QACE,MAAO,mBAXT,IAAK,aAEL,IAAK,WACH,MAAO,iBACT,IAAK,WAEL,IAAK,eACH,MAAO,oBACT,IAAK,cACH,MAAO,SAIb,CAKA8S,qBAAAA,CAAsB9S,GACpB,OAAQA,GACN,IAAK,QACH,OAAO,EACT,IAAK,aACH,OAAO,EACT,IAAK,WACH,OAAO,EACT,IAAK,WACH,OAAO,EACT,IAAK,eACH,OAAO,EACT,IAAK,cACH,OAAO,EACT,QACE,OAAO,IAEb,CAKA+M,uBAAAA,CAAwBlK,EAAYqL,GAClCtC,EAAAA,GAAeC,MAAM,sDAA6ChJ,EAAW1L,QAG7E,MAAM4b,EAAwBhQ,IAC5B,MAAMxL,EAAOwL,EAASxL,KAAK4C,cAG3B,GAAI5C,EAAKwO,SAAS,gBAAexO,EAAKwO,SAAS,gBAAkBxO,EAAKwO,SAAS,kBAC7E,OAAO,IAIT,GAAIhD,EAAS8P,YACX,OAAQ9P,EAAS8P,YAAY7S,QAC3B,IAAK,QAYL,QACE,OAAO,IAXT,IAAK,aACH,OAAO,IACT,IAAK,WACH,OAAO,IACT,IAAK,WACH,OAAO,KACT,IAAK,eACH,OAAO,KACT,IAAK,cACH,OAAO,KAOb,OAAIzI,EAAKwO,SAAS,kBAAiBxO,EAAKwO,SAAS,oBAAmBxO,EAAKwO,SAAS,oBACzE,IAILxO,EAAKwO,SAAS,gBAAexO,EAAKwO,SAAS,cAAgBxO,EAAKwO,SAAS,iBACpE,IAILxO,EAAKwO,SAAS,WAAaxO,EAAKwO,SAAS,aAAexO,EAAKwO,SAAS,SACjE,IAILxO,EAAKwO,SAAS,mBAAkBxO,EAAKwO,SAAS,kBAAiBxO,EAAKwO,SAAS,eACxE,IAILxO,EAAKwO,SAAS,mBAAkBxO,EAAKwO,SAAS,WAAaxO,EAAKwO,SAAS,YACpE,IAILxO,EAAKwO,SAAS,oBAAsBxO,EAAKwO,SAAS,mBAAkBxO,EAAKwO,SAAS,SAC7E,IAILxO,EAAKwO,SAAS,mBAAkBxO,EAAKwO,SAAS,YAAcxO,EAAKwO,SAAS,oBACrE,KAILxO,EAAKwO,SAAS,oBAAmBxO,EAAKwO,SAAS,qBAAoBxO,EAAKwO,SAAS,gBAAexO,EAAKwO,SAAS,WACzG,KAILxO,EAAKwO,SAAS,WACT,KAImC,IAArCjB,KAAKkO,cAAcjQ,EAASyB,QAG/ByO,EAAmBpQ,EAAWmI,KAAK,CAAC9H,EAAG+H,KAC3C,MAAMiI,EAASH,EAAqB7P,GAC9BiQ,EAASJ,EAAqB9H,GAIpC,OAFAW,EAAAA,GAAeC,MAAM,2BAADjR,OAAkBsI,EAAE3L,KAAI,MAAAqD,OAAKsY,EAAM,SAAAtY,OAAQqQ,EAAE1T,KAAI,MAAAqD,OAAKuY,EAAM,MAE5ED,IAAWC,EACND,EAASC,EAIXjQ,EAAE3L,KAAK6b,cAAcnI,EAAE1T,QAQhC,OALAqU,EAAAA,GAAeC,MAAM,uCACrBoH,EAAiB3N,QAAQ,CAACvC,EAAU7D,KAClC0M,EAAAA,GAAeC,MAAM,GAADjR,OAAIsE,EAAQ,EAAC,MAAAtE,OAAKmI,EAASxL,KAAI,MAAAqD,OAAKmY,EAAqBhQ,GAAS,QAGjFkQ,CACT,CAKAI,gBAAAA,CAAiBzM,EAAcpC,GAC7B,MAiBM8O,EAjBgB,CACpB,mBAAiB,CACf,cAAY,iBAAkB,mBAAiB,gBAAc,QAAS,iBAExE,iBAAe,CACb,gBAAc,YAAa,SAAU,iBAAe,gBAAc,iBAClE,SAAU,WAAY,cAExB,oBAAkB,CAChB,kBAAmB,iBAAe,QAAS,iBAAe,eAC1D,iBAAe,mBAAiB,SAAU,WAE5C,OAAU,CACR,kBAAgB,mBAAiB,cAAY,UAAW,gBAI3B9O,IAAU,GAC3C,IAAK,IAAInJ,EAAI,EAAGA,EAAIiY,EAAWnc,OAAQkE,IACrC,GAAIuL,EAAab,SAASuN,EAAWjY,IACnC,OAAOA,EAGX,OAAO,GACT,CAKA2X,aAAAA,CAAcxO,GAQZ,MAPmB,CACjB,mBAAiB,EACjB,iBAAe,EACf,oBAAkB,EAClB,OAAU,EACV,QAAW,GAEKA,IAAU,CAC9B,CAKA+O,0BAAAA,CAA2BvT,GACzB,OAAQA,GACN,IAAK,QACH,OAAO,IACT,IAAK,aACH,OAAO,KACT,IAAK,WACH,OAAO,KACT,IAAK,WACH,OAAO,KACT,IAAK,eACH,OAAO,KACT,IAAK,cACH,OAAO,KACT,QACE,OAAO,KAEb,GCn+BF,EAtVuB7K,IAQhB,IARiB,OACtBC,EAAM,QACNC,EAAO,WACPme,EAAU,UACVpD,EAAS,eACTqD,EAAiB,KAAI,eACrBhI,EAAc,OACdK,GACD3W,EACC,MAAOue,EAAaC,IAAkBje,EAAAA,EAAAA,UAAS,IACxCiD,EAAYib,IAAiBle,EAAAA,EAAAA,UAAS,CAAC,IACvCmM,EAAmBgS,IAAwBne,EAAAA,EAAAA,UAAS,OACpDoM,EAAcgS,IAAmBpe,EAAAA,EAAAA,WAAS,IAC1CyP,EAAO4O,IAAYre,EAAAA,EAAAA,UAAS,OAC5BkD,EAAoBob,IAAyBte,EAAAA,EAAAA,UAAS,KACtDue,EAAqBC,IAA0Bxe,EAAAA,EAAAA,WAAS,IAG/DM,EAAAA,EAAAA,WAAU,KACJZ,GACF+e,KAED,CAAC/e,KAGJY,EAAAA,EAAAA,WAAU,KACY,IAAhB0d,GAAuBU,KAAyBH,GAAyBpS,GAAsBC,IACjGM,QAAQC,IAAI,qEACZgS,MAED,CAACX,EAAa/a,EAAYkJ,EAAmBC,EAAcmS,IAG9D,MAAME,EAAmBG,UACvB,IACEX,EAAe,GACfC,EAAc,CAAC,GACfC,EAAqB,MACrBE,EAAS,MACTD,GAAgB,GAChBI,GAAuB,SAGjBK,IAIJX,EADEH,EACY,CACZrD,UAAWA,EACX/V,YAAaoZ,EAAelc,KAC5BgD,mBAAoBkZ,EAAepa,YACnCiB,eAAgBmZ,EAAee,SAAW,YAC1CtZ,UAAWuY,EAAevY,YAAa,IAAIjD,MAAOC,cAAcuc,MAAM,KAAK,GAC3EtZ,QAASsY,EAAetY,SAAW,MAGvB,CACZiV,UAAWA,EACXlV,WAAW,IAAIjD,MAAOC,cAAcuc,MAAM,KAAK,IAGrD,CAAE,MAAOtP,GACP/C,QAAQ+C,MAAM,8BAA+BA,GAC7C4O,EAAS,kDACX,GAIIQ,EAAyBD,UAC7B,IACE,MAAM1G,QAAkB8G,EAAsBjD,wBAC9CuC,EAAsBpG,GACtBxL,QAAQC,IAAI,mCAA0BuL,EAAUzW,OAClD,CAAE,MAAOgO,GACP/C,QAAQ+C,MAAM,4BAA6BA,EAC7C,GAIIwP,GAAmBC,EAAAA,EAAAA,aAAarb,IACpCqa,EAAcxd,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACbH,GACAmD,KAEJ,IAuBG8a,EAAmBC,UACvB,IAAK,IAADO,EAAAC,EAQF,GAPAhB,GAAgB,GAChBC,EAAS,MAET3R,QAAQC,IAAI,yDACZD,QAAQC,IAAI,iCAAwB1J,IAG/BA,EAAWa,YACd,MAAM,IAAI6R,MAAM,gCAIlB,MAAM1I,QAAiB+R,EAAsB3I,sBAAsBpT,GAEnE,IAAKgK,EACH,MAAM,IAAI0I,MAAM,oCAGlBwI,EAAqBlR,GACrBgR,EAAe,GAEfvR,QAAQC,IAAI,2CAAuCM,GACnDP,QAAQC,IAAI,uCAAgD,QAAnBwS,EAAAlS,EAASE,kBAAU,IAAAgS,OAAA,EAAnBA,EAAqB1d,SAAU,GACxEiL,QAAQC,IAAI,iCAA0C,QAAnByS,EAAAnS,EAAS9E,kBAAU,IAAAiX,OAAA,EAAnBA,EAAqB3d,SAAU,EAEpE,CAAE,MAAOgO,GACP/C,QAAQ+C,MAAM,qCAAiCA,GAC/C4O,EAAS,+BAADnZ,OAAgCuK,EAAMmG,SAChD,CAAC,QACCwI,GAAgB,EAClB,GAYIiB,EAAcA,KAClBpB,EAAe,GACfC,EAAc,CAAC,GACfC,EAAqB,MACrBE,EAAS,MACTD,GAAgB,GAChBze,KAII+e,EAAqBA,IACS,2BAA3Bzb,EAAWa,YAUdwb,EAAqBA,KACzB,OAAQtB,GACN,KAAK,EACH,OAAO/a,EAAW0B,aAAe1B,EAAWa,YAC9C,KAAK,EACH,OAAOb,EAAW6D,UAAY7D,EAAW4D,eAC3C,KAAK,EACH,OAAO5D,EAAWkF,YAAclF,EAAWkF,WAAW1G,OAAS,EACjE,KAAK,EACH,OAAIid,KAAwBH,EACnBtb,EAAW8G,cAAgB9G,EAAWmH,gBAGlB,OAAtB+B,EACT,QACE,OAAO,IAIb,OAAKzM,GAGHoB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,iFAAgFC,UAC7FC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,sGAAqGC,SAAA,EAElHC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8DAA6DC,SAAA,EAC1EC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oCAAmCC,SAAA,EAChDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,uCAAsCC,SAAA,EAClDF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,gBAAeC,SAAC,iBAAS,2CAG3CF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,uBAAsBC,SAAC,qDAItCF,EAAAA,EAAAA,KAAA,UACEI,QAASme,EACTte,UAAU,qDAAoDC,UAE9DF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,WAAUC,SAAC,eAK/BC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,OAAMC,SAAA,EACnBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,iEAAgEC,SAAA,EAC7EC,EAAAA,EAAAA,MAAA,QAAAD,SAAA,CAAM,QAAMgd,EAAY,OApD3B,MAqDG/c,EAAAA,EAAAA,MAAA,QAAAD,SAAA,CAAOiK,KAAK8B,MAAOiR,EArDtB,EAqDuD,KAAK,sBAE3Dld,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wCAAuCC,UACpDF,EAAAA,EAAAA,KAAA,OACEC,UAAU,wDACVkN,MAAO,CAAEsR,MAAM,GAADra,OAAM8Y,EA1DzB,EA0D0D,IAAG,iBAOhE/c,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,CACxCyO,IACC3O,EAAAA,EAAAA,KAAA,OAAKC,UAAU,sDAAqDC,UAClEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oBAAmBC,SAAA,EAChCF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,4BAA2BC,SAAC,kBAC5CC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,6BAA4BC,SAAC,WAC3CF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,eAAcC,SAAEyO,YAOpB,IAAhBuO,IACCld,EAAAA,EAAAA,KAAC0e,EAAmB,CAClBvc,WAAYA,EACZN,SAAUsc,EACV/b,mBAAoBA,IAKP,IAAhB8a,IACCld,EAAAA,EAAAA,KAAC2e,EAAkB,CACjBxc,WAAYA,EACZN,SAAUsc,IAKG,IAAhBjB,IACCld,EAAAA,EAAAA,KAAC4e,EAAuB,CACtBzc,WAAYA,EACZN,SAAUsc,IAKG,IAAhBjB,GAAqBU,KAAwBH,IAC5Czd,EAAAA,EAAAA,KAAC6e,EAAmB,CAClB1c,WAAYA,EACZN,SAAUsc,IAKG,IAAhBjB,KAAuBU,MAAyBH,KAC/Czd,EAAAA,EAAAA,KAAC8e,EAAe,CACd3c,WAAYA,EACZkJ,kBAAmBA,EACnBC,aAAcA,EACdC,WAAYsS,QAMlB1d,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kEAAiEC,SAAA,EAC9EF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,8BAA6BC,SACzCgd,EAAc,IACbld,EAAAA,EAAAA,KAAA,UACEI,QAlMG2e,KACX7B,EAAc,GAChBC,EAAevd,GAAQA,EAAO,IAiMpBK,UAAU,gEAA+DC,SAC1E,uBAMLC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CF,EAAAA,EAAAA,KAAA,UACEI,QAASme,EACTte,UAAU,gEAA+DC,SAC1E,aAIAgd,EAAc,GAAsB,IAAhBA,GAAqBU,KAAwBH,GAChEzd,EAAAA,EAAAA,KAAA,UACEI,QAjOG4e,KACX9B,EAAc,EAChBC,EAAevd,GAAQA,EAAO,GACL,IAAhBsd,GAAqBU,MAAyBH,EAEvDC,GAAuB,GACE,IAAhBR,GAAqBU,KAAwBH,GAEtDC,GAAuB,IA0NbjX,UAAW+X,IACXve,UAAS,wDAAAmE,OACPoa,IACI,+CACA,gDACHte,SACJ,sBAIDF,EAAAA,EAAAA,KAAA,UACEI,QArLS6e,KACjB5T,GAAqB2R,IACvBA,EAAW3R,GACXxM,MAmLU4H,UAAW4E,EACXpL,UAAS,wDAAAmE,OACPiH,EACI,6CACA,gDACHnL,SACJ,yCA5IO,M,4CCtMtB,MA0JA,EA1JyB,SAACgf,GAAgC,IAAlBC,EAAKxH,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,IAC9C,MAAMyH,GAAaC,EAAAA,EAAAA,QAAO,MACpBC,GAAeD,EAAAA,EAAAA,SAAO,GACtBE,GAAcF,EAAAA,EAAAA,QAAO,MACrBG,GAAWH,EAAAA,EAAAA,QAAO,MAClBI,GAAiBJ,EAAAA,EAAAA,QAAO,MAKxBK,GAAatB,EAAAA,EAAAA,aAAY,KACzBgB,EAAWO,UACbC,aAAaR,EAAWO,SACxBP,EAAWO,QAAU,KACrB/T,QAAQC,IAAI,8CAEb,IAKGgU,GAAczB,EAAAA,EAAAA,aAAYN,UAC9B,GAAIwB,EAAaK,QACf/T,QAAQC,IAAI,8DAId,IACEyT,EAAaK,SAAU,EACvBH,EAASG,QAAU,KAGnBG,OAAOC,cAAc,IAAIC,YAAY,gBAAiB,CACpDC,OAAQ,CAAEC,WAAW,IAAIze,MAAOC,kBAGlCkK,QAAQC,IAAI,sDACNqT,EAAatQ,GAEnB2Q,EAAYI,QAAU,IAAIle,KAC1BmK,QAAQC,IAAI,uCAAgC0T,EAAYI,QAAQQ,sBAGhEL,OAAOC,cAAc,IAAIC,YAAY,mBAAoB,CACvDC,OAAQ,CACNC,WAAW,IAAIze,MAAOC,cACtB0e,SAAUb,EAAYI,WAI5B,CAAE,MAAOhR,GACP/C,QAAQ+C,MAAM,qCAA8BA,GAC5C6Q,EAASG,QAAUhR,EAGnBmR,OAAOC,cAAc,IAAIC,YAAY,gBAAiB,CACpDC,OAAQ,CACNC,WAAW,IAAIze,MAAOC,cACtBiN,MAAOA,EAAMmG,YAKjB,IACE,MAAMuL,EAAY,CAChBzR,KAAM6Q,EAAeE,QACrBO,WAAW,IAAIze,MAAOC,cACtBiN,MAAOA,EAAMmG,SAEfwL,aAAaC,QAAQ,kBAAmBC,KAAKC,UAAUJ,IACvDzU,QAAQC,IAAI,+DACd,CAAE,MAAO6U,GACP9U,QAAQ+C,MAAM,yCAAqC+R,EACrD,CAEF,CAAC,QACCpB,EAAaK,SAAU,EACvBF,EAAeE,QAAU,IAC3B,GACC,CAACT,IAKEyB,GAAOvC,EAAAA,EAAAA,aAAaxP,IAExB6Q,EAAeE,QAAU/Q,EAGzB8Q,IAGA9T,QAAQC,IAAI,iDAADzH,OAAqC+a,EAAK,OACrDC,EAAWO,QAAUiB,WAAW,KAC9Bf,EAAYjR,IACXuQ,IAEF,CAACA,EAAOO,EAAYG,IAKjBgB,GAAUzC,EAAAA,EAAAA,aAAaxP,IAC3B8Q,IACAG,EAAYjR,IACX,CAAC8Q,EAAYG,IAuChB,OAlCArgB,EAAAA,EAAAA,WAAU,IACD,KACLkgB,KAED,CAACA,KAKJlgB,EAAAA,EAAAA,WAAU,KACR,MAmBMshB,EAAeF,WAnBI9C,UACvB,IACE,MAAMiD,EAAiBT,aAAaU,QAAQ,mBAC5C,GAAID,EAAgB,CAClB,MAAMV,EAAYG,KAAKS,MAAMF,GAC7BnV,QAAQC,IAAI,+DAAmDwU,EAAUH,iBAEnEL,EAAYQ,EAAUzR,MAG5B0R,aAAaY,WAAW,mBACxBtV,QAAQC,IAAI,gDACd,CACF,CAAE,MAAO8C,GACP/C,QAAQ+C,MAAM,kDAA2CA,EAC3D,GAIgD,KAElD,MAAO,IAAMiR,aAAakB,IACzB,CAACjB,IAEG,CACLc,OACAE,UACAM,UAAW7B,EAAaK,QACxBS,SAAUb,EAAYI,QACtBhR,MAAO6Q,EAASG,QAChBD,aAEJ,EC2BA,EA/K6B,SAAC0B,EAAOC,EAAaC,GAA0C,IAAzBC,EAAW5J,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,IAAAA,UAAA,GAK5E,MAAM6J,GAAiBC,EAAAA,EAAAA,SAAQ,KAE7B,GAAgB,OAAXJ,QAAW,IAAXA,IAAAA,EAAaK,aAEhB,OADA9V,QAAQC,IAAI,oFACLuV,EAQT,IAJ6BA,EAAM5d,KAAK1D,QACf+R,IAAvB/R,EAAK6hB,eAAsD,OAAvB7hB,EAAK6hB,eAAiD,IAAvB7hB,EAAK6hB,eAKxE,OADA/V,QAAQC,IAAI,6DACLuV,EAGTxV,QAAQC,IAAI,+DACZD,QAAQC,IAAI,mCAA0B,CACpC6V,aAAcL,EAAYK,aAC1BE,WAAYR,EAAMzgB,SAIpB,MAAMkhB,GAAuBC,EAAAA,EAAAA,IAC3BV,EACAC,EAAYK,cAIRK,EAAsB,IAAIpO,IAChCkO,EAAqB/S,QAAQhP,IAC3BiiB,EAAoBnO,IAAI9T,EAAKX,GAAIW,EAAK6hB,iBAgBxC,OAZkCP,EAAMvhB,IAAIC,IAC1C,QAA2B+R,IAAvB/R,EAAK6hB,eAAsD,OAAvB7hB,EAAK6hB,eAAiD,IAAvB7hB,EAAK6hB,cAAqB,CAC/F,MAAMK,EAAkBD,EAAoB/N,IAAIlU,EAAKX,KAAO,EAE5D,OADAyM,QAAQC,IAAI,uBAADzH,OAActE,EAAKiB,KAAI,kCAAAqD,OAAiC4d,EAAgBpX,QAAQ,MAC3F7K,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKD,GAAI,IACP6hB,cAAeK,GAEnB,CACA,OAAOliB,KAIR,CAACshB,EAAkB,OAAXC,QAAW,IAAXA,OAAW,EAAXA,EAAaK,eAKlBO,GAAiB7D,EAAAA,EAAAA,aAAYN,UACjC,GAAKyD,GAAgBD,GAA+B,OAAXD,QAAW,IAAXA,GAAAA,EAAaliB,GAAtD,CAKAyM,QAAQC,IAAI,0DACZD,QAAQC,IAAI,4BAADzH,OAA6B8d,EAAYvhB,SAEpD,IACEiL,QAAQC,IAAI,2EACZD,QAAQC,IAAI,qCAADzH,OAAsC8d,EAAYvhB,SAI7D,IAAIwhB,EAAe,EACfC,EAAa,EAEjB,IAAK,MAAMtiB,KAAQoiB,EACjB,IACE,MAAM,MAAEvT,SAAgB2S,EAAgBtM,SACrC+B,KAAK,SACL2E,OAAO,CACN2G,eAAgBviB,EAAK6hB,eAAiB,EACtC9F,YAAY,IAAIpa,MAAOC,gBAExByV,GAAG,KAAMrX,EAAKX,IACdgY,GAAG,aAAckK,EAAYliB,IAE5BwP,GACF/C,QAAQ+C,MAAM,mCAADvK,OAA+BtE,EAAKX,GAAE,KAAKwP,GACxDyT,KAEAD,GAEJ,CAAE,MAAOG,GACP1W,QAAQ+C,MAAM,oCAADvK,OAAgCtE,EAAKX,GAAE,KAAKmjB,GACzDF,GACF,CAKF,GAFAxW,QAAQC,IAAI,wCAADzH,OAAiC+d,EAAY,eAAA/d,OAAcge,EAAU,aAE5EA,EAAa,EACf,MAAM,IAAIvN,MAAM,GAADzQ,OAAIge,EAAU,sCAGjC,CAAE,MAAOzT,GAEP,MADA/C,QAAQ+C,MAAM,uDAAmDA,GAC3DA,CACR,CA9CA,MAFE/C,QAAQC,IAAI,4DAiDb,CAAC0V,EAAaD,EAA4B,OAAXD,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,MAKzC,KAAEwhB,EAAI,QAAEE,EAAO,UAAEM,EAAS,SAAEf,EAAQ,MAAEzR,GAAU4T,EAAiBN,EAAgB,MAKvFziB,EAAAA,EAAAA,WAAU,KAKR,GAAI+hB,GAAeC,EAAe7gB,OAAS,EAAG,CAEzB6gB,EAAehe,KAAK,CAAC1D,EAAM4I,KAC5C,MAAM8Z,EAAepB,EAAM1Y,GAC3B,OAAO8Z,GAAgB1iB,EAAK6hB,gBAAkBa,EAAab,kBAI3D/V,QAAQC,IAAI,+EACZ8U,EAAKa,GAET,GACC,CAACA,EAAgBD,EAAaZ,EAAMS,IAKvC,MAAMqB,GAAcrE,EAAAA,EAAAA,aAAY,KAC9BxS,QAAQC,IAAI,+DAGZ,MAAM6W,EAAgBtB,EAAMvhB,IAAIC,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC/BD,GAAI,IACP6hB,cAAe,KAIXgB,GAAoBb,EAAAA,EAAAA,IACxBY,EACW,OAAXrB,QAAW,IAAXA,OAAW,EAAXA,EAAaK,cAQf,OAJIH,GACFV,EAAQ8B,GAGHA,GACN,CAACvB,EAAkB,OAAXC,QAAW,IAAXA,OAAW,EAAXA,EAAaK,aAAcH,EAAaV,IAEnD,MAAO,CACLW,iBACAL,YACAf,WACAzR,QACA8T,cACA5B,QAASA,IAAMA,EAAQW,GAE3B,ECjLaoB,EAAM,MAMNC,EAAQ,GCLRC,EAAiBC,GACP,kBAAVA,EAA2BA,EAE/BA,EACJnf,QAAQ,+BAAgC,IACxCA,QAAQ,gBAAiB,IACzBA,QAAQ,WAAY,IACpBA,QAAQ,QAAS,IACjBzC,OACA6hB,UAAU,EAAG,KAQLC,EAAoBliB,GAC1BA,GAAwB,kBAATA,EAChBA,EAAKJ,OAAS,EAAU,CAAEuiB,OAAO,EAAOvU,MAAO,2CAC/C5N,EAAKJ,OAAS,IAAY,CAAEuiB,OAAO,EAAOvU,MAAO,+CAC9C,CAAEuU,OAAO,EAAMC,UAAWL,EAAc/hB,IAHD,CAAEmiB,OAAO,EAAOvU,MAAO,6BAW1DyU,EAAoB5W,IAC/B,MAAM6W,EAAM/Y,SAASkC,GACrB,OAAI8W,MAAMD,IAAQA,EAAM,GAAKA,EAAM,IAC1B,CAAEH,OAAO,EAAOvU,MAAO,2DAEzB,CAAEuU,OAAO,EAAMvjB,MAAO0jB,IAQlBE,EAAgBC,IAY3B,IAAKA,EAAM,MAAO,CAAEN,OAAO,EAAOvU,MAAO,mBACzC,MAAM8U,EAAU,IAAIhiB,KAAK+hB,GACzB,GAAIF,MAAMG,EAAQC,WAAY,MAAO,CAAER,OAAO,EAAOvU,MAAO,qBAC5D,MAAMgV,GAAc,IAAIliB,MAAOmiB,cAC/B,OAAIH,EAAQG,cAAgB,MAAQH,EAAQG,cAAgBD,EAAc,GACjE,CAAET,OAAO,EAAOvU,MAAO,0CAA4CgV,EAAc,IAAM,KAEzF,CAAET,OAAO,EAAMvjB,MAjBPkkB,KACb,IAAKA,EAAG,OAAO,IAAIpiB,MAAOC,cAAcuc,MAAM,KAAK,GACnD,MAAMwF,EAAU,IAAIhiB,KAAKoiB,GACzB,OAAIP,MAAMG,EAAQC,YAChB9X,QAAQoH,KAAK,yBAA0B6Q,IAChC,IAAIpiB,MAAOC,cAAcuc,MAAM,KAAK,IAEtCwF,EAAQ/hB,cAAcuc,MAAM,KAAK,IAUb6F,CAAML,KAQxBM,EAAsB3C,GAC1B,IAAIA,GAAO5M,KAAK,CAAC9H,EAAG+H,KAEzB,MAAMuP,EAAmBljB,IACvB,IAAKA,EAAS,OAAO,EAGrB,GAAuB,kBAAZA,EAAsB,OAAOA,EAGxC,MAAMmjB,EAAeC,OAAOpjB,GAASmP,MAAM,OAC3C,OAAIgU,EACK3Z,SAAS2Z,EAAa,GAAI,IAI/BC,OAAOpjB,GAAS6C,cAAc4L,SAAS,OAAe,OAEnD,GAGH4U,EAAOH,EAAgBtX,EAAE5L,SACzBsjB,EAAOJ,EAAgBvP,EAAE3T,SAG/B,OAAIqjB,IAASC,EACJ,EAGFD,EAAOC,IChGLN,EAASD,IACpB,IAAKA,EAAG,OAAO,IAAIpiB,MAAOC,cAAcuc,MAAM,KAAK,GACnD,MAAMuF,EAAO,IAAI/hB,KAAKoiB,GACtB,OAAIP,MAAME,EAAKE,YACb9X,QAAQoH,KAAK,yBAA0B6Q,IAChC,IAAIpiB,MAAOC,cAAcuc,MAAM,KAAK,IAEtCuF,EAAK9hB,cAAcuc,MAAM,KAAK,IAQ1BoG,EAAgBb,IAC3B,MAAMc,EAAY,IAAI7iB,KAAK+hB,GAAMe,SACjC,OAAOD,GAAa,GAAKA,GAAa,GA4E3BE,EAAU,SAAChB,EAAMxX,GAE5B,GAAa,IAATA,EACF,OAAOwX,EAGT,GANiD7L,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,IAAAA,UAAA,GAM5B,CAEnB,MAAMkM,EAAI,IAAIpiB,KAAK+hB,GAEnB,OADAK,EAAE3P,QAAQ2P,EAAE1P,UAAYnI,GACjB8X,EAAMD,EACf,CAEE,MAtD0BY,EAACjB,EAAMxX,KAEnC,GAAa,IAATA,EACF,OAAOwX,EAGT,IAAIkB,EAAc,IAAIjjB,KAAK+hB,EAAO,aAC9BmB,EAAY,EAShB,GALIN,EAAaK,KACfC,EAAY,GAIVA,GAAa3Y,EACf,OAAO8X,EAAMY,GAIf,KAAOC,EAAY3Y,GACjB0Y,EAAYxQ,QAAQwQ,EAAYvQ,UAAY,GAC1BkQ,EAAaK,IAG7BC,IAKJ,OADeb,EAAMY,IAwBZD,CAAejB,EAAMxX,EAEhC,EASa4Y,EAAoB,SAAClY,EAAG+H,GACnC,GADqDkD,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,IAAAA,UAAA,GAChC,CAEnB,MAAMkN,EAAK,IAAIpjB,KAAKqiB,EAAMpX,IACpBoY,EAAK,IAAIrjB,KAAKqiB,EAAMrP,IAC1B,OAAOtK,KAAKO,IAAI,EAAGP,KAAK8B,OAAO6Y,EAAGpB,UAAYmB,EAAGnB,WAAad,GAChE,CAEE,OAAOmC,EAA4BrY,EAAG+H,EAE1C,EAQasQ,EAA8BA,CAACrY,EAAG+H,KAC7C,MAAMoQ,EAAK,IAAIpjB,KAAKqiB,EAAMpX,IACpBoY,EAAK,IAAIrjB,KAAKqiB,EAAMrP,IAC1B,OAAOtK,KAAKO,IAAI,EAAGP,KAAK8B,OAAO6Y,EAAGpB,UAAYmB,EAAGnB,WAAad,KAUnDoC,EAAkBA,CAACC,EAAYC,EAAoBC,KAC9D,MAAM5kB,EAAS,IAAIkB,KAAKqiB,EAAMmB,IACxBG,EAAQ,IAAI3jB,KAAKyjB,GACvB,IAAIG,EAAc,EACd1F,EAAU,IAAIle,KAAK2jB,GAGvB,MAAME,EAAcxB,EAAMmB,GAAY1V,SAAS,cAU/C,GATI+V,IACF1Z,QAAQC,IAAI,uCACZD,QAAQC,IAAI,iBAAkBiY,EAAMmB,IACpCrZ,QAAQC,IAAI,yBAA0BqZ,GACtCtZ,QAAQC,IAAI,sBAAuBsZ,GACnCvZ,QAAQC,IAAI,0BAA2BtL,EAAS6kB,IAI9C7kB,EAAS6kB,EAAO,CAClB,IAAIG,EAAc,IAAI9jB,KAAKlB,GAC3B,KAAOglB,EAAcH,IACfD,GAAmBd,EAAakB,MAClCF,IACIC,GACF1Z,QAAQC,IAAI,iCAAwBiY,EAAMyB,GAAc,aAAWF,IAGvEE,EAAYrR,QAAQqR,EAAYpR,UAAY,EAEhD,MAGE,KAAOwL,GAAWpf,GAEZ4kB,GAAmBd,EAAa1E,IAClC0F,IACIC,GACF1Z,QAAQC,IAAI,gCAAuBiY,EAAMnE,GAAU,aAAW0F,IAEvDC,GACT1Z,QAAQC,IAAI,+CAAmCiY,EAAMnE,IAEvDA,EAAQzL,QAAQyL,EAAQxL,UAAY,GAQxC,OAJImR,GACF1Z,QAAQC,IAAI,gDAAuCwZ,GAG9CA,GAsBIG,EAAwB,SAACJ,EAAOK,GAC3C,OAD+D9N,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,IAAAA,UAAA,GAGtDiN,EAAkBQ,EAAOZ,EAAQiB,EAAK,GAAG,IAAO,GAhBZC,EAACN,EAAOK,KACrD,MAAMZ,EAAK,IAAIpjB,KAAKqiB,EAAMsB,IACpBN,EAAK,IAAIrjB,KAAKqiB,EAAM2B,IAC1B,OAAOtb,KAAKO,IAAI,EAAGP,KAAK8B,OAAO6Y,EAAGpB,UAAYmB,EAAGnB,WAAad,GAAO,IAgB5D8C,CAAgCN,EAAOK,EAElD,ECjOaE,EAA2BA,CAAC7lB,EAAM8lB,KAC7C,IAAIC,EAAc,EAGd/lB,EAAKgmB,aAAYD,GAAe,GACH,IAA7B/lB,EAAKimB,aAAaplB,SAAcklB,GAAe,GACpB,IAA3B/lB,EAAKkmB,WAAWrlB,SAAcklB,GAAe,GAC7C/lB,EAAKmmB,UAAUtlB,OAAS,IAAGklB,GAAe,GAC1C/lB,EAAK0M,SAAW,KAAIqZ,GAAe,GASvC,OAFAA,GAJoB/lB,EAAKimB,aAAa7kB,OAAOglB,IAC3C,MAAMC,EAAOP,EAAS3hB,KAAKW,GAAKA,EAAEzF,KAAO+mB,GACzC,OAAOC,GAAQA,EAAKH,WAAWrlB,OAAS,IACvCA,OAGIwJ,KAAKE,IAAI,GAAIwb,IA4GTO,EAAe,SAAChF,GAAoC,IAA7B+D,EAAexN,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,IAAAA,UAAA,GAEjD,MAAM0O,EAAc,GACdC,EAAU,IAAInT,IACpB,IAAIoT,EAAoB,EAExB,IAAK,MAAMzmB,KAAQshB,EACbkF,EAAQhT,IAAIxT,EAAKX,KACnByM,QAAQoH,KAAK,kDAAD5O,OAAyCtE,EAAKX,GAAE,OAAAiF,OAAMtE,EAAKiB,OACvEwlB,MAEAD,EAAQ/S,IAAIzT,EAAKX,IACjBknB,EAAYxW,KAAK/P,IAIjBymB,EAAoB,GACtB3a,QAAQoH,KAAK,8BAAD5O,OAAqBmiB,EAAiB,8BAGpD,MAAMC,EAAU,IAAI7S,IAAI0S,EAAYxmB,IAAI+E,GAAK,CAACA,EAAEzF,GAAI,CAClDA,GAAIyF,EAAEzF,GACN2B,QAAS8D,EAAE9D,QACXC,KAAM6D,EAAE7D,KACRyL,SAAU5H,EAAE4H,SACZ9H,UAAWE,EAAEF,UACbC,QAASC,EAAED,QACX0U,SAAUzU,EAAEyU,SACZ0M,aAAc,IAAKnhB,EAAEmhB,cAAgB,IACrCU,KAAM7hB,EAAE6hB,KACR9Z,SAAU/H,EAAE+H,SACZmB,WAAYlJ,EAAEkJ,WACdwB,YAAa1K,EAAE0K,YACfwW,WAAYlhB,EAAEkhB,WACdY,iBAAkB9hB,EAAE8hB,iBACpBrS,WAAYzP,EAAEyP,WACdC,YAAa1P,EAAE0P,YACfqS,UAAW/hB,EAAE+hB,UACbC,WAAYhiB,EAAEgiB,WACdC,WAAYjiB,EAAEiiB,WACdC,UAAWliB,EAAEkiB,UACbjkB,YAAa+B,EAAE/B,YACfojB,UAAW,IAAKrhB,EAAEqhB,WAAa,IAC/Bc,cAAeniB,EAAEmiB,cACjBzN,OAAQ1U,EAAE0U,OACV0M,WAAY,IAAKphB,EAAEohB,YAAc,QAE7BgB,EAAe3M,MAAMtD,KAAKyP,EAAQS,UAGlCC,EAAuBA,KAC3B,MAAMhU,EAAU,IAAIC,IACdgU,EAAc,IAAIhU,IAElBiU,EAAkBC,IACtB,GAAInU,EAAQI,IAAI+T,GAAS,OACzB,GAAIF,EAAY7T,IAAI+T,GAMlB,OALAzb,QAAQoH,KAAK,+CAAD5O,OAAgDijB,EAAM,2BAGlEnU,EAAQK,IAAI8T,QACZF,EAAY1T,OAAO4T,GAIrBF,EAAY5T,IAAI8T,GAChB,MAAMvnB,EAAO0mB,EAAQxS,IAAIqT,GACzB,IAAKvnB,EAAM,OAIX,GAAIA,EAAKyU,oBAAmD,IAA7BzU,EAAKimB,aAAaplB,OAE/C,YADAiL,QAAQC,IAAI,uFAADzH,OAA8EtE,EAAKiB,OAKhG,IAAIumB,EAIFA,EAF+B,IAA7BxnB,EAAKimB,aAAaplB,OAEH,IAAIc,KAAK3B,EAAK4E,WAGd,IAAIjD,KAAK,cAG5B,IAAK,MAAMykB,KAAUpmB,EAAKimB,aAAc,CACtCqB,EAAelB,GACf,MAAMC,EAAOK,EAAQxS,IAAIkS,GACzB,GAAIC,EAAM,CACR,IAAIoB,EAAa,IAAI9lB,KAAK0kB,EAAK7R,aAC3BiT,EAAaD,IACfA,EAAiBC,EAErB,CACF,CAGIznB,EAAKimB,aAAaplB,OAAS,IAAMb,EAAKwP,aAExCgY,EAAepT,QAAQoT,EAAenT,UAAY,GAI/CgR,IACHmC,EDhN2B9D,KACjC,IAAIgE,EAAe,IAAI/lB,KAAK+hB,GAC5B,MAAQa,EAAamD,IACnBA,EAAatT,QAAQsT,EAAarT,UAAY,GAEhD,OAAOqT,GC2MgBC,CAAmBH,IAGtCxnB,EAAKuU,WAAayP,EAAMwD,GAGpBxnB,EAAKwP,aACPxP,EAAKwU,YAAcxU,EAAKuU,WAExBvU,EAAK4E,UAAY5E,EAAKuU,WACtBvU,EAAK6E,QAAU7E,EAAKwU,cAEpBxU,EAAKwU,YAAckQ,EAAQ1kB,EAAKuU,WAAYvU,EAAK0M,SAAU2Y,GAE3DrlB,EAAK4E,UAAY5E,EAAKuU,WACtBvU,EAAK6E,QAAU7E,EAAKwU,aAGtB6S,EAAY1T,OAAO4T,GACnBnU,EAAQK,IAAI8T,IAGd,IAAK,MAAMvnB,KAAQknB,EACjBI,EAAetnB,EAAKX,KAsFxB,IACE+nB,IAlF4BQ,MAC5B,MAAMC,EAAaX,EAAa9lB,OAAO0D,GAA6B,IAAxBA,EAAEohB,WAAWrlB,QAEzD,IAAIinB,EAAa,IAAInmB,KAAK,cAC1B,IAAK,MAAM3B,KAAQ6nB,EAAY,CAC7B,MAAME,EAAU,IAAIpmB,KAAK3B,EAAKwU,aAC1BuT,EAAUD,IACZA,EAAaC,EAEjB,CAEA,MAAM3U,EAAU,IAAIC,IAEd2U,EAAiBT,IACrB,GAAInU,EAAQI,IAAI+T,GAAS,OAEzB,MAAMvnB,EAAO0mB,EAAQxS,IAAIqT,GACzB,GAAKvnB,EAAL,CAEA,GAA+B,IAA3BA,EAAKkmB,WAAWrlB,OAClBb,EAAK8mB,WAAa9mB,EAAKwU,gBAClB,CACL,IAAIyT,EAAe,IAAItmB,KAAK,cAC5B,IAAK,MAAMumB,KAAUloB,EAAKkmB,WAAY,CACpC8B,EAAcE,GACd,MAAMC,EAAOzB,EAAQxS,IAAIgU,GACzB,GAAIC,EAAM,CACR,IAAIC,EAAgB,IAAIzmB,KAAKwmB,EAAKtB,WAG7BsB,EAAK3Y,aACR4Y,EAAchU,QAAQgU,EAAc/T,UAAY,GAE9C+T,EAAgBH,IAClBA,EAAeG,EAEnB,CACF,CACApoB,EAAK8mB,WAAa9C,EAAMiE,EAC1B,CAGA,GAAIjoB,EAAKwP,YACPxP,EAAK6mB,UAAY7mB,EAAK8mB,eACjB,CACL,MAAMuB,EAAiB,IAAI1mB,KAAK3B,EAAK8mB,YACrCuB,EAAejU,QAAQiU,EAAehU,UAAYrU,EAAK0M,UACvD1M,EAAK6mB,UAAY7C,EAAMqE,EACzB,CAEAjV,EAAQK,IAAI8T,EAjCK,GAqCnB,IAAK,MAAMvnB,KAAQ6nB,EACjBG,EAAchoB,EAAKX,IAIrB,IAAK,MAAMW,KAAQknB,EACZ9T,EAAQI,IAAIxT,EAAKX,KACpB2oB,EAAchoB,EAAKX,IAKvB,IAAK,MAAMW,KAAQknB,EACjB,GAAiC,IAA7BlnB,EAAKimB,aAAaplB,OAGpB,GAFAb,EAAK6mB,UAAY7mB,EAAKuU,WAElBvU,EAAKwP,YACPxP,EAAK8mB,WAAa9mB,EAAKuU,eAClB,CACL,MAAM8T,EAAiB,IAAI1mB,KAAK3B,EAAKuU,YACrC8T,EAAejU,QAAQiU,EAAehU,UAAYrU,EAAK0M,UACvD1M,EAAK8mB,WAAa9C,EAAMqE,EAC1B,GAOJT,GAGA,IAAIU,EAAqB,EACzB,MAAMC,EAAgB,GAEtB,IAAK,MAAMvoB,KAAQknB,EAAc,CAC/B,MAAM3S,EAAa,IAAI5S,KAAK3B,EAAKuU,YAC3BsS,EAAY,IAAIllB,KAAK3B,EAAK6mB,WAC1BE,EAAa1c,KAAK8B,OAAO0a,EAAYtS,GAAcuO,GAEzD9iB,EAAK+mB,WAAa1c,KAAKO,IAAI,EAAGmc,GAC9B/mB,EAAKgmB,WAAiC,IAApBhmB,EAAK+mB,WAGvB,IAAIyB,EAAyB,IAAI7mB,KAAK,cACtC,GAA+B,IAA3B3B,EAAKkmB,WAAWrlB,OAClBb,EAAKgnB,UAAYhnB,EAAK+mB,eACjB,CACL,IAAK,MAAMmB,KAAUloB,EAAKkmB,WAAY,CACpC,MAAMiC,EAAOzB,EAAQxS,IAAIgU,GACzB,GAAIC,EAAM,CACR,MAAMM,EAAiB,IAAI9mB,KAAKwmB,EAAK5T,YACjCkU,EAAiBD,IACnBA,EAAyBC,EAE7B,CACF,CACA,MAAMjU,EAAc,IAAI7S,KAAK3B,EAAKwU,aAC5BwS,EAAY3c,KAAK8B,OAAOqc,EAAyBhU,GAAesO,GACtE9iB,EAAKgnB,UAAY3c,KAAKO,IAAI,EAAGoc,EAC/B,CAGIhnB,EAAKgmB,aACPuC,EAAcxY,KAAK/P,EAAKX,IAGxBW,EAAK0oB,eAAiB,CACpBC,UAAuB,GAAZ3oB,EAAK2mB,KAChBiC,eAAgB5oB,EAAKmmB,UAAUtlB,OAAS,EAAI,OAAS,OACrDgoB,gBAAiB7oB,EAAKkmB,WAAWrlB,SAKrCb,EAAK8oB,YAAcze,KAAKO,IAAI,EAAG5K,EAAK+mB,WAAa/mB,EAAKgnB,WAGtDhnB,EAAK+lB,YAAcF,EAAyB7lB,EAAMknB,EACpD,CAGA,GAAIA,EAAarmB,OAAS,EAAG,CAC3B,MAAMkoB,EAAa7B,EAAannB,IAAI+E,GAAK,IAAInD,KAAKmD,EAAEF,YAC9CokB,EAAW9B,EAAannB,IAAI+E,GAAK,IAAInD,KAAKmD,EAAED,UAE5CokB,EAAW,IAAItnB,KAAK0I,KAAKE,OAAOwe,IAChCG,EAAS,IAAIvnB,KAAK0I,KAAKO,OAAOoe,IAG9BG,EAAWD,EAAOtF,UAAYqF,EAASrF,UAC7C0E,EAAqBje,KAAKO,IAAI,EAAGP,KAAK8B,MAAMgd,EAAQ,QAEpDrd,QAAQC,IAAI,4CAAgC,CAC1C+V,WAAYoF,EAAarmB,OACzB0nB,cAAeA,EAAc1nB,OAC7BooB,SAAUA,IAAazF,MAAMyF,EAASrF,WAAaqF,EAASrnB,cAAcuc,MAAM,KAAK,GAAK,MAC1F+K,OAAQA,IAAW1F,MAAM0F,EAAOtF,WAAasF,EAAOtnB,cAAcuc,MAAM,KAAK,GAAK,MAClFmK,mBAAoBA,GAExB,CAGA,MAAMc,EAvYwB9H,KAChC,MAAM8H,EAAgB,GAChBhW,EAAU,IAAIC,IAEdgW,EAAMA,CAAC9B,EAAQ+B,KACnB,GAAIlW,EAAQI,IAAI+T,GAAS,OAEzB,MAAMvnB,EAAOshB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOkoB,GACtC,GAAKvnB,EAAL,CAKA,GAHAoT,EAAQK,IAAI8T,GACZ+B,EAAYvZ,KAAKwX,GAEc,IAA3BvnB,EAAKkmB,WAAWrlB,OAAc,CAEhC,MAAM0oB,EAAeD,EAAYxjB,OAAO,CAACmP,EAAO5V,KAC9C,MAAMyF,EAAIwc,EAAMnd,KAAKnE,GAAQA,EAAKX,KAAOA,GACzC,OAAO4V,GAASnQ,EAAIA,EAAE4H,SAAW,IAChC,GAEC6c,IAAiBlf,KAAKO,OAAO0W,EAAMvhB,IAAI+E,GAAK,IAAInD,KAAKmD,EAAE0P,aAAe,IAAI7S,KAAKmD,EAAEF,WAAake,KAChGsG,EAAcrZ,KAAKuZ,EAAYva,QAEnC,MAEE,IAAK,MAAMmZ,KAAUloB,EAAKkmB,WACxBmD,EAAInB,EAAQoB,GAIhBA,EAAYE,MACZpW,EAAQO,OAAO4T,EAvBE,GA2BbkC,EAAanI,EAAMlgB,OAAO0D,GAA+B,IAA1BA,EAAEmhB,aAAaplB,QACpD,IAAK,MAAM6oB,KAAaD,EACtBJ,EAAIK,EAAUrqB,GAAI,IAGpB,OAAO+pB,GA+ViBO,CAAkBzC,GAGlC0C,EAzV6BC,EAACvI,EAAOiH,KAE7C,IAAI/b,EAAgB,EACpB,GAAI8U,EAAMzgB,OAAS,EAAG,CACpB,MAAMkoB,EAAazH,EAAMvhB,IAAI+E,GAAK,IAAInD,KAAKmD,EAAEF,YACvCokB,EAAW1H,EAAMvhB,IAAI+E,GAAK,IAAInD,KAAKmD,EAAED,UAErCokB,EAAW,IAAItnB,KAAK0I,KAAKE,OAAOwe,IAIhCI,EAHS,IAAIxnB,KAAK0I,KAAKO,OAAOoe,IAGZpF,UAAYqF,EAASrF,UAC7CpX,EAAgBnC,KAAKO,IAAI,EAAGP,KAAK8B,MAAMgd,EAAQ,OACjD,CAEA,MAAMW,EAAmBvB,EAAcziB,OAAO,CAACmP,EAAO5V,KACpD,MAAMW,EAAOshB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOA,GACtC,OAAO4V,GAASjV,EAAOA,EAAK0M,SAAW,IACtC,GAGGqd,EAAwB1f,KAAKO,IAAI4B,EAAesd,GAEhDE,EAAY1I,EAAMxb,OAAO,CAACmP,EAAOnQ,IAAMmQ,GAASnQ,EAAE6hB,MAAQ,GAAI,GAC9DsD,EAAe1B,EAAcziB,OAAO,CAACmP,EAAO5V,KAChD,MAAMW,EAAOshB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOA,GACtC,OAAO4V,GAASjV,GAAQA,EAAK2mB,MAAa,IACzC,GAEH,MAAO,CACLna,cAAeud,EACfD,iBAAkBzf,KAAK8B,MAAM2d,GAC7BE,YACAC,eACAC,mBAAoB7f,KAAK8B,MAAO8d,EAAeD,EAAa,KAC5DG,aAAc9f,KAAK8B,MAAMmV,EAAMxb,OAAO,CAACC,EAAKjB,IAAMiB,EAAMjB,EAAEiiB,WAAY,GAAKzF,EAAMzgB,QACjFupB,SAAU/f,KAAKO,OAAO0W,EAAMvhB,IAAI+E,GAAKA,EAAEiiB,aACvCsD,mBAAoB9B,EAAc1nB,OAElC+lB,iBAAkBpa,EAClB8b,mBAAoBwB,EACpBQ,mBAAoBP,EAAwBvd,IAgTrBqd,CAAwB3C,EAAcqB,GAW7D,OARAzc,QAAQC,IAAI,+CAAsCmb,EAAannB,IAAI+E,IAAC,CAClE7D,KAAM6D,EAAE7D,KACR4D,QAASC,EAAED,QACX0lB,WAAYzlB,EAAED,SAAyB,OAAdC,EAAED,cAAkCkN,IAAdjN,EAAED,QAC7C,IAAIlD,KAAKmD,EAAED,SAASjD,cAAcuc,MAAM,KAAK,GAC7C,UAGC,CACLmD,MAAO4F,EACPrY,MAAO,KACP9B,aAAcwb,EACdD,qBACAc,gBACAQ,iBAEJ,CAAE,MAAO/a,GACP,MAAO,CAAEyS,MAAO4F,EAAcrY,MAAOA,EAAMmG,QAC7C,CACF,EC1bawV,EAA+B,SAACC,GAA2C,IAA7BpF,EAAexN,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,IAAAA,UAAA,GACxE,MAAM6S,EAAc,IAAI7W,IAExB,IAAK,MAAO8W,EAAUC,KAAgBH,EAAatR,UAAW,CAC5D,IAAI0R,EAAY,EAChB,IAAK,MAAM7Z,KAAc4Z,EACvBC,GAAa/F,EAAkB9T,EAAWpM,UAAW8f,EAAQ1T,EAAWnM,QAAS,EAAGwgB,GAAkBA,GAExGqF,EAAY5W,IAAI6W,EAAUE,EAC5B,CAEA,OAAOrnB,OAAOsnB,YAAYJ,EAC5B,ECgiUA,EA1/T2B7rB,IAAyJ,IAADksB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,IAAvJ,MAAE9J,EAAK,SAAE+J,EAAQ,YAAEC,EAAW,YAAE/J,EAAW,qBAAEgK,EAAoB,gBAAElG,EAAe,mBAAEmG,EAAkB,YAAE/J,GAAc,EAAI,qBAAEgK,GAAsB5sB,GAM7Iyf,EAAAA,EAAAA,aAAaoN,IAC1C,IAAKnR,MAAMC,QAAQkR,IAAyC,IAAxBA,EAAa7qB,OAC/C,OAAO6qB,EAGT5f,QAAQC,IAAI,6FACZD,QAAQC,IAAI,iCAADzH,OAAwBonB,EAAa7qB,SAOhD,GAJyB6qB,EAAaC,MAAM,CAAC3rB,EAAM4I,IACjD4B,SAASxK,EAAKgB,WAAa4H,EAAQ,GAKnC,OADAkD,QAAQC,IAAI,wFACL2f,EAIT,MAAME,EAAoB,IAAI/X,IAC9B6X,EAAa1c,QAAQ,CAAChP,EAAM4I,KAC1B,MAAMijB,EAAU,GAAAvnB,OAAMsE,EAAQ,GAC9BgjB,EAAkB9X,IAAI9T,EAAKX,GAAIwsB,KAGjC/f,QAAQC,IAAI,mEAAoDwO,MAAMtD,KAAK2U,EAAkBzS,YAG7F,MAAM2S,EAAgBJ,EAAa3rB,IAAI,CAACC,EAAM4I,KAC5C,MAAMijB,EAAU,GAAAvnB,OAAMsE,EAAQ,GAG9B,IAAImjB,EAAuB,GACvB/rB,EAAKimB,cAAgBjmB,EAAKimB,aAAaplB,OAAS,IAClDkrB,EAAuB/rB,EAAKimB,aAAalmB,IAAIqmB,IAE3C,MAAM4F,EAAWN,EAAavnB,KAAKW,GAAKA,EAAEzF,KAAO+mB,GACjD,OAAI4F,GACFlgB,QAAQC,IAAI,4CAADzH,OAAqC0nB,EAAS/qB,KAAI,UAAAqD,OAAS8hB,EAAM,MACrEA,IAEPta,QAAQoH,KAAK,8CAAD5O,OAAqC8hB,IAC1C,QAERhlB,OAAO6qB,UAGZ,MAAMC,GAAYjsB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACbD,GAAI,IACPgB,QAAS6qB,EACT5F,aAAc8F,IAOhB,OAJIA,EAAqBlrB,OAAS,GAChCiL,QAAQC,IAAI,uBAADzH,OAActE,EAAKiB,KAAI,eAAAqD,OAActE,EAAKgB,QAAO,YAAAsD,OAAMunB,EAAU,qBAAAvnB,OAAoBynB,EAAqBlR,KAAK,MAAK,MAG1HqR,IAIT,OADApgB,QAAQC,IAAI,4EACL+f,GACN,KAGHpsB,EAAAA,EAAAA,WAAU,KAGR,GAFAoM,QAAQC,IAAI,oDAA4C,OAALuV,QAAK,IAALA,OAAK,EAALA,EAAOzgB,SAAU,GAEhEygB,GAASA,EAAMzgB,OAAS,EAAG,CAC7B,IAAIsrB,GAAc,EACdjF,EAAe,IAAI5F,GAGIA,EAAM5d,KAAK,CAAC1D,EAAM4I,KAC3C,MAAMwjB,EAAcxjB,EAAQ,EAE5B,OADkB4B,SAASxK,EAAKgB,WACXorB,MAIrBtgB,QAAQC,IAAI,0DACZD,QAAQC,IAAI,0CAAiCuV,EAAMvhB,IAAI,CAAC+E,EAAGC,KAAC,CAC1DsnB,IAAKtnB,EAAI,EACT9D,KAAM6D,EAAE7D,KACRD,QAAS8D,EAAE9D,YAGbkmB,EAAeA,EAAannB,IAAI,CAACC,EAAM4I,KAAK3I,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACvCD,GAAI,IACPgB,QAAS4H,EAAQ,KAGnBkD,QAAQC,IAAI,8BAA0Bmb,EAAannB,IAAI,CAAC+E,EAAGC,KAAC,CAC1DsnB,IAAKtnB,EAAI,EACT9D,KAAM6D,EAAE7D,KACRD,QAAS8D,EAAE9D,YAGbmrB,GAAc,GAIhB,MAAMG,EAA2BpF,EAAa9lB,OAAOpB,GACnDA,EAAKwP,aAAexP,EAAK4E,YAAc5E,EAAK6E,SAG1CynB,EAAyBzrB,OAAS,IACpCiL,QAAQC,IAAI,wDAA+CugB,EAAyBzrB,QACpFiL,QAAQC,IAAI,gEAEZmb,EAAeA,EAAannB,IAAIC,GACzBA,EAAKwP,aAGNxP,EAAK4E,YAAc5E,EAAK6E,SAC1BiH,QAAQC,IAAI,oDAAwC,CAClDwb,OAAQvnB,EAAKX,GACbktB,SAAUvsB,EAAKiB,KACfurB,kBAAmBxsB,EAAK4E,UACxB6nB,gBAAiBzsB,EAAK6E,QACtB6nB,iBAAkB1sB,EAAK4E,aAGzB3E,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKD,GAAI,IACP6E,QAAS7E,EAAK4E,UACd+nB,WAAW,IAAIhrB,MAAOC,iBAfI5B,GAsBhCmsB,GAAc,GAIZA,IACFrgB,QAAQC,IAAI,yDACZsf,EAASnE,GAEb,GACC,CAAC5F,EAAMzgB,UAKVnB,EAAAA,EAAAA,WAAU,KACR,GAAI6rB,GAAwBjK,EAAMzgB,OAAS,EAAG,CAC5C,MAAM+rB,EAAe,CACnBtL,MAAOA,EACPuL,aAAyB,OAAXtL,QAAW,IAAXA,OAAW,EAAXA,EAAa3c,UAC3BkjB,WAAuB,OAAXvG,QAAW,IAAXA,OAAW,EAAXA,EAAa1c,QACzBid,WAAYR,EAAMzgB,OAClBisB,eAAgBxL,EAAMlgB,OAAO0D,GAAkB,cAAbA,EAAE0U,QAAwB3Y,OAC5DksB,gBAAiBzL,EAAMlgB,OAAO0D,GAAkB,gBAAbA,EAAE0U,QAA0B3Y,OAC/DmsB,aAAc1L,EAAMlgB,OAAO0D,GAAkB,YAAbA,EAAE0U,QAAsB3Y,OACxDosB,cAAe3L,EAAMxb,OAAO,CAACC,EAAKjB,IAAMiB,GAAOjB,EAAEyU,UAAY,GAAI,GAAK+H,EAAMzgB,QAG9E0qB,EAAqBqB,GACrB9gB,QAAQC,IAAI,mEACd,GACC,CAACuV,EAAOiK,EAAsBhK,IAGjC,MAuGM2L,EAAe,CACnBnpB,YAAawd,EAAYxd,YACzBa,UAAW2c,EAAY3c,UACvBuoB,eAAgB5L,EAAY1c,QAC5BuoB,gBAAiB7L,EAAY8L,cAIxBC,EAAcC,IAAmBnuB,EAAAA,EAAAA,UAAS,OAC1CouB,EAAcC,IAAmBruB,EAAAA,EAAAA,UAAS,KAC1CsuB,EAAUC,IAAevuB,EAAAA,EAAAA,UAAS,UAIlCwuB,EAAaC,IAAkBzuB,EAAAA,EAAAA,UAAS,OACxC0uB,EAAcC,IAAmB3uB,EAAAA,EAAAA,UAAS,KAC1C4uB,GAAaC,KAAkB7uB,EAAAA,EAAAA,UAAS,OAGxC8uB,GAAqBC,KAA0B/uB,EAAAA,EAAAA,UAAS,KACxDgvB,GAAmBC,KAAwBjvB,EAAAA,EAAAA,UAAS,IAGrDkvB,IAAuB/O,EAAAA,EAAAA,QAAO,OAE7BgP,GAAYC,MADQjP,EAAAA,EAAAA,QAAO,OACEngB,EAAAA,EAAAA,UAAS,UACtCqvB,GAAkBC,KAAuBtvB,EAAAA,EAAAA,WAAS,IAElDuvB,GAAkBC,KAAuBxvB,EAAAA,EAAAA,WAAS,IAClDyvB,GAAeC,KAAoB1vB,EAAAA,EAAAA,UAAS,KAC5C2vB,GAAcC,KAAmB5vB,EAAAA,EAAAA,WAAS,IAC1C6vB,GAAkBC,KAAuB9vB,EAAAA,EAAAA,WAAS,IAClD+vB,GAAsBC,KAA2BhwB,EAAAA,EAAAA,WAAS,IAC1DiwB,GAAUC,KAAelwB,EAAAA,EAAAA,UAAS,OAGlCmwB,GAAmBC,KAAwBpwB,EAAAA,EAAAA,WAAS,IACpDqwB,GAAcC,KAAmBtwB,EAAAA,EAAAA,UAAS,KAC1CuwB,GAAgBC,KAAqBxwB,EAAAA,EAAAA,WAAS,IAG9CywB,GAAeC,KAAoB1wB,EAAAA,EAAAA,UAAS,OAC5C2wB,GAAiBC,KAAsB5wB,EAAAA,EAAAA,WAAS,IAGhD6wB,GAAcC,KAAmB9wB,EAAAA,EAAAA,WAAS,IAG1C+wB,GAAgBC,KAAqBhxB,EAAAA,EAAAA,WAAS,IAG/C,qBAAEixB,GAAoB,qBAAEC,GAAoB,cAAEC,KAAkBC,EAAAA,EAAAA,GACzD,OAAXjP,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GACboiB,IAIF/hB,EAAAA,EAAAA,WAAU,KACkBse,WACxB,GAAIyD,GAA0B,OAAXF,QAAW,IAAXA,GAAAA,EAAapM,eAC9B,IACE,MAAMsb,QAAuBC,EAAAA,EAAoBC,QAAQpP,EAAYpM,gBACrEib,IAAmBK,EAAeG,SAC7BH,EAAeG,SAClB9kB,QAAQoH,KAAK,6CAA2Cud,EAAezb,QAE3E,CAAE,MAAOnG,GACP/C,QAAQ+C,MAAM,+CAAgDA,GAC9DuhB,IAAkB,EACpB,GAGJS,IACC,CAACpP,EAAwB,OAAXF,QAAW,IAAXA,OAAW,EAAXA,EAAapM,iBAG9B,MAAO2b,GAAeC,KAAoB3xB,EAAAA,EAAAA,UAAS,iBAC5C4xB,GAAoBC,KAAyB7xB,EAAAA,EAAAA,UAAS,OACtD8xB,GAAyBC,KAA8B/xB,EAAAA,EAAAA,WAAS,IAChEgyB,GAAyBC,KAA8BjyB,EAAAA,EAAAA,WAAS,IAChEkyB,GAAsBC,KAA2BnyB,EAAAA,EAAAA,WAAS,IAC1DoyB,GAAoBC,KAAyBryB,EAAAA,EAAAA,WAAS,IACtDsyB,GAAgBC,KAAqBvyB,EAAAA,EAAAA,WAAS,IAG9CwyB,GAAaC,KAAkBzyB,EAAAA,EAAAA,UAAS,IACxC0yB,GAAYC,KAAiB3yB,EAAAA,EAAAA,UAAS,CAAE4yB,EAAG,EAAGC,EAAG,KAGjDC,GAAaC,KAAkB/yB,EAAAA,EAAAA,UAAS,OACxCgzB,GAAYC,KAAiBjzB,EAAAA,EAAAA,UAAS,CAAE4yB,EAAG,EAAGC,EAAG,KAGjDK,GAAWC,KAAgBnzB,EAAAA,EAAAA,WAAS,IACpCozB,GAAUC,KAAerzB,EAAAA,EAAAA,UAAS,CAAE4yB,EAAG,EAAGC,EAAG,KAC7CS,GAASC,KAAcvzB,EAAAA,EAAAA,UAAS,CAAE4yB,EAAG,EAAGC,EAAG,IAG5CW,IAAUrT,EAAAA,EAAAA,QAAO,MACjBsT,IAAWtT,EAAAA,EAAAA,QAAO,MAClBuT,IAAevT,EAAAA,EAAAA,QAAO,MACtBwT,IAAgBxT,EAAAA,EAAAA,QAAO,MAGvByT,IAAerR,EAAAA,EAAAA,SAAQ,IAAM,IAAI9N,IAAIgb,GAAc9uB,IAAK+E,GAAM,CAACA,EAAEzF,GAAIyF,KAAM,CAAC+pB,KAG5EoE,IAAYtR,EAAAA,EAAAA,SAAQ,KACxB7V,QAAQC,IAAI,4CAAmCuV,EAAMvhB,IAAI+E,IAAC,CACxDzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBC,WAAYphB,EAAEohB,WACdrhB,QAASC,EAAED,YAIbiH,QAAQC,IAAI,qDAA4CuV,EAAMvhB,IAAI+E,IAAC,CACjEzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBC,WAAYphB,EAAEohB,WACdrhB,QAASC,EAAED,YAGb,MAAMquB,EAAY5M,EAAahF,EAAO+D,GAEtCvZ,QAAQC,IAAI,0DAA8CmnB,EAAU5R,MAAMvhB,IAAI+E,IAAC,CAC7EzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBC,WAAYphB,EAAEohB,WACdrhB,QAASC,EAAED,YAGbiH,QAAQC,IAAI,sCAA6B,CACvCgB,aAAcmmB,EAAUnmB,aACxBub,mBAAoB4K,EAAU5K,mBAC9BxG,WAAYoR,EAAU5R,MAAMzgB,SAI9BiL,QAAQC,IAAI,6FAGZ,MAAMonB,EAAsB7R,EAAMvhB,IAAK2iB,IAErC,MAAM0Q,EAAUF,EAAU5R,MAAMnd,KAAKW,GAAKA,EAAEzF,KAAOqjB,EAAarjB,IAEhE,OAAK+zB,EAME,CACL/zB,GAAI+zB,EAAQ/zB,GACZ2B,QAASoyB,EAAQpyB,QACjBC,KAAMmyB,EAAQnyB,KACdyL,SAAU0mB,EAAQ1mB,SAClB9H,UAAWwuB,EAAQ7e,WACnB1P,QAASuuB,EAAQ5e,YACjB+E,SAAU6Z,EAAQ7Z,SAClB0M,aAAcmN,EAAQnN,cAAgB,GACtCU,KAAMyM,EAAQzM,KACd9Z,SAAUumB,EAAQvmB,SAClBmB,WAAYolB,EAAQplB,WACpBwB,YAAa4jB,EAAQ5jB,YACrBwW,WAAYoN,EAAQpN,WACpBY,iBAAkBwM,EAAQxM,iBAC1BrS,WAAY6e,EAAQ7e,WACpBC,YAAa4e,EAAQ5e,YACrBqS,UAAWuM,EAAQvM,UACnBC,WAAYsM,EAAQtM,WACpBC,WAAYqM,EAAQrM,WACpBC,UAAWoM,EAAQpM,UACnBjkB,YAAaqwB,EAAQrwB,YACrBojB,UAAW,IAAKiN,EAAQjN,WAAa,IACrCc,cAAemM,EAAQnM,cACvBzN,OAAQ4Z,EAAQ5Z,OAChB0M,WAAYkN,EAAQlN,YAAc,KA9BlCpa,QAAQoH,KAAK,sDAAD5O,OAA6Coe,EAAazhB,KAAI,MAAAqD,OAAKoe,EAAarjB,GAAE,MACvFqjB,KAyCX,OARA5W,QAAQC,IAAI,mEAAuDonB,EAAoBpzB,IAAI+E,IAAC,CAC1FzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBC,WAAYphB,EAAEohB,WACdrhB,QAASC,EAAED,YAGN,CACLkI,aAAcmmB,EAAUnmB,aACxBub,mBAAoB4K,EAAU5K,mBAC9BhH,MAAO6R,IAER,CAAC7R,EAAO+D,EAAiB/D,EAAMzgB,SAK5BwyB,IAAuB1R,EAAAA,EAAAA,SAAQ,IAC5BsR,GAAU3R,MAAMvhB,IAAIC,IAEzB,MAAMszB,GAAgBrzB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACjBD,GAAI,IACP4E,UAAW5E,EAAKuU,WAChB1P,QAAS7E,EAAKwU,cAGhB,OAAIxU,EAAKwP,cAEP1D,QAAQC,IAAI,+BAAsB,CAChC1M,GAAIW,EAAKX,GACT4B,KAAMjB,EAAKiB,KACX2D,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd2K,YAAaxP,EAAKwP,cAGhB8jB,EAAiB1uB,YAAc0uB,EAAiBzuB,UAClDiH,QAAQC,IAAI,iEACZ9L,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKqzB,GAAgB,IACnBzuB,QAASyuB,EAAiB1uB,aAKzB0uB,IAER,CAACL,GAAU3R,SAIZI,eAAgB6R,GAChBlS,UAAWmS,GACXlT,SAAUmT,GACV5kB,MAAO6kB,GACP/Q,YAAagR,IACXC,EAAqBP,GAAsB9R,EAAaC,EAAAA,QAAiBC,GAGvEoS,GAAeN,IAGrB7zB,EAAAA,EAAAA,WAAU,KACR,GAAIm0B,GAAahzB,OAAS,GAAKwqB,EAAU,CAEnBwI,GAAanwB,KAAK1D,IACpC,MAAM8zB,EAAcxS,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOW,EAAKX,IAClD,QAAKy0B,IAEEA,EAAYlvB,YAAc5E,EAAK4E,WACpCkvB,EAAYjvB,UAAY7E,EAAK6E,aAI/BiH,QAAQC,IAAI,qEACZsf,EAASwI,IAEb,GACC,CAACA,GAAcvS,EAAO+J,KAmIzB3rB,EAAAA,EAAAA,WAAU,KACR4vB,GAAY2D,GAAUpkB,QACrB,CAACokB,GAAUpkB,SAGdnP,EAAAA,EAAAA,WAAU,KACR,GAAI4hB,GAASA,EAAMzgB,OAAS,EAAG,CAE7B,MAAMuS,EAAU,IAAIC,IACdC,EAAiB,IAAID,IACrB0gB,EAAgB,GAEhB1K,EAAM,SAAC2K,GAA0B,IAAfC,EAAIpc,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,GAC7B,GAAIvE,EAAeE,IAAIwgB,GAAY,CAEjC,MAAME,EAAaD,EAAKE,QAAQH,GAC1BI,EAAQH,EAAKllB,MAAMmlB,GAAY5vB,OAAO,CAAC0vB,IAK7C,OAJAD,EAAchkB,KAAK,CACjBwX,OAAQyM,EACRI,MAAOA,KAEF,CACT,CACA,GAAIhhB,EAAQI,IAAIwgB,GACd,OAAO,EAGT1gB,EAAeG,IAAIugB,GACnB5gB,EAAQK,IAAIugB,GAEZ,MAAMh0B,EAAOshB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAO20B,GACtC,GAAIh0B,EACF,IAAK,MAAMomB,KAAUpmB,EAAKimB,aACxB,GAAIoD,EAAIjD,EAAQ,IAAI6N,EAAMD,IACxB,OAAO,EAMb,OADA1gB,EAAeK,OAAOqgB,IACf,CACT,EAGA1S,EAAMtS,QAAQhP,IACPoT,EAAQI,IAAIxT,EAAKX,KACpBgqB,EAAIrpB,EAAKX,MAIT00B,EAAclzB,OAAS,GACzBiL,QAAQoH,KAAK,2DAAD5O,OAAkDyvB,EAAclzB,SAC5EkzB,EAAc/kB,QAAQqlB,IACpBvoB,QAAQoH,KAAK,kBAAD5O,OAAc+vB,EAAS9M,OAAM,YAAAjjB,OAAW+vB,EAASD,MAAMvZ,KAAK,gBAE1E/O,QAAQoH,KAAK,6FAEbpH,QAAQC,IAAI,gDAEhB,GACC,CAACuV,IAGJ,MAAMgT,IAAmB3S,EAAAA,EAAAA,SAAQ,ID1vBH,SAACL,GAAoC,IAA7B+D,EAAexN,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,IAAAA,UAAA,GACrD,MAAM4S,EAAe,IAAI5W,IACnB0gB,EAAoB,GAE1B,IAAK,MAAMv0B,KAAQshB,EAEjB,GAAKthB,GAASA,EAAKmmB,WAAc5L,MAAMC,QAAQxa,EAAKmmB,WAIpD,IAAK,MAAMwE,KAAY3qB,EAAKmmB,UACrBsE,EAAajX,IAAImX,IACpBF,EAAa3W,IAAI6W,EAAU,IAG7BF,EAAavW,IAAIyW,GAAU5a,KAAK,CAC9BwX,OAAQvnB,EAAKX,GACbktB,SAAUvsB,EAAKiB,KACf2D,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd2vB,WAAY,MAKlB,IAAK,MAAO7J,EAAUC,KAAgBH,EAAatR,UAAW,CAC5D,MAAMsb,EAAoB7J,EAAYlW,KAAK,CAAC9H,EAAG+H,IAAM,IAAIhT,KAAKiL,EAAEhI,WAAa,IAAIjD,KAAKgT,EAAE/P,YAExF,IAAK,IAAIG,EAAI,EAAGA,EAAI0vB,EAAkB5zB,OAAS,EAAGkE,IAAK,CACrD,MAAM8a,EAAU4U,EAAkB1vB,GAC5B2vB,EAAOD,EAAkB1vB,EAAI,GAE/B,IAAIpD,KAAKke,EAAQhb,SAAW,IAAIlD,KAAK+yB,EAAK9vB,YAC5C2vB,EAAkBxkB,KAAK,CACrB4a,WACAgK,MAAO9U,EAAQ0H,OACfqN,MAAOF,EAAKnN,OACZsN,YAAa/P,EAAkB4P,EAAK9vB,UAAWib,EAAQhb,QAASwgB,IAGtE,CACF,CAEA,MAAO,CACLoF,aAAcjnB,OAAOsnB,YAAYL,GACjCqK,UAAWP,EACX7J,YAAaF,EAA6BC,EAAcpF,GAE5D,CC0sByC0P,CAAiBlB,GAAcxO,GAAkB,CAACwO,GAAcxO,IAGjG2P,IAAsBzV,EAAAA,EAAAA,QAAO8F,IAGnC3lB,EAAAA,EAAAA,WAAU,KACR,MAAMu1B,EAAsBC,IAC1BppB,QAAQC,IAAI,6CAAoCmpB,EAAM/U,QAEtDkL,EAAS8J,GAAa,IAAIA,KAK5B,OAFAnV,OAAOoV,iBAAiB,eAAgBH,GAEjC,KACLjV,OAAOqV,oBAAoB,eAAgBJ,KAE5C,KAEHv1B,EAAAA,EAAAA,WAAU,KAIR,GAHAoM,QAAQC,IAAI,mCAAuBsZ,GAG/B2P,GAAoBnV,UAAYwF,GAAmB/D,GAASA,EAAMzgB,OAAS,EAAG,CAChFiL,QAAQC,IAAI,uCACZipB,GAAoBnV,QAAUwF,EAE9B,MAAM6B,EAAe5F,EAAMvhB,IAAI,CAACC,EAAM4I,KAEpC,GAAI5I,EAAKwP,YACP,OAAAvP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYD,GAAI,IAAE6E,QAAS7E,EAAK4E,YAGlC,GAAI5E,EAAK4E,WAAa5E,EAAK0M,SAAU,CACnC,MAAM4oB,EAAa5Q,EAAQ1kB,EAAK4E,UAAW5E,EAAK0M,SAAU2Y,GAC1D,OAAAplB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYD,GAAI,IAAE6E,QAASywB,GAC7B,CACA,OAAOt1B,IAIHu1B,EAAarO,EAAaxjB,KAAK,CAAC1D,EAAM4I,IAC1C5I,EAAK6E,UAAYyc,EAAM1Y,GAAO/D,SAGhCiH,QAAQC,IAAI,2BAAkBwpB,GAE1BA,GACFzpB,QAAQC,IAAI,sCACZsf,EAASnE,IAETpb,QAAQC,IAAI,uDAEhB,GACC,CAACsZ,IAiBJ,MAAMmQ,IAAuB7T,EAAAA,EAAAA,SAAQ,KACnC,GAA4B,IAAxBkS,GAAahzB,OAAc,MAAO,GAGtC,IAAI40B,EAAgB5B,GAGhBvC,KACFmE,EAAgBA,EAAcr0B,OAAOpB,GAAQA,EAAKgmB,aAIpD,MAAM0P,EAAYlE,GAAqB,IAAM,IACvCmE,EAAanE,GAAqB,GAAK,GACvCoE,EAAoBpE,GAAqB,IAAM,IAC/CqE,EAAkBrE,GAAqB,IAAM,IAE7CsE,EAAQ,GAGRC,EAAS,IAAIliB,IACbmiB,EAAY,IAAI3iB,IAGhB4iB,EAAiB,SAAC1O,GAAkC,IAA1B2O,EAAQre,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,IAAIxE,IAC7C,GAAI2iB,EAAUxiB,IAAI+T,GAAS,OAAOwO,EAAO7hB,IAAIqT,IAAW,EAGxD,GAAI2O,EAAS1iB,IAAI+T,GAIf,OAHAzb,QAAQoH,KAAK,2CAA4CqU,GACzDwO,EAAOjiB,IAAIyT,EAAQ,GACnByO,EAAUviB,IAAI8T,GACP,EAGT,MAAMvnB,EAAOy1B,EAActxB,KAAKW,GAAKA,EAAEzF,KAAOkoB,GAC9C,IAAKvnB,EAAM,OAAO,EAElB,GAAiC,IAA7BA,EAAKimB,aAAaplB,OAGpB,OAFAk1B,EAAOjiB,IAAIyT,EAAQ,GACnByO,EAAUviB,IAAI8T,GACP,EAIT2O,EAASziB,IAAI8T,GAEb,IACE,MAGM/gB,GAHexG,EAAKimB,cAAgBjmB,EAAKimB,aAAaplB,OAAS,EACjEwJ,KAAKO,OAAO5K,EAAKimB,aAAalmB,IAAIqmB,GAAU6P,EAAe7P,EAAQ8P,KACnE,GACyB,EAG7B,OAFAH,EAAOjiB,IAAIyT,EAAQ/gB,GACnBwvB,EAAUviB,IAAI8T,GACP/gB,CACT,CAAC,QAEC0vB,EAASviB,OAAO4T,EAClB,CACF,EAGAkO,EAAczmB,QAAQhP,GAAQi2B,EAAej2B,EAAKX,KAGlD,MAAM82B,EAAe,IAAItiB,IACzB4hB,EAAczmB,QAAQhP,IACpB,MAAMwG,EAAQuvB,EAAO7hB,IAAIlU,EAAKX,IACzB82B,EAAa3iB,IAAIhN,IACpB2vB,EAAariB,IAAItN,EAAO,IAE1B2vB,EAAajiB,IAAI1N,GAAOuJ,KAAK/P,KAI/B,MAAMo2B,EAAW/rB,KAAKO,OAAO2P,MAAMtD,KAAKkf,EAAa1yB,SAgCrD,OA5BA0yB,EAAannB,QAAQ,CAACsS,EAAO9a,KAC3B,MAAM6vB,GAAc/U,EAAMzgB,OAAS,GAAK+0B,EAClCU,EALO,IAKqC,IAApBF,EAAW5vB,GAEzC8a,EAAMtS,QAAQ,CAAChP,EAAM4I,KACnB,MAAMopB,EAAIsE,EAAeD,EAAa,EAAMA,EAAa,EAAMztB,EAAQgtB,EACjE3D,EARK,IAQQzrB,EAAQqvB,EAE3BC,EAAM/lB,KAAK,CACT1Q,GAAIW,EAAKX,GACT2yB,EAAGA,EACHC,EAAGA,EACHtT,MAAO+W,EACPa,OAAQZ,EACRnvB,MAAOA,EACPxG,KAAMA,QAKZ8L,QAAQC,IAAI,0CAAiC+pB,EAAM/1B,IAAIy2B,IAAC,CACtDn3B,GAAIm3B,EAAEn3B,GACN2yB,EAAGwE,EAAExE,EACLC,EAAGuE,EAAEvE,EACLzrB,MAAOgwB,EAAEhwB,MACTiwB,OAAO,GAADnyB,OAAKkyB,EAAExE,EAAIwE,EAAE7X,MAAQ,EAAC,KAAAra,OAAIkyB,EAAEvE,EAAIuE,EAAED,OAAS,OAG5CT,GACN,CAACjC,GAAcvC,GAAsBE,KAElCkF,GAAelB,GAGfmB,GAAgBA,KAEpB,IAAKD,KAAiBnc,MAAMC,QAAQkc,IAIlC,OAHA5qB,QAAQC,IAAI,mEACZgmB,GAAc,CAAEC,EAAG,EAAGC,EAAG,SACzBJ,GAAe,GAUjB,GANA/lB,QAAQC,IAAI,sCAA6B,CACvC6qB,YAAa7D,GAAclT,QAC3BgX,YAAaH,GAAa71B,OAC1Bi1B,MAAOY,GAAa3nB,MAAM,EAAG,GAAGhP,IAAIy2B,IAAC,CAAOn3B,GAAIm3B,EAAEn3B,GAAI2yB,EAAGwE,EAAExE,EAAGC,EAAGuE,EAAEvE,OAGjEc,GAAclT,SAAW6W,GAAa71B,OAAS,EAAG,CAEpD,IAAIi2B,EAAOC,IAAUC,EAAOD,IAAUE,GAAQF,IAAUG,GAAQH,IAEhEL,GAAa1nB,QAAQmoB,IACnBL,EAAOzsB,KAAKE,IAAIusB,EAAMK,EAAKnF,GAC3BgF,EAAO3sB,KAAKE,IAAIysB,EAAMG,EAAKlF,GAC3BgF,EAAO5sB,KAAKO,IAAIqsB,EAAME,EAAKnF,EAAImF,EAAKxY,OACpCuY,EAAO7sB,KAAKO,IAAIssB,EAAMC,EAAKlF,EAAIkF,EAAKZ,UAGtCzqB,QAAQC,IAAI,uCAA8B,CAAE+qB,OAAME,OAAMC,OAAMC,SAG9D,MAAME,EAAS,IACTC,EAAeJ,EAAOH,EAAQ,EAAIM,EAClCE,EAAgBJ,EAAOF,EAAQ,EAAII,EAGnCG,EAAUT,EAAOM,EACjBI,EAAUR,EAAOI,EAEvBtrB,QAAQC,IAAI,6BAAoB,CAAEwrB,UAASC,UAASH,eAAcC,kBAElEvF,GAAc,CAAEC,EAAGuF,EAAStF,EAAGuF,IAC/B3F,GAAe,EACjB,MACE/lB,QAAQC,IAAI,iDAEZgmB,GAAc,CAAEC,EAAG,EAAGC,EAAG,IACzBJ,GAAe,KAKnBnyB,EAAAA,EAAAA,WAAU,KACS,YAAbguB,GAA0BqF,GAAclT,SAC1CiB,WAAW,KACT6V,MACC,MAEJ,CAACjJ,KAGJhuB,EAAAA,EAAAA,WAAU,KACS,YAAbguB,GAA0BgJ,GAAa71B,OAAS,GAClDigB,WAAW,KACT6V,MACC,MAEJ,CAACD,GAAchJ,KAGlBhuB,EAAAA,EAAAA,WAAU,KACS,YAAbguB,GACF5M,WAAW,KACL4Q,GACF+F,KAEAd,MAED,MAEJ,CAACrF,GAAsBE,GAAoB9D,EAAUgE,GAAgBgF,MAGxEh3B,EAAAA,EAAAA,WAAU,KACR,GAAiB,YAAbguB,GAA0BqF,GAAclT,QAAS,CACvCkT,GAAclT,QACtB6X,aAAa,UAAU,GAADpzB,OAAKwtB,GAAWE,EAAC,KAAA1tB,OAAIwtB,GAAWG,EAAC,KAAA3tB,OAAI,KAAOstB,GAAW,KAAAttB,OAAI,IAAMstB,IAC7F,GACC,CAACA,GAAaE,GAAYpE,KAG7BhuB,EAAAA,EAAAA,WAAU,KACYse,WAClB,GAAgB,OAAXuD,QAAW,IAAXA,GAAAA,EAAaliB,GAAlB,CAEAuwB,IAAkB,GAClB,IACE,GAAInO,EAAa,CAEf3V,QAAQC,IAAI,sDAA6CwV,EAAYliB,IACrE,MAAM,QAAEs4B,EAAO,QAAEC,SAAkBpW,EAAAA,QAAgBqW,qBAAqBtW,EAAYliB,IAChFs4B,GACF7rB,QAAQC,IAAI,qDAA4C6rB,GACxDlI,GAAgBkI,GAGZnM,GACFA,EAAqBlK,EAAYliB,GAAIu4B,GAGvC9rB,QAAQC,IAAI,2CAADzH,OAAuCszB,EAAQ/2B,UAE1DiL,QAAQoH,KAAK,qDAEjB,KAAO,CAAC,IAAD4kB,EAEL,MACMC,GAAmD,QAA9BD,EADLpX,KAAKS,MAAMX,aAAaU,QAAQ,kBAAoB,MACjC8W,wBAAgB,IAAAF,OAAA,EAA9BA,EAAiCvW,EAAYliB,MAAO,GAC/EqwB,GAAgBqI,GAChBjsB,QAAQC,IAAI,+CAADzH,OAA2CyzB,EAAmBl3B,QAC3E,CACF,CAAE,MAAOgO,GACP/C,QAAQ+C,MAAM,iCAA6BA,EAC7C,CAAC,QACC+gB,IAAkB,EACpB,CAhC4B,GAmC9BqI,IACC,CAAY,OAAX1W,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GAAIoiB,IAGrB,MAAMyW,IAAY3Y,EAAAA,EAAAA,QAAO,MACnB4Y,IAAc5Y,EAAAA,EAAAA,SAAO,GA2CrB6Y,IAAa9Z,EAAAA,EAAAA,aAAY,CAACiJ,EAAQ3nB,EAAOC,KAC7CiM,QAAQC,IAAI,mCAA0B,CAAEwb,SAAQ3nB,QAAOC,QAAOw4B,eAA4B,OAAZ/K,QAAY,IAAZA,OAAY,EAAZA,EAAcjuB,KAEvFkoB,GAKL8D,EAAUvrB,GACaA,EAAKC,IAAKC,IAC7B,GAAIA,EAAKX,KAAOkoB,EAAQ,OAAOvnB,EAG/B,MAAMs4B,EAAc,CAClBj5B,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU1M,EAAK0M,SACf9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9E,cAAe7hB,EAAK6hB,eAAiB,EACrChV,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,KAEhC3C,EAAMnc,WAAWvH,GAEvB,OAAQD,GACN,IAAK,WAAY,CACf,MAAM8M,EAAW6rB,OAAOC,SAASjV,GAAOlZ,KAAKO,IAAI,EAAGP,KAAK8B,MAAMoX,IAAQ,EACvE+U,EAAY5rB,SAAWA,EAEnB4rB,EAAY9oB,YACd8oB,EAAYzzB,QAAUyzB,EAAY1zB,UAElC0zB,EAAYzzB,QAAU6f,EAAQ4T,EAAY1zB,UAAW8H,EAAU2Y,GAEjE,KACF,CACA,IAAK,YACHiT,EAAY1zB,UAAY/E,EAEpBy4B,EAAY9oB,YACd8oB,EAAYzzB,QAAUhF,EAEtBy4B,EAAYzzB,QAAU6f,EAAQ7kB,EAAOy4B,EAAY5rB,SAAU2Y,GAE7D,MAEF,IAAK,WAAY,CACf,MAAM7T,EAAI+mB,OAAOC,SAASjV,GAAOlZ,KAAK8B,MAAMoX,GAAO,EACnD+U,EAAY/e,SAAWlP,KAAKE,IAAI,IAAKF,KAAKO,IAAI,EAAG4G,IACjD,KACF,CACA,IAAK,OACH8mB,EAAY3R,KAAO4R,OAAOC,SAASjV,GAAOA,EAAM,EAChD,MAEF,IAAK,YACH+U,EAAYnS,UAAY5L,MAAMC,QAAQ3a,GAASA,EAAQ,GACvD,MAEF,QACEy4B,EAAY14B,GAASC,EACP,SAAVD,EACFkM,QAAQC,IAAI,2DAAkD,CAC5Dwb,SACAkR,cAAez4B,EAAKJ,GACpB84B,WAAY74B,EACZ84B,aAAcL,IAGhBxsB,QAAQC,IAAI,uBAADzH,OAAc1E,EAAK,oBAAoBC,GAOxD,OAAOy4B,KAOPhL,GAAgBA,EAAajuB,KAAOkoB,IACtCzb,QAAQC,IAAI,+CAAsCwb,GAClDgG,EAAgBztB,IAEd,MAAM84B,EAAU,CACdv5B,GAAIS,EAAKT,GACT2B,QAASlB,EAAKkB,QACdC,KAAMnB,EAAKmB,KACXyL,SAAU5M,EAAK4M,SACf9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd0U,SAAUzZ,EAAKyZ,SACf0M,aAAc,IAAKnmB,EAAKmmB,cAAgB,IACxCU,KAAM7mB,EAAK6mB,KACX9Z,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjBwB,YAAa1P,EAAK0P,YAClBwW,WAAYlmB,EAAKkmB,WACjBY,iBAAkB9mB,EAAK8mB,iBACvBrS,WAAYzU,EAAKyU,WACjBC,YAAa1U,EAAK0U,YAClBqS,UAAW/mB,EAAK+mB,UAChBC,WAAYhnB,EAAKgnB,WACjBC,WAAYjnB,EAAKinB,WACjBC,UAAWlnB,EAAKknB,UAChBjkB,YAAajD,EAAKiD,YAClBojB,UAAW,IAAKrmB,EAAKqmB,WAAa,IAClCc,cAAennB,EAAKmnB,cACpBzN,OAAQ1Z,EAAK0Z,OACb0M,WAAY,IAAKpmB,EAAKomB,YAAc,KAEhC3C,EAAMnc,WAAWvH,GAEvB,OAAQD,GACN,IAAK,WAAY,CACf,MAAM8M,EAAW6rB,OAAOC,SAASjV,GAAOlZ,KAAKO,IAAI,EAAGP,KAAK8B,MAAMoX,IAAQ,EACvEqV,EAAQlsB,SAAWA,EAEfksB,EAAQppB,YACVopB,EAAQ/zB,QAAU+zB,EAAQh0B,UAE1Bg0B,EAAQ/zB,QAAU6f,EAAQkU,EAAQh0B,UAAW8H,EAAU2Y,GAEzD,KACF,CACA,IAAK,YACHuT,EAAQh0B,UAAY/E,EAEhB+4B,EAAQppB,YACVopB,EAAQ/zB,QAAUhF,EAElB+4B,EAAQ/zB,QAAU6f,EAAQ7kB,EAAO+4B,EAAQlsB,SAAU2Y,GAErD,MAEF,IAAK,WAAY,CACf,MAAM7T,EAAI+mB,OAAOC,SAASjV,GAAOlZ,KAAK8B,MAAMoX,GAAO,EACnDqV,EAAQrf,SAAWlP,KAAKE,IAAI,IAAKF,KAAKO,IAAI,EAAG4G,IAC7C,KACF,CACA,IAAK,OACHonB,EAAQjS,KAAO4R,OAAOC,SAASjV,GAAOA,EAAM,EAC5C,MAEF,IAAK,YACHqV,EAAQzS,UAAY5L,MAAMC,QAAQ3a,GAASA,EAAQ,GACnD,MAEF,QACE+4B,EAAQh5B,GAASC,EACH,SAAVD,EACFkM,QAAQC,IAAI,yDAAgD,CAC1Dwb,SACAkR,cAAe34B,EAAKF,GACpB84B,WAAY74B,EACZg5B,qBAAsBD,IAGxB9sB,QAAQC,IAAI,oCAADzH,OAA2B1E,EAAK,oBAAoBC,GAMrE,OADAiM,QAAQC,IAAI,yCAAgC6sB,GACrCA,MAtLT9sB,QAAQ+C,MAAM,sCAyLf,CAACye,IAKEwL,GAAmB,CACvB,GAAM,CAAE73B,KAAM,kBAAmB8B,YAAa,6EAA8Eg2B,MAAO,WACnI,GAAM,CAAE93B,KAAM,iBAAkB8B,YAAa,kEAAmEg2B,MAAO,WACvH,GAAM,CAAE93B,KAAM,mBAAoB8B,YAAa,gEAAiEg2B,MAAO,WACvH,GAAM,CAAE93B,KAAM,kBAAmB8B,YAAa,iEAAkEg2B,MAAO,YAInHC,IAAwB1a,EAAAA,EAAAA,aAAY,CAACiJ,EAAQ0R,KACjD,MAAM7lB,EAAU,IAAIC,IACdC,EAAiB,IAAID,IAErBgW,EAAO2K,IACX,GAAI1gB,EAAeE,IAAIwgB,GACrB,OAAO,EAET,GAAI5gB,EAAQI,IAAIwgB,GACd,OAAO,EAGT5gB,EAAQK,IAAIugB,GACZ1gB,EAAeG,IAAIugB,GAEnB,MAAMF,EAAcD,GAAa1vB,KAAKW,GAAKA,EAAEzF,KAAO20B,GACpD,GAAIF,EACF,IAAK,MAAM1N,KAAU0N,EAAY7N,aAC/B,GAAIoD,EAAIjD,GACN,OAAO,EAMb,OADA9S,EAAeK,OAAOqgB,IACf,GAIHkF,EAAYrF,GAAa1vB,KAAKW,GAAKA,EAAEzF,KAAOkoB,GAC5C4R,EAAWD,EAAY,CAC3B75B,GAAI65B,EAAU75B,GACd2B,QAASk4B,EAAUl4B,QACnBC,KAAMi4B,EAAUj4B,KAChByL,SAAUwsB,EAAUxsB,SACpB9H,UAAWs0B,EAAUt0B,UACrBC,QAASq0B,EAAUr0B,QACnB0U,SAAU2f,EAAU3f,SACpB0M,aAAc,IAAKiT,EAAUjT,cAAgB,IAC7CU,KAAMuS,EAAUvS,KAChB9Z,SAAUqsB,EAAUrsB,SACpBmB,WAAYkrB,EAAUlrB,WACtBwB,YAAa0pB,EAAU1pB,YACvBwW,WAAYkT,EAAUlT,WACtBY,iBAAkBsS,EAAUtS,iBAC5BrS,WAAY2kB,EAAU3kB,WACtBC,YAAa0kB,EAAU1kB,YACvBqS,UAAWqS,EAAUrS,UACrBC,WAAYoS,EAAUpS,WACtBC,WAAYmS,EAAUnS,WACtBC,UAAWkS,EAAUlS,UACrBjkB,YAAam2B,EAAUn2B,YACvBojB,UAAW,IAAK+S,EAAU/S,WAAa,IACvCc,cAAeiS,EAAUjS,cACzBzN,OAAQ0f,EAAU1f,OAClB0M,WAAY,IAAKgT,EAAUhT,YAAc,KACvC,KACJ,QAAIiT,IACFA,EAASlT,aAAe,IAAKkT,EAASlT,cAAgB,GAAKgT,GAGpD5P,EAAI4P,KAIZ,CAACpF,KAGEuF,IAA4B9a,EAAAA,EAAAA,aAAY,KAC5CxS,QAAQC,IAAI,qDAEZ,MAAMqH,EAAU,IAAIC,IACdC,EAAiB,IAAID,IACrB0gB,EAAgB,IAAI1gB,IAEpBgW,EAAO2K,IACX,GAAI1gB,EAAeE,IAAIwgB,GAErB,OADAD,EAActgB,IAAIugB,IACX,EAET,GAAI5gB,EAAQI,IAAIwgB,GACd,OAAO,EAGT1gB,EAAeG,IAAIugB,GACnB5gB,EAAQK,IAAIugB,GAEZ,MAAMh0B,EAAOshB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAO20B,GACtC,GAAIh0B,EACF,IAAK,MAAMomB,KAAUpmB,EAAKimB,aACxB,GAAIoD,EAAIjD,GAEN,OADA2N,EAActgB,IAAIugB,IACX,EAMb,OADA1gB,EAAeK,OAAOqgB,IACf,GAUT,GANA1S,EAAMtS,QAAQhP,IACPoT,EAAQI,IAAIxT,EAAKX,KACpBgqB,EAAIrpB,EAAKX,MAIT00B,EAAcxtB,KAAO,EAAG,CAC1BuF,QAAQoH,KAAK,+BAAD5O,OAAsByvB,EAAcxtB,KAAI,wCAAwCgU,MAAMtD,KAAK8c,IAGvG,MAAMsF,EAAe/X,EAAMvhB,IAAIC,GACzB+zB,EAAcvgB,IAAIxT,EAAKX,KACzByM,QAAQoH,KAAK,4DAAD5O,OAAmDtE,EAAKiB,KAAI,MAAAqD,OAAKtE,EAAKX,GAAE,OACpFY,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKD,GAAI,IACPimB,aAAc,GACdC,WAAY,MAGTlmB,GAMT,OAFAqrB,EAASgO,IAEF,CACT,CAEA,OAAO,GACN,CAAC/X,KAGJ5hB,EAAAA,EAAAA,WAAU,KACR,MAAM45B,EAA2BA,KAC/B,MAAMC,EAAuBC,SAASC,eAAe,qBAC/CC,EAAqBF,SAASC,eAAe,sBAEnD,GAAIF,GAAwBG,EAAoB,CAC9C,MAAMC,EAAeJ,EAAqB15B,MACpC+5B,EAAWd,GAAiBa,GAC9BC,IACFF,EAAmBG,YAAcD,EAAS72B,YAE9C,GAIIw2B,EAAuBC,SAASC,eAAe,qBACrD,GAAIF,EAIF,OAHAA,EAAqBnE,iBAAiB,SAAUkE,GAChDA,IAEO,KACLC,EAAqBlE,oBAAoB,SAAUiE,KAGtD,CAAChM,KAGmBhP,EAAAA,EAAAA,aAAY,CAACiJ,EAAQuS,KAC1ChuB,QAAQC,IAAI,4DAAgD,CAAEwb,SAAQuS,YAEtEzO,EAASvrB,IACPgM,QAAQC,IAAI,8DAAkDwb,EAAQuS,GACtEhuB,QAAQC,IAAI,2CAAkC2U,KAAKC,UAAU7gB,EAAKC,IAAI+E,IAAC,CACrEzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBC,WAAYphB,EAAEohB,cACX,KAAM,IAEX,MAAMgB,EAAepnB,EAAKC,IAAIC,IAC5B,GAAIA,EAAKX,KAAOkoB,EAAQ,CAEtB,MAAM+Q,GAAWr4B,EAAAA,EAAAA,GAAA,CACfZ,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU1M,EAAK0M,SACf9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,KAEhC4T,GAAW,CAAC,GAQlB,OANAhuB,QAAQC,IAAI,qDAAyC,CACnD1M,GAAIi5B,EAAYj5B,GAChB4B,KAAMq3B,EAAYr3B,KAClBglB,aAAcqS,EAAYrS,aAC1BC,WAAYoS,EAAYpS,aAEnBoS,CACT,CACA,OAAOt4B,IAWT,OARA8L,QAAQC,IAAI,gDAAoC2U,KAAKC,UAAUuG,EAAannB,IAAI+E,IAAC,CAC/EzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBC,WAAYphB,EAAEohB,cACX,KAAM,IAEXpa,QAAQC,IAAI,oEACLmb,KAER,KAGsB5I,EAAAA,EAAAA,aAAY,SAACiJ,EAAQwS,GAA6C,IAA3BC,EAAcniB,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,KAC/E/L,QAAQoH,KAAK,0CAAiC,CAAEqU,SAAQwS,mBAAkBC,mBAC1EluB,QAAQ+C,MAAM,0CAAiC,CAAE0Y,SAAQwS,mBAAkBC,mBAE3E,MAAMC,EAAWF,EACd5b,MAAM,KACNpe,IAAKm6B,GAAMA,EAAE74B,QACbD,OAAQ84B,GAAMA,GAAKA,IAAM3S,GAE5Bzb,QAAQC,IAAI,qCAA4BkuB,GAGxC,IAAK,MAAM/R,KAAU+R,EACnB,GAAIjB,GAAsBzR,EAAQW,GAGhC,OAFApc,QAAQ+C,MAAM,yCAAqC,CAAE0Y,SAAQW,gBAC7D5mB,MAAM,4FAADgD,OAAqFijB,EAAM,OAAAjjB,OAAM4jB,IAK1GmD,EAAUvrB,IACRgM,QAAQC,IAAI,0CAAiCjM,EAAKC,IAAI+E,IAAC,CACrDzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBC,WAAYphB,EAAEohB,eAGhB,MAAMiU,EAAU,IAAItmB,IAAI/T,EAAKC,IAAK+E,GAAM,CAACA,EAAEzF,GAAI,IAAIgU,IAAIvO,EAAEmhB,iBACzD,IAAK,MAAO,CAAEnS,KAAQqmB,EAASrmB,EAAIH,OAAO4T,GAE1C,IAAK,MAAMW,KAAU+R,EAAU,CAAC,IAADG,EACV,QAAnBA,EAAAD,EAAQjmB,IAAIgU,UAAO,IAAAkS,GAAnBA,EAAqB3mB,IAAI8T,EAC3B,CAEA,MAAMqR,EAAU94B,EAAKC,IAAK+E,IAAC,CACzBzF,GAAIyF,EAAEzF,GACN2B,QAAS8D,EAAE9D,QACXC,KAAM6D,EAAE7D,KACRyL,SAAU5H,EAAE4H,SACZ9H,UAAWE,EAAEF,UACbC,QAASC,EAAED,QACX0U,SAAUzU,EAAEyU,SACZ0M,aAAc1L,MAAMtD,KAAKkjB,EAAQjmB,IAAIpP,EAAEzF,KAAO,IAC9CsnB,KAAM7hB,EAAE6hB,KACR9Z,SAAU/H,EAAE+H,SACZmB,WAAYlJ,EAAEkJ,WACdwB,YAAa1K,EAAE0K,YACfwW,WAAYlhB,EAAEkhB,WACdY,iBAAkB9hB,EAAE8hB,iBACpBrS,WAAYzP,EAAEyP,WACdC,YAAa1P,EAAE0P,YACfqS,UAAW/hB,EAAE+hB,UACbC,WAAYhiB,EAAEgiB,WACdC,WAAYjiB,EAAEiiB,WACdC,UAAWliB,EAAEkiB,UACbjkB,YAAa+B,EAAE/B,YACfojB,UAAW,IAAKrhB,EAAEqhB,WAAa,IAC/Bc,cAAeniB,EAAEmiB,cACjBzN,OAAQ1U,EAAE0U,OACV0M,WAAYphB,EAAEzF,KAAOkoB,EAAS0S,EAAWn1B,EAAEohB,cAU7C,OAPApa,QAAQC,IAAI,6CAAoC6sB,EAAQ74B,IAAI+E,IAAC,CAC3DzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBC,WAAYphB,EAAEohB,eAGT0S,IAGT9sB,QAAQoH,KAAK,4CACbpH,QAAQ+C,MAAM,2CAChB,EAAG,CAACmqB,KA/IJ,MAiJMqB,IAAqB/b,EAAAA,EAAAA,aAAY,SAACiJ,EAAQ+S,GAA+C,IAA3BN,EAAcniB,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,KACnF/L,QAAQoH,KAAK,4CAAmC,CAAEqU,SAAQ+S,qBAAoBN,mBAC9EluB,QAAQ+C,MAAM,4CAAmC,CAAE0Y,SAAQ+S,qBAAoBN,mBAE/E,MAAMO,EAAWD,EACdnc,MAAM,KACNpe,IAAKyR,GAAMA,EAAEnQ,QACbD,OAAQoQ,GAAMA,GAAKA,IAAM+V,GAE5Bzb,QAAQC,IAAI,wCAA+BwuB,GAG3C,IAAK,MAAMnU,KAAUmU,EAAU,CAC7B,MAAMC,EAAaC,GAAoBlT,EAAQnB,GAC/C,IAAKoU,EAAWpX,MAGd,OAFAtX,QAAQ+C,MAAM,gCAAyB,CAAE0Y,SAAQnB,SAAQvX,MAAO2rB,EAAW3rB,aAC3EvN,MAAMk5B,EAAW3rB,MAGrB,CAEAwc,EAAUvrB,IACRgM,QAAQC,IAAI,0CAAiCjM,EAAKC,IAAI+E,IAAC,CACrDzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBC,WAAYphB,EAAEohB,eAIhB,MAAMgB,EAAepnB,EAAKC,IAAK+E,GACzBA,EAAEzF,KAAOkoB,EAEJ,CACLloB,GAAIyF,EAAEzF,GACN2B,QAAS8D,EAAE9D,QACXC,KAAM6D,EAAE7D,KACRyL,SAAU5H,EAAE4H,SACZ9H,UAAWE,EAAEF,UACbC,QAASC,EAAED,QACX0U,SAAUzU,EAAEyU,SACZ0M,aAAcsU,EACd5T,KAAM7hB,EAAE6hB,KACR9Z,SAAU/H,EAAE+H,SACZmB,WAAYlJ,EAAEkJ,WACdwB,YAAa1K,EAAE0K,YACfwW,WAAYlhB,EAAEkhB,WACdY,iBAAkB9hB,EAAE8hB,iBACpBrS,WAAYzP,EAAEyP,WACdC,YAAa1P,EAAE0P,YACfqS,UAAW/hB,EAAE+hB,UACbC,WAAYhiB,EAAEgiB,WACdC,WAAYjiB,EAAEiiB,WACdC,UAAWliB,EAAEkiB,UACbjkB,YAAa+B,EAAE/B,YACfojB,UAAW,IAAKrhB,EAAEqhB,WAAa,IAC/Bc,cAAeniB,EAAEmiB,cACjBzN,OAAQ1U,EAAE0U,OACV0M,WAAY,IAAKphB,EAAEohB,YAAc,IACjC8T,eAAgBA,GAIdO,EAAS9qB,SAAS3K,EAAEzF,MAAQyF,EAAEohB,WAAWzW,SAAS8X,GAC7C,CACLloB,GAAIyF,EAAEzF,GACN2B,QAAS8D,EAAE9D,QACXC,KAAM6D,EAAE7D,KACRyL,SAAU5H,EAAE4H,SACZ9H,UAAWE,EAAEF,UACbC,QAASC,EAAED,QACX0U,SAAUzU,EAAEyU,SACZ0M,aAAc,IAAKnhB,EAAEmhB,cAAgB,IACrCU,KAAM7hB,EAAE6hB,KACR9Z,SAAU/H,EAAE+H,SACZmB,WAAYlJ,EAAEkJ,WACdwB,YAAa1K,EAAE0K,YACfwW,WAAYlhB,EAAEkhB,WACdY,iBAAkB9hB,EAAE8hB,iBACpBrS,WAAYzP,EAAEyP,WACdC,YAAa1P,EAAE0P,YACfqS,UAAW/hB,EAAE+hB,UACbC,WAAYhiB,EAAEgiB,WACdC,WAAYjiB,EAAEiiB,WACdC,UAAWliB,EAAEkiB,UACbjkB,YAAa+B,EAAE/B,YACfojB,UAAW,IAAKrhB,EAAEqhB,WAAa,IAC/Bc,cAAeniB,EAAEmiB,cACjBzN,OAAQ1U,EAAE0U,OACV0M,WAAYphB,EAAEohB,WAAWnX,QAAQzK,OAAO,CAACijB,KAGtCziB,GAaX,GATAgH,QAAQC,IAAI,6CAAoCmb,EAAannB,IAAI+E,IAAC,CAChEzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBC,WAAYphB,EAAEohB,WACd8T,eAAgBl1B,EAAEk1B,mBAIhB1M,GAAgBA,EAAajuB,KAAOkoB,EAAQ,CAC9C,MAAMmT,EAAsBxT,EAAa/iB,KAAKW,GAAKA,EAAEzF,KAAOkoB,GACxDmT,GACFnN,EAAgBmN,EAEpB,CAEA,OAAOxT,GAEX,EAAG,CAAC8R,KAqCE2B,KAlCmBrc,EAAAA,EAAAA,aAAa9d,IACpC,MAAMo6B,EAAWp6B,EAAEC,OAAOZ,MAC1BiM,QAAQC,IAAI,gDAAuC,CACjD0sB,cAAejL,EACfkL,WAAYkC,EACZrT,OAAoB,OAAZ+F,QAAY,IAAZA,OAAY,EAAZA,EAAcjuB,KAExBouB,EAAgBmN,IACf,CAACpN,EAA0B,OAAZF,QAAY,IAAZA,OAAY,EAAZA,EAAcjuB,MAGTif,EAAAA,EAAAA,aAAY,KAC7BgP,GAAgBE,IAAiBF,EAAarsB,OAChD6K,QAAQC,IAAI,0DAAiD,CAC3D0sB,cAAenL,EAAarsB,KAC5By3B,WAAYlL,EACZjG,OAAQ+F,EAAajuB,KAEvB+4B,GAAW9K,EAAajuB,GAAI,OAAQmuB,KAErC,CAACF,EAAcE,EAAc4K,MAGR9Z,EAAAA,EAAAA,aAAY,KAC9BgP,IACFxhB,QAAQC,IAAI,6DAAoD,CAC9D8uB,MAAOvN,EAAarsB,KACpBsmB,OAAQ+F,EAAajuB,KAEvBouB,EAAgBH,EAAarsB,QAE9B,CAACqsB,KAG8BhP,EAAAA,EAAAA,aAAagD,IAC7C,MAAM3X,EAAS,GACTmxB,EAAW,GAEjB,IAAK,MAAM96B,KAAQshB,EACjB,GAAKthB,EAAKimB,cAA6C,IAA7BjmB,EAAKimB,aAAaplB,OAE5C,IAAK,MAAMulB,KAAUpmB,EAAKimB,aAAc,CAGtC,IAAI8U,EAAkBzZ,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAO+mB,GAG/C,IAAK2U,IAAoBvX,MAAM4C,GAAS,CACtC,MAAM4U,EAAYxwB,SAAS4b,GACvB4U,EAAY,GAAKA,GAAa1Z,EAAMzgB,SACtCk6B,EAAkBzZ,EAAM0Z,EAAY,GAExC,CAEA,IAAKD,EAAiB,CACpBpxB,EAAOoG,KAAK,iBAADzL,OAAatE,EAAKiB,KAAI,uBAAAqD,OAAsB8hB,EAAM,gBAC7D,QACF,CAGA,GAAIpmB,EAAKX,KAAO+mB,GAAUpmB,IAAS+6B,EAAiB,CAClDpxB,EAAOoG,KAAK,iBAADzL,OAAatE,EAAKiB,KAAI,+CACjC,QACF,CAGA,GAAI+3B,GAAsBh5B,EAAKX,GAAI07B,EAAgB17B,IAAK,CACtDsK,EAAOoG,KAAK,iBAADzL,OAAatE,EAAKiB,KAAI,iCAAAqD,OAAgCy2B,EAAgB95B,KAAI,MACrF,QACF,CAGA,MAAMg6B,EAAe,IAAIt5B,KAAK3B,EAAK4E,WACZ,IAAIjD,KAAKo5B,EAAgBl2B,SAE3Bo2B,GACnBH,EAAS/qB,KAAK,uBAADzL,OAActE,EAAKiB,KAAI,uBAAAqD,OAAsBy2B,EAAgB95B,KAAI,sDAElF,CAGF,MAAO,CAAE0I,SAAQmxB,aAChB,CAAC9B,MAGEyB,IAAsBnc,EAAAA,EAAAA,aAAY,CAACiJ,EAAQ2T,KAE/C,MAAMH,EAAkBzZ,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAO67B,GACjD,IAAKH,EACH,MAAO,CAAE3X,OAAO,EAAOvU,MAAM,+BAADvK,OAA4B42B,EAAa,eAIvE,GAAI3T,IAAW2T,EACb,MAAO,CAAE9X,OAAO,EAAOvU,MAAM,4DAI/B,MAAMilB,EAAcxS,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOkoB,GAC7C,GAAIuM,GAAeiH,EAAiB,CAClC,MAAME,EAAe,IAAIt5B,KAAKmyB,EAAYlvB,WAG1C,GAFuB,IAAIjD,KAAKo5B,EAAgBl2B,SAE3Bo2B,EACnB,MAAO,CAAE7X,OAAO,EAAOvU,MAAM,+EAEjC,CAGA,OAAImqB,GAAsBzR,EAAQ2T,GACzB,CAAE9X,OAAO,EAAOvU,MAAM,0DAADvK,OAAoDijB,EAAM,OAAAjjB,OAAM42B,IAGvF,CAAE9X,OAAO,EAAMvU,MAAO,OAC5B,CAACyS,EAAO0X,MAGqB1a,EAAAA,EAAAA,aAAa9d,IAC3CsL,QAAQC,IAAI,sDAA6C,CACvDmpB,MAAO10B,EACPM,KAAMN,EAAEM,KACRL,OAAQD,EAAEC,OACVZ,MAAOW,EAAEC,OAAOZ,MAChBytB,aAA0B,OAAZA,QAAY,IAAZA,OAAY,EAAZA,EAAcjuB,KAG9B,MAAMkoB,EAAS/mB,EAAEC,OAAOZ,MAKxB,GAFAsuB,GAAuB5G,GAEnBA,GAAU+F,IAAiBA,EAAarH,aAAaxW,SAAS8X,GAAS,CAAC,IAAD4T,EAEzE,MAAMX,EAAaC,GAAoBnN,EAAajuB,GAAIkoB,GACxD,IAAKiT,EAAWpX,MAOd,OANA9hB,MAAMk5B,EAAW3rB,YAGbyf,GAAqBzO,UACvByO,GAAqBzO,QAAQhgB,MAAQ,KAKzC,MAAM06B,EAAW,IAAKjN,EAAarH,cAAgB,GAAKsB,GAClDyS,GAA6D,QAA5CmB,EAAA3B,SAASC,eAAe,4BAAoB,IAAA0B,OAAA,EAA5CA,EAA8Ct7B,QAAS,KAE9EiM,QAAQC,IAAI,mDAA0C,CACpDzM,MAAOguB,EAAajuB,GACpB+7B,iBAAkB7T,EAClB8T,kBAAmB/N,EAAarH,aAChCqV,oBAAqBf,EACrBP,mBAGFluB,QAAQC,IAAI,kEAAyD,CACnEzM,MAAOguB,EAAajuB,GACpBg8B,kBAAmB/N,EAAarH,aAChCqV,oBAAqBf,EACrBP,mBAIF,MAAM1B,EAAc,CAClBj5B,GAAIiuB,EAAajuB,GACjB2B,QAASssB,EAAatsB,QACtBC,KAAMqsB,EAAarsB,KACnByL,SAAU4gB,EAAa5gB,SACvB9H,UAAW0oB,EAAa1oB,UACxBC,QAASyoB,EAAazoB,QACtB0U,SAAU+T,EAAa/T,SACvB0M,aAAcsU,EACd5T,KAAM2G,EAAa3G,KACnB9Z,SAAUygB,EAAazgB,SACvBmB,WAAYsf,EAAatf,WACzBwB,YAAa8d,EAAa9d,YAC1BwW,WAAYsH,EAAatH,WACzBY,iBAAkB0G,EAAa1G,iBAC/BrS,WAAY+Y,EAAa/Y,WACzBC,YAAa8Y,EAAa9Y,YAC1BqS,UAAWyG,EAAazG,UACxBC,WAAYwG,EAAaxG,WACzBC,WAAYuG,EAAavG,WACzBC,UAAWsG,EAAatG,UACxBjkB,YAAauqB,EAAavqB,YAC1BojB,UAAW,IAAKmH,EAAanH,WAAa,IAC1Cc,cAAeqG,EAAarG,cAC5BzN,OAAQ8T,EAAa9T,OACrB0M,WAAY,IAAKoH,EAAapH,YAAc,KAE9Cpa,QAAQoH,KAAK,0CAAiC,CAC5CqoB,MAAOjO,EAAarH,aACpBuV,QAASlD,EAAYrS,aACrBwV,MAAOnD,EAAYrS,aAAaplB,SAGlCwqB,EAASvrB,IACPgM,QAAQC,IAAI,yDAAgDuhB,EAAajuB,IACzE,MAAMu5B,EAAU94B,EAAKC,IAAI+E,GACnBA,EAAEzF,KAAOiuB,EAAajuB,GACjBi5B,EAEFxzB,GAIH41B,EAAsB9B,EAAQz0B,KAAKW,GAAKA,EAAEzF,KAAOiuB,EAAajuB,IAKpE,OAJIq7B,GACFnN,EAAgBmN,GAGX9B,IAILtK,GAAqBzO,UACvByO,GAAqBzO,QAAQhgB,MAAQ,GAEzC,GACC,CAACm5B,MAwBJt5B,EAAAA,EAAAA,WAAU,KACR,MAAMg8B,EAAkBlC,SAASC,eAAe,gBAChD,GAAIiC,EAAiB,CACnB,MAAMC,EAAyBn7B,IAC7BsL,QAAQC,IAAI,kDAAyCvL,EAAEC,OAAOZ,MAAO,QAASW,EAAEM,MAEhF,MAAM86B,EAAcp7B,EAAEC,OAAOZ,MAC7B,GAAI+7B,GAAsC,KAAvBA,EAAYv6B,QAAiC,kCAAhBu6B,EAAiD,CAC/F9vB,QAAQC,IAAI,sDAA0C6vB,GAGtD,IAAIC,EAAsBvO,EAC1B,IAAKuO,EAAqB,CAAC,IAADC,EACxB,MAAMC,EAAsD,QAA3CD,EAAGtC,SAASwC,cAAc,yBAAiB,IAAAF,OAAA,EAAxCA,EAA0CG,aAAa,gBAEzEJ,EADEE,EACoBza,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAO08B,GAEzBza,EAAMnd,KAAKW,GAAKA,EAAEzF,IAAMyF,EAAEzF,KAAOu8B,EAE3D,CAEA,GAAIC,IAAwBA,EAAoB3V,WAAWzW,SAASmsB,GAAc,CAChF,MAAM3B,EAAW4B,EAAoB3V,WAAWnX,QAAQzK,OAAO,CAACs3B,IAChE9vB,QAAQC,IAAI,gEAAuD,CACjEzM,MAAOu8B,EAAoBx8B,GAC3B68B,cAAeN,EACfO,eAAgBN,EAAoB3V,WACpCkW,iBAAkBnC,IAIpB,MAAM3B,EAAc,CAClBj5B,GAAIw8B,EAAoBx8B,GACxB2B,QAAS66B,EAAoB76B,QAC7BC,KAAM46B,EAAoB56B,KAC1ByL,SAAUmvB,EAAoBnvB,SAC9B9H,UAAWi3B,EAAoBj3B,UAC/BC,QAASg3B,EAAoBh3B,QAC7B0U,SAAUsiB,EAAoBtiB,SAC9B0M,aAAc,IAAK4V,EAAoB5V,cAAgB,IACvDU,KAAMkV,EAAoBlV,KAC1B9Z,SAAUgvB,EAAoBhvB,SAC9BmB,WAAY6tB,EAAoB7tB,WAChCwB,YAAaqsB,EAAoBrsB,YACjCwW,WAAY6V,EAAoB7V,WAChCY,iBAAkBiV,EAAoBjV,iBACtCrS,WAAYsnB,EAAoBtnB,WAChCC,YAAaqnB,EAAoBrnB,YACjCqS,UAAWgV,EAAoBhV,UAC/BC,WAAY+U,EAAoB/U,WAChCC,WAAY8U,EAAoB9U,WAChCC,UAAW6U,EAAoB7U,UAC/BjkB,YAAa84B,EAAoB94B,YACjCojB,UAAW,IAAK0V,EAAoB1V,WAAa,IACjDc,cAAe4U,EAAoB5U,cACnCzN,OAAQqiB,EAAoBriB,OAC5B0M,WAAY+T,GAEd1M,EAAgB+K,GAChBxsB,QAAQC,IAAI,8EAEZD,QAAQC,IAAI,2EACd,CACF,GAMF,OAHA2vB,EAAgBtG,iBAAiB,SAAUuG,GAC3CD,EAAgBtG,iBAAiB,QAASuG,GAEnC,KACLD,EAAgBrG,oBAAoB,SAAUsG,GAC9CD,EAAgBrG,oBAAoB,QAASsG,GAEjD,GACC,CAACrO,EAAchM,IAGlB,MAAM+a,IAAkB9c,EAAAA,EAAAA,QAAO+N,GACzBgP,IAA2B/c,EAAAA,EAAAA,QAAOyZ,IAClCuD,IAAwBhd,EAAAA,EAAAA,QAAO8a,KAGrC36B,EAAAA,EAAAA,WAAU,KACR28B,GAAgBxc,QAAUyN,EAC1BgP,GAAyBzc,QAAUmZ,GACnCuD,GAAsB1c,QAAUwa,IAC/B,CAAC/M,EAAc0L,MAGlBt5B,EAAAA,EAAAA,WAAU,KACRoM,QAAQC,IAAI,qEA0UX,KAGwBuS,EAAAA,EAAAA,aAAY,CAAC1e,EAAOC,KAE7CiM,QAAQC,IAAI,6BAA8BnM,EAAOC,IAChD,IAHH,MA0FM28B,IAAgBle,EAAAA,EAAAA,aAAY,KAChC,MAAMme,EAAa5I,GAAa9zB,IAAIC,IAAI,IAAA08B,EAAA,MAAK,CAC3CC,GAAI38B,EAAKX,GACTu9B,IAAK58B,EAAKgB,QACV67B,KAAM78B,EAAKiB,KACX67B,SAAU98B,EAAK0M,SACfqwB,UAAW/8B,EAAK4E,UAChBo4B,QAASh9B,EAAK6E,QACdo4B,SAAUj9B,EAAKuZ,SAEf2jB,cAA+B,QAAjBR,EAAA18B,EAAKimB,oBAAY,IAAAyW,OAAA,EAAjBA,EAAmB38B,IAAIqmB,IACnC,MAAM4F,EAAW6H,GAAa1vB,KAAKW,GAAKA,EAAEzF,KAAO+mB,GACjD,OAAO4F,EAAWA,EAAShrB,QAAUolB,IACpCvL,KAAK,QAAS,GACjBsiB,UAAWn9B,EAAKmmB,UAAUtL,KAAK,MAC/BuiB,KAAMp9B,EAAK2mB,KACX0W,cAAer9B,EAAK6hB,eAAiB,EACrCyb,YAAat9B,EAAKwP,YAClB+tB,WAAYv9B,EAAKgmB,WACjBwX,OAAQx9B,EAAKwZ,OACbikB,WAAYz9B,EAAKuU,WACjBmpB,YAAa19B,EAAKwU,YAClBmpB,UAAW39B,EAAK6mB,UAChB+W,WAAY59B,EAAK8mB,WACjB+W,WAAY79B,EAAK+mB,WACjB+W,UAAW99B,EAAKgnB,aAGZ+W,EAAKC,EAAAA,GAAWC,cAAcxB,GAC9ByB,EAAKF,EAAAA,GAAWG,WACtBH,EAAAA,GAAWI,kBAAkBF,EAAIH,EAAI,cAErC,MAAMM,EAAe,CACnB,CAAC,QAAS,SACV,CAAC,sBAAuBnR,EAAanpB,aACrC,CAAC,WAAYmpB,EAAaoR,WAC1B,CAAC,eAAgBpR,EAAaqR,SAC9B,CAAC,uBAAwBrR,EAAahP,SACtC,CAAC,qBAAmBgP,EAAaE,iBACjC,CAAC,uBAAwBF,EAAasR,kBACtC,CAAC,UAAWtR,EAAauR,KACzB,CAAC,UAAWvR,EAAawR,KACzB,CAAC,8BAA4BxR,EAAayR,eAC1C,CAAC,MAAOzR,EAAa0R,MAEjBC,EAAOb,EAAAA,GAAWc,aAAaT,GACrCL,EAAAA,GAAWI,kBAAkBF,EAAIW,EAAM,mBAEvCb,EAAAA,GAAeE,EAAG,GAAD55B,OAAKid,EAAYxd,YAAW,KAAAO,QAAI,IAAI3C,MAAOC,cAAcuc,MAAM,KAAK,GAAE,WACtF,CAAC0V,GAActS,IAGZwd,IAAwBzgB,EAAAA,EAAAA,aAAY,KACxC,MAAM4f,EAAKF,EAAAA,GAAWG,WAGtBryB,QAAQC,IAAI,mDACZD,QAAQC,IAAI,gBAAiB8nB,GAAahzB,QAC1CiL,QAAQC,IAAI,qBAAsB8nB,GAAa9kB,MAAM,EAAG,GAAGhP,IAAI+E,IAAC,CAC9D7D,KAAM6D,EAAE7D,KACRD,QAAS8D,EAAE9D,QACXg+B,UAAWl6B,EAAE7D,SAIf,MAAM2rB,EAAe,CACnB,CAAC,IAAK,QAAS,cAAY,SAAU,MAAO,eAAgB,YAAa,WAAY,QAAS,mBAAoB,eAAgB,OAAQ,aAAW,oBAGvJiH,GAAa7kB,QAAQ,CAAChP,EAAM4I,KAAW,IAADq2B,EAEpC,MAAMC,GAAoC,QAAjBD,EAAAj/B,EAAKimB,oBAAY,IAAAgZ,OAAA,EAAjBA,EAAmBl/B,IAAIqmB,IAC9C,MAAM4F,EAAW6H,GAAa1vB,KAAKW,GAAKA,EAAEzF,KAAO+mB,GACjD,OAAO4F,EAAWA,EAAShrB,QAAUolB,IACpCvL,KAAK,QAAS,MAEjB+R,EAAa7c,KAAK,CAChBnH,EAAQ,EACR5I,EAAKiB,KAAK,GAADqD,OACNtE,EAAK0M,SAAQ,KAChB1M,EAAK4E,UACL5E,EAAK6E,QACL7E,EAAKuZ,UAAY,EACjBvZ,EAAK6M,UAAY,QACjB7M,EAAKgO,YAAc,cACnBhO,EAAK2mB,MAAQ,EACb3mB,EAAK6hB,eAAiB,EACtBqd,EACAl/B,EAAKwP,YAAc,QAAO,KAC1BxP,EAAKgmB,WAAa,QAAO,KACzBhmB,EAAKgmB,WAAa,QAAO,SAI7B,MAAM+X,EAAKC,EAAAA,GAAWc,aAAalS,GAmBnCmR,EAAG,SAhBe,CAChB,CAAEoB,IAAK,GACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,GACP,CAAEA,IAAK,GACP,CAAEA,IAAK,KAITnB,EAAAA,GAAWI,kBAAkBF,EAAIH,EAAI,cAGrC,MAAMqB,EAAc,CAClB,CAAC,+BACD,CAAC,sBAAuB7d,EAAYxd,aACpC,CAAC,kBAAmBwd,EAAY3c,WAChC,CAAC,eAAgB2c,EAAY1c,SAC7B,CAAC,oBAAqB0c,EAAY8L,aAClC,CAAC,IACD,CAAC,kCACD,CAAC,kBAAmBwG,GAAahzB,QACjC,CAAC,qBAAmBgzB,GAAazyB,OAAO0D,GAAKA,EAAEkhB,YAAYnlB,QAC3D,CAAC,QAASgzB,GAAazyB,OAAO0D,GAAKA,EAAE0K,aAAa3O,QAClD,CAAC,8BAAyBwJ,KAAKO,OAAOipB,GAAa9zB,IAAI+E,GAAK,IAAInD,KAAKmD,EAAED,SAAS+e,YAAcvZ,KAAKE,OAAOspB,GAAa9zB,IAAI+E,GAAK,IAAInD,KAAKmD,EAAEF,WAAWgf,YAAW,OACjK,CAAC,IACD,CAAC,2BACD,CAAC,gBAAgB,IAAIjiB,MAAO2F,eAAe,WAGvC+3B,EAAYrB,EAAAA,GAAWc,aAAaM,GAC1CC,EAAU,SAAW,CAAC,CAAEF,IAAK,IAAM,CAAEA,IAAK,KAC1CnB,EAAAA,GAAWI,kBAAkBF,EAAImB,EAAW,WAE5CrB,EAAAA,GAAeE,EAAG,cAAD55B,OAAgBid,EAAYxd,YAAW,KAAAO,QAAI,IAAI3C,MAAOC,cAAcuc,MAAM,KAAK,GAAE,WACjG,CAAC0V,GAActS,IAgCZ+d,KA5BchhB,EAAAA,EAAAA,aAAa9d,IAAO,IAAD++B,EACrC,MAAMC,EAAqB,QAAjBD,EAAG/+B,EAAEC,OAAOg/B,aAAK,IAAAF,OAAA,EAAdA,EAAiB,GAC9B,IAAKC,EAAM,OAEX,MAAME,EAAS,IAAIC,WACnBD,EAAOE,OAAU1K,IACf,IACE,MAAM2K,EAAoBnf,KAAKS,MAAM+T,EAAMz0B,OAAOsS,QAIjB,IAAD+sB,EAAAC,EAAAC,EAAhC,GAFIH,EAAkBve,OAAO+J,EAASwU,EAAkBve,OACpDue,EAAkBI,UAAUnR,GAAiB+Q,EAAkBI,UAC/DJ,EAAkBK,SACpBvS,EAAYkS,EAAkBK,SAASxS,UAAY,SACnDc,GAAcqR,EAAkBK,SAAS3R,YAAc,QACvDG,GAA+D,QAA5CoR,EAACD,EAAkBK,SAASzR,wBAAgB,IAAAqR,GAAAA,GAC/DlR,GAA+D,QAA5CmR,EAACF,EAAkBK,SAASvR,wBAAgB,IAAAoR,GAAAA,GAC/D/Q,GAAuD,QAAxCgR,EAACH,EAAkBK,SAASnR,oBAAY,IAAAiR,GAAAA,GAGzD1+B,MAAM,gCACR,CAAE,MAAOuN,GACPvN,MAAM,gEACR,GAEFo+B,EAAOS,WAAWX,IACjB,KAGkB7d,EAAAA,EAAAA,SAAQ,KAAO,IAADye,EAAAC,EACjC,GAAqB,IAAjB/e,EAAMzgB,OAAc,MAAO,CAAEykB,MAAO,IAAI3jB,KAAQgkB,IAAK,IAAIhkB,MAE7D,MAAM2+B,EAAQhf,EAAMif,QAASz7B,GAAM,CAAC,IAAInD,KAAKmD,EAAEF,WAAY,IAAIjD,KAAKmD,EAAED,WAChEkO,EAAS,CACbuS,MAAO,IAAI3jB,KAAK0I,KAAKE,OAAO+1B,EAAMvgC,IAAKgkB,GAAMA,EAAEH,aAC/C+B,IAAK,IAAIhkB,KAAK0I,KAAKO,OAAO01B,EAAMvgC,IAAKgkB,GAAMA,EAAEH,cAe/C,OAXA9X,QAAQC,IAAI,4DAAmD,CAC7DuZ,MAAOtB,EAAMjR,EAAOuS,OACpBK,IAAK3B,EAAMjR,EAAO4S,KAClB7D,WAAYR,EAAMzgB,OAClB2/B,cAAuB,QAAVJ,EAAE9e,EAAM,UAAE,IAAA8e,OAAA,EAARA,EAAUx7B,UACzB67B,aAAqC,QAAzBJ,EAAE/e,EAAMA,EAAMzgB,OAAS,UAAE,IAAAw/B,OAAA,EAAvBA,EAAyBx7B,QACvC67B,cAAepf,EAAMvhB,IAAI+E,GAAKA,EAAEF,WAChC+7B,aAAct2B,KAAKE,OAAO+W,EAAMvhB,IAAI+E,GAAK,IAAInD,KAAKmD,EAAEF,WAAWgf,YAC/Dgd,gBAAiB5c,EAAM,IAAIriB,KAAK0I,KAAKE,OAAO+W,EAAMvhB,IAAI+E,GAAK,IAAInD,KAAKmD,EAAEF,WAAWgf,gBAG5E7Q,GACN,CAACuO,KAEEuJ,IAAYlJ,EAAAA,EAAAA,SAAQ,KACxB,MAAMkf,EAAS7c,EAAMsb,GAAaha,OAC5Bwb,EAAO9c,EAAMsb,GAAa3Z,KAChC,OAAOtb,KAAKO,IAAI,EAAGka,EAAkB+b,EAAQnc,EAAQoc,EAAM,EAAGzb,GAAkBA,KAC/E,CAACia,KAGEyB,IAAWpf,EAAAA,EAAAA,SAAQ,KACvB,OAAQ4M,IACN,IAAK,OACH,OAAO,GACT,IAAK,QACH,OAAO,GACT,IAAK,SACH,OAAO,EACT,QACE,OAAO,KAEV,CAACA,KAEEyS,IAAerf,EAAAA,EAAAA,SAAQ,IAAMkJ,GAAYkW,GAAU,CAAClW,GAAWkW,KAG/DnX,IAAiBjI,EAAAA,EAAAA,SAAQ,KAC7B,MAAM4G,EAAgBsL,GAAazyB,OAAQ0D,GAAMA,EAAEkhB,YAAYnlB,OACzDisB,EAAiB+G,GAAazyB,OAAQ0D,GAAqB,MAAfA,EAAEyU,UAAkB1Y,OAChEmpB,EAAY6J,GAAa/tB,OAAO,CAACC,EAAKjB,IAAMiB,EAAMjB,EAAE6hB,KAAM,GAE1Dsa,EAAWjd,EAAM,IAAIriB,MACrBu/B,EAAKrN,GAAa/tB,OAAO,CAACo0B,EAAGp1B,KACjC,MAAMq8B,EAAM92B,KAAKO,IAAI,EAAG8a,EAAsB5gB,EAAEF,UAAWE,EAAED,QAASwgB,IAChE+b,GHp9EYpP,EGo9EMlN,EAAkBhgB,EAAEF,UAAWq8B,EAAU5b,GAAmB8b,EHp9E5D92B,KAAKE,IAAI,EAAGF,KAAKO,IAAI,EAAGonB,KAA9BA,MGq9ElB,OAAOkI,EAAIp1B,EAAE6hB,KAAOya,GACnB,GAEGC,EAAKxN,GAAa/tB,OAAO,CAACo0B,EAAGp1B,IAAMo1B,EAAIp1B,EAAE6hB,MAAQ7hB,EAAEyU,SAAW,KAAM,GAGpE+nB,EAAMJ,EAAK,EAAIG,EAAKH,EAAK,EACzBK,EAHKF,EAGM,EAAIA,EAHVA,EAGoB,EAEzBG,EAAqB3N,GAAahzB,OAAS,EAAKisB,EAAiB+G,GAAahzB,OAAU,IAAM,EAC9F4gC,EAAmBzX,EACnB0X,EAAengB,EAAY8L,YAAc,EAC3CrD,EAAYzI,EAAY8L,YAAe,IAAO,EAElD,MAAO,CACLvL,WAAY+R,GAAahzB,OACzB0nB,gBACAuE,iBACA9C,YACA2X,YAAat3B,KAAK8B,MAAMk1B,GACxBzf,aAAcvX,KAAK8B,MAAM+0B,GACzBI,IAAKA,EAAIx2B,QAAQ,GACjBy2B,IAAKA,EAAIz2B,QAAQ,GACjB02B,mBAAoBA,EAAmB12B,QAAQ,GAC/C22B,mBACAC,aAAcA,EAAa52B,QAAQ,KAEpC,CAAC+oB,GAActS,KAGXqgB,GAAkBC,KAAuBziC,EAAAA,EAAAA,WAAS,IAClD0iC,GAAaC,KAAkB3iC,EAAAA,EAAAA,UAAS,CAC7C6B,KAAM,GACNyL,SAAU,EACV9H,UAAWof,EAAM,IAAIriB,MACrBkD,QAAS6f,EAAQV,EAAM,IAAIriB,MAAS,GACpCoB,YAAa,GACb8J,SAAU,SACVmB,WAAY,GACZ2Y,KAAM,EACN9E,cAAe,EACfmgB,qBAAsB,KAmPlBC,GAAyBzC,IAC7B1zB,QAAQC,IAAI,uDAEZ,MAAM2zB,EAAS,IAAIC,WAEnBD,EAAOE,OAAUp/B,IACf,IACEsL,QAAQC,IAAI,qDACZ,MAAM+C,EAAO,IAAIozB,WAAW1hC,EAAEC,OAAOsS,QAGrC,GAFAjH,QAAQC,IAAI,0DAA8C+C,EAAKjO,QAE3C,IAAhBiO,EAAKjO,OACP,MAAM,IAAIkU,MAAM,+BAGlB,MAAMotB,EAAWnE,EAAAA,GAAUlvB,EAAM,CAAEhO,KAAM,UACzCgL,QAAQC,IAAI,yDACZq2B,GAAgBD,EAElB,CAAE,MAAOE,GACPv2B,QAAQ+C,MAAM,uCAAmCwzB,GACjD/gC,MAAM,0IACR,GAGFo+B,EAAO4C,QAAWzzB,IAAW,IAAD0zB,EAC1Bz2B,QAAQ+C,MAAM,uCAAmCA,GACjD/C,QAAQ+C,MAAM,sCAA8C,QAAd0zB,EAAE1zB,EAAMpO,cAAM,IAAA8hC,OAAA,EAAZA,EAAc1zB,OAC9DvN,MAAM,sIAIRo+B,EAAO8C,cAAchD,IAIjB4C,GAAmBD,IACvB,IACEr2B,QAAQC,IAAI,uDAA8Co2B,EAASM,YAEnE,MAAMC,EAAYP,EAASQ,OAAOR,EAASM,WAAW,IAChDG,EAAW5E,EAAAA,GAAW6E,cAAcH,EAAW,CAAEI,OAAQ,IAK/D,GAJAh3B,QAAQC,IAAI,gDAAuC62B,EAAS/hC,QAE5DiL,QAAQC,IAAI,uCAA8B62B,GAEtCA,EAAS/hC,OAAS,EAEpB,YADAS,MAAM,oFAKR,MAAMyhC,EAAUH,EAAS,GACzB92B,QAAQC,IAAI,wCAA+Bg3B,GAG3C,MAAMC,EAAY,CAEhBC,OAAQF,EAAQG,UAAUC,IACxB,MAAMC,EAAe,OAADD,QAAC,IAADA,OAAC,EAADA,EAAG/yB,WAAWvM,cAClC,OAAkB,OAAXu/B,QAAW,IAAXA,OAAW,EAAXA,EAAa3zB,SAAS,aAAwB,OAAX2zB,QAAW,IAAXA,OAAW,EAAXA,EAAa3zB,SAAS,YAElE4zB,SAAUN,EAAQG,UAAUC,GAAKA,GAAKA,EAAE/yB,WAAWvM,cAAc4L,SAAS,WAC1E6zB,OAAQP,EAAQG,UAAUC,GAAKA,GAAKA,EAAE/yB,WAAWvM,cAAc4L,SAAS,WACxE8zB,IAAKR,EAAQG,UAAUC,GAAKA,GAAKA,EAAE/yB,WAAWvM,cAAc4L,SAAS,QACrE+zB,SAAUT,EAAQG,UAAUC,GAAKA,GAAKA,EAAE/yB,WAAWvM,cAAc4L,SAAS,aAC1Eg0B,UAAWV,EAAQG,UAAUC,GAAKA,GAAKA,EAAE/yB,WAAWvM,cAAc4L,SAAS,cAC3Ei0B,SAAUX,EAAQG,UAAUC,GAAKA,GAAKA,EAAE/yB,WAAWvM,cAAc4L,SAAS,aAC1Ek0B,MAAOZ,EAAQG,UAAUC,GAAKA,GAAKA,EAAE/yB,WAAWvM,cAAc4L,SAAS,UACvEoS,cAAekhB,EAAQG,UAAUC,IAC/B,MAAMC,EAAe,OAADD,QAAC,IAADA,OAAC,EAADA,EAAG/yB,WAAWvM,cAClC,OAAkB,OAAXu/B,QAAW,IAAXA,OAAW,EAAXA,EAAa3zB,SAAS,YAAuB,OAAX2zB,QAAW,IAAXA,OAAW,EAAXA,EAAa3zB,SAAS,cAEjEm0B,aAAcb,EAAQG,UAAUC,GAAKA,GAAKA,EAAE/yB,WAAWvM,cAAc4L,SAAS,eAC9EzQ,MAAO+jC,EAAQG,UAAUC,GAAKA,GAAKA,EAAE/yB,WAAWvM,cAAc4L,SAAS,UAGzE3D,QAAQC,IAAI,kCAAyBi3B,GAGrC,MAAMa,EAAW,IACK,IAAIliC,MAAOC,cAEjC,IAAK,IAAImD,EAAI,EAAGA,EAAI69B,EAAS/hC,OAAQkE,IAAK,CACxC,MAAMkK,EAAM2zB,EAAS79B,GACrB,IAAKkK,GAAOA,EAAI0c,MAAMmY,IAASA,GAAO,SAEtC,MAAMp3B,EAAWlC,SAASyE,EAAI+zB,EAAUK,YAAc,EAGtD,IAAI7zB,EAA2B,IAAb9C,EAClB,IAAyB,IAArBs2B,EAAUhkC,OAAgBiQ,EAAI+zB,EAAUhkC,OAAQ,CAClD,MAAM+kC,EAAY90B,EAAI+zB,EAAUhkC,OAAOoR,WAAWvM,cAAcxC,OAChEmO,EAA4B,UAAdu0B,GAAoC,OAAdA,GAAoC,QAAdA,GAAqC,MAAdA,GAAmC,SAAdA,CACxG,CAGA,MAAMC,EAAaC,IACjB,IAAKA,EAAW,OAAO,IAAItiC,MAAOC,cAAcuc,MAAM,KAAK,GAE3D,GAAyB,kBAAd8lB,EACT,IACE,OAAOjG,EAAAA,GAASkG,gBAAgBD,EAClC,CAAE,MAAOp1B,GAEP,OADA/C,QAAQoH,KAAK,2BAA4B+wB,EAAWp1B,IAC7C,IAAIlN,MAAOC,cAAcuc,MAAM,KAAK,EAC7C,CAGF,IACE,MAAMuF,EAAO,IAAI/hB,KAAKsiC,GACtB,OAAIzgB,MAAME,EAAKE,YACb9X,QAAQoH,KAAK,sBAAuB+wB,IAC7B,IAAItiC,MAAOC,cAAcuc,MAAM,KAAK,IAEtCuF,EAAK9hB,cAAcuc,MAAM,KAAK,EACvC,CAAE,MAAOtP,GAEP,OADA/C,QAAQoH,KAAK,sBAAuB+wB,EAAWp1B,IACxC,IAAIlN,MAAOC,cAAcuc,MAAM,KAAK,EAC7C,GAGIvZ,EAAYo/B,EAAU/0B,EAAI+zB,EAAUM,SACpCz+B,EAAU2K,EAAc5K,EAAYo/B,EAAU/0B,EAAI+zB,EAAUO,MAG5DY,EAAUl1B,EAAI+zB,EAAUC,SAAO,SAAA3+B,OAAaS,GAC5Cq/B,EAAiBjhB,EAAiBghB,GACxC,IAAKC,EAAehhB,MAAO,CACzBtX,QAAQ+C,MAAM,wBAADvK,OAAoBS,EAAI,EAAC,MAAAT,OAAK8/B,EAAev1B,QAC1D,QACF,CAEA,MAAMw1B,EAAqB/gB,EAAiB5W,GAC5C,IAAK23B,EAAmBjhB,MAAO,CAC7BtX,QAAQ+C,MAAM,wBAADvK,OAAoBS,EAAI,EAAC,MAAAT,OAAK+/B,EAAmBx1B,QAC9D,QACF,CAEA,MAAMy1B,EAAkB7gB,EAAa7e,GACrC,IAAK0/B,EAAgBlhB,MAAO,CAC1BtX,QAAQ+C,MAAM,wBAADvK,OAAoBS,EAAI,EAAC,MAAAT,OAAKggC,EAAgBz1B,QAC3D,QACF,CAEA,MAAM7O,EAAO,CACXX,GAAImC,OAAOC,aACXT,QAAQ,GAADsD,OAAKS,GACZ9D,KAAMmjC,EAAe/gB,UACrB3W,SAAU8C,EAAc,EAAInF,KAAKO,IAAI,EAAG8a,EAAsB9gB,EAAWC,EAASwgB,IAClFzgB,UAAW0/B,EAAgBzkC,MAC3BgF,QAASA,EACT0U,SAAUlP,KAAKO,IAAI,EAAGP,KAAKE,IAAI,IAAKC,SAASyE,EAAI+zB,EAAUQ,YAAc,IACzE32B,SAAUmW,EAAc/T,EAAI+zB,EAAUS,YAAc,UACpDz1B,WAAYgV,EAAc/T,EAAI+zB,EAAUU,WAAa,IACrD/c,KAAMtc,KAAKO,IAAI,EAAGxD,WAAW6H,EAAI+zB,EAAUW,SAAW,GACtD9hB,cAAexX,KAAKO,IAAI,EAAGxD,WAAW6H,EAAI+zB,EAAUnhB,iBAAmB,GACvEoE,aAAc,GACdC,WAAY,GACZ1W,YAAaA,EACboX,iBAAkBpX,EAAc,EAAI9C,EACpC3J,YAAa,GACbojB,UAAW,GACX3M,OAAQ,WAIV,GAAIvK,EAAI+zB,EAAUY,cAAe,CAC/B,MAAMW,EAAUt1B,EAAI+zB,EAAUY,cAAcxzB,WAC5CtE,QAAQC,IAAI,mDAADzH,OAA0CS,EAAC,OAAAT,OAAMigC,EAAO,MAGnE,MAAMC,EAAaD,EAAQpmB,MAAM,KAAKpe,IAAIm6B,GAAKA,EAAE74B,QAAQD,OAAO6qB,SAChEngB,QAAQC,IAAI,qDAADzH,OAA4CkgC,EAAW3pB,KAAK,MAAK,MAG5E7a,EAAKimB,aAAeue,EACpB14B,QAAQC,IAAI,oDAADzH,OAA2CtE,EAAKimB,aAAapL,KAAK,MAAK,KACpF,CAEAgpB,EAAS9zB,KAAK/P,EAChB,CAIA,GAFA8L,QAAQC,IAAI,kCAAyB83B,GAEb,IAApBA,EAAShjC,OAEX,YADAS,MAAM,2DAKRwK,QAAQC,IAAI,uEACZ83B,EAAS70B,QAAQhP,IACf,GAAIA,EAAKimB,cAAgBjmB,EAAKimB,aAAaplB,OAAS,EAAG,CACrD,MAAM4jC,EAAiBzkC,EAAKimB,aAAalmB,IAAI2kC,IAC3C,MAAM1Y,EAAW6X,EAAS1/B,KAAKW,GAAKA,EAAE9D,UAAY0jC,GAClD,OAAI1Y,GACFlgB,QAAQC,IAAI,0CAADzH,OAAsCogC,EAAW,eAAApgC,OAAS0nB,EAAS3sB,KACvE2sB,EAAS3sB,KAEhByM,QAAQoH,KAAK,mDAAD5O,OAA0CogC,IAC/C,QAERtjC,OAAO6qB,SAEVjsB,EAAKimB,aAAewe,EACpB34B,QAAQC,IAAI,uBAADzH,OAActE,EAAKiB,KAAI,wCAAAqD,OAAuCmgC,EAAe5pB,KAAK,MAAK,KACpG,IAIF/O,QAAQC,IAAI,oDACZ,MAAMyuB,EAAaG,GAA0BkJ,GAE7C,GAAIrJ,EAAW7wB,OAAO9I,OAAS,EAAG,CAChC,MAAM8jC,EAAY,sDAAArgC,OAAoDk2B,EAAW7wB,OAAOkR,KAAK,OAE7F,YADAvZ,MAAMqjC,EAER,CAEA,GAAInK,EAAWM,SAASj6B,OAAS,EAAG,CAClC,MAAM+jC,EAAc,6CAAAtgC,OAAsCk2B,EAAWM,SAASjgB,KAAK,MAAK,mDACxF,IAAKmF,OAAO6kB,QAAQD,GAClB,MAEJ,CAEA94B,QAAQC,IAAI,gEAGZD,QAAQC,IAAI,kEACZD,QAAQC,IAAI,oDAA4C,OAALuV,QAAK,IAALA,OAAK,EAALA,EAAOzgB,SAAU,GACpEiL,QAAQC,IAAI,+CAAmC83B,EAAShjC,QACxDiL,QAAQC,IAAI,0DAA8C83B,EAAS90B,MAAM,EAAG,IAC5EjD,QAAQC,IAAI,kEAAmDuf,GAG/D,MAAMwZ,EAAiB,6EAAAxgC,QACI,OAALgd,QAAK,IAALA,OAAK,EAALA,EAAOzgB,SAAU,EAAC,MAAI,kBAAAyD,OACxBu/B,EAAShjC,OAAM,QAFZ,wKAOvB,IAAKmf,OAAO6kB,QAAQC,GAElB,YADAh5B,QAAQC,IAAI,0DAKd,MAAMg5B,EAAiB9gB,EAAmB4f,GAG1C,GAFA/3B,QAAQC,IAAI,8DAAkDg5B,EAAehlC,IAAI+E,IAAC,CAAO7D,KAAM6D,EAAE7D,KAAMD,QAAS8D,EAAE9D,YAEvF,oBAAhBsqB,EACTA,EAAYyZ,GACZj5B,QAAQC,IAAI,+FACP,CAEL,GADAD,QAAQ+C,MAAM,4FACU,oBAAbwc,EAMT,OAFAvf,QAAQ+C,MAAM,gFACdvN,MAAM,8GAJN+pB,EAAS0Z,GACTj5B,QAAQC,IAAI,wFAMhB,CAGA,MAAMi5B,EAAkB,IAAI9kB,YAAY,aAAc,CACpDC,OAAQ,CAAErf,KAAM,oBAAqBmkC,UAAWpB,EAAShjC,OAAQuf,WAAW,IAAIze,MAAOC,iBAEzFoe,OAAOC,cAAc+kB,GAGrB,MAAMjc,EAAa8a,EAAS9jC,IAAI+E,GAAK,IAAInD,KAAKmD,EAAEF,YAC1CokB,EAAW6a,EAAS9jC,IAAI+E,GAAK,IAAInD,KAAKmD,EAAED,UACxCgoB,EAAe,IAAIlrB,KAAK0I,KAAKE,OAAOwe,IACpCjB,EAAa,IAAInmB,KAAK0I,KAAKO,OAAOoe,IAGpCuC,GACFA,EAAqB,CACnBjK,MAAOuiB,EACPhX,aAAcA,EAAajrB,cAAcuc,MAAM,KAAK,GACpD2J,WAAYA,EAAWlmB,cAAcuc,MAAM,KAAK,GAChD2D,WAAY+hB,EAAShjC,OACrBisB,eAAgB+W,EAASziC,OAAO0D,GAAkB,cAAbA,EAAE0U,QAAwB3Y,OAC/DmpB,UAAW6Z,EAAS/9B,OAAO,CAACC,EAAKjB,IAAMiB,GAAOjB,EAAE6hB,MAAQ,GAAI,KAIhErlB,MAAM,+DAADgD,OAAiDu/B,EAAShjC,OAAM,6EAAAyD,OAAkEuoB,EAAa/e,mBAAmB,MAAK,OAAAxJ,OAAMwjB,EAAWha,mBAAmB,MAAK,mGAEvN,CAAE,MAAOe,GACP/C,QAAQ+C,MAAM,qCAAiCA,GAC/CvN,MAAM,8EACR,GAkNI4jC,GAAeA,CAAC3d,EAAQ3nB,EAAOulC,KAEnC,GAAIhV,GACFrkB,QAAQoH,KAAK,iEAMf,GAHA2a,EAAe,CAAEtG,SAAQ3nB,UAGX,cAAVA,GAAmC,YAAVA,EAC3B,GAAIulC,EAEF,GAAIA,EAAah1B,MAAM,uBACrB4d,EAAgBoX,OACX,CAEL,MAAMC,EAAYD,EAAahnB,MAAM,KACrC,GAAyB,IAArBinB,EAAUvkC,OAAc,CAC1B,MAAMwkC,EAAMD,EAAU,GAAGE,SAAS,EAAG,KAC/BC,EAAQH,EAAU,GAAGE,SAAS,EAAG,KACjCE,EAAOJ,EAAU,GACvBrX,EAAgB,GAADzpB,OAAIkhC,EAAI,KAAAlhC,OAAIihC,EAAK,KAAAjhC,OAAI+gC,GACtC,MACEtX,EAAgBoX,EAEpB,MAEApX,EAAgB,SAGlBA,EAAgBoX,IAMdM,GAAwBA,KAC5BjW,IAAqB,IA8DjBkW,GAAoB5jC,IACxBguB,GAAiBhuB,GACjBkuB,IAAmB,KAyErBtwB,EAAAA,EAAAA,WAAU,KACoBse,WAC1B,GAAIyD,GAA0B,OAAXF,QAAW,IAAXA,GAAAA,EAAaliB,GAC9B,IAAK,IAADsmC,EACF75B,QAAQC,IAAI,qDAA4C,CACtD+N,UAAWyH,EAAYliB,GACvB8V,eAAgBoM,EAAYpM,eAC5BywB,0BAA2BrkB,EAAYpM,eACvC0wB,oBAAqBtkB,EAAYpM,eACjCC,YAAwC,QAA7BuwB,EAAEnkB,EAAAA,QAAgBpM,mBAAW,IAAAuwB,OAAA,EAA3BA,EAA6BG,cAGtCC,EAAmB1wB,WACvBmM,EAAAA,QAAgBtM,SAChBqM,EAAYpM,eACZqM,EAAAA,QAAgBpM,aAElBtJ,QAAQC,IAAI,0DAAiDwV,EAAYliB,GAC3E,CAAE,MAAOwP,GACP/C,QAAQ+C,MAAM,6CAAyCA,EACzD,MAEA/C,QAAQC,IAAI,uDAA8C,CACxD0V,cACAukB,eAA2B,OAAXzkB,QAAW,IAAXA,IAAAA,EAAaliB,IAC7BkiB,YAAaA,KAKnB0kB,IACC,CAACxkB,EAAwB,OAAXF,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GAAe,OAAXkiB,QAAW,IAAXA,OAAW,EAAXA,EAAapM,iBAG/C,MA+hBM+wB,GAAWA,KACf,IAAKtY,EAAa,OAElB,MAAM,OAAErG,EAAM,MAAE3nB,GAAUguB,EACpBgN,EAAW9M,EASjB,GAPAhiB,QAAQC,IAAI,qCAA4B,CACtCwb,SACA3nB,QACAg7B,WACAuL,YAAa7kB,EAAQA,EAAMzgB,OAAS,cAGxB,iBAAVjB,EAEF,YADAwmC,KAIF/a,EAASvrB,IACPgM,QAAQC,IAAI,sDAA6C,CACvDs6B,WAAYvmC,EAAOA,EAAKe,OAAS,YACjCs0B,UAAWr1B,EAAOA,EAAKC,IAAI+E,IAAC,CAAOzF,GAAIyF,EAAEzF,GAAI4B,KAAM6D,EAAE7D,QAAW,cAG3DnB,EAAKC,IAAIC,IACd,GAAIA,EAAKX,KAAOkoB,EAAQ,CAEtB,MAAM+Q,EAAc,CAClBj5B,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU1M,EAAK0M,SACf9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9E,cAAe7hB,EAAK6hB,eAAiB,EACrChV,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,KAGtC,OAAQtmB,GACN,IAAK,OACH04B,EAAYr3B,KAAO25B,EACnB,MACF,IAAK,WACH,MAAMluB,EAAWlC,SAASowB,IAAa,EAGvC,GAFAtC,EAAY5rB,SAAWA,EAEnB4rB,EAAY9oB,YACd8oB,EAAYzzB,QAAUyzB,EAAY1zB,eAGlC,GAAIygB,EAAiB,CAEnB,MAAMzgB,EAAY,IAAIjD,KAAK22B,EAAY1zB,WACvCA,EAAUwP,QAAQxP,EAAUyP,UAAY3H,EAAW,GACnD4rB,EAAYzzB,QAAUmf,EAAMpf,EAC9B,MAEE0zB,EAAYzzB,QAAU6f,EAAQ4T,EAAY1zB,UAAW8H,EAAU2Y,GAGnE,MACF,IAAK,YAGH,GAFAiT,EAAY1zB,UAAYg2B,EAEpBtC,EAAY9oB,YACd8oB,EAAYzzB,QAAU+1B,OAGtB,GAAIvV,EAAiB,CAEnB,MAAMzgB,EAAY,IAAIjD,KAAKi5B,GAC3Bh2B,EAAUwP,QAAQxP,EAAUyP,UAAYikB,EAAY5rB,SAAW,GAC/D4rB,EAAYzzB,QAAUmf,EAAMpf,EAC9B,MAEE0zB,EAAYzzB,QAAU6f,EAAQkW,EAAUtC,EAAY5rB,SAAU2Y,GAGlE,MACF,IAAK,UACHiT,EAAYzzB,QAAU+1B,EAGtB,MACF,IAAK,WACHtC,EAAY/e,SAAWlP,KAAKO,IAAI,EAAGP,KAAKE,IAAI,IAAKC,SAASowB,IAAa,IACvE,MACF,IAAK,WACHtC,EAAYzrB,SAAW+tB,EACvB,MACF,IAAK,aACHtC,EAAYtqB,WAAa4sB,EACzB,MACF,IAAK,OACHtC,EAAY3R,KAAOvf,WAAWwzB,IAAa,EAC3C,MACF,IAAK,gBACHtC,EAAYzW,cAAgBza,WAAWwzB,IAAa,EAIxD,OAAOtC,CACT,CACA,OAAOt4B,MAKX,MAAMglC,EAAkB,IAAI9kB,YAAY,aAAc,CACpDC,OAAQ,CACNrf,KAAM,cACNymB,SACA3nB,QACAg7B,WACAxa,WAAW,IAAIze,MAAOC,iBAM1B,GAHAoe,OAAOC,cAAc+kB,GAGjBvjB,GAA0B,OAAXF,QAAW,IAAXA,GAAAA,EAAaliB,GAAI,CAGlC,GADoBiiB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOkoB,GAC5B,CAEf,MAAM+e,EAAa,CACjBvqB,YAAY,IAAIpa,MAAOC,eAIzB,OAAQhC,GACN,IAAK,OACH0mC,EAAWrlC,KAAO25B,EAClB,MACF,IAAK,WACH0L,EAAW55B,SAAWlC,SAASowB,IAAa,EAE5C,MAAM56B,EAAOshB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOkoB,GACtC,GAAIvnB,EACF,GAAIA,EAAKwP,YACP82B,EAAWC,SAAWvmC,EAAK4E,cACtB,CACL,MAAM8H,EAAWlC,SAASowB,IAAa,EACvC,GAAIvV,EAAiB,CACnB,MAAMzgB,EAAY,IAAIjD,KAAK3B,EAAK4E,WAChCA,EAAUwP,QAAQxP,EAAUyP,UAAY3H,EAAW,GACnD45B,EAAWC,SAAWviB,EAAMpf,EAC9B,MACE0hC,EAAWC,SAAW7hB,EAAQ1kB,EAAK4E,UAAW8H,EAAU2Y,EAE5D,CAEF,MACF,IAAK,YACHihB,EAAWE,WAAa5L,EAExB,MAAM6L,EAAenlB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOkoB,GAC9C,GAAIkf,EACF,GAAIA,EAAaj3B,YACf82B,EAAWC,SAAW3L,OAEtB,GAAIvV,EAAiB,CACnB,MAAMzgB,EAAY,IAAIjD,KAAKi5B,GAC3Bh2B,EAAUwP,QAAQxP,EAAUyP,UAAYoyB,EAAa/5B,SAAW,GAChE45B,EAAWC,SAAWviB,EAAMpf,EAC9B,MACE0hC,EAAWC,SAAW7hB,EAAQkW,EAAU6L,EAAa/5B,SAAU2Y,GAIrE,MACF,IAAK,UACHihB,EAAWC,SAAW3L,EACtB,MACF,IAAK,WACH0L,EAAW/sB,SAAWlP,KAAKO,IAAI,EAAGP,KAAKE,IAAI,IAAKC,SAASowB,IAAa,IACtE,MACF,IAAK,WACH0L,EAAWz5B,SAAW+tB,EACtB,MACF,IAAK,aACH0L,EAAWI,YAAc9L,EACzB,MACF,IAAK,OACH0L,EAAW3f,KAAOvf,WAAWwzB,IAAa,EAC1C,MACF,IAAK,gBACH0L,EAAW/jB,eAAiBnb,WAAWwzB,IAAa,EAKxDpZ,EAAAA,QAAgBtM,SACb+B,KAAK,SACL2E,OAAO0qB,GACPjvB,GAAG,KAAMkQ,GACTlQ,GAAG,aAAckK,EAAYliB,IAC7BsnC,KAAKC,IAAgB,IAAf,MAAE/3B,GAAO+3B,EACV/3B,GACF/C,QAAQ+C,MAAM,+CAA2CA,GACzD/C,QAAQ+C,MAAM,SAAUjP,EAAO,SAAUg7B,IAEzC9uB,QAAQC,IAAI,iBAADzH,OAAa1E,EAAK,6CAGhCinC,MAAMh4B,IACL/C,QAAQ+C,MAAM,oDAAgDA,IAEpE,CACF,CAEA/C,QAAQC,IAAI,sCACZ8hB,EAAe,MACfE,EAAgB,KAGZ+Y,GAAaA,KACjBjZ,EAAe,MACfE,EAAgB,KAGZgZ,GAAiBvmC,IACjBotB,IACY,UAAVptB,EAAEmD,KACJnD,EAAEwmC,iBACFd,MACmB,WAAV1lC,EAAEmD,MACXnD,EAAEwmC,iBACFF,QAuDAV,GAAuBA,KAC3B,IAAKxY,GAAqC,iBAAtBA,EAAYhuB,MAA0B,OAE1D,MAAM,OAAE2nB,GAAWqG,EACnB,IAEE,MAAMqZ,EAAqBnZ,EACxB3P,MAAM,KACNpe,IAAIwjB,GAAO/Y,SAAS+Y,EAAIliB,SACxBD,OAAOmiB,IAAQC,MAAMD,IAAQA,EAAM,GAEtCzX,QAAQC,IAAI,kDAADzH,OAAyCijB,EAAM,0BAAAjjB,OAAsB2iC,EAAmBpsB,KAAK,MAAK,MAG7G,MAAM4pB,EAAiBwC,EAAmBlnC,IAAIiB,IAC5C,MAAMgrB,EAAW1K,EAAMnd,KAAKW,GAAK0F,SAAS1F,EAAE9D,WAAaA,GACzD,OAAIgrB,GACFlgB,QAAQC,IAAI,0CAADzH,OAAsCtD,EAAO,eAAAsD,OAAS0nB,EAAS3sB,KACnE2sB,EAAS3sB,KAEhByM,QAAQoH,KAAK,mDAAD5O,OAA0CtD,IAC/C,QAERI,OAAO/B,GAAMA,GA4ChB,GA1CAgsB,EAASvrB,GAAQA,EAAKC,IAAIC,IACxB,GAAIA,EAAKX,KAAOkoB,EAAQ,CAEtB,MAAM+Q,EAAc,CAClBj5B,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU1M,EAAK0M,SACf9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,KAQtC,OANAoS,EAAYrS,aAAewe,EAC3BnM,EAAYpS,WAAa,GA9zDRghB,EAAC3f,EAAQtB,KAChCoF,EAASvrB,GACAA,EAAKC,IAAIC,IAEd,GAAIA,EAAKX,KAAOkoB,EACd,MAAO,CACLloB,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU1M,EAAK0M,SACf9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKA,GAAgB,IACnCU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAKhB,IAAIoS,EAAc,CAChBj5B,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU1M,EAAK0M,SACf9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,KActC,OATID,EAAaxW,SAASzP,EAAKX,IACxBi5B,EAAYpS,WAAWzW,SAAS8X,KACnC+Q,EAAYpS,WAAaoS,EAAYpS,WAAWnX,QAAQzK,OAAO,CAACijB,KAIlE+Q,EAAYpS,WAAaoS,EAAYpS,WAAW9kB,OAAO/B,GAAMA,IAAOkoB,GAG/D+Q,MAuvDL4O,CAAiB3f,EAAQkd,GAElBnM,CACT,CACA,OAAOt4B,KAILyhB,GAA0B,OAAXF,QAAW,IAAXA,GAAAA,EAAaliB,GAAI,CAClC,MAAMinC,EAAa,CACjBrgB,aAAcwe,EACd1oB,YAAY,IAAIpa,MAAOC,eAGzB4f,EAAAA,QAAgBtM,SACb+B,KAAK,SACL2E,OAAO0qB,GACPjvB,GAAG,KAAMkQ,GACTlQ,GAAG,aAAckK,EAAYliB,IAC7BsnC,KAAKQ,IAAgB,IAAf,MAAEt4B,GAAOs4B,EACVt4B,EACF/C,QAAQ+C,MAAM,sDAAkDA,GAEhE/C,QAAQC,IAAI,+DAGf86B,MAAMh4B,IACL/C,QAAQ+C,MAAM,qDAAiDA,IAErE,CAEAgf,EAAe,MACfE,EAAgB,GAClB,CAAE,MAAOlf,GACP/C,QAAQ+C,MAAM,iCAAkCA,GAChDgf,EAAe,MACfE,EAAgB,GAClB,GA6YIqZ,IAA2BzlB,EAAAA,EAAAA,SAAQ,KACvC,MAAM0lB,EAAgBrjB,EAAMsb,GAAaha,OAInCgiB,EAAgBD,EAatB,OAVAv7B,QAAQC,IAAI,8DAAqD,CAC/Dw7B,qBAAsBF,EACtBhiB,gBAAiBA,EACjBiiB,cAAeA,EACfE,UAAWH,IAAkBC,EAC7BG,UAAWJ,IAAkBC,EAC3Bj9B,KAAK8B,OAAO,IAAIxK,KAAK2lC,GAAiB,IAAI3lC,KAAK0lC,IAAc,OAA6B,EAC5FK,KAAM,gGAGDJ,GACN,CAAChI,GAAaha,MAAOD,IAGlBsiB,IAAchmB,EAAAA,EAAAA,SAAQ,KAE1B,MAAMsf,EAAWjd,EAAM,IAAIriB,MAGrBuK,EAAOgZ,EAAgB+b,EAAUmG,GAA0B/hB,GAGjE,OAAOhb,KAAKE,IAAIF,KAAKO,IAAI,EAAGsB,EAAO60B,IAAWC,KAC7C,CAACoG,GAA0BrG,GAAUC,GAAc3b,IAGhDuiB,GAAoBA,KAExB,MAAM/G,EAASuG,GAUf,OAPAt7B,QAAQC,IAAI,sCAA6B,CACvC80B,OAAQA,EACRgH,kBAAmB7jB,EAAMsb,GAAaha,OACtCD,gBAAiBA,EACjB0b,SAAUA,KAGLlN,GAAa9zB,IAAKC,IAGvB,MAAM8nC,EAAiB9nC,EAAK4E,UACtBmjC,EAAe/nC,EAAK6E,QAIpBmjC,EAAW9iB,EAAgB4iB,EAAgBjH,EAAQxb,GAGnD4iB,EAAiB/iB,EAAgB6iB,EAAclH,EAAQxb,GACvD6iB,EAAU79B,KAAKO,IAAI,EAAGq9B,EAAiBD,EAAW,GAGxD,GAAIhoC,EAAKiB,KAAKwO,SAAS,kBAAiBzP,EAAKiB,KAAKwO,SAAS,kBAAiBzP,EAAKiB,KAAKwO,SAAS,aAAYzP,EAAKiB,KAAKwO,SAAS,eAAa,CACzI3D,QAAQC,IAAI,0EACZD,QAAQC,IAAI,eAAgB/L,EAAKiB,MACjC6K,QAAQC,IAAI,oDACZD,QAAQC,IAAI,uBAAwB+7B,GACpCh8B,QAAQC,IAAI,qBAAsBg8B,GAClCj8B,QAAQC,IAAI,kEACZD,QAAQC,IAAI,mBAAoB/L,EAAKuU,YACrCzI,QAAQC,IAAI,oBAAqB/L,EAAKwU,aACtC1I,QAAQC,IAAI,qGACZD,QAAQC,IAAI,qBAAsB80B,GAClC/0B,QAAQC,IAAI,wBAAyBsZ,GACrCvZ,QAAQC,IAAI,6CAA8Ci8B,GAC1Dl8B,QAAQC,IAAI,mDAAoDk8B,GAChEn8B,QAAQC,IAAI,yCAA0Cm8B,GACtDp8B,QAAQC,IAAI,yBAA0Bi8B,EAAWjH,IACjDj1B,QAAQC,IAAI,0BAA2Bm8B,EAAUnH,IAG7C/gC,EAAKiB,KAAKwO,SAAS,mBACrB3D,QAAQC,IAAI,6CACZD,QAAQC,IAAI,2BAA4B+7B,GACxCh8B,QAAQC,IAAI,kCAAmC80B,GAC/C/0B,QAAQC,IAAI,wBAAyBsZ,GACrCvZ,QAAQC,IAAI,6CAA8Ci8B,GAC1Dl8B,QAAQC,IAAI,yBAA0Bi8B,EAAWjH,IACjDj1B,QAAQC,IAAI,6BAAwB+7B,IAAmBjH,EAAS,0BAAyB,OAI3F,MAAMsH,EAAoB,IAAIxmC,KAAKmmC,GAAgBh6B,mBAAmB,SAChEs6B,EAAkB,IAAIzmC,KAAKomC,GAAcj6B,mBAAmB,SAClEhC,QAAQC,IAAI,8CACZD,QAAQC,IAAI,eAAgBo8B,GAC5Br8B,QAAQC,IAAI,YAAaq8B,GACzBt8B,QAAQC,IAAI,mDAAiD,4CAC7DD,QAAQC,IAAI,oCAAkC,4CAC9CD,QAAQC,IAAI,2CAAsC,+CAG9C+7B,IAAmB9nC,EAAKuU,YAAcwzB,IAAiB/nC,EAAKwU,cAC9D1I,QAAQC,IAAI,iDACZD,QAAQC,IAAI,qBAAsB+7B,EAAgB,iBAAkB9nC,EAAKuU,YACzEzI,QAAQC,IAAI,kBAAmBg8B,EAAc,cAAe/nC,EAAKwU,aACjE1I,QAAQC,IAAI,uDAEhB,CAGA,MAAO,CACL1M,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU1M,EAAK0M,SACf9H,UAAWkjC,EACXjjC,QAASkjC,EACTxuB,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,IACpCmiB,OAAQL,EAAWjH,GACnBuH,QAAStoC,EAAKwP,YAAc,GAAKnF,KAAKO,IAAI,EAAGs9B,EAAUnH,QAoEvDtJ,KA7DuB9V,EAAAA,EAAAA,SAAQ,KACnC,GAA4B,IAAxBkS,GAAahzB,OAAc,MAAO,GAEtC,MAAM0nC,EAAQ,GAkBd,OAhBA1U,GAAa7kB,QAAQhP,IAEnBA,EAAKimB,aAAajX,QAAQoX,IACxB,MAAM4F,EAAW6H,GAAa1vB,KAAKW,GAAKA,EAAEzF,KAAO+mB,GAC7C4F,GACFuc,EAAMx4B,KAAK,CACT1Q,GAAG,GAADiF,OAAK8hB,EAAM,KAAA9hB,OAAItE,EAAKX,IACtBmpC,OAAQpiB,EACR3lB,OAAQT,EAAKX,GACbyB,KAAM,cACNklB,WAAYhmB,EAAKgmB,YAAcgG,EAAShG,iBAMzCuiB,GACN,CAAC1U,KAuC0B4D,KAC5B,IAAK1E,GAAclT,SAAmC,IAAxB6W,GAAa71B,OAAc,OAGzD,IAAIi2B,EAAOC,IAAUC,EAAOD,IAAUE,GAAQF,IAAUG,GAAQH,IAEhEL,GAAa1nB,QAAQmoB,IACnBL,EAAOzsB,KAAKE,IAAIusB,EAAMK,EAAKnF,GAC3BgF,EAAO3sB,KAAKE,IAAIysB,EAAMG,EAAKlF,GAC3BgF,EAAO5sB,KAAKO,IAAIqsB,EAAME,EAAKnF,EAAImF,EAAKxY,OACpCuY,EAAO7sB,KAAKO,IAAIssB,EAAMC,EAAKlF,EAAIkF,EAAKZ,UAGtC,MAAMc,EAAeJ,EAAOH,EACtBQ,EAAgBJ,EAAOF,EAE7B,GAAqB,IAAjBK,GAAwC,IAAlBC,EAAqB,OAG/C,MAGMmR,EAHgB,KAGSpR,EACzBqR,EAHiB,IAGSpR,EAC1BqR,EAAct+B,KAAKE,IAAIk+B,EAAQC,EAAQ,GAEvCE,EAAUv+B,KAAKO,IAAI,GAAK+9B,GAC9B9W,GAAe+W,GAQf7W,GAAc,CAAEC,GALC8E,EAAOG,GAAQ,EAXV,MAaqB,EAAI2R,GAGnB3W,GAJX+E,EAAOE,GAAQ,EAXT,KAaqB,EAAI0R,QAsI3BjnB,EAAAA,EAAAA,SAAQ,KAC7B,MAAMknB,EAAahV,GAAahzB,OAC1BioC,EAAajV,GAAa/tB,OAAO,CAACC,EAAKjB,IAAMiB,EAAMjB,EAAEmhB,aAAaplB,OAAQ,GAC1EynB,EAAqBuL,GAAazyB,OAAO0D,GAAKA,EAAEkhB,YAAYnlB,OAGlEiL,QAAQC,IAAI,yCAA6B,CACvC88B,aACAC,aACAxgB,qBACAygB,cAAelV,GAAazyB,OAAO0D,GAAKA,EAAEmhB,aAAaplB,OAAS,GAAGA,OACnEmoC,YAAanV,GAAa9zB,IAAI+E,IAAC,CAC7BzF,GAAIyF,EAAEzF,GACN4B,KAAM6D,EAAE7D,KACRglB,aAAcnhB,EAAEmhB,aAChBwV,MAAO32B,EAAEmhB,aAAaplB,YAK1B,MAAMk1B,EAAS,IAAIliB,IACbT,EAAU,IAAIC,IAEd4iB,EAAiB,SAAC1O,GAAoD,IAA5C0hB,EAAYpxB,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,EAAGqe,EAAQre,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,IAAIxE,IAC/D,GAAID,EAAQI,IAAI+T,GAAS,OAAOwO,EAAO7hB,IAAIqT,IAAW,EAGtD,GAAI2O,EAAS1iB,IAAI+T,GAIf,OAHAzb,QAAQoH,KAAK,yDAAuDqU,GACpEwO,EAAOjiB,IAAIyT,EAAQ0hB,GACnB71B,EAAQK,IAAI8T,GACL0hB,EAGT/S,EAASziB,IAAI8T,GACbnU,EAAQK,IAAI8T,GAEZ,MAAMvnB,EAAO6zB,GAAa1vB,KAAKW,GAAKA,EAAEzF,KAAOkoB,GAC7C,IAAKvnB,EAEH,OADAk2B,EAASviB,OAAO4T,GACT0hB,EAGT,IAAIC,EAAeD,EACnB,IAAK,MAAM7iB,KAAUpmB,EAAKimB,aAAc,CACtC,MAAMkjB,EAAYlT,EAAe7P,EAAQ6iB,EAAe,EAAG/S,GAC3DgT,EAAe7+B,KAAKO,IAAIs+B,EAAcC,EACxC,CAIA,OAFApT,EAAOjiB,IAAIyT,EAAQ2hB,GACnBhT,EAASviB,OAAO4T,GACT2hB,CACT,EAEA,IAAK,MAAMlpC,KAAQ6zB,GACjBoC,EAAej2B,EAAKX,IAKtB,MAAO,CACLwpC,aACAC,aACAxgB,qBACA8gB,SANe/+B,KAAKO,OAAOmrB,EAAO5O,SAAU,KAQ7C,CAAC0M,KA6EJ,OACExzB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EAExBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,0IAAyIC,SAAA,EAEtJF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,iGACfD,EAAAA,EAAAA,KAAA,OAAKC,UAAU,qGAEfE,EAAAA,EAAAA,MAAA,OAAKF,UAAU,gBAAeC,SAAA,EAE5BC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mFAAkFC,SAAA,EAC/FC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oBAAmBC,SAAA,EAChCF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,mCAAkCC,UAC/CF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,WAAUC,SAAC,oBAE7BC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,wCAAuCC,SAAC,6BACtDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,wBAAuBC,SAAC,2EAKzCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,uBAAsBC,SAAA,EACnCC,EAAAA,EAAAA,MAAA,UACEC,QAASk8B,GACTr8B,UAAU,sLAAqLC,SAAA,EAE/LF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,iBAGRC,EAAAA,EAAAA,MAAA,UACEC,QAASA,IAn6JE+oC,MACvB,MAAM9gB,EAAgBsL,GAAazyB,OAAO0D,GAAKA,EAAEkhB,YAEjD,GAA6B,IAAzBuC,EAAc1nB,OAEhB,YADAS,MAAM,4CAKR,MAiCMgoC,EAjCwB/gB,EAC3BxoB,IAAIC,IAAI,CACPX,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU1M,EAAK0M,SACf9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,IACpCqjB,qBAAsBl/B,KAAKE,IAAoB,GAAhBvK,EAAK0M,SAAgB,GACpD88B,gBAA6B,GAAZxpC,EAAK2mB,QAEvBjS,KAAK,CAAC9H,EAAG+H,IAAMA,EAAE40B,qBAAuB38B,EAAE28B,sBAI1Cx6B,MAAM,EAAG,GACThP,IAAIC,GAAI,GAAAsE,OAAOtE,EAAKiB,KAAI,OAAAqD,OAAMtE,EAAKupC,qBAAoB,eAAAjlC,OAAWtE,EAAKwpC,gBAAgB1+B,QAAQ,GAAE,aACjG+P,KAAK,MAEF4uB,EAAiBC,OAAO,2FAADplC,OACoDglC,EAAkB,wCACjG,KAGF,GAAIG,IAAmBjmB,MAAMimB,GAAiB,CAC5C,MAAME,EAAoBn/B,SAASi/B,GACnC,IAAIG,EAAmB,EACnB5f,EAAY,EAGhB,MAAM9C,EAAe2M,GAAa9zB,IAAIC,IACpC,GAAIA,EAAKgmB,YAAc4jB,EAAmBD,EAAmB,CAC3D,MAAME,EAAcx/B,KAAKE,IACvBvK,EAAKupC,qBACLI,EAAoBC,GAGtB,GAAIC,EAAc,EAIhB,OAHAD,GAAoBC,EACpB7f,GAAa6f,EAAc7pC,EAAKwpC,gBAEzB,CACLnqC,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAUrC,KAAKO,IAAI,EAAG5K,EAAK0M,SAAWm9B,GACtCjlC,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,IACpC4jB,gBAAiB9pC,EAAK8pC,gBAAkB,GAAKD,EAC7CL,iBAAkBxpC,EAAKwpC,iBAAmB,GAAMK,EAAc7pC,EAAKwpC,gBAGzE,CACA,OAAOxpC,IAGL4pC,EAAmB,GACrBve,EAASnE,GACT5lB,MAAM,gCAADgD,OAA4BslC,EAAgB,6CAAAtlC,OAA+B0lB,EAAUlf,QAAQ,MAElGxJ,MAAM,yEAEV,GAszJ2B+nC,GACflpC,UAAU,sLACV0I,MAAM,uCAAsCzI,SAAA,EAE5CF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,wBAQZC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6CAA4CC,SAAA,EAGzDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6FAA4FC,SAAA,EACzGC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mCAAkCC,SAAA,EAC/CF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,UAASC,SAAC,kBAC1BF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,oCAAmCC,SAAC,eAEtDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,kCAAiCC,SAC7CyzB,GAAahzB,OAAS,EACnB,MAEA,MAAMkpC,EAAqBlW,GAAa9zB,IAAI+E,GAAK,IAAInD,KAAKmD,EAAEF,YAE5D,OADqB,IAAIjD,KAAK0I,KAAKE,OAAOw/B,IACtBj8B,mBAAmB,KACxC,EALC,GAMW,OAAXyT,QAAW,IAAXA,GAAAA,EAAa3c,UAAY,IAAIjD,KAAK4f,EAAY3c,WAAWkJ,mBAAmB,MAAQ,YAK5FzN,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6FAA4FC,SAAA,EACzGC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mCAAkCC,SAAA,EAC/CF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,UAASC,SAAC,kBAC1BF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,oCAAmCC,SAAC,YAEtDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,kCAAiCC,SAC7C,MACC,GAAIyzB,GAAahzB,OAAS,EAAG,CAE3B,MAAMmpC,EAAmBnW,GACtBzyB,OAAO0D,GAAKA,EAAED,SAAyB,OAAdC,EAAED,cAAkCkN,IAAdjN,EAAED,SACjD9E,IAAI+E,IACH,MAAO0gC,EAAMD,EAAOF,GAAOvgC,EAAED,QAAQsZ,MAAM,KAC3C,OAAO,IAAIxc,KAAK6I,SAASg7B,GAAOh7B,SAAS+6B,GAAS,EAAG/6B,SAAS66B,MAE/DjkC,OAAOsiB,IAASF,MAAME,EAAKE,YAExBqmB,EAAa,IAAItoC,KAAK0I,KAAKO,OAAOo/B,IAGlCxE,EAAOyE,EAAWnmB,cAClByhB,EAAQnhB,OAAO6lB,EAAWC,WAAa,GAAG5E,SAAS,EAAG,KACtDD,EAAMjhB,OAAO6lB,EAAW51B,WAAWixB,SAAS,EAAG,KAC/C6E,EAAa,GAAA7lC,OAAM+gC,EAAG,KAAA/gC,OAAIihC,EAAK,KAAAjhC,OAAIkhC,GAUzC,OARA15B,QAAQC,IAAI,6EAAoE,CAC9E+V,WAAY+R,GAAahzB,OACzBmpC,iBAAkBA,EAAiBjqC,IAAIgkB,GAAKA,IAAMP,MAAMO,EAAEH,WAAaG,EAAEniB,cAAcuc,MAAM,KAAK,GAAK,OACvG8rB,WAAYA,IAAezmB,MAAMymB,EAAWrmB,WAAaqmB,EAAWroC,cAAcuc,MAAM,KAAK,GAAK,MAClGqnB,OAAMD,QAAOF,MACb8E,cAAeA,IAGVA,CACT,CACA,OAAkB,OAAX5oB,QAAW,IAAXA,GAAAA,EAAa1c,QAAU,IAAIlD,KAAK4f,EAAY1c,SAASiJ,mBAAmB,MAAQ,KACxF,EA9BA,SAkCLzN,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6FAA4FC,SAAA,EACzGC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mCAAkCC,SAAA,EAC/CF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,UAASC,SAAC,kBAC1BF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,oCAAmCC,SAAC,oBAEtDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kCAAiCC,SAAA,CAAC,IAC7CyzB,GAAa/tB,OAAO,CAACC,EAAK/F,IAAS+F,GAAO/F,EAAK2mB,MAAQ,GAAI,GAAGrf,wBAIpEjH,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4FAA2FC,SAAA,EACxGC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mCAAkCC,SAAA,EAC/CF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,UAASC,SAAC,kBAC1BF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,mCAAkCC,SAAC,wBAErDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,mCAAkCC,UAAW,OAAT6yB,SAAS,IAATA,QAAS,EAATA,GAAW3K,qBAAsB,KACpFpoB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,uBAAsBC,SAAC,gBAGxCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,4FAA2FC,SAAA,EACxGC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mCAAkCC,SAAA,EAC/CF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,UAASC,SAAC,kBAC1BF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,mCAAkCC,SAAC,2BAErDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,mCAAkCC,UAAW,OAAT6yB,SAAS,IAATA,IAAuB,QAAdlI,EAATkI,GAAWlmB,oBAAY,IAAAge,OAAd,EAATA,EAAyBlqB,SAAU,KACtFX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,uBAAsBC,SAAC,kBAK1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,uEAAsEC,UACnFC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,+DAA8DC,SAAA,EAC3EC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,2BAA0BC,SAAA,EACvCC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,6FAA4FC,SAAA,EACxGF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,eAAcC,SAAC,iBAAS,0BAG1CF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,wBAAuBC,SAAC,uEAMvCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,qDAAoDC,SAAA,EACjEC,EAAAA,EAAAA,MAAA,UACEC,QAASA,KAAO6vB,IAAkBxC,EAAY,SAC9ChnB,SAAUwpB,GACVhwB,UAAS,oGAAAmE,OAAsG6rB,GAC3G,sEACa,UAAbzC,EACE,qDACA,kHAEN7kB,MAAOsnB,GAAiB,gDAAkD,cAAc/vB,SAAA,EAExFF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,cAGRC,EAAAA,EAAAA,MAAA,UACEC,QAASA,IAAMqtB,EAAY,SAC3BxtB,UAAS,oGAAAmE,OAAmH,UAAbopB,EAC3G,qDACA,kHACCttB,SAAA,EAELF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,cAIRC,EAAAA,EAAAA,MAAA,UACEC,QAASA,KAAO6vB,IAAkBxC,EAAY,WAC9ChnB,SAAUwpB,GACVhwB,UAAS,oGAAAmE,OAAsG6rB,GAC3G,sEACa,YAAbzC,EACE,qDACA,kHAEN7kB,MAAOsnB,GAAiB,uDAAyD,oBAAoB/vB,SAAA,EAErGF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kCAOdC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,CACvBivB,KACCnvB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,iDAAgDC,UAC7DC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oBAAmBC,SAAA,EAChCF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,oBAAmBC,SAAC,kBACpCC,EAAAA,EAAAA,MAAA,QAAMF,UAAU,uBAAsBC,SAAA,CAAC,cAAYivB,WAKxDiF,GAAiBQ,UAAUj0B,OAAS,IACnCX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,uDAAsDC,UACnEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oBAAmBC,SAAA,EAChCF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,uBAAsBC,SAAC,kBACvCC,EAAAA,EAAAA,MAAA,QAAMF,UAAU,0BAAyBC,SAAA,CACtCk0B,GAAiBQ,UAAUj0B,OAAO,0DAenC,UAAb6sB,IACCrtB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,qBAAoBC,SAAC,2CAGnCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAE1CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8DAA6DC,SAAA,EAC1EF,EAAAA,EAAAA,KAAA,SACEY,KAAK,WACLzB,GAAG,kBACHoL,QAAS4a,EACT9kB,SAAWC,IACTA,EAAE4pC,kBACFt+B,QAAQC,IAAI,+BAAsBvL,EAAEC,OAAOgK,SAC3C+gB,EAAmBhrB,EAAEC,OAAOgK,UAE9BtK,UAAU,gGAEZD,EAAAA,EAAAA,KAAA,SAAOmqC,QAAQ,kBAAkBlqC,UAAU,oCAAmCC,SAAC,6CAMjFF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,yDAAwDC,UACrEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,sCAAqCC,SAAA,EAClDF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,gBAAeC,SAAC,2CAChCF,EAAAA,EAAAA,KAAA,QAAMC,UAAS,8CAAAmE,OAAgD+gB,EAC3D,4BACA,+BACCjlB,SACFilB,EAAkB,kBAAoB,0BAM7CnlB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,2DAA0DC,UACvEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,sCAAqCC,SAAA,EAClDF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,iBAAgBC,SAAC,iCACjCF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,yEAAwEC,SAAC,oCAO/FC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,uBAAsBC,SAAA,EACnCC,EAAAA,EAAAA,MAAA,UACEC,QAx6FegqC,KAC3Bx+B,QAAQC,IAAI,mDAGZ,MAkBMo2B,EAAWnE,EAAAA,GAAWG,WACtBuE,EAAY1E,EAAAA,GAAWc,aAnBT,CAElB,CAAC,IAAK,SAAU,cAAY,SAAU,MAAO,WAAY,YAAa,WAAY,QAAS,eAAgB,SAE3G,CAAC,EAAG,sBAAuB,EAAG,aAAc,aAAc,IAAK,OAAQ,KAAM,EAAG,GAAI,SACpF,CAAC,EAAG,4BAA0B,EAAG,aAAc,aAAc,GAAI,OAAQ,WAAY,IAAM,IAAK,MAChG,CAAC,EAAG,wBAAsB,EAAG,aAAc,aAAc,GAAI,OAAQ,aAAc,IAAM,IAAK,MAC9F,CAAC,EAAG,8BAAyB,EAAG,aAAc,aAAc,EAAG,OAAQ,UAAW,EAAG,IAAK,SAC1F,CAAC,EAAG,sBAAuB,GAAI,aAAc,aAAc,GAAI,QAAS,eAAgB,KAAO,IAAK,MACpG,CAAC,EAAG,qBAAsB,GAAI,aAAc,aAAc,GAAI,QAAS,cAAe,KAAO,IAAK,MAClG,CAAC,EAAG,iBAAe,EAAG,aAAc,aAAc,EAAG,OAAQ,WAAY,IAAM,MAAO,MACtF,CAAC,EAAG,oBAAqB,EAAG,aAAc,aAAc,EAAG,QAAS,KAAM,IAAM,IAAK,MACrF,CAAC,EAAG,4BAA0B,EAAG,aAAc,aAAc,EAAG,OAAQ,UAAW,EAAG,IAAK,SAC3F,CAAC,GAAI,8BAA4B,EAAG,aAAc,aAAc,EAAG,OAAQ,SAAU,IAAM,IAAK,MAChG,CAAC,GAAI,sBAAuB,EAAG,aAAc,aAAc,EAAG,OAAQ,KAAM,EAAG,KAAM,WAqBvF4D,EAAU,SAbQ,CAChB,CAAEvD,IAAK,GACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IAKTnB,EAAAA,GAAWI,kBAAkB+D,EAAUO,EAAW,cAGlD,MAAM6H,EAAQ,sBAAAjmC,QAAyB,IAAI3C,MAAOC,cAAcuc,MAAM,KAAK,GAAE,SAC7E6f,EAAAA,GAAemE,EAAUoI,GAEzBz+B,QAAQC,IAAI,kDAAyCw+B,IAy3FzC5jC,SAAUwpB,GACVhwB,UAAS,2DAAAmE,OAA6D6rB,GAClE,+CACA,gDAEJtnB,MAAOsnB,GAAiB,oCAAsC,+CAA+C/vB,SAAA,EAE7GF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,gBAERC,EAAAA,EAAAA,MAAA,UACEC,QAASA,KAAA,IAAAkqC,EAAA,OAA0B,QAA1BA,EAAM1X,GAAajT,eAAO,IAAA2qB,OAAA,EAApBA,EAAsBC,SACrC9jC,SAAUwpB,GACVhwB,UAAS,2DAAAmE,OAA6D6rB,GAClE,+CACA,4CAEJtnB,MAAOsnB,GAAiB,oCAAsC,+DAA+D/vB,SAAA,EAE7HF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,iBAERC,EAAAA,EAAAA,MAAA,UACEC,QAASA,IAAM4vB,IAAgB,GAC/BvpB,SAAUwpB,GACVhwB,UAAS,2DAAAmE,OAA6D6rB,GAClE,+CACA,mGAEJtnB,MAAOsnB,GAAiB,oCAAsC,4DAAyD/vB,SAAA,EAEvHF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,WAIRF,EAAAA,EAAAA,KAAA,SACEwqC,IAAK5X,GACLhyB,KAAK,OACL6pC,OAAO,aACPpqC,SAAWC,IAAO,IAADoqC,EACf,MAAMpL,EAAqB,QAAjBoL,EAAGpqC,EAAEC,OAAOg/B,aAAK,IAAAmL,OAAA,EAAdA,EAAiB,GAC1BpL,GA/5FaA,KAM/B,GALA1zB,QAAQC,IAAI,qDAA4CyzB,EAAKv+B,MAC7D6K,QAAQC,IAAI,sCAA0ByzB,EAAKj5B,KAAM,SACjDuF,QAAQC,IAAI,gCAAuByzB,EAAK1+B,MAGnC0+B,EAML,GAAIA,EAAKj5B,KAAO,SACdjF,MAAM,8EAKR,GAAkB,IAAdk+B,EAAKj5B,KAMT,GAAKi5B,EAAK1+B,KAAK2O,SAAS,UAAa+vB,EAAK1+B,KAAK2O,SAAS,UAAa+vB,EAAKv+B,KAAK4pC,SAAS,UAAarL,EAAKv+B,KAAK4pC,SAAS,QAAxH,CAKA/+B,QAAQC,IAAI,gEAGZ,IACE,MAAM++B,EAAUC,IAAIC,gBAAgBxL,GACpC1zB,QAAQC,IAAI,uCAA8B++B,GAE1CG,MAAMH,GACHnE,KAAKuE,IAEJ,GADAp/B,QAAQC,IAAI,sCAA6Bm/B,EAAS1xB,SAC7C0xB,EAASC,GACZ,MAAM,IAAIp2B,MAAM,uBAADzQ,OAAwB4mC,EAAS1xB,SAElD,OAAO0xB,EAASE,gBAEjBzE,KAAKyE,IACJt/B,QAAQC,IAAI,gDAAoCq/B,EAAYC,YAE5D,IACE,MAAMv8B,EAAO,IAAIozB,WAAWkJ,GAG5B,GAFAt/B,QAAQC,IAAI,0DAA8C+C,EAAKjO,QAE3C,IAAhBiO,EAAKjO,OACP,MAAM,IAAIkU,MAAM,+BAGlB,MAAMotB,EAAWnE,EAAAA,GAAUlvB,EAAM,CAAEhO,KAAM,UACzCgL,QAAQC,IAAI,gEAAuDo2B,EAASM,YAG5EL,GAAgBD,GAGhB4I,IAAIO,gBAAgBR,EAEtB,CAAE,MAAOzI,GACPv2B,QAAQ+C,MAAM,iCAA6BwzB,GAC3C0I,IAAIO,gBAAgBR,GACpBxpC,MAAM,0IACR,IAEDulC,MAAM0E,IACLz/B,QAAQ+C,MAAM,yBAAqB08B,GACnCR,IAAIO,gBAAgBR,GAGpBh/B,QAAQC,IAAI,sDACZk2B,GAAsBzC,IAG5B,CAAE,MAAOgM,GACP1/B,QAAQ+C,MAAM,uCAAmC28B,GAEjD1/B,QAAQC,IAAI,sDACZk2B,GAAsBzC,EACxB,CAzDA,MAFEl+B,MAAM,8EANNA,MAAM,2CAZNA,MAAM,iDAy5FQmqC,CAAwBjM,IAG5BnyB,MAAO,CAAEq+B,QAAS,WAEpBrrC,EAAAA,EAAAA,MAAA,UACEC,QAASy+B,GACT5+B,UAAU,qGAAoGC,SAAA,EAE9GF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,cAII,OAAXmhB,QAAW,IAAXA,OAAW,EAAXA,EAAaK,gBACZvhB,EAAAA,EAAAA,MAAA,UACEC,QAASA,KACPwL,QAAQC,IAAI,+DACZ,MAAM4/B,EAAehY,KACjBgY,GAAgBtgB,GAClBA,EAASsgB,IAGbxrC,UAAS,2DAAAmE,OAA6D6rB,IAAkBqD,GACpF,+CACA,gDAEJ3qB,MAAOsnB,GAAiB,oCAAsC,2EAC9DxpB,SAAUwpB,IAAkBqD,GAAuBpzB,SAAA,EAEnDF,EAAAA,EAAAA,KAAA,QAAAE,SAAOozB,GAAyB,SAAM,kBACtCtzB,EAAAA,EAAAA,KAAA,QAAMC,UAAU,oBAAmBC,SAAEozB,GAAyB,UAAY,sBAOlFtzB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,iEAAgEC,UAC7EC,EAAAA,EAAAA,MAAA,SAAOF,UAAU,4DAA2DC,SAAA,EAC1EF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+BAA8BC,UAC7CC,EAAAA,EAAAA,MAAA,MAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,OACvHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,iFAAiFkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,eACzHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEu+B,SAAU,SAAUxrC,SAAC,WAC3HF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,iFAAiFkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,kBACzHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,iBACvHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,YACvHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,SACvHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,cACvHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,eACvHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,cACvHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,WACvHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,wBACvHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+EAA+EkN,MAAO,CAAEsR,MAAO,QAASve,SAAC,uBAG3HF,EAAAA,EAAAA,KAAA,SAAO2rC,UAAW9E,GAAc3mC,UAO5B0L,QAAQC,IAAI,sDACV8nB,GAAa9zB,IAAI,CAAC+E,EAAGC,KAAC,CACpB6D,MAAO7D,EAAI,EACX9D,KAAM6D,EAAE7D,KACRD,QAAS8D,EAAE9D,YAKR6yB,IAENvvB,OAAO,CAAC,CAAEjF,GAAI,eAAgBysC,aAAa,KAC3C/rC,IAAI,CAACC,EAAM4I,IAEN5I,EAAK8rC,aAELzrC,EAAAA,EAAAA,MAAA,MAAuBF,UAAU,mBAAkBC,SAAA,EACjDF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,qEAAoEC,SAAC,OAGnFF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAC9CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,sBAAqBC,UAClCC,EAAAA,EAAAA,MAAA,UACEC,QAAUE,IACRA,EAAE4pC,kBAh5DbpsB,WAInB,GAHAlS,QAAQC,IAAI,yCAGR0V,GAA0B,OAAXF,QAAW,IAAXA,GAAAA,EAAapM,eAAgB,CAC9C,MAAMsb,QAAuBC,EAAAA,EAAoBC,QAAQpP,EAAYpM,gBACrE,IAAKsb,EAAeG,QAGlB,OAFAtvB,MAAM,sCAADgD,OAAkCmsB,EAAezb,QAAO,QAAA1Q,OAAOmsB,EAAesb,kBACnFjgC,QAAQoH,KAAK,8CAA+Cud,EAGhE,CAGA,IAAIub,EAAehoB,EAAM,IAAIriB,MACzB2zB,EAAa5Q,EAAQsnB,EAAc,EAAG3mB,GAE1C,GAAI/D,EAAMzgB,OAAS,EAAG,CACpB,MAAMorC,EAAW3qB,EAAMA,EAAMzgB,OAAS,GACtCmrC,EAAetnB,EAAQunB,EAASpnC,QAAS,EAAGwgB,GAC5CiQ,EAAa5Q,EAAQsnB,EAAc,EAAG3mB,EACxC,CAGA,MAmBM6mB,EAlBG,uCAAuCpoC,QAAQ,QAAS,SAAUqoC,GACvE,MAAM9lC,EAAoB,GAAhBgE,KAAK+hC,SAAgB,EAE/B,OADgB,MAAND,EAAY9lC,EAAS,EAAJA,EAAU,GAC5B+J,SAAS,GACpB,GAeIyb,EAXoBwgB,MACxB,IACIC,EADAC,EAAU,EAEd,GACED,EAASC,EACTA,UACOjrB,EAAM5d,KAAK1D,GAAQA,EAAKgB,UAAYsrC,IAC7C,OAAOA,GAIUD,GAGbG,EAAU,CACdntC,GAAI6sC,EACJlrC,QAAS6qB,EACT5qB,KAAK,eAADqD,OAAiBunB,GACrBnf,SAAU,EACV9H,UAAWonC,EACXnnC,QAASywB,EACT/b,SAAU,EACV0M,aAAc3E,EAAMzgB,OAAS,EAAI,CAACygB,EAAMA,EAAMzgB,OAAS,GAAGxB,IAAM,GAChE6mB,WAAY,GACZC,UAAW,GACXQ,KAAM,EACNnX,aAAa,EACbwW,YAAY,EACZY,iBAAkB,EAClBrS,WAAYy3B,EACZx3B,YAAa8gB,EACbzO,UAAWmlB,EACXllB,WAAYwO,EACZvO,WAAY,EACZC,UAAW,EACXxN,OAAQ,UACRyN,cAAeilB,EACftqB,aAAc,EACd+f,YAAa,EACb8K,WAAY,EACZ1pC,YAAa,GACb8J,SAAU,SACVmB,WAAY,GACZ0+B,YAAa1oB,EAAM,IAAIriB,MACvBgrC,aAAc3oB,EAAM,IAAIriB,OAG1BmK,QAAQC,IAAI,4CAAmCygC,GAG/CnhB,EAASvrB,IACP,MAAM+jC,EAAW,IAAI/jC,EAAM0sC,GAG3B,GAAI1sC,EAAKe,OAAS,EAAG,CACnB,MAAM+rC,EAAa9sC,EAAKA,EAAKe,OAAS,GAAGxB,GACnC6nB,EAAe2c,EAAS9jC,IAAIC,GAC5BA,EAAKX,KAAOutC,GACd3sC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKD,GAAI,IACPkmB,WAAY,IAAKlmB,EAAKkmB,YAAc,GAAKgmB,KAGtClsC,GAIT,OADA8L,QAAQC,IAAI,+CACLmb,CACT,CAGA,OADApb,QAAQC,IAAI,8CACL83B,KAyyDqBgJ,IAEFlmC,SAAUwpB,GACVhwB,UAAS,qGAAAmE,OAAuG6rB,GAC5G,+CACA,4CAEJtnB,MAAOsnB,GAAiB,+CAAiD,+BAA+B/vB,SAAA,EAExGF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,YACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,wBAIZF,EAAAA,EAAAA,KAAA,MAAI4sC,QAAQ,KAAK3sC,UAAU,qEAAoEC,SAAC,kDAvB1F,iBAgCVC,EAAAA,EAAAA,MAAA,MAEEF,UAAS,oBAAAmE,OAAsB0pB,KAAgBhuB,EAAKX,GAAK,aAAe,IACxEiB,QAASA,IAAM2tB,GAAejuB,EAAKX,IAAIe,SAAA,EAGvCF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,qEAAoEC,SAC/EwI,EAAQ,KAIX1I,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAC9CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,gCAA+BC,SAAA,EAC5CF,EAAAA,EAAAA,KAAA,UACEI,QAAUE,IACRA,EAAE4pC,kBA1pFHpsB,eAAO+uB,GAA2C,IAAxBC,EAAWn1B,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,KAInE,GAHA/L,QAAQC,IAAI,2DAA+CghC,EAAmB,uBAAqBC,GAG/FvrB,GAA0B,OAAXF,QAAW,IAAXA,GAAAA,EAAapM,eAAgB,CAC9C,MAAMsb,QAAuBC,EAAAA,EAAoBC,QAAQpP,EAAYpM,gBACrE,IAAKsb,EAAeG,QAGlB,OAFAtvB,MAAM,uCAADgD,OAAmCmsB,EAAezb,QAAO,QAAA1Q,OAAOmsB,EAAesb,kBACpFjgC,QAAQoH,KAAK,+CAAgDud,EAGjE,CAGA,MAAMwc,EAAgB3rB,EAAMnd,KAAKnE,GAAQA,EAAKX,KAAO0tC,GACrD,IAAKE,EAEH,YADAnhC,QAAQ+C,MAAM,mDAKhB,MAAMm9B,EAAetnB,EAAQuoB,EAAcpoC,QAAS,EAAGwgB,GACjDiQ,EAAa5Q,EAAQsnB,EAAc,EAAG3mB,GAyCtC6mB,EArCG,uCAAuCpoC,QAAQ,QAAS,SAAUqoC,GACvE,MAAM9lC,EAAoB,GAAhBgE,KAAK+hC,SAAgB,EAE/B,OADgB,MAAND,EAAY9lC,EAAS,EAAJA,EAAU,GAC5B+J,SAAS,GACpB,GAkCIyb,EA9B0BqhB,KAE9B,GAAoB,IAAhBA,EACF,OAAO,EAIT,MAAMC,EAAW7rB,EAAM4rB,EAAc,GACrC,GAAIC,GAAYA,EAASnsC,QAAS,CAEhC,GAAgC,kBAArBmsC,EAASnsC,QAClB,OAAOmsC,EAASnsC,QAAU,EAG5B,MACMosC,EADShpB,OAAO+oB,EAASnsC,SACVmd,MAAM,KAC3B,GAAqB,IAAjBivB,EAAMvsC,OAAc,CACtB,MAAMwsC,EAAQ7iC,SAAS4iC,EAAM,IACvBE,EAAQ9iC,SAAS4iC,EAAM,IAAM,EACnC,MAAM,GAAN9oC,OAAU+oC,EAAK,KAAA/oC,OAAIgpC,EACrB,CAEA,OAAOJ,EAAc,CACvB,CAGA,OAAOA,EAAc,GAIJK,CAAuC,OAAhBP,EAAuBA,EAAc,EAAI1rB,EAAMzgB,QAGnF2rC,EAAU,CACdntC,GAAI6sC,EACJlrC,QAAS6qB,EACT5qB,KAAK,eAADqD,OAAiBunB,GACrBnf,SAAU,EACV9H,UAAWonC,EACXnnC,QAASywB,EACT/b,SAAU,EACV0M,aAAc,CAAC8mB,GACf7mB,WAAY,GACZC,UAAW,GACXQ,KAAM,EACNnX,aAAa,EACbwW,YAAY,EACZY,iBAAkB,EAClBrS,WAAYy3B,EACZx3B,YAAa8gB,EACbzO,UAAWmlB,EACXllB,WAAYwO,EACZvO,WAAY,EACZC,UAAW,EACXxN,OAAQ,UACRyN,cAAeilB,EACftqB,aAAc,EACd+f,YAAa,EACb8K,WAAY,EACZ1pC,YAAa,GACb8J,SAAU,SACVmB,WAAY,GACZ0+B,YAAa1oB,EAAM,IAAIriB,MACvBgrC,aAAc3oB,EAAM,IAAIriB,OAG1BmK,QAAQC,IAAI,mCAA0BygC,GAGtCnhB,EAASvrB,IACPgM,QAAQC,IAAI,oDAAwCjM,EAAKC,IAAI,CAAC+E,EAAGC,KAAC,CAAQ6D,MAAO7D,EAAG1F,GAAIyF,EAAEzF,GAAI4B,KAAM6D,EAAE7D,KAAMD,QAAS8D,EAAE9D,YAGvH,MAAMwsC,EAAiB1tC,EAAKojC,UAAUljC,GAAQA,EAAKX,KAAO0tC,GAC1D,IAAwB,IAApBS,EAEF,OADA1hC,QAAQ+C,MAAM,+DACP/O,EAIT,MAAM2tC,EAAiBD,EAAiB,EAClC3J,EAAW,IACZ/jC,EAAKiP,MAAM,EAAG0+B,GACjBjB,KACG1sC,EAAKiP,MAAM0+B,IAGhB3hC,QAAQC,IAAI,uDAA2C0hC,GACvD3hC,QAAQC,IAAI,yDAA0C83B,EAAS9jC,IAAI,CAAC+E,EAAGC,KAAC,CAAQ6D,MAAO7D,EAAG1F,GAAIyF,EAAEzF,GAAI4B,KAAM6D,EAAE7D,KAAMD,QAAS8D,EAAE9D,YAG7H,MAWM6mB,EAXegc,EAAS9jC,IAAIC,GAC5BA,EAAKX,KAAO0tC,GACd9sC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKD,GAAI,IACPkmB,WAAY,IAAKlmB,EAAKkmB,YAAc,GAAKgmB,KAGtClsC,GAIuBD,IAAI,CAACC,EAAM4I,KAAK3I,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC3CD,GAAI,IACPgB,QAAS4H,EAAQ,KAOnB,GAJAkD,QAAQC,IAAI,4DAAmD8b,EAAW9nB,IAAI,CAAC+E,EAAGC,KAAC,CAAQ6D,MAAO7D,EAAG1F,GAAIyF,EAAEzF,GAAI4B,KAAM6D,EAAE7D,KAAMD,QAAS8D,EAAE9D,YACxI8K,QAAQC,IAAI,8DAGR0V,GAA0B,OAAXF,QAAW,IAAXA,GAAAA,EAAaliB,GAAI,CAAC,IAADquC,EAElC,MAAMC,EAAe,CACnBtuC,GAAImtC,EAAQntC,GACZwa,WAAY0H,EAAYliB,GACxBuuC,SAAUrsB,EAAYqsB,WAAuC,QAA/BF,EAAIlsB,EAAAA,QAAgBpM,mBAAW,IAAAs4B,OAAA,EAA3BA,EAA6BruC,IAC/D4B,KAAMurC,EAAQvrC,KACd4sC,SAAUrB,EAAQxrC,QAClBwlC,WAAYgG,EAAQ5nC,UACpB2hC,SAAUiG,EAAQ3nC,QAClB6H,SAAU8/B,EAAQ9/B,SAClB6M,SAAUizB,EAAQjzB,SAClB0M,aAAcumB,EAAQvmB,cAAgB,GACtCC,WAAYsmB,EAAQtmB,YAAc,GAClCC,UAAWqmB,EAAQrmB,WAAa,GAChCQ,KAAM6lB,EAAQ7lB,MAAQ,EACtBnN,OAAQgzB,EAAQhzB,QAAU,UAC1B3M,SAAU2/B,EAAQ3/B,UAAY,SAC9B9J,YAAaypC,EAAQzpC,aAAe,GACpC2jC,YAAa8F,EAAQx+B,YAAc,GACnC8/B,aAActB,EAAQh9B,cAAe,EACrCu+B,kBAAmBvB,EAAQ5lB,kBAAoB4lB,EAAQ9/B,SACvDshC,YAAY,IAAIrsC,MAAOC,cACvBma,YAAY,IAAIpa,MAAOC,eAGzB4f,EAAAA,QAAgBtM,SACb+B,KAAK,SACLmD,OAAO,CAACuzB,IACRhH,KAAKsH,IAAgB,IAAf,MAAEp/B,GAAOo/B,EACVp/B,EACF/C,QAAQ+C,MAAM,6CAAyCA,IAEvD/C,QAAQC,IAAI,mDAGZmiC,QAAQC,IACNtmB,EAAW9nB,IAAIC,GACbwhB,EAAAA,QAAgBtM,SACb+B,KAAK,SACL2E,OAAO,CAAEiyB,SAAU7tC,EAAKgB,UACxBqW,GAAG,KAAMrX,EAAKX,IACdgY,GAAG,aAAckK,EAAYliB,MAElCsnC,KAAK,KACL76B,QAAQC,IAAI,yEACX86B,MAAMh4B,IACP/C,QAAQ+C,MAAM,kDAA8CA,QAIjEg4B,MAAMh4B,IACL/C,QAAQ+C,MAAM,kDAA8CA,IAElE,CAEA,OAAOgZ,GAEX,CAg9E8BumB,CAAqBpuC,EAAKX,GAAIuJ,IAEhCjC,SAAUwpB,GACVhwB,UAAS,uHAAAmE,OAAyH6rB,GAC9H,+CACA,8CAEJtnB,MAAOsnB,GAAiB,gDAAkD,2BAAwB/vB,SACnG,YAGDF,EAAAA,EAAAA,KAAA,UACEI,QAAUE,IACRA,EAAE4pC,kBAx1DbpsB,WACjB,MAAMqwB,EAAe/sB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOkoB,GAC9C,IAAK8mB,EAEH,YADAviC,QAAQ+C,MAAM,4CAKhB,MAAMy/B,EAAiBhtB,EAAMlgB,OAAOpB,IAAI,IAAAuuC,EAAAC,EAAA,OACrB,QAAjBD,EAAAvuC,EAAKimB,oBAAY,IAAAsoB,OAAA,EAAjBA,EAAmB9+B,SAAS8X,MAA0B,QAAnBinB,EAAIxuC,EAAKkmB,kBAAU,IAAAsoB,OAAA,EAAfA,EAAiB/+B,SAAS8X,MAGnE,IAAIud,EAAc,yDAAAxgC,OAAsD+pC,EAAaptC,KAAI,MAiBzF,GAfIqtC,EAAeztC,OAAS,IAC1BikC,GAAc,iEACdwJ,EAAet/B,QAAQhP,IAAS,IAADyuC,EAAAC,EACR,QAArBD,EAAIzuC,EAAKimB,oBAAY,IAAAwoB,GAAjBA,EAAmBh/B,SAAS8X,KAC9Bud,GAAc,WAAAxgC,OAAUtE,EAAKiB,KAAI,8BAEhB,QAAnBytC,EAAI1uC,EAAKkmB,kBAAU,IAAAwoB,GAAfA,EAAiBj/B,SAAS8X,KAC5Bud,GAAc,iCAAAxgC,OAAgCtE,EAAKiB,KAAI,UAG3D6jC,GAAc,0DAGhBA,GAAc,2CAET9kB,OAAO6kB,QAAQC,GAApB,CAQA,GAJAh5B,QAAQC,IAAI,uCAAyBsiC,EAAaptC,KAAM,MAAOsmB,GAC/Dzb,QAAQC,IAAI,gDAAuCuiC,EAAeztC,QAG9D4gB,GAA0B,OAAXF,QAAW,IAAXA,GAAAA,EAAaliB,GAC9B,IACEyM,QAAQC,IAAI,gDACZ,MAAM,MAAE8C,SAAgB2S,EAAAA,QAAgBtM,SACrC+B,KAAK,SACLtD,SACA0D,GAAG,KAAMkQ,GACTlQ,GAAG,aAAckK,EAAYliB,IAEhC,GAAIwP,EAGF,OAFA/C,QAAQ+C,MAAM,6CAAyCA,QACvDvN,MAAM,+FAIRwK,QAAQC,IAAI,kDACd,CAAE,MAAO8C,GAGP,OAFA/C,QAAQ+C,MAAM,kDAA8CA,QAC5DvN,MAAM,qFAER,CAIF+pB,EAASvrB,IACP,MAUM+nB,EAVe/nB,EAAKsB,OAAOpB,GAAQA,EAAKX,KAAOkoB,GAGnBxnB,IAAIC,IAAI,IAAA2uC,EAAAC,EAAA,OAAA3uC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACrCD,GAAI,IACPimB,cAA+B,QAAjB0oB,EAAA3uC,EAAKimB,oBAAY,IAAA0oB,OAAA,EAAjBA,EAAmBvtC,OAAOglB,GAAUA,IAAWmB,KAAW,GACxErB,YAA2B,QAAf0oB,EAAA5uC,EAAKkmB,kBAAU,IAAA0oB,OAAA,EAAfA,EAAiBxtC,OAAO8mB,GAAUA,IAAWX,KAAW,OAItCxnB,IAAI,CAACC,EAAM4I,KAAK3I,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC3CD,GAAI,IACPgB,QAAS4H,EAAQ,KA+BnB,OA5BAkD,QAAQC,IAAI,kDACZD,QAAQC,IAAI,iEACV8b,EAAW9nB,IAAI+E,IAAC,CAAO7D,KAAM6D,EAAE7D,KAAMD,QAAS8D,EAAE9D,YAI9CygB,GAA0B,OAAXF,QAAW,IAAXA,GAAAA,EAAaliB,IAE9B6uC,QAAQC,IACNtmB,EAAW9nB,IAAIC,GACbwhB,EAAAA,QAAgBtM,SACb+B,KAAK,SACL2E,OAAO,CAAEiyB,SAAU7tC,EAAKgB,UACxBqW,GAAG,KAAMrX,EAAKX,IACdgY,GAAG,aAAckK,EAAYliB,MAElCsnC,KAAKkI,IACL,MAAMllC,EAASklC,EAAQztC,OAAOiF,GAAKA,EAAEwI,OACjClF,EAAO9I,OAAS,EAClBiL,QAAQ+C,MAAM,gEAAuDlF,GAErEmC,QAAQC,IAAI,2DAEb86B,MAAMh4B,IACP/C,QAAQ+C,MAAM,kDAA8CA,KAIzDgZ,GA1ET,GA0zD4BinB,CAAW9uC,EAAKX,KAElBc,UAAU,6JACV0I,MAAM,iBAAgBzI,SACvB,6BAOLF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAClC,OAAXwtB,QAAW,IAAXA,OAAW,EAAXA,EAAarG,UAAWvnB,EAAKX,IAA6B,UAAZ,OAAXuuB,QAAW,IAAXA,OAAW,EAAXA,EAAahuB,QAC/CM,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOiuB,EACPvtB,SAAWC,GAAMutB,EAAgBvtB,EAAEC,OAAOZ,OAC1CkvC,OAAQ7I,GACR2F,UAAW9E,GACX5mC,UAAU,sGACV6I,WAAS,KAGX9I,EAAAA,EAAAA,KAAA,OACEC,UAAU,oFACVG,QAASA,IAAM4kC,GAAallC,EAAKX,GAAI,OAAQW,EAAKiB,MAClD4H,MAAM,2BAA0BzI,SAE/BJ,EAAKiB,UAMZf,EAAAA,EAAAA,KAAA,MAAIC,UAAU,+CAA8CC,UAC1DF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAjkEVinB,KACvB8D,EAASvrB,GAAQA,EAAKC,IAAIC,IACxB,GAAIA,EAAKX,KAAOkoB,EAAQ,OAAOvnB,EAI/B,IAF6BA,EAAKwP,YAYhC,OARA1D,QAAQC,IAAI,qCAA4B,CACtCwb,SACAgF,SAAUvsB,EAAKiB,KACf2D,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK4E,UACd8H,SAAU,IAGL,CACLrN,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU,EACV9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK4E,UACd2U,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,aAAa,EACbwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,IACpCyG,WAAW,IAAIhrB,MAAOC,eAEnB,CAEL,MAAMglB,EAAmB5mB,EAAK4mB,kBAAoB,EAC5C0O,EAAa5Q,EAAQ1kB,EAAK4E,UAAWgiB,EAAkBvB,GAC7D,MAAO,CACLhmB,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAUka,EACVhiB,UAAW5E,EAAK4E,UAChBC,QAASywB,EACT/b,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,aAAa,EACbwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,IACpCyG,WAAW,IAAIhrB,MAAOC,cAE1B,KAIF,MAAMojC,EAAkB,IAAI9kB,YAAY,aAAc,CACpDC,OAAQ,CAAErf,KAAM,oBAAqBymB,SAAQnH,WAAW,IAAIze,MAAOC,iBAErEoe,OAAOC,cAAc+kB,IA8+DkBgK,CAAgBhvC,EAAKX,IACpCc,UAAS,8FAAAmE,OAAgGtE,EAAKwP,YAC1G,uDACA,wFAEJ3G,MAAO7I,EAAKwP,YAAc,cAAgB,mBAAmBpP,SAC9D,oBAMHF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAC7CJ,EAAKwP,aACJtP,EAAAA,EAAAA,KAAA,OAAKC,UAAU,0EAAyEC,SAAC,QAG5E,OAAXwtB,QAAW,IAAXA,OAAW,EAAXA,EAAarG,UAAWvnB,EAAKX,IAA6B,cAAZ,OAAXuuB,QAAW,IAAXA,OAAW,EAAXA,EAAahuB,QAClDM,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACLjB,MAAOiuB,EACPvtB,SAAWC,GAAMutB,EAAgBvtB,EAAEC,OAAOZ,OAC1CkvC,OAAQ7I,GACR2F,UAAW9E,GACX5mC,UAAU,sGACV6I,WAAS,KAGX3I,EAAAA,EAAAA,MAAA,OACEF,UAAU,oFACVG,QAASA,IAAM4kC,GAAallC,EAAKX,GAAI,WAAYW,EAAK0M,UACtD7D,MAAM,gCAA4BzI,SAAA,CAEjCJ,EAAK0M,SAAS,UAMrBxM,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAClC,OAAXwtB,QAAW,IAAXA,OAAW,EAAXA,EAAarG,UAAWvnB,EAAKX,IAA6B,eAAZ,OAAXuuB,QAAW,IAAXA,OAAW,EAAXA,EAAahuB,QAC/CM,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOiuB,EACPvtB,SAAWC,GAAMutB,EAAgBvtB,EAAEC,OAAOZ,OAC1CkvC,OAAQ7I,GACR2F,UAAW9E,GACX5mC,UAAU,sGACV6I,WAAS,KAGX9I,EAAAA,EAAAA,KAAA,OACEC,UAAU,4FACVG,QAASA,IAAM4kC,GAAallC,EAAKX,GAAI,YAAaW,EAAK4E,WACvDiE,MAAM,oCAAmCzI,SAExCJ,EAAK4E,WAAgC,OAAnB5E,EAAK4E,gBAAyCmN,IAAnB/R,EAAK4E,UAA0B5E,EAAK4E,UAAUuZ,MAAM,KAAK8wB,UAAUp0B,KAAK,KAAO,QAMnI3a,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAC7CJ,EAAKwP,aACJtP,EAAAA,EAAAA,KAAA,OAAKC,UAAU,kFAAiFC,SAC7F,MACC,IAAKJ,EAAK4E,WAAgC,OAAnB5E,EAAK4E,gBAAyCmN,IAAnB/R,EAAK4E,UAAyB,MAAO,GACvF,MAAO4gC,EAAMD,EAAOF,GAAOrlC,EAAK4E,UAAUuZ,MAAM,KAChD,OAAO,IAAIxc,KAAK6jC,EAAMD,EAAQ,EAAGF,GAAKv3B,mBAAmB,KAC1D,EAJA,MAMU,OAAX8f,QAAW,IAAXA,OAAW,EAAXA,EAAarG,UAAWvnB,EAAKX,IAA6B,aAAZ,OAAXuuB,QAAW,IAAXA,OAAW,EAAXA,EAAahuB,QAClDM,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOiuB,EACPvtB,SAAWC,GAAMutB,EAAgBvtB,EAAEC,OAAOZ,OAC1CkvC,OAAQ7I,GACR2F,UAAW9E,GACX5mC,UAAU,sGACV6I,WAAS,KAGX9I,EAAAA,EAAAA,KAAA,OACEC,UAAU,4FACVG,QAASA,IAAM4kC,GAAallC,EAAKX,GAAI,UAAWW,EAAK6E,SACrDgE,MAAM,iCAAgCzI,SAErCJ,EAAKwP,YACDxP,EAAK4E,WAAgC,OAAnB5E,EAAK4E,gBAAyCmN,IAAnB/R,EAAK4E,UAA0B5E,EAAK4E,UAAUuZ,MAAM,KAAK8wB,UAAUp0B,KAAK,KAAO,GAC5H7a,EAAK6E,SAA4B,OAAjB7E,EAAK6E,cAAqCkN,IAAjB/R,EAAK6E,QAAwB7E,EAAK6E,QAAQsZ,MAAM,KAAK8wB,UAAUp0B,KAAK,KAAO,QAO/H3a,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAClC,OAAXwtB,QAAW,IAAXA,OAAW,EAAXA,EAAarG,UAAWvnB,EAAKX,IAA6B,cAAZ,OAAXuuB,QAAW,IAAXA,OAAW,EAAXA,EAAahuB,QAC/CM,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACLyJ,IAAI,IACJK,IAAI,MACJ/K,MAAOiuB,EACPvtB,SAAWC,GAAMutB,EAAgBvtB,EAAEC,OAAOZ,OAC1CkvC,OAAQ7I,GACR2F,UAAW9E,GACX5mC,UAAU,sGACV6I,WAAS,KAGX9I,EAAAA,EAAAA,KAAA,OACEC,UAAU,oFACVG,QAASA,IAAM4kC,GAAallC,EAAKX,GAAI,WAAYW,EAAKuZ,UAAUnZ,UAEhEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,oCAAmCC,UAChDF,EAAAA,EAAAA,KAAA,OACEC,UAAU,+BACVkN,MAAO,CAAEsR,MAAM,GAADra,OAAKtE,EAAKuZ,SAAQ,WAGpClZ,EAAAA,EAAAA,MAAA,QAAMF,UAAU,UAASC,SAAA,CAAEJ,EAAKuZ,SAAS,eAOjDrZ,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAClC,OAAXwtB,QAAW,IAAXA,OAAW,EAAXA,EAAarG,UAAWvnB,EAAKX,IAA6B,cAAZ,OAAXuuB,QAAW,IAAXA,OAAW,EAAXA,EAAahuB,QAC/CS,EAAAA,EAAAA,MAAA,UACER,MAAOiuB,EACPvtB,SAAWC,GAAMutB,EAAgBvtB,EAAEC,OAAOZ,OAC1CkvC,OAAQ7I,GACR/lC,UAAU,sGACV6I,WAAS,EAAA5I,SAAA,EAETF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,MAAKO,SAAC,UACpBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,SAAQO,SAAC,WACvBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,OAAMO,SAAC,UACrBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,WAAUO,SAAC,mBAG3BF,EAAAA,EAAAA,KAAA,OACEC,UAAU,oFACVG,QAASA,IAAM4kC,GAAallC,EAAKX,GAAI,WAAYW,EAAK6M,UAAUzM,UAEhEF,EAAAA,EAAAA,KAAA,QAAMC,UAAS,kCAAAmE,OAAsD,aAAlBtE,EAAK6M,SAA0B,0BAC9D,SAAlB7M,EAAK6M,SAAsB,gCACP,WAAlB7M,EAAK6M,SAAwB,gCAC3B,+BACDzM,SACgB,aAAlBJ,EAAK6M,SAA0B,aACZ,SAAlB7M,EAAK6M,SAAsB,OACP,WAAlB7M,EAAK6M,SAAwB,QAAU,cAOnD3M,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAClC,OAAXwtB,QAAW,IAAXA,OAAW,EAAXA,EAAarG,UAAWvnB,EAAKX,IAA6B,gBAAZ,OAAXuuB,QAAW,IAAXA,OAAW,EAAXA,EAAahuB,QAC/CM,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOiuB,EACPvtB,SAAWC,GAAMutB,EAAgBvtB,EAAEC,OAAOZ,OAC1CkvC,OAAQ7I,GACR2F,UAAW9E,GACX5mC,UAAU,sGACV6I,WAAS,KAGX9I,EAAAA,EAAAA,KAAA,OACEC,UAAU,oFACVG,QAASA,IAAM4kC,GAAallC,EAAKX,GAAI,aAAcW,EAAKgO,YAAY5N,SAEnEJ,EAAKgO,YAAc,mBAM1B9N,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAClC,OAAXwtB,QAAW,IAAXA,OAAW,EAAXA,EAAarG,UAAWvnB,EAAKX,IAA6B,UAAZ,OAAXuuB,QAAW,IAAXA,OAAW,EAAXA,EAAahuB,QAC/CM,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACL+J,KAAK,OACLhL,MAAOiuB,EACPvtB,SAAWC,GAAMutB,EAAgBvtB,EAAEC,OAAOZ,OAC1CkvC,OAAQ7I,GACR2F,UAAW9E,GACX5mC,UAAU,sGACV6I,WAAS,KAGX3I,EAAAA,EAAAA,MAAA,OACEF,UAAU,oFACVG,QAASA,IAAM4kC,GAAallC,EAAKX,GAAI,OAAQW,EAAK2mB,MAAMvmB,SAAA,CACzD,IACGJ,EAAK2mB,KAAKrf,uBAMlBpH,EAAAA,EAAAA,KAAA,MAAIC,UAAU,gDAA+CC,UAC/C,OAAXwtB,QAAW,IAAXA,OAAW,EAAXA,EAAarG,UAAWvnB,EAAKX,IAA6B,mBAAZ,OAAXuuB,QAAW,IAAXA,OAAW,EAAXA,EAAahuB,QAC/CM,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACL+J,KAAK,OACLhL,MAAOiuB,EACPvtB,SAAWC,GAAMutB,EAAgBvtB,EAAEC,OAAOZ,OAC1CkvC,OAAQ7I,GACR2F,UAAW9E,GACX5mC,UAAU,sGACV6I,WAAS,KAGX3I,EAAAA,EAAAA,MAAA,OACEF,UAAU,sFACVG,QAASA,IAAM4kC,GAAallC,EAAKX,GAAI,gBAAiBW,EAAK6hB,eAAiB,GAC5EhZ,MAAM,oCAAgCzI,SAAA,CACvC,KACIJ,EAAK6hB,eAAiB,GAAGva,uBAMlCpH,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,UAClC,OAAXwtB,QAAW,IAAXA,OAAW,EAAXA,EAAarG,UAAWvnB,EAAKX,IAA6B,kBAAZ,OAAXuuB,QAAW,IAAXA,OAAW,EAAXA,EAAahuB,QAC/CS,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6BAA4BC,SAAC,sEAC5CF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOiuB,EACPvtB,SAAWC,GAAMutB,EAAgBvtB,EAAEC,OAAOZ,OAC1CkvC,OAAQ7I,GACR2F,UAAW9E,GACX5mC,UAAU,8GACVO,YAAY,UACZsI,WAAS,KAEX3I,EAAAA,EAAAA,MAAA,OAAKF,UAAU,iBAAgBC,SAAA,EAC7BF,EAAAA,EAAAA,KAAA,UACEI,QAAS4lC,GACT/lC,UAAU,uEAAsEC,SACjF,aAGDF,EAAAA,EAAAA,KAAA,UACEI,QAASwmC,GACT3mC,UAAU,qEAAoEC,SAC/E,oBAMLF,EAAAA,EAAAA,KAAA,OACEC,UAAU,oFACVG,QAASA,IAxvDHinB,KAChC,MAAMvnB,EAAOshB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOkoB,GACtC,IAAKvnB,EAAM,OAGX,MAAMinC,EAAqBjnC,EAAKimB,aAAalmB,IAAIqmB,IAC/C,MAAM4F,EAAW1K,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAO+mB,GAC1C,OAAO4F,EAAWxhB,SAASwhB,EAAShrB,SAAW,OAC9CI,OAAO6qB,SAEV4B,EAAe,CAAEtG,SAAQ3nB,MAAO,iBAChCmuB,EAAgBkZ,EAAmBpsB,KAAK,OACxC/O,QAAQC,IAAI,+CAADzH,OAAsCtE,EAAKgB,QAAO,oCAAAsD,OAAgC2iC,EAAmBpsB,KAAK,MAAK,OA4uDjFq0B,CAAyBlvC,EAAKX,IAC7CwJ,MAAM,iCAAgCzI,UAEtCF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,sCAAqCC,SACjDJ,EAAKimB,aAAaplB,OAAS,GAC1BX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,uBAAsBC,SAClCJ,EAAKimB,aAAalmB,IAAIqmB,IAErB,MAAM4F,EAAW1K,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAO+mB,GAGpC+oB,EAAanjB,EAAWxhB,SAASwhB,EAAShrB,SAAWolB,EAE3D,OACElmB,EAAAA,EAAAA,KAAA,QAEEC,UAAU,uEAAsEC,SAE/E+uC,GAHI/oB,QASblmB,EAAAA,EAAAA,KAAA,QAAMC,UAAU,gBAAeC,SAAC,6BA/VrCJ,EAAKX,aA6WxBa,EAAAA,EAAAA,KAAA,OAAKC,UAAU,iCAAgCC,UAC7CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,gDAA+CC,SAAA,EAC5DC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,4BAA2BC,SAAC,mBAC5CF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,qBAAoBC,SAAEyzB,GAAahzB,aAErDR,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,4BAA2BC,SAAC,wBAC5CC,EAAAA,EAAAA,MAAA,QAAMF,UAAU,qBAAoBC,SAAA,CAAEyzB,GAAa/tB,OAAO,CAACC,EAAK/F,IAAS+F,EAAM/F,EAAK0M,SAAU,GAAG,kBAEnGrM,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,4BAA2BC,SAAC,wBAC5CC,EAAAA,EAAAA,MAAA,QAAMF,UAAU,qBAAoBC,SAAA,CACjCiK,KAAK8B,MAAM0nB,GAAa/tB,OAAO,CAACC,EAAK/F,IAAS+F,EAAM/F,EAAKuZ,SAAU,GAAKsa,GAAahzB,QAAQ,WAGlGR,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,4BAA2BC,SAAC,kBAC5CC,EAAAA,EAAAA,MAAA,QAAMF,UAAU,qBAAoBC,SAAA,CAAC,IACjCyzB,GAAa/tB,OAAO,CAACC,EAAK/F,IAAS+F,EAAM/F,EAAK2mB,KAAM,GAAGrf,wBAG7DjH,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,8BAA6BC,SAAC,+BAC9CC,EAAAA,EAAAA,MAAA,QAAMF,UAAU,qCAAoCC,SAAA,CAAC,IACjDyzB,GAAa/tB,OAAO,CAACC,EAAK/F,IAAS+F,GAAO/F,EAAK6hB,eAAiB,GAAI,GAAGva,+BASvE,UAAbomB,IACCrtB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,qBAAoBC,SAAC,oBACnCF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,yDAAwDC,UACrEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oDAAmDC,SAAA,EAChEF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,wBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,uDAMZC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,iBAAgBC,SAAA,EAC7BC,EAAAA,EAAAA,MAAA,UAAQR,MAAO0uB,GAAYhuB,SAAWC,GAAMguB,GAAchuB,EAAEC,OAAOZ,OAAQM,UAAU,8BAA6BC,SAAA,EAChHF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,OAAMO,SAAC,aACrBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,QAAOO,SAAC,aACtBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,SAAQO,SAAC,cAGzBF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAM0uB,IAAiBD,IAChC5uB,UAAS,uDAAAmE,OAAyDyqB,GAC9D,6CACA,+CAEJpoB,SAAmC,IAAzBkoB,GAAchuB,OAAaT,SACtC,cAIDC,EAAAA,EAAAA,MAAA,UACEC,QAv6CO8uC,KACnB,IAEE,MAAMC,EAAexb,GAAa9zB,IAAIC,IAAI,CACxCX,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU1M,EAAK0M,SACf9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf1M,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjB2Y,KAAM3mB,EAAK2mB,KACXV,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCC,WAAY,IAAKlmB,EAAKkmB,YAAc,IACpC1W,YAAaxP,EAAKwP,YAClBoX,iBAAkB5mB,EAAK4mB,iBACvB7jB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClC5R,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBd,WAAYhmB,EAAKgmB,WACjBspB,MAAOtvC,EAAKsvC,SAGdxgB,GAAiBugB,GACjBrgB,IAAgB,GAChB1tB,MAAM,iCACR,CAAE,MAAOuN,GACP/C,QAAQ+C,MAAM,6BAA8BA,GAC5CvN,MAAM,4DACR,GAs4CYnB,UAAU,gGAA+FC,SAAA,EAEzGF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,4BAKVF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,iBAAgBC,UAC7BC,EAAAA,EAAAA,MAAA,UACEC,QAAS84B,GACTj5B,UAAU,gGACV0I,MAAM,sEAAkEzI,SAAA,EAExEF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,6CAMZC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wDAAuDC,SAAA,EAEpEF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,0CAAyCC,UACtDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yDAAwDC,SAAA,EACrEF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,OAAMC,SAAC,kBACvBF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,2EAGVC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,OAAMC,SAAA,EAEnBF,EAAAA,EAAAA,KAAA,OACEwqC,IAAK9X,GACL2c,SAzxKQ/uC,IAChBqyB,GAAShT,UAASgT,GAAShT,QAAQ2vB,UAAYhvC,EAAEivC,cAAcD,YAyxKvDrvC,UAAU,2CACVkN,MAAO,CAAEkpB,OAAQ,SAAUn2B,UAE3BC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,MAAKC,SAAA,EAClBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,oCAAmCC,SAAC,yBACnDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wBAAuBC,SAAA,CAAEyzB,GAAahzB,OAAO,gBAG7D+mC,KAAoB7nC,IAAI,CAACC,EAAM4I,KAC9B1I,EAAAA,EAAAA,KAAA,OAAmBC,UAAU,OAAMC,UAEjCC,EAAAA,EAAAA,MAAA,OACEF,UAAS,6EAAAmE,QAA2F,OAAZgpB,QAAY,IAAZA,OAAY,EAAZA,EAAcjuB,MAAOW,EAAKX,GAC9G,4CACA,wDAEJiB,QAASA,KACPwL,QAAQC,IAAI,iEAAqD,CAC/Dwb,OAAQvnB,EAAKX,GACb4jC,OAAQjjC,EAAKiB,KACbyuC,cAAe1vC,IAEjButB,EAAgBvtB,IAElBqN,MAAO,CAAEkpB,OAAQxT,GAAQ3iB,SAAA,EAEzBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,iBAAgBC,SAAA,EAE7BC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kDAAiDC,SAAA,CAC7DJ,EAAKiB,KACLjB,EAAKwP,cAAetP,EAAAA,EAAAA,KAAA,QAAMC,UAAU,+BAA8BC,SAAC,oBAIrEJ,EAAKgmB,aACJ9lB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,mCAAkCC,SAAC,qCAOrDJ,EAAKgmB,aACJ9lB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,OAAMC,UACnBF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,sEAAqEC,SAAC,kCAnCpFJ,EAAKX,MA8CjBgB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,sDAAqDC,SAAA,EAClEF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,yCAAwCC,SAAC,aACxDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kCAAiCC,SAAA,EAC9CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,uBAAsBC,SAAA,EACnCF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,qBACNC,EAAAA,EAAAA,MAAA,QAAMF,UAAU,cAAaC,SAAA,CAAEwpB,GAAe4X,mBAAmB,WAEnEnhC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,uBAAsBC,SAAA,EACnCF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,yBACNF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,2BAA0BC,SAAEwpB,GAAerB,oBAE7DloB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,uBAAsBC,SAAA,EACnCF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,kBACNF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,6BAA4BC,SAAEwpB,GAAekD,gCAQvEzsB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kCAAkCkN,MAAO,CAAEkpB,OAAQ,QAASoZ,SAAU,uBAAwBvvC,SAAA,EAE3GF,EAAAA,EAAAA,KAAA,OACEC,UAAU,yCACVkN,MAAO,CACLuiC,gBAAiB,UACjBC,aAAc,qBACdzvC,UAEFF,EAAAA,EAAAA,KAAA,OACEwqC,IAAKxS,GACLqX,SA31KM/uC,IAElBqyB,GAAShT,UAAYsY,GAAYtY,UACnCsY,GAAYtY,SAAU,EACtB/T,QAAQC,IAAI,qDAA4CvL,EAAEivC,cAAcK,YACxEhkC,QAAQC,IAAI,oDAA2C,CACrDgkC,qBAAsBvvC,EAAEivC,cAAcO,YACtCC,2BAA4BzvC,EAAEivC,cAAcS,YAC5CC,oBAAqBtd,GAAShT,QAAQmwB,YACtCI,0BAA2Bvd,GAAShT,QAAQqwB,YAC5ClP,aAAcA,KAEhBnO,GAAShT,QAAQiwB,WAAatvC,EAAEivC,cAAcK,WAC9ChvB,WAAW,KAAQqX,GAAYtY,SAAU,GAAU,MA+0KrC1f,UAAU,mFACVkN,MAAO,CACLsR,MAAO,OACPgxB,SAAU,QACVvvC,UAEFF,EAAAA,EAAAA,KAAA,OACEC,UAAU,OACVkN,MAAO,CACLsR,MAAOtU,KAAKO,IAAIo2B,GAAe,IAAK,KACpC4K,SAAUvhC,KAAKO,IAAIo2B,GAAe,IAAK,MACvC5gC,SAnjCUiwC,MAC9B,MAAMtN,EAAU,GAEVuN,EAAiBlJ,GACjB9hB,EAAQ,IAAI3jB,KAAK2uC,GACjB3qB,EAAM,IAAIhkB,KAAKqiB,EAAMsb,GAAa3Z,MAexC,GAZA7Z,QAAQC,IAAI,uCAA8B,CACxCnH,UAAWof,EAAMsB,GACjBzgB,QAASmf,EAAM2B,GACf4I,WAAYA,GACZsZ,kBAAmB7jB,EAAMsb,GAAaha,OACtCirB,gBAAiBvsB,EAAMsb,GAAa3Z,KACpCN,gBAAiBA,EACjBirB,eAAgBtsB,EAAMssB,GACtBvP,SAAUA,GACVC,aAAcA,KAGG,SAAfzS,GAAuB,CACzB,MAAMiiB,EAAM,IAAI7uC,KAAK2jB,GACrB,KAAOkrB,GAAO7qB,IAERN,GAAmBd,EAAaisB,KAClCzN,EAAQhzB,KAAK,CACXnN,MAAO4tC,EAAIn8B,UACXo8B,IAAKD,EAAI1iC,mBAAmB,KAAM,CAAEy3B,MAAO,UAC3C5mB,MAAOoiB,KAGXyP,EAAIp8B,QAAQo8B,EAAIn8B,UAAY,EAEhC,MAAO,GAAmB,UAAfka,GAAwB,CACjC,MAAMiiB,EAAM,IAAI7uC,KAAK2jB,GACrB,KAAOkrB,GAAO7qB,GAAK,CACjB,MAAM+qB,EAAa,IAAI/uC,KAAK6uC,GACtBG,EAAW,IAAIhvC,KAAK6uC,GAC1BG,EAASv8B,QAAQu8B,EAASt8B,UAAY,GACtC,MAAMu8B,EAAYvmC,KAAKE,IAAI,EAAGua,EAAkB4rB,EAAYhsB,EAAQiB,EAAK,EAAGN,GAAkBA,IAC9F0d,EAAQhzB,KAAK,CACXnN,MAAM,KAAD0B,OAAOosC,EAAWr8B,UAAS,UAAA/P,OAAIqsC,EAASt8B,WAC7Co8B,IAAKC,EAAW5iC,mBAAmB,KAAM,CAAEy3B,MAAO,UAClD5mB,MAAOiyB,EAAY7P,KAErByP,EAAIp8B,QAAQo8B,EAAIn8B,UAAY,EAC9B,CACF,KAAO,CACL,MAAMm8B,EAAM,IAAI7uC,KAAK2jB,EAAMxB,cAAewB,EAAM4kB,WAAY,GAC5D,KAAOsG,GAAO7qB,GAAK,CACjB,MAAM+O,EAAO,IAAI/yB,KAAK6uC,EAAI1sB,cAAe0sB,EAAItG,WAAa,EAAG,GACvD2G,EAAW/rB,EAAkBd,EAAMwsB,GAAMxsB,EAAM0Q,GAAOrP,GAC5D0d,EAAQhzB,KAAK,CACXnN,MAAO4tC,EAAI1iC,mBAAmB,KAAM,CAAEy3B,MAAO,UAC7CkL,IAAKD,EAAI1sB,cACTnF,MAAOkyB,EAAW9P,KAEpByP,EAAIM,SAASN,EAAItG,WAAa,EAChC,CACF,CAUA,OAPAp+B,QAAQC,IAAI,2CAAkC,CAC5CglC,aAAchO,EAAQliC,OACtBmwC,WAAYjO,EAAQj9B,OAAO,CAACC,EAAKo9B,IAAMp9B,EAAMo9B,EAAExkB,MAAO,GACtDsyB,YAAalO,EAAQ,GACrBmO,WAAYnO,EAAQA,EAAQliC,OAAS,KAGhCkiC,GAg/BYsN,GAA0BtwC,IAAI,CAAC+iC,EAAQl6B,KACtCvI,EAAAA,EAAAA,MAAA,OAEEF,UAAU,2EACVkN,MAAO,CAAEsR,MAAOmkB,EAAOnkB,MAAOitB,SAAU9I,EAAOnkB,OAAQve,SAAA,EAEvDF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,cAAaC,SAAE0iC,EAAOlgC,SACrC1C,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAE0iC,EAAO2N,QALlC7nC,WAaf1I,EAAAA,EAAAA,KAAA,OACEwqC,IAAK7X,GACL0c,SA74KO/uC,IACjBoyB,GAAQ/S,UAAS+S,GAAQ/S,QAAQ2vB,UAAYhvC,EAAEivC,cAAcD,WAG7DtX,GAAUrY,UAAYsY,GAAYtY,UACpCsY,GAAYtY,SAAU,EACtB/T,QAAQC,IAAI,mDAA0CvL,EAAEivC,cAAcK,YACtEhkC,QAAQC,IAAI,oCAA2B,CACrCgkC,qBAAsB7X,GAAUrY,QAAQmwB,YACxCC,2BAA4B/X,GAAUrY,QAAQqwB,YAC9CC,oBAAqB3vC,EAAEivC,cAAcO,YACrCI,0BAA2B5vC,EAAEivC,cAAcS,YAC3ClP,aAAcA,KAEhB9I,GAAUrY,QAAQiwB,WAAatvC,EAAEivC,cAAcK,WAC/ChvB,WAAW,KAAQqX,GAAYtY,SAAU,GAAU,MA+3KvC1f,UAAU,0GAAyGC,UAEnHF,EAAAA,EAAAA,KAAA,OAAKmN,MAAO,CAAEsR,MAAOtU,KAAKO,IAAIo2B,GAAe,IAAK,MAAO5gC,UAGvDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,WAAUC,SAAA,CAEtBunC,GAAc,GAAKA,GAAc3G,KAChC9gC,EAAAA,EAAAA,KAAA,OACEC,UAAU,iCACVkN,MAAO,CACL8jC,KAAMxJ,GACNyJ,IAAK,EACL7a,OAAQ,SACRn2B,UAEFF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gEAA+DC,SAAC,UAKlFwnC,KAAoB7nC,IAAI,CAACC,EAAM4I,KAC9BvI,EAAAA,EAAAA,MAAA,OAEEF,UAAU,WACVkN,MAAO,CACL8jC,KAAMnxC,EAAKqoC,OACX+I,IAAU,GAALxoC,ELj/MN,GKi/M0C,EACzC+V,MAAO3e,EAAKsoC,QACZ/R,OAAQxT,IACR3iB,SAAA,EAGFC,EAAAA,EAAAA,MAAA,OACEF,UAAS,mEAAAmE,OAAqEtE,EAAKwP,YAAc,eAAiB,cAElH3G,MAAM,4CACNwE,MAAO,CACLsR,MAAO3e,EAAKwP,YAAc,OAAS,OACnC+mB,OAAQ,OACR8a,WAAYrxC,EAAKwP,YACb,2CACAxP,EAAKgmB,YAAcyI,GACjB,2CACAzuB,EAAKgmB,WACH,2CACA,2CACRsrB,OAAQtxC,EAAKgmB,YAAcyI,GAAmB,oBAAsB,OACpE8iB,UAAWvxC,EAAKgmB,YAAcyI,GAAmB,kCAAoC,QACrFruB,SAAA,EAGFF,EAAAA,EAAAA,KAAA,OACEC,UAAU,4DACVkN,MAAO,CACLsR,MAAM,GAADra,OAAKtE,EAAKuZ,SAAQ,KACvB83B,WAAY,+CAKhBnxC,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wFAAuFC,UACpGF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,WAAUC,SAAEJ,EAAKiB,YAKpC8tB,IAAgBiE,GAAaxf,IAAIxT,EAAKX,MACrCa,EAAAA,EAAAA,KAAA,OACEC,UAAU,0EACVkN,MAAO,CACL8jC,KAAK,GAAD7sC,OAAMwgB,EAAkBd,EAAMsb,GAAaha,OAAQ0N,GAAa9e,IAAIlU,EAAKX,IAAIuF,UAAWygB,GAAmB0b,GAAQ,MACvHpiB,MAAM,GAADra,OAAK+F,KAAKO,IAAI,EAAG8a,EAAsBsN,GAAa9e,IAAIlU,EAAKX,IAAIuF,UAAWouB,GAAa9e,IAAIlU,EAAKX,IAAIwF,QAASwgB,GAAmB0b,IAAS,MAChJwQ,UAAW,mCAMhB5iB,IAAoB3uB,EAAKimB,aAAaplB,OAAS,IAC9CX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gCAA+BC,SAC3CJ,EAAKimB,aAAalmB,IAAI,CAACqmB,EAAQorB,KAE9B,IADa3d,GAAa1vB,KAAKW,GAAKA,EAAEzF,KAAO+mB,GAClC,OAAO,KAElB,MAAMqrB,EAAU7J,KAAoBzjC,KAAKW,GAAKA,EAAEzF,KAAO+mB,GACvD,IAAKqrB,EAAS,OAAO,KAErB,MAAMC,EAASD,EAAQpJ,OAASoJ,EAAQnJ,QAClCqJ,EAAqD,GAA5C9d,GAAaqP,UAAUp+B,GAAKA,EAAEzF,KAAO+mB,GL/iNzD,GK+iN+F,EAAI,GACxFwrB,EAAO5xC,EAAKqoC,OACZwJ,EAAY,GAALjpC,ELjjNlB,GKijNsD,EAAI,GAErD,OACEvI,EAAAA,EAAAA,MAAA,OAEEF,UAAU,+BACVkN,MAAO,CACL8jC,KAAM,EACNC,IAAK,EACLzyB,MAAO,OACP4X,OAAQ,QACRn2B,SAAA,EAEFF,EAAAA,EAAAA,KAAA,QAAAE,UACEF,EAAAA,EAAAA,KAAA,UACEb,GAAE,SAAAiF,OAAWtE,EAAKX,GAAE,KAAAiF,OAAI8hB,GACxB0rB,YAAY,KACZC,aAAa,KACbC,KAAK,IACLC,KAAK,IACLC,OAAO,OACPC,YAAY,cAAa/xC,UAEzBF,EAAAA,EAAAA,KAAA,WACEkyC,OAAO,cACPC,KAAMryC,EAAKgmB,WAAa,UAAY,iBAI1C9lB,EAAAA,EAAAA,KAAA,QACEoyC,GAAIZ,EACJa,GAAIZ,EACJa,GAAIZ,EACJa,GAAIZ,EACJa,OAAQ1yC,EAAKgmB,WAAa,UAAY,UACtC2sB,YAAY,IACZC,UAAS,cAAAtuC,OAAgBtE,EAAKX,GAAE,KAAAiF,OAAI8hB,EAAM,KAC1CysB,gBAAiB7yC,EAAKgmB,WAAa,OAAS,UAjCzCwrB,SAxEVxxC,EAAKX,yBA4H7B,EAilBa,YAAbquB,IACCrtB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,+CAA8CC,SAAA,EAC3DC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAAC,oCACjDC,EAAAA,EAAAA,MAAA,UACEC,QAASmlC,GACTtlC,UAAU,0HAAyHC,SAAA,EAEnIF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,YACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,uBAITuvB,IACCzvB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,oBAAmBC,UAChCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,EACzCF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,iFACfD,EAAAA,EAAAA,KAAA,MAAIC,UAAU,2CAA0CC,SAAC,yBACzDC,EAAAA,EAAAA,MAAA,KAAGF,UAAU,gBAAeC,SAAA,CAAC,0BAAwBqhB,EAAc,WAAa,uBAG1D,IAAxBgO,GAAa5uB,QACfX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,oBAAmBC,UAChCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6BAA4BC,SAAA,EACzCF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,sBAAqBC,SAAC,kBACtCF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,2CAA0CC,SAAC,8BACzDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,qBAAoBC,SAAC,4DAClCF,EAAAA,EAAAA,KAAA,UACEI,QAASmlC,GACTtlC,UAAU,oFAAmFC,SAC9F,sCAMLC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,CAEvBkhB,EAAMlgB,OAAOpB,GAAQA,EAAKwP,aAAazP,IAAIgB,IAC1C,MAAM+xC,EAAgBrjB,GAAaruB,OAAO9B,GAASA,EAAMG,SAAWsB,EAAK1B,IAEzE,OAA6B,IAAzByzC,EAAcjyC,OAAqB,MAGrCR,EAAAA,EAAAA,MAAA,OAAmBF,UAAU,oDAAmDC,SAAA,EAC9EF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gDAA+CC,UAC5DC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,8BAA6BC,SAAA,CAAC,gBACtCW,EAAKC,QAAQ,MAAID,EAAKE,WAI9Bf,EAAAA,EAAAA,KAAA,OAAKC,UAAU,kBAAiBC,UAC9BC,EAAAA,EAAAA,MAAA,SAAOF,UAAU,SAAQC,SAAA,EACvBF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,aAAYC,UAC3BC,EAAAA,EAAAA,MAAA,MAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,WAC5EF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,iBAC5EF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,WAC5EF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,aAC5EF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,YAC5EF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,mBAGhFF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,2BAA0BC,SACxC0yC,EACEp+B,KAAK,CAAC9H,EAAG+H,IAAM,IAAIhT,KAAKiL,EAAEpN,OAAS,IAAImC,KAAKgT,EAAEnV,QAC9CO,IAAI,CAACT,EAAOsJ,KACXvI,EAAAA,EAAAA,MAAA,MAAmBF,UAAU,mBAAkBC,SAAA,EAC7CF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,kCAAiCC,SAAEd,EAAMA,SACvDY,EAAAA,EAAAA,KAAA,MAAIC,UAAU,kCAAiCC,SAAEd,EAAMC,eACvDW,EAAAA,EAAAA,KAAA,MAAIC,UAAU,kCAAiCC,SAC5C,MACC,IACE,MAAMZ,EAAQ,IAAImC,KAAKrC,EAAME,OAC7B,OAAOgkB,MAAMhkB,EAAMokB,WAAa,oBAAmBpkB,EAAMsO,mBAAmB,QAC9E,CAAE,MAAOe,GACP,MAAO,mBACT,CACD,EAPA,MASH3O,EAAAA,EAAAA,KAAA,MAAIC,UAAU,oBAAmBC,UAC/BC,EAAAA,EAAAA,MAAA,UACER,MAAOP,EAAMuC,QACbtB,SAAUyd,UACR,MAAM+0B,EAAYvyC,EAAEC,OAAOZ,MAe3B,GAZA6vB,GAAgB5vB,IACd,MAAMonB,EAAepnB,EAAKC,IAAI+E,GAAKA,EAAEzF,KAAOC,EAAMD,IAAEY,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ6E,GAAC,IAAEjD,QAASkxC,IAAcjuC,GAOtF,OAJI2mB,GACFA,EAAgC,OAAXlK,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GAAI6nB,GAGjCA,IAILzF,EACF,IACE,MAAM1O,QAAeyO,EAAAA,QAAgBwxB,mBAAmB1zC,EAAMD,GAAI0zC,GAC7DhgC,EAAO4kB,SAQV7rB,QAAQC,IAAI,sDAA6C,CAAEknC,QAAS3zC,EAAMD,GAAI0zC,cAC9E/yB,OAAOC,cAAc,IAAIC,YAAY,sBAAuB,CAC1DC,OAAQ,CACN8yB,QAAS3zC,EAAMD,GACf0zC,YACAj5B,UAAsB,OAAXyH,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GACxB+gB,UAAWze,KAAK+E,UAKpBoF,QAAQC,IAAI,8DACZiU,OAAOC,cAAc,IAAIC,YAAY,kBAAmB,CACtDC,OAAQ,CACNqoB,OAAQ,eACR15B,KAAM,CAAE2gB,aAAcA,UAtB1B3jB,QAAQ+C,MAAM,iDAA6CkE,EAAOlE,OAElE6gB,GAAgB5vB,GACdA,EAAKC,IAAI+E,GAAKA,EAAEzF,KAAOC,EAAMD,IAAEY,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ6E,GAAC,IAAEjD,QAASkxC,IAAcjuC,IAuBvE,CAAE,MAAO+J,GACP/C,QAAQ+C,MAAM,qCAAiCA,EACjD,MAGA/C,QAAQC,IAAI,mEAA0D,CAAEknC,QAAS3zC,EAAMD,GAAI0zC,cAC3F/yB,OAAOC,cAAc,IAAIC,YAAY,sBAAuB,CAC1DC,OAAQ,CACN8yB,QAAS3zC,EAAMD,GACf0zC,YACAj5B,UAAsB,OAAXyH,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GACxB+gB,UAAWze,KAAK+E,UAKpBsZ,OAAOC,cAAc,IAAIC,YAAY,kBAAmB,CACtDC,OAAQ,CACNqoB,OAAQ,eACR15B,KAAM,CAAE2gB,aAAcA,SAK9BtvB,UAAS,0DAAAmE,OAA8E,cAAlBhF,EAAMuC,QAA0B,gCACjF,eAAlBvC,EAAMuC,QAA2B,4BAC/B,+BACCzB,SAAA,EAELF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,YAAWO,SAAC,eAC1BF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,aAAYO,SAAC,gBAC3BF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,aAAYO,SAAC,qBAG/BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,kCAAiCC,SAC5C,MACC,IACE,MAAMZ,EAAQ,IAAImC,KAAKrC,EAAMoC,eAC7B,OAAO8hB,MAAMhkB,EAAMokB,WAAa,oBAAmBpkB,EAAMsO,mBAAmB,QAC9E,CAAE,MAAOe,GACP,MAAO,mBACT,CACD,EAPA,MASH3O,EAAAA,EAAAA,KAAA,MAAIC,UAAU,oBAAmBC,UAC/BF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMolC,GAAiBpmC,GAChCa,UAAU,sDACV0I,MAAM,gBAAezI,SACtB,4BA/GId,EAAMD,cAvBjB0B,EAAK1B,MAqJKowB,GAAaruB,OAAO9B,IACxC,IAAKA,EAAMG,OAAQ,OAAO,EAC1B,MAAMyzC,EAAiB5xB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOC,EAAMG,QAAUqF,EAAE0K,aAKlE,OAJK0jC,IACHpnC,QAAQC,IAAI,6BAADzH,OAAoBhF,EAAMD,GAAE,gBAAAiF,OAAehF,EAAMG,OAAM,0BAClEqM,QAAQC,IAAI,yCAAgCuV,EAAMlgB,OAAO0D,GAAKA,EAAE0K,aAAazP,IAAIojC,IAAC,CAAO9jC,GAAI8jC,EAAE9jC,GAAI4B,KAAMkiC,EAAEliC,WAErGiyC,IAEWryC,OAAS,IAE5BR,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oDAAmDC,SAAA,EAChEF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gDAA+CC,UAC5DF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8BAA6BC,SAAC,sCAG9CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,kBAAiBC,UAC9BC,EAAAA,EAAAA,MAAA,SAAOF,UAAU,SAAQC,SAAA,EACvBF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,aAAYC,UAC3BC,EAAAA,EAAAA,MAAA,MAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,WAC5EF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,iBAC5EF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,WAC5EF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,aAC5EF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,YAC5EF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,mBAGhFF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,2BAA0BC,SACxCqvB,GACEruB,OAAO9B,IACN,IAAKA,EAAMG,OAAQ,OAAO,EAE1B,OADuB6hB,EAAMnd,KAAKW,GAAKA,EAAEzF,KAAOC,EAAMG,QAAUqF,EAAE0K,eAGnEkF,KAAK,CAAC9H,EAAG+H,IAAM,IAAIhT,KAAKiL,EAAEpN,OAAS,IAAImC,KAAKgT,EAAEnV,QAC9CO,IAAKT,IACJe,EAAAA,EAAAA,MAAA,MAAmBF,UAAU,mBAAkBC,SAAA,EAC7CF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,kCAAiCC,SAAEd,EAAMA,SACvDY,EAAAA,EAAAA,KAAA,MAAIC,UAAU,kCAAiCC,SAAEd,EAAMC,eACvDW,EAAAA,EAAAA,KAAA,MAAIC,UAAU,kCAAiCC,SAC5C,MACC,IACE,MAAMZ,EAAQ,IAAImC,KAAKrC,EAAME,OAC7B,OAAOgkB,MAAMhkB,EAAMokB,WAAa,oBAAmBpkB,EAAMsO,mBAAmB,QAC9E,CAAE,MAAOe,GACP,MAAO,mBACT,CACD,EAPA,MASH3O,EAAAA,EAAAA,KAAA,MAAIC,UAAU,oBAAmBC,UAC/BC,EAAAA,EAAAA,MAAA,UACER,MAAOP,EAAMuC,QACbtB,SAAUyd,UACR,MAAM+0B,EAAYvyC,EAAEC,OAAOZ,MAQ3B,GALA6vB,GAAgB5vB,GACdA,EAAKC,IAAI+E,GAAKA,EAAEzF,KAAOC,EAAMD,IAAEY,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ6E,GAAC,IAAEjD,QAASkxC,IAAcjuC,IAI/D2c,EACF,IACE,MAAM1O,QAAeyO,EAAAA,QAAgBwxB,mBAAmB1zC,EAAMD,GAAI0zC,GAC7DhgC,EAAO4kB,SAQV7rB,QAAQC,IAAI,gEAAuD,CAAEknC,QAAS3zC,EAAMD,GAAI0zC,cACxF/yB,OAAOC,cAAc,IAAIC,YAAY,sBAAuB,CAC1DC,OAAQ,CACN8yB,QAAS3zC,EAAMD,GACf0zC,YACAj5B,UAAsB,OAAXyH,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GACxB+gB,UAAWze,KAAK+E,UAKpBsZ,OAAOC,cAAc,IAAIC,YAAY,kBAAmB,CACtDC,OAAQ,CACNqoB,OAAQ,eACR15B,KAAM,CAAE2gB,aAAcA,UArB1B3jB,QAAQ+C,MAAM,iDAA6CkE,EAAOlE,OAElE6gB,GAAgB5vB,GACdA,EAAKC,IAAI+E,GAAKA,EAAEzF,KAAOC,EAAMD,IAAEY,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ6E,GAAC,IAAEjD,QAASkxC,IAAcjuC,IAsBvE,CAAE,MAAO+J,GACP/C,QAAQ+C,MAAM,qCAAiCA,EACjD,MAGA/C,QAAQC,IAAI,4EAAmE,CAAEknC,QAAS3zC,EAAMD,GAAI0zC,cACpG/yB,OAAOC,cAAc,IAAIC,YAAY,sBAAuB,CAC1DC,OAAQ,CACN8yB,QAAS3zC,EAAMD,GACf0zC,YACAj5B,UAAsB,OAAXyH,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GACxB+gB,UAAWze,KAAK+E,UAKpBsZ,OAAOC,cAAc,IAAIC,YAAY,kBAAmB,CACtDC,OAAQ,CACNqoB,OAAQ,eACR15B,KAAM,CAAE2gB,aAAcA,SAK9BtvB,UAAS,0DAAAmE,OAA8E,cAAlBhF,EAAMuC,QAA0B,gCACjF,eAAlBvC,EAAMuC,QAA2B,4BAC/B,+BACCzB,SAAA,EAELF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,YAAWO,SAAC,eAC1BF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,aAAYO,SAAC,gBAC3BF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,aAAYO,SAAC,qBAG/BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,kCAAiCC,SAC5C,MACC,IACE,MAAMZ,EAAQ,IAAImC,KAAKrC,EAAMoC,eAC7B,OAAO8hB,MAAMhkB,EAAMokB,WAAa,oBAAmBpkB,EAAMsO,mBAAmB,QAC9E,CAAE,MAAOe,GACP,MAAO,mBACT,CACD,EAPA,MASH3O,EAAAA,EAAAA,KAAA,MAAIC,UAAU,oBAAmBC,UAC/BF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMolC,GAAiBpmC,GAChCa,UAAU,sDACV0I,MAAM,gBAAezI,SACtB,4BAvGId,EAAMD,qBAwHtCiuB,GAA6B,UAAbI,IACfxtB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6EAA4EC,UACzFC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,oDAAmDC,SAAA,EAChEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,kCAAiCC,SAAC,qCAChDF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMitB,EAAgB,MAC/BptB,UAAU,6CAA4CC,SACvD,eAKHC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,cAAaC,SAAA,EAC1BF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAC,wBAC/BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,2CAA0CC,SACrDktB,EAAarsB,QAEhBf,EAAAA,EAAAA,KAAA,KAAGC,UAAU,qBAAoBC,SAAC,0DAGlCC,EAAAA,EAAAA,MAAA,KAAGF,UAAU,6BAA4BC,SAAA,CAAC,wCACJF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,gBAAoB,QAGlEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,iBAAgBC,SAAA,EAC7BF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMqtB,EAAY,SAC3BxtB,UAAU,6FAA4FC,SACvG,mCAGDF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMitB,EAAgB,MAC/BptB,UAAU,+FAA8FC,SACzG,sBAUVktB,GAA6B,UAAbI,IACfxtB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6EAA4EC,UACzFC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kFAAiFC,SAAA,EAC9FC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,qBAAoBC,SAAEktB,EAAarsB,QACjDf,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMitB,EAAgB,MAC/BptB,UAAU,6CAA4CC,SACvD,eAKHC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EAEpDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,6BAA4BC,SAAC,8BAE3CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,wBAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOytB,EAAarsB,KACpBV,SAAWC,GAAM+sB,EAAgBztB,IAAI,CACnCT,GAAIS,EAAKT,GACT2B,QAASlB,EAAKkB,QACdC,KAAMT,EAAEC,OAAOZ,MACf6M,SAAU5M,EAAK4M,SACf9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd0U,SAAUzZ,EAAKyZ,SACf0M,aAAc,IAAKnmB,EAAKmmB,cAAgB,IACxCU,KAAM7mB,EAAK6mB,KACX9Z,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjBwB,YAAa1P,EAAK0P,YAClBwW,WAAYlmB,EAAKkmB,WACjBY,iBAAkB9mB,EAAK8mB,iBACvBrS,WAAYzU,EAAKyU,WACjBC,YAAa1U,EAAK0U,YAClBqS,UAAW/mB,EAAK+mB,UAChBC,WAAYhnB,EAAKgnB,WACjBC,WAAYjnB,EAAKinB,WACjBC,UAAWlnB,EAAKknB,UAChBjkB,YAAajD,EAAKiD,YAClBojB,UAAW,IAAKrmB,EAAKqmB,WAAa,IAClCc,cAAennB,EAAKmnB,cACpBzN,OAAQ1Z,EAAK0Z,OACb0M,WAAY,IAAKpmB,EAAKomB,YAAc,OAEtC/lB,UAAU,iHAIdE,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,2BAGhEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMitB,EAAgBztB,IAAI,CACjCT,GAAIS,EAAKT,GACT2B,QAASlB,EAAKkB,QACdC,KAAMnB,EAAKmB,KACXyL,SAAUrC,KAAKO,IAAI,EAAG9K,EAAK4M,SAAW,GACtC9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd0U,SAAUzZ,EAAKyZ,SACf0M,aAAc,IAAKnmB,EAAKmmB,cAAgB,IACxCU,KAAM7mB,EAAK6mB,KACX9Z,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjBwB,YAAa1P,EAAK0P,YAClBwW,WAAYlmB,EAAKkmB,WACjBY,iBAAkB9mB,EAAK8mB,iBACvBrS,WAAYzU,EAAKyU,WACjBC,YAAa1U,EAAK0U,YAClBqS,UAAW/mB,EAAK+mB,UAChBC,WAAYhnB,EAAKgnB,WACjBC,WAAYjnB,EAAKinB,WACjBC,UAAWlnB,EAAKknB,UAChBjkB,YAAajD,EAAKiD,YAClBojB,UAAW,IAAKrmB,EAAKqmB,WAAa,IAClCc,cAAennB,EAAKmnB,cACpBzN,OAAQ1Z,EAAK0Z,OACb0M,WAAY,IAAKpmB,EAAKomB,YAAc,OAEtC/lB,UAAU,kDAAiDC,SAC5D,OAGDF,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACLjB,MAAOytB,EAAa5gB,SACpBnM,SAAWC,GAAM+sB,EAAgBztB,IAAI,CACnCT,GAAIS,EAAKT,GACT2B,QAASlB,EAAKkB,QACdC,KAAMnB,EAAKmB,KACXyL,SAAUlC,SAAShK,EAAEC,OAAOZ,QAAU,EACtC+E,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd0U,SAAUzZ,EAAKyZ,SACf0M,aAAc,IAAKnmB,EAAKmmB,cAAgB,IACxCU,KAAM7mB,EAAK6mB,KACX9Z,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjBwB,YAAa1P,EAAK0P,YAClBwW,WAAYlmB,EAAKkmB,WACjBY,iBAAkB9mB,EAAK8mB,iBACvBrS,WAAYzU,EAAKyU,WACjBC,YAAa1U,EAAK0U,YAClBqS,UAAW/mB,EAAK+mB,UAChBC,WAAYhnB,EAAKgnB,WACjBC,WAAYjnB,EAAKinB,WACjBC,UAAWlnB,EAAKknB,UAChBjkB,YAAajD,EAAKiD,YAClBojB,UAAW,IAAKrmB,EAAKqmB,WAAa,IAClCc,cAAennB,EAAKmnB,cACpBzN,OAAQ1Z,EAAK0Z,OACb0M,WAAY,IAAKpmB,EAAKomB,YAAc,OAEtC/lB,UAAU,qHACVoK,IAAI,OAENrK,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMitB,EAAgBztB,IAAI,CACjCT,GAAIS,EAAKT,GACT2B,QAASlB,EAAKkB,QACdC,KAAMnB,EAAKmB,KACXyL,SAAU5M,EAAK4M,SAAW,EAC1B9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd0U,SAAUzZ,EAAKyZ,SACf0M,aAAc,IAAKnmB,EAAKmmB,cAAgB,IACxCU,KAAM7mB,EAAK6mB,KACX9Z,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjBwB,YAAa1P,EAAK0P,YAClBwW,WAAYlmB,EAAKkmB,WACjBY,iBAAkB9mB,EAAK8mB,iBACvBrS,WAAYzU,EAAKyU,WACjBC,YAAa1U,EAAK0U,YAClBqS,UAAW/mB,EAAK+mB,UAChBC,WAAYhnB,EAAKgnB,WACjBC,WAAYjnB,EAAKinB,WACjBC,UAAWlnB,EAAKknB,UAChBjkB,YAAajD,EAAKiD,YAClBojB,UAAW,IAAKrmB,EAAKqmB,WAAa,IAClCc,cAAennB,EAAKmnB,cACpBzN,OAAQ1Z,EAAK0Z,OACb0M,WAAY,IAAKpmB,EAAKomB,YAAc,OAEtC/lB,UAAU,kDAAiDC,SAC5D,mBASTC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,6BAA4BC,SAAC,kBAG3CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,OAAMC,SAAA,EACnBC,EAAAA,EAAAA,MAAA,SAAOF,UAAU,+CAA8CC,SAAA,CAAC,kBACtB,QAAzB4qB,EAAAsC,EAAarH,oBAAY,IAAA+E,OAAA,EAAzBA,EAA2BnqB,SAAU,EAAE,QAIxDX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,2EAA0EC,SACtFkhB,EAAMlgB,OAAOpB,GAAQA,EAAKX,KAAOiuB,EAAajuB,IAAIU,IAAIC,IAAI,IAAAmzC,EAAA,OACzD9yC,EAAAA,EAAAA,MAAA,SAAqBF,UAAU,0EAAyEC,SAAA,EACtGF,EAAAA,EAAAA,KAAA,SACEY,KAAK,WACL2J,SAAkC,QAAzB0oC,EAAA7lB,EAAarH,oBAAY,IAAAktB,OAAA,EAAzBA,EAA2B1jC,SAASzP,EAAKX,OAAO,EACzDkB,SAAWC,IACT,MAAM4yC,EAAe9lB,EAAarH,cAAgB,GAC9CzlB,EAAEC,OAAOgK,QACX8iB,EAAgBztB,IAAI,CAClBT,GAAIS,EAAKT,GACT2B,QAASlB,EAAKkB,QACdC,KAAMnB,EAAKmB,KACXyL,SAAU5M,EAAK4M,SACf9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd0U,SAAUzZ,EAAKyZ,SACf0M,aAAc,IAAKmtB,GAAgB,GAAKpzC,EAAKX,IAC7CsnB,KAAM7mB,EAAK6mB,KACX9Z,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjBwB,YAAa1P,EAAK0P,YAClBwW,WAAYlmB,EAAKkmB,WACjBY,iBAAkB9mB,EAAK8mB,iBACvBrS,WAAYzU,EAAKyU,WACjBC,YAAa1U,EAAK0U,YAClBqS,UAAW/mB,EAAK+mB,UAChBC,WAAYhnB,EAAKgnB,WACjBC,WAAYjnB,EAAKinB,WACjBC,UAAWlnB,EAAKknB,UAChBjkB,YAAajD,EAAKiD,YAClBojB,UAAW,IAAKrmB,EAAKqmB,WAAa,IAClCc,cAAennB,EAAKmnB,cACpBzN,OAAQ1Z,EAAK0Z,OACb0M,WAAY,IAAKpmB,EAAKomB,YAAc,OAGtCqH,EAAgBztB,IAAI,CAClBT,GAAIS,EAAKT,GACT2B,QAASlB,EAAKkB,QACdC,KAAMnB,EAAKmB,KACXyL,SAAU5M,EAAK4M,SACf9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd0U,SAAUzZ,EAAKyZ,SACf0M,aAAcmtB,EAAahyC,OAAO/B,GAAMA,IAAOW,EAAKX,IACpDsnB,KAAM7mB,EAAK6mB,KACX9Z,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjBwB,YAAa1P,EAAK0P,YAClBwW,WAAYlmB,EAAKkmB,WACjBY,iBAAkB9mB,EAAK8mB,iBACvBrS,WAAYzU,EAAKyU,WACjBC,YAAa1U,EAAK0U,YAClBqS,UAAW/mB,EAAK+mB,UAChBC,WAAYhnB,EAAKgnB,WACjBC,WAAYjnB,EAAKinB,WACjBC,UAAWlnB,EAAKknB,UAChBjkB,YAAajD,EAAKiD,YAClBojB,UAAW,IAAKrmB,EAAKqmB,WAAa,IAClCc,cAAennB,EAAKmnB,cACpBzN,OAAQ1Z,EAAK0Z,OACb0M,WAAY,IAAKpmB,EAAKomB,YAAc,QAI1C/lB,UAAU,mEAEZE,EAAAA,EAAAA,MAAA,QAAMF,UAAU,UAASC,SAAA,CACtBJ,EAAKgB,QAAQ,MAAIhB,EAAKiB,UAnEfjB,EAAKX,YA2EvBgB,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEC,EAAAA,EAAAA,MAAA,SAAOF,UAAU,+CAA8CC,SAAA,CAAC,eAC3B,QAAvB6qB,EAAAqC,EAAapH,kBAAU,IAAA+E,OAAA,EAAvBA,EAAyBpqB,SAAU,EAAE,QAInDX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,2EAA0EC,SACtFkhB,EAAMlgB,OAAOpB,GAAQA,EAAKX,KAAOiuB,EAAajuB,IAAIU,IAAIC,IAAI,IAAAqzC,EAAA,OACzDhzC,EAAAA,EAAAA,MAAA,SAAqBF,UAAU,0EAAyEC,SAAA,EACtGF,EAAAA,EAAAA,KAAA,SACEY,KAAK,WACL2J,SAAgC,QAAvB4oC,EAAA/lB,EAAapH,kBAAU,IAAAmtB,OAAA,EAAvBA,EAAyB5jC,SAASzP,EAAKX,OAAO,EACvDkB,SAAWC,IACT,MAAM8yC,EAAehmB,EAAapH,YAAc,GAC5C1lB,EAAEC,OAAOgK,QACX8iB,EAAgBztB,IAAI,CAClBT,GAAIS,EAAKT,GACT2B,QAASlB,EAAKkB,QACdC,KAAMnB,EAAKmB,KACXyL,SAAU5M,EAAK4M,SACf9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd0U,SAAUzZ,EAAKyZ,SACf0M,aAAc,IAAKnmB,EAAKmmB,cAAgB,IACxCU,KAAM7mB,EAAK6mB,KACX9Z,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjBwB,YAAa1P,EAAK0P,YAClBwW,WAAYlmB,EAAKkmB,WACjBY,iBAAkB9mB,EAAK8mB,iBACvBrS,WAAYzU,EAAKyU,WACjBC,YAAa1U,EAAK0U,YAClBqS,UAAW/mB,EAAK+mB,UAChBC,WAAYhnB,EAAKgnB,WACjBC,WAAYjnB,EAAKinB,WACjBC,UAAWlnB,EAAKknB,UAChBjkB,YAAajD,EAAKiD,YAClBojB,UAAW,IAAKrmB,EAAKqmB,WAAa,IAClCc,cAAennB,EAAKmnB,cACpBzN,OAAQ1Z,EAAK0Z,OACb0M,WAAYotB,EAAavkC,QAAQzK,OAAO,CAACtE,EAAKX,QAGhDkuB,EAAgBztB,IAAI,CAClBT,GAAIS,EAAKT,GACT2B,QAASlB,EAAKkB,QACdC,KAAMnB,EAAKmB,KACXyL,SAAU5M,EAAK4M,SACf9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd0U,SAAUzZ,EAAKyZ,SACf0M,aAAc,IAAKnmB,EAAKmmB,cAAgB,IACxCU,KAAM7mB,EAAK6mB,KACX9Z,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjBwB,YAAa1P,EAAK0P,YAClBwW,WAAYlmB,EAAKkmB,WACjBY,iBAAkB9mB,EAAK8mB,iBACvBrS,WAAYzU,EAAKyU,WACjBC,YAAa1U,EAAK0U,YAClBqS,UAAW/mB,EAAK+mB,UAChBC,WAAYhnB,EAAKgnB,WACjBC,WAAYjnB,EAAKinB,WACjBC,UAAWlnB,EAAKknB,UAChBjkB,YAAajD,EAAKiD,YAClBojB,UAAW,IAAKrmB,EAAKqmB,WAAa,IAClCc,cAAennB,EAAKmnB,cACpBzN,OAAQ1Z,EAAK0Z,OACb0M,WAAYotB,EAAalyC,OAAO/B,GAAMA,IAAOW,EAAKX,QAIxDc,UAAU,mEAEZE,EAAAA,EAAAA,MAAA,QAAMF,UAAU,UAASC,SAAA,CACtBJ,EAAKgB,QAAQ,MAAIhB,EAAKiB,UAnEfjB,EAAKX,kBA6E3BgB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,gEAA+DC,SAAA,EAC5EF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMitB,EAAgB,MAC/BptB,UAAU,6EAA4EC,SACvF,cAGDF,EAAAA,EAAAA,KAAA,UACEI,QAASA,KACPwL,QAAQC,IAAI,8CAAqCuhB,GAGjDjC,EAASvrB,GACAA,EAAKC,IAAIC,GACVA,EAAKX,KAAOiuB,EAAajuB,GACpB,CACLA,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMqsB,EAAarsB,KACnByL,SAAU4gB,EAAa5gB,SACvB9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf0M,aAAcqH,EAAarH,cAAgB,GAC3CU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAYoH,EAAapH,YAAc,IAGpClmB,IAIXutB,EAAgB,OAElBptB,UAAU,oEAAmEC,SAC9E,6BASR,EAweA0L,QAAQC,IAAI,oDAA2CuhB,EAAcA,IACrE,EAm9BA2B,KACC5uB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,0BAAyBC,SAAC,qBACxCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,6BAA4BC,SAAC,iCAC3CC,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,YAAgB,IAAE8sB,EAAanpB,gBAC1C1D,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,qBAAyB,IAAE,IAAIuB,KAAKurB,EAAatoB,WAAWkJ,mBAAmB,UAC1FzN,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,8BAAkC,IAAE,IAAIuB,KAAKurB,EAAaC,gBAAgBrf,mBAAmB,UACxGzN,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,wBAAyB,KAAG8sB,EAAaE,gBAAgB9lB,wBAEtEjH,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,6BAA4BC,SAAC,0BAC3CC,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,cAAkB,IAAE8sB,EAAaoR,cAC5Cj+B,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,kBAAsB,IAAE8sB,EAAaqR,YAChDl+B,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,0BAA8B,IAAE8sB,EAAahP,YACxD7d,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,gBAAoB,IAAE8sB,EAAasR,qBAC9Cn+B,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,aAAiB,IAAE8sB,EAAauR,QAC3Cp+B,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,aAAiB,IAAE8sB,EAAawR,QAC3Cr+B,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,iCAAkC,IAAE8sB,EAAayR,kBAC5Dt+B,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,SAAa,KAAG8sB,EAAa0R,IAAIt3B,2BAGhDpH,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wBAAuBC,UACpCF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAM4uB,IAAoB,GACnC/uB,UAAU,mEAAkEC,SAC7E,gBAQN+uB,KACC9uB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,0BAAyBC,SAAC,6BACxCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,6CAA4CC,SAAA,EACzDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,6BAA4BC,SAAC,sBAC1CoD,OAAO2V,QAAQmb,GAAiB7J,cAAc1qB,IAAIwzC,IAAA,IAAE5oB,EAAUC,GAAY2oB,EAAA,OACzElzC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEC,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGC,EAAAA,EAAAA,MAAA,UAAAD,SAAA,CAASuqB,EAAS,OAAU,IAAEC,EAAY/pB,OAAO,cACpDX,EAAAA,EAAAA,KAAA,MAAAE,SACGwqB,EAAY7qB,IAAI6M,IACfvM,EAAAA,EAAAA,MAAA,MAAAD,SAAA,CAAoBwM,EAAE2f,SAAS,cAASzH,EAAkBlY,EAAEhI,UAAW8f,EAAQ9X,EAAE/H,QAAS,EAAGwgB,GAAkBA,GAAiB,MAAvHzY,EAAE2a,aAJPoD,SAUdtqB,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,6BAA4BC,SAAC,2BAC1Ck0B,GAAiBQ,UAAU/0B,IAAIyzC,IAC9BnzC,EAAAA,EAAAA,MAAA,KAA2BF,UAAU,uBAAsBC,SAAA,CAAC,mBACzCozC,EAAS7e,MAAM,MAAI6e,EAAS5e,MAAM,oBAAkB4e,EAAS7oB,SAAS,SAAO6oB,EAAS3e,YAAY,cAD7G2e,EAAS7oB,kBAMvBtqB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EACpDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,6BAA4BC,SAAC,+BAC1CoD,OAAO2V,QAAQmb,GAAiB5J,aAAa3qB,IAAI0zC,IAAA,IAAE9oB,EAAUze,GAAKunC,EAAA,OACjEpzC,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAkBC,EAAAA,EAAAA,MAAA,UAAAD,SAAA,CAASuqB,EAAS,OAAU,IAAEze,EAAK,aAA7Cye,SAGZtqB,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,6BAA4BC,SAAC,6BAC3CC,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,uBAA2B,IAAEoD,OAAOC,KAAK6wB,GAAiB5J,aAAa7pB,WAClFR,EAAAA,EAAAA,MAAA,KAAAD,SAAA,EAAGF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,gCAAiC,IAAEoD,OAAO2jB,OAAOmN,GAAiB5J,aAAa5kB,OAAO,CAACC,EAAKge,IAAMhe,EAAMge,EAAG,GAAG,qBAG7H7jB,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wBAAuBC,UACpCF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAM8uB,IAAwB,GACvCjvB,UAAU,mEAAkEC,SAC7E,iBAQN,EAiIAwhC,KACC1hC,EAAAA,EAAAA,KAAA,OAAKC,UAAU,6EAA4EC,UACzFF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,mFAAkFC,UAC/FC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,MAAKC,SAAA,EAClBC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yCAAwCC,SAAA,EACrDC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,mCAAkCC,SAC7C0hC,GAAYiL,kBAAoB,oCAA4B,qCAE9DjL,GAAYiL,oBACX1sC,EAAAA,EAAAA,MAAA,KAAGF,UAAU,6BAA4BC,SAAA,CAAC,4CACNF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,8BAA6BC,UACd,QAA9D8qB,EAAA2I,GAAa1vB,KAAKW,GAAKA,EAAEzF,KAAOyiC,GAAYiL,0BAAkB,IAAA7hB,OAAA,EAA9DA,EAAgEjqB,OAAQ,0BAKjFf,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMuhC,IAAoB,GACnC1hC,UAAU,6CAA4CC,SACvD,aAKHC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wCAAuCC,SAAA,EAEpDC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,oDAAmDC,SAAC,2CAElEC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,0BAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOiiC,GAAY7gC,KACnBV,SAAWC,GAAMuhC,GAAejiC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC/BH,GAAI,IACPmB,KAAMT,EAAEC,OAAOZ,SAEjBM,UAAU,4GACVO,YAAY,sCAIhBL,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,oBAGhEF,EAAAA,EAAAA,KAAA,YACEL,MAAOiiC,GAAY/+B,YACnBxC,SAAWC,GAAMuhC,GAAejiC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC/BH,GAAI,IACPiD,YAAavC,EAAEC,OAAOZ,SAExBM,UAAU,4GACVS,KAAK,IACLF,YAAY,6BAIhBL,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yBAAwBC,SAAA,EACrCC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,6BAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACLyJ,IAAI,IACJ1K,MAAOiiC,GAAYp1B,SACnBnM,SAAWC,IACT,MAAMkM,EAAWlC,SAAShK,EAAEC,OAAOZ,QAAU,EACvCy1B,EAAa5Q,EAAQod,GAAYl9B,UAAW8H,EAAU2Y,GAC5D0c,GAAejiC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACdH,GAAI,IACP4M,SAAUA,EACV7H,QAASywB,MAGbn1B,UAAU,kHAIdE,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,eAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACLyJ,IAAI,IACJM,KAAK,OACLhL,MAAOiiC,GAAYnb,KACnBpmB,SAAWC,GAAMuhC,GAAejiC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC/BH,GAAI,IACP6mB,KAAMvf,WAAW5G,EAAEC,OAAOZ,QAAU,KAEtCM,UAAU,qHAKhBE,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yBAAwBC,SAAA,EACrCC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,uBAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOiiC,GAAYl9B,UACnBrE,SAAWC,IACT,MAAMwrC,EAAexrC,EAAEC,OAAOZ,MACxBy1B,EAAa5Q,EAAQsnB,EAAclK,GAAYp1B,SAAU2Y,GAC/D0c,GAAejiC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACdH,GAAI,IACP8E,UAAWonC,EACXnnC,QAASywB,MAGbn1B,UAAU,kHAIdE,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,kBAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOiiC,GAAYj9B,QACnBtE,SAAWC,IACT,MAAM80B,EAAa90B,EAAEC,OAAOZ,MACtB6zC,EAAcrpC,KAAK+N,MAAM,IAAIzW,KAAK2zB,GAAc,IAAI3zB,KAAKmgC,GAAYl9B,YAAU,OACrFm9B,GAAejiC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACdH,GAAI,IACP4M,SAAUgnC,EAAc,EAAIA,EAAc,EAC1C7uC,QAASywB,MAGbn1B,UAAU,qHAKhBE,EAAAA,EAAAA,MAAA,OAAKF,UAAU,yBAAwBC,SAAA,EACrCC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,eAGhEC,EAAAA,EAAAA,MAAA,UACER,MAAOiiC,GAAYj1B,SACnBtM,SAAWC,GAAMuhC,GAAejiC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC/BH,GAAI,IACP+M,SAAUrM,EAAEC,OAAOZ,SAErBM,UAAU,4GAA2GC,SAAA,EAErHF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,MAAKO,SAAC,uBACpBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,SAAQO,SAAC,wBACvBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,OAAMO,SAAC,uBACrBF,EAAAA,EAAAA,KAAA,UAAQL,MAAM,WAAUO,SAAC,mCAI7BC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,gBAGhEF,EAAAA,EAAAA,KAAA,SACEY,KAAK,OACLjB,MAAOiiC,GAAY9zB,WACnBzN,SAAWC,GAAMuhC,GAAejiC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC/BH,GAAI,IACPkO,WAAYxN,EAAEC,OAAOZ,SAEvBM,UAAU,4GACVO,YAAY,kCAMlBL,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEF,EAAAA,EAAAA,KAAA,SAAOC,UAAU,+CAA8CC,SAAC,yCAGhEC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CF,EAAAA,EAAAA,KAAA,SACEY,KAAK,SACLyJ,IAAI,IACJM,KAAK,OACLhL,MAAOiiC,GAAYjgB,cACnBthB,SAAWC,GAAMuhC,GAAejiC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC/BH,GAAI,IACP+hB,cAAeza,WAAW5G,EAAEC,OAAOZ,QAAU,KAE/CM,UAAU,4GACVO,YAAY,oBAEdR,EAAAA,EAAAA,KAAA,UACEY,KAAK,SACLR,QAASA,KACP,MAAM4hB,GAAkByxB,EAAAA,EAAAA,IACtB7R,GAAYnb,MAAQ,EACpBmb,GAAYj1B,UAAY,UACb,OAAX0U,QAAW,IAAXA,OAAW,EAAXA,EAAaK,eAAgB,EAC7BN,GAEFygB,GAAejiC,IAAIG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACdH,GAAI,IACP+hB,cAAeK,MAGnB/hB,UAAU,iIACV0I,MAAM,+DAA2DzI,SAClE,0BAIHF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,6BAA4BC,SAAC,qGAO9CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,YAAWC,SAAA,EACxBF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,oDAAmDC,SAAC,+BAGlEC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEC,EAAAA,EAAAA,MAAA,SAAOF,UAAU,+CAA8CC,SAAA,CAAC,iBAC/C0hC,GAAYE,qBAAqBnhC,OAAO,QAEzDX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,sFAAqFC,SAChF,IAAjBkhB,EAAMzgB,QACLX,EAAAA,EAAAA,KAAA,KAAGC,UAAU,+BAA8BC,SAAC,6BAE5CkhB,EAAMvhB,IAAIC,IACRK,EAAAA,EAAAA,MAAA,SAAqBF,UAAU,wEAAuEC,SAAA,EACpGF,EAAAA,EAAAA,KAAA,SACEY,KAAK,WACL2J,QAASq3B,GAAYE,qBAAqBvyB,SAASzP,EAAKX,IACxDkB,SAAWC,IACLA,EAAEC,OAAOgK,SACXqB,QAAQC,IAAI,sDAA6C/L,EAAKX,GAAIW,EAAKgB,QAAShB,EAAKiB,MACrF8gC,GAAejiC,IACb,MAAMy6B,EAAWz6B,EAAKkiC,qBAAqBjzB,QAAQzK,OAAO,CAACtE,EAAKX,KAEhE,OADAyM,QAAQC,IAAI,0DAAiDwuB,GACtD,CACLt5B,KAAMnB,EAAKmB,KACXyL,SAAU5M,EAAK4M,SACf9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd9B,YAAajD,EAAKiD,YAClB8J,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjB2Y,KAAM7mB,EAAK6mB,KACXqb,qBAAsBzH,EACtBqZ,mBAAoB,IAAK9zC,EAAK8zC,oBAAsB,SAIxD9nC,QAAQC,IAAI,uDAA8C/L,EAAKX,GAAIW,EAAKgB,QAAShB,EAAKiB,MACtF8gC,GAAejiC,IACb,MAAMy6B,EAAWz6B,EAAKkiC,qBAAqB5gC,OAAO/B,GAAMA,IAAOW,EAAKX,IAEpE,OADAyM,QAAQC,IAAI,0DAAiDwuB,GACtD,CACLt5B,KAAMnB,EAAKmB,KACXyL,SAAU5M,EAAK4M,SACf9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd9B,YAAajD,EAAKiD,YAClB8J,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjB2Y,KAAM7mB,EAAK6mB,KACXqb,qBAAsBzH,EACtBqZ,mBAAoB,IAAK9zC,EAAK8zC,oBAAsB,SAK5DzzC,UAAU,+DAEZE,EAAAA,EAAAA,MAAA,QAAMF,UAAU,UAASC,SAAA,EACvBF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,cAAaC,SAAEJ,EAAKgB,UAAe,MAAIhB,EAAKiB,UA9CpDjB,EAAKX,WAuDzBgB,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEC,EAAAA,EAAAA,MAAA,SAAOF,UAAU,+CAA8CC,SAAA,CAAC,cAClD0hC,GAAY8R,mBAAmB/yC,OAAO,QAEpDX,EAAAA,EAAAA,KAAA,OAAKC,UAAU,sFAAqFC,SAChF,IAAjBkhB,EAAMzgB,QACLX,EAAAA,EAAAA,KAAA,KAAGC,UAAU,+BAA8BC,SAAC,6BAE5CkhB,EAAMvhB,IAAIC,IACRK,EAAAA,EAAAA,MAAA,SAAqBF,UAAU,wEAAuEC,SAAA,EACpGF,EAAAA,EAAAA,KAAA,SACEY,KAAK,WACL2J,QAASq3B,GAAY8R,mBAAmBnkC,SAASzP,EAAKX,IACtDkB,SAAWC,IACLA,EAAEC,OAAOgK,SACXqB,QAAQC,IAAI,mDAA0C/L,EAAKX,GAAIW,EAAKgB,QAAShB,EAAKiB,MAClF8gC,GAAejiC,IACb,MAAMm6B,EAAWn6B,EAAK8zC,mBAAmB7kC,QAAQzK,OAAO,CAACtE,EAAKX,KAE9D,OADAyM,QAAQC,IAAI,uDAA8CkuB,GACnD,CACLh5B,KAAMnB,EAAKmB,KACXyL,SAAU5M,EAAK4M,SACf9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd9B,YAAajD,EAAKiD,YAClB8J,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjB2Y,KAAM7mB,EAAK6mB,KACXqb,qBAAsB,IAAKliC,EAAKkiC,sBAAwB,IACxD4R,mBAAoB3Z,OAIxBnuB,QAAQC,IAAI,oDAA2C/L,EAAKX,GAAIW,EAAKgB,QAAShB,EAAKiB,MACnF8gC,GAAejiC,IACb,MAAMm6B,EAAWn6B,EAAK8zC,mBAAmBxyC,OAAO/B,GAAMA,IAAOW,EAAKX,IAElE,OADAyM,QAAQC,IAAI,uDAA8CkuB,GACnD,CACLh5B,KAAMnB,EAAKmB,KACXyL,SAAU5M,EAAK4M,SACf9H,UAAW9E,EAAK8E,UAChBC,QAAS/E,EAAK+E,QACd9B,YAAajD,EAAKiD,YAClB8J,SAAU/M,EAAK+M,SACfmB,WAAYlO,EAAKkO,WACjB2Y,KAAM7mB,EAAK6mB,KACXqb,qBAAsB,IAAKliC,EAAKkiC,sBAAwB,IACxD4R,mBAAoB3Z,OAK5B95B,UAAU,+DAEZE,EAAAA,EAAAA,MAAA,QAAMF,UAAU,UAASC,SAAA,EACvBF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,cAAaC,SAAEJ,EAAKgB,UAAe,MAAIhB,EAAKiB,UA9CpDjB,EAAKX,WAuDzBgB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mDAAkDC,SAAA,EAC/DF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yCAAwCC,SAAC,oDACvDC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,kCAAiCC,SAAA,EAC7CC,EAAAA,EAAAA,MAAA,MAAAD,SAAA,CAAI,WAAEF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,kBAAsB,kDACpCC,EAAAA,EAAAA,MAAA,MAAAD,SAAA,CAAI,WAAEF,EAAAA,EAAAA,KAAA,UAAAE,SAAQ,eAAmB,yCACjCF,EAAAA,EAAAA,KAAA,MAAAE,SAAI,2EAOZC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,gEAA+DC,SAAA,EAC5EF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMuhC,IAAoB,GACnC1hC,UAAU,+FAA8FC,SACzG,cAGDC,EAAAA,EAAAA,MAAA,UACEC,QAASA,KAEP,MAAMuzC,EAAevyB,GAAS,GACxByrB,EAAoBjL,GAAYiL,kBACtC,IAAI+G,EAAwB,KAE5B,GAAI/G,EAAmB,CACrB,MAAMgH,EAAmBF,EAAa3Q,UAAUljC,GAAQA,EAAKX,KAAO0tC,IAC1C,IAAtBgH,IACFD,EAAwBC,EAAmB,EAC3CjoC,QAAQC,IAAI,sEAA6D,CACvEghC,oBACAgH,mBACAD,wBACAhyB,WAAY+xB,EAAahzC,SAG/B,EAl6KU,WAAiC,IAAhCmzC,EAAmBn8B,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,KACjD,IACE/L,QAAQC,IAAI,0DACZD,QAAQC,IAAI,0DAAiD+1B,IAC7Dh2B,QAAQC,IAAI,2DAAkD+1B,GAAYE,sBAC1El2B,QAAQC,IAAI,wDAA+C+1B,GAAY8R,oBAEvE,MAAMK,EAA2C,OAAxBD,EAA+BA,EAAsBlS,GAAYoL,YAa1F,GAZ+BpL,GAAYiL,kBAE3CjhC,QAAQC,IAAI,gDAAoC,CAC9CmhC,YAAapL,GAAYoL,YACzBH,kBAAmBjL,GAAYiL,kBAC/BmH,uBAAwBpS,GAAYoL,YACpCiH,6BAA8BrS,GAAYiL,kBAC1CiH,oBAAqBA,EACrBC,iBAAkBA,KAIfnS,GAAY7gC,KAAKI,OAEpB,YADAC,MAAM,6CAIR,GAAIwgC,GAAYp1B,UAAY,EAE1B,YADApL,MAAM,qCAKR,MAUM+qC,EAAoBA,KACxB,IACIC,EADAC,EAAU,EAEd,GACED,EAAM,KAAAhoC,OAAQioC,GACdA,UACOjrB,EAAM5d,KAAK1D,GAAQA,EAAKgB,UAAYsrC,IAC7C,OAAOA,GAGHJ,EAlBG,uCAAuCpoC,QAAQ,QAAS,SAAUqoC,GACvE,MAAM9lC,EAAoB,GAAhBgE,KAAK+hC,SAAgB,EAE/B,OADgB,MAAND,EAAY9lC,EAAS,EAAJA,EAAU,GAC5B+J,SAAS,GACpB,GAeIyb,EAAawgB,IAEnBvgC,QAAQC,IAAI,sCAA6B,CACvCmgC,YACArgB,aACAqhB,YAAapL,GAAYoL,YACzBH,kBAAmBjL,GAAYiL,oBAIjCjhC,QAAQC,IAAI,uDAA8C,CACxDi2B,qBAAsBF,GAAYE,qBAClC4R,mBAAoB9R,GAAY8R,mBAChCQ,mBAAoBtS,GAAYE,qBAAqBnhC,OACrDwzC,iBAAkBvS,GAAY8R,mBAAmB/yC,SAGnD,MAAM2rC,EAAU,CACdntC,GAAI6sC,EACJlrC,QAAS6qB,EACT5qB,KAAM6gC,GAAY7gC,KAAKI,OACvBqL,SAAUo1B,GAAYp1B,SACtB9H,UAAWk9B,GAAYl9B,UACvBC,QAASi9B,GAAYj9B,QACrB0U,SAAU,EACV0M,aAAc6b,GAAYE,qBAAqBjzB,QAC/CmX,WAAY4b,GAAY8R,mBAAmB7kC,QAC3CoX,UAAW,GACXQ,KAAMmb,GAAYnb,KAClB9E,cAAeigB,GAAYjgB,eAAiB,EAC5CrS,aAAa,EACbwW,YAAY,EACZY,iBAAkBkb,GAAYp1B,SAC9B6H,WAAYutB,GAAYl9B,UACxB4P,YAAastB,GAAYj9B,QACzBgiB,UAAWib,GAAYl9B,UACvBkiB,WAAYgb,GAAYj9B,QACxBkiB,WAAY,EACZC,UAAW,EACXxN,OAAQ,UAERyN,cAAeilB,EACftqB,aAAc,EACd+f,YAAa,EACb8K,WAAY,EAEZ1pC,YAAa++B,GAAY/+B,YACzB8J,SAAUi1B,GAAYj1B,SACtBmB,WAAY8zB,GAAY9zB,WACxB0+B,YAAa1oB,EAAM,IAAIriB,MACvBgrC,aAAc3oB,EAAM,IAAIriB,OAG1BmK,QAAQC,IAAI,6CAAoCygC,GAChD1gC,QAAQC,IAAI,wDAA+C,CACzDka,aAAcumB,EAAQvmB,aACtBC,WAAYsmB,EAAQtmB,WACpBkuB,mBAAoB5H,EAAQvmB,aAAaplB,OACzCwzC,iBAAkB7H,EAAQtmB,WAAWrlB,SAEvCiL,QAAQC,IAAI,2DAAkD,CAC5Dka,aAAc6b,GAAYE,qBAC1B9b,WAAY4b,GAAY8R,qBAI1B9nC,QAAQC,IAAI,oEACZD,QAAQC,IAAI,iEAAwDuV,EAAMzgB,QAE1EwqB,EAASvrB,IAAS,IAADw0C,EAAAC,EAOf,IAAIrtB,EAWJ,GAjBApb,QAAQC,IAAI,yEAA6DjM,EAAKe,QAC9EiL,QAAQC,IAAI,yCAAgC,CAC1C1M,GAAImtC,EAAQntC,GACZ4B,KAAMurC,EAAQvrC,KACdD,QAASwrC,EAAQxrC,UAKnB8K,QAAQC,IAAI,gDAAuC,CACjDmhC,YAAapL,GAAYoL,YACzBsH,0BAAkDziC,IAA5B+vB,GAAYoL,YAClCH,kBAAmBjL,GAAYiL,kBAC/BkH,iBAAkBA,EAClBQ,+BAAgD1iC,IAArBkiC,SAGJliC,IAArBkiC,GAAuD,OAArBA,EAA2B,CAE/D,MAAMpQ,EAAW/jC,EAAKiP,QACtB80B,EAASl7B,OAAOsrC,EAAkB,EAAGzH,GACrCtlB,EAAe2c,EACf/3B,QAAQC,IAAI,kEAAmDkoC,EACjE,MAAO,GAAInS,GAAYiL,kBAAmB,CAExC,MAAMG,EAAcptC,EAAKojC,UAAUljC,GAAQA,EAAKX,KAAOyiC,GAAYiL,mBACnE,IAAqB,IAAjBG,EAAoB,CAEtB,MAAMrJ,EAAW/jC,EAAKiP,QACtB80B,EAASl7B,OAAOukC,EAAc,EAAG,EAAGV,GACpCtlB,EAAe2c,EACf/3B,QAAQC,IAAI,iEAAkDmhC,EAAc,EAC9E,KAAO,CAEL,MAAMrJ,EAAW/jC,EAAKiP,QACtB80B,EAAS9zB,KAAKy8B,GACdtlB,EAAe2c,EACf/3B,QAAQC,IAAI,sFACd,CACF,KAAO,CAEL,MAAM83B,EAAW/jC,EAAKiP,QACtB80B,EAAS9zB,KAAKy8B,GACdtlB,EAAe2c,EACf/3B,QAAQC,IAAI,sEAA6Dmb,EAAarmB,OACxF,CAMAqmB,EAAeA,EAAannB,IAAI,CAACC,EAAM4I,KAAK3I,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACvCD,GAAI,IACPgB,QAAS4H,EAAQ,KAGnBkD,QAAQC,IAAI,gFACVmb,EAAannB,IAAI+E,IAAC,CAAO7D,KAAM6D,EAAE7D,KAAMD,QAAS8D,EAAE9D,YAIpD,MAAM0zC,EAAYxtB,EAAa/iB,KAAKW,GAAKA,EAAEzF,KAAO6sC,GAC5CyI,EAAiBztB,EAAagc,UAAUp+B,GAAKA,EAAEzF,KAAO6sC,GAuB5D,OAtBApgC,QAAQC,IAAI,iEAAqD,CAC/D1M,GAAa,OAATq1C,QAAS,IAATA,OAAS,EAATA,EAAWr1C,GACf4B,KAAe,OAATyzC,QAAS,IAATA,OAAS,EAATA,EAAWzzC,KACjB2zC,SAAUD,EACV3zC,QAAkB,OAAT0zC,QAAS,IAATA,OAAS,EAATA,EAAW1zC,QACpBilB,aAAuB,OAATyuB,QAAS,IAATA,OAAS,EAATA,EAAWzuB,aACzBC,WAAqB,OAATwuB,QAAS,IAATA,OAAS,EAATA,EAAWxuB,WACvBkuB,mBAA6B,OAATM,QAAS,IAATA,GAAuB,QAAdJ,EAATI,EAAWzuB,oBAAY,IAAAquB,OAAd,EAATA,EAAyBzzC,OAC7CwzC,iBAA2B,OAATK,QAAS,IAATA,GAAqB,QAAZH,EAATG,EAAWxuB,kBAAU,IAAAquB,OAAZ,EAATA,EAAuB1zC,SAI3CiL,QAAQC,IAAI,sEACVmb,EAAanY,MAAM,EAAG,IAAIhP,IAAI,CAAC+E,EAAGC,KAAC,CACjC6vC,SAAU7vC,EACV/D,QAAS8D,EAAE9D,QACXC,KAAM6D,EAAE7D,KACR5B,GAAIyF,EAAEzF,OAKNyiC,GAAYE,qBAAqBnhC,OAAS,GAAKihC,GAAY8R,mBAAmB/yC,OAAS,GACzFiL,QAAQC,IAAI,8DAELmb,EAAannB,IAAIC,IAEtB,GAAIA,EAAKX,KAAO6sC,EACd,OAAOlsC,EAIT,IAAIs4B,EAAc,CAChBj5B,GAAIW,EAAKX,GACT2B,QAAShB,EAAKgB,QACdC,KAAMjB,EAAKiB,KACXyL,SAAU1M,EAAK0M,SACf9H,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd0U,SAAUvZ,EAAKuZ,SACf0M,aAAc,IAAKjmB,EAAKimB,cAAgB,IACxCU,KAAM3mB,EAAK2mB,KACX9Z,SAAU7M,EAAK6M,SACfmB,WAAYhO,EAAKgO,WACjBwB,YAAaxP,EAAKwP,YAClBwW,WAAYhmB,EAAKgmB,WACjBY,iBAAkB5mB,EAAK4mB,iBACvBrS,WAAYvU,EAAKuU,WACjBC,YAAaxU,EAAKwU,YAClBqS,UAAW7mB,EAAK6mB,UAChBC,WAAY9mB,EAAK8mB,WACjBC,WAAY/mB,EAAK+mB,WACjBC,UAAWhnB,EAAKgnB,UAChBjkB,YAAa/C,EAAK+C,YAClBojB,UAAW,IAAKnmB,EAAKmmB,WAAa,IAClCc,cAAejnB,EAAKinB,cACpBzN,OAAQxZ,EAAKwZ,OACb0M,WAAY,IAAKlmB,EAAKkmB,YAAc,KAqBtC,OAhBI4b,GAAYE,qBAAqBvyB,SAASzP,EAAKX,MAC5Ci5B,EAAYpS,WAAWzW,SAASy8B,KACnC5T,EAAYpS,WAAaoS,EAAYpS,WAAWnX,QAAQzK,OAAO,CAAC4nC,IAChEpgC,QAAQC,IAAI,0CAADzH,OAAiC4nC,EAAS,sBAAA5nC,OAAqBtE,EAAKX,OAM/EyiC,GAAY8R,mBAAmBnkC,SAASzP,EAAKX,MAC1Ci5B,EAAYrS,aAAaxW,SAASy8B,KACrC5T,EAAYrS,aAAe,IAAKqS,EAAYrS,cAAgB,GAAKimB,GACjEpgC,QAAQC,IAAI,0CAADzH,OAAiC4nC,EAAS,yBAAA5nC,OAAwBtE,EAAKX,OAI/Ei5B,MAIXxsB,QAAQC,IAAI,4CAAmC,CAC7C+V,WAAYoF,EAAarmB,OACzBg0C,gBAAiB3tB,EAAaxjB,KAAKoB,GAAKA,EAAEzF,KAAO6sC,GACjD4I,gBAAiB5tB,EAAagc,UAAUp+B,GAAKA,EAAEzF,KAAO6sC,KAEjDhlB,KAITpG,WAAW,KACThV,QAAQC,IAAI,sDAA0C,CACpDo6B,YAAa7kB,EAAMzgB,OACnBk0C,cAAezzB,EAAM5d,KAAKoB,GAAKA,EAAEzF,KAAO6sC,MAEzC,KAKHrK,IAAoB,GACpBE,GAAe,CACb9gC,KAAM,GACNyL,SAAU,EACV9H,UAAWof,EAAM,IAAIriB,MACrBkD,QAAS6f,EAAQV,EAAM,IAAIriB,MAAS,GACpCoB,YAAa,GACb8J,SAAU,SACVmB,WAAY,GACZ2Y,KAAM,EACNqb,qBAAsB,GACtB+K,kBAAmB,OAGrBjhC,QAAQC,IAAI,gEAGZ+U,WAAW,KACThV,QAAQC,IAAI,0DACZsf,EAASwoB,IACP/nC,QAAQC,IAAI,4DAAgD8nC,EAAahzC,QACzEiL,QAAQC,IAAI,4CAAgC8nC,EAAa9kC,OAAO,GAAGhP,IAAI+E,IAAC,CAAO7D,KAAM6D,EAAE7D,KAAMD,QAAS8D,EAAE9D,QAAS3B,GAAIyF,EAAEzF,OACvHw0C,EAAa7kC,QAAQhP,IAAS,IAADg1C,EAAAC,EAC3BnpC,QAAQC,IAAI,8BAADzH,OAAqBtE,EAAKiB,KAAI,MAAAqD,OAAKtE,EAAKX,GAAE,MAAM,CACzD4mB,aAAcjmB,EAAKimB,aACnBC,WAAYlmB,EAAKkmB,WACjBkuB,oBAAqC,QAAjBY,EAAAh1C,EAAKimB,oBAAY,IAAA+uB,OAAA,EAAjBA,EAAmBn0C,SAAU,EACjDwzC,kBAAiC,QAAfY,EAAAj1C,EAAKkmB,kBAAU,IAAA+uB,OAAA,EAAfA,EAAiBp0C,SAAU,MAG1CgzC,KAER,IAEL,CAAE,MAAOhlC,GACP/C,QAAQ+C,MAAM,+CAA2CA,GACzDvN,MAAM,uDACR,CACF,CAgmKkB4zC,CAAoBpB,IAEtB3zC,UAAU,8GAA6GC,SAAA,EAEvHF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,YACNF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,8BASlBF,EAAAA,EAAAA,KAACi1C,EAAW,CACVr2C,OAAQywB,GACRxwB,QA5gNyBq2C,KAC7B5lB,IAAqB,IA4gNjBxwB,MAAOsiB,EAAMlgB,OAAOpB,GAAQA,EAAKwP,aACjCvQ,OA1gNmB+e,UACvBlS,QAAQC,IAAI,2CAAkC7M,GAE9C,IAEE,GAAIuiB,GAA0B,OAAXF,QAAW,IAAXA,GAAAA,EAAaliB,GAAI,CAClC,MAAM0T,QAAeyO,EAAAA,QAAgB6zB,YAAY9zB,EAAYliB,GAAIH,GAEjE,IAAI6T,EAAO4kB,QAoBT,OAFA7rB,QAAQ+C,MAAM,sCAAkCkE,EAAOlE,YACvDvN,MAAM,uCAADgD,OAAmCyO,EAAOlE,MAAMmG,SAAW,sBAdhE,GAHA0a,GAAgB5vB,GAAQ,IAAIA,KAASZ,IAGjCusB,EAAsB,CACxB,MACM6pB,EAAiB,IADA7lB,IAAgB,MACOvwB,GAC9CusB,EAAqBlK,EAAYliB,GAAIi2C,EACvC,CAGAp2C,EAAY8P,QAAQlN,IAClBuuB,GAAqBvuB,EAAQyf,KAG/BjgB,MAAM,0BAADgD,OAAsBpF,EAAY2B,OAAM,qCAMjD,MAEE6uB,GAAgB5vB,GAAQ,IAAIA,KAASZ,IACrCoC,MAAM,gCAADgD,OAAuBpF,EAAY2B,OAAM,qCAIhD,GAAsB,qBAAXmf,OAAwB,CACjC,MAAMglB,EAAkB,IAAI9kB,YAAY,aAAc,CACpDC,OAAQ,CACNrf,KAAM,iBACNgZ,UAAsB,OAAXyH,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GACxBk2C,aAAcr2C,EAAY2B,UAG9Bmf,OAAOC,cAAc+kB,EACvB,CAEF,CAAE,MAAOn2B,GACP/C,QAAQ+C,MAAM,kCAA8BA,GAC5CvN,MAAM,uCAADgD,OAAmCuK,EAAMmG,SAChD,MA29ME9U,EAAAA,EAAAA,KAACs1C,EAAe,CACd12C,OAAQixB,GACRhxB,QAp9MuB02C,KAC3B3lB,GAAiB,MACjBE,IAAmB,IAm9MfluB,OAAQ+tB,GACR7wB,MAAOsiB,EAAMlgB,OAAOpB,GAAQA,EAAKwP,aACjCzN,SAl9MqBic,UACzB,IACE,GAAIyD,EAAa,CAEf,MAAMi0B,QAAqBl0B,EAAAA,QAAgBm0B,aAAaC,EAAcv2C,GAAI,CACxEw2C,iBAAkBD,EAAct2C,MAChCw2C,mBAAoBF,EAAcr2C,YAClCw2C,SAAUH,EAAcp2C,MACxBw2C,aAAcJ,EAAcn2C,OAC5B+Z,OAAQo8B,EAAc/zC,UAGxB,GAAI6zC,EAAa/d,QAAS,CAUxB,GARAjI,GAAgB5vB,GACdA,EAAKC,IAAIiF,GAAKA,EAAE3F,KAAOu2C,EAAcv2C,IAAEY,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAClC21C,GAAa,IAChBl0C,cAAesD,EAAEtD,gBACfsD,IAIFymB,EAAsB,CACxB,MACM6pB,GADiB7lB,IAAgB,IACD1vB,IAAIiF,GAAKA,EAAE3F,KAAOu2C,EAAcv2C,IAAEY,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACnE21C,GAAa,IAChBl0C,cAAesD,EAAEtD,gBACfsD,GACJymB,EAAqBlK,EAAYliB,GAAIi2C,EACvC,CAGA,MAAMW,EAAU,CACdJ,iBAAkBD,EAAct2C,MAChCw2C,mBAAoBF,EAAcr2C,YAClCw2C,SAAUH,EAAcp2C,MACxBw2C,aAAcJ,EAAcn2C,OAC5B+Z,OAAQo8B,EAAc/zC,SAExByuB,GAAqBslB,EAAeK,EAAS10B,GAE7CjgB,MAAM,0CACR,MACEwK,QAAQ+C,MAAM,oCAAgC6mC,EAAa7mC,OAC3DvN,MAAM,qCAADgD,OAAiCoxC,EAAa7mC,MAAMmG,SAAW,qBAExE,MAEE0a,GAAgB5vB,GACdA,EAAKC,IAAIiF,GAAKA,EAAE3F,KAAOu2C,EAAcv2C,IAAEY,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAClC21C,GAAa,IAChBl0C,cAAesD,EAAEtD,gBACfsD,IAEN1D,MAAM,uCAEV,CAAE,MAAOuN,GACP/C,QAAQ+C,MAAM,oCAAgCA,GAC9CvN,MAAM,qCAADgD,OAAiCuK,EAAMmG,SAC9C,KA25MGib,IAAgBnkB,QAAQC,IAAI,6CAAoC,CAC/D+N,UAAsB,OAAXyH,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GACxB8V,eAA2B,OAAXoM,QAAW,IAAXA,OAAW,EAAXA,EAAapM,eAC7BK,OAAmC,QAA7B2V,EAAE3J,EAAAA,QAAgBpM,mBAAW,IAAA+V,OAAA,EAA3BA,EAA6B9rB,GACrC62C,gBAAiB30B,EAAc/d,OAAOC,KAAK8d,GAAe,OAC1DA,YAAaA,KAEfrhB,EAAAA,EAAAA,KAACi2C,EAAc,CACbr3C,OAAQmxB,GACRlxB,QAASA,IAAMmxB,IAAgB,GAC/BhT,WA73M4Bc,UAChC,IAAK,IAADjT,EAAAC,EAAAC,EAAAC,EACFY,QAAQC,IAAI,qDAA4CR,GAIxD,MAAM6qC,EAAQ,IAAIz0C,KACZ00C,EAAmBryB,EAAMoyB,GAGzBE,EAAe/qC,EAAkBgB,WAAWxM,IAAI,CAACw2C,EAAM3tC,KAC3D,MAAMhE,EAAY8f,EAAQ2xB,EAAkBztC,EAAOyc,GAC7CxgB,EAAU6f,EAAQ9f,GAAY2xC,EAAK7pC,UAAY,GAAK,EAAG2Y,GAE7D,MAAO,CACLhmB,GAAIk3C,EAAKl3C,GACT4B,KAAMs1C,EAAKt1C,KACX8B,YAAawzC,EAAKxzC,aAAe,GACjC2J,SAAU6pC,EAAK7pC,UAAY,EAC3B9H,UAAWA,EACXC,QAASA,EACT0U,SAAU,EACVC,OAAQ,UACR3M,SAAU0pC,EAAK1pC,UAAY,SAC3BmB,WAAYuoC,EAAKvoC,YAAc,YAC/BgF,aAAcujC,EAAKvjC,cAAgB,GACnCiT,aAAcswB,EAAKvjC,cAAgB,GACnCkT,WAAY,GACZ1W,aAAa,EACbmJ,cAAe49B,EAAK59B,eAAiB,EACrC5K,SAAUwoC,EAAKxoC,UAAY,YAC3BG,MAAOqoC,EAAKroC,OAAS,UACrB6K,YAAa,KACb9K,WAAYsoC,EAAKtoC,YAAc,GAC/BE,SAAUooC,EAAKpoC,UAAY,MAKzBqoC,GAAgBjrC,EAAkBhE,YAAc,IAAIxH,IAAI,CAACw2C,EAAM3tC,KACnE,MAAM6tC,EAAgB/xB,EAAQ2xB,EAAkBC,EAAaz1C,OAAS+H,EAAOyc,GAE7E,MAAO,CACLhmB,GAAIk3C,EAAKl3C,GACT4B,KAAMs1C,EAAKt1C,KACX8B,YAAawzC,EAAKxzC,aAAe,GACjC2J,SAAU,EACV9H,UAAW6xC,EACX5xC,QAAS4xC,EACTl9B,SAAU,EACVC,OAAQ,UACR3M,SAAU0pC,EAAK1pC,UAAY,OAC3BmB,WAAYuoC,EAAKvoC,YAAc,YAC/BgF,aAAcujC,EAAKvjC,cAAgB,GACnCiT,aAAcswB,EAAKvjC,cAAgB,GACnCkT,WAAY,GACZ1W,aAAa,EACbmJ,cAAe49B,EAAK59B,eAAiB,EACrC5K,SAAUwoC,EAAKxoC,UAAY,YAC3BG,MAAOqoC,EAAKroC,OAAS,UACrB6K,YAAa,KACb9K,WAAYsoC,EAAKtoC,YAAc,GAC/BE,SAAUooC,EAAKpoC,UAAY,MAKzBuoC,EAAa,GACbC,EAAsB,IAAItjC,IAG1B6F,EAAoB,CAAC,EAC3Bo9B,EAAatnC,QAAQvC,IACnB,MAAMyB,EAAQzB,EAASyB,OAAS,UAC3BgL,EAAkBhL,KACrBgL,EAAkBhL,GAAS,IAE7BgL,EAAkBhL,GAAO6B,KAAKtD,KAIhCjJ,OAAO2V,QAAQD,GAAmBlK,QAAQ4nC,IAAmC,IAAjCx9B,EAAWC,GAAgBu9B,EAErEF,EAAW3mC,QAAQsJ,GAGnB,MAAMw9B,EAAkBL,EAAap1C,OAAO8G,GAC1CA,EAAUgG,QAAUkL,IAAcu9B,EAAoBnjC,IAAItL,EAAU7I,KAItEq3C,EAAW3mC,QAAQ8mC,GACnBA,EAAgB7nC,QAAQhK,GAAK2xC,EAAoBljC,IAAIzO,EAAE3F,OAIzD,MAAMy3C,EAAuBN,EAAap1C,OAAO8G,IAC9CA,EAAUgG,OAA6B,YAApBhG,EAAUgG,OAEhCwoC,EAAW3mC,QAAQ+mC,GAEnBhrC,QAAQC,IAAI,wCAA+B,CACzCgrC,WAAYL,EAAW71C,OACvB0L,WAAYmqC,EAAWt1C,OAAOm1C,IAASA,EAAK/mC,aAAa3O,OACzD0G,WAAYmvC,EAAWt1C,OAAOm1C,GAAQA,EAAK/mC,aAAa3O,OACxDgW,OAAQ,IAAI,IAAIxD,IAAIqjC,EAAW32C,IAAIw2C,GAAQA,EAAKroC,WAGlDpC,QAAQC,IAAI,qDAA4C,CACtDmN,kBAAmB1V,OAAOC,KAAKyV,GAC/B89B,gBAAiBN,EAAW32C,IAAI,CAACC,EAAM4I,KAAK,CAC1CA,QACAvJ,GAAIW,EAAKX,GACT4B,KAAMjB,EAAKiB,KACXuO,YAAaxP,EAAKwP,YAClBtB,MAAOlO,EAAKkO,WAKhB,MAAM+oC,EAAkBP,EAAWt1C,OAAOm1C,IAASA,EAAK/mC,aAAa3O,OAC/Dq2C,EAAkBR,EAAWt1C,OAAOm1C,GAAQA,EAAK/mC,aAAa3O,OAE9DikC,EAAiB,8DAAAxgC,OACL2yC,EAAe,MAAI,UAAA3yC,OACzB4yC,EAAe,MAAI,yBAAA5yC,OACP+F,KAAK8B,OAAgC,QAA1BpB,EAAAQ,EAAkBkC,gBAAQ,IAAA1C,OAAA,EAA1BA,EAA4BqH,oBAAqB,GAAE,gBAH/D,8HAOvB,IAAK4N,OAAO6kB,QAAQC,GAElB,YADAh5B,QAAQC,IAAI,wEAKd,MAAMmnB,EAAY5M,EAAaowB,EAAYrxB,GACrCwO,EAAeX,EAAU5R,OAAS4R,EAIlCikB,EAAsB,GACtBC,EAAW,IAAIvjC,IAAIggB,EAAa9zB,IAAIC,GAAQ,CAACA,EAAKX,GAAIW,KAsE5D,GAnEA02C,EAAW1nC,QAAQ0T,IACjB,MAAM0Q,EAAUgkB,EAASljC,IAAIwO,EAAarjB,IACtC+zB,GACF+jB,EAAoBpnC,KAAKqjB,KAK7BS,EAAa7kB,QAAQhP,IACdo3C,EAAS5jC,IAAIxT,EAAKX,KAAQq3C,EAAWvyC,KAAKW,GAAKA,EAAEzF,KAAOW,EAAKX,KAChE83C,EAAoBpnC,KAAK/P,KAI7B8L,QAAQC,IAAI,sCAA6B,CACvCsrC,qBAAsBnkB,EACtBokB,cAAe9zC,OAAOC,KAAKyvB,GAC3BqkB,iBAAkB1jB,EAClB2jB,aAAcj9B,MAAMC,QAAQqZ,GAC5BsS,YAAa5rB,MAAMC,QAAQqZ,GAAgBA,EAAahzB,OAAS,MACjE42C,mBAAoBN,EAAoBt2C,OACxC62C,eAAgBhB,EAAW71C,SAAWs2C,EAAoBt2C,SAG5DiL,QAAQC,IAAI,mDAAuC,CACjD4rC,cAAejB,EAAW32C,IAAI+E,IAAC,CAAOzF,GAAIyF,EAAEzF,GAAI4B,KAAM6D,EAAE7D,KAAMuO,YAAa1K,EAAE0K,eAC7EooC,WAAYT,EAAoBp3C,IAAI+E,IAAC,CAAOzF,GAAIyF,EAAEzF,GAAI4B,KAAM6D,EAAE7D,KAAMuO,YAAa1K,EAAE0K,iBAGrF1D,QAAQC,IAAI,uDAA2C,CACrD8rC,oBAAqBV,EAAoBp3C,IAAI,CAACC,EAAM4I,IAClD5I,EAAKwP,YAAc,CAAE5G,QAAO3H,KAAMjB,EAAKiB,KAAMiN,MAAOlO,EAAKkO,OAAU,MACnE9M,OAAO6qB,SACT6rB,2BAA4BX,EAAoBp3C,IAAI,CAACC,EAAM4I,KACzD,GAAI5I,EAAKwP,YAAa,CACpB,MAAMuoC,EAAmBZ,EAAoBpoC,MAAM,EAAGnG,GAAOxH,OAAO0D,IAAMA,EAAE0K,aAC5E,MAAO,CAAEtH,UAAWlI,EAAKiB,KAAM82C,iBAAkBA,EAAiBl3C,OACpE,CACA,OAAO,OACNO,OAAO6qB,SACV+rB,qBAAsBb,EAAoBpoC,MAAM,EAAG,GAAGhP,IAAIC,IAAI,CAC5DX,GAAIW,EAAKX,GACT4B,KAAMjB,EAAKiB,KACX2D,UAAW5E,EAAK4E,UAChBC,QAAS7E,EAAK6E,QACd2K,YAAaxP,EAAKwP,iBAKtB6b,EAAS8rB,GAGT5mB,GAAc,CACZxiB,SAAU,eACVO,OAAQ,mBACRvL,YAAa,kDACbk1C,QAAS,CACPhB,gBAAiBA,EACjBC,gBAAiBA,EACjBvpC,aAAwC,QAA5B3C,EAAEO,EAAkBkC,gBAAQ,IAAAzC,OAAA,EAA1BA,EAA4B2C,aAC1CyE,kBAA6C,QAA5BnH,EAAEM,EAAkBkC,gBAAQ,IAAAxC,OAAA,EAA1BA,EAA4BmH,kBAC/C1E,WAAsC,QAA5BxC,EAAEK,EAAkBkC,gBAAQ,IAAAvC,OAAA,EAA1BA,EAA4BwC,cAKxCnC,EAAkB6C,iBAAmB7C,EAAkB6C,gBAAgBvN,OAAS,EAAG,CAAC,IAADq3C,EACrF,MAAMC,EAAsB5sC,EAAkB6C,gBAC3CrO,IAAIq4C,GAAG,UAAA9zC,OAAS8zC,EAAIvvC,MAAK,MAAAvE,OAAK8zC,EAAIr1C,cAClC8X,KAAK,MAERvZ,MAAM,qEAAAgD,OACEoyC,EAAW71C,OAAM,0BAAwB,gBAAAyD,OACzC4yC,EAAe,oBAAkB,sCAAA5yC,OACd+F,KAAK8B,OAAgC,QAA1B+rC,EAAA3sC,EAAkBkC,gBAAQ,IAAAyqC,OAAA,EAA1BA,EAA4B9lC,oBAAqB,GAAE,gBAAW,kCAAA9N,OAC1E6zC,GAC5B,KAAO,CAAC,IAADE,EACL/2C,MAAM,qEAAAgD,OACEoyC,EAAW71C,OAAM,0BAAwB,gBAAAyD,OACzC4yC,EAAe,oBAAkB,sCAAA5yC,OACd+F,KAAK8B,OAAgC,QAA1BksC,EAAA9sC,EAAkBkC,gBAAQ,IAAA4qC,OAAA,EAA1BA,EAA4BjmC,oBAAqB,GAAE,YAC3F,CAEAtG,QAAQC,IAAI,gDAEd,CAAE,MAAO8C,GACP/C,QAAQ+C,MAAM,2CAAuCA,GACrDvN,MAAM,4CAADgD,OAAwCuK,EAAMmG,SACrD,GAopMI8E,UAAsB,OAAXyH,QAAW,IAAXA,OAAW,EAAXA,EAAaliB,GACxB8d,eAAgBoE,EAChBpM,eAA2B,OAAXoM,QAAW,IAAXA,OAAW,EAAXA,EAAapM,eAC7BK,OAAmC,QAA7B4V,EAAE5J,EAAAA,QAAgBpM,mBAAW,IAAAgW,OAAA,EAA3BA,EAA6B/rB,Q,mECviUtC,MAkBMi5C,EAAqBzrC,IAIhB,CACd,SAAY,EACZ,aAAW,EACX,KAAQ,IACR,KAAQ,IACR,OAAU,EACV,MAAS,EACT,IAAO,GACP,KAAQ,KAVkBA,GAAY,IAAIhJ,gBAaN,GAa3B8vC,EAA6B,SACxC4E,EACAC,EACAC,GAEI,IADJ3yB,EAAQjO,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,GAAAA,UAAA,GAAG,GAEX,IAAK0gC,GAAYA,GAAY,EAAG,OAAO,EACvC,IAAKE,GAAuBA,GAAuB,EAAG,OAAOF,EAG7D,MACMG,EAAmBH,EADND,EAAkBE,GAI/BG,EAAoB7yB,EAAShgB,OAAO,CAACC,EAAK/F,IAGvC+F,GAFM/F,EAAK2mB,MAAQ,GACX2xB,EAAkBt4C,EAAK6M,UAErC,GAGH,GAA0B,IAAtB8rC,EAAyB,CAC3B,MAAM3uB,EAAYlE,EAAShgB,OAAO,CAACC,EAAK/F,IAAS+F,GAAO/F,EAAK2mB,MAAQ,GAAI,GACzE,OAAkB,IAAdqD,EAAwByuB,EACrBpuC,KAAK8B,MAAMssC,GAAuBF,EAAWvuB,GACtD,CAGA,MAGMnI,EAAgB42B,GAHHC,EAAmBC,GAKtC,OAAOtuC,KAAK8B,MAAM0V,EACpB,EAUaG,EAAiCA,CAACV,EAAOm3B,KACpD,IAAKl+B,MAAMC,QAAQ8G,IAA2B,IAAjBA,EAAMzgB,OAAc,MAAO,GACxD,IAAK43C,GAAuBA,GAAuB,EAEjD,OAAOn3B,EAAMvhB,IAAIC,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBD,GAAI,IACP6hB,cAAe7hB,EAAK2mB,MAAQ,KAKhC,MAAMgyB,EAAoBr3B,EAAMxb,OAAO,CAACC,EAAK/F,IAGpC+F,GAFM/F,EAAK2mB,MAAQ,GACX2xB,EAAkBt4C,EAAK6M,UAErC,GAEH,GAA0B,IAAtB8rC,EAAyB,CAE3B,MAAMC,EAAevuC,KAAK8B,MAAMssC,EAAsBn3B,EAAMzgB,QAC5D,OAAOygB,EAAMvhB,IAAIC,IAAIC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAChBD,GAAI,IACP6hB,cAAe+2B,IAEnB,CAGA,IAAIC,EAAiBJ,EAuBrB,OAtBuBn3B,EAAMvhB,IAAI,CAACC,EAAM4I,KACtC,MAGMkwC,GAHO94C,EAAK2mB,MAAQ,GACX2xB,EAAkBt4C,EAAK6M,UAEJ8rC,EAElC,IAAI92B,EAUJ,OAPIjZ,IAAU0Y,EAAMzgB,OAAS,EAC3BghB,EAAgBg3B,GAEhBh3B,EAAgBxX,KAAK8B,MAAMssC,EAAsBK,GACjDD,GAAkBh3B,IAGpB5hB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKD,GAAI,IACP6hB,cAAexX,KAAKO,IAAI,EAAGiX,QA2BpBk3B,EAAuBA,CAACn3B,EAAcN,KACjD,MAAM03B,EAAkB13B,EAAMxb,OAAO,CAACC,EAAK/F,IAAS+F,GAAO/F,EAAK6hB,eAAiB,GAAI,GAC/Eo3B,EAAaD,EAAkBp3B,EAC/Bs3B,EAAiBt3B,EAAe,EAAKq3B,EAAar3B,EAAgB,IAAM,EAK9E,MAAO,CACLu3B,QAHc9uC,KAAKC,IAAI4uC,IAAmB,EAI1CD,aACAC,eAAgB7uC,KAAK8B,MAAuB,IAAjB+sC,GAAwB,IACnDF,kBACAp3B,gB,0DC1LJ,MAkVA,EAlVoB,SAAC9H,GAAoC,IAAzB2H,EAAW5J,UAAAhX,OAAA,QAAAkR,IAAA8F,UAAA,IAAAA,UAAA,GACzC,MAAOuhC,EAAUC,IAAej6C,EAAAA,EAAAA,UAAS,KAClCk6C,EAAWC,IAAgBn6C,EAAAA,EAAAA,WAAS,IAG3CM,EAAAA,EAAAA,WAAU,KACase,WACnB,GAAKlE,EAAL,CAEAy/B,GAAa,GAEb,IACE,GAAI93B,EAAa,CAEf,MAAQ+3B,QAASh4B,SAA0B,uCAC3C,GAAIA,EAAgBi4B,kBAAmB,CACrC,MAAM1mC,QAAeyO,EAAgBk4B,gBAAgB5/B,GACrD,GAAI/G,EAAO4kB,QACT0hB,EAAYtmC,EAAO4mC,QACnB7tC,QAAQC,IAAI,qEAADzH,OAA8DwV,EAAS,MAAAxV,OAAKyO,EAAO4mC,OAAO94C,OAAM,iBACtG,CAEL,MAAM+4C,EAAWp5B,aAAaU,QAAQ,aAAD5c,OAAcwV,IAEjDu/B,EADEO,EACUl5B,KAAKS,MAAMy4B,GAEX,GAEhB,CACF,KAAO,CAEL,MAAMA,EAAWp5B,aAAaU,QAAQ,aAAD5c,OAAcwV,IAEjDu/B,EADEO,EACUl5B,KAAKS,MAAMy4B,GAEX,GAEhB,CACF,KAAO,CAEL,MAAMA,EAAWp5B,aAAaU,QAAQ,aAAD5c,OAAcwV,IAEjDu/B,EADEO,EACUl5B,KAAKS,MAAMy4B,GAEX,GAEhB,CACF,CAAE,MAAO/qC,GACP/C,QAAQ+C,MAAM,2BAA4BA,GAE1C,MAAM+qC,EAAWp5B,aAAaU,QAAQ,aAAD5c,OAAcwV,IAC/C8/B,GACFP,EAAY34B,KAAKS,MAAMy4B,GAE3B,CAAC,QACCL,GAAa,EACf,CAjDsB,GAoDxBM,IACC,CAAC//B,EAAW2H,IAGf,MAAMq4B,GAAex7B,EAAAA,EAAAA,aAAYN,UAE/BwC,aAAaC,QAAQ,aAADnc,OAAcwV,GAAa4G,KAAKC,UAAU5U,IAI9DD,QAAQC,IAAI,6EAADzH,OAAiEwV,EAAS,MAAAxV,OAAKyH,EAAIlL,OAAM,cACnG,CAACiZ,IAGEigC,GAAsBz7B,EAAAA,EAAAA,aAAYN,UACtC,GAAKyD,EAEL,IACE,MAAQ+3B,QAASh4B,SAA0B,uCAC3C,GAAIA,EAAgBi4B,kBAAmB,CAErC,MAAM1mC,QAAeyO,EAAgBw4B,gBAAgBlgC,EAAW,CAACob,IAC7DniB,EAAO4kB,QACT7rB,QAAQC,IAAI,uDAADzH,OAAgD4wB,EAAM5mB,SAEjExC,QAAQoH,KAAK,mDAA0CH,EAAOlE,MAElE,CACF,CAAE,MAAOA,GACP/C,QAAQ+C,MAAM,sCAAuCA,EACvD,GACC,CAACiL,EAAW2H,IAGT8O,GAAgBjS,EAAAA,EAAAA,aAAYN,UAChC,MAAMi8B,GAAQh6C,EAAAA,EAAAA,GAAA,CACZZ,GAAImC,OAAOC,aACX2e,WAAW,IAAIze,MAAOC,cACtBkY,aACGob,GAaL,OAVAmkB,EAAYa,IACV,MAAMC,EAAa,CAACF,KAAaC,GAGjC,OADAJ,EAAaK,GACNA,IAITJ,EAAoBE,GAEbA,GACN,CAACngC,EAAWggC,EAAcC,IAGvBK,GAAyB97B,EAAAA,EAAAA,aAAY,CAAC+7B,EAAgBtH,EAAWxxB,KACrEgP,EAAc,CACZxiB,SAAU,iBACVO,OAAQ,iBACRvL,YAAY,oCAADuB,OAAsC+1C,EAAc,SAAA/1C,OAAQyuC,EAAS,KAChFkF,QAAS,CACPoC,iBACAtH,YACAhvC,YAAawd,EAAYtgB,KACzBid,QAASqD,EAAYrD,QACrB/W,OAAQoa,EAAYpa,QAEtBmzC,SAAU,OACVC,KAAMh5B,EAAYrD,SAAW,aAE9B,CAACqS,IAGEiqB,GAAwBl8B,EAAAA,EAAAA,aAAY,CAACm8B,EAAal5B,KACtDgP,EAAc,CACZxiB,SAAU,eACVO,OAAQ,UACRvL,YAAY,iBAADuB,OAAmBm2C,EAAYx5C,KAAI,YAC9Cg3C,QAAS,CACPhxB,cAAewzB,EAAYp7C,GAC3B4B,KAAMw5C,EAAYx5C,KAClBkG,OAAQszC,EAAYtzC,OACpBqS,OAAQihC,EAAYjhC,QAEtB8gC,SAAU,SACVC,KAAMh5B,EAAYrD,SAAW,aAE9B,CAACqS,IAGEmqB,GAAyBp8B,EAAAA,EAAAA,aAAY,CAACm8B,EAAaxE,EAAS10B,KAChEgP,EAAc,CACZxiB,SAAU,eACVO,OAAQ,WACRvL,YAAY,iBAADuB,OAAmBm2C,EAAYx5C,KAAI,gBAC9Cg3C,QAAS,CACPhxB,cAAewzB,EAAYp7C,GAC3B4B,KAAMw5C,EAAYx5C,KAClBg1C,QAASzyC,OAAOC,KAAKwyC,GACrB0E,eAAgB1E,GAElBqE,SAAU,SACVC,KAAMh5B,EAAYrD,SAAW,aAE9B,CAACqS,IAGEqqB,GAAiBt8B,EAAAA,EAAAA,aAAY,CAACrX,EAAMsa,KACxCgP,EAAc,CACZxiB,SAAU,OACVO,OAAQ,UACRvL,YAAY,WAADuB,OAAa2C,EAAKhG,KAAI,kBACjCg3C,QAAS,CACP4C,OAAQ5zC,EAAK5H,GACb4B,KAAMgG,EAAKhG,KACX65C,YAAa7zC,EAAK6zC,YAClBC,OAAQ9zC,EAAK8zC,OACbluC,SAAU5F,EAAK4F,UAEjBytC,SAA4B,SAAlBrzC,EAAK4F,SAAsB,OAAS,SAC9C0tC,KAAMh5B,EAAYrD,SAAW,aAE9B,CAACqS,IAGEyqB,GAAoB18B,EAAAA,EAAAA,aAAY,CAACxd,EAAMy1C,EAAMh1B,KACjD,MA2CM05B,EA3CW,CACf,iBAAkB,CAChB3sC,OAAQ,UACRvL,YAAY,oBAADuB,OAAsBiyC,EAAKxzC,YAAW,YACjDk1C,QAAS,CACPiD,KAAM3E,EAAKl3C,GACX0D,YAAawzC,EAAKxzC,YAClB0O,OAAQ8kC,EAAK9kC,OACb0pC,SAAU5E,EAAK4E,WAGnB,QAAW,CACT7sC,OAAQ,UACRvL,YAAY,aAADuB,OAAeiyC,EAAKxzC,YAAW,YAC1Ck1C,QAAS,CACPmD,UAAW7E,EAAKl3C,GAChB0D,YAAawzC,EAAKxzC,YAClB0O,OAAQ8kC,EAAK9kC,OACb4pC,UAAW9E,EAAK8E,YAGpB,QAAW,CACT/sC,OAAQ,UACRvL,YAAY,YAADuB,OAAciyC,EAAKxzC,YAAW,YACzCk1C,QAAS,CACPqD,UAAW/E,EAAKl3C,GAChB0D,YAAawzC,EAAKxzC,YAClB0O,OAAQ8kC,EAAK9kC,OACb0pC,SAAU5E,EAAK4E,WAGnB,SAAY,CACV7sC,OAAQ,UACRvL,YAAY,aAADuB,OAAeiyC,EAAKt1C,KAAI,YACnCg3C,QAAS,CACPsD,WAAYhF,EAAKl3C,GACjB4B,KAAMs1C,EAAKt1C,KACXpB,MAAO02C,EAAK12C,MACZ27C,WAAYjF,EAAKiF,cAKM16C,GACzBm6C,GACF1qB,EAAc,CACZxiB,SAAU,YACVO,OAAQ2sC,EAAY3sC,OACpBvL,YAAak4C,EAAYl4C,YACzBk1C,QAASgD,EAAYhD,QACrBqC,SAAU,OACVC,KAAMh5B,EAAYrD,SAAW,aAGhC,CAACqS,IAGEkrB,GAAwBn9B,EAAAA,EAAAA,aAAY,CAACtN,EAAYuQ,KACrDgP,EAAc,CACZxiB,SAAU,YACVO,OAAQ,WACRvL,YAAY,+BACZk1C,QAAS,CACPyD,aAAc1qC,EAAW3R,GACzBs8C,WAAY3qC,EAAW2qC,WACvBp2C,KAAMyL,EAAWzL,KACjBivB,WAAYxjB,EAAWwjB,YAEzB8lB,SAAU,SACVC,KAAMh5B,EAAYrD,SAAW,aAE9B,CAACqS,IAGEF,GAAuB/R,EAAAA,EAAAA,aAAY,CAACs9B,EAAYr6B,KACpDgP,EAAc,CACZxiB,SAAU,UACVO,OAAQ,sBACRvL,YAAY,oBAADuB,OAAsBs3C,EAAWt8C,MAAK,YACjD24C,QAAS,CACP1wB,OAAQq0B,EAAWv8C,GACnBC,MAAOs8C,EAAWt8C,MAClBC,YAAaq8C,EAAWr8C,YACxBC,MAAOo8C,EAAWp8C,MAClBC,OAAQm8C,EAAWn8C,OACnBoC,QAAS+5C,EAAW/5C,SAEtBy4C,SAAU,SACVC,KAAMh5B,EAAYrD,SAAW,aAE9B,CAACqS,IAGED,GAAuBhS,EAAAA,EAAAA,aAAY,CAACs9B,EAAY3F,EAAS10B,KAC7DgP,EAAc,CACZxiB,SAAU,UACVO,OAAQ,sBACRvL,YAAY,oBAADuB,OAAsBs3C,EAAWt8C,MAAK,iBACjD24C,QAAS,CACP1wB,OAAQq0B,EAAWv8C,GACnBC,MAAOs8C,EAAWt8C,MAClB22C,QAASA,EACTlD,UAAW6I,EAAW/5C,SAExBy4C,SAAU,SACVC,KAAMh5B,EAAYrD,SAAW,aAE9B,CAACqS,IAGEsrB,GAAgBv9B,EAAAA,EAAAA,aAAY,KAChC+6B,EAAY,IACZ74B,aAAaY,WAAW,aAAD9c,OAAcwV,KACpC,CAACA,IAGEgiC,GAAiBx9B,EAAAA,EAAAA,aAAY,KACjC,MAAMme,EAAa,CACjB3iB,YACAiiC,YAAY,IAAIp6C,MAAOC,cACvBo6C,YAAa5C,EAASv4C,OACtB84C,OAAQP,GAGJ6C,EAAUv7B,KAAKC,UAAU8b,EAAY,KAAM,GAC3Cyf,EAAW,IAAIC,KAAK,CAACF,GAAU,CAAEn7C,KAAM,qBAEvCs7C,EAAMrR,IAAIC,gBAAgBkR,GAC1BG,EAAO7iB,SAAS8iB,cAAc,KACpCD,EAAKE,KAAOH,EACZC,EAAKG,SAAQ,aAAAl4C,OAAgBwV,EAAS,KAAAxV,QAAI,IAAI3C,MAAOC,cAAcuc,MAAM,KAAK,GAAE,SAChFk+B,EAAK5R,QACLM,IAAIO,gBAAgB8Q,IACnB,CAAChD,EAAUt/B,IAEd,MAAO,CACLs/B,WACAE,YACA/oB,gBACA6pB,yBACAI,wBACAE,yBACAE,iBACAI,oBACAS,wBACAprB,uBACAC,uBACAurB,gBACAC,iBAEJ,C","sources":["components/MinutaModal.js","components/EditMinutaModal.js","components/ai-scheduler/ProjectAnalysisStep.js","components/ai-scheduler/ResourceConfigStep.js","components/ai-scheduler/MilestoneDefinitionStep.js","components/ai-scheduler/MachineryConfigStep.js","components/ai-scheduler/SchedulePreview.js","services/TemplateBasedSchedulerService.js","services/AISchedulerService.js","components/ai-scheduler/ScheduleWizard.js","hooks/useDebouncedSync.js","hooks/useBusinessValueSync.js","utils/scheduleConstants.js","utils/scheduleValidation.js","utils/scheduleDateUtils.js","utils/scheduleCPM.js","utils/scheduleResourceAnalysis.js","components/ScheduleManagement.js","utils/businessValueCalculator.js","hooks/useAuditLog.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\n\nconst MinutaModal = ({ isOpen, onClose, hitos, onSave }) => {\n  const [minutaTasks, setMinutaTasks] = useState([\n    { id: 1, tarea: '', responsable: '', fecha: '', hitoId: '' },\n    { id: 2, tarea: '', responsable: '', fecha: '', hitoId: '' },\n    { id: 3, tarea: '', responsable: '', fecha: '', hitoId: '' },\n    { id: 4, tarea: '', responsable: '', fecha: '', hitoId: '' },\n    { id: 5, tarea: '', responsable: '', fecha: '', hitoId: '' },\n    { id: 6, tarea: '', responsable: '', fecha: '', hitoId: '' }\n  ]);\n\n  // Resetear formulario cuando se abre el modal\n  useEffect(() => {\n    if (isOpen) {\n      setMinutaTasks([\n        { id: 1, tarea: '', responsable: '', fecha: '', hitoId: '' },\n        { id: 2, tarea: '', responsable: '', fecha: '', hitoId: '' },\n        { id: 3, tarea: '', responsable: '', fecha: '', hitoId: '' },\n        { id: 4, tarea: '', responsable: '', fecha: '', hitoId: '' },\n        { id: 5, tarea: '', responsable: '', fecha: '', hitoId: '' },\n        { id: 6, tarea: '', responsable: '', fecha: '', hitoId: '' }\n      ]);\n    }\n  }, [isOpen]);\n\n  const handleInputChange = (id, field, value) => {\n    setMinutaTasks(prev =>\n      prev.map(task =>\n        task.id === id ? { ...task, [field]: value } : task\n      )\n    );\n  };\n\n  const handleSave = () => {\n    // Filtrar tareas que tienen al menos la descripcin de la tarea\n    const tareasValidas = minutaTasks.filter(task => task.tarea.trim() !== '');\n\n    if (tareasValidas.length === 0) {\n      alert('Debe agregar al menos una tarea para guardar la minuta.');\n      return;\n    }\n\n    // Validar que las tareas vlidas tengan todos los campos requeridos\n    const tareasIncompletas = tareasValidas.filter(task =>\n      !task.responsable.trim() || !task.fecha || !task.hitoId\n    );\n\n    if (tareasIncompletas.length > 0) {\n      alert('Todas las tareas deben tener: Responsable, Fecha y Hito relacionado.');\n      return;\n    }\n\n    // Agregar metadata a las tareas\n    const tareasConMetadata = tareasValidas.map(task => ({\n      ...task,\n      id: crypto.randomUUID(), // Generar UUID vlido para Supabase\n      fechaCreacion: new Date().toISOString(),\n      estatus: 'Pendiente' // Estado inicial\n    }));\n\n    onSave(tareasConMetadata);\n    onClose();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 p-6 max-h-[90vh] overflow-y-auto\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <h2 className=\"text-2xl font-bold text-gray-900\"> Nueva Minuta</h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 text-2xl font-bold\"\n          >\n            \n          </button>\n        </div>\n\n        <div className=\"mb-4\">\n          <p className=\"text-gray-600 text-sm\">\n            Complete las tareas derivadas de la reunin. Los campos marcados son obligatorios.\n          </p>\n        </div>\n\n        {/* Tabla de tareas */}\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full border-collapse border border-gray-300\">\n            <thead>\n              <tr className=\"bg-blue-50\">\n                <th className=\"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700\">\n                  #\n                </th>\n                <th className=\"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700\">\n                  Tarea *\n                </th>\n                <th className=\"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700\">\n                  Responsable *\n                </th>\n                <th className=\"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700\">\n                  Fecha *\n                </th>\n                <th className=\"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700\">\n                  Hito relacionado *\n                </th>\n              </tr>\n            </thead>\n            <tbody>\n              {minutaTasks.map((task) => (\n                <tr key={task.id} className=\"hover:bg-gray-50\">\n                  <td className=\"border border-gray-300 px-4 py-3 text-center font-medium text-gray-600\">\n                    {task.id}\n                  </td>\n                  <td className=\"border border-gray-300 px-2 py-2\">\n                    <textarea\n                      value={task.tarea}\n                      onChange={(e) => handleInputChange(task.id, 'tarea', e.target.value)}\n                      placeholder=\"Descripcin de la tarea...\"\n                      maxLength={70}\n                      rows={2}\n                      className=\"w-full p-2 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-sm\"\n                    />\n                    <div className=\"text-xs text-gray-500 mt-1\">\n                      {task.tarea.length}/70 caracteres\n                    </div>\n                  </td>\n                  <td className=\"border border-gray-300 px-2 py-2\">\n                    <input\n                      type=\"text\"\n                      value={task.responsable}\n                      onChange={(e) => handleInputChange(task.id, 'responsable', e.target.value)}\n                      placeholder=\"Nombre del responsable\"\n                      className=\"w-full p-2 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"\n                    />\n                  </td>\n                  <td className=\"border border-gray-300 px-2 py-2\">\n                    <input\n                      type=\"date\"\n                      value={task.fecha}\n                      onChange={(e) => handleInputChange(task.id, 'fecha', e.target.value)}\n                      className=\"w-full p-2 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"\n                    />\n                  </td>\n                  <td className=\"border border-gray-300 px-2 py-2\">\n                    <select\n                      value={task.hitoId}\n                      onChange={(e) => handleInputChange(task.id, 'hitoId', e.target.value)}\n                      className=\"w-full p-2 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"\n                    >\n                      <option value=\"\">Seleccionar hito...</option>\n                      {hitos.map((hito) => (\n                        <option key={hito.id} value={hito.id}>\n                          {hito.wbsCode} - {hito.name}\n                        </option>\n                      ))}\n                    </select>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n\n        {/* Botones */}\n        <div className=\"flex justify-end space-x-4 mt-6\">\n          <button\n            onClick={onClose}\n            className=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\n          >\n            Cancelar\n          </button>\n          <button\n            onClick={handleSave}\n            className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n          >\n             Guardar Minuta\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MinutaModal;","import React, { useState, useEffect } from 'react';\n\nconst EditMinutaModal = ({ isOpen, onClose, minuta, hitos, onUpdate }) => {\n  const [editedMinuta, setEditedMinuta] = useState({\n    id: '',\n    tarea: '',\n    responsable: '',\n    fecha: '',\n    hitoId: '',\n    estatus: 'Pendiente'\n  });\n\n  // Cargar datos de la minuta cuando el modal se abre\n  useEffect(() => {\n    if (isOpen && minuta) {\n      setEditedMinuta({\n        id: minuta.id,\n        tarea: minuta.tarea || '',\n        responsable: minuta.responsable || '',\n        fecha: minuta.fecha || '',\n        hitoId: minuta.hitoId || '',\n        estatus: minuta.estatus || 'Pendiente'\n      });\n    }\n  }, [isOpen, minuta]);\n\n  const handleInputChange = (field, value) => {\n    setEditedMinuta(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  const handleSave = () => {\n    // Validar campos requeridos\n    if (!editedMinuta.tarea.trim()) {\n      alert('La tarea es requerida');\n      return;\n    }\n\n    if (!editedMinuta.responsable.trim()) {\n      alert('El responsable es requerido');\n      return;\n    }\n\n    if (!editedMinuta.fecha) {\n      alert('La fecha es requerida');\n      return;\n    }\n\n    if (!editedMinuta.hitoId) {\n      alert('El hito relacionado es requerido');\n      return;\n    }\n\n    // Llamar a la funcin de actualizacin\n    onUpdate(editedMinuta);\n    onClose();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 p-6\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <h2 className=\"text-2xl font-bold text-gray-900\"> Editar Minuta</h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 text-2xl font-bold\"\n          >\n            \n          </button>\n        </div>\n\n        <div className=\"space-y-4\">\n          {/* Campo Tarea */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Tarea *\n            </label>\n            <textarea\n              value={editedMinuta.tarea}\n              onChange={(e) => handleInputChange('tarea', e.target.value)}\n              placeholder=\"Descripcin de la tarea...\"\n              maxLength={70}\n              rows={3}\n              className=\"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none\"\n            />\n            <div className=\"text-xs text-gray-500 mt-1\">\n              {editedMinuta.tarea.length}/70 caracteres\n            </div>\n          </div>\n\n          {/* Campo Responsable */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Responsable *\n            </label>\n            <input\n              type=\"text\"\n              value={editedMinuta.responsable}\n              onChange={(e) => handleInputChange('responsable', e.target.value)}\n              placeholder=\"Nombre del responsable\"\n              className=\"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          {/* Campo Fecha */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Fecha *\n            </label>\n            <input\n              type=\"date\"\n              value={editedMinuta.fecha}\n              onChange={(e) => handleInputChange('fecha', e.target.value)}\n              className=\"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          {/* Campo Hito */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Hito relacionado *\n            </label>\n            <select\n              value={editedMinuta.hitoId}\n              onChange={(e) => handleInputChange('hitoId', e.target.value)}\n              className=\"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"\">Seleccionar hito...</option>\n              {hitos.map((hito) => (\n                <option key={hito.id} value={hito.id}>\n                  {hito.wbsCode} - {hito.name}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          {/* Campo Estatus */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Estatus\n            </label>\n            <select\n              value={editedMinuta.estatus}\n              onChange={(e) => handleInputChange('estatus', e.target.value)}\n              className=\"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"Pendiente\">Pendiente</option>\n              <option value=\"En Proceso\">En Proceso</option>\n              <option value=\"Completado\">Completado</option>\n            </select>\n          </div>\n        </div>\n\n        {/* Botones */}\n        <div className=\"flex justify-end space-x-4 mt-6\">\n          <button\n            onClick={onClose}\n            className=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\n          >\n            Cancelar\n          </button>\n          <button\n            onClick={handleSave}\n            className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n          >\n             Guardar Cambios\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default EditMinutaModal;","/**\n * ProjectAnalysisStep - Paso 1 del wizard: Anlisis del Proyecto\n * StrategiaPM - MVP Implementation\n */\n\nimport React, { useState, useEffect } from 'react';\n\nconst ProjectAnalysisStep = ({ wizardData, onUpdate, availableTemplates }) => {\n  const [selectedTemplate, setSelectedTemplate] = useState(null);\n  const [customProjectType, setCustomProjectType] = useState('');\n\n  // Opciones predefinidas\n  const projectTypes = [\n    { value: 'development', label: 'Desarrollo de Software', icon: '' },\n    { value: 'equipment_installation', label: 'Compra e Instalacin de Equipos', icon: '' },\n    { value: 'construction', label: 'Construccin', icon: '' },\n    { value: 'campaign', label: 'Campaa de Marketing', icon: '' },\n    { value: 'research', label: 'Proyecto de Investigacin', icon: '' },\n    { value: 'custom', label: 'Personalizado', icon: '' }\n  ];\n\n  const methodologies = [\n    { value: 'agile', label: 'Agile/Scrum', description: 'Iterativo, adaptativo' },\n    { value: 'waterfall', label: 'Waterfall', description: 'Secuencial, planificado' },\n    { value: 'hybrid', label: 'Hbrido', description: 'Combinacin de ambos' },\n    { value: 'kanban', label: 'Kanban', description: 'Flujo continuo' }\n  ];\n\n  const industries = [\n    { value: 'software', label: 'Software/Tecnologa' },\n    { value: 'equipment', label: 'Maquinaria/Equipos' },\n    { value: 'construction', label: 'Construccin' },\n    { value: 'marketing', label: 'Marketing/Publicidad' },\n    { value: 'research', label: 'Investigacin/Desarrollo' },\n    { value: 'manufacturing', label: 'Manufactura' },\n    { value: 'services', label: 'Servicios' },\n    { value: 'other', label: 'Otro' }\n  ];\n\n  // Efecto para actualizar datos cuando cambia el template seleccionado\n  useEffect(() => {\n    if (selectedTemplate) {\n      // Solo actualizar si los valores han cambiado realmente\n      const newData = {\n        projectType: selectedTemplate.project_type,\n        industry: selectedTemplate.industry,\n        methodology: selectedTemplate.methodology,\n        templateId: selectedTemplate.id,\n        templateName: selectedTemplate.name\n      };\n      \n      // Verificar si realmente hay cambios antes de actualizar\n      const hasChanges = Object.keys(newData).some(key => \n        wizardData[key] !== newData[key]\n      );\n      \n      if (hasChanges) {\n        onUpdate(newData);\n      }\n    }\n  }, [selectedTemplate]); // Remover onUpdate de las dependencias\n\n  // Efecto para manejar tipo de proyecto personalizado\n  useEffect(() => {\n    if (wizardData.projectType === 'custom' && customProjectType) {\n      const newProjectType = customProjectType.toLowerCase().replace(/\\s+/g, '_');\n      \n      // Solo actualizar si el valor ha cambiado\n      if (wizardData.customProjectType !== customProjectType) {\n        onUpdate({\n          projectType: newProjectType,\n          customProjectType: customProjectType\n        });\n      }\n    }\n  }, [customProjectType, wizardData.projectType]); // Remover onUpdate de las dependencias\n\n  const handleProjectTypeChange = (projectType) => {\n    onUpdate({ projectType });\n    \n    // Buscar template que coincida con el tipo de proyecto\n    const matchingTemplate = availableTemplates.find(template => \n      template.project_type === projectType\n    );\n    \n    if (matchingTemplate) {\n      setSelectedTemplate(matchingTemplate);\n    } else {\n      setSelectedTemplate(null);\n    }\n  };\n\n  const handleTemplateSelect = (template) => {\n    setSelectedTemplate(template);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <h3 className=\"text-xl font-semibold text-gray-800 mb-2\">\n           Anlisis del Proyecto\n        </h3>\n        <p className=\"text-gray-600\">\n          Proporciona informacin bsica sobre tu proyecto para generar el cronograma ms apropiado\n        </p>\n      </div>\n\n      {/* Informacin del Proyecto */}\n      <div className=\"bg-gray-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Informacin Bsica\n        </h4>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Nombre del Proyecto *\n            </label>\n            <input\n              type=\"text\"\n              value={wizardData.projectName || ''}\n              onChange={(e) => onUpdate({ projectName: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"Ej: Sistema de Gestin de Inventarios\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Gerente del Proyecto\n            </label>\n            <input\n              type=\"text\"\n              value={wizardData.projectManager || ''}\n              onChange={(e) => onUpdate({ projectManager: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"Ej: Juan Prez\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-4\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Descripcin del Proyecto\n          </label>\n          <textarea\n            value={wizardData.projectDescription || ''}\n            onChange={(e) => onUpdate({ projectDescription: e.target.value })}\n            rows={3}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n            placeholder=\"Describe brevemente los objetivos y alcance del proyecto...\"\n          />\n        </div>\n      </div>\n\n      {/* Tipo de Proyecto */}\n      <div className=\"bg-blue-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Tipo de Proyecto *\n        </h4>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n          {projectTypes.map((type) => (\n            <button\n              key={type.value}\n              onClick={() => handleProjectTypeChange(type.value)}\n              className={`p-4 rounded-lg border-2 transition-all text-left ${\n                wizardData.projectType === type.value\n                  ? 'border-purple-500 bg-purple-50 text-purple-800'\n                  : 'border-gray-200 hover:border-purple-300 hover:bg-purple-25'\n              }`}\n            >\n              <div className=\"flex items-center\">\n                <span className=\"text-2xl mr-3\">{type.icon}</span>\n                <div>\n                  <div className=\"font-semibold\">{type.label}</div>\n                  {type.value === 'equipment_installation' && (\n                    <div className=\"text-sm text-gray-600 mt-1\">\n                      Incluye compra, instalacin y puesta en marcha\n                    </div>\n                  )}\n                </div>\n              </div>\n            </button>\n          ))}\n        </div>\n\n        {/* Campo personalizado */}\n        {wizardData.projectType === 'custom' && (\n          <div className=\"mt-4\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Especifica el tipo de proyecto\n            </label>\n            <input\n              type=\"text\"\n              value={customProjectType}\n              onChange={(e) => setCustomProjectType(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"Ej: Migracin de Datos, Implementacin de ERP\"\n            />\n          </div>\n        )}\n      </div>\n\n      {/* Industria */}\n      <div className=\"bg-green-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Industria\n        </h4>\n        \n        <select\n          value={wizardData.industry || ''}\n          onChange={(e) => onUpdate({ industry: e.target.value })}\n          className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n        >\n          <option value=\"\">Selecciona una industria</option>\n          {industries.map((industry) => (\n            <option key={industry.value} value={industry.value}>\n              {industry.label}\n            </option>\n          ))}\n        </select>\n      </div>\n\n      {/* Metodologa */}\n      <div className=\"bg-yellow-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Metodologa Preferida\n        </h4>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n          {methodologies.map((method) => (\n            <button\n              key={method.value}\n              onClick={() => onUpdate({ methodology: method.value })}\n              className={`p-4 rounded-lg border-2 transition-all text-left ${\n                wizardData.methodology === method.value\n                  ? 'border-purple-500 bg-purple-50 text-purple-800'\n                  : 'border-gray-200 hover:border-purple-300 hover:bg-purple-25'\n              }`}\n            >\n              <div className=\"font-semibold\">{method.label}</div>\n              <div className=\"text-sm text-gray-600 mt-1\">{method.description}</div>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Templates Disponibles */}\n      {availableTemplates.length > 0 && (\n        <div className=\"bg-purple-50 rounded-lg p-6\">\n          <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n            <span className=\"text-xl mr-2\"></span>\n            Templates Disponibles\n          </h4>\n          \n          <div className=\"space-y-3\">\n            {availableTemplates\n              .filter(template => \n                !wizardData.projectType || \n                template.project_type === wizardData.projectType ||\n                template.industry === wizardData.industry\n              )\n              .map((template) => (\n                <button\n                  key={template.id}\n                  onClick={() => handleTemplateSelect(template)}\n                  className={`w-full p-4 rounded-lg border-2 transition-all text-left ${\n                    selectedTemplate?.id === template.id\n                      ? 'border-purple-500 bg-purple-100 text-purple-800'\n                      : 'border-gray-200 hover:border-purple-300 hover:bg-purple-25'\n                  }`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <div className=\"font-semibold\">{template.name}</div>\n                      <div className=\"text-sm text-gray-600 mt-1\">\n                        {template.description}\n                      </div>\n                      <div className=\"text-xs text-gray-500 mt-1\">\n                        {template.methodology}  {template.estimated_duration_days} das  \n                        Equipo: {template.team_size_min}-{template.team_size_max} personas\n                      </div>\n                    </div>\n                    {selectedTemplate?.id === template.id && (\n                      <span className=\"text-purple-600 text-xl\"></span>\n                    )}\n                  </div>\n                </button>\n              ))}\n          </div>\n        </div>\n      )}\n\n      {/* Fechas del Proyecto */}\n      <div className=\"bg-orange-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Fechas del Proyecto\n        </h4>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Fecha de Inicio\n            </label>\n            <input\n              type=\"date\"\n              value={wizardData.startDate || ''}\n              onChange={(e) => onUpdate({ startDate: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Fecha Lmite (Opcional)\n            </label>\n            <input\n              type=\"date\"\n              value={wizardData.endDate || ''}\n              onChange={(e) => onUpdate({ endDate: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Resumen de Seleccin */}\n      {(wizardData.projectName || wizardData.projectType) && (\n        <div className=\"bg-gray-100 rounded-lg p-4\">\n          <h5 className=\"font-semibold text-gray-800 mb-2\">Resumen de Seleccin:</h5>\n          <div className=\"text-sm text-gray-600 space-y-1\">\n            {wizardData.projectName && <div> Proyecto: {wizardData.projectName}</div>}\n            {wizardData.projectType && <div> Tipo: {projectTypes.find(t => t.value === wizardData.projectType)?.label}</div>}\n            {wizardData.industry && <div> Industria: {industries.find(i => i.value === wizardData.industry)?.label}</div>}\n            {wizardData.methodology && <div> Metodologa: {methodologies.find(m => m.value === wizardData.methodology)?.label}</div>}\n            {selectedTemplate && <div> Template: {selectedTemplate.name}</div>}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ProjectAnalysisStep;\n","/**\n * ResourceConfigStep - Paso 2 del wizard: Configuracin de Recursos\n * StrategiaPM - MVP Implementation\n */\n\nimport React, { useState, useEffect } from 'react';\n\nconst ResourceConfigStep = ({ wizardData, onUpdate }) => {\n  const [teamMembers, setTeamMembers] = useState([]);\n  const [newMember, setNewMember] = useState({ name: '', role: '', experience: 'intermediate' });\n\n  // Opciones predefinidas\n  const experienceLevels = [\n    { value: 'junior', label: 'Junior (0-2 aos)', description: 'Recin iniciado, necesita supervisin' },\n    { value: 'intermediate', label: 'Intermedio (2-5 aos)', description: 'Experiencia moderada, trabajo independiente' },\n    { value: 'senior', label: 'Senior (5-10 aos)', description: 'Experiencia slida, puede liderar' },\n    { value: 'expert', label: 'Experto (10+ aos)', description: 'Experiencia avanzada, mentora' }\n  ];\n\n  const teamRoles = [\n    { value: 'project_manager', label: 'Project Manager', icon: '' },\n    { value: 'team_lead', label: 'Team Lead', icon: '' },\n    { value: 'buyer', label: 'Comprador(a)', icon: '' },\n    { value: 'developer', label: 'Desarrollador', icon: '' },\n    { value: 'designer', label: 'Diseador', icon: '' },\n    { value: 'qa_tester', label: 'QA/Tester', icon: '' },\n    { value: 'devops', label: 'DevOps', icon: '' },\n    { value: 'analyst', label: 'Analista', icon: '' },\n    { value: 'engineer', label: 'Ingeniero', icon: '' },\n    { value: 'technician', label: 'Tcnico', icon: '' },\n    { value: 'specialist', label: 'Especialista', icon: '' },\n    { value: 'other', label: 'Otro', icon: '' }\n  ];\n\n  const riskTolerances = [\n    { value: 'low', label: 'Bajo', description: 'Prefiero estimaciones conservadoras con ms tiempo' },\n    { value: 'medium', label: 'Medio', description: 'Equilibrio entre tiempo y riesgo' },\n    { value: 'high', label: 'Alto', description: 'Estimaciones agresivas, menos tiempo' }\n  ];\n\n  // Efecto para calcular experiencia promedio del equipo\n  useEffect(() => {\n    if (teamMembers.length > 0) {\n      const experienceScores = {\n        'junior': 1,\n        'intermediate': 2,\n        'senior': 3,\n        'expert': 4\n      };\n\n      const totalScore = teamMembers.reduce((sum, member) => \n        sum + (experienceScores[member.experience] || 2), 0\n      );\n      \n      const averageScore = totalScore / teamMembers.length;\n      let teamExperience = 'intermediate';\n      \n      if (averageScore <= 1.5) teamExperience = 'junior';\n      else if (averageScore >= 3.5) teamExperience = 'expert';\n      else if (averageScore >= 2.5) teamExperience = 'senior';\n\n      onUpdate({ \n        teamSize: teamMembers.length,\n        teamExperience: teamExperience,\n        teamMembers: teamMembers\n      });\n    } else {\n      onUpdate({ \n        teamSize: wizardData.teamSize || 1,\n        teamExperience: wizardData.teamExperience || 'intermediate',\n        teamMembers: []\n      });\n    }\n  }, [teamMembers]); // CORRECCIN: Remover onUpdate para evitar bucle infinito\n\n  // Agregar miembro al equipo\n  const addTeamMember = () => {\n    if (newMember.name.trim() && newMember.role) {\n      const member = {\n        id: Date.now(),\n        name: newMember.name.trim(),\n        role: newMember.role,\n        experience: newMember.experience\n      };\n      \n      setTeamMembers(prev => [...prev, member]);\n      setNewMember({ name: '', role: '', experience: 'intermediate' });\n    }\n  };\n\n  // Remover miembro del equipo\n  const removeTeamMember = (memberId) => {\n    setTeamMembers(prev => prev.filter(member => member.id !== memberId));\n  };\n\n  // Obtener icono del rol\n  const getRoleIcon = (roleValue) => {\n    const role = teamRoles.find(r => r.value === roleValue);\n    return role ? role.icon : '';\n  };\n\n  // Obtener etiqueta del rol\n  const getRoleLabel = (roleValue) => {\n    const role = teamRoles.find(r => r.value === roleValue);\n    return role ? role.label : roleValue;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <h3 className=\"text-xl font-semibold text-gray-800 mb-2\">\n           Configuracin de Recursos\n        </h3>\n        <p className=\"text-gray-600\">\n          Define el equipo y recursos disponibles para optimizar el cronograma\n        </p>\n      </div>\n\n      {/* Tamao del Equipo */}\n      <div className=\"bg-blue-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Tamao del Equipo\n        </h4>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((size) => (\n            <button\n              key={size}\n              onClick={() => onUpdate({ teamSize: size })}\n              className={`p-4 rounded-lg border-2 transition-all text-center ${\n                wizardData.teamSize === size\n                  ? 'border-blue-500 bg-blue-100 text-blue-800'\n                  : 'border-gray-200 hover:border-blue-300 hover:bg-blue-25'\n              }`}\n            >\n              <div className=\"text-2xl font-bold\">{size}</div>\n              <div className=\"text-sm text-gray-600\">\n                {size === 1 ? 'persona' : 'personas'}\n              </div>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Composicin del Equipo */}\n      <div className=\"bg-green-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Composicin del Equipo\n        </h4>\n        \n        {/* Agregar miembro */}\n        <div className=\"bg-white rounded-lg p-4 mb-4 border border-gray-200\">\n          <h5 className=\"font-semibold text-gray-700 mb-3\">Agregar Miembro del Equipo</h5>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Nombre\n              </label>\n              <input\n                type=\"text\"\n                value={newMember.name}\n                onChange={(e) => setNewMember(prev => ({ ...prev, name: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                placeholder=\"Ej: Mara Garca\"\n              />\n            </div>\n            \n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Rol\n              </label>\n              <select\n                value={newMember.role}\n                onChange={(e) => setNewMember(prev => ({ ...prev, role: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n              >\n                <option value=\"\">Seleccionar rol</option>\n                {teamRoles.map((role) => (\n                  <option key={role.value} value={role.value}>\n                    {role.icon} {role.label}\n                  </option>\n                ))}\n              </select>\n            </div>\n            \n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Experiencia\n              </label>\n              <select\n                value={newMember.experience}\n                onChange={(e) => setNewMember(prev => ({ ...prev, experience: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n              >\n                {experienceLevels.map((level) => (\n                  <option key={level.value} value={level.value}>\n                    {level.label}\n                  </option>\n                ))}\n              </select>\n            </div>\n          </div>\n          \n          <button\n            onClick={addTeamMember}\n            disabled={!newMember.name.trim() || !newMember.role}\n            className=\"mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors\"\n          >\n            + Agregar Miembro\n          </button>\n        </div>\n\n        {/* Lista de miembros */}\n        {teamMembers.length > 0 && (\n          <div className=\"space-y-2\">\n            <h5 className=\"font-semibold text-gray-700\">Miembros del Equipo ({teamMembers.length})</h5>\n            {teamMembers.map((member) => (\n              <div key={member.id} className=\"bg-white rounded-lg p-3 border border-gray-200 flex items-center justify-between\">\n                <div className=\"flex items-center\">\n                  <span className=\"text-xl mr-3\">{getRoleIcon(member.role)}</span>\n                  <div>\n                    <div className=\"font-semibold\">{member.name}</div>\n                    <div className=\"text-sm text-gray-600\">\n                      {getRoleLabel(member.role)}  {experienceLevels.find(e => e.value === member.experience)?.label}\n                    </div>\n                  </div>\n                </div>\n                <button\n                  onClick={() => removeTeamMember(member.id)}\n                  className=\"text-red-500 hover:text-red-700 transition-colors\"\n                >\n                  \n                </button>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Experiencia del Equipo */}\n      <div className=\"bg-yellow-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Nivel de Experiencia del Equipo\n        </h4>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n          {experienceLevels.map((level) => (\n            <button\n              key={level.value}\n              onClick={() => onUpdate({ teamExperience: level.value })}\n              className={`p-4 rounded-lg border-2 transition-all text-left ${\n                wizardData.teamExperience === level.value\n                  ? 'border-yellow-500 bg-yellow-100 text-yellow-800'\n                  : 'border-gray-200 hover:border-yellow-300 hover:bg-yellow-25'\n              }`}\n            >\n              <div className=\"font-semibold\">{level.label}</div>\n              <div className=\"text-sm text-gray-600 mt-1\">{level.description}</div>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Disponibilidad del Equipo */}\n      <div className=\"bg-purple-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Disponibilidad del Equipo\n        </h4>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {[\n            { value: 25, label: '25%', description: 'Tiempo parcial' },\n            { value: 50, label: '50%', description: 'Medio tiempo' },\n            { value: 75, label: '75%', description: 'Tiempo completo' },\n            { value: 100, label: '100%', description: 'Dedicacin total' }\n          ].map((availability) => (\n            <button\n              key={availability.value}\n              onClick={() => onUpdate({ teamAvailability: availability.value })}\n              className={`p-4 rounded-lg border-2 transition-all text-center ${\n                wizardData.teamAvailability === availability.value\n                  ? 'border-purple-500 bg-purple-100 text-purple-800'\n                  : 'border-gray-200 hover:border-purple-300 hover:bg-purple-25'\n              }`}\n            >\n              <div className=\"text-2xl font-bold\">{availability.label}</div>\n              <div className=\"text-sm text-gray-600\">{availability.description}</div>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Tolerancia al Riesgo */}\n      <div className=\"bg-red-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Tolerancia al Riesgo\n        </h4>\n        \n        <div className=\"space-y-3\">\n          {riskTolerances.map((risk) => (\n            <button\n              key={risk.value}\n              onClick={() => onUpdate({ riskTolerance: risk.value })}\n              className={`w-full p-4 rounded-lg border-2 transition-all text-left ${\n                wizardData.riskTolerance === risk.value\n                  ? 'border-red-500 bg-red-100 text-red-800'\n                  : 'border-gray-200 hover:border-red-300 hover:bg-red-25'\n              }`}\n            >\n              <div className=\"font-semibold\">{risk.label}</div>\n              <div className=\"text-sm text-gray-600 mt-1\">{risk.description}</div>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Presupuesto */}\n      <div className=\"bg-indigo-50 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-xl mr-2\"></span>\n          Presupuesto del Proyecto\n        </h4>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Presupuesto Total (USD)\n            </label>\n            <input\n              type=\"number\"\n              value={wizardData.budget || ''}\n              onChange={(e) => onUpdate({ budget: parseFloat(e.target.value) || 0 })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n              placeholder=\"Ej: 50000\"\n            />\n          </div>\n          \n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Presupuesto por Mes (USD)\n            </label>\n            <input\n              type=\"number\"\n              value={wizardData.monthlyBudget || ''}\n              onChange={(e) => onUpdate({ monthlyBudget: parseFloat(e.target.value) || 0 })}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n              placeholder=\"Ej: 10000\"\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Resumen de Configuracin */}\n      <div className=\"bg-gray-100 rounded-lg p-4\">\n        <h5 className=\"font-semibold text-gray-800 mb-2\">Resumen de Configuracin:</h5>\n        <div className=\"text-sm text-gray-600 space-y-1\">\n          <div> Equipo: {wizardData.teamSize || 1} personas</div>\n          <div> Experiencia: {experienceLevels.find(e => e.value === wizardData.teamExperience)?.label}</div>\n          {wizardData.teamAvailability && <div> Disponibilidad: {wizardData.teamAvailability}%</div>}\n          {wizardData.riskTolerance && <div> Riesgo: {riskTolerances.find(r => r.value === wizardData.riskTolerance)?.label}</div>}\n          {wizardData.budget && <div> Presupuesto: ${wizardData.budget.toLocaleString()}</div>}\n          {teamMembers.length > 0 && <div> Miembros definidos: {teamMembers.length}</div>}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ResourceConfigStep;\n","// =====================================================\n// MILESTONE DEFINITION STEP COMPONENT\n// Paso del wizard para definir hitos del proyecto\n// =====================================================\n\nimport React, { useState, useEffect } from 'react';\n\nconst MilestoneDefinitionStep = ({ \n  wizardData, \n  onUpdate \n}) => {\n  const [milestones, setMilestones] = useState([]);\n  const [newMilestone, setNewMilestone] = useState('');\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Cargar hitos predefinidos basados en el tipo de proyecto\n  useEffect(() => {\n    const predefinedMilestones = getPredefinedMilestones(wizardData.projectType);\n    setMilestones(predefinedMilestones);\n  }, [wizardData.projectType]);\n\n  // Actualizar wizardData cuando cambien los hitos\n  useEffect(() => {\n    onUpdate({ milestones });\n  }, [milestones, onUpdate]);\n\n  // Obtener hitos predefinidos por tipo de proyecto\n  const getPredefinedMilestones = (projectType) => {\n    const milestoneTemplates = {\n      'construccion': [\n        { id: 'milestone-1', name: 'HITO: Aprobacin de planos', description: 'Aprobacin final de planos arquitectnicos y estructurales' },\n        { id: 'milestone-2', name: 'HITO: Inicio de obra', description: 'Inicio formal de la construccin' },\n        { id: 'milestone-3', name: 'HITO: Estructura terminada', description: 'Completar estructura principal' },\n        { id: 'milestone-4', name: 'HITO: Instalaciones completadas', description: 'Instalaciones elctricas, hidrulicas y sanitarias' },\n        { id: 'milestone-5', name: 'HITO: Obra terminada', description: 'Construccin completamente terminada' }\n      ],\n      'software': [\n        { id: 'milestone-1', name: 'HITO: Anlisis completado', description: 'Anlisis de requisitos y diseo de sistema' },\n        { id: 'milestone-2', name: 'HITO: Prototipo funcional', description: 'Primera versin funcional del software' },\n        { id: 'milestone-3', name: 'HITO: Desarrollo terminado', description: 'Desarrollo completo de funcionalidades' },\n        { id: 'milestone-4', name: 'HITO: Pruebas completadas', description: 'Testing y correccin de errores' },\n        { id: 'milestone-5', name: 'HITO: Despliegue en produccin', description: 'Lanzamiento oficial del software' }\n      ],\n      'manufactura': [\n        { id: 'milestone-1', name: 'HITO: Diseo de producto', description: 'Diseo final del producto a manufacturar' },\n        { id: 'milestone-2', name: 'HITO: Prototipo validado', description: 'Prototipo aprobado y validado' },\n        { id: 'milestone-3', name: 'HITO: Lnea de produccin', description: 'Configuracin de lnea de produccin' },\n        { id: 'milestone-4', name: 'HITO: Produccin piloto', description: 'Primera produccin de prueba' },\n        { id: 'milestone-5', name: 'HITO: Produccin en masa', description: 'Inicio de produccin comercial' }\n      ],\n      'general': [\n        { id: 'milestone-1', name: 'HITO: Proyecto iniciado', description: 'Kickoff formal del proyecto' },\n        { id: 'milestone-2', name: 'HITO: Planificacin completada', description: 'Plan detallado del proyecto aprobado' },\n        { id: 'milestone-3', name: 'HITO: Fase de ejecucin', description: 'Inicio de la fase principal de ejecucin' },\n        { id: 'milestone-4', name: 'HITO: Entregables completados', description: 'Todos los entregables principales terminados' },\n        { id: 'milestone-5', name: 'HITO: Proyecto cerrado', description: 'Cierre formal del proyecto' }\n      ]\n    };\n\n    return milestoneTemplates[projectType] || milestoneTemplates.general;\n  };\n\n  // Agregar nuevo hito\n  const addMilestone = () => {\n    if (!newMilestone.trim()) return;\n\n    const milestone = {\n      id: `milestone-${Date.now()}`,\n      name: newMilestone.trim(),\n      description: '',\n      isCustom: true\n    };\n\n    setMilestones(prev => [...prev, milestone]);\n    setNewMilestone('');\n    setShowAddForm(false);\n  };\n\n  // Eliminar hito\n  const removeMilestone = (milestoneId) => {\n    setMilestones(prev => prev.filter(m => m.id !== milestoneId));\n  };\n\n  // Editar hito\n  const editMilestone = (milestoneId, field, value) => {\n    setMilestones(prev => prev.map(m => \n      m.id === milestoneId ? { ...m, [field]: value } : m\n    ));\n  };\n\n  // Reordenar hitos\n  const reorderMilestones = (fromIndex, toIndex) => {\n    setMilestones(prev => {\n      const newMilestones = [...prev];\n      const [moved] = newMilestones.splice(fromIndex, 1);\n      newMilestones.splice(toIndex, 0, moved);\n      return newMilestones;\n    });\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      <div className=\"mb-8\">\n        <h2 className=\"text-3xl font-bold text-gray-800 mb-4 flex items-center\">\n          <span className=\"text-4xl mr-3\"></span>\n          Definir hitos del proyecto\n        </h2>\n        <p className=\"text-gray-600 text-lg leading-relaxed\">\n          Los hitos son puntos clave en tu proyecto que marcan el progreso y la entrega de resultados importantes. \n          Hemos predefinido algunos hitos comunes para tu tipo de proyecto, pero puedes personalizarlos.\n        </p>\n      </div>\n\n      {/* Lista de hitos */}\n      <div className=\"space-y-4 mb-6\">\n        {milestones.map((milestone, index) => (\n          <div key={milestone.id} className=\"bg-white border border-gray-200 rounded-lg p-4 shadow-sm\">\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center space-x-3 mb-2\">\n                  <span className=\"text-2xl\"></span>\n                  <div className=\"flex-1\">\n                    <input\n                      type=\"text\"\n                      value={milestone.name}\n                      onChange={(e) => editMilestone(milestone.id, 'name', e.target.value)}\n                      className=\"w-full text-lg font-semibold text-gray-800 border-none bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-2 py-1\"\n                      placeholder=\"Nombre del hito\"\n                    />\n                  </div>\n                </div>\n                \n                <textarea\n                  value={milestone.description}\n                  onChange={(e) => editMilestone(milestone.id, 'description', e.target.value)}\n                  className=\"w-full text-gray-600 border border-gray-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"Descripcin del hito (opcional)\"\n                  rows={2}\n                />\n                \n                {milestone.isCustom && (\n                  <div className=\"mt-2\">\n                    <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n                       Personalizado\n                    </span>\n                  </div>\n                )}\n              </div>\n              \n              <div className=\"flex items-center space-x-2 ml-4\">\n                {/* Botones de reordenar */}\n                {index > 0 && (\n                  <button\n                    onClick={() => reorderMilestones(index, index - 1)}\n                    className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                    title=\"Mover hacia arriba\"\n                  >\n                    \n                  </button>\n                )}\n                \n                {index < milestones.length - 1 && (\n                  <button\n                    onClick={() => reorderMilestones(index, index + 1)}\n                    className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                    title=\"Mover hacia abajo\"\n                  >\n                    \n                  </button>\n                )}\n                \n                {/* Botn eliminar */}\n                <button\n                  onClick={() => removeMilestone(milestone.id)}\n                  className=\"text-red-400 hover:text-red-600 transition-colors\"\n                  title=\"Eliminar hito\"\n                >\n                  \n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Agregar nuevo hito */}\n      {showAddForm ? (\n        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6\">\n          <h3 className=\"text-lg font-semibold text-blue-800 mb-3\">Agregar nuevo hito</h3>\n          <div className=\"space-y-3\">\n            <input\n              type=\"text\"\n              value={newMilestone}\n              onChange={(e) => setNewMilestone(e.target.value)}\n              className=\"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"Nombre del nuevo hito\"\n              onKeyPress={(e) => e.key === 'Enter' && addMilestone()}\n              autoFocus\n            />\n            <div className=\"flex space-x-3\">\n              <button\n                onClick={addMilestone}\n                disabled={!newMilestone.trim()}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n              >\n                Agregar hito\n              </button>\n              <button\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewMilestone('');\n                }}\n                className=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\n              >\n                Cancelar\n              </button>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <button\n          onClick={() => setShowAddForm(true)}\n          className=\"w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-colors\"\n        >\n          <span className=\"text-xl mr-2\"></span>\n          Agregar hito personalizado\n        </button>\n      )}\n\n      {/* Informacin adicional */}\n      <div className=\"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n        <h4 className=\"font-semibold text-yellow-800 mb-2 flex items-center\">\n          <span className=\"mr-2\"></span>\n          Consejos para definir hitos\n        </h4>\n        <ul className=\"text-sm text-yellow-700 space-y-1\">\n          <li> Los hitos deben ser medibles y verificables</li>\n          <li> Deben representar entregables tangibles</li>\n          <li> Considera las dependencias entre hitos</li>\n          <li> Incluye hitos de aprobacin y validacin</li>\n        </ul>\n      </div>\n\n      {/* Resumen */}\n      <div className=\"mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h4 className=\"font-semibold text-gray-800\">Resumen de hitos</h4>\n            <p className=\"text-gray-600 text-sm\">\n              {milestones.length} hitos definidos para el proyecto\n            </p>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-2xl font-bold text-gray-800\">{milestones.length}</div>\n            <div className=\"text-sm text-gray-500\">hitos</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MilestoneDefinitionStep;\n","/**\n * MachineryConfigStep - Paso especfico para configuracin de compra de maquinaria\n * StrategiaPM - MVP Implementation\n */\n\nimport React, { useState, useEffect } from 'react';\n\nconst MachineryConfigStep = ({ wizardData, onUpdate }) => {\n  const [machineryData, setMachineryData] = useState({\n    deliveryTime: wizardData.deliveryTime || '',\n    deliveryTimeUnit: wizardData.deliveryTimeUnit || 'weeks',\n    requiresInfrastructure: wizardData.requiresInfrastructure || false,\n    isForeignEquipment: wizardData.isForeignEquipment || false,\n    numberOfAdvancePayments: wizardData.numberOfAdvancePayments || 2,\n    advancePayments: wizardData.advancePayments || [\n      { percentage: 30, description: 'Anticipo inicial', timing: 'order' },\n      { percentage: 70, description: 'Pago final', timing: 'delivery' }\n    ]\n  });\n\n  const [errors, setErrors] = useState({});\n\n  useEffect(() => {\n    onUpdate(machineryData);\n  }, [machineryData, onUpdate]);\n\n  const handleInputChange = (field, value) => {\n    setMachineryData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n    \n    // Limpiar error si se corrige\n    if (errors[field]) {\n      setErrors(prev => ({\n        ...prev,\n        [field]: null\n      }));\n    }\n  };\n\n  const handleAdvancePaymentChange = (index, field, value) => {\n    const newAdvancePayments = [...machineryData.advancePayments];\n    newAdvancePayments[index] = {\n      ...newAdvancePayments[index],\n      [field]: value\n    };\n    \n    handleInputChange('advancePayments', newAdvancePayments);\n  };\n\n  const handleNumberOfAdvancePaymentsChange = (number) => {\n    handleInputChange('numberOfAdvancePayments', number);\n    \n    // Generar anticipos por defecto basados en el nmero seleccionado\n    const defaultPayments = generateDefaultPayments(number);\n    handleInputChange('advancePayments', defaultPayments);\n  };\n\n  const generateDefaultPayments = (number) => {\n    switch (number) {\n      case 1:\n        return [{ percentage: 100, description: 'Pago completo', timing: 'delivery' }];\n      case 2:\n        return [\n          { percentage: 30, description: 'Anticipo inicial', timing: 'order' },\n          { percentage: 70, description: 'Pago final', timing: 'delivery' }\n        ];\n      case 3:\n        return [\n          { percentage: 30, description: 'Anticipo inicial', timing: 'order' },\n          { percentage: 50, description: 'Pago pre-embarque', timing: 'shipping' },\n          { percentage: 20, description: 'Pago final', timing: 'delivery' }\n        ];\n      default:\n        return [\n          { percentage: 30, description: 'Anticipo inicial', timing: 'order' },\n          { percentage: 70, description: 'Pago final', timing: 'delivery' }\n        ];\n    }\n  };\n\n  const addAdvancePayment = () => {\n    const newAdvancePayments = [...machineryData.advancePayments, {\n      percentage: '',\n      description: '',\n      timing: 'order'\n    }];\n    handleInputChange('advancePayments', newAdvancePayments);\n  };\n\n  const removeAdvancePayment = (index) => {\n    if (machineryData.advancePayments.length > 1) {\n      const newAdvancePayments = machineryData.advancePayments.filter((_, i) => i !== index);\n      handleInputChange('advancePayments', newAdvancePayments);\n    }\n  };\n\n  const validateForm = () => {\n    const newErrors = {};\n    \n    if (!machineryData.deliveryTime || machineryData.deliveryTime <= 0) {\n      newErrors.deliveryTime = 'El tiempo de entrega es requerido';\n    }\n    \n    if (!machineryData.numberOfAdvancePayments || machineryData.numberOfAdvancePayments < 1) {\n      newErrors.numberOfAdvancePayments = 'Debe seleccionar al menos 1 anticipo';\n    }\n    \n    const totalPercentage = machineryData.advancePayments.reduce((sum, payment) => \n      sum + (parseFloat(payment.percentage) || 0), 0\n    );\n    \n    if (Math.abs(totalPercentage - 100) > 0.01) {\n      newErrors.advancePayments = 'Los anticipos deben sumar 100%';\n    }\n    \n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  useEffect(() => {\n    // Validar automticamente cuando cambien los datos\n    validateForm();\n  }, [machineryData]);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <h3 className=\"text-xl font-semibold text-gray-800 mb-2\">\n          Configuracin Especfica de Maquinaria\n        </h3>\n        <p className=\"text-gray-600\">\n          Configura los detalles especficos para la compra e instalacin de equipos\n        </p>\n      </div>\n\n      {/* Tiempo de entrega */}\n      <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\n        <h4 className=\"text-lg font-medium text-gray-800 mb-4\">\n           Tiempo de Entrega de Equipos\n        </h4>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Tiempo de entrega\n            </label>\n            <input\n              type=\"number\"\n              min=\"1\"\n              value={machineryData.deliveryTime}\n              onChange={(e) => handleInputChange('deliveryTime', parseInt(e.target.value) || '')}\n              className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${\n                errors.deliveryTime ? 'border-red-500' : 'border-gray-300'\n              }`}\n              placeholder=\"Ej: 12\"\n            />\n            {errors.deliveryTime && (\n              <p className=\"text-red-500 text-sm mt-1\">{errors.deliveryTime}</p>\n            )}\n          </div>\n          \n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Unidad de tiempo\n            </label>\n            <select\n              value={machineryData.deliveryTimeUnit}\n              onChange={(e) => handleInputChange('deliveryTimeUnit', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"days\">Das</option>\n              <option value=\"weeks\">Semanas</option>\n              <option value=\"months\">Meses</option>\n            </select>\n          </div>\n        </div>\n        \n        <p className=\"text-sm text-gray-500 mt-2\">\n          Este tiempo ser utilizado para ajustar la duracin de las actividades de compra y entrega.\n        </p>\n      </div>\n\n      {/* Requisitos especiales */}\n      <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\n        <h4 className=\"text-lg font-medium text-gray-800 mb-4\">\n           Requisitos Especiales\n        </h4>\n        \n        <div className=\"space-y-4\">\n          {/* Modificacin de infraestructura */}\n          <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-lg\">\n            <div>\n              <h5 className=\"font-medium text-gray-800\">\n                Requiere modificacin de infraestructura?\n              </h5>\n              <p className=\"text-sm text-gray-600\">\n                Preparacin del sitio, instalaciones elctricas, cimentaciones, etc.\n              </p>\n            </div>\n            <label className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                checked={machineryData.requiresInfrastructure}\n                onChange={(e) => handleInputChange('requiresInfrastructure', e.target.checked)}\n                className=\"w-5 h-5 text-blue-600 rounded focus:ring-blue-500\"\n              />\n              <span className=\"ml-2 text-sm text-gray-700\">S</span>\n            </label>\n          </div>\n\n          {/* Equipo extranjero */}\n          <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-lg\">\n            <div>\n              <h5 className=\"font-medium text-gray-800\">\n                El equipo viene del extranjero?\n              </h5>\n              <p className=\"text-sm text-gray-600\">\n                Incluir procesos de importacin, aduanas y documentacin\n              </p>\n            </div>\n            <label className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                checked={machineryData.isForeignEquipment}\n                onChange={(e) => handleInputChange('isForeignEquipment', e.target.checked)}\n                className=\"w-5 h-5 text-blue-600 rounded focus:ring-blue-500\"\n              />\n              <span className=\"ml-2 text-sm text-gray-700\">S</span>\n            </label>\n          </div>\n        </div>\n      </div>\n\n      {/* Anticipos */}\n      <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\n        <h4 className=\"text-lg font-medium text-gray-800 mb-4\">\n           Estructura de Anticipos\n        </h4>\n        \n        {/* Seleccin del nmero de anticipos */}\n        <div className=\"mb-6\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n            Cuntos anticipos tendr este proyecto?\n          </label>\n          <div className=\"grid grid-cols-3 gap-4\">\n            {[1, 2, 3].map((number) => (\n              <button\n                key={number}\n                type=\"button\"\n                onClick={() => handleNumberOfAdvancePaymentsChange(number)}\n                className={`p-4 border-2 rounded-lg text-center transition-colors ${\n                  machineryData.numberOfAdvancePayments === number\n                    ? 'border-blue-500 bg-blue-50 text-blue-700'\n                    : 'border-gray-300 hover:border-blue-300 text-gray-700'\n                }`}\n              >\n                <div className=\"font-semibold text-lg\">{number}</div>\n                <div className=\"text-sm\">\n                  {number === 1 ? 'Pago nico' : \n                   number === 2 ? 'Dos anticipos' : \n                   'Tres anticipos'}\n                </div>\n              </button>\n            ))}\n          </div>\n          {errors.numberOfAdvancePayments && (\n            <p className=\"text-red-500 text-sm mt-2\">{errors.numberOfAdvancePayments}</p>\n          )}\n        </div>\n\n        {/* Configuracin de cada anticipo */}\n        <div className=\"space-y-4\">\n          {machineryData.advancePayments.map((payment, index) => (\n            <div key={index} className=\"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Porcentaje (%)\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"100\"\n                  step=\"0.01\"\n                  value={payment.percentage}\n                  onChange={(e) => handleAdvancePaymentChange(index, 'percentage', parseFloat(e.target.value) || '')}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"30\"\n                />\n              </div>\n              \n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Descripcin\n                </label>\n                <input\n                  type=\"text\"\n                  value={payment.description}\n                  onChange={(e) => handleAdvancePaymentChange(index, 'description', e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"Anticipo inicial\"\n                />\n              </div>\n              \n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Momento del pago\n                </label>\n                <select\n                  value={payment.timing}\n                  onChange={(e) => handleAdvancePaymentChange(index, 'timing', e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"order\">Al realizar la orden de compra</option>\n                  <option value=\"production\">Durante la fabricacin</option>\n                  <option value=\"shipping\">Antes de liberar para envo</option>\n                  <option value=\"delivery\">Al entregar equipo funcionando</option>\n                  <option value=\"installation\">Al completar la instalacin</option>\n                  <option value=\"performance\">Al finalizar pruebas de performance</option>\n                </select>\n              </div>\n            </div>\n          ))}\n          \n          {errors.advancePayments && (\n            <p className=\"text-red-500 text-sm\">{errors.advancePayments}</p>\n          )}\n          \n          <div className=\"text-sm text-gray-500 text-center\">\n            Total: {machineryData.advancePayments.reduce((sum, payment) => \n              sum + (parseFloat(payment.percentage) || 0), 0\n            ).toFixed(1)}%\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MachineryConfigStep;\n","/**\n * SchedulePreview - Paso 3 del wizard: Vista Previa del Cronograma\n * StrategiaPM - MVP Implementation\n */\n\nimport React, { useState } from 'react';\n\nconst SchedulePreview = ({ wizardData, generatedSchedule, isGenerating, onGenerate }) => {\n  const [selectedView, setSelectedView] = useState('overview');\n  const [showRecommendations, setShowRecommendations] = useState(true);\n\n  // Debug logging\n  console.log(' SchedulePreview props:', {\n    wizardData,\n    generatedSchedule: generatedSchedule ? 'Presente' : 'Ausente',\n    isGenerating,\n    hasOnGenerate: !!onGenerate\n  });\n\n  // Generar cronograma si no existe\n  const handleGenerate = () => {\n    if (!generatedSchedule && !isGenerating) {\n      onGenerate();\n    }\n  };\n\n  // Formatear duracin en das\n  const formatDuration = (days) => {\n    if (days < 7) return `${days} das`;\n    if (days < 30) return `${Math.round(days / 7)} semanas`;\n    return `${Math.round(days / 30)} meses`;\n  };\n\n  // Formatear fecha\n  const formatDate = (dateString) => {\n    if (!dateString) return 'No definida';\n    return new Date(dateString).toLocaleDateString('es-ES');\n  };\n\n  // Calcular estadsticas del cronograma\n  const calculateStats = (schedule) => {\n    if (!schedule) return null;\n\n    const activities = schedule.activities || [];\n    const milestones = schedule.milestones || [];\n    \n    const totalDuration = activities.reduce((sum, activity) => sum + (activity.duration || 0), 0);\n    const highPriorityActivities = activities.filter(a => a.priority === 'high').length;\n    const criticalPathActivities = schedule.criticalPath?.length || 0;\n    \n    return {\n      totalActivities: activities.length,\n      totalMilestones: milestones.length,\n      totalDuration: totalDuration,\n      highPriorityActivities: highPriorityActivities,\n      criticalPathActivities: criticalPathActivities,\n      averageActivityDuration: activities.length > 0 ? Math.round(totalDuration / activities.length) : 0\n    };\n  };\n\n  const stats = calculateStats(generatedSchedule);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <h3 className=\"text-xl font-semibold text-gray-800 mb-2\">\n           Vista Previa del Cronograma\n        </h3>\n        <p className=\"text-gray-600\">\n          Revisa el cronograma generado por IA antes de aplicarlo a tu proyecto\n        </p>\n      </div>\n\n      {/* Botn de Generacin */}\n      {!generatedSchedule && !isGenerating && (\n        <div className=\"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-8 text-center\">\n          <div className=\"text-6xl mb-4\"></div>\n          <h4 className=\"text-xl font-semibold text-gray-800 mb-2\">\n            Listo para Generar tu Cronograma!\n          </h4>\n          <p className=\"text-gray-600 mb-6\">\n            Con la informacin proporcionada, nuestro asistente de IA generar un cronograma optimizado para tu proyecto.\n          </p>\n          <button\n            onClick={handleGenerate}\n            className=\"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition-all transform hover:scale-105\"\n          >\n             Generar Cronograma con IA\n          </button>\n        </div>\n      )}\n\n      {/* Estado de Generacin */}\n      {isGenerating && (\n        <div className=\"bg-blue-50 rounded-lg p-8 text-center\">\n          <div className=\"animate-spin text-6xl mb-4\"></div>\n          <h4 className=\"text-xl font-semibold text-gray-800 mb-2\">\n            Generando Cronograma...\n          </h4>\n          <p className=\"text-gray-600 mb-4\">\n            Nuestro asistente de IA est analizando tu proyecto y generando el cronograma ms apropiado.\n          </p>\n          <div className=\"flex items-center justify-center space-x-2\">\n            <div className=\"animate-bounce w-2 h-2 bg-blue-600 rounded-full\"></div>\n            <div className=\"animate-bounce w-2 h-2 bg-blue-600 rounded-full\" style={{ animationDelay: '0.1s' }}></div>\n            <div className=\"animate-bounce w-2 h-2 bg-blue-600 rounded-full\" style={{ animationDelay: '0.2s' }}></div>\n          </div>\n        </div>\n      )}\n\n      {/* Cronograma Generado */}\n      {generatedSchedule && (\n        <>\n          {/* Informacin del Proyecto */}\n          <div className=\"bg-gray-50 rounded-lg p-6\">\n            <h4 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\n              <span className=\"text-xl mr-2\"></span>\n              Informacin del Proyecto\n            </h4>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">Proyecto</label>\n                <p className=\"text-gray-900 font-semibold\">{wizardData.projectName}</p>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">Tipo</label>\n                <p className=\"text-gray-900\">{wizardData.projectType}</p>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">Metodologa</label>\n                <p className=\"text-gray-900\">{wizardData.methodology}</p>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">Equipo</label>\n                <p className=\"text-gray-900\">{wizardData.teamSize} personas</p>\n              </div>\n            </div>\n          </div>\n\n          {/* Estadsticas del Cronograma */}\n          {stats && (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div className=\"bg-blue-50 rounded-lg p-4 text-center\">\n                <div className=\"text-2xl font-bold text-blue-600\">{stats.totalActivities}</div>\n                <div className=\"text-sm text-gray-600\">Actividades</div>\n              </div>\n              <div className=\"bg-green-50 rounded-lg p-4 text-center\">\n                <div className=\"text-2xl font-bold text-green-600\">{stats.totalMilestones}</div>\n                <div className=\"text-sm text-gray-600\">Hitos</div>\n              </div>\n              <div className=\"bg-purple-50 rounded-lg p-4 text-center\">\n                <div className=\"text-2xl font-bold text-purple-600\">{formatDuration(stats.totalDuration)}</div>\n                <div className=\"text-sm text-gray-600\">Duracin Total</div>\n              </div>\n              <div className=\"bg-orange-50 rounded-lg p-4 text-center\">\n                <div className=\"text-2xl font-bold text-orange-600\">{stats.criticalPathActivities}</div>\n                <div className=\"text-sm text-gray-600\">Ruta Crtica</div>\n              </div>\n            </div>\n          )}\n\n          {/* Navegacin de Vistas */}\n          <div className=\"bg-white rounded-lg border border-gray-200\">\n            <div className=\"flex border-b border-gray-200\">\n              {[\n                { id: 'overview', label: 'Resumen', icon: '' },\n                { id: 'activities', label: 'Actividades', icon: '' },\n                { id: 'milestones', label: 'Hitos', icon: '' },\n                { id: 'timeline', label: 'Cronograma', icon: '' }\n              ].map((view) => (\n                <button\n                  key={view.id}\n                  onClick={() => setSelectedView(view.id)}\n                  className={`flex-1 px-4 py-3 text-sm font-medium transition-colors ${\n                    selectedView === view.id\n                      ? 'text-purple-600 border-b-2 border-purple-600 bg-purple-50'\n                      : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50'\n                  }`}\n                >\n                  <span className=\"mr-2\">{view.icon}</span>\n                  {view.label}\n                </button>\n              ))}\n            </div>\n\n            <div className=\"p-6\">\n              {/* Vista de Resumen */}\n              {selectedView === 'overview' && (\n                <div className=\"space-y-6\">\n                  <div>\n                    <h5 className=\"font-semibold text-gray-800 mb-3\">Resumen del Cronograma</h5>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div className=\"bg-gray-50 rounded-lg p-4\">\n                        <h6 className=\"font-semibold text-gray-700 mb-2\">Duracin del Proyecto</h6>\n                        <p className=\"text-2xl font-bold text-gray-900\">{formatDuration(stats.totalDuration)}</p>\n                        <p className=\"text-sm text-gray-600\">\n                          {stats.averageActivityDuration} das promedio por actividad\n                        </p>\n                      </div>\n                      <div className=\"bg-gray-50 rounded-lg p-4\">\n                        <h6 className=\"font-semibold text-gray-700 mb-2\">Complejidad</h6>\n                        <p className=\"text-2xl font-bold text-gray-900 capitalize\">\n                          {generatedSchedule.metadata?.complexity || 'medium'}\n                        </p>\n                        <p className=\"text-sm text-gray-600\">\n                          {stats.highPriorityActivities} actividades de alta prioridad\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div>\n                    <h5 className=\"font-semibold text-gray-800 mb-3\">Template Utilizado</h5>\n                    <div className=\"bg-blue-50 rounded-lg p-4\">\n                      <p className=\"font-semibold text-blue-800\">\n                        {generatedSchedule.metadata?.templateUsed || 'Template Genrico de Proyecto'}\n                      </p>\n                      <p className=\"text-sm text-blue-600 mt-1\">\n                        Generado el {formatDate(generatedSchedule.metadata?.generatedAt)}\n                      </p>\n                      {!generatedSchedule.metadata?.templateUsed && (\n                        <p className=\"text-xs text-blue-500 mt-2\">\n                           Se utiliz un template genrico basado en mejores prcticas\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Vista de Actividades */}\n              {selectedView === 'activities' && (\n                <div>\n                  <h5 className=\"font-semibold text-gray-800 mb-4\">Actividades Generadas ({generatedSchedule.activities?.length || 0})</h5>\n                  <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n                    {generatedSchedule.activities?.map((activity, index) => (\n                      <div key={activity.id} className=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex-1\">\n                            <h6 className=\"font-semibold text-gray-800\">{activity.name}</h6>\n                            <p className=\"text-sm text-gray-600 mt-1\">{activity.description}</p>\n                            <div className=\"flex items-center space-x-4 mt-2 text-xs text-gray-500\">\n                              <span> {activity.duration} das</span>\n                              <span> {activity.category}</span>\n                              <span> {activity.priority}</span>\n                              <span> {activity.assignedTo}</span>\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <div className={`px-2 py-1 rounded-full text-xs font-semibold ${\n                              activity.priority === 'high' ? 'bg-red-100 text-red-800' :\n                              activity.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :\n                              'bg-green-100 text-green-800'\n                            }`}>\n                              {activity.priority}\n                            </div>\n                            {activity.confidence && (\n                              <div className=\"text-xs text-gray-500 mt-1\">\n                                Confianza: {Math.round(activity.confidence * 100)}%\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Vista de Hitos */}\n              {selectedView === 'milestones' && (\n                <div>\n                  <h5 className=\"font-semibold text-gray-800 mb-4\">Hitos Generados ({generatedSchedule.milestones?.length || 0})</h5>\n                  <div className=\"space-y-3\">\n                    {generatedSchedule.milestones?.map((milestone, index) => (\n                      <div key={milestone.id} className=\"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-4 border border-purple-200\">\n                        <div className=\"flex items-center\">\n                          <span className=\"text-2xl mr-3\"></span>\n                          <div className=\"flex-1\">\n                            <h6 className=\"font-semibold text-gray-800\">{milestone.name}</h6>\n                            <p className=\"text-sm text-gray-600 mt-1\">{milestone.description}</p>\n                            <div className=\"flex items-center space-x-4 mt-2 text-xs text-gray-500\">\n                              <span> {milestone.phase}</span>\n                              <span> {milestone.assignedTo}</span>\n                            </div>\n                            {milestone.criteria && (\n                              <div className=\"mt-2 p-2 bg-white rounded border border-gray-200\">\n                                <p className=\"text-xs text-gray-600\">\n                                  <strong>Criterio:</strong> {milestone.criteria}\n                                </p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Vista de Cronograma */}\n              {selectedView === 'timeline' && (\n                <div>\n                  <h5 className=\"font-semibold text-gray-800 mb-4\">Cronograma Temporal</h5>\n                  <div className=\"bg-gray-50 rounded-lg p-4\">\n                    <p className=\"text-gray-600 text-center\">\n                       Vista de cronograma temporal disponible despus de aplicar el cronograma\n                    </p>\n                    <p className=\"text-sm text-gray-500 text-center mt-2\">\n                      Una vez aplicado, podrs ver el cronograma completo en la vista Gantt\n                    </p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Recomendaciones */}\n          {generatedSchedule.recommendations && generatedSchedule.recommendations.length > 0 && (\n            <div className=\"bg-yellow-50 rounded-lg p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h4 className=\"text-lg font-semibold text-gray-800 flex items-center\">\n                  <span className=\"text-xl mr-2\"></span>\n                  Recomendaciones de IA\n                </h4>\n                <button\n                  onClick={() => setShowRecommendations(!showRecommendations)}\n                  className=\"text-gray-600 hover:text-gray-800 transition-colors\"\n                >\n                  {showRecommendations ? ' Ocultar' : ' Mostrar'}\n                </button>\n              </div>\n              \n              {showRecommendations && (\n                <div className=\"space-y-3\">\n                  {generatedSchedule.recommendations.map((recommendation, index) => (\n                    <div key={index} className={`p-4 rounded-lg border-l-4 ${\n                      recommendation.priority === 'high' ? 'border-red-500 bg-red-50' :\n                      recommendation.priority === 'medium' ? 'border-yellow-500 bg-yellow-50' :\n                      'border-green-500 bg-green-50'\n                    }`}>\n                      <div className=\"flex items-start\">\n                        <span className=\"text-lg mr-3\">\n                          {recommendation.priority === 'high' ? '' :\n                           recommendation.priority === 'medium' ? '' : ''}\n                        </span>\n                        <div>\n                          <h6 className=\"font-semibold text-gray-800\">{recommendation.title}</h6>\n                          <p className=\"text-sm text-gray-600 mt-1\">{recommendation.description}</p>\n                          {recommendation.action && (\n                            <p className=\"text-sm text-gray-700 mt-2 font-medium\">\n                              <strong>Accin sugerida:</strong> {recommendation.action}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Informacin de Confianza */}\n          <div className=\"bg-blue-50 rounded-lg p-4\">\n            <div className=\"flex items-center\">\n              <span className=\"text-2xl mr-3\"></span>\n              <div>\n                <h6 className=\"font-semibold text-blue-800\">Generado por Asistente de IA</h6>\n                <p className=\"text-sm text-blue-600\">\n                  Este cronograma fue generado automticamente basndose en las mejores prcticas y patrones de proyectos similares.\n                  Puedes modificarlo despus de aplicarlo a tu proyecto.\n                </p>\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default SchedulePreview;\n","/**\n * TemplateBasedSchedulerService - Servicio basado en template real\n * StrategiaPM - MVP Implementation\n */\n\nimport * as XLSX from 'xlsx';\n\nclass TemplateBasedSchedulerService {\n  constructor() {\n    this.templateData = null;\n    this.templatePath = './template-compra-equipos.xlsx';\n  }\n\n  /**\n   * Cargar template desde datos hardcodeados (basado en anlisis previo)\n   */\n  async loadTemplate() {\n    try {\n      console.log(' Cargando template de compra de equipos...');\n      \n      // Datos del template extrados del anlisis previo\n      const templateData = [\n        ['#', 'Nombre', 'Duracin', 'Prioridad', 'Asignado', 'Predecesoras', 'Hitos'],\n        [1, 'Aprobacin y alta del activo en sistema', '22 das', 'Alta', 'Team leader', '', 'No'],\n        [2, 'Elaboracin de edital tcnico', '5 das', 'Alta', 'Team leader', '', 'No'],\n        [3, 'Envo de edital a proveedores para participar en el proyecto', '5 das', 'Media', 'Comprador(a)', 2, 'No'],\n        [4, 'Solucin de dudas tcnicas', '11 das', 'Media', 'Proveedores', 3, 'No'],\n        [5, 'Seleccin de proveedor', '3 das', 'Alta', 'Comprador(a)', 4, 'No'],\n        [6, 'Preparacin de contrato con rea legal', '7 das', 'Alta', 'Comprador(a)', 5, 'No'],\n        [7, 'Alta del proveedor en sistema para pago', '10 das', 'Alta', 'Comprador(a)', 5, 'No'],\n        [8, 'Definir el equipo de proyecto', '1 da', 'Media', 'Project Manager', 5, 'No'],\n        [9, 'Kick-off meeting con proveedor seleccionado', '1 da', 'Media', 'Comprador(a)', 8, 'No'],\n        [10, 'Hito: Orden de compra realizada', '0 das', 'Alta', 'Comprador(a)', 9, 'Si'],\n        [11, 'Programacin de 1er anticipo', '12 das', 'Alta', 'Comprador(a)', 10, 'No'],\n        [12, 'Ajuste del cronograma', '1 da', 'Media', 'Project Manager', 11, 'No'],\n        [13, 'HITO: 1er anticipo pagado', '0 das', 'Alta', 'Tesorero', 11, 'Si'],\n        [14, 'Estudio de sitio', '2 das', 'Media', 'Team leader', 9, 'No'],\n        [15, 'Diseo de layout y distribucin de equipos', '5 das', 'Media', 'Team leader', 14, 'No'],\n        [16, 'Especificaciones tcnicas finales', '3 das', 'Alta', 'Team leader', 15, 'No'],\n        [17, 'Ingeniera de servicios (vapor, aire, electricidad)', '4 das', 'Media', 'Team leader', 16, 'No'],\n        [18, 'Plan de instalacin y cronograma detallado', '1 da', 'Media', 'Team leader', 17, 'No'],\n        [19, 'Anlisis de riesgos de importacin', '1 da', 'Media', 'Project Manager', 18, 'No'],\n        [20, 'HITO: Diseo Aprobado', '0 das', 'Alta', 'Team leader', 19, 'Si'],\n        [21, 'Licitacin para instalacin de servicios e infraestructura', '20 das', 'Media', 'Comprador(a)', 20, 'No'],\n        [22, 'HITO: Orden de compra para servicios e infraestructura', '0 das', 'Alta', 'Comprador(a)', 21, 'Si'],\n        [23, 'Gestin para pago de 1er anticipo de servicios e infraestructura', '12 das', 'Alta', 'Comprador(a)', 22, 'No'],\n        [24, 'HITO: 1er anticipo serv e infraestructura pagado', '0 das', 'Alta', 'Tesorero', 23, 'Si'],\n        [25, 'Preparacin de cimentacin y bases (piso)', '21 das', 'Media', 'Proveedores', 24, 'No'],\n        [26, 'Instalacin de servicios elctricos (220V/440V)', '5 das', 'Media', 'Proveedores', 25, 'No'],\n        [27, 'Instalacin de lneas de vapor', '5 das', 'Media', 'Proveedores', 25, 'No'],\n        [28, 'Preparacin de conexiones de aire comprimido', '3 das', 'Media', 'Proveedores', 27, 'No'],\n        [29, 'Instalacin de sistemas de drenaje', '5 das', 'Media', 'Proveedores', 26, 'No'],\n        [30, 'Adecuaciones de espacio y accesos', '4 das', 'Media', 'Proveedores', 29, 'No'],\n        [31, 'Instalacin de sistemas de seguridad', '2 das', 'Media', 'Proveedores', 30, 'No'],\n        [32, 'HITO: Sitio Preparado', '0 das', 'Alta', 'Team leader', 31, 'Si'],\n        [33, 'Gestin para pago 2o anticipo de serv e infraestructura', '12 das', 'Alta', 'Comprador(a)', 32, 'No'],\n        [34, 'HITO: 2o anticipo pagado serv e infraestructura', '0 das', 'Alta', 'Tesorero', 33, 'Si'],\n        [35, 'Gestin entrada ltima factura de serv e infraestructura', '100 das', 'Alta', 'Team leader', 32, 'No'],\n        [36, 'HITO: Factura pagada de serv e infraestructura', '0 das', 'Alta', 'Tesorero', 35, 'Si'],\n        [37, 'Inicio de fabricacin de maquinaria', '1 da', 'Alta', 'Proveedores', 13, 'No'],\n        [38, 'Control de calidad durante fabricacin', '100 das', 'Media', 'Proveedores', 37, 'No'],\n        [39, 'Inspeccin intermedia', '5 das', 'Media', 'Team leader', 38, 'No'],\n        [40, 'Pruebas de fbrica (FAT)', '10 das', 'Alta', 'Project Manager', 38, 'No'],\n        [41, 'Gestin de 2o anticipo de pago', '12 das', 'Alta', 'Comprador(a)', 40, 'No'],\n        [42, 'HITO: 2o anticipo linea de salsas pagado', '0 das', 'Alta', 'Tesorero', 41, 'Si'],\n        [43, 'Preparacin para envo y embalaje', '10 das', 'Media', 'Proveedores', 38, 'No'],\n        [44, 'HITO: FAT Completado', '0 das', 'Alta', 'Project Manager', 43, 'Si'],\n        [45, 'Transporte terrestre a puerto', '2 das', 'Media', 'Proveedores', 44, 'No'],\n        [46, 'Trmites de exportacin en origen', '1 da', 'Media', 'Proveedores', 45, 'No'],\n        [47, 'Transporte areo Origen - Destino', '2 das', 'Media', 'Proveedores', 46, 'No'],\n        [48, 'Trmites de importacin', '5 das', 'Media', 'Proveedores', 47, 'No'],\n        [49, 'Liberacin aduanal', '5 das', 'Media', 'Proveedores', 48, 'No'],\n        [50, 'Transporte hacia Destino', '2 das', 'Alta', 'Proveedores', 49, 'No'],\n        [51, 'HITO: Maquinaria entregada a Destino', '0 das', 'Alta', 'Proveedores', 50, 'Si'],\n        [52, 'Recepcin e inspeccin de equipos', '1 da', 'Media', 'Team leader', 50, 'No'],\n        [53, 'Descarga y posicionamiento', '2 das', 'Media', 'Team leader', 32, 'No'],\n        [54, 'Montaje de equipos', '3 das', 'Media', 'Team leader', 53, 'No'],\n        [55, 'Conexiones elctricas y de control', '2 das', 'Media', 'Team leader', 54, 'No'],\n        [56, 'Conexiones de vapor y aire comprimido', '2 das', 'Media', 'Team leader', 55, 'No'],\n        [57, 'Integracin de maquinaria', '2 das', 'Media', 'Team leader', 56, 'No'],\n        [58, 'Instalacin de sistemas de seguridad', '2 das', 'Media', 'Team leader', 57, 'No'],\n        [59, 'HITO: Instalacin de maquinaria completada', '0 das', 'Alta', 'Team leader', 58, 'Si'],\n        [60, 'Pruebas de integracin', '1 da', 'Alta', 'Team leader', 59, 'No'],\n        [61, 'Validacin de procesos', '1 da', 'Alta', 'Team leader', 60, 'No'],\n        [62, 'Documentacin de resultados', '0 das', 'Alta', 'Team leader', 61, 'No'],\n        [63, 'HITO: Pruebas Exitosas', '0 das', 'Alta', 'Team leader', 62, 'Si'],\n        [64, 'Gestin de pago de 3er anticipo', '12 das', 'Alta', 'Comprador(a)', 63, 'No'],\n        [65, 'HITO: 3er anticipo pagado', '0 das', 'Alta', 'Comprador(a)', 64, 'Si'],\n        [66, 'Capacitacin a operadores', '2 das', 'Media', 'Proveedores', 65, 'No'],\n        [67, 'Capacitacin a personal de mantenimiento', '2 das', 'Media', 'Proveedores', 63, 'No'],\n        [68, 'Capacitacin en control de calidad', '1 da', 'Media', 'Proveedores', 63, 'No'],\n        [69, 'Entrega de manuales y documentacin', '0 das', 'Media', 'Proveedores', 68, 'No'],\n        [70, 'Certificacin final de equipos', '1 da', 'Media', 'Project Manager', 69, 'No'],\n        [71, 'HITO: Personal Capacitado', '0 das', 'Alta', 'Team leader', 70, 'Si'],\n        [72, 'Evaluacin post-implementacin', '2 das', 'Media', 'Project Manager', 71, 'No'],\n        [73, 'Documentacin de lecciones aprendidas', '2 das', 'Media', 'Team leader', 72, 'No'],\n        [74, 'Entrega de garantas y seguros', '1 da', 'Media', 'Team leader', 73, 'No'],\n        [75, 'Cierre administrativo y financiero', '1 da', 'Media', 'Project Manager', 73, 'No'],\n        [76, 'HITO: Proyecto completado', '0 das', 'Media', 'Project Manager', 75, 'Si']\n      ];\n      \n      this.templateData = this.parseTemplateData(templateData);\n      console.log(' Template cargado exitosamente:', this.templateData.activities.length, 'actividades');\n      \n      return this.templateData;\n    } catch (error) {\n      console.error(' Error cargando template:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Parsear datos del template\n   */\n  parseTemplateData(data) {\n    const activities = [];\n    const milestones = [];\n    \n    data.slice(1).forEach((row, index) => {\n      if (row && row.length > 0 && row[1] && row[1].trim() !== '') {\n        const activity = {\n          id: row[0], // CORRECCIN: Usar nmero simple en lugar de template-X\n          originalId: row[0],\n          name: row[1].trim(),\n          duration: this.parseDuration(row[2]),\n          priority: this.parsePriority(row[3]),\n          responsible: row[4]?.trim() || 'Sin asignar',\n          predecessor: row[5] || null,\n          isMilestone: row[6] === 'Si' || row[1].toLowerCase().includes('hito'),\n          category: this.categorizeActivity(row[1]),\n          phase: this.determinePhase(row[1], row[0]),\n          templateBased: true,\n          customizable: this.isCustomizable(row[1], row[0])\n        };\n\n        activities.push(activity);\n        \n        if (activity.isMilestone) {\n          milestones.push({\n            id: activity.id,\n            name: activity.name,\n            phase: activity.phase,\n            description: `Hito: ${activity.name}`\n          });\n        }\n      }\n    });\n\n    return {\n      activities,\n      milestones,\n      metadata: {\n        totalActivities: activities.length,\n        totalMilestones: milestones.length,\n        templateVersion: '1.0',\n        loadedAt: new Date().toISOString()\n      }\n    };\n  }\n\n  /**\n   * Parsear duracin del template\n   */\n  parseDuration(durationStr) {\n    if (!durationStr) return 1;\n    \n    const match = durationStr.toString().match(/(\\d+)/);\n    return match ? parseInt(match[1]) : 1;\n  }\n\n  /**\n   * Parsear prioridad del template\n   */\n  parsePriority(priorityStr) {\n    if (!priorityStr) return 'medium';\n    \n    const priority = priorityStr.toLowerCase();\n    if (priority.includes('alta')) return 'high';\n    if (priority.includes('media')) return 'medium';\n    if (priority.includes('baja')) return 'low';\n    return 'medium';\n  }\n\n  /**\n   * Categorizar actividad\n   */\n  categorizeActivity(activityName) {\n    const name = activityName.toLowerCase();\n    \n    if (name.includes('hito') || name.includes('aprobacin') || name.includes('contrato')) {\n      return 'milestone';\n    } else if (name.includes('fabricacin') || name.includes('produccin') || name.includes('manufactura')) {\n      return 'manufacturing';\n    } else if (name.includes('importacin') || name.includes('aduana') || name.includes('embarque')) {\n      return 'import';\n    } else if (name.includes('instalacin') || name.includes('montaje') || name.includes('conexin')) {\n      return 'installation';\n    } else if (name.includes('prueba') || name.includes('test') || name.includes('validacin')) {\n      return 'testing';\n    } else if (name.includes('capacitacin') || name.includes('entrenamiento')) {\n      return 'training';\n    } else if (name.includes('infraestructura') || name.includes('servicios') || name.includes('cimentacin')) {\n      return 'infrastructure';\n    } else if (name.includes('anticipo') || name.includes('pago')) {\n      return 'financial';\n    }\n    \n    return 'general';\n  }\n\n  /**\n   * Determinar fase de la actividad\n   */\n  determinePhase(activityName, activityId) {\n    const id = parseInt(activityId);\n    \n    if (id >= 1 && id <= 13) return 'Planificacin';\n    if (id >= 14 && id <= 20) return 'Diseo';\n    if (id >= 21 && id <= 36) return 'Infraestructura';\n    if (id >= 37 && id <= 44) return 'Fabricacin';\n    if (id >= 45 && id <= 51) return 'Importacin';\n    if (id >= 52 && id <= 63) return 'Instalacin';\n    if (id >= 64 && id <= 76) return 'Cierre';\n    \n    return 'General';\n  }\n\n  /**\n   * Determinar si una actividad es personalizable\n   */\n  isCustomizable(activityName, activityId) {\n    const name = activityName.toLowerCase();\n    const id = parseInt(activityId);\n    \n    // Tiempo de fabricacin\n    if (id === 38 && name.includes('fabricacin')) return { type: 'manufacturing_time', field: 'duration' };\n    \n    // Anticipos\n    if (id === 11 && name.includes('anticipo')) return { type: 'payment_timing', field: 'predecessor' };\n    if (id === 41 && name.includes('anticipo')) return { type: 'payment_timing', field: 'predecessor' };\n    if (id === 64 && name.includes('anticipo')) return { type: 'payment_timing', field: 'predecessor' };\n    \n    // Actividades condicionales\n    if (id >= 45 && id <= 50) return { type: 'conditional', field: 'include', condition: 'isForeignEquipment' };\n    if (id >= 25 && id <= 31) return { type: 'conditional', field: 'include', condition: 'requiresInfrastructure' };\n    \n    return null;\n  }\n\n  /**\n   * Mapear roles del template con miembros del equipo\n   */\n  mapTeamRoles(templateRole, teamMembers) {\n    const roleMapping = {\n      'Team leader': ['team_lead', 'engineer', 'analyst', 'technician'],\n      'Comprador(a)': ['buyer', 'specialist', 'analyst'],\n      'Project Manager': ['project_manager'],\n      'Proveedores': ['external'], // Externo\n      'Tesorero': ['other', 'specialist']\n    };\n\n    const possibleRoles = roleMapping[templateRole] || ['other'];\n    \n    // Buscar miembro con rol compatible\n    for (const role of possibleRoles) {\n      const member = teamMembers.find(m => m.role === role);\n      if (member) {\n        return {\n          assignedTo: member.name,\n          role: member.role,\n          experience: member.experience\n        };\n      }\n    }\n\n    // Si no se encuentra, asignar al primer miembro disponible\n    if (teamMembers.length > 0) {\n      const member = teamMembers[0];\n      return {\n        assignedTo: member.name,\n        role: member.role,\n        experience: member.experience\n      };\n    }\n\n    // Fallback\n    return {\n      assignedTo: 'Sin asignar',\n      role: 'other',\n      experience: 'intermediate'\n    };\n  }\n\n  /**\n   * Personalizar actividades segn configuracin del asistente\n   */\n  customizeActivities(activities, wizardData) {\n    console.log(' Personalizando actividades del template...');\n    \n    return activities.map(activity => {\n      const customized = { ...activity };\n      \n      // Mapear responsable con miembro del equipo\n      if (wizardData.teamMembers && wizardData.teamMembers.length > 0) {\n        const assignment = this.mapTeamRoles(activity.responsible, wizardData.teamMembers);\n        customized.assignedTo = assignment.assignedTo;\n        customized.assignedRole = assignment.role;\n        customized.assignedExperience = assignment.experience;\n      } else {\n        customized.assignedTo = activity.responsible;\n      }\n      \n      // Personalizar tiempo de fabricacin\n      if (activity.customizable?.type === 'manufacturing_time') {\n        if (wizardData.deliveryTime && wizardData.deliveryTimeUnit) {\n          const deliveryDays = this.convertToDays(wizardData.deliveryTime, wizardData.deliveryTimeUnit);\n          customized.duration = deliveryDays;\n          console.log(` Ajustando \"${activity.name}\": ${activity.duration}d  ${deliveryDays}d (tiempo de entrega)`);\n        }\n      }\n      \n      // Personalizar timing de anticipos\n      if (activity.customizable?.type === 'payment_timing') {\n        // Ajustar predecesora segn configuracin de anticipos\n        if (wizardData.advancePayments && wizardData.advancePayments.length > 0) {\n          const paymentTiming = this.getPaymentTimingFromActivity(activity.originalId);\n          const correspondingPayment = wizardData.advancePayments.find(p => p.timing === paymentTiming);\n          \n          if (correspondingPayment) {\n            console.log(` Ajustando timing de \"${activity.name}\" segn configuracin: ${correspondingPayment.timing}`);\n          }\n        }\n      }\n      \n      return customized;\n    });\n  }\n\n  /**\n   * Obtener timing de pago basado en ID de actividad\n   */\n  getPaymentTimingFromActivity(activityId) {\n    switch (parseInt(activityId)) {\n      case 11: return 'order';\n      case 41: return 'shipping';\n      case 64: return 'delivery';\n      default: return 'order';\n    }\n  }\n\n  /**\n   * Convertir tiempo a das\n   */\n  convertToDays(amount, unit) {\n    switch (unit) {\n      case 'days':\n        return amount;\n      case 'weeks':\n        return amount * 7;\n      case 'months':\n        return amount * 30;\n      default:\n        return amount;\n    }\n  }\n\n  /**\n   * Filtrar actividades condicionales\n   */\n  filterConditionalActivities(activities, wizardData) {\n    console.log(' Filtrando actividades condicionales...');\n    \n    return activities.filter(activity => {\n      if (!activity.customizable) return true;\n      \n      if (activity.customizable.type === 'conditional') {\n        const condition = activity.customizable.condition;\n        \n        if (condition === 'isForeignEquipment') {\n          const include = wizardData.isForeignEquipment === true;\n          console.log(`${include ? '' : ''} ${include ? 'Incluyendo' : 'Excluyendo'} actividad de importacin: ${activity.name}`);\n          return include;\n        }\n        \n        if (condition === 'requiresInfrastructure') {\n          const include = wizardData.requiresInfrastructure === true;\n          console.log(`${include ? '' : ''} ${include ? 'Incluyendo' : 'Excluyendo'} actividad de infraestructura: ${activity.name}`);\n          return include;\n        }\n      }\n      \n      return true;\n    });\n  }\n\n  /**\n   * Generar cronograma basado en template\n   */\n  async generateTemplateBasedSchedule(wizardData) {\n    try {\n      console.log(' TEMPLATE-BASED SCHEDULER: Iniciando generacin...');\n      console.log(' Wizard Data:', wizardData);\n      \n      // 1. Cargar template si no est cargado\n      if (!this.templateData) {\n        console.log(' Cargando template...');\n        await this.loadTemplate();\n      }\n      \n      // 2. Personalizar actividades\n      console.log(' Personalizando actividades...');\n      let activities = this.customizeActivities(this.templateData.activities, wizardData);\n      console.log(' Actividades personalizadas:', activities.length);\n      \n      // 3. Filtrar actividades condicionales\n      console.log(' Filtrando actividades condicionales...');\n      activities = this.filterConditionalActivities(activities, wizardData);\n      console.log(' Actividades filtradas:', activities.length);\n      \n      // 4. Filtrar hitos\n      console.log(' Filtrando hitos...');\n      const milestones = this.templateData.milestones.filter(milestone => {\n        const activity = activities.find(a => a.id === milestone.id);\n        return activity !== undefined;\n      });\n      console.log(' Hitos filtrados:', milestones.length);\n      \n      // 5. Calcular ruta crtica y aplicar dependencias\n      console.log(' Calculando ruta crtica y dependencias...');\n      const criticalPathResult = this.calculateCriticalPath(activities);\n      const activitiesWithDependencies = criticalPathResult.activities;\n      const criticalPath = criticalPathResult.criticalPath;\n      console.log(' Actividades con dependencias:', activitiesWithDependencies.length);\n      \n      // 6. Generar recomendaciones\n      const recommendations = this.generateRecommendations(wizardData, activitiesWithDependencies);\n      \n      const generatedSchedule = {\n        activities: activitiesWithDependencies,\n        milestones,\n        criticalPath,\n        recommendations,\n        metadata: {\n          templateUsed: 'Template compra de equipos.xlsx',\n          templateId: 'template-compra-equipos-v1',\n          generatedAt: new Date().toISOString(),\n          wizardData,\n          estimatedDuration: this.calculateTotalDuration(activities),\n          complexity: this.assessComplexity(wizardData, activities),\n          customizationApplied: {\n            manufacturingTime: wizardData.deliveryTime ? `${wizardData.deliveryTime} ${wizardData.deliveryTimeUnit}` : 'default',\n            advancePayments: wizardData.advancePayments?.length || 0,\n            infrastructureIncluded: wizardData.requiresInfrastructure || false,\n            importIncluded: wizardData.isForeignEquipment || false\n          }\n        }\n      };\n      \n      console.log(' TEMPLATE-BASED SCHEDULER: Cronograma generado exitosamente');\n      console.log(` Actividades: ${activities.length}, Hitos: ${milestones.length}`);\n      console.log(' Primeras 5 actividades con fechas:');\n      activitiesWithDependencies.slice(0, 5).forEach((activity, index) => {\n        console.log(`  ${index + 1}. ${activity.name}: ${activity.startDate} - ${activity.endDate}`);\n      });\n      \n      return generatedSchedule;\n      \n    } catch (error) {\n      console.error(' TEMPLATE-BASED SCHEDULER: Error generando cronograma:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Calcular ruta crtica y aplicar dependencias\n   */\n  calculateCriticalPath(activities) {\n    // Aplicar dependencias del template\n    const activitiesWithDependencies = this.applyDependencies(activities);\n    \n    // Calcular fechas basadas en dependencias\n    const activitiesWithDates = this.calculateDates(activitiesWithDependencies);\n    \n    // Identificar ruta crtica\n    const criticalPath = this.identifyCriticalPath(activitiesWithDates);\n    \n    return {\n      activities: activitiesWithDates,\n      criticalPath: criticalPath\n    };\n  }\n\n  /**\n   * Aplicar dependencias del template\n   */\n  applyDependencies(activities) {\n    console.log(' Aplicando dependencias del template...');\n    \n    const result = activities.map(activity => {\n      const dependencies = [];\n      \n      if (activity.predecessor && activity.predecessor !== '') {\n        // Buscar la actividad predecesora\n        const predecessorActivity = activities.find(a => a.originalId === activity.predecessor);\n        if (predecessorActivity) {\n          dependencies.push(predecessorActivity.id);\n          console.log(` ${activity.name} (ID: ${activity.id}) depende de ${predecessorActivity.name} (ID: ${predecessorActivity.id})`);\n        } else {\n          console.warn(` Predecesora ${activity.predecessor} no encontrada para ${activity.name}`);\n        }\n      }\n      \n      return {\n        ...activity,\n        dependencies: dependencies\n      };\n    });\n    \n    // Verificar dependencias circulares\n    console.log(' Verificando dependencias circulares...');\n    const hasCircularDependency = this.checkCircularDependencies(result);\n    if (hasCircularDependency) {\n      console.error(' Se detectaron dependencias circulares en el template!');\n    } else {\n      console.log(' No se detectaron dependencias circulares');\n    }\n    \n    return result;\n  }\n  \n  /**\n   * Verificar dependencias circulares\n   */\n  checkCircularDependencies(activities) {\n    const visited = new Set();\n    const recursionStack = new Set();\n    \n    const hasCycle = (activityId) => {\n      if (recursionStack.has(activityId)) {\n        console.error(` Dependencia circular detectada: ${activityId}`);\n        return true;\n      }\n      if (visited.has(activityId)) {\n        return false;\n      }\n      \n      visited.add(activityId);\n      recursionStack.add(activityId);\n      \n      const activity = activities.find(a => a.id === activityId);\n      if (activity) {\n        for (const depId of activity.dependencies) {\n          if (hasCycle(depId)) {\n            return true;\n          }\n        }\n      }\n      \n      recursionStack.delete(activityId);\n      return false;\n    };\n    \n    for (const activity of activities) {\n      if (!visited.has(activity.id)) {\n        if (hasCycle(activity.id)) {\n          return true;\n        }\n      }\n    }\n    \n    return false;\n  }\n\n  /**\n   * Calcular fechas basadas en dependencias (algoritmo robusto)\n   */\n  calculateDates(activities) {\n    console.log(' Calculando fechas basadas en dependencias (algoritmo robusto)...');\n    \n    const activitiesWithDates = [...activities];\n    const startDate = new Date('2025-09-28'); // Fecha de inicio del proyecto\n    \n    // Inicializar todas las actividades sin fechas\n    activitiesWithDates.forEach(activity => {\n      activity.startDate = null;\n      activity.endDate = null;\n    });\n    \n    // Crear mapa de actividades por ID para acceso rpido\n    const activityMap = new Map();\n    activitiesWithDates.forEach(activity => {\n      activityMap.set(activity.id, activity);\n    });\n    \n    // Funcin para calcular fechas de una actividad\n    const calculateActivityDates = (activity) => {\n      if (activity.startDate && activity.endDate) {\n        return; // Ya calculada\n      }\n      \n      console.log(` Calculando: ${activity.name} (ID: ${activity.originalId})`);\n      \n      let activityStartDate = new Date(startDate);\n      \n      if (activity.dependencies.length > 0) {\n        console.log(` Dependencias de ${activity.name}:`, activity.dependencies);\n        \n        // Calcular fechas de todas las dependencias primero\n        activity.dependencies.forEach(depId => {\n          const depActivity = activityMap.get(depId);\n          if (depActivity) {\n            calculateActivityDates(depActivity); // Recursivo\n          }\n        });\n        \n        // Encontrar la fecha de fin ms tarda de las dependencias\n        let latestDependencyEnd = null;\n        \n        activity.dependencies.forEach(depId => {\n          const depActivity = activityMap.get(depId);\n          if (depActivity && depActivity.endDate) {\n            console.log(`   Dependencia ${depActivity.name} termina: ${depActivity.endDate.toLocaleDateString()}`);\n            if (!latestDependencyEnd || depActivity.endDate > latestDependencyEnd) {\n              latestDependencyEnd = new Date(depActivity.endDate);\n            }\n          }\n        });\n        \n        if (latestDependencyEnd) {\n          // La actividad inicia el da siguiente al fin de la ltima dependencia\n          activityStartDate = new Date(latestDependencyEnd);\n          activityStartDate.setDate(activityStartDate.getDate() + 1);\n          console.log(` ${activity.name} inicia despus de dependencias: ${activityStartDate.toLocaleDateString()}`);\n        }\n      } else {\n        console.log(` ${activity.name} sin dependencias, inicia en: ${activityStartDate.toLocaleDateString()}`);\n      }\n      \n      // Calcular fecha de fin\n      const activityEndDate = new Date(activityStartDate);\n      activityEndDate.setDate(activityEndDate.getDate() + activity.duration - 1); // -1 porque el primer da cuenta\n      \n      // Actualizar fechas en la actividad\n      activity.startDate = activityStartDate;\n      activity.endDate = activityEndDate;\n      \n      // Tambin actualizar earlyStart y earlyFinish para CPM\n      activity.earlyStart = activityStartDate;\n      activity.earlyFinish = activityEndDate;\n      \n      // Marcar como calculada por template para evitar que CPM la sobrescriba\n      activity.templateCalculated = true;\n      \n      console.log(` ${activity.name}: ${activityStartDate.toLocaleDateString()} - ${activityEndDate.toLocaleDateString()} (${activity.duration} das)`);\n    };\n    \n    // Procesar actividades en orden de ID original (1, 2, 3, 4...)\n    const sortedActivities = [...activitiesWithDates].sort((a, b) => a.originalId - b.originalId);\n    \n    // Calcular fechas de todas las actividades\n    sortedActivities.forEach(activity => {\n      calculateActivityDates(activity);\n    });\n    \n    // Verificar que todas las dependencias se respeten\n    console.log(' Verificando dependencias...');\n    activitiesWithDates.forEach(activity => {\n      if (activity.dependencies.length > 0) {\n        activity.dependencies.forEach(depId => {\n          const depActivity = activityMap.get(depId);\n          if (depActivity && depActivity.endDate && activity.startDate) {\n            if (activity.startDate <= depActivity.endDate) {\n              console.error(` ERROR: ${activity.name} inicia ${activity.startDate.toLocaleDateString()} pero su dependencia ${depActivity.name} termina ${depActivity.endDate.toLocaleDateString()}`);\n            } else {\n              console.log(` OK: ${activity.name} inicia ${activity.startDate.toLocaleDateString()} despus de ${depActivity.name} que termina ${depActivity.endDate.toLocaleDateString()}`);\n            }\n          }\n        });\n      }\n    });\n    \n    return activitiesWithDates;\n  }\n\n  /**\n   * Ordenamiento topolgico para respetar dependencias\n   */\n  topologicalSort(activities) {\n    console.log(' Iniciando ordenamiento topolgico...');\n    \n    const visited = new Set();\n    const temp = new Set();\n    const result = [];\n    \n    const visit = (activity) => {\n      if (temp.has(activity.id)) {\n        throw new Error('Dependencia circular detectada');\n      }\n      if (visited.has(activity.id)) {\n        return;\n      }\n      \n      temp.add(activity.id);\n      console.log(` Visitando: ${activity.name} (ID: ${activity.id})`);\n      \n      // Visitar dependencias primero\n      activity.dependencies.forEach(depId => {\n        const depActivity = activities.find(a => a.id === depId);\n        if (depActivity) {\n          console.log(`   Dependencia: ${depActivity.name} (ID: ${depId})`);\n          visit(depActivity);\n        }\n      });\n      \n      temp.delete(activity.id);\n      visited.add(activity.id);\n      result.push(activity);\n      console.log(` Agregado a resultado: ${activity.name}`);\n    };\n    \n    // Procesar actividades en orden de ID original para consistencia\n    const sortedByOriginalId = [...activities].sort((a, b) => a.originalId - b.originalId);\n    \n    sortedByOriginalId.forEach(activity => {\n      if (!visited.has(activity.id)) {\n        visit(activity);\n      }\n    });\n    \n    console.log(' Ordenamiento topolgico completado. Orden final:');\n    result.forEach((activity, index) => {\n      console.log(`  ${index + 1}. ${activity.name} (ID: ${activity.id})`);\n    });\n    \n    return result;\n  }\n\n  /**\n   * Identificar ruta crtica\n   */\n  identifyCriticalPath(activities) {\n    // Actividades de alta prioridad y sin holgura\n    return activities.filter(activity => \n      activity.priority === 'high' || activity.isMilestone\n    );\n  }\n\n  /**\n   * Generar recomendaciones\n   */\n  generateRecommendations(wizardData, activities) {\n    const recommendations = [];\n    \n    if (wizardData.isForeignEquipment) {\n      recommendations.push({\n        type: 'info',\n        title: 'Equipo Extranjero',\n        message: 'Se incluyeron actividades de importacin y aduanas en el cronograma.'\n      });\n    }\n    \n    if (wizardData.requiresInfrastructure) {\n      recommendations.push({\n        type: 'info',\n        title: 'Infraestructura Requerida',\n        message: 'Se incluyeron actividades de preparacin de sitio e infraestructura.'\n      });\n    }\n    \n    if (wizardData.advancePayments && wizardData.advancePayments.length > 0) {\n      recommendations.push({\n        type: 'financial',\n        title: 'Anticipos Configurados',\n        message: `Se configuraron ${wizardData.advancePayments.length} anticipos segn tus especificaciones.`\n      });\n    }\n    \n    return recommendations;\n  }\n\n  /**\n   * Calcular duracin total\n   */\n  calculateTotalDuration(activities) {\n    return activities.reduce((total, activity) => total + activity.duration, 0);\n  }\n\n  /**\n   * Evaluar complejidad\n   */\n  assessComplexity(wizardData, activities) {\n    let complexity = 'medium';\n    \n    if (activities.length > 50) complexity = 'high';\n    else if (activities.length < 30) complexity = 'low';\n    \n    if (wizardData.isForeignEquipment && wizardData.requiresInfrastructure) {\n      complexity = 'high';\n    }\n    \n    return complexity;\n  }\n}\n\n// Exportar como singleton\nconst templateBasedSchedulerService = new TemplateBasedSchedulerService();\nexport default templateBasedSchedulerService;\n","/**\n * SmartSchedulerService - Servicio para generacin inteligente de cronogramas\n * StrategiaPM - v1.0 Implementation\n * \n * Este servicio maneja la lgica de generacin de cronogramas automticamente\n * basndose en templates y contexto del proyecto (sin aprendizaje).\n */\n\n// import aiLearningEngine from './AILearningEngine'; // DEPRECATED - eliminado en v1.0\nimport TemplateBasedSchedulerService from './TemplateBasedSchedulerService.js';\nimport { scheduleLogger } from '../utils/logger';\n\nclass SmartSchedulerService {\n  constructor() {\n    this.supabase = null;\n    this.organizationId = null;\n    this.currentUser = null;\n  }\n\n  // Inicializar el servicio con Supabase\n  async initialize(supabase, organizationId, currentUser) {\n    this.supabase = supabase;\n    this.organizationId = organizationId;\n    this.currentUser = currentUser;\n\n    // DEPRECATED: Sin inicializacin de motor de aprendizaje en v1.0\n    // await aiLearningEngine.initialize(supabase, organizationId, currentUser?.id);\n\n    scheduleLogger.debug(' SmartSchedulerService inicializado:', { organizationId, userId: currentUser?.id });\n  }\n\n  /**\n   * Generar cronograma inteligente basado en las respuestas del wizard\n   * @param {Object} wizardData - Datos del wizard (respuestas del usuario)\n   * @returns {Object} Cronograma generado con actividades, hitos y recomendaciones\n   */\n  async generateSmartSchedule(wizardData) {\n    try {\n      scheduleLogger.debug(' AISchedulerService: Generando cronograma inteligente:', wizardData);\n      scheduleLogger.debug(' AISchedulerService: projectType =', wizardData.projectType);\n      scheduleLogger.debug(' AISchedulerService: projectType === \"equipment_installation\"?', wizardData.projectType === 'equipment_installation');\n\n      // Si es un proyecto de compra de equipos, usar el template real\n      if (wizardData.projectType === 'equipment_installation') {\n        scheduleLogger.debug(' AISchedulerService: Proyecto de compra de equipos detectado - usando template real');\n        return await TemplateBasedSchedulerService.generateTemplateBasedSchedule(wizardData);\n      }\n\n      // 1. Obtener template base (sin lgica de aprendizaje)\n      const template = await this.getBaseTemplate(wizardData);\n      scheduleLogger.debug(' Template seleccionado:', template?.name);\n\n      if (!template) {\n        throw new Error('No se pudo seleccionar un template vlido');\n      }\n\n      // 2. Ajustar actividades por contexto del proyecto\n      scheduleLogger.debug(' Template antes de ajustar actividades:', {\n        hasTemplateData: !!template.template_data,\n        hasActivities: !!template.activities,\n        activitiesLength: template.activities?.length || 0,\n        templateKeys: Object.keys(template)\n      });\n\n      // Usar actividades del template base\n      scheduleLogger.debug(' Usando actividades del template base');\n      const activitiesToAdjust = await this.extractActivitiesFromTemplate(template, wizardData);\n\n      const adjustedActivities = await this.adjustActivitiesByContext(template, wizardData, activitiesToAdjust);\n      scheduleLogger.debug(' Actividades ajustadas:', adjustedActivities.length);\n\n      // 3. Generar hitos inteligentes\n      const smartMilestones = await this.generateSmartMilestones(adjustedActivities, wizardData);\n      scheduleLogger.debug(' Hitos generados:', smartMilestones.length);\n\n      // 4. Calcular ruta crtica\n      const criticalPath = this.calculateCriticalPath(adjustedActivities);\n      scheduleLogger.debug(' Ruta crtica calculada:', criticalPath.length, 'actividades');\n\n      // 5. Generar recomendaciones\n      const recommendations = this.generateRecommendations(wizardData, adjustedActivities);\n      scheduleLogger.debug(' Recomendaciones generadas:', recommendations.length);\n\n      // 6. Ordenar actividades lgicamente para maquinaria\n      let finalActivities = adjustedActivities;\n      if (wizardData.projectType === 'equipment_installation') {\n        finalActivities = this.sortMachineryActivities(adjustedActivities, wizardData);\n        scheduleLogger.debug(' Actividades ordenadas lgicamente');\n      }\n\n      // 7. Crear el cronograma final\n      const generatedSchedule = {\n        activities: finalActivities,\n        milestones: smartMilestones,\n        criticalPath: criticalPath,\n        recommendations: recommendations,\n        metadata: {\n          templateUsed: template?.name,\n          templateId: template?.id,\n          generatedAt: new Date().toISOString(),\n          wizardData: wizardData,\n          estimatedDuration: this.calculateTotalDuration(finalActivities),\n          complexity: this.assessComplexity(wizardData, finalActivities)\n        }\n      };\n\n      // 7. Guardar en historial para aprendizaje\n      await this.saveGenerationHistory(wizardData, generatedSchedule);\n\n      scheduleLogger.debug(' Cronograma generado exitosamente');\n      return generatedSchedule;\n\n    } catch (error) {\n      scheduleLogger.error(' Error generando cronograma:', error);\n      throw new Error(`Error generando cronograma: ${error.message}`);\n    }\n  }\n\n  // DEPRECATED: selectBestTemplate eliminado en v1.0 - usar getBaseTemplate directamente\n\n  /**\n   * Obtener template base (lgica original)\n   */\n  async getBaseTemplate(wizardData) {\n    try {\n      const { projectType, industry, methodology } = wizardData;\n\n      if (!this.supabase) {\n        scheduleLogger.debug(' Usando template genrico (Sin Supabase)');\n        const genericTemplate = {\n          id: 'generic-template',\n          name: 'Template Genrico de Proyecto',\n          description: 'Template genrico basado en mejores prcticas de gestin de proyectos',\n          project_type: wizardData.projectType || 'general',\n          industry: wizardData.industry || 'general',\n          methodology: wizardData.methodology || 'waterfall',\n          template_data: this.getGenericTemplateData(wizardData)\n        };\n\n        // Extraer actividades de las fases para el aprendizaje\n        if (genericTemplate.template_data && genericTemplate.template_data.phases) {\n          genericTemplate.activities = this.extractActivitiesFromPhases(genericTemplate.template_data.phases);\n          genericTemplate.milestones = this.extractMilestonesFromPhases(genericTemplate.template_data.phases);\n        }\n\n        return genericTemplate;\n      }\n\n      // Buscar templates que coincidan con los criterios\n      let query = this.supabase\n        .from('schedule_templates')\n        .select('*');\n\n      // Solo filtrar por organization_id si est definido\n      if (this.organizationId) {\n        query = query.or(`organization_id.eq.${this.organizationId},organization_id.is.null`);\n      } else {\n        query = query.is('organization_id', null);\n      }\n\n      // Filtrar por tipo de proyecto si est disponible\n      if (projectType) {\n        query = query.eq('project_type', projectType);\n      }\n\n      // Filtrar por industria si est disponible\n      if (industry) {\n        query = query.eq('industry', industry);\n      }\n\n      // Filtrar por metodologa si est disponible\n      if (methodology) {\n        query = query.eq('methodology', methodology);\n      }\n\n      const { data: templates, error } = await query;\n\n      if (error) {\n        scheduleLogger.error('Error obteniendo templates:', error);\n        throw error;\n      }\n\n      scheduleLogger.debug(' Templates encontrados:', templates?.length || 0);\n\n      if (!templates || templates.length === 0) {\n        scheduleLogger.warn('No se encontraron templates especficos, usando template genrico');\n        // Buscar template genrico o el ms usado\n        let genericQuery = this.supabase\n          .from('schedule_templates')\n          .select('*');\n\n        if (this.organizationId) {\n          genericQuery = genericQuery.or(`organization_id.eq.${this.organizationId},organization_id.is.null`);\n        } else {\n          genericQuery = genericQuery.is('organization_id', null);\n        }\n\n        const { data: genericTemplates } = await genericQuery.limit(1);\n\n        if (genericTemplates?.[0]) {\n          return genericTemplates[0];\n        }\n\n        // Si no hay templates en la base de datos, crear uno genrico\n        scheduleLogger.debug(' Creando template genrico para el proyecto');\n        const genericTemplate = {\n          id: 'generic-template',\n          name: 'Template Genrico de Proyecto',\n          description: 'Template genrico basado en mejores prcticas de gestin de proyectos',\n          project_type: wizardData.projectType || 'general',\n          industry: wizardData.industry || 'general',\n          methodology: wizardData.methodology || 'waterfall',\n          template_data: this.getGenericTemplateData(wizardData)\n        };\n\n        // Extraer actividades de las fases para el aprendizaje\n        if (genericTemplate.template_data && genericTemplate.template_data.phases) {\n          genericTemplate.activities = this.extractActivitiesFromPhases(genericTemplate.template_data.phases);\n          genericTemplate.milestones = this.extractMilestonesFromPhases(genericTemplate.template_data.phases);\n        }\n\n        return genericTemplate;\n      }\n\n      // Seleccionar el template ms apropiado\n      const bestTemplate = this.rankTemplates(templates, wizardData)[0];\n\n      // Extraer actividades de las fases para el aprendizaje\n      if (bestTemplate && bestTemplate.template_data && bestTemplate.template_data.phases) {\n        bestTemplate.activities = this.extractActivitiesFromPhases(bestTemplate.template_data.phases);\n        bestTemplate.milestones = this.extractMilestonesFromPhases(bestTemplate.template_data.phases);\n      }\n\n      return bestTemplate;\n\n    } catch (error) {\n      scheduleLogger.error('Error obteniendo template base:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Ajustar actividades del template por contexto del proyecto\n   */\n  async adjustActivitiesByContext(template, context, activitiesToAdjust = null) {\n    if (!template) {\n      scheduleLogger.warn('Template no vlido para ajustar actividades');\n      return [];\n    }\n\n    // Usar actividades proporcionadas, o extraer del template\n    let activities = activitiesToAdjust;\n    if (!activities) {\n      activities = template.activities;\n      if (!activities && template.template_data && template.template_data.phases) {\n        activities = this.extractActivitiesFromPhases(template.template_data.phases);\n      }\n    }\n\n    if (!activities || activities.length === 0) {\n      scheduleLogger.warn('No hay actividades disponibles en el template');\n      return [];\n    }\n\n    const adjustedActivities = [];\n    let activityId = 1;\n\n    // Ajustar duraciones basado en el tamao del equipo\n    const teamSizeMultiplier = this.calculateTeamSizeMultiplier(context.teamSize);\n\n    // Ajustar duraciones basado en la experiencia del equipo\n    const experienceMultiplier = this.calculateExperienceMultiplier(context.teamExperience);\n\n    activities.forEach((activity, activityIndex) => {\n      // Calcular duracin ajustada\n      let adjustedDuration = activity.duration;\n\n      // Aplicar multiplicadores\n      adjustedDuration = Math.ceil(adjustedDuration * teamSizeMultiplier * experienceMultiplier);\n\n      // Aplicar ajustes especficos para maquinaria\n      if (context.projectType === 'equipment_installation') {\n        adjustedDuration = this.adjustMachineryActivityDuration(activity, adjustedDuration, context);\n      }\n\n      // Aplicar buffer de riesgo si es necesario\n      if (context.riskTolerance === 'low') {\n        adjustedDuration = Math.ceil(adjustedDuration * 1.2); // 20% ms tiempo\n      } else if (context.riskTolerance === 'high') {\n        adjustedDuration = Math.ceil(adjustedDuration * 0.8); // 20% menos tiempo\n      }\n\n      // Crear actividad ajustada (sin dependencias por ahora)\n      const adjustedActivity = {\n        id: `ai-${activityId++}`,\n        name: activity.name,\n        description: this.generateActivityDescription(activity, context),\n        duration: Math.max(1, adjustedDuration), // Mnimo 1 da\n        category: activity.category || 'execution',\n        phase: activity.phase || 'General',\n        phaseIndex: activity.phaseIndex || 0,\n        activityIndex: activityIndex,\n        isMilestone: activity.isMilestone || false,\n        priority: this.determinePriority(activity, context),\n        assignedTo: this.suggestAssignee(activity, context),\n        dependencies: activity.dependencies || [], // Temporalmente mantener las dependencias originales\n        estimatedCost: this.estimateCost(activity, context),\n        requiredSkills: activity.requiredSkills || [],\n        parallel: activity.parallel || false,\n        generatedBy: 'ai',\n        confidence: this.calculateConfidence(activity, context)\n      };\n\n      adjustedActivities.push(adjustedActivity);\n    });\n\n    // CORRECCIN: Ajustar dependencias despus de crear todas las actividades\n    adjustedActivities.forEach((activity, index) => {\n      if (activity.dependencies && activity.dependencies.length > 0) {\n        activity.dependencies = this.adjustDependencies(activity.dependencies, adjustedActivities);\n      } else if (index > 0) {\n        // Si no tiene dependencias y no es la primera actividad, crear dependencia secuencial\n        activity.dependencies = [adjustedActivities[index - 1].id];\n        scheduleLogger.debug(` Agregando dependencia secuencial: ${activity.name} depende de ${adjustedActivities[index - 1].name}`);\n      }\n    });\n\n    return adjustedActivities;\n  }\n\n  /**\n   * Generar hitos inteligentes basados en las actividades\n   */\n  async generateSmartMilestones(activities, context) {\n    const milestones = [];\n    let milestoneId = 1;\n\n    // Agrupar actividades por fase\n    const activitiesByPhase = {};\n    activities.forEach(activity => {\n      if (!activitiesByPhase[activity.phase]) {\n        activitiesByPhase[activity.phase] = [];\n      }\n      activitiesByPhase[activity.phase].push(activity);\n    });\n\n    // Crear hitos por fase\n    Object.entries(activitiesByPhase).forEach(([phaseName, phaseActivities]) => {\n      const phaseMilestone = {\n        id: `milestone-${milestoneId++}`,\n        name: `HITO: ${phaseName} Completada`,\n        description: `Completar todas las actividades de la fase: ${phaseName}`,\n        phase: phaseName,\n        isMilestone: true,\n        duration: 0, // Los hitos no tienen duracin\n        startDate: null, // Se calcular despus\n        endDate: null, // Se calcular despus\n        progress: 0,\n        status: 'pending',\n        priority: 'high',\n        assignedTo: context.projectManager || 'Pendiente',\n        dependencies: [],\n        criteria: this.generateMilestoneCriteria(phaseName, phaseActivities),\n        generatedBy: 'ai',\n        confidence: 0.9\n      };\n\n      milestones.push(phaseMilestone);\n    });\n\n    // Agregar hitos especficos por tipo de proyecto\n    const specificMilestones = this.generateSpecificMilestones(context, activities);\n    milestones.push(...specificMilestones);\n\n    return milestones;\n  }\n\n  /**\n   * Calcular ruta crtica del proyecto\n   */\n  calculateCriticalPath(activities) {\n    // Implementacin simplificada de CPM\n    const criticalActivities = activities.filter(activity => {\n      // Actividades con alta prioridad o sin flexibilidad en fechas\n      return activity.priority === 'high' ||\n        activity.dependencies.length > 2 ||\n        activity.estimatedCost > 10000;\n    });\n\n    return criticalActivities.map(activity => activity.id);\n  }\n\n  /**\n   * Generar recomendaciones basadas en el anlisis\n   */\n  generateRecommendations(wizardData, activities) {\n    const recommendations = [];\n\n    // Recomendacin basada en tamao del equipo\n    if (wizardData.teamSize < 3) {\n      recommendations.push({\n        type: 'team',\n        priority: 'high',\n        title: 'Equipo Pequeo',\n        description: 'Con un equipo pequeo, considera reducir el paralelismo de actividades para evitar sobrecarga.',\n        action: 'Revisar actividades paralelas y secuencializar si es necesario'\n      });\n    }\n\n    // Recomendacin basada en experiencia\n    if (wizardData.teamExperience === 'junior') {\n      recommendations.push({\n        type: 'experience',\n        priority: 'medium',\n        title: 'Equipo Junior',\n        description: 'Equipo con poca experiencia. Considera agregar tiempo de capacitacin y mentora.',\n        action: 'Agregar actividades de capacitacin y revisin adicional'\n      });\n    }\n\n    // Recomendacin basada en duracin del proyecto\n    const totalDuration = this.calculateTotalDuration(activities);\n    if (totalDuration > 180) {\n      recommendations.push({\n        type: 'duration',\n        priority: 'high',\n        title: 'Proyecto de Larga Duracin',\n        description: 'Proyecto de ms de 6 meses. Considera dividir en fases ms pequeas.',\n        action: 'Implementar hitos de control mensuales'\n      });\n    }\n\n    // Recomendacin basada en complejidad\n    const highComplexityActivities = activities.filter(a => a.priority === 'high').length;\n    if (highComplexityActivities > activities.length * 0.3) {\n      recommendations.push({\n        type: 'complexity',\n        priority: 'medium',\n        title: 'Alta Complejidad',\n        description: 'Muchas actividades de alta complejidad. Considera agregar buffers de tiempo.',\n        action: 'Agregar 15% de buffer en estimaciones de tiempo'\n      });\n    }\n\n    return recommendations;\n  }\n\n  /**\n   * Guardar historial de generacin para aprendizaje\n   */\n  async saveGenerationHistory(wizardData, generatedSchedule) {\n    try {\n      const generationRecord = {\n        project_id: wizardData.projectId,\n        template_id: generatedSchedule.metadata.templateId || null, // Usar ID del template, no el nombre\n        input_data: wizardData,\n        generated_schedule: generatedSchedule,\n        created_by: this.currentUser.id,\n        organization_id: this.organizationId\n      };\n\n      const { error } = await this.supabase\n        .from('ai_schedule_generations')\n        .insert(generationRecord);\n\n      if (error) {\n        scheduleLogger.error('Error guardando historial de generacin:', error);\n      } else {\n        scheduleLogger.debug(' Historial de generacin guardado');\n      }\n    } catch (error) {\n      scheduleLogger.error('Error guardando historial:', error);\n    }\n  }\n\n  // =====================================================\n  // MTODOS AUXILIARES\n  // =====================================================\n\n  /**\n   * Calcular multiplicador basado en tamao del equipo\n   */\n  calculateTeamSizeMultiplier(teamSize) {\n    if (teamSize <= 2) return 1.3; // 30% ms tiempo\n    if (teamSize <= 5) return 1.0; // Tiempo normal\n    if (teamSize <= 8) return 0.9; // 10% menos tiempo\n    return 0.8; // 20% menos tiempo para equipos grandes\n  }\n\n  /**\n   * Calcular multiplicador basado en experiencia del equipo\n   */\n  calculateExperienceMultiplier(experience) {\n    switch (experience) {\n      case 'junior': return 1.4; // 40% ms tiempo\n      case 'intermediate': return 1.1; // 10% ms tiempo\n      case 'senior': return 0.9; // 10% menos tiempo\n      case 'expert': return 0.8; // 20% menos tiempo\n      default: return 1.0;\n    }\n  }\n\n  /**\n   * Generar descripcin de actividad\n   */\n  generateActivityDescription(activity, context) {\n    const baseDescription = activity.description || `Ejecutar ${activity.name}`;\n\n    if (context.projectDescription) {\n      return `${baseDescription} para el proyecto: ${context.projectDescription}`;\n    }\n\n    return baseDescription;\n  }\n\n  /**\n   * Determinar prioridad de actividad\n   */\n  determinePriority(activity, context) {\n    if (activity.category === 'planning') return 'high';\n    if (activity.category === 'testing') return 'high';\n    if (activity.isMilestone) return 'high';\n    if (activity.parallel) return 'medium';\n    return 'medium';\n  }\n\n  /**\n   * Sugerir asignacin de actividad\n   */\n  suggestAssignee(activity, context) {\n    if (context.projectManager) return context.projectManager;\n\n    // Sugerencias basadas en categora\n    switch (activity.category) {\n      case 'planning': return 'Project Manager';\n      case 'execution': return 'Team Lead';\n      case 'testing': return 'QA Lead';\n      case 'delivery': return 'Project Manager';\n      default: return 'Pendiente';\n    }\n  }\n\n  /**\n   * Ajustar dependencias\n   */\n  adjustDependencies(dependencies, existingActivities) {\n    // CORRECCIN: Asegurar que siempre devuelva un array vlido\n    if (!dependencies || !Array.isArray(dependencies)) {\n      scheduleLogger.debug(' Dependencias no definidas o invlidas, usando array vaco');\n      return [];\n    }\n\n    // Convertir nombres de dependencias a IDs si es necesario\n    const adjustedDeps = dependencies.map(dep => {\n      // Si es un ID (string o nmero), mantenerlo\n      if (typeof dep === 'string' && dep.startsWith('activity-')) {\n        return dep;\n      }\n      if (typeof dep === 'number') {\n        return dep;\n      }\n\n      // Si es un nombre, buscar la actividad correspondiente\n      const existingActivity = existingActivities.find(a => a.name === dep);\n      if (existingActivity) {\n        scheduleLogger.debug(` Mapeando dependencia \"${dep}\" a ID \"${existingActivity.id}\"`);\n        return existingActivity.id;\n      }\n\n      scheduleLogger.warn(` Dependencia \"${dep}\" no encontrada en actividades existentes`);\n      return null;\n    }).filter(dep => dep !== null); // Filtrar dependencias nulas\n\n    scheduleLogger.debug(` Dependencias ajustadas: [${adjustedDeps.join(', ')}]`);\n    return adjustedDeps;\n  }\n\n  /**\n   * Estimar costo de actividad\n   */\n  estimateCost(activity, context) {\n    const baseCost = activity.estimatedCost || 1000;\n    const teamSize = context.teamSize || 1;\n    const duration = activity.duration || 1;\n\n    return baseCost * teamSize * duration * 0.1; // Estimacin simplificada\n  }\n\n  /**\n   * Calcular confianza en la actividad\n   */\n  calculateConfidence(activity, context) {\n    let confidence = 0.7; // Base confidence\n\n    // Aumentar confianza si hay template especfico\n    if (context.projectType && context.industry) confidence += 0.2;\n\n    // Aumentar confianza si hay experiencia en el equipo\n    if (context.teamExperience === 'senior' || context.teamExperience === 'expert') {\n      confidence += 0.1;\n    }\n\n    return Math.min(1.0, confidence);\n  }\n\n  /**\n   * Generar criterios de hito\n   */\n  generateMilestoneCriteria(phaseName, activities) {\n    const activityNames = activities.map(a => a.name).join(', ');\n    return `Completar exitosamente: ${activityNames}`;\n  }\n\n  /**\n   * Generar hitos especficos por tipo de proyecto\n   */\n  generateSpecificMilestones(context, activities) {\n    const specificMilestones = [];\n    let milestoneId = 1000; // IDs altos para hitos especficos\n\n    switch (context.projectType) {\n      case 'equipment_installation':\n        specificMilestones.push({\n          id: `milestone-${milestoneId++}`,\n          name: 'HITO: Equipo Recibido y Verificado',\n          description: 'Equipo recibido, inspeccionado y verificado segn especificaciones',\n          isMilestone: true,\n          duration: 0,\n          progress: 0,\n          status: 'pending',\n          priority: 'high',\n          assignedTo: 'Quality Inspector',\n          criteria: 'Equipo recibido, inspeccin de calidad aprobada, documentacin verificada',\n          generatedBy: 'ai',\n          confidence: 0.9\n        });\n        break;\n\n      case 'development':\n        specificMilestones.push({\n          id: `milestone-${milestoneId++}`,\n          name: 'HITO: Cdigo en Produccin',\n          description: 'Cdigo desplegado y funcionando en ambiente de produccin',\n          isMilestone: true,\n          duration: 0,\n          progress: 0,\n          status: 'pending',\n          priority: 'high',\n          assignedTo: 'DevOps Lead',\n          criteria: 'Deployment exitoso, pruebas de humo pasando, monitoreo activo',\n          generatedBy: 'ai',\n          confidence: 0.9\n        });\n        break;\n    }\n\n    return specificMilestones;\n  }\n\n\n  /**\n   * Calcular duracin total del proyecto\n   */\n  calculateTotalDuration(activities) {\n    return activities.reduce((total, activity) => total + (activity.duration || 0), 0);\n  }\n\n  /**\n   * Evaluar complejidad del proyecto\n   */\n  assessComplexity(wizardData, activities) {\n    let complexity = 'medium';\n\n    const totalDuration = this.calculateTotalDuration(activities);\n    const highPriorityActivities = activities.filter(a => a.priority === 'high').length;\n    const teamSize = wizardData.teamSize || 1;\n\n    if (totalDuration > 120 || highPriorityActivities > 5 || teamSize < 3) {\n      complexity = 'high';\n    } else if (totalDuration < 30 && highPriorityActivities < 3 && teamSize >= 5) {\n      complexity = 'low';\n    }\n\n    return complexity;\n  }\n\n  /**\n   * Clasificar templates por relevancia\n   */\n  rankTemplates(templates, wizardData) {\n    return templates.sort((a, b) => {\n      let scoreA = 0;\n      let scoreB = 0;\n\n      // Puntuar por coincidencia de tipo de proyecto\n      if (a.project_type === wizardData.projectType) scoreA += 3;\n      if (b.project_type === wizardData.projectType) scoreB += 3;\n\n      // Puntuar por coincidencia de industria\n      if (a.industry === wizardData.industry) scoreA += 2;\n      if (b.industry === wizardData.industry) scoreB += 2;\n\n      // Puntuar por coincidencia de metodologa\n      if (a.methodology === wizardData.methodology) scoreA += 1;\n      if (b.methodology === wizardData.methodology) scoreB += 1;\n\n      return scoreB - scoreA; // Orden descendente\n    });\n  }\n\n  /**\n   * Obtener template genrico cuando no hay templates especficos\n   */\n  getGenericTemplateData(wizardData) {\n    const { projectType = 'general', teamSize = 5 } = wizardData;\n\n    // Template genrico basado en el tipo de proyecto\n    const genericPhases = {\n      'manufacturing': [\n        {\n          name: 'Planificacin',\n          activities: [\n            { name: 'Definicin de requerimientos', duration: 5, category: 'planning' },\n            { name: 'Diseo conceptual', duration: 10, category: 'design' },\n            { name: 'Planificacin de recursos', duration: 3, category: 'planning' }\n          ]\n        },\n        {\n          name: 'Diseo y Desarrollo',\n          activities: [\n            { name: 'Diseo detallado', duration: 15, category: 'design' },\n            { name: 'Especificaciones tcnicas', duration: 8, category: 'design' },\n            { name: 'Prototipo', duration: 20, category: 'development' }\n          ]\n        },\n        {\n          name: 'Implementacin',\n          activities: [\n            { name: 'Compra e instalacin de maquinas y equipos', duration: 30, category: 'procurement', isMilestone: true },\n            { name: 'Instalacin y configuracin', duration: 15, category: 'implementation' },\n            { name: 'Pruebas de funcionamiento', duration: 10, category: 'testing' }\n          ]\n        },\n        {\n          name: 'Cierre',\n          activities: [\n            { name: 'Capacitacin del personal', duration: 5, category: 'training' },\n            { name: 'Documentacin final', duration: 3, category: 'documentation' },\n            { name: 'Entrega del proyecto', duration: 2, category: 'delivery', isMilestone: true }\n          ]\n        }\n      ],\n      'general': [\n        {\n          name: 'Inicio',\n          activities: [\n            { name: 'Kick-off del proyecto', duration: 1, category: 'planning', isMilestone: true },\n            { name: 'Definicin de alcance', duration: 5, category: 'planning' },\n            { name: 'Planificacin inicial', duration: 7, category: 'planning' }\n          ]\n        },\n        {\n          name: 'Ejecucin',\n          activities: [\n            { name: 'Desarrollo de actividades principales', duration: 20, category: 'execution' },\n            { name: 'Seguimiento y control', duration: 15, category: 'monitoring' },\n            { name: 'Gestin de cambios', duration: 8, category: 'management' }\n          ]\n        },\n        {\n          name: 'Cierre',\n          activities: [\n            { name: 'Pruebas finales', duration: 5, category: 'testing' },\n            { name: 'Entrega del proyecto', duration: 3, category: 'delivery', isMilestone: true }\n          ]\n        }\n      ]\n    };\n\n    return {\n      phases: genericPhases[projectType] || genericPhases.general,\n      estimatedDuration: 60,\n      complexity: 'medium',\n      riskLevel: 'medium'\n    };\n  }\n\n  /**\n   * Obtener templates disponibles\n   */\n  async getAvailableTemplates() {\n    try {\n      let query = this.supabase\n        .from('schedule_templates')\n        .select('*');\n\n      if (this.organizationId) {\n        query = query.or(`organization_id.eq.${this.organizationId},organization_id.is.null`);\n      } else {\n        query = query.is('organization_id', null);\n      }\n\n      const { data: templates, error } = await query.order('name');\n\n      if (error) {\n        scheduleLogger.error('Error obteniendo templates:', error);\n        return [];\n      }\n\n      return templates || [];\n    } catch (error) {\n      scheduleLogger.error('Error obteniendo templates:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Obtener historial de generaciones\n   */\n  async getGenerationHistory(projectId = null) {\n    try {\n      let query = this.supabase\n        .from('ai_schedule_generations')\n        .select('*')\n        .eq('organization_id', this.organizationId)\n        .order('created_at', { ascending: false });\n\n      if (projectId) {\n        query = query.eq('project_id', projectId);\n      }\n\n      const { data: history, error } = await query;\n\n      if (error) {\n        scheduleLogger.error('Error obteniendo historial:', error);\n        return [];\n      }\n\n      return history || [];\n    } catch (error) {\n      scheduleLogger.error('Error obteniendo historial:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Proporcionar feedback sobre una generacin\n   */\n  async provideFeedback(generationId, feedbackScore, feedbackComments = '') {\n    try {\n      const { error } = await this.supabase\n        .from('ai_schedule_generations')\n        .update({\n          feedback_score: feedbackScore,\n          feedback_comments: feedbackComments,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', generationId)\n        .eq('organization_id', this.organizationId);\n\n      if (error) {\n        scheduleLogger.error('Error guardando feedback:', error);\n        return false;\n      }\n\n      scheduleLogger.debug(' Feedback guardado exitosamente');\n      return true;\n    } catch (error) {\n      scheduleLogger.error('Error guardando feedback:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Extraer actividades de las fases del template\n   */\n  extractActivitiesFromPhases(phases) {\n    if (!phases || !Array.isArray(phases)) {\n      return [];\n    }\n\n    const activities = [];\n    let activityId = 1;\n\n    phases.forEach((phase, phaseIndex) => {\n      if (phase.activities && Array.isArray(phase.activities)) {\n        phase.activities.forEach((activity, activityIndex) => {\n          activities.push({\n            id: `activity-${activityId}`,\n            name: activity.name,\n            duration: activity.duration || 1,\n            category: activity.category || 'general',\n            phase: phase.name,\n            phaseIndex: phaseIndex,\n            activityIndex: activityIndex,\n            isMilestone: activity.isMilestone || false,\n            priority: activity.priority || 'medium',\n            dependencies: activity.dependencies || []\n          });\n          activityId++;\n        });\n      }\n    });\n\n    // CORRECCIN: Generar dependencias secuenciales automticas\n    activities.forEach((activity, index) => {\n      if (!activity.dependencies || activity.dependencies.length === 0) {\n        // Generar dependencias secuenciales lgicas\n        if (index === 0) {\n          // Primera actividad: sin predecesoras\n          activity.dependencies = [];\n        } else {\n          // Actividades subsecuentes: depender de la anterior\n          activity.dependencies = [activities[index - 1].id]; // ID de la actividad anterior\n        }\n      }\n    });\n\n    scheduleLogger.debug(` Actividades extradas de fases: ${activities.length}`);\n    scheduleLogger.debug(` Dependencias generadas automticamente para ${activities.length} actividades`);\n    return activities;\n  }\n\n  /**\n   * Extraer actividades de un template (genrico o de base de datos)\n   */\n  async extractActivitiesFromTemplate(template, context = null) {\n    let activities = [];\n\n    if (template.activities && template.activities.length > 0) {\n      activities = template.activities;\n    } else if (template.template_data && template.template_data.phases) {\n      activities = this.extractActivitiesFromPhases(template.template_data.phases);\n    } else {\n      scheduleLogger.warn('No se pudieron extraer actividades del template');\n      return [];\n    }\n\n    // Agregar actividades especficas para maquinaria si es necesario\n    if (context && context.projectType === 'equipment_installation') {\n      activities = this.addMachinerySpecificActivities(activities, context);\n    }\n\n    return activities;\n  }\n\n  /**\n   * Extraer hitos de las fases del template\n   */\n  extractMilestonesFromPhases(phases) {\n    if (!phases || !Array.isArray(phases)) {\n      return [];\n    }\n\n    const milestones = [];\n    let milestoneId = 1;\n\n    phases.forEach((phase, phaseIndex) => {\n      if (phase.activities && Array.isArray(phase.activities)) {\n        phase.activities.forEach((activity, activityIndex) => {\n          if (activity.isMilestone) {\n            milestones.push({\n              id: `milestone-${milestoneId}`,\n              name: activity.name,\n              phase: phase.name,\n              phaseIndex: phaseIndex,\n              activityIndex: activityIndex,\n              description: activity.description || `Hito: ${activity.name}`\n            });\n            milestoneId++;\n          }\n        });\n      }\n    });\n\n    scheduleLogger.debug(` Hitos extrados de fases: ${milestones.length}`);\n    return milestones;\n  }\n\n  /**\n   * Ajustar duracin de actividad especfica para maquinaria\n   */\n  adjustMachineryActivityDuration(activity, baseDuration, context) {\n    const activityName = activity.name.toLowerCase();\n    let adjustedDuration = baseDuration;\n\n    // Actividades relacionadas con fabricacin/produccin - usar tiempo de entrega\n    if (activityName.includes('fabricacin') || activityName.includes('manufactura') ||\n      activityName.includes('produccin') || activityName.includes('manufacturing')) {\n\n      if (context.deliveryTime && context.deliveryTimeUnit) {\n        const deliveryDays = this.convertToDays(context.deliveryTime, context.deliveryTimeUnit);\n        adjustedDuration = deliveryDays;\n        scheduleLogger.debug(` Ajustando \"${activity.name}\": ${baseDuration}d  ${adjustedDuration}d (tiempo de entrega: ${context.deliveryTime} ${context.deliveryTimeUnit})`);\n      } else {\n        scheduleLogger.debug(` No se pudo ajustar \"${activity.name}\": deliveryTime=${context.deliveryTime}, deliveryTimeUnit=${context.deliveryTimeUnit}`);\n      }\n    }\n\n    // Actividades administrativas - duraciones cortas y fijas\n    if (activityName.includes('aprobacin') || activityName.includes('aprobacin de compras') ||\n      activityName.includes('autorizacin') || activityName.includes('firma de contratos')) {\n\n      adjustedDuration = Math.min(adjustedDuration, 5); // Mximo 5 das para aprobaciones\n      scheduleLogger.debug(` Ajustando \"${activity.name}\": ${baseDuration}d  ${adjustedDuration}d (actividad administrativa)`);\n    }\n\n    // Actividades de importacin - agregar tiempo adicional\n    if (context.isForeignEquipment &&\n      (activityName.includes('importacin') || activityName.includes('aduana') ||\n        activityName.includes('embarque') || activityName.includes('transporte'))) {\n\n      adjustedDuration = Math.max(adjustedDuration, 15); // Mnimo 15 das para importacin\n      scheduleLogger.debug(` Ajustando \"${activity.name}\": ${baseDuration}d  ${adjustedDuration}d (importacin)`);\n    }\n\n    // Actividades de infraestructura - agregar tiempo adicional\n    if (context.requiresInfrastructure &&\n      (activityName.includes('instalacin') || activityName.includes('infraestructura') ||\n        activityName.includes('preparacin') || activityName.includes('cimentacin'))) {\n\n      adjustedDuration = Math.max(adjustedDuration, 10); // Mnimo 10 das para infraestructura\n      scheduleLogger.debug(` Ajustando \"${activity.name}\": ${baseDuration}d  ${adjustedDuration}d (infraestructura)`);\n    }\n\n    return adjustedDuration;\n  }\n\n  /**\n   * Convertir tiempo a das\n   */\n  convertToDays(amount, unit) {\n    switch (unit) {\n      case 'days':\n        return amount;\n      case 'weeks':\n        return amount * 7;\n      case 'months':\n        return amount * 30; // Aproximacin\n      default:\n        return amount;\n    }\n  }\n\n  /**\n   * Agregar actividades especficas para maquinaria\n   */\n  addMachinerySpecificActivities(activities, context) {\n    const newActivities = [...activities];\n    let activityId = activities.length + 1;\n\n    // Actividades de importacin si es equipo extranjero\n    if (context.isForeignEquipment) {\n      const importActivities = [\n        {\n          id: `activity-${activityId++}`,\n          name: 'Proceso de importacin y aduanas',\n          duration: 15,\n          category: 'procurement',\n          phase: 'Adquisicin',\n          isMilestone: false,\n          priority: 'high'\n        },\n        {\n          id: `activity-${activityId++}`,\n          name: 'Embarque y transporte internacional',\n          duration: Math.max(10, this.convertToDays(context.deliveryTime || 4, context.deliveryTimeUnit || 'weeks') / 3),\n          category: 'procurement',\n          phase: 'Adquisicin',\n          isMilestone: false,\n          priority: 'high'\n        }\n      ];\n\n      newActivities.push(...importActivities);\n      scheduleLogger.debug(` Agregadas ${importActivities.length} actividades de importacin`);\n    }\n\n    // Actividades de infraestructura si es requerida\n    if (context.requiresInfrastructure) {\n      const infrastructureActivities = [\n        {\n          id: `activity-${activityId++}`,\n          name: 'Preparacin del sitio de instalacin',\n          duration: 10,\n          category: 'preparation',\n          phase: 'Implementacin',\n          isMilestone: false,\n          priority: 'high'\n        },\n        {\n          id: `activity-${activityId++}`,\n          name: 'Modificaciones de infraestructura elctrica',\n          duration: 8,\n          category: 'infrastructure',\n          phase: 'Implementacin',\n          isMilestone: false,\n          priority: 'high'\n        },\n        {\n          id: `activity-${activityId++}`,\n          name: 'Cimentacin y bases para equipos',\n          duration: 12,\n          category: 'infrastructure',\n          phase: 'Implementacin',\n          isMilestone: false,\n          priority: 'high'\n        }\n      ];\n\n      newActivities.push(...infrastructureActivities);\n      scheduleLogger.debug(` Agregadas ${infrastructureActivities.length} actividades de infraestructura`);\n    }\n\n    // Actividades de anticipos basadas en la configuracin\n    if (context.advancePayments && context.advancePayments.length > 0) {\n      const paymentActivities = context.advancePayments.map((payment, index) => ({\n        id: `activity-${activityId++}`,\n        name: `${payment.percentage}% - ${payment.description}`,\n        duration: 2,\n        category: 'financial',\n        phase: this.getPaymentPhase(payment.timing),\n        isMilestone: true,\n        priority: 'high',\n        paymentInfo: {\n          percentage: payment.percentage,\n          timing: payment.timing,\n          description: payment.description\n        }\n      }));\n\n      newActivities.push(...paymentActivities);\n      scheduleLogger.debug(` Agregadas ${paymentActivities.length} actividades de anticipos`);\n    }\n\n    scheduleLogger.debug(` Total actividades despus de agregar especficas de maquinaria: ${newActivities.length}`);\n    return newActivities;\n  }\n\n  /**\n   * Determinar la fase basada en el timing del pago\n   */\n  getPaymentPhase(timing) {\n    switch (timing) {\n      case 'order':\n        return 'Planificacin';\n      case 'production':\n        return 'Adquisicin';\n      case 'shipping':\n        return 'Adquisicin';\n      case 'delivery':\n        return 'Implementacin';\n      case 'installation':\n        return 'Implementacin';\n      case 'performance':\n        return 'Cierre';\n      default:\n        return 'Planificacin';\n    }\n  }\n\n  /**\n   * Obtener el orden temporal de un anticipo\n   */\n  getPaymentTimingOrder(timing) {\n    switch (timing) {\n      case 'order':\n        return 1; // Al inicio del proyecto\n      case 'production':\n        return 2; // Durante fabricacin\n      case 'shipping':\n        return 3; // Antes del envo\n      case 'delivery':\n        return 4; // Al entregar\n      case 'installation':\n        return 5; // Despus de instalacin\n      case 'performance':\n        return 6; // Al final\n      default:\n        return 999;\n    }\n  }\n\n  /**\n   * Ordenar actividades de maquinaria lgicamente\n   */\n  sortMachineryActivities(activities, context) {\n    scheduleLogger.debug(' Iniciando ordenamiento de actividades:', activities.length);\n\n    // Funcin simple para obtener el orden de una actividad\n    const getActivitySortOrder = (activity) => {\n      const name = activity.name.toLowerCase();\n\n      // Actividades de planificacin (primero)\n      if (name.includes('anlisis') || name.includes('necesidades') || name.includes('requerimientos')) {\n        return 100;\n      }\n\n      // Anticipos segn timing\n      if (activity.paymentInfo) {\n        switch (activity.paymentInfo.timing) {\n          case 'order':\n            return 200; // Despus de anlisis\n          case 'production':\n            return 800; // Durante fabricacin\n          case 'shipping':\n            return 900; // Antes del envo\n          case 'delivery':\n            return 1200; // Al entregar\n          case 'installation':\n            return 1300; // Despus de instalacin\n          case 'performance':\n            return 1400; // Al final\n          default:\n            return 200;\n        }\n      }\n\n      // Actividades de planificacin y aprobacin\n      if (name.includes('aprobacin') || name.includes('autorizacin') || name.includes('planificacin')) {\n        return 300;\n      }\n\n      // Bsqueda y seleccin de proveedores\n      if (name.includes('bsqueda') || name.includes('proveedor') || name.includes('cotizacin')) {\n        return 400;\n      }\n\n      // Actividades de compra y contratos\n      if (name.includes('compra') || name.includes('contrato') || name.includes('firma')) {\n        return 500;\n      }\n\n      // Fabricacin y produccin\n      if (name.includes('fabricacin') || name.includes('produccin') || name.includes('manufactura')) {\n        return 600;\n      }\n\n      // Actividades de importacin\n      if (name.includes('importacin') || name.includes('aduana') || name.includes('embarque')) {\n        return 700;\n      }\n\n      // Actividades de infraestructura\n      if (name.includes('infraestructura') || name.includes('preparacin') || name.includes('sitio')) {\n        return 1000;\n      }\n\n      // Instalacin\n      if (name.includes('instalacin') || name.includes('montaje') || name.includes('configuracin')) {\n        return 1100;\n      }\n\n      // Actividades de cierre\n      if (name.includes('capacitacin') || name.includes('documentacin') || name.includes('garanta') || name.includes('soporte')) {\n        return 1500;\n      }\n\n      // Actividades de entrega\n      if (name.includes('entrega')) {\n        return 1250;\n      }\n\n      // Por defecto, usar el orden de fase\n      return this.getPhaseOrder(activity.phase) * 100;\n    };\n\n    const sortedActivities = activities.sort((a, b) => {\n      const orderA = getActivitySortOrder(a);\n      const orderB = getActivitySortOrder(b);\n\n      scheduleLogger.debug(` Ordenando: ${a.name} (${orderA}) vs ${b.name} (${orderB})`);\n\n      if (orderA !== orderB) {\n        return orderA - orderB;\n      }\n\n      // Si tienen el mismo orden, ordenar alfabticamente\n      return a.name.localeCompare(b.name);\n    });\n\n    scheduleLogger.debug(' Actividades ordenadas:');\n    sortedActivities.forEach((activity, index) => {\n      scheduleLogger.debug(`${index + 1}. ${activity.name} (${getActivitySortOrder(activity)})`);\n    });\n\n    return sortedActivities;\n  }\n\n  /**\n   * Obtener el orden de una actividad dentro de su fase\n   */\n  getActivityOrder(activityName, phase) {\n    const activityOrder = {\n      'Planificacin': [\n        'anlisis', 'requerimientos', 'planificacin', 'aprobacin', 'orden', 'cotizacin'\n      ],\n      'Adquisicin': [\n        'cotizacin', 'proveedor', 'compra', 'fabricacin', 'produccin', 'importacin',\n        'aduana', 'embarque', 'transporte'\n      ],\n      'Implementacin': [\n        'infraestructura', 'preparacin', 'sitio', 'cimentacin', 'elctrica',\n        'instalacin', 'configuracin', 'prueba', 'entrega'\n      ],\n      'Cierre': [\n        'capacitacin', 'documentacin', 'garanta', 'soporte', 'performance'\n      ]\n    };\n\n    const phaseOrder = activityOrder[phase] || [];\n    for (let i = 0; i < phaseOrder.length; i++) {\n      if (activityName.includes(phaseOrder[i])) {\n        return i;\n      }\n    }\n    return 999; // Al final si no se encuentra\n  }\n\n  /**\n   * Obtener el orden de una fase\n   */\n  getPhaseOrder(phase) {\n    const phaseOrder = {\n      'Planificacin': 1,\n      'Adquisicin': 2,\n      'Implementacin': 3,\n      'Cierre': 4,\n      'General': 5\n    };\n    return phaseOrder[phase] || 5;\n  }\n\n  /**\n   * Obtener la posicin relativa de un anticipo en el proyecto\n   */\n  getPaymentRelativePosition(timing) {\n    switch (timing) {\n      case 'order':\n        return 500; // Al inicio, despus de anlisis\n      case 'production':\n        return 2500; // Durante fabricacin\n      case 'shipping':\n        return 2800; // Antes del envo\n      case 'delivery':\n        return 3500; // Al entregar\n      case 'installation':\n        return 3800; // Despus de instalacin\n      case 'performance':\n        return 4500; // Al final\n      default:\n        return 9999;\n    }\n  }\n}\n\n// Exportar como singleton\nconst smartSchedulerService = new SmartSchedulerService();\nexport default smartSchedulerService;\n","/**\n * ScheduleWizard - Componente principal del Asistente Inteligente de Cronogramas\n * StrategiaPM - MVP Implementation\n * \n * Wizard de 4 pasos para generar cronogramas automticamente con IA\n */\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport ProjectAnalysisStep from './ProjectAnalysisStep';\nimport ResourceConfigStep from './ResourceConfigStep';\nimport MilestoneDefinitionStep from './MilestoneDefinitionStep';\n// import LearningStep from './LearningStep'; // DEPRECATED - eliminado en v1.0\nimport MachineryConfigStep from './MachineryConfigStep';\nimport SchedulePreview from './SchedulePreview';\nimport smartSchedulerService from '../../services/AISchedulerService';\n\nconst ScheduleWizard = ({ \n  isOpen, \n  onClose, \n  onComplete, \n  projectId, \n  currentProject = null,\n  organizationId,\n  userId\n}) => {\n  const [currentStep, setCurrentStep] = useState(1);\n  const [wizardData, setWizardData] = useState({});\n  const [generatedSchedule, setGeneratedSchedule] = useState(null);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [error, setError] = useState(null);\n  const [availableTemplates, setAvailableTemplates] = useState([]);\n  const [showMachineryConfig, setShowMachineryConfig] = useState(false);\n\n  // Inicializar wizard cuando se abre\n  useEffect(() => {\n    if (isOpen) {\n      initializeWizard();\n    }\n  }, [isOpen]);\n\n  // Generar cronograma automticamente cuando se llega al paso 4 (Vista Previa)\n  useEffect(() => {\n    if (currentStep === 4 && (!needsMachineryStep() || !showMachineryConfig) && !generatedSchedule && !isGenerating) {\n      console.log(' Generando cronograma automticamente en paso 4...');\n      generateSchedule();\n    }\n  }, [currentStep, wizardData, generatedSchedule, isGenerating, showMachineryConfig]);\n\n  // Inicializar datos del wizard\n  const initializeWizard = async () => {\n    try {\n      setCurrentStep(1);\n      setWizardData({});\n      setGeneratedSchedule(null);\n      setError(null);\n      setIsGenerating(false);\n      setShowMachineryConfig(false);\n\n      // Cargar templates disponibles\n      await loadAvailableTemplates();\n\n      // Pre-llenar datos si hay un proyecto actual\n      if (currentProject) {\n        setWizardData({\n          projectId: projectId,\n          projectName: currentProject.name,\n          projectDescription: currentProject.description,\n          projectManager: currentProject.manager || 'Pendiente',\n          startDate: currentProject.startDate || new Date().toISOString().split('T')[0],\n          endDate: currentProject.endDate || null\n        });\n      } else {\n        setWizardData({\n          projectId: projectId,\n          startDate: new Date().toISOString().split('T')[0]\n        });\n      }\n    } catch (error) {\n      console.error('Error inicializando wizard:', error);\n      setError('Error inicializando el asistente de cronogramas');\n    }\n  };\n\n  // Cargar templates disponibles\n  const loadAvailableTemplates = async () => {\n    try {\n      const templates = await smartSchedulerService.getAvailableTemplates();\n      setAvailableTemplates(templates);\n      console.log(' Templates cargados:', templates.length);\n    } catch (error) {\n      console.error('Error cargando templates:', error);\n    }\n  };\n\n  // Actualizar datos del wizard\n  const updateWizardData = useCallback((newData) => {\n    setWizardData(prev => ({\n      ...prev,\n      ...newData\n    }));\n  }, []); // CORRECCIN: useCallback para evitar recreacin en cada render\n\n  // Avanzar al siguiente paso\n  const nextStep = () => {\n    if (currentStep < 4) {\n      setCurrentStep(prev => prev + 1);\n    } else if (currentStep === 4 && needsMachineryStep() && !showMachineryConfig) {\n      // Para proyectos de maquinaria, despus del paso 3, mostrar configuracin de maquinaria\n      setShowMachineryConfig(true);\n    } else if (currentStep === 4 && needsMachineryStep() && showMachineryConfig) {\n      // Despus de configurar maquinaria, ir a vista previa\n      setShowMachineryConfig(false);\n    }\n  };\n\n  // Retroceder al paso anterior\n  const prevStep = () => {\n    if (currentStep > 1) {\n      setCurrentStep(prev => prev - 1);\n    }\n  };\n\n  // Generar cronograma con IA\n  const generateSchedule = async () => {\n    try {\n      setIsGenerating(true);\n      setError(null);\n\n      console.log(' Iniciando generacin de cronograma...');\n      console.log(' Datos del wizard:', wizardData);\n\n      // Validar que tenemos datos suficientes\n      if (!wizardData.projectType) {\n        throw new Error('Tipo de proyecto no definido');\n      }\n\n      // Generar cronograma usando el servicio de IA\n      const schedule = await smartSchedulerService.generateSmartSchedule(wizardData);\n      \n      if (!schedule) {\n        throw new Error('No se pudo generar el cronograma');\n      }\n      \n      setGeneratedSchedule(schedule);\n      setCurrentStep(5); // Ir al paso 5 (vista previa del cronograma)\n      \n      console.log(' Cronograma generado exitosamente:', schedule);\n      console.log(' Actividades generadas:', schedule.activities?.length || 0);\n      console.log(' Hitos generados:', schedule.milestones?.length || 0);\n      \n    } catch (error) {\n      console.error(' Error generando cronograma:', error);\n      setError(`Error generando cronograma: ${error.message}`);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  // Completar wizard y aplicar cronograma\n  const completeWizard = () => {\n    if (generatedSchedule && onComplete) {\n      onComplete(generatedSchedule);\n      onClose();\n    }\n  };\n\n  // Cerrar wizard\n  const handleClose = () => {\n    setCurrentStep(1);\n    setWizardData({});\n    setGeneratedSchedule(null);\n    setError(null);\n    setIsGenerating(false);\n    onClose();\n  };\n\n  // Determinar si necesita paso de configuracin de maquinaria\n  const needsMachineryStep = () => {\n    return wizardData.projectType === 'equipment_installation';\n  };\n\n  // Obtener el nmero total de pasos\n  const getTotalSteps = () => {\n    return 4; // Ahora son 4 pasos (sin aprendizaje)\n  };\n\n\n  // Validar paso actual\n  const isCurrentStepValid = () => {\n    switch (currentStep) {\n      case 1:\n        return wizardData.projectName && wizardData.projectType;\n      case 2:\n        return wizardData.teamSize && wizardData.teamExperience;\n      case 3:\n        return wizardData.milestones && wizardData.milestones.length > 0;\n      case 4:\n        if (needsMachineryStep() && showMachineryConfig) {\n          return wizardData.deliveryTime && wizardData.advancePayments;\n        }\n        // Para el paso 4 (Vista Previa), validar que el cronograma est generado\n        return generatedSchedule !== null;\n      default:\n        return false;\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-5xl h-[95vh] max-h-[95vh] overflow-hidden flex flex-col\">\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h2 className=\"text-2xl font-bold flex items-center\">\n                <span className=\"text-3xl mr-3\"></span>\n                Asistente Inteligente de Cronogramas\n              </h2>\n              <p className=\"text-purple-100 mt-1\">\n                Genera cronogramas automticamente con IA\n              </p>\n            </div>\n            <button\n              onClick={handleClose}\n              className=\"text-white hover:text-purple-200 transition-colors\"\n            >\n              <span className=\"text-2xl\"></span>\n            </button>\n          </div>\n          \n          {/* Progress Bar */}\n          <div className=\"mt-4\">\n            <div className=\"flex items-center justify-between text-sm text-purple-100 mb-2\">\n              <span>Paso {currentStep} de {getTotalSteps()}</span>\n              <span>{Math.round((currentStep / getTotalSteps()) * 100)}% completado</span>\n            </div>\n            <div className=\"w-full bg-purple-300 rounded-full h-2\">\n              <div \n                className=\"bg-white h-2 rounded-full transition-all duration-300\"\n                style={{ width: `${(currentStep / getTotalSteps()) * 100}%` }}\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 overflow-y-auto flex-1\">\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\n              <div className=\"flex items-center\">\n                <span className=\"text-red-500 text-xl mr-3\"></span>\n                <div>\n                  <h3 className=\"text-red-800 font-semibold\">Error</h3>\n                  <p className=\"text-red-600\">{error}</p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Step 1: Anlisis del Proyecto */}\n          {currentStep === 1 && (\n            <ProjectAnalysisStep\n              wizardData={wizardData}\n              onUpdate={updateWizardData}\n              availableTemplates={availableTemplates}\n            />\n          )}\n\n          {/* Step 2: Configuracin de Recursos */}\n          {currentStep === 2 && (\n            <ResourceConfigStep\n              wizardData={wizardData}\n              onUpdate={updateWizardData}\n            />\n          )}\n\n          {/* Step 3: Definicin de Hitos */}\n          {currentStep === 3 && (\n            <MilestoneDefinitionStep\n              wizardData={wizardData}\n              onUpdate={updateWizardData}\n            />\n          )}\n\n          {/* Step 4: Configuracin de Maquinaria (solo para equipment_installation) */}\n          {currentStep === 4 && needsMachineryStep() && showMachineryConfig && (\n            <MachineryConfigStep\n              wizardData={wizardData}\n              onUpdate={updateWizardData}\n            />\n          )}\n\n          {/* Step 4: Vista Previa del Cronograma */}\n          {currentStep === 4 && (!needsMachineryStep() || !showMachineryConfig) && (\n            <SchedulePreview\n              wizardData={wizardData}\n              generatedSchedule={generatedSchedule}\n              isGenerating={isGenerating}\n              onGenerate={generateSchedule}\n            />\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"bg-gray-50 px-6 py-4 flex items-center justify-between border-t\">\n          <div className=\"flex items-center space-x-4\">\n            {currentStep > 1 && (\n              <button\n                onClick={prevStep}\n                className=\"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors\"\n              >\n                 Anterior\n              </button>\n            )}\n          </div>\n\n          <div className=\"flex items-center space-x-4\">\n            <button\n              onClick={handleClose}\n              className=\"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors\"\n            >\n              Cancelar\n            </button>\n\n            {currentStep < 4 || (currentStep === 4 && needsMachineryStep() && showMachineryConfig) ? (\n              <button\n                onClick={nextStep}\n                disabled={!isCurrentStepValid()}\n                className={`px-6 py-2 rounded-lg font-semibold transition-colors ${\n                  isCurrentStepValid()\n                    ? 'bg-purple-600 hover:bg-purple-700 text-white'\n                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                }`}\n              >\n                Siguiente \n              </button>\n            ) : (\n              <button\n                onClick={completeWizard}\n                disabled={!generatedSchedule}\n                className={`px-6 py-2 rounded-lg font-semibold transition-colors ${\n                  generatedSchedule\n                    ? 'bg-green-600 hover:bg-green-700 text-white'\n                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                }`}\n              >\n                 Aplicar Cronograma\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ScheduleWizard;\n","import { useCallback, useRef, useEffect } from 'react';\n\n/**\n * Hook para sincronizar datos a Supabase con debounce y batch updates\n *\n * @param {Function} syncFunction - Funcin que ejecuta la sincronizacin\n * @param {number} delay - Tiempo de espera en ms (default: 3000)\n * @returns {Object} { sync, isSyncing, lastSync, error, cancelSync }\n */\nconst useDebouncedSync = (syncFunction, delay = 3000) => {\n  const timeoutRef = useRef(null);\n  const isSyncingRef = useRef(false);\n  const lastSyncRef = useRef(null);\n  const errorRef = useRef(null);\n  const pendingDataRef = useRef(null);\n\n  /**\n   * Cancela la sincronizacin pendiente\n   */\n  const cancelSync = useCallback(() => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = null;\n      console.log(' Sincronizacin cancelada');\n    }\n  }, []);\n\n  /**\n   * Ejecuta la sincronizacin inmediatamente\n   */\n  const executeSync = useCallback(async (data) => {\n    if (isSyncingRef.current) {\n      console.log(' Sincronizacin ya en progreso, esperando...');\n      return;\n    }\n\n    try {\n      isSyncingRef.current = true;\n      errorRef.current = null;\n\n      // Disparar evento de inicio\n      window.dispatchEvent(new CustomEvent('autoSaveStart', {\n        detail: { timestamp: new Date().toISOString() }\n      }));\n\n      console.log(' Ejecutando sincronizacin...');\n      await syncFunction(data);\n\n      lastSyncRef.current = new Date();\n      console.log(' Sincronizacin completada:', lastSyncRef.current.toLocaleTimeString());\n\n      // Disparar evento de xito\n      window.dispatchEvent(new CustomEvent('autoSaveComplete', {\n        detail: {\n          timestamp: new Date().toISOString(),\n          lastSync: lastSyncRef.current\n        }\n      }));\n\n    } catch (error) {\n      console.error(' Error en sincronizacin:', error);\n      errorRef.current = error;\n\n      // Disparar evento de error\n      window.dispatchEvent(new CustomEvent('autoSaveError', {\n        detail: {\n          timestamp: new Date().toISOString(),\n          error: error.message\n        }\n      }));\n\n      // Guardar en localStorage para reintentar despus\n      try {\n        const retryData = {\n          data: pendingDataRef.current,\n          timestamp: new Date().toISOString(),\n          error: error.message\n        };\n        localStorage.setItem('pendingSyncData', JSON.stringify(retryData));\n        console.log(' Datos guardados en localStorage para reintentar');\n      } catch (storageError) {\n        console.error(' Error guardando para reintento:', storageError);\n      }\n\n    } finally {\n      isSyncingRef.current = false;\n      pendingDataRef.current = null;\n    }\n  }, [syncFunction]);\n\n  /**\n   * Programa una sincronizacin con debounce\n   */\n  const sync = useCallback((data) => {\n    // Guardar los datos pendientes\n    pendingDataRef.current = data;\n\n    // Cancelar timeout anterior\n    cancelSync();\n\n    // Programar nueva sincronizacin\n    console.log(`  Sincronizacin programada en ${delay}ms`);\n    timeoutRef.current = setTimeout(() => {\n      executeSync(data);\n    }, delay);\n\n  }, [delay, cancelSync, executeSync]);\n\n  /**\n   * Sincronizacin inmediata (sin debounce)\n   */\n  const syncNow = useCallback((data) => {\n    cancelSync();\n    executeSync(data);\n  }, [cancelSync, executeSync]);\n\n  /**\n   * Limpiar timeouts al desmontar\n   */\n  useEffect(() => {\n    return () => {\n      cancelSync();\n    };\n  }, [cancelSync]);\n\n  /**\n   * Intentar sincronizar datos pendientes al montar\n   */\n  useEffect(() => {\n    const retryPendingSync = async () => {\n      try {\n        const pendingDataStr = localStorage.getItem('pendingSyncData');\n        if (pendingDataStr) {\n          const retryData = JSON.parse(pendingDataStr);\n          console.log(' Reintentando sincronizacin pendiente desde:', retryData.timestamp);\n\n          await executeSync(retryData.data);\n\n          // Si tuvo xito, limpiar\n          localStorage.removeItem('pendingSyncData');\n          console.log(' Sincronizacin pendiente completada');\n        }\n      } catch (error) {\n        console.error(' Error en reintento de sincronizacin:', error);\n      }\n    };\n\n    // Esperar 2 segundos antes de reintentar (dar tiempo a que la app se inicialice)\n    const retryTimeout = setTimeout(retryPendingSync, 2000);\n\n    return () => clearTimeout(retryTimeout);\n  }, [executeSync]);\n\n  return {\n    sync,           // Sincronizar con debounce\n    syncNow,        // Sincronizar inmediatamente\n    isSyncing: isSyncingRef.current,\n    lastSync: lastSyncRef.current,\n    error: errorRef.current,\n    cancelSync\n  };\n};\n\nexport default useDebouncedSync;\n","import { useEffect, useCallback, useMemo } from 'react';\nimport { calculateAllTasksBusinessValue } from '../utils/businessValueCalculator';\nimport useDebouncedSync from './useDebouncedSync';\n\n/**\n * Hook para calcular y sincronizar automticamente businessValue de tareas\n *\n * @param {Array} tasks - Array de tareas\n * @param {Object} projectData - Datos del proyecto (con plannedValue)\n * @param {Function} supabaseService - Servicio de Supabase para sincronizacin\n * @param {boolean} useSupabase - Si est habilitado Supabase\n * @returns {Object} { tasksWithValue, isSyncing, lastSync, recalculate }\n */\nconst useBusinessValueSync = (tasks, projectData, supabaseService, useSupabase = false) => {\n\n  /**\n   * Calcular businessValue automticamente en memoria\n   */\n  const tasksWithValue = useMemo(() => {\n    // Si no hay proyecto o plannedValue, retornar tareas sin modificar\n    if (!projectData?.plannedValue) {\n      console.log(' No se puede calcular businessValue: falta plannedValue del proyecto');\n      return tasks;\n    }\n\n    // Verificar si hay tareas con businessValue = 0 o undefined\n    const hasTasksWithoutValue = tasks.some(task =>\n      task.businessValue === undefined || task.businessValue === null || task.businessValue === 0\n    );\n\n    if (!hasTasksWithoutValue) {\n      console.log(' Todas las tareas ya tienen businessValue calculado');\n      return tasks;\n    }\n\n    console.log(' Calculando businessValue automticamente...');\n    console.log(' Datos del proyecto:', {\n      plannedValue: projectData.plannedValue,\n      totalTasks: tasks.length\n    });\n\n    // Calcular valores de negocio para todas las tareas\n    const calculatedTasksArray = calculateAllTasksBusinessValue(\n      tasks,\n      projectData.plannedValue\n    );\n\n    // Crear un mapa de ID -> businessValue\n    const calculatedValuesMap = new Map();\n    calculatedTasksArray.forEach(task => {\n      calculatedValuesMap.set(task.id, task.businessValue);\n    });\n\n    // Aplicar valores calculados solo a tareas con businessValue = 0\n    const tasksWithCalculatedValues = tasks.map(task => {\n      if (task.businessValue === undefined || task.businessValue === null || task.businessValue === 0) {\n        const calculatedValue = calculatedValuesMap.get(task.id) || 0;\n        console.log(` Tarea \"${task.name}\": businessValue calculado = $${calculatedValue.toFixed(2)}`);\n        return {\n          ...task,\n          businessValue: calculatedValue\n        };\n      }\n      return task;\n    });\n\n    return tasksWithCalculatedValues;\n  }, [tasks, projectData?.plannedValue]);\n\n  /**\n   * Funcin para sincronizar a Supabase (batch update)\n   */\n  const syncToSupabase = useCallback(async (tasksToSync) => {\n    if (!useSupabase || !supabaseService || !projectData?.id) {\n      console.log(' Sincronizacin a Supabase deshabilitada');\n      return;\n    }\n\n    console.log(' Sincronizando businessValue a Supabase...');\n    console.log(`   Tareas a sincronizar: ${tasksToSync.length}`);\n\n    try {\n      console.log(' Iniciando sincronizacin de businessValue a Supabase...');\n      console.log(`   Total de tareas a sincronizar: ${tasksToSync.length}`);\n\n      // Actualizar cada tarea individualmente para evitar problemas con RLS\n      // RLS (Row-Level Security) puede bloquear UPSERT pero permitir UPDATE\n      let successCount = 0;\n      let errorCount = 0;\n\n      for (const task of tasksToSync) {\n        try {\n          const { error } = await supabaseService.supabase\n            .from('tasks')\n            .update({\n              business_value: task.businessValue || 0,\n              updated_at: new Date().toISOString()\n            })\n            .eq('id', task.id)\n            .eq('project_id', projectData.id);\n\n          if (error) {\n            console.error(` Error actualizando tarea ${task.id}:`, error);\n            errorCount++;\n          } else {\n            successCount++;\n          }\n        } catch (taskError) {\n          console.error(` Error inesperado en tarea ${task.id}:`, taskError);\n          errorCount++;\n        }\n      }\n\n      console.log(` Sincronizacin completada: ${successCount} exitosas, ${errorCount} errores`);\n\n      if (errorCount > 0) {\n        throw new Error(`${errorCount} tareas no se pudieron sincronizar`);\n      }\n\n    } catch (error) {\n      console.error(' Error sincronizando businessValue a Supabase:', error);\n      throw error; // Re-lanzar para que useDebouncedSync lo maneje\n    }\n  }, [useSupabase, supabaseService, projectData?.id]);\n\n  /**\n   * Hook de sincronizacin con debounce\n   */\n  const { sync, syncNow, isSyncing, lastSync, error } = useDebouncedSync(syncToSupabase, 3000);\n\n  /**\n   * Sincronizar automticamente cuando cambian los valores calculados\n   */\n  useEffect(() => {\n    // Solo sincronizar si:\n    // 1. Supabase est habilitado\n    // 2. Hay tareas con valores calculados\n    // 3. Los valores son diferentes a los originales\n    if (useSupabase && tasksWithValue.length > 0) {\n      // Verificar si hay cambios\n      const hasChanges = tasksWithValue.some((task, index) => {\n        const originalTask = tasks[index];\n        return originalTask && task.businessValue !== originalTask.businessValue;\n      });\n\n      if (hasChanges) {\n        console.log(' Valores de negocio cambiaron, programando sincronizacin...');\n        sync(tasksWithValue);\n      }\n    }\n  }, [tasksWithValue, useSupabase, sync, tasks]);\n\n  /**\n   * Funcin para forzar reclculo y sincronizacin inmediata\n   */\n  const recalculate = useCallback(() => {\n    console.log(' Recalculando y sincronizando inmediatamente...');\n\n    // Forzar reclculo poniendo todos los businessValue en 0\n    const tasksToRecalc = tasks.map(task => ({\n      ...task,\n      businessValue: 0\n    }));\n\n    // Recalcular\n    const recalculatedTasks = calculateAllTasksBusinessValue(\n      tasksToRecalc,\n      projectData?.plannedValue\n    );\n\n    // Sincronizar inmediatamente (sin debounce)\n    if (useSupabase) {\n      syncNow(recalculatedTasks);\n    }\n\n    return recalculatedTasks;\n  }, [tasks, projectData?.plannedValue, useSupabase, syncNow]);\n\n  return {\n    tasksWithValue,      // Tareas con businessValue calculado\n    isSyncing,           // Estado de sincronizacin\n    lastSync,            // ltima sincronizacin exitosa\n    error,               // Error si lo hay\n    recalculate,         // Funcin para forzar reclculo\n    syncNow: () => syncNow(tasksWithValue)  // Sincronizar ahora\n  };\n};\n\nexport default useBusinessValueSync;\n","/**\n * @fileoverview Constantes compartidas para el mdulo de cronogramas\n * @module utils/scheduleConstants\n */\n\n/**\n * Milisegundos en un da (24 horas)\n * @constant {number}\n */\nexport const DAY = 1000 * 60 * 60 * 24;\n\n/**\n * Altura de cada fila en el diagrama de Gantt (en pxeles)\n * @constant {number}\n */\nexport const ROW_H = 50;\n\n/**\n * Padding superior para el diagrama de Gantt (en pxeles)\n * @constant {number}\n */\nexport const PADDING_TOP = 10;\n","/**\n * @fileoverview Funciones de validacin y seguridad para el mdulo de cronogramas\n * @module utils/scheduleValidation\n */\n\n/**\n * Sanitiza input de usuario para prevenir ataques XSS\n * @param {string|any} input - Input a sanitizar\n * @returns {string|any} Input sanitizado o el valor original si no es string\n */\nexport const sanitizeInput = (input) => {\n  if (typeof input !== 'string') return input;\n\n  return input\n    .replace(/<script[^>]*>.*?<\\/script>/gi, '') // Remover scripts\n    .replace(/javascript:/gi, '') // Remover javascript:\n    .replace(/on\\w+=/gi, '') // Remover event handlers\n    .replace(/[<>]/g, '') // Remover < y >\n    .trim()\n    .substring(0, 1000); // Limitar longitud\n};\n\n/**\n * Valida el nombre de una tarea\n * @param {string} name - Nombre de la tarea\n * @returns {{valid: boolean, error?: string, sanitized?: string}} Resultado de la validacin\n */\nexport const validateTaskName = (name) => {\n  if (!name || typeof name !== 'string') return { valid: false, error: 'Nombre de tarea requerido' };\n  if (name.length < 2) return { valid: false, error: 'Nombre debe tener al menos 2 caracteres' };\n  if (name.length > 255) return { valid: false, error: 'Nombre muy largo (mximo 255 caracteres)' };\n  return { valid: true, sanitized: sanitizeInput(name) };\n};\n\n/**\n * Valida la duracin de una tarea\n * @param {number|string} duration - Duracin en das\n * @returns {{valid: boolean, error?: string, value?: number}} Resultado de la validacin\n */\nexport const validateDuration = (duration) => {\n  const num = parseInt(duration);\n  if (isNaN(num) || num < 0 || num > 365) {\n    return { valid: false, error: 'Duracin debe ser un nmero entre 0 y 365 das' };\n  }\n  return { valid: true, value: num };\n};\n\n/**\n * Valida una fecha\n * @param {string|Date} date - Fecha a validar\n * @returns {{valid: boolean, error?: string, value?: string}} Resultado de la validacin\n */\nexport const validateDate = (date) => {\n  // Importar toISO de forma lazy para evitar dependencias circulares\n  const toISO = (d) => {\n    if (!d) return new Date().toISOString().split('T')[0];\n    const dateObj = new Date(d);\n    if (isNaN(dateObj.getTime())) {\n      console.warn('Invalid date in toISO:', d);\n      return new Date().toISOString().split('T')[0];\n    }\n    return dateObj.toISOString().split('T')[0];\n  };\n\n  if (!date) return { valid: false, error: 'Fecha requerida' };\n  const dateObj = new Date(date);\n  if (isNaN(dateObj.getTime())) return { valid: false, error: 'Fecha invlida' };\n  const currentYear = new Date().getFullYear();\n  if (dateObj.getFullYear() < 2020 || dateObj.getFullYear() > currentYear + 10) {\n    return { valid: false, error: 'Fecha fuera del rango permitido (2020-' + (currentYear + 10) + ')' };\n  }\n  return { valid: true, value: toISO(dateObj) };\n};\n\n/**\n * Ordena tareas por su cdigo WBS\n * @param {Array<Object>} tasks - Array de tareas\n * @returns {Array<Object>} Tareas ordenadas\n */\nexport const sortTasksByWbsCode = (tasks) => {\n  return [...tasks].sort((a, b) => {\n    // Funcin mejorada para manejar diferentes formatos de wbsCode\n    const getNumericValue = (wbsCode) => {\n      if (!wbsCode) return 0;\n\n      // Si es un nmero directo\n      if (typeof wbsCode === 'number') return wbsCode;\n\n      // Si es string, extraer solo los nmeros\n      const numericMatch = String(wbsCode).match(/\\d+/);\n      if (numericMatch) {\n        return parseInt(numericMatch[0], 10);\n      }\n\n      // Si contiene \"Sin predecesoras\" o similar, poner al final\n      if (String(wbsCode).toLowerCase().includes('sin')) return 999999;\n\n      return 0;\n    };\n\n    const aNum = getNumericValue(a.wbsCode);\n    const bNum = getNumericValue(b.wbsCode);\n\n    // Si los nmeros son iguales, mantener orden original\n    if (aNum === bNum) {\n      return 0;\n    }\n\n    return aNum - bNum;\n  });\n};\n","/**\n * @fileoverview Utilidades de manipulacin de fechas para cronogramas\n * @module utils/scheduleDateUtils\n */\n\nimport { DAY } from './scheduleConstants';\n\n/**\n * Convierte una fecha a formato ISO (YYYY-MM-DD)\n * @param {Date|string} d - Fecha a convertir\n * @returns {string} Fecha en formato ISO\n */\nexport const toISO = (d) => {\n  if (!d) return new Date().toISOString().split('T')[0];\n  const date = new Date(d);\n  if (isNaN(date.getTime())) {\n    console.warn('Invalid date in toISO:', d);\n    return new Date().toISOString().split('T')[0];\n  }\n  return date.toISOString().split('T')[0];\n};\n\n/**\n * Verifica si un da es laboral (lunes a viernes)\n * @param {Date|string} date - Fecha a verificar\n * @returns {boolean} true si es da laboral\n */\nexport const isWorkingDay = (date) => {\n  const dayOfWeek = new Date(date).getDay();\n  return dayOfWeek >= 1 && dayOfWeek <= 5; // 1=Lunes, 5=Viernes\n};\n\n/**\n * Ajusta una fecha al siguiente da laborable\n * @param {Date|string} date - Fecha a ajustar\n * @returns {Date} Fecha ajustada\n */\nexport const adjustToWorkingDay = (date) => {\n  let adjustedDate = new Date(date);\n  while (!isWorkingDay(adjustedDate)) {\n    adjustedDate.setDate(adjustedDate.getDate() + 1);\n  }\n  return adjustedDate;\n};\n\n/**\n * Encuentra el primer da laboral desde una fecha\n * @param {Date|string} startDate - Fecha de inicio\n * @returns {string} Fecha del primer da laboral en formato ISO\n */\nexport const findFirstWorkingDay = (startDate) => {\n  let current = new Date(startDate);\n  while (!isWorkingDay(current)) {\n    current.setDate(current.getDate() + 1);\n  }\n  return toISO(current);\n};\n\n/**\n * Aade das laborales (excluye sbados y domingos)\n * @param {Date|string} date - Fecha inicial\n * @param {number} days - Nmero de das a aadir\n * @returns {string} Fecha resultante en formato ISO\n */\nexport const addWorkingDays = (date, days) => {\n  // Si la duracin es 0, devolver la misma fecha\n  if (days === 0) {\n    return date;\n  }\n\n  let currentDate = new Date(date + 'T00:00:00');\n  let daysAdded = 0;\n\n  // CORRECCIN: Incluir el da de inicio en el conteo\n  // Si el da de inicio es laborable, contarlo como da 1\n  if (isWorkingDay(currentDate)) {\n    daysAdded = 1;\n  }\n\n  // Si ya tenemos todos los das necesarios, devolver la fecha actual\n  if (daysAdded >= days) {\n    return toISO(currentDate);\n  }\n\n  // Continuar aadiendo das hasta completar la duracin\n  while (daysAdded < days) {\n    currentDate.setDate(currentDate.getDate() + 1);\n    const isWorking = isWorkingDay(currentDate);\n\n    if (isWorking) {\n      daysAdded++;\n    }\n  }\n\n  const result = toISO(currentDate);\n  return result;\n};\n\n/**\n * Aade das (laborales o calendario segn configuracin)\n * @param {Date|string} date - Fecha inicial\n * @param {number} days - Nmero de das a aadir\n * @param {boolean} [includeWeekends=false] - Si true, incluye fines de semana\n * @returns {string} Fecha resultante en formato ISO\n */\nexport const addDays = (date, days, includeWeekends = false) => {\n  // Si la duracin es 0, devolver la misma fecha\n  if (days === 0) {\n    return date;\n  }\n\n  if (includeWeekends) {\n    // Comportamiento original: incluye sbados y domingos\n    const d = new Date(date);\n    d.setDate(d.getDate() + days);\n    return toISO(d);\n  } else {\n    // Nuevo comportamiento: solo das laborales\n    return addWorkingDays(date, days);\n  }\n};\n\n/**\n * Calcula diferencia de das (exclusivo)\n * @param {Date|string} a - Fecha inicial\n * @param {Date|string} b - Fecha final\n * @param {boolean} [includeWeekends=false] - Si true, incluye fines de semana\n * @returns {number} Diferencia en das\n */\nexport const diffDaysExclusive = (a, b, includeWeekends = false) => {\n  if (includeWeekends) {\n    // Comportamiento original: das calendario\n    const d1 = new Date(toISO(a));\n    const d2 = new Date(toISO(b));\n    return Math.max(0, Math.round((d2.getTime() - d1.getTime()) / DAY));\n  } else {\n    // Comportamiento corregido: contar posiciones de columnas visibles\n    return diffVisibleColumnsExclusive(a, b);\n  }\n};\n\n/**\n * Calcula diferencia de columnas visibles (exclusivo)\n * @param {Date|string} a - Fecha inicial\n * @param {Date|string} b - Fecha final\n * @returns {number} Diferencia en columnas\n */\nexport const diffVisibleColumnsExclusive = (a, b) => {\n  const d1 = new Date(toISO(a));\n  const d2 = new Date(toISO(b));\n  return Math.max(0, Math.round((d2.getTime() - d1.getTime()) / DAY));\n};\n\n/**\n * Encuentra el ndice de columna de una fecha\n * @param {Date|string} targetDate - Fecha objetivo\n * @param {Date|string} referenceStartDate - Fecha de referencia\n * @param {boolean} includeWeekends - Si true, incluye fines de semana\n * @returns {number} ndice de columna\n */\nexport const findColumnIndex = (targetDate, referenceStartDate, includeWeekends) => {\n  const target = new Date(toISO(targetDate));\n  const start = new Date(referenceStartDate);\n  let columnIndex = 0;\n  let current = new Date(start);\n\n  // Debug temporal\n  const shouldDebug = toISO(targetDate).includes('2025-09-01');\n  if (shouldDebug) {\n    console.log(' findColumnIndex DEBUG:');\n    console.log('   targetDate:', toISO(targetDate));\n    console.log('   referenceStartDate:', referenceStartDate);\n    console.log('   includeWeekends:', includeWeekends);\n    console.log('   isTargetBeforeStart:', target < start);\n  }\n\n  // CASO ESPECIAL: Si target es anterior al start, calcular ndice negativo\n  if (target < start) {\n    let tempCurrent = new Date(target);\n    while (tempCurrent < start) {\n      if (includeWeekends || isWorkingDay(tempCurrent)) {\n        columnIndex--;\n        if (shouldDebug) {\n          console.log(' Columna negativa:', toISO(tempCurrent), 'ndice:', columnIndex);\n        }\n      }\n      tempCurrent.setDate(tempCurrent.getDate() + 1);\n    }\n  } else {\n    // CASO NORMAL: target igual o posterior al start\n    //  CORRECCIN: Incluir la fecha de inicio en el conteo para alineacin perfecta\n    while (current <= target) {\n      // Solo contar das que se muestran como columnas\n      if (includeWeekends || isWorkingDay(current)) {\n        columnIndex++;\n        if (shouldDebug) {\n          console.log(' Columna contada:', toISO(current), 'ndice:', columnIndex);\n        }\n      } else if (shouldDebug) {\n        console.log(' Da saltado (fin de semana):', toISO(current));\n      }\n      current.setDate(current.getDate() + 1);\n    }\n  }\n\n  if (shouldDebug) {\n    console.log(' findColumnIndex resultado final:', columnIndex);\n  }\n\n  return columnIndex;\n};\n\n/**\n * Calcula duracin de columnas visibles (inclusivo)\n * @param {Date|string} start - Fecha inicial\n * @param {Date|string} end - Fecha final\n * @returns {number} Duracin en columnas\n */\nexport const durationVisibleColumnsInclusive = (start, end) => {\n  const d1 = new Date(toISO(start));\n  const d2 = new Date(toISO(end));\n  return Math.max(1, Math.round((d2.getTime() - d1.getTime()) / DAY) + 1);\n};\n\n/**\n * Calcula duracin de das (inclusivo)\n * @param {Date|string} start - Fecha inicial\n * @param {Date|string} end - Fecha final\n * @param {boolean} [includeWeekends=false] - Si true, incluye fines de semana\n * @returns {number} Duracin en das\n */\nexport const durationDaysInclusive = (start, end, includeWeekends = false) => {\n  if (includeWeekends) {\n    // Comportamiento original: das calendario\n    return diffDaysExclusive(start, addDays(end, 1, true), true);\n  } else {\n    // Comportamiento corregido: contar columnas visibles que abarca la tarea\n    return durationVisibleColumnsInclusive(start, end);\n  }\n};\n\n/**\n * Limita un valor entre 0 y 1\n * @param {number} x - Valor a limitar\n * @returns {number} Valor limitado\n */\nexport const clamp01 = (x) => Math.min(1, Math.max(0, x));\n\n/**\n * Parsea una fecha de Excel (nmero serial)\n * @param {number|string|Date} v - Valor a parsear\n * @returns {string} Fecha en formato ISO\n */\nexport const parseExcelDate = (v) => {\n  if (typeof v === 'number') {\n    const ms = Math.round((v - 25569) * 86400 * 1000);\n    return toISO(new Date(ms));\n  }\n  if (!v) return toISO(new Date());\n  const d = new Date(v);\n  return Number.isNaN(d.getTime()) ? toISO(new Date()) : toISO(d);\n};\n","/**\n * @fileoverview Algoritmo CPM (Critical Path Method) para anlisis de cronogramas\n * @module utils/scheduleCPM\n */\n\nimport { DAY } from './scheduleConstants';\nimport { toISO, addDays, adjustToWorkingDay } from './scheduleDateUtils';\n\n/**\n * Calcula sensibilidad de una tarea\n * @param {Object} task - Tarea a analizar\n * @param {Array<Object>} allTasks - Todas las tareas del proyecto\n * @returns {number} Nivel de sensibilidad (0-10)\n */\nexport const calculateTaskSensitivity = (task, allTasks) => {\n  let sensitivity = 0;\n\n  // Factores de sensibilidad\n  if (task.isCritical) sensitivity += 3; // Tarea crtica\n  if (task.predecessors.length === 0) sensitivity += 1; // Tarea de inicio\n  if (task.successors.length === 0) sensitivity += 1; // Tarea final\n  if (task.resources.length > 2) sensitivity += 2; // Muchos recursos\n  if (task.duration > 10) sensitivity += 1; // Tarea larga\n\n  // Dependencias complejas\n  const complexDeps = task.predecessors.filter(predId => {\n    const pred = allTasks.find(t => t.id === predId);\n    return pred && pred.successors.length > 1;\n  }).length;\n  sensitivity += complexDeps;\n\n  return Math.min(10, sensitivity); // Mximo 10\n};\n\n/**\n * Encuentra mltiples rutas crticas en el proyecto\n * @param {Array<Object>} tasks - Array de tareas\n * @returns {Array<Array<string>>} Array de rutas crticas\n */\nexport const findCriticalPaths = (tasks) => {\n  const criticalPaths = [];\n  const visited = new Set();\n\n  const dfs = (taskId, currentPath) => {\n    if (visited.has(taskId)) return;\n\n    const task = tasks.find(t => t.id === taskId);\n    if (!task) return;\n\n    visited.add(taskId);\n    currentPath.push(taskId);\n\n    if (task.successors.length === 0) {\n      // Tarea final - verificar si es ruta crtica\n      const pathDuration = currentPath.reduce((total, id) => {\n        const t = tasks.find(task => task.id === id);\n        return total + (t ? t.duration : 0);\n      }, 0);\n\n      if (pathDuration === Math.max(...tasks.map(t => new Date(t.earlyFinish) - new Date(t.startDate) / DAY))) {\n        criticalPaths.push(currentPath.slice());\n      }\n    } else {\n      // Continuar con sucesoras\n      for (const succId of task.successors) {\n        dfs(succId, currentPath);\n      }\n    }\n\n    currentPath.pop();\n    visited.delete(taskId);\n  };\n\n  // Encontrar tareas de inicio\n  const startTasks = tasks.filter(t => t.predecessors.length === 0);\n  for (const startTask of startTasks) {\n    dfs(startTask.id, []);\n  }\n\n  return criticalPaths;\n};\n\n/**\n * Calcula mtricas del proyecto basadas en CPM\n * @param {Array<Object>} tasks - Array de tareas\n * @param {Array<string>} criticalTasks - IDs de tareas crticas\n * @returns {Object} Mtricas del proyecto\n */\nexport const calculateProjectMetrics = (tasks, criticalTasks) => {\n  // Calcular duracin total del proyecto de manera ms robusta\n  let totalDuration = 0;\n  if (tasks.length > 0) {\n    const startDates = tasks.map(t => new Date(t.startDate));\n    const endDates = tasks.map(t => new Date(t.endDate));\n\n    const minStart = new Date(Math.min(...startDates));\n    const maxEnd = new Date(Math.max(...endDates));\n\n    // Calcular diferencia en das de manera segura\n    const timeDiff = maxEnd.getTime() - minStart.getTime();\n    totalDuration = Math.max(0, Math.round(timeDiff / (1000 * 60 * 60 * 24)));\n  }\n\n  const criticalDuration = criticalTasks.reduce((total, id) => {\n    const task = tasks.find(t => t.id === id);\n    return total + (task ? task.duration : 0);\n  }, 0);\n\n  // Asegurar que la duracin total sea al menos igual a la ruta crtica\n  const adjustedTotalDuration = Math.max(totalDuration, criticalDuration);\n\n  const totalCost = tasks.reduce((total, t) => total + (t.cost || 0), 0);\n  const criticalCost = criticalTasks.reduce((total, id) => {\n    const task = tasks.find(t => t.id === id);\n    return total + (task ? (task.cost || 0) : 0);\n  }, 0);\n\n  return {\n    totalDuration: adjustedTotalDuration,\n    criticalDuration: Math.round(criticalDuration),\n    totalCost,\n    criticalCost,\n    criticalPercentage: Math.round((criticalCost / totalCost) * 100),\n    averageFloat: Math.round(tasks.reduce((sum, t) => sum + t.totalFloat, 0) / tasks.length),\n    maxFloat: Math.max(...tasks.map(t => t.totalFloat)),\n    criticalTasksCount: criticalTasks.length,\n    // Agregar informacin de debug\n    originalDuration: totalDuration,\n    criticalPathLength: criticalDuration,\n    durationDifference: adjustedTotalDuration - totalDuration\n  };\n};\n\n/**\n * Calcula CPM (Critical Path Method) para un conjunto de tareas\n * @param {Array<Object>} tasks - Array de tareas\n * @param {boolean} [includeWeekends=false] - Si true, incluye fines de semana\n * @returns {{tasks: Array<Object>, error: string|null, criticalPath: Array<string>, criticalPathLength: number, criticalPaths: Array<Array<string>>, projectMetrics: Object}} Resultado del clculo CPM\n */\nexport const calculateCPM = (tasks, includeWeekends = false) => {\n  // Limpiar tareas duplicadas antes de procesar\n  const uniqueTasks = [];\n  const seenIds = new Set();\n  let duplicatesRemoved = 0;\n\n  for (const task of tasks) {\n    if (seenIds.has(task.id)) {\n      console.warn(` Tarea duplicada detectada en CPM: ${task.id} - ${task.name}`);\n      duplicatesRemoved++;\n    } else {\n      seenIds.add(task.id);\n      uniqueTasks.push(task);\n    }\n  }\n\n  if (duplicatesRemoved > 0) {\n    console.warn(` Se eliminaron ${duplicatesRemoved} tareas duplicadas en CPM`);\n  }\n\n  const taskMap = new Map(uniqueTasks.map(t => [t.id, {\n    id: t.id,\n    wbsCode: t.wbsCode,\n    name: t.name,\n    duration: t.duration,\n    startDate: t.startDate,\n    endDate: t.endDate,\n    progress: t.progress,\n    predecessors: [...(t.predecessors || [])],\n    cost: t.cost,\n    priority: t.priority,\n    assignedTo: t.assignedTo,\n    isMilestone: t.isMilestone,\n    isCritical: t.isCritical,\n    originalDuration: t.originalDuration,\n    earlyStart: t.earlyStart,\n    earlyFinish: t.earlyFinish,\n    lateStart: t.lateStart,\n    lateFinish: t.lateFinish,\n    totalFloat: t.totalFloat,\n    freeFloat: t.freeFloat,\n    description: t.description,\n    resources: [...(t.resources || [])],\n    workPackageId: t.workPackageId,\n    status: t.status,\n    successors: [...(t.successors || [])]\n  }]));\n  const updatedTasks = Array.from(taskMap.values());\n\n  // Forward pass - calcular Early Start y Early Finish\n  const calculateForwardPass = () => {\n    const visited = new Set();\n    const calculating = new Set();\n\n    const calculateEarly = (taskId) => {\n      if (visited.has(taskId)) return;\n      if (calculating.has(taskId)) {\n        console.warn(`Dependencia circular detectada en la tarea: ${taskId}. Saltando clculo.`);\n        // NO modificar las dependencias aqu para evitar duplicacin\n        // Solo marcar como visitada para evitar bucles infinitos\n        visited.add(taskId);\n        calculating.delete(taskId);\n        return; // Saltar sin modificar dependencias\n      }\n\n      calculating.add(taskId);\n      const task = taskMap.get(taskId);\n      if (!task) return;\n\n      // CORRECCIN: Solo respetar fechas de template si NO tiene predecesoras\n      // Las tareas con predecesoras deben recalcularse para respetar dependencias\n      if (task.templateCalculated && task.predecessors.length === 0) {\n        console.log(` Respetando fechas calculadas por template para tarea sin predecesoras: ${task.name}`);\n        return; // No recalcular fechas ya calculadas por template\n      }\n\n      // CORRECCIN: Inicializar correctamente segn si tiene predecesoras\n      let maxEarlyFinish;\n\n      if (task.predecessors.length === 0) {\n        // Para tareas sin predecesoras, usar la fecha de inicio original\n        maxEarlyFinish = new Date(task.startDate);\n      } else {\n        // Para tareas con predecesoras, inicializar con fecha muy temprana\n        maxEarlyFinish = new Date('1900-01-01');\n      }\n\n      for (const predId of task.predecessors) {\n        calculateEarly(predId);\n        const pred = taskMap.get(predId);\n        if (pred) {\n          let predFinish = new Date(pred.earlyFinish);\n          if (predFinish > maxEarlyFinish) {\n            maxEarlyFinish = predFinish;\n          }\n        }\n      }\n\n      // Aplicar regla de dependencias Finish-to-Start como MS Project\n      if (task.predecessors.length > 0 && !task.isMilestone) {\n        // Para dependencias Finish-to-Start: empezar al da siguiente del predecesor\n        maxEarlyFinish.setDate(maxEarlyFinish.getDate() + 1);\n      }\n\n      // Ajustar fecha de inicio a da laborable si es necesario\n      if (!includeWeekends) {\n        maxEarlyFinish = adjustToWorkingDay(maxEarlyFinish);\n      }\n\n      task.earlyStart = toISO(maxEarlyFinish);\n\n      // Para hitos: fecha de fin = fecha de inicio (exactamente igual)\n      if (task.isMilestone) {\n        task.earlyFinish = task.earlyStart;  // MISMO da\n        // CORRECCIN: Aplicar fechas calculadas por CPM como MS Project\n        task.startDate = task.earlyStart;\n        task.endDate = task.earlyFinish;\n      } else {\n        task.earlyFinish = addDays(task.earlyStart, task.duration, includeWeekends);\n        // CORRECCIN: Aplicar fechas calculadas por CPM como MS Project\n        task.startDate = task.earlyStart;\n        task.endDate = task.earlyFinish;\n      }\n\n      calculating.delete(taskId);\n      visited.add(taskId);\n    };\n\n    for (const task of updatedTasks) {\n      calculateEarly(task.id);\n    }\n  };\n\n  // Backward pass - calcular Late Start y Late Finish\n  const calculateBackwardPass = () => {\n    const finalTasks = updatedTasks.filter(t => t.successors.length === 0);\n\n    let projectEnd = new Date('1900-01-01');\n    for (const task of finalTasks) {\n      const taskEnd = new Date(task.earlyFinish);\n      if (taskEnd > projectEnd) {\n        projectEnd = taskEnd;\n      }\n    }\n\n    const visited = new Set();\n\n    const calculateLate = (taskId) => {\n      if (visited.has(taskId)) return;\n\n      const task = taskMap.get(taskId);\n      if (!task) return;\n\n      if (task.successors.length === 0) {\n        task.lateFinish = task.earlyFinish;\n      } else {\n        let minLateStart = new Date('2100-01-01');\n        for (const succId of task.successors) {\n          calculateLate(succId);\n          const succ = taskMap.get(succId);\n          if (succ) {\n            let succLateStart = new Date(succ.lateStart);\n            // Para tareas normales, la predecesora debe terminar un da antes\n            // Para hitos sucesores, pueden compartir el mismo da\n            if (!succ.isMilestone) {\n              succLateStart.setDate(succLateStart.getDate() - 1);\n            }\n            if (succLateStart < minLateStart) {\n              minLateStart = succLateStart;\n            }\n          }\n        }\n        task.lateFinish = toISO(minLateStart);\n      }\n\n      // Para hitos: lateStart = lateFinish\n      if (task.isMilestone) {\n        task.lateStart = task.lateFinish;\n      } else {\n        const lateFinishDate = new Date(task.lateFinish);\n        lateFinishDate.setDate(lateFinishDate.getDate() - task.duration);\n        task.lateStart = toISO(lateFinishDate);\n      }\n\n      visited.add(taskId);\n    };\n\n    // CORRECCIN: Calcular primero las tareas finales, luego las dems\n    for (const task of finalTasks) {\n      calculateLate(task.id);\n    }\n\n    // CORRECCIN: Calcular el resto de tareas en orden inverso\n    for (const task of updatedTasks) {\n      if (!visited.has(task.id)) {\n        calculateLate(task.id);\n      }\n    }\n\n    // CORRECCIN: Asegurar que las tareas sin predecesoras tengan lateStart = earlyStart\n    for (const task of updatedTasks) {\n      if (task.predecessors.length === 0) {\n        task.lateStart = task.earlyStart;\n        // Para hitos: lateFinish = earlyStart\n        if (task.isMilestone) {\n          task.lateFinish = task.earlyStart;\n        } else {\n          const lateFinishDate = new Date(task.earlyStart);\n          lateFinishDate.setDate(lateFinishDate.getDate() + task.duration);\n          task.lateFinish = toISO(lateFinishDate);\n        }\n      }\n    }\n  };\n\n  try {\n    calculateForwardPass();\n    calculateBackwardPass();\n\n    // Calcular slack total y libre, identificar ruta crtica\n    let criticalPathLength = 0;\n    const criticalTasks = [];\n\n    for (const task of updatedTasks) {\n      const earlyStart = new Date(task.earlyStart);\n      const lateStart = new Date(task.lateStart);\n      const totalFloat = Math.round((lateStart - earlyStart) / DAY);\n\n      task.totalFloat = Math.max(0, totalFloat);\n      task.isCritical = task.totalFloat === 0;\n\n      // Calcular slack libre\n      let minSuccessorEarlyStart = new Date('2100-01-01');\n      if (task.successors.length === 0) {\n        task.freeFloat = task.totalFloat;\n      } else {\n        for (const succId of task.successors) {\n          const succ = taskMap.get(succId);\n          if (succ) {\n            const succEarlyStart = new Date(succ.earlyStart);\n            if (succEarlyStart < minSuccessorEarlyStart) {\n              minSuccessorEarlyStart = succEarlyStart;\n            }\n          }\n        }\n        const earlyFinish = new Date(task.earlyFinish);\n        const freeFloat = Math.round((minSuccessorEarlyStart - earlyFinish) / DAY);\n        task.freeFloat = Math.max(0, freeFloat);\n      }\n\n      // Anlisis de ruta crtica\n      if (task.isCritical) {\n        criticalTasks.push(task.id);\n\n        // Calcular impacto de retrasos en tareas crticas\n        task.criticalImpact = {\n          delayCost: task.cost * 0.1, // 10% del costo por da de retraso\n          resourceImpact: task.resources.length > 0 ? 'Alto' : 'Bajo',\n          successorImpact: task.successors.length\n        };\n      }\n\n      // Calcular slack de seguridad (Safety Float)\n      task.safetyFloat = Math.max(0, task.totalFloat - task.freeFloat);\n\n      // Anlisis de sensibilidad\n      task.sensitivity = calculateTaskSensitivity(task, updatedTasks);\n    }\n\n    // Calcular la duracin de la ruta crtica correctamente\n    if (updatedTasks.length > 0) {\n      const startDates = updatedTasks.map(t => new Date(t.startDate));\n      const endDates = updatedTasks.map(t => new Date(t.endDate));\n\n      const minStart = new Date(Math.min(...startDates));\n      const maxEnd = new Date(Math.max(...endDates));\n\n      // Calcular diferencia en das de manera segura\n      const timeDiff = maxEnd.getTime() - minStart.getTime();\n      criticalPathLength = Math.max(0, Math.round(timeDiff / (1000 * 60 * 60 * 24)));\n\n      console.log(' CPM DEBUG - Ruta Crtica:', {\n        totalTasks: updatedTasks.length,\n        criticalTasks: criticalTasks.length,\n        minStart: minStart && !isNaN(minStart.getTime()) ? minStart.toISOString().split('T')[0] : 'N/A',\n        maxEnd: maxEnd && !isNaN(maxEnd.getTime()) ? maxEnd.toISOString().split('T')[0] : 'N/A',\n        criticalPathLength: criticalPathLength\n      });\n    }\n\n    // Identificar rutas crticas mltiples\n    const criticalPaths = findCriticalPaths(updatedTasks);\n\n    // Calcular mtricas del proyecto\n    const projectMetrics = calculateProjectMetrics(updatedTasks, criticalTasks);\n\n    // DEBUG: Log de fechas de fin de tareas\n    console.log(' DEBUG - Tareas y fechas de fin:', updatedTasks.map(t => ({\n      name: t.name,\n      endDate: t.endDate,\n      endDateObj: t.endDate && t.endDate !== null && t.endDate !== undefined\n        ? new Date(t.endDate).toISOString().split('T')[0]\n        : 'N/A'\n    })));\n\n    return {\n      tasks: updatedTasks,\n      error: null,\n      criticalPath: criticalTasks,\n      criticalPathLength,\n      criticalPaths,\n      projectMetrics\n    };\n  } catch (error) {\n    return { tasks: updatedTasks, error: error.message };\n  }\n};\n","/**\n * @fileoverview Utilidades para anlisis de recursos en cronogramas\n * @module utils/scheduleResourceAnalysis\n */\n\nimport { diffDaysExclusive, addDays } from './scheduleDateUtils';\n\n/**\n * Calcula la utilizacin de recursos\n * @param {Map<string, Array<Object>>} resourceLoad - Mapa de recursos a asignaciones\n * @param {boolean} [includeWeekends=false] - Si true, incluye fines de semana\n * @returns {Object} Utilizacin por recurso\n */\nexport const calculateResourceUtilization = (resourceLoad, includeWeekends = false) => {\n  const utilization = new Map();\n\n  for (const [resource, assignments] of resourceLoad.entries()) {\n    let totalDays = 0;\n    for (const assignment of assignments) {\n      totalDays += diffDaysExclusive(assignment.startDate, addDays(assignment.endDate, 1, includeWeekends), includeWeekends);\n    }\n    utilization.set(resource, totalDays);\n  }\n\n  return Object.fromEntries(utilization);\n};\n\n/**\n * Analiza recursos y detecta conflictos de asignacin\n * @param {Array<Object>} tasks - Array de tareas\n * @param {boolean} [includeWeekends=false] - Si true, incluye fines de semana\n * @returns {{resourceLoad: Object, conflicts: Array<Object>, utilization: Object}} Anlisis de recursos\n */\nexport const analyzeResources = (tasks, includeWeekends = false) => {\n  const resourceLoad = new Map();\n  const resourceConflicts = [];\n\n  for (const task of tasks) {\n    // Validar que la tarea existe y tiene recursos\n    if (!task || !task.resources || !Array.isArray(task.resources)) {\n      continue;\n    }\n\n    for (const resource of task.resources) {\n      if (!resourceLoad.has(resource)) {\n        resourceLoad.set(resource, []);\n      }\n\n      resourceLoad.get(resource).push({\n        taskId: task.id,\n        taskName: task.name,\n        startDate: task.startDate,\n        endDate: task.endDate,\n        allocation: 100\n      });\n    }\n  }\n\n  for (const [resource, assignments] of resourceLoad.entries()) {\n    const sortedAssignments = assignments.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));\n\n    for (let i = 0; i < sortedAssignments.length - 1; i++) {\n      const current = sortedAssignments[i];\n      const next = sortedAssignments[i + 1];\n\n      if (new Date(current.endDate) > new Date(next.startDate)) {\n        resourceConflicts.push({\n          resource,\n          task1: current.taskId,\n          task2: next.taskId,\n          overlapDays: diffDaysExclusive(next.startDate, current.endDate, includeWeekends)\n        });\n      }\n    }\n  }\n\n  return {\n    resourceLoad: Object.fromEntries(resourceLoad),\n    conflicts: resourceConflicts,\n    utilization: calculateResourceUtilization(resourceLoad, includeWeekends)\n  };\n};\n","import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport * as XLSX from 'xlsx';\nimport MinutaModal from './MinutaModal';\nimport EditMinutaModal from './EditMinutaModal';\nimport ScheduleWizard from './ai-scheduler/ScheduleWizard';\nimport supabaseService from '../services/SupabaseService';\nimport subscriptionService from '../services/SubscriptionService';\nimport aiSchedulerService from '../services/AISchedulerService';\nimport useAuditLog from '../hooks/useAuditLog';\nimport useBusinessValueSync from '../hooks/useBusinessValueSync';\n\n// Importar constantes\nimport { DAY, ROW_H, PADDING_TOP } from '../utils/scheduleConstants';\n\n// Importar utilidades de validacin\nimport {\n  sanitizeInput,\n  validateTaskName,\n  validateDuration,\n  validateDate,\n  sortTasksByWbsCode\n} from '../utils/scheduleValidation';\n\n// Importar utilidades de fechas\nimport {\n  toISO,\n  isWorkingDay,\n  adjustToWorkingDay,\n  findFirstWorkingDay,\n  addWorkingDays,\n  addDays,\n  diffDaysExclusive,\n  diffVisibleColumnsExclusive,\n  findColumnIndex,\n  durationVisibleColumnsInclusive,\n  durationDaysInclusive,\n  clamp01,\n  parseExcelDate\n} from '../utils/scheduleDateUtils';\n\n// Importar utilidades de CPM\nimport {\n  calculateCPM,\n  calculateTaskSensitivity,\n  findCriticalPaths,\n  calculateProjectMetrics\n} from '../utils/scheduleCPM';\n\n// Importar utilidades de valor de negocio\nimport {\n  calculateAllTasksBusinessValue,\n  calculateTaskBusinessValue,\n  getPriorityWeight\n} from '../utils/businessValueCalculator';\n\n// Importar utilidades de anlisis de recursos\nimport {\n  analyzeResources,\n  calculateResourceUtilization\n} from '../utils/scheduleResourceAnalysis';\n\n// ===== Componente Principal =====\n\nconst ScheduleManagement = ({ tasks, setTasks, importTasks, projectData, onScheduleDataChange, includeWeekends, setIncludeWeekends, useSupabase = true, updateProjectMinutas }) => {\n\n  // Estados principales - INDEPENDIENTES de Work Packages\n  // NOTA: tasks y setTasks ahora vienen como props del componente padre\n\n  // Funcin de migracin automtica para proyectos existentes\n  const migrateExistingProject = useCallback((projectTasks) => {\n    if (!Array.isArray(projectTasks) || projectTasks.length === 0) {\n      return projectTasks;\n    }\n\n    console.log(' MIGRACIN AUTOMTICA - Iniciando migracin de proyecto existente...');\n    console.log(` Tareas a migrar: ${projectTasks.length}`);\n\n    // Verificar si ya est migrado (tiene wbsCode secuencial)\n    const hasSequentialWbs = projectTasks.every((task, index) =>\n      parseInt(task.wbsCode) === index + 1\n    );\n\n    if (hasSequentialWbs) {\n      console.log(' MIGRACIN AUTOMTICA - Proyecto ya migrado, no se requiere migracin');\n      return projectTasks;\n    }\n\n    // CORRECCIN: Crear mapeo de ID a nuevo wbsCode para referencias correctas\n    const idToNewWbsMapping = new Map();\n    projectTasks.forEach((task, index) => {\n      const newWbsCode = `${index + 1}`;\n      idToNewWbsMapping.set(task.id, newWbsCode);\n    });\n\n    console.log(' MIGRACIN AUTOMTICA - Mapeo de ID a wbsCode:', Array.from(idToNewWbsMapping.entries()));\n\n    // Migrar cada tarea\n    const migratedTasks = projectTasks.map((task, index) => {\n      const newWbsCode = `${index + 1}`;\n\n      // Convertir predecesoras manteniendo las referencias por ID\n      let migratedPredecessors = [];\n      if (task.predecessors && task.predecessors.length > 0) {\n        migratedPredecessors = task.predecessors.map(predId => {\n          // Verificar si la predecesora existe en el proyecto\n          const predTask = projectTasks.find(t => t.id === predId);\n          if (predTask) {\n            console.log(` Predecesora vlida encontrada: ${predTask.name} (ID: ${predId})`);\n            return predId; // Mantener el ID original\n          } else {\n            console.warn(` Predecesora no encontrada: ID ${predId}`);\n            return null;\n          }\n        }).filter(Boolean);\n      }\n\n      const migratedTask = {\n        ...task,\n        wbsCode: newWbsCode,\n        predecessors: migratedPredecessors\n      };\n\n      if (migratedPredecessors.length > 0) {\n        console.log(` Tarea \"${task.name}\": wbsCode ${task.wbsCode}  ${newWbsCode}, predecesoras: [${migratedPredecessors.join(', ')}]`);\n      }\n\n      return migratedTask;\n    });\n\n    console.log(' MIGRACIN AUTOMTICA - Migracin completada exitosamente');\n    return migratedTasks;\n  }, []);\n\n  //  CORRECCIN MEJORADA: Normalizar wbsCode Y corregir hitos al cargar\n  useEffect(() => {\n    console.log(' useEffect EJECUTNDOSE - TAREAS:', tasks?.length || 0);\n\n    if (tasks && tasks.length > 0) {\n      let needsUpdate = false;\n      let updatedTasks = [...tasks];\n\n      //  PASO 1: Normalizar wbsCode para mantener orden de carga\n      const needsNormalization = tasks.some((task, index) => {\n        const expectedWbs = index + 1;\n        const actualWbs = parseInt(task.wbsCode);\n        return actualWbs !== expectedWbs;\n      });\n\n      if (needsNormalization) {\n        console.log(' NORMALIZANDO wbsCode al orden de carga...');\n        console.log(' Orden ANTES de normalizar:', tasks.map((t, i) => ({\n          pos: i + 1,\n          name: t.name,\n          wbsCode: t.wbsCode\n        })));\n\n        updatedTasks = updatedTasks.map((task, index) => ({\n          ...task,\n          wbsCode: index + 1\n        }));\n\n        console.log(' wbsCode normalizado:', updatedTasks.map((t, i) => ({\n          pos: i + 1,\n          name: t.name,\n          wbsCode: t.wbsCode\n        })));\n\n        needsUpdate = true;\n      }\n\n      //  PASO 2: Verificar si hay hitos con fechas incorrectas\n      const milestonesWithWrongDates = updatedTasks.filter(task =>\n        task.isMilestone && task.startDate !== task.endDate\n      );\n\n      if (milestonesWithWrongDates.length > 0) {\n        console.log(' HITOS CON FECHAS INCORRECTAS DETECTADOS:', milestonesWithWrongDates.length);\n        console.log(' EJECUTANDO CORRECCIN AUTOMTICA DE HITOS');\n\n        updatedTasks = updatedTasks.map(task => {\n          if (!task.isMilestone) return task;\n\n          // Verificar si la fecha de fin es diferente a la de inicio\n          if (task.startDate !== task.endDate) {\n            console.log(' CORRIGIENDO HITO AUTOMTICAMENTE:', {\n              taskId: task.id,\n              taskName: task.name,\n              startDateOriginal: task.startDate,\n              endDateOriginal: task.endDate,\n              endDateCorregida: task.startDate\n            });\n\n            return {\n              ...task,\n              endDate: task.startDate, // Corregir: fin = inicio\n              updatedAt: new Date().toISOString()\n            };\n          }\n\n          return task;\n        });\n\n        needsUpdate = true;\n      }\n\n      //  PASO 3: Aplicar actualizaciones si es necesario\n      if (needsUpdate) {\n        console.log(' Aplicando correcciones automticas...');\n        setTasks(updatedTasks);\n      }\n    }\n  }, [tasks.length]); // Solo ejecutar cuando cambie el nmero de tareas\n\n  // ELIMINADO: Sincronizacin con Work Packages - ya no es necesaria\n\n  // Enviar datos del cronograma a FinancialManagement\n  useEffect(() => {\n    if (onScheduleDataChange && tasks.length > 0) {\n      const scheduleData = {\n        tasks: tasks,\n        projectStart: projectData?.startDate,\n        projectEnd: projectData?.endDate,\n        totalTasks: tasks.length,\n        completedTasks: tasks.filter(t => t.status === 'completed').length,\n        inProgressTasks: tasks.filter(t => t.status === 'in-progress').length,\n        delayedTasks: tasks.filter(t => t.status === 'delayed').length,\n        totalProgress: tasks.reduce((sum, t) => sum + (t.progress || 0), 0) / tasks.length\n      };\n\n      onScheduleDataChange(scheduleData);\n      console.log(' Datos del cronograma enviados a FinancialManagement');\n    }\n  }, [tasks, onScheduleDataChange, projectData]);\n\n  // Funcin para manejar actualizaciones directas del WBS\n  const handleWBSUpdate = (action, data) => {\n    console.log(` Recibida actualizacin del WBS: ${action}`, data);\n\n    switch (action) {\n      case 'create':\n        // Crear nueva tarea en cronograma\n        // Calcular businessValue automticamente\n        const taskBusinessValue = calculateTaskBusinessValue(\n          data.cost || 0,\n          data.priority || 'medium',\n          projectData?.plannedValue || 0,\n          tasks\n        );\n\n        const newTask = {\n          id: data.id,\n          wbsCode: data.wbs || `WP-${data.id}`,\n          name: data.name,\n          duration: Math.max(1, durationDaysInclusive(data.startDate, data.endDate, includeWeekends)),\n          startDate: data.startDate,\n          endDate: data.endDate,\n          progress: data.progress || 0,\n          predecessors: [],\n          successors: [],\n          resources: [],\n          cost: data.cost || 0,\n          priority: data.priority || 'medium',\n          businessValue: taskBusinessValue,\n          isMilestone: false,\n          isCritical: false,\n          originalDuration: data.duration || 1, // Guardar duracin original\n          earlyStart: data.startDate,\n          earlyFinish: data.endDate,\n          lateStart: data.startDate,\n          lateFinish: data.endDate,\n          totalFloat: 0,\n          freeFloat: 0,\n          status: data.status || 'pending',\n          workPackageId: data.workPackageId || data.id,\n          plannedValue: data.cost || 0,\n          earnedValue: 0,\n          actualCost: 0\n        };\n\n        setTasks(prev => {\n          const newTasks = prev.slice();\n          newTasks.push(newTask);\n          return newTasks;\n        });\n        console.log(' Nueva tarea creada desde WBS');\n        break;\n\n      case 'delete':\n        // Eliminar tarea del cronograma\n        setTasks(prev => prev.filter(t => t.id !== data.id));\n        console.log(' Tarea eliminada desde WBS');\n        break;\n\n      default:\n        // Actualizar tarea existente\n        setTasks(prev => {\n          console.log(' SETTASKS #1 - ACTUALIZANDO TAREA:', action, data);\n          return prev.map(task => {\n            if (task.id === action) {\n              const updatedTask = {\n                id: task.id,\n                wbsCode: task.wbsCode,\n                name: task.name,\n                duration: data.startDate && data.endDate ?\n                  Math.max(1, durationDaysInclusive(data.startDate, data.endDate, includeWeekends)) : task.duration,\n                startDate: data.startDate || task.startDate,\n                endDate: data.endDate || task.endDate,\n                progress: data.progress !== undefined ? data.progress : task.progress,\n                predecessors: [...(task.predecessors || [])],\n                cost: data.cost !== undefined ? data.cost : task.cost,\n                priority: task.priority,\n                businessValue: task.businessValue || 0,\n                assignedTo: task.assignedTo,\n                isMilestone: task.isMilestone,\n                isCritical: task.isCritical,\n                originalDuration: task.originalDuration,\n                earlyStart: task.earlyStart,\n                earlyFinish: task.earlyFinish,\n                lateStart: task.lateStart,\n                lateFinish: task.lateFinish,\n                totalFloat: task.totalFloat,\n                freeFloat: task.freeFloat,\n                description: task.description,\n                resources: [...(task.resources || [])],\n                workPackageId: task.workPackageId,\n                status: data.status || task.status,\n                successors: [...(task.successors || [])]\n              };\n              return updatedTask;\n            }\n            return task;\n          });\n        });\n        console.log(' Tarea actualizada desde WBS');\n    }\n  };\n\n  // Usar datos del proyecto principal en lugar de caso de negocio separado\n  const businessCase = {\n    projectName: projectData.projectName,\n    startDate: projectData.startDate,\n    plannedEndDate: projectData.endDate,\n    totalInvestment: projectData.totalBudget\n  };\n\n  // Estados de UI\n  const [selectedTask, setSelectedTask] = useState(null);\n  const [tempTaskName, setTempTaskName] = useState('');\n  const [viewMode, setViewMode] = useState('excel');\n  // includeWeekends y setIncludeWeekends ahora vienen como props desde el estado global\n\n  // NUEVOS ESTADOS PARA VISTA TABLA\n  const [editingCell, setEditingCell] = useState(null); // {taskId, field}\n  const [editingValue, setEditingValue] = useState('');\n  const [selectedRow, setSelectedRow] = useState(null);\n\n  // Estados locales para los selects de dependencias\n  const [selectedPredecessor, setSelectedPredecessor] = useState('');\n  const [selectedSuccessor, setSelectedSuccessor] = useState('');\n\n  // Refs para los selects\n  const predecessorSelectRef = useRef(null);\n  const successorSelectRef = useRef(null);\n  const [ganttScale, setGanttScale] = useState('days');\n  const [showCriticalPath, setShowCriticalPath] = useState(true);\n\n  const [showDependencies, setShowDependencies] = useState(true);\n  const [baselineTasks, setBaselineTasks] = useState([]);\n  const [showBaseline, setShowBaseline] = useState(false);\n  const [showBusinessCase, setShowBusinessCase] = useState(false);\n  const [showResourceAnalysis, setShowResourceAnalysis] = useState(false);\n  const [cmpError, setCmpError] = useState(null);\n\n  // Estado para el modal de minutas\n  const [isMinutaModalOpen, setIsMinutaModalOpen] = useState(false);\n  const [minutasTasks, setMinutasTasks] = useState([]);\n  const [loadingMinutas, setLoadingMinutas] = useState(false);\n\n  // Estados para edicin de minutas\n  const [editingMinuta, setEditingMinuta] = useState(null);\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\n\n  // Estados para el Asistente Inteligente de Cronogramas\n  const [showAIWizard, setShowAIWizard] = useState(false);\n\n  // Estado para modo read-only (cuando se exceden lmites del plan)\n  const [isReadOnlyMode, setIsReadOnlyMode] = useState(false);\n\n  // Hook de auditora para minutas\n  const { logMinutaTaskCreated, logMinutaTaskUpdated, addAuditEvent } = useAuditLog(\n    projectData?.id,\n    useSupabase\n  );\n\n  // Verificar modo read-only al cargar (cuando se exceden lmites del plan)\n  useEffect(() => {\n    const checkReadOnlyMode = async () => {\n      if (useSupabase && projectData?.organizationId) {\n        try {\n          const editPermission = await subscriptionService.canEdit(projectData.organizationId);\n          setIsReadOnlyMode(!editPermission.allowed);\n          if (!editPermission.allowed) {\n            console.warn('[READ-ONLY MODE] Edicin deshabilitada:', editPermission.message);\n          }\n        } catch (error) {\n          console.error('[READ-ONLY MODE] Error verificando permisos:', error);\n          setIsReadOnlyMode(false); // En caso de error, permitir edicin (fail-safe)\n        }\n      }\n    };\n    checkReadOnlyMode();\n  }, [useSupabase, projectData?.organizationId]);\n\n  // Estados del diagrama de red (preservados para evitar errores)\n  const [networkLayout, setNetworkLayout] = useState('hierarchical');\n  const [networkOrientation, setNetworkOrientation] = useState('TB');\n  const [showNetworkDependencies, setShowNetworkDependencies] = useState(false);\n  const [showNetworkCriticalPath, setShowNetworkCriticalPath] = useState(true);\n  const [showOnlyCriticalPath, setShowOnlyCriticalPath] = useState(false);\n  const [showSimplifiedView, setShowSimplifiedView] = useState(false);\n  const [autoFitNetwork, setAutoFitNetwork] = useState(true);\n\n  // Funciones de zoom y pan para el diagrama de red\n  const [networkZoom, setNetworkZoom] = useState(1);\n  const [networkPan, setNetworkPan] = useState({ x: 0, y: 0 });\n\n  // Funciones de arrastrar y soltar para nodos\n  const [draggedNode, setDraggedNode] = useState(null);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n\n  // Estados para arrastrar el diagrama (pan)\n  const [isPanning, setIsPanning] = useState(false);\n  const [panStart, setPanStart] = useState({ x: 0, y: 0 });\n  const [lastPan, setLastPan] = useState({ x: 0, y: 0 });\n\n  // Refs\n  const leftRef = useRef(null);\n  const rightRef = useRef(null);\n  const fileInputRef = useRef(null);\n  const networkSvgRef = useRef(null);\n\n  // Estados calculados\n  const baselineById = useMemo(() => new Map(baselineTasks.map((t) => [t.id, t])), [baselineTasks]);\n\n  // Recalcular CPM cuando cambian las tareas\n  const cmpResult = useMemo(() => {\n    console.log(' Recalculando CPM con tareas:', tasks.map(t => ({\n      id: t.id,\n      name: t.name,\n      predecessors: t.predecessors,\n      successors: t.successors,\n      endDate: t.endDate\n    })));\n\n    // Calcular CPM normalmente\n    console.log(' DEBUG - Tareas ANTES de calculateCPM:', tasks.map(t => ({\n      id: t.id,\n      name: t.name,\n      predecessors: t.predecessors,\n      successors: t.successors,\n      endDate: t.endDate\n    })));\n\n    const cpmResult = calculateCPM(tasks, includeWeekends);\n\n    console.log(' DEBUG - Tareas DESPUS de calculateCPM:', cpmResult.tasks.map(t => ({\n      id: t.id,\n      name: t.name,\n      predecessors: t.predecessors,\n      successors: t.successors,\n      endDate: t.endDate\n    })));\n\n    console.log(' DEBUG - Resultado CPM:', {\n      criticalPath: cpmResult.criticalPath,\n      criticalPathLength: cpmResult.criticalPathLength,\n      totalTasks: cpmResult.tasks.length\n    });\n\n    // CORRECCIN: Aplicar fechas calculadas por CPM como MS Project\n    console.log(' CORRECCIN SCHEDULE - Aplicando fechas calculadas por CPM como MS Project');\n\n    // CORRECCIN: Preservar el orden original de las tareas basado en wbsCode\n    const tasksWithForcedDeps = tasks.map((originalTask) => {\n      // Buscar la tarea procesada por CPM que corresponde a la tarea original\n      const cpmTask = cpmResult.tasks.find(t => t.id === originalTask.id);\n\n      if (!cpmTask) {\n        console.warn(` Tarea no encontrada en resultado CPM: ${originalTask.name} (${originalTask.id})`);\n        return originalTask; // Devolver tarea original si no se encuentra en CPM\n      }\n\n      // Aplicar las fechas calculadas por CPM a la tabla (como MS Project)\n      return {\n        id: cpmTask.id,\n        wbsCode: cpmTask.wbsCode,\n        name: cpmTask.name,\n        duration: cpmTask.duration,\n        startDate: cpmTask.earlyStart, // Usar fecha calculada por CPM\n        endDate: cpmTask.earlyFinish,  // Usar fecha calculada por CPM\n        progress: cpmTask.progress,\n        predecessors: cpmTask.predecessors || [],\n        cost: cpmTask.cost,\n        priority: cpmTask.priority,\n        assignedTo: cpmTask.assignedTo,\n        isMilestone: cpmTask.isMilestone,\n        isCritical: cpmTask.isCritical,\n        originalDuration: cpmTask.originalDuration,\n        earlyStart: cpmTask.earlyStart,\n        earlyFinish: cpmTask.earlyFinish,\n        lateStart: cpmTask.lateStart,\n        lateFinish: cpmTask.lateFinish,\n        totalFloat: cpmTask.totalFloat,\n        freeFloat: cpmTask.freeFloat,\n        description: cpmTask.description,\n        resources: [...(cpmTask.resources || [])],\n        workPackageId: cpmTask.workPackageId,\n        status: cpmTask.status,\n        successors: cpmTask.successors || []\n      };\n    });\n\n    console.log(' Tareas con dependencias FORZADAS despus de CPM:', tasksWithForcedDeps.map(t => ({\n      id: t.id,\n      name: t.name,\n      predecessors: t.predecessors,\n      successors: t.successors,\n      endDate: t.endDate\n    })));\n\n    return {\n      criticalPath: cpmResult.criticalPath,\n      criticalPathLength: cpmResult.criticalPathLength,\n      tasks: tasksWithForcedDeps\n    };\n  }, [tasks, includeWeekends, tasks.length]);\n\n  // CORRECCIN FINAL: Asegurar que todos los hitos tengan fecha inicio = fecha fin\n  // Y APLICAR FECHAS CALCULADAS POR CPM COMO MS PROJECT\n  //  NUEVO: Calcular automticamente businessValue para tareas con valor = 0\n  const tasksWithCPMOriginal = useMemo(() => {\n    return cmpResult.tasks.map(task => {\n      // CORRECCIN: Aplicar fechas calculadas por CPM como MS Project\n      const taskWithCPMDates = {\n        ...task,\n        startDate: task.earlyStart, // Usar fecha calculada por CPM\n        endDate: task.earlyFinish   // Usar fecha calculada por CPM\n      };\n\n      if (task.isMilestone) {\n        // DEBUG: Ver qu fechas tiene el hito\n        console.log(' HITO DETECTADO:', {\n          id: task.id,\n          name: task.name,\n          startDate: task.startDate,\n          endDate: task.endDate,\n          isMilestone: task.isMilestone\n        });\n\n        if (taskWithCPMDates.startDate !== taskWithCPMDates.endDate) {\n          console.log(' CORRIGIENDO HITO - FORZANDO endDate = startDate');\n          return {\n            ...taskWithCPMDates,\n            endDate: taskWithCPMDates.startDate // FORZAR: fecha fin = fecha inicio para hitos\n          };\n        }\n      }\n\n      return taskWithCPMDates;\n    });\n  }, [cmpResult.tasks]);\n\n  //  NUEVO: Hook para clculo automtico y sincronizacin inteligente de businessValue\n  const {\n    tasksWithValue: tasksWithBusinessValue,\n    isSyncing: isBusinessValueSyncing,\n    lastSync: businessValueLastSync,\n    error: businessValueError,\n    recalculate: recalculateBusinessValue\n  } = useBusinessValueSync(tasksWithCPMOriginal, projectData, supabaseService, useSupabase);\n\n  // Usar las tareas con businessValue calculado\n  const tasksWithCPM = tasksWithBusinessValue;\n\n  // CORRECCIN: Actualizar automticamente las tareas con fechas calculadas por CPM\n  useEffect(() => {\n    if (tasksWithCPM.length > 0 && setTasks) {\n      // Verificar si las fechas calculadas por CPM son diferentes a las fechas actuales\n      const needsUpdate = tasksWithCPM.some(task => {\n        const currentTask = tasks.find(t => t.id === task.id);\n        if (!currentTask) return false;\n\n        return currentTask.startDate !== task.startDate ||\n          currentTask.endDate !== task.endDate;\n      });\n\n      if (needsUpdate) {\n        console.log(' Actualizando tareas con fechas calculadas por CPM...');\n        setTasks(tasksWithCPM);\n      }\n    }\n  }, [tasksWithCPM, tasks, setTasks]);\n\n  // ===== Funciones de Control de Costos EVM =====\n\n  // Solo mantenemos las funciones bsicas necesarias para la compresin del cronograma\n  const calculateActualCost = () => {\n    return tasksWithCPM.reduce((total, task) => {\n      return total + (task.actualCost || 0);\n    }, 0);\n  };\n\n  const calculateEarnedValue = () => {\n    return tasksWithCPM.reduce((total, task) => {\n      return total + (task.cost * (task.progress / 100));\n    }, 0);\n  };\n\n  // Funcin para comprimir el cronograma (Crashing)\n  const compressSchedule = () => {\n    const criticalTasks = tasksWithCPM.filter(t => t.isCritical);\n\n    if (criticalTasks.length === 0) {\n      alert('No hay tareas crticas para comprimir');\n      return;\n    }\n\n    // Identificar tareas crticas con mayor potencial de compresin\n    const compressionCandidates = criticalTasks\n      .map(task => ({\n        id: task.id,\n        wbsCode: task.wbsCode,\n        name: task.name,\n        duration: task.duration,\n        startDate: task.startDate,\n        endDate: task.endDate,\n        progress: task.progress,\n        predecessors: [...(task.predecessors || [])],\n        cost: task.cost,\n        priority: task.priority,\n        assignedTo: task.assignedTo,\n        isMilestone: task.isMilestone,\n        isCritical: task.isCritical,\n        originalDuration: task.originalDuration,\n        earlyStart: task.earlyStart,\n        earlyFinish: task.earlyFinish,\n        lateStart: task.lateStart,\n        lateFinish: task.lateFinish,\n        totalFloat: task.totalFloat,\n        freeFloat: task.freeFloat,\n        description: task.description,\n        resources: [...(task.resources || [])],\n        workPackageId: task.workPackageId,\n        status: task.status,\n        successors: [...(task.successors || [])],\n        compressionPotential: Math.min(task.duration * 0.3, 5), // Mximo 30% o 5 das\n        compressionCost: task.cost * 0.2 // 20% del costo por da comprimido\n      }))\n      .sort((a, b) => b.compressionPotential - a.compressionPotential);\n\n    // Mostrar opciones de compresin\n    const compressionOptions = compressionCandidates\n      .slice(0, 3) // Top 3 opciones\n      .map(task => `${task.name}: -${task.compressionPotential} das ($${task.compressionCost.toFixed(2)}/da)`)\n      .join('\\n');\n\n    const daysToCompress = prompt(\n      `Cuntos das quieres comprimir del cronograma?\\n\\nOpciones de compresin:\\n${compressionOptions}\\n\\nIngresa el nmero de das:`,\n      '1'\n    );\n\n    if (daysToCompress && !isNaN(daysToCompress)) {\n      const targetCompression = parseInt(daysToCompress);\n      let totalCompression = 0;\n      let totalCost = 0;\n\n      // Aplicar compresin\n      const updatedTasks = tasksWithCPM.map(task => {\n        if (task.isCritical && totalCompression < targetCompression) {\n          const compression = Math.min(\n            task.compressionPotential,\n            targetCompression - totalCompression\n          );\n\n          if (compression > 0) {\n            totalCompression += compression;\n            totalCost += compression * task.compressionCost;\n\n            return {\n              id: task.id,\n              wbsCode: task.wbsCode,\n              name: task.name,\n              duration: Math.max(1, task.duration - compression),\n              startDate: task.startDate,\n              endDate: task.endDate,\n              progress: task.progress,\n              predecessors: [...(task.predecessors || [])],\n              cost: task.cost,\n              priority: task.priority,\n              assignedTo: task.assignedTo,\n              isMilestone: task.isMilestone,\n              isCritical: task.isCritical,\n              originalDuration: task.originalDuration,\n              earlyStart: task.earlyStart,\n              earlyFinish: task.earlyFinish,\n              lateStart: task.lateStart,\n              lateFinish: task.lateFinish,\n              totalFloat: task.totalFloat,\n              freeFloat: task.freeFloat,\n              description: task.description,\n              resources: [...(task.resources || [])],\n              workPackageId: task.workPackageId,\n              status: task.status,\n              successors: [...(task.successors || [])],\n              compressedDays: (task.compressedDays || 0) + compression,\n              compressionCost: (task.compressionCost || 0) + (compression * task.compressionCost)\n            };\n          }\n        }\n        return task;\n      });\n\n      if (totalCompression > 0) {\n        setTasks(updatedTasks);\n        alert(` Cronograma comprimido ${totalCompression} das\\n Costo adicional: $${totalCost.toFixed(2)}`);\n      } else {\n        alert('No se pudo comprimir el cronograma con los parmetros especificados');\n      }\n    }\n  };\n\n  // Actualizar error de CPM\n  useEffect(() => {\n    setCmpError(cmpResult.error);\n  }, [cmpResult.error]);\n\n  // Monitoreo de dependencias circulares - SOLO DETECTAR, NO LIMPIAR AUTOMTICAMENTE\n  useEffect(() => {\n    if (tasks && tasks.length > 0) {\n      // Solo monitorear y reportar, NO limpiar automticamente\n      const visited = new Set();\n      const recursionStack = new Set();\n      const circularTasks = [];\n\n      const dfs = (currentId, path = []) => {\n        if (recursionStack.has(currentId)) {\n          // Dependencia circular REAL detectada\n          const cycleStart = path.indexOf(currentId);\n          const cycle = path.slice(cycleStart).concat([currentId]);\n          circularTasks.push({\n            taskId: currentId,\n            cycle: cycle\n          });\n          return true;\n        }\n        if (visited.has(currentId)) {\n          return false;\n        }\n\n        recursionStack.add(currentId);\n        visited.add(currentId);\n\n        const task = tasks.find(t => t.id === currentId);\n        if (task) {\n          for (const predId of task.predecessors) {\n            if (dfs(predId, [...path, currentId])) {\n              return true;\n            }\n          }\n        }\n\n        recursionStack.delete(currentId);\n        return false;\n      };\n\n      // Detectar dependencias circulares\n      tasks.forEach(task => {\n        if (!visited.has(task.id)) {\n          dfs(task.id);\n        }\n      });\n\n      if (circularTasks.length > 0) {\n        console.warn(` DEPENDENCIAS CIRCULARES REALES detectadas: ${circularTasks.length}`);\n        circularTasks.forEach(circular => {\n          console.warn(`   Tarea ${circular.taskId}: Ciclo ${circular.cycle.join('  ')}`);\n        });\n        console.warn(' Usa el botn \"Limpiar Dependencias Circulares\" para corregir manualmente');\n      } else {\n        console.log(' Sin dependencias circulares detectadas');\n      }\n    }\n  }, [tasks]);\n\n  // Anlisis de recursos\n  const resourceAnalysis = useMemo(() => analyzeResources(tasksWithCPM, includeWeekends), [tasksWithCPM, includeWeekends]);\n\n  // Recalcular tareas cuando cambie la configuracin de das laborables\n  const prevIncludeWeekends = useRef(includeWeekends);\n\n  // Listener para eventos de actualizacin de tareas\n  useEffect(() => {\n    const handleTasksUpdated = (event) => {\n      console.log(' EVENTO tasksUpdated recibido:', event.detail);\n      // Forzar re-renderizado del componente\n      setTasks(prevTasks => [...prevTasks]);\n    };\n\n    window.addEventListener('tasksUpdated', handleTasksUpdated);\n\n    return () => {\n      window.removeEventListener('tasksUpdated', handleTasksUpdated);\n    };\n  }, []);\n\n  useEffect(() => {\n    console.log(' CHECKBOX CAMBI:', includeWeekends);\n\n    // Solo ejecutar si realmente cambi includeWeekends Y hay tareas\n    if (prevIncludeWeekends.current !== includeWeekends && tasks && tasks.length > 0) {\n      console.log(' RECALCULANDO FECHAS...');\n      prevIncludeWeekends.current = includeWeekends;\n\n      const updatedTasks = tasks.map((task, index) => {\n        // Para hitos: no recalcular fechas, mantener fin = inicio\n        if (task.isMilestone) {\n          return { ...task, endDate: task.startDate };\n        }\n\n        if (task.startDate && task.duration) {\n          const newEndDate = addDays(task.startDate, task.duration, includeWeekends);\n          return { ...task, endDate: newEndDate };\n        }\n        return task;\n      });\n\n      // Solo actualizar si hay cambios\n      const hasChanges = updatedTasks.some((task, index) =>\n        task.endDate !== tasks[index].endDate\n      );\n\n      console.log(' hasChanges:', hasChanges);\n\n      if (hasChanges) {\n        console.log(' ACTUALIZANDO TABLA...');\n        setTasks(updatedTasks);\n      } else {\n        console.log(' NO HAY CAMBIOS - las fechas son iguales');\n      }\n    }\n  }, [includeWeekends]);\n\n  // Las fechas del proyecto se recalculan automticamente a travs del useMemo projectDates\n  // cuando cambian las tareas, por lo que no necesitamos un useEffect separado\n\n  // ELIMINADO: Segundo useEffect de Work Packages - ya no es necesario\n\n  // Sincronizar panel de detalles\n  // useEffect que estaba sobrescribiendo selectedTask\n  // useEffect(() => {\n  //   if (!selectedTask) return;\n  //   const fresh = tasksWithCPM.find((t) => t.id === selectedTask.id);\n  //   if (fresh && fresh !== selectedTask) setSelectedTask(fresh);\n  // }, [tasksWithCPM, selectedTask]);\n\n\n  // Generar nodos del diagrama de red\n  const generateNetworkNodes = useMemo(() => {\n    if (tasksWithCPM.length === 0) return [];\n\n    // Aplicar filtros\n    let filteredTasks = tasksWithCPM;\n\n    // Filtro de solo ruta crtica\n    if (showOnlyCriticalPath) {\n      filteredTasks = filteredTasks.filter(task => task.isCritical);\n    }\n\n    // Aplicar dimensiones segn vista simplificada\n    const nodeWidth = showSimplifiedView ? 100 : 140;\n    const nodeHeight = showSimplifiedView ? 60 : 80;\n    const horizontalSpacing = showSimplifiedView ? 150 : 200;\n    const verticalSpacing = showSimplifiedView ? 100 : 120;\n\n    const nodes = [];\n\n    // Crear un layout jerrquico basado en dependencias\n    const levels = new Map();\n    const processed = new Set();\n\n    // Funcin para calcular el nivel de una tarea (con proteccin contra dependencias circulares)\n    const calculateLevel = (taskId, visiting = new Set()) => {\n      if (processed.has(taskId)) return levels.get(taskId) || 0;\n\n      // Detectar dependencia circular\n      if (visiting.has(taskId)) {\n        console.warn('Dependencia circular detectada en tarea:', taskId);\n        levels.set(taskId, 0);\n        processed.add(taskId);\n        return 0;\n      }\n\n      const task = filteredTasks.find(t => t.id === taskId);\n      if (!task) return 0;\n\n      if (task.predecessors.length === 0) {\n        levels.set(taskId, 0);\n        processed.add(taskId);\n        return 0;\n      }\n\n      // Marcar como visitando\n      visiting.add(taskId);\n\n      try {\n        const maxPredLevel = task.predecessors && task.predecessors.length > 0\n          ? Math.max(...task.predecessors.map(predId => calculateLevel(predId, visiting)))\n          : 0;\n        const level = maxPredLevel + 1;\n        levels.set(taskId, level);\n        processed.add(taskId);\n        return level;\n      } finally {\n        // Limpiar el estado de visitando\n        visiting.delete(taskId);\n      }\n    };\n\n    // Calcular niveles para todas las tareas\n    filteredTasks.forEach(task => calculateLevel(task.id));\n\n    // Agrupar tareas por nivel\n    const tasksByLevel = new Map();\n    filteredTasks.forEach(task => {\n      const level = levels.get(task.id);\n      if (!tasksByLevel.has(level)) {\n        tasksByLevel.set(level, []);\n      }\n      tasksByLevel.get(level).push(task);\n    });\n\n    // Posicionar nodos por niveles\n    const maxLevel = Math.max(...Array.from(tasksByLevel.keys()));\n    const startX = 100;\n    const startY = 100;\n\n    tasksByLevel.forEach((tasks, level) => {\n      const levelWidth = (tasks.length - 1) * horizontalSpacing;\n      const levelStartX = startX + (maxLevel - level) * 50; // Desplazamiento diagonal\n\n      tasks.forEach((task, index) => {\n        const x = levelStartX + (levelWidth / 2) - (levelWidth / 2) + (index * horizontalSpacing);\n        const y = startY + level * verticalSpacing;\n\n        nodes.push({\n          id: task.id,\n          x: x,\n          y: y,\n          width: nodeWidth,\n          height: nodeHeight,\n          level: level,\n          task: task\n        });\n      });\n    });\n\n    console.log(' NODOS GENERADOS MEJORADOS:', nodes.map(n => ({\n      id: n.id,\n      x: n.x,\n      y: n.y,\n      level: n.level,\n      center: `${n.x + n.width / 2},${n.y + n.height / 2}`\n    })));\n\n    return nodes;\n  }, [tasksWithCPM, showOnlyCriticalPath, showSimplifiedView]);\n\n  const networkNodes = generateNetworkNodes;\n\n  // Funcin para centrar el diagrama de red\n  const centerNetwork = () => {\n    // Verificar que networkNodes est disponible\n    if (!networkNodes || !Array.isArray(networkNodes)) {\n      console.log(' networkNodes no disponible an, usando fallback');\n      setNetworkPan({ x: 0, y: 0 });\n      setNetworkZoom(1);\n      return;\n    }\n\n    console.log(' centerNetwork llamado:', {\n      hasSvgRef: !!networkSvgRef.current,\n      nodesLength: networkNodes.length,\n      nodes: networkNodes.slice(0, 3).map(n => ({ id: n.id, x: n.x, y: n.y }))\n    });\n\n    if (networkSvgRef.current && networkNodes.length > 0) {\n      // Calcular el bounding box de todos los nodos\n      let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n\n      networkNodes.forEach(node => {\n        minX = Math.min(minX, node.x);\n        minY = Math.min(minY, node.y);\n        maxX = Math.max(maxX, node.x + node.width);\n        maxY = Math.max(maxY, node.y + node.height);\n      });\n\n      console.log(' Bounding box calculado:', { minX, minY, maxX, maxY });\n\n      // Agregar margen\n      const margin = 100;\n      const contentWidth = maxX - minX + (2 * margin);\n      const contentHeight = maxY - minY + (2 * margin);\n\n      // Centrar el contenido\n      const centerX = minX - margin;\n      const centerY = minY - margin;\n\n      console.log(' Centrando en:', { centerX, centerY, contentWidth, contentHeight });\n\n      setNetworkPan({ x: centerX, y: centerY });\n      setNetworkZoom(1);\n    } else {\n      console.log(' Fallback: no hay nodos o SVG ref');\n      // Fallback si no hay nodos\n      setNetworkPan({ x: 0, y: 0 });\n      setNetworkZoom(1);\n    }\n  };\n\n  // Centrar automticamente el diagrama de red cuando se cargue\n  useEffect(() => {\n    if (viewMode === 'network' && networkSvgRef.current) {\n      setTimeout(() => {\n        centerNetwork();\n      }, 100);\n    }\n  }, [viewMode]);\n\n  // Centrar automticamente cuando se generen los nodos\n  useEffect(() => {\n    if (viewMode === 'network' && networkNodes.length > 0) {\n      setTimeout(() => {\n        centerNetwork();\n      }, 100);\n    }\n  }, [networkNodes, viewMode]);\n\n  // Auto-ajustar cuando cambien los filtros\n  useEffect(() => {\n    if (viewMode === 'network') {\n      setTimeout(() => {\n        if (autoFitNetwork) {\n          autoFitNetworkDiagram();\n        } else {\n          centerNetwork();\n        }\n      }, 200);\n    }\n  }, [showOnlyCriticalPath, showSimplifiedView, viewMode, autoFitNetwork, networkNodes]);\n\n  // Actualizar viewBox cuando cambie el zoom\n  useEffect(() => {\n    if (viewMode === 'network' && networkSvgRef.current) {\n      const svg = networkSvgRef.current;\n      svg.setAttribute('viewBox', `${networkPan.x} ${networkPan.y} ${1200 / networkZoom} ${600 / networkZoom}`);\n    }\n  }, [networkZoom, networkPan, viewMode]);\n\n  // Cargar minutas desde Supabase o portfolioData cuando se carga el proyecto\n  useEffect(() => {\n    const loadMinutas = async () => {\n      if (!projectData?.id) return;\n\n      setLoadingMinutas(true);\n      try {\n        if (useSupabase) {\n          // Cargar desde Supabase si est habilitado\n          console.log(' DEBUG: Cargando minutas para proyecto:', projectData.id);\n          const { success, minutas } = await supabaseService.loadMinutasByProject(projectData.id);\n          if (success) {\n            console.log(` DEBUG: Minutas recibidas de Supabase:`, minutas);\n            setMinutasTasks(minutas);\n\n            // Actualizar el estado global minutasByProject\n            if (updateProjectMinutas) {\n              updateProjectMinutas(projectData.id, minutas);\n            }\n\n            console.log(` Minutas cargadas desde Supabase: ${minutas.length}`);\n          } else {\n            console.warn(' Error cargando minutas desde Supabase');\n          }\n        } else {\n          // Cargar desde portfolioData si est en modo local\n          const portfolioData = JSON.parse(localStorage.getItem('portfolioData') || '{}');\n          const minutasFromStorage = portfolioData.minutasByProject?.[projectData.id] || [];\n          setMinutasTasks(minutasFromStorage);\n          console.log(` Minutas cargadas desde localStorage: ${minutasFromStorage.length}`);\n        }\n      } catch (error) {\n        console.error(' Error cargando minutas:', error);\n      } finally {\n        setLoadingMinutas(false);\n      }\n    };\n\n    loadMinutas();\n  }, [projectData?.id, useSupabase]);\n\n  // Scroll sincronizado\n  const headerRef = useRef(null);\n  const isScrolling = useRef(false);\n\n  const onLeftScroll = (e) => {\n    if (rightRef.current) rightRef.current.scrollTop = e.currentTarget.scrollTop;\n  };\n\n  const onRightScroll = (e) => {\n    if (leftRef.current) leftRef.current.scrollTop = e.currentTarget.scrollTop;\n\n    // Sincronizar scroll horizontal con los headers fijos\n    if (headerRef.current && !isScrolling.current) {\n      isScrolling.current = true;\n      console.log(' SINCRONIZANDO HEADERS - scrollLeft:', e.currentTarget.scrollLeft);\n      console.log(' ANCHOS CONTENEDORES:', {\n        headerContainerWidth: headerRef.current.scrollWidth,\n        headerContainerClientWidth: headerRef.current.clientWidth,\n        rightContainerWidth: e.currentTarget.scrollWidth,\n        rightContainerClientWidth: e.currentTarget.clientWidth,\n        chartWidthPx: chartWidthPx\n      });\n      headerRef.current.scrollLeft = e.currentTarget.scrollLeft;\n      setTimeout(() => { isScrolling.current = false; }, 10);\n    }\n  };\n\n  const onHeaderScroll = (e) => {\n    // Sincronizar scroll horizontal del contenido con los headers\n    if (rightRef.current && !isScrolling.current) {\n      isScrolling.current = true;\n      console.log(' SINCRONIZANDO CONTENIDO - scrollLeft:', e.currentTarget.scrollLeft);\n      console.log(' ANCHOS CONTENEDORES (desde headers):', {\n        headerContainerWidth: e.currentTarget.scrollWidth,\n        headerContainerClientWidth: e.currentTarget.clientWidth,\n        rightContainerWidth: rightRef.current.scrollWidth,\n        rightContainerClientWidth: rightRef.current.clientWidth,\n        chartWidthPx: chartWidthPx\n      });\n      rightRef.current.scrollLeft = e.currentTarget.scrollLeft;\n      setTimeout(() => { isScrolling.current = false; }, 10);\n    }\n  };\n\n  // Actualizar tarea y sincronizar con Work Packages del EVM\n  const updateTask = useCallback((taskId, field, value) => {\n    console.log(' updateTask llamado:', { taskId, field, value, selectedTaskId: selectedTask?.id });\n\n    if (!taskId) {\n      console.error(' taskId es null o undefined');\n      return;\n    }\n\n    setTasks((prev) => {\n      const updatedTasks = prev.map((task) => {\n        if (task.id !== taskId) return task;\n\n        // Clonacin segura del objeto task\n        const updatedTask = {\n          id: task.id,\n          wbsCode: task.wbsCode,\n          name: task.name,\n          duration: task.duration,\n          startDate: task.startDate,\n          endDate: task.endDate,\n          progress: task.progress,\n          predecessors: [...(task.predecessors || [])],\n          cost: task.cost,\n          businessValue: task.businessValue || 0,  //  PRESERVAR businessValue\n          priority: task.priority,\n          assignedTo: task.assignedTo,\n          isMilestone: task.isMilestone,\n          isCritical: task.isCritical,\n          originalDuration: task.originalDuration,\n          earlyStart: task.earlyStart,\n          earlyFinish: task.earlyFinish,\n          lateStart: task.lateStart,\n          lateFinish: task.lateFinish,\n          totalFloat: task.totalFloat,\n          freeFloat: task.freeFloat,\n          description: task.description,\n          resources: [...(task.resources || [])],\n          workPackageId: task.workPackageId,\n          status: task.status,\n          successors: [...(task.successors || [])]\n        };\n        const num = parseFloat(value);\n\n        switch (field) {\n          case 'duration': {\n            const duration = Number.isFinite(num) ? Math.max(0, Math.round(num)) : 0;\n            updatedTask.duration = duration;\n            // Para hitos: fecha de fin = fecha de inicio\n            if (updatedTask.isMilestone) {\n              updatedTask.endDate = updatedTask.startDate;\n            } else {\n              updatedTask.endDate = addDays(updatedTask.startDate, duration, includeWeekends);\n            }\n            break;\n          }\n          case 'startDate': {\n            updatedTask.startDate = value;\n            // Para hitos: fecha de fin = fecha de inicio\n            if (updatedTask.isMilestone) {\n              updatedTask.endDate = value;\n            } else {\n              updatedTask.endDate = addDays(value, updatedTask.duration, includeWeekends);\n            }\n            break;\n          }\n          case 'progress': {\n            const p = Number.isFinite(num) ? Math.round(num) : 0;\n            updatedTask.progress = Math.min(100, Math.max(0, p));\n            break;\n          }\n          case 'cost': {\n            updatedTask.cost = Number.isFinite(num) ? num : 0;\n            break;\n          }\n          case 'resources': {\n            updatedTask.resources = Array.isArray(value) ? value : [];\n            break;\n          }\n          default: {\n            updatedTask[field] = value;\n            if (field === 'name') {\n              console.log(' CAMPO NOMBRE - Actualizando en tasks array:', {\n                taskId,\n                valorAnterior: task[field],\n                valorNuevo: value,\n                taskCompleta: updatedTask\n              });\n            } else {\n              console.log(` Campo '${field}' actualizado a:`, value);\n            }\n          }\n        }\n\n        // ELIMINADO: Sincronizacin con Work Packages - ya no es necesaria\n\n        return updatedTask;\n      });\n\n      return updatedTasks;\n    });\n\n    // Actualizar selectedTask de manera separada para evitar problemas de sincronizacin\n    if (selectedTask && selectedTask.id === taskId) {\n      console.log(' Actualizando selectedTask para:', taskId);\n      setSelectedTask(prev => {\n        // Clonacin segura del objeto selectedTask\n        const updated = {\n          id: prev.id,\n          wbsCode: prev.wbsCode,\n          name: prev.name,\n          duration: prev.duration,\n          startDate: prev.startDate,\n          endDate: prev.endDate,\n          progress: prev.progress,\n          predecessors: [...(prev.predecessors || [])],\n          cost: prev.cost,\n          priority: prev.priority,\n          assignedTo: prev.assignedTo,\n          isMilestone: prev.isMilestone,\n          isCritical: prev.isCritical,\n          originalDuration: prev.originalDuration,\n          earlyStart: prev.earlyStart,\n          earlyFinish: prev.earlyFinish,\n          lateStart: prev.lateStart,\n          lateFinish: prev.lateFinish,\n          totalFloat: prev.totalFloat,\n          freeFloat: prev.freeFloat,\n          description: prev.description,\n          resources: [...(prev.resources || [])],\n          workPackageId: prev.workPackageId,\n          status: prev.status,\n          successors: [...(prev.successors || [])]\n        };\n        const num = parseFloat(value);\n\n        switch (field) {\n          case 'duration': {\n            const duration = Number.isFinite(num) ? Math.max(0, Math.round(num)) : 0;\n            updated.duration = duration;\n            // Para hitos: fecha de fin = fecha de inicio\n            if (updated.isMilestone) {\n              updated.endDate = updated.startDate;\n            } else {\n              updated.endDate = addDays(updated.startDate, duration, includeWeekends);\n            }\n            break;\n          }\n          case 'startDate': {\n            updated.startDate = value;\n            // Para hitos: fecha de fin = fecha de inicio\n            if (updated.isMilestone) {\n              updated.endDate = value;\n            } else {\n              updated.endDate = addDays(value, updated.duration, includeWeekends);\n            }\n            break;\n          }\n          case 'progress': {\n            const p = Number.isFinite(num) ? Math.round(num) : 0;\n            updated.progress = Math.min(100, Math.max(0, p));\n            break;\n          }\n          case 'cost': {\n            updated.cost = Number.isFinite(num) ? num : 0;\n            break;\n          }\n          case 'resources': {\n            updated.resources = Array.isArray(value) ? value : [];\n            break;\n          }\n          default: {\n            updated[field] = value;\n            if (field === 'name') {\n              console.log(' CAMPO NOMBRE - Actualizando selectedTask:', {\n                taskId,\n                valorAnterior: prev[field],\n                valorNuevo: value,\n                selectedTaskCompleta: updated\n              });\n            } else {\n              console.log(` selectedTask campo '${field}' actualizado a:`, value);\n            }\n          }\n        }\n\n        console.log(' selectedTask actualizado:', updated);\n        return updated;\n      });\n    }\n  }, [selectedTask]);\n\n\n\n  // Tipos de dependencias disponibles\n  const DEPENDENCY_TYPES = {\n    'FS': { name: 'Finish-to-Start', description: 'La tarea predecesora debe terminar antes de que la sucesora pueda comenzar', color: '#3b82f6' },\n    'SS': { name: 'Start-to-Start', description: 'La tarea sucesora puede comenzar cuando la predecesora comience', color: '#10b981' },\n    'FF': { name: 'Finish-to-Finish', description: 'La tarea sucesora debe terminar cuando la predecesora termine', color: '#f59e0b' },\n    'SF': { name: 'Start-to-Finish', description: 'La tarea sucesora debe terminar cuando la predecesora comience', color: '#8b5cf6' }\n  };\n\n  // Funcin para validar dependencias circulares\n  const hasCircularDependency = useCallback((taskId, newPredecessorId) => {\n    const visited = new Set();\n    const recursionStack = new Set();\n\n    const dfs = (currentId) => {\n      if (recursionStack.has(currentId)) {\n        return true; // Dependencia circular detectada\n      }\n      if (visited.has(currentId)) {\n        return false; // Ya visitado, no hay ciclo\n      }\n\n      visited.add(currentId);\n      recursionStack.add(currentId);\n\n      const currentTask = tasksWithCPM.find(t => t.id === currentId);\n      if (currentTask) {\n        for (const predId of currentTask.predecessors) {\n          if (dfs(predId)) {\n            return true;\n          }\n        }\n      }\n\n      recursionStack.delete(currentId);\n      return false;\n    };\n\n    // Simular la nueva dependencia\n    const foundTask = tasksWithCPM.find(t => t.id === taskId);\n    const tempTask = foundTask ? {\n      id: foundTask.id,\n      wbsCode: foundTask.wbsCode,\n      name: foundTask.name,\n      duration: foundTask.duration,\n      startDate: foundTask.startDate,\n      endDate: foundTask.endDate,\n      progress: foundTask.progress,\n      predecessors: [...(foundTask.predecessors || [])],\n      cost: foundTask.cost,\n      priority: foundTask.priority,\n      assignedTo: foundTask.assignedTo,\n      isMilestone: foundTask.isMilestone,\n      isCritical: foundTask.isCritical,\n      originalDuration: foundTask.originalDuration,\n      earlyStart: foundTask.earlyStart,\n      earlyFinish: foundTask.earlyFinish,\n      lateStart: foundTask.lateStart,\n      lateFinish: foundTask.lateFinish,\n      totalFloat: foundTask.totalFloat,\n      freeFloat: foundTask.freeFloat,\n      description: foundTask.description,\n      resources: [...(foundTask.resources || [])],\n      workPackageId: foundTask.workPackageId,\n      status: foundTask.status,\n      successors: [...(foundTask.successors || [])]\n    } : null;\n    if (tempTask) {\n      tempTask.predecessors = [...(tempTask.predecessors || []), newPredecessorId];\n\n      // Verificar si la nueva dependencia crea un ciclo\n      return dfs(newPredecessorId);\n    }\n\n    return false;\n  }, [tasksWithCPM]);\n\n  // Funcin para limpiar dependencias circulares de manera segura\n  const cleanCircularDependencies = useCallback(() => {\n    console.log(' Limpiando dependencias circulares...');\n\n    const visited = new Set();\n    const recursionStack = new Set();\n    const circularTasks = new Set();\n\n    const dfs = (currentId) => {\n      if (recursionStack.has(currentId)) {\n        circularTasks.add(currentId);\n        return true; // Dependencia circular detectada\n      }\n      if (visited.has(currentId)) {\n        return false; // Ya visitado, no hay ciclo\n      }\n\n      recursionStack.add(currentId);\n      visited.add(currentId);\n\n      const task = tasks.find(t => t.id === currentId);\n      if (task) {\n        for (const predId of task.predecessors) {\n          if (dfs(predId)) {\n            circularTasks.add(currentId);\n            return true;\n          }\n        }\n      }\n\n      recursionStack.delete(currentId);\n      return false;\n    };\n\n    // Detectar todas las tareas con dependencias circulares\n    tasks.forEach(task => {\n      if (!visited.has(task.id)) {\n        dfs(task.id);\n      }\n    });\n\n    if (circularTasks.size > 0) {\n      console.warn(` Se encontraron ${circularTasks.size} tareas con dependencias circulares:`, Array.from(circularTasks));\n\n      // Limpiar dependencias circulares de manera segura\n      const cleanedTasks = tasks.map(task => {\n        if (circularTasks.has(task.id)) {\n          console.warn(` Limpiando dependencias circulares de tarea: ${task.name} (${task.id})`);\n          return {\n            ...task,\n            predecessors: [], // Limpiar dependencias problemticas\n            successors: []\n          };\n        }\n        return task;\n      });\n\n      // Actualizar tareas con dependencias limpiadas\n      setTasks(cleanedTasks);\n\n      return true; // Se limpiaron dependencias\n    }\n\n    return false; // No haba dependencias circulares\n  }, [tasks]);\n\n  // Actualizar informacin del tipo de dependencia seleccionado\n  useEffect(() => {\n    const updateDependencyTypeInfo = () => {\n      const dependencyTypeSelect = document.getElementById('newDependencyType');\n      const dependencyTypeInfo = document.getElementById('dependencyTypeInfo');\n\n      if (dependencyTypeSelect && dependencyTypeInfo) {\n        const selectedType = dependencyTypeSelect.value;\n        const typeInfo = DEPENDENCY_TYPES[selectedType];\n        if (typeInfo) {\n          dependencyTypeInfo.textContent = typeInfo.description;\n        }\n      }\n    };\n\n    // Actualizar cuando cambie el tipo seleccionado\n    const dependencyTypeSelect = document.getElementById('newDependencyType');\n    if (dependencyTypeSelect) {\n      dependencyTypeSelect.addEventListener('change', updateDependencyTypeInfo);\n      updateDependencyTypeInfo(); // Actualizar inicialmente\n\n      return () => {\n        dependencyTypeSelect.removeEventListener('change', updateDependencyTypeInfo);\n      };\n    }\n  }, [selectedTask]);\n\n  // NUEVA FUNCIN LIMPIA PARA EDITAR TAREAS\n  const handleTaskEdit = useCallback((taskId, updates) => {\n    console.log(' NUEVA FUNCIN handleTaskEdit - INICIANDO:', { taskId, updates });\n\n    setTasks(prev => {\n      console.log(' SETTASKS #3 - NUEVA FUNCIN handleTaskEdit:', taskId, updates);\n      console.log(' SETTASKS #3 - Estado ANTES:', JSON.stringify(prev.map(t => ({\n        id: t.id,\n        name: t.name,\n        predecessors: t.predecessors,\n        successors: t.successors\n      })), null, 2));\n\n      const updatedTasks = prev.map(task => {\n        if (task.id === taskId) {\n          // Clonacin segura del objeto task con updates\n          const updatedTask = {\n            id: task.id,\n            wbsCode: task.wbsCode,\n            name: task.name,\n            duration: task.duration,\n            startDate: task.startDate,\n            endDate: task.endDate,\n            progress: task.progress,\n            predecessors: [...(task.predecessors || [])],\n            cost: task.cost,\n            priority: task.priority,\n            assignedTo: task.assignedTo,\n            isMilestone: task.isMilestone,\n            isCritical: task.isCritical,\n            originalDuration: task.originalDuration,\n            earlyStart: task.earlyStart,\n            earlyFinish: task.earlyFinish,\n            lateStart: task.lateStart,\n            lateFinish: task.lateFinish,\n            totalFloat: task.totalFloat,\n            freeFloat: task.freeFloat,\n            description: task.description,\n            resources: [...(task.resources || [])],\n            workPackageId: task.workPackageId,\n            status: task.status,\n            successors: [...(task.successors || [])],\n            // Aplicar updates despus de la clonacin segura\n            ...(updates || {})\n          };\n          console.log(' NUEVA FUNCIN - Tarea actualizada:', {\n            id: updatedTask.id,\n            name: updatedTask.name,\n            predecessors: updatedTask.predecessors,\n            successors: updatedTask.successors\n          });\n          return updatedTask;\n        }\n        return task;\n      });\n\n      console.log(' SETTASKS #3 - Estado DESPUS:', JSON.stringify(updatedTasks.map(t => ({\n        id: t.id,\n        name: t.name,\n        predecessors: t.predecessors,\n        successors: t.successors\n      })), null, 2));\n\n      console.log(' NUEVA FUNCIN - Estado actualizado correctamente');\n      return updatedTasks;\n    });\n  }, []);\n\n  // Actualizar predecesoras\n  const updateSuccessors = useCallback((taskId, successorsString, dependencyType = 'FS') => {\n    console.warn(' updateSuccessors INICIADO:', { taskId, successorsString, dependencyType });\n    console.error(' updateSuccessors INICIADO:', { taskId, successorsString, dependencyType });\n\n    const newSuccs = successorsString\n      .split(',')\n      .map((s) => s.trim())\n      .filter((s) => s && s !== taskId);\n\n    console.log(' Sucesoras procesadas:', newSuccs);\n\n    // Validar dependencias circulares\n    for (const succId of newSuccs) {\n      if (hasCircularDependency(taskId, succId)) {\n        console.error(' DEPENDENCIA CIRCULAR DETECTADA:', { taskId, succId });\n        alert(` No se puede crear la dependencia: se detectara una dependencia circular entre ${taskId} y ${succId}`);\n        return;\n      }\n    }\n\n    setTasks((prev) => {\n      console.log(' Estado anterior de tareas:', prev.map(t => ({\n        id: t.id,\n        name: t.name,\n        predecessors: t.predecessors,\n        successors: t.successors\n      })));\n\n      const predMap = new Map(prev.map((t) => [t.id, new Set(t.predecessors)]));\n      for (const [, set] of predMap) set.delete(taskId);\n\n      for (const succId of newSuccs) {\n        predMap.get(succId)?.add(taskId);\n      }\n\n      const updated = prev.map((t) => ({\n        id: t.id,\n        wbsCode: t.wbsCode,\n        name: t.name,\n        duration: t.duration,\n        startDate: t.startDate,\n        endDate: t.endDate,\n        progress: t.progress,\n        predecessors: Array.from(predMap.get(t.id) || []),\n        cost: t.cost,\n        priority: t.priority,\n        assignedTo: t.assignedTo,\n        isMilestone: t.isMilestone,\n        isCritical: t.isCritical,\n        originalDuration: t.originalDuration,\n        earlyStart: t.earlyStart,\n        earlyFinish: t.earlyFinish,\n        lateStart: t.lateStart,\n        lateFinish: t.lateFinish,\n        totalFloat: t.totalFloat,\n        freeFloat: t.freeFloat,\n        description: t.description,\n        resources: [...(t.resources || [])],\n        workPackageId: t.workPackageId,\n        status: t.status,\n        successors: t.id === taskId ? newSuccs : t.successors\n      }));\n\n      console.log(' Estado actualizado de tareas:', updated.map(t => ({\n        id: t.id,\n        name: t.name,\n        predecessors: t.predecessors,\n        successors: t.successors\n      })));\n\n      return updated;\n    });\n\n    console.warn(' updateSuccessors COMPLETADO');\n    console.error(' updateSuccessors COMPLETADO');\n  }, [hasCircularDependency]);\n\n  const updatePredecessors = useCallback((taskId, predecessorsString, dependencyType = 'FS') => {\n    console.warn(' updatePredecessors INICIADO:', { taskId, predecessorsString, dependencyType });\n    console.error(' updatePredecessors INICIADO:', { taskId, predecessorsString, dependencyType });\n\n    const newPreds = predecessorsString\n      .split(',')\n      .map((p) => p.trim())\n      .filter((p) => p && p !== taskId);\n\n    console.log(' Predecesoras procesadas:', newPreds);\n\n    // Validar cada predecesora\n    for (const predId of newPreds) {\n      const validation = validatePredecessor(taskId, predId);\n      if (!validation.valid) {\n        console.error(' VALIDACIN FALLIDA:', { taskId, predId, error: validation.error });\n        alert(validation.error);\n        return;\n      }\n    }\n\n    setTasks((prev) => {\n      console.log(' Estado anterior de tareas:', prev.map(t => ({\n        id: t.id,\n        name: t.name,\n        predecessors: t.predecessors,\n        successors: t.successors\n      })));\n\n      // SOLUCIN: NO sobrescribir las sucesoras existentes, solo actualizar las predecesoras\n      const updatedTasks = prev.map((t) => {\n        if (t.id === taskId) {\n          // Solo actualizar la tarea actual con las nuevas predecesoras\n          return {\n            id: t.id,\n            wbsCode: t.wbsCode,\n            name: t.name,\n            duration: t.duration,\n            startDate: t.startDate,\n            endDate: t.endDate,\n            progress: t.progress,\n            predecessors: newPreds,\n            cost: t.cost,\n            priority: t.priority,\n            assignedTo: t.assignedTo,\n            isMilestone: t.isMilestone,\n            isCritical: t.isCritical,\n            originalDuration: t.originalDuration,\n            earlyStart: t.earlyStart,\n            earlyFinish: t.earlyFinish,\n            lateStart: t.lateStart,\n            lateFinish: t.lateFinish,\n            totalFloat: t.totalFloat,\n            freeFloat: t.freeFloat,\n            description: t.description,\n            resources: [...(t.resources || [])],\n            workPackageId: t.workPackageId,\n            status: t.status,\n            successors: [...(t.successors || [])],\n            dependencyType: dependencyType\n          };\n        } else {\n          // Para las otras tareas, solo agregar esta tarea como sucesora si es predecesora\n          if (newPreds.includes(t.id) && !t.successors.includes(taskId)) {\n            return {\n              id: t.id,\n              wbsCode: t.wbsCode,\n              name: t.name,\n              duration: t.duration,\n              startDate: t.startDate,\n              endDate: t.endDate,\n              progress: t.progress,\n              predecessors: [...(t.predecessors || [])],\n              cost: t.cost,\n              priority: t.priority,\n              assignedTo: t.assignedTo,\n              isMilestone: t.isMilestone,\n              isCritical: t.isCritical,\n              originalDuration: t.originalDuration,\n              earlyStart: t.earlyStart,\n              earlyFinish: t.earlyFinish,\n              lateStart: t.lateStart,\n              lateFinish: t.lateFinish,\n              totalFloat: t.totalFloat,\n              freeFloat: t.freeFloat,\n              description: t.description,\n              resources: [...(t.resources || [])],\n              workPackageId: t.workPackageId,\n              status: t.status,\n              successors: t.successors.slice().concat([taskId])\n            };\n          }\n          return t;\n        }\n      });\n\n      console.log(' Estado actualizado de tareas:', updatedTasks.map(t => ({\n        id: t.id,\n        name: t.name,\n        predecessors: t.predecessors,\n        successors: t.successors,\n        dependencyType: t.dependencyType\n      })));\n\n      // Actualizar selectedTask si es la tarea que se est editando\n      if (selectedTask && selectedTask.id === taskId) {\n        const updatedSelectedTask = updatedTasks.find(t => t.id === taskId);\n        if (updatedSelectedTask) {\n          setSelectedTask(updatedSelectedTask);\n        }\n      }\n\n      return updatedTasks;\n    });\n  }, [hasCircularDependency]); // CORRECCIN: Remover selectedTask para evitar bucle infinito\n\n  // Funcin para manejar cambios en el campo nombre (sin loop infinito)\n  const handleNameChange = useCallback((e) => {\n    const newValue = e.target.value;\n    console.log(' CAMPO NOMBRE - handleNameChange:', {\n      valorAnterior: tempTaskName,\n      valorNuevo: newValue,\n      taskId: selectedTask?.id\n    });\n    setTempTaskName(newValue);\n  }, [tempTaskName, selectedTask?.id]);\n\n  // Funcin para guardar el nombre cuando se pierde el foco\n  const handleNameBlur = useCallback(() => {\n    if (selectedTask && tempTaskName !== selectedTask.name) {\n      console.log(' CAMPO NOMBRE - handleNameBlur - Guardando:', {\n        valorAnterior: selectedTask.name,\n        valorNuevo: tempTaskName,\n        taskId: selectedTask.id\n      });\n      updateTask(selectedTask.id, 'name', tempTaskName);\n    }\n  }, [selectedTask, tempTaskName, updateTask]);\n\n  // Funcin para restaurar el valor cuando se gana el foco\n  const handleNameFocus = useCallback(() => {\n    if (selectedTask) {\n      console.log(' CAMPO NOMBRE - handleNameFocus - Restaurando:', {\n        valor: selectedTask.name,\n        taskId: selectedTask.id\n      });\n      setTempTaskName(selectedTask.name);\n    }\n  }, [selectedTask]);\n\n  // Funcin para validar predecesoras de Excel\n  const validateExcelPredecessors = useCallback((tasks) => {\n    const errors = [];\n    const warnings = [];\n\n    for (const task of tasks) {\n      if (!task.predecessors || task.predecessors.length === 0) continue;\n\n      for (const predId of task.predecessors) {\n        // 1. Verificar que la predecesora existe\n        // PRIMERO: Buscar por ID exacto\n        let predecessorTask = tasks.find(t => t.id === predId);\n\n        // SEGUNDO: Si no se encuentra, buscar por nmero de fila (para Excel)\n        if (!predecessorTask && !isNaN(predId)) {\n          const rowNumber = parseInt(predId);\n          if (rowNumber > 0 && rowNumber <= tasks.length) {\n            predecessorTask = tasks[rowNumber - 1]; // Las filas empiezan en 1, el array en 0\n          }\n        }\n\n        if (!predecessorTask) {\n          errors.push(` Tarea \"${task.name}\": La predecesora \"${predId}\" no existe`);\n          continue;\n        }\n\n        // 2. Verificar que no es la misma tarea\n        if (task.id === predId || task === predecessorTask) {\n          errors.push(` Tarea \"${task.name}\": No puede ser predecesora de s misma`);\n          continue;\n        }\n\n        // 3. Verificar dependencia circular\n        if (hasCircularDependency(task.id, predecessorTask.id)) {\n          errors.push(` Tarea \"${task.name}\": Dependencia circular con \"${predecessorTask.name}\"`);\n          continue;\n        }\n\n        // 4. Verificar que la predecesora no est despus de la tarea actual\n        const currentStart = new Date(task.startDate);\n        const predecessorEnd = new Date(predecessorTask.endDate);\n\n        if (predecessorEnd > currentStart) {\n          warnings.push(` Tarea \"${task.name}\": La predecesora \"${predecessorTask.name}\" termina despus de que inicia la tarea actual`);\n        }\n      }\n    }\n\n    return { errors, warnings };\n  }, [hasCircularDependency]);\n\n  // Funcin para validar predecesora\n  const validatePredecessor = useCallback((taskId, predecessorId) => {\n    // 1. Verificar que la predecesora existe\n    const predecessorTask = tasks.find(t => t.id === predecessorId);\n    if (!predecessorTask) {\n      return { valid: false, error: ` La tarea predecesora ${predecessorId} no existe` };\n    }\n\n    // 2. Verificar que no es la misma tarea\n    if (taskId === predecessorId) {\n      return { valid: false, error: ` Una tarea no puede ser predecesora de s misma` };\n    }\n\n    // 3. Verificar que la predecesora no est despus de la tarea actual\n    const currentTask = tasks.find(t => t.id === taskId);\n    if (currentTask && predecessorTask) {\n      const currentStart = new Date(currentTask.startDate);\n      const predecessorEnd = new Date(predecessorTask.endDate);\n\n      if (predecessorEnd > currentStart) {\n        return { valid: false, error: ` La tarea predecesora termina despus de que inicia la tarea actual` };\n      }\n    }\n\n    // 4. Verificar dependencia circular\n    if (hasCircularDependency(taskId, predecessorId)) {\n      return { valid: false, error: ` Se detectara una dependencia circular entre ${taskId} y ${predecessorId}` };\n    }\n\n    return { valid: true, error: null };\n  }, [tasks, hasCircularDependency]);\n\n  // Funcin para manejar cambios en el select de predecesoras\n  const handlePredecessorChange = useCallback((e) => {\n    console.log(' SELECT PREDECESORA - EVENTO CAPTURADO:', {\n      event: e,\n      type: e.type,\n      target: e.target,\n      value: e.target.value,\n      selectedTask: selectedTask?.id\n    });\n\n    const taskId = e.target.value;\n\n    // Actualizar el estado local\n    setSelectedPredecessor(taskId);\n\n    if (taskId && selectedTask && !selectedTask.predecessors.includes(taskId)) {\n      // Validar predecesora\n      const validation = validatePredecessor(selectedTask.id, taskId);\n      if (!validation.valid) {\n        alert(validation.error);\n\n        // Limpiar el select manualmente\n        if (predecessorSelectRef.current) {\n          predecessorSelectRef.current.value = '';\n        }\n        return;\n      }\n\n      const newPreds = [...(selectedTask.predecessors || []), taskId];\n      const dependencyType = document.getElementById('newDependencyType')?.value || 'FS';\n\n      console.log(' Agregando predecesora desde select:', {\n        tarea: selectedTask.id,\n        nuevaPredecesora: taskId,\n        predecesorasAntes: selectedTask.predecessors,\n        predecesorasDespues: newPreds,\n        dependencyType\n      });\n\n      console.log(' ACTUALIZANDO selectedTask con nuevas predecesoras:', {\n        tarea: selectedTask.id,\n        predecesorasAntes: selectedTask.predecessors,\n        predecesorasDespues: newPreds,\n        dependencyType\n      });\n\n      // Actualizar selectedTask directamente\n      const updatedTask = {\n        id: selectedTask.id,\n        wbsCode: selectedTask.wbsCode,\n        name: selectedTask.name,\n        duration: selectedTask.duration,\n        startDate: selectedTask.startDate,\n        endDate: selectedTask.endDate,\n        progress: selectedTask.progress,\n        predecessors: newPreds,\n        cost: selectedTask.cost,\n        priority: selectedTask.priority,\n        assignedTo: selectedTask.assignedTo,\n        isMilestone: selectedTask.isMilestone,\n        isCritical: selectedTask.isCritical,\n        originalDuration: selectedTask.originalDuration,\n        earlyStart: selectedTask.earlyStart,\n        earlyFinish: selectedTask.earlyFinish,\n        lateStart: selectedTask.lateStart,\n        lateFinish: selectedTask.lateFinish,\n        totalFloat: selectedTask.totalFloat,\n        freeFloat: selectedTask.freeFloat,\n        description: selectedTask.description,\n        resources: [...(selectedTask.resources || [])],\n        workPackageId: selectedTask.workPackageId,\n        status: selectedTask.status,\n        successors: [...(selectedTask.successors || [])]\n      };\n      console.warn(' ACTUALIZANDO selectedTask:', {\n        antes: selectedTask.predecessors,\n        despues: updatedTask.predecessors,\n        count: updatedTask.predecessors.length\n      });\n      // ACTUALIZAR SOLO EL ESTADO GLOBAL - NO setSelectedTask para evitar duplicacin\n      setTasks(prev => {\n        console.log(' SETTASKS #2 - ACTUALIZANDO ESTADO GLOBAL:', selectedTask.id);\n        const updated = prev.map(t => {\n          if (t.id === selectedTask.id) {\n            return updatedTask;\n          }\n          return t;\n        });\n\n        // Actualizar selectedTask con la tarea actualizada del estado global\n        const updatedSelectedTask = updated.find(t => t.id === selectedTask.id);\n        if (updatedSelectedTask) {\n          setSelectedTask(updatedSelectedTask);\n        }\n\n        return updated;\n      });\n\n      // Limpiar el select manualmente\n      if (predecessorSelectRef.current) {\n        predecessorSelectRef.current.value = '';\n      }\n    }\n  }, [hasCircularDependency]); // CORRECCIN: Remover selectedTask y updatePredecessors para evitar bucle infinito\n\n  // Actualizar tempTaskName cuando cambie selectedTask\n  // TEMPORALMENTE DESHABILITADO COMPLETAMENTE PARA DEBUGGING\n  // useEffect(() => {\n  //   console.warn(' selectedTask CAMBI:', {\n  //     id: selectedTask?.id,\n  //     predecessors: selectedTask?.predecessors,\n  //     count: selectedTask?.predecessors?.length,\n  //     stackTrace: new Error().stack\n  //   });\n  //   \n  //   if (selectedTask) {\n  //     setTempTaskName(selectedTask.name);\n  //   } else {\n  //     // Limpiar estados cuando se cierre el modal\n  //     setTempTaskName('');\n  //     setSelectedPredecessor('');\n  //     setSelectedSuccessor('');\n  //   }\n  // }, [selectedTask]);\n\n  // Event delegation global para los selects\n  // Event listener directo para el select de sucesoras\n  useEffect(() => {\n    const successorSelect = document.getElementById('newSuccessor');\n    if (successorSelect) {\n      const handleSuccessorChange = (e) => {\n        console.log(' EVENT LISTENER DIRECTO - SUCESORA:', e.target.value, 'TIPO:', e.type);\n\n        const actualValue = e.target.value;\n        if (actualValue && actualValue.trim() !== '' && actualValue !== 'Seleccionar tarea sucesora...') {\n          console.log(' PROCESANDO SUCESORA VLIDA DIRECTO:', actualValue);\n\n          // Obtener selectedTask del estado global\n          let currentSelectedTask = selectedTask;\n          if (!currentSelectedTask) {\n            const modalTaskId = document.querySelector('[data-task-id]')?.getAttribute('data-task-id');\n            if (modalTaskId) {\n              currentSelectedTask = tasks.find(t => t.id === modalTaskId);\n            } else {\n              currentSelectedTask = tasks.find(t => t.id && t.id !== actualValue);\n            }\n          }\n\n          if (currentSelectedTask && !currentSelectedTask.successors.includes(actualValue)) {\n            const newSuccs = currentSelectedTask.successors.slice().concat([actualValue]);\n            console.log(' Agregando sucesora desde event listener directo:', {\n              tarea: currentSelectedTask.id,\n              nuevaSucesora: actualValue,\n              sucesorasAntes: currentSelectedTask.successors,\n              sucesorasDespues: newSuccs\n            });\n\n            // SOLUCIN: Solo actualizar selectedTask, NO el estado global hasta guardar\n            const updatedTask = {\n              id: currentSelectedTask.id,\n              wbsCode: currentSelectedTask.wbsCode,\n              name: currentSelectedTask.name,\n              duration: currentSelectedTask.duration,\n              startDate: currentSelectedTask.startDate,\n              endDate: currentSelectedTask.endDate,\n              progress: currentSelectedTask.progress,\n              predecessors: [...(currentSelectedTask.predecessors || [])],\n              cost: currentSelectedTask.cost,\n              priority: currentSelectedTask.priority,\n              assignedTo: currentSelectedTask.assignedTo,\n              isMilestone: currentSelectedTask.isMilestone,\n              isCritical: currentSelectedTask.isCritical,\n              originalDuration: currentSelectedTask.originalDuration,\n              earlyStart: currentSelectedTask.earlyStart,\n              earlyFinish: currentSelectedTask.earlyFinish,\n              lateStart: currentSelectedTask.lateStart,\n              lateFinish: currentSelectedTask.lateFinish,\n              totalFloat: currentSelectedTask.totalFloat,\n              freeFloat: currentSelectedTask.freeFloat,\n              description: currentSelectedTask.description,\n              resources: [...(currentSelectedTask.resources || [])],\n              workPackageId: currentSelectedTask.workPackageId,\n              status: currentSelectedTask.status,\n              successors: newSuccs\n            };\n            setSelectedTask(updatedTask);\n            console.log(' SUCESORA AGREGADA A selectedTask (NO al estado global an)');\n\n            console.log(' SUCESORA AGREGADA EXITOSAMENTE DESDE EVENT LISTENER DIRECTO');\n          }\n        }\n      };\n\n      successorSelect.addEventListener('change', handleSuccessorChange);\n      successorSelect.addEventListener('input', handleSuccessorChange);\n\n      return () => {\n        successorSelect.removeEventListener('change', handleSuccessorChange);\n        successorSelect.removeEventListener('input', handleSuccessorChange);\n      };\n    }\n  }, [selectedTask, tasks]);\n\n  // Refs para acceder a valores actuales sin causar re-renders\n  const selectedTaskRef = useRef(selectedTask);\n  const hasCircularDependencyRef = useRef(hasCircularDependency);\n  const updatePredecessorsRef = useRef(updatePredecessors);\n\n  // Actualizar refs cuando cambien los valores\n  useEffect(() => {\n    selectedTaskRef.current = selectedTask;\n    hasCircularDependencyRef.current = hasCircularDependency;\n    updatePredecessorsRef.current = updatePredecessors;\n  }, [selectedTask, hasCircularDependency]); // CORRECCIN: Remover updatePredecessors para evitar bucle infinito\n\n  // TEMPORALMENTE DESHABILITADO PARA EVITAR BUCLE INFINITO\n  useEffect(() => {\n    console.log(' EVENT DELEGATION GLOBAL DESHABILITADO TEMPORALMENTE');\n    return; // Salir inmediatamente sin configurar listeners\n\n    /* eslint-disable no-unreachable */\n    const handleGlobalChange = (e) => {\n      // EXCEPCIN: No procesar el checkbox includeWeekends aqu\n      if (e.target.id === 'includeWeekends') {\n        console.log(' CHECKBOX includeWeekends detectado - NO procesando en event listener global');\n        return; // Salir sin procesar\n      }\n\n      // EXCEPCIN: No procesar inputs de archivo (causan conflictos con importacin)\n      if (e.target.type === 'file') {\n        console.log(' INPUT FILE detectado - NO procesando en event listener global');\n        return; // Salir sin procesar\n      }\n\n      // Log persistente en localStorage (solo datos serializables)\n      const logData = {\n        timestamp: new Date().toISOString(),\n        type: e.type,\n        id: e.target.id,\n        value: e.target.value,\n        tagName: e.target.tagName\n      };\n\n      // Log removido por seguridad - no almacenar datos sensibles en localStorage\n\n      // Log de todos los eventos para diagnstico\n      console.log(' EVENTO GLOBAL CAPTURADO:', logData);\n\n      // Log inmediato para verificar que llegamos aqu\n      console.log(' LLEGAMOS A LA FUNCIN GLOBAL - ID:', e.target.id);\n\n      // Log adicional para facilitar el filtrado\n      console.log(' DEPENDENCY_EVENT:', JSON.stringify(logData));\n\n      // Log de procesamiento\n      console.log(' PROCESANDO EVENTO GLOBAL - ID:', e.target.id, 'TIPO:', e.type, 'VALOR:', e.target.value);\n\n      // Verificar si es uno de nuestros selects\n      if (e.target.id === 'newPredecessor') {\n        console.log(' PREDECESORA SELECCIONADA VIA DELEGATION:', e.target.value);\n\n        const taskId = e.target.value;\n\n        console.warn(' VERIFICANDO CONDICIONES:', {\n          taskId,\n          selectedTask: selectedTaskRef.current?.id,\n          predecessors: selectedTaskRef.current?.predecessors,\n          includes: selectedTaskRef.current?.predecessors?.includes(taskId)\n        });\n\n        if (taskId && selectedTaskRef.current && !selectedTaskRef.current.predecessors.includes(taskId)) {\n          // Validar dependencia circular\n          if (hasCircularDependencyRef.current(selectedTaskRef.current.id, taskId)) {\n            alert(` No se puede crear la dependencia: se detectara una dependencia circular entre ${selectedTaskRef.current.id} y ${taskId}`);\n            e.target.value = '';\n            return;\n          }\n\n          const newPreds = [...(selectedTaskRef.current.predecessors || []), taskId];\n          const dependencyType = document.getElementById('newDependencyType')?.value || 'FS';\n\n          console.log(' Agregando predecesora desde delegation:', {\n            tarea: selectedTaskRef.current.id,\n            nuevaPredecesora: taskId,\n            predecesorasAntes: selectedTaskRef.current.predecessors,\n            predecesorasDespues: newPreds,\n            dependencyType\n          });\n\n          console.warn(' LLAMANDO updatePredecessors:', {\n            taskId: selectedTaskRef.current.id,\n            predecessors: newPreds.join(','),\n            dependencyType\n          });\n\n          // SOLUCIN: Solo actualizar selectedTask, NO el estado global hasta guardar\n          const updatedTask = {\n            id: selectedTaskRef.current.id,\n            wbsCode: selectedTaskRef.current.wbsCode,\n            name: selectedTaskRef.current.name,\n            duration: selectedTaskRef.current.duration,\n            startDate: selectedTaskRef.current.startDate,\n            endDate: selectedTaskRef.current.endDate,\n            progress: selectedTaskRef.current.progress,\n            predecessors: newPreds,\n            cost: selectedTaskRef.current.cost,\n            priority: selectedTaskRef.current.priority,\n            assignedTo: selectedTaskRef.current.assignedTo,\n            isMilestone: selectedTaskRef.current.isMilestone,\n            isCritical: selectedTaskRef.current.isCritical,\n            originalDuration: selectedTaskRef.current.originalDuration,\n            earlyStart: selectedTaskRef.current.earlyStart,\n            earlyFinish: selectedTaskRef.current.earlyFinish,\n            lateStart: selectedTaskRef.current.lateStart,\n            lateFinish: selectedTaskRef.current.lateFinish,\n            totalFloat: selectedTaskRef.current.totalFloat,\n            freeFloat: selectedTaskRef.current.freeFloat,\n            description: selectedTaskRef.current.description,\n            resources: [...(selectedTaskRef.current.resources || [])],\n            workPackageId: selectedTaskRef.current.workPackageId,\n            status: selectedTaskRef.current.status,\n            successors: [...(selectedTaskRef.current.successors || [])]\n          };\n          setSelectedTask(updatedTask);\n          console.log(' PREDECESORA AGREGADA A selectedTask (NO al estado global an)');\n\n          console.warn(' updatePredecessors COMPLETADO');\n          e.target.value = '';\n        }\n      } else if (e.target.id === 'newSuccessor') {\n        console.warn(' DETECTADO SELECT DE SUCESORA:', e.target.value, 'TIPO EVENTO:', e.type);\n\n        // SOLUCIN: Procesar evento 'change' solo si tiene valor vlido\n        if (e.type === 'change' && (!e.target.value || e.target.value.trim() === '')) {\n          console.log(' IGNORANDO EVENTO CHANGE VACO:', e.type, 'para newSuccessor');\n          return;\n        }\n\n        // SOLUCIN: Procesar evento 'input' o 'change' con valor vlido\n        if (e.type !== 'input' && e.type !== 'change') {\n          console.log(' IGNORANDO EVENTO:', e.type, 'para newSuccessor');\n          return;\n        }\n\n        console.log(' SUCESORA SELECCIONADA VIA DELEGATION:', e.target.value);\n        console.log(' EVENTO SUCESORA CAPTURADO - timestamp:', new Date().toISOString());\n        console.log(' VALOR DEL SELECT:', e.target.value, 'TIPO:', typeof e.target.value, 'LONGITUD:', e.target.value?.length);\n        console.log(' OPCIONES DEL SELECT:', Array.from(e.target.options).map(opt => ({ value: opt.value, text: opt.text, selected: opt.selected })));\n\n        // SOLUCIN: Procesar directamente sin setTimeout\n        const actualValue = e.target.value;\n        console.log(' VALOR ACTUAL INMEDIATO:', actualValue);\n\n        // VERIFICACIN: Solo procesar si el valor no est vaco y no es la opcin por defecto\n        if (actualValue && actualValue.trim() !== '' && actualValue !== 'Seleccionar tarea sucesora...') {\n          // VERIFICACIN ADICIONAL: Evitar procesamiento duplicado\n          if (e.target.dataset.processing === 'true') {\n            console.log(' YA SE EST PROCESANDO ESTA SUCESORA, IGNORANDO');\n            return;\n          }\n          e.target.dataset.processing = 'true';\n          console.log(' PROCESANDO SUCESORA VLIDA:', actualValue);\n          const taskId = actualValue;\n          console.warn(' VERIFICANDO CONDICIONES SUCESORA:', {\n            taskId,\n            selectedTask: selectedTaskRef.current?.id,\n            successors: selectedTaskRef.current?.successors,\n            includes: selectedTaskRef.current?.successors?.includes(taskId)\n          });\n\n          // VERIFICACIN DE SEGURIDAD: Si selectedTask es undefined, obtenerlo del estado global\n          let currentSelectedTask = selectedTaskRef.current;\n          if (!currentSelectedTask) {\n            console.warn(' selectedTask es undefined, obteniendo del estado global...');\n            // Buscar la tarea que tiene el modal abierto (la que est siendo editada)\n            // Usar el ID del modal abierto o buscar la primera tarea disponible\n            const modalTaskId = document.querySelector('[data-task-id]')?.getAttribute('data-task-id');\n            if (modalTaskId) {\n              currentSelectedTask = tasks.find(t => t.id === modalTaskId);\n              console.warn(' selectedTask recuperado por modal ID:', modalTaskId);\n            } else {\n              // Fallback: buscar cualquier tarea que no sea la sucesora seleccionada\n              currentSelectedTask = tasks.find(t => t.id && t.id !== taskId);\n              console.warn(' selectedTask recuperado por fallback:', currentSelectedTask?.id);\n            }\n          }\n\n          // VERIFICACIN ADICIONAL: Si an no tenemos currentSelectedTask, usar la primera tarea disponible\n          if (!currentSelectedTask && tasks.length > 0) {\n            currentSelectedTask = tasks[0];\n            console.warn(' selectedTask recuperado por primera tarea disponible:', currentSelectedTask.id);\n          }\n\n          // VERIFICACIN FINAL: Si an no tenemos currentSelectedTask, crear uno temporal\n          if (!currentSelectedTask) {\n            console.warn(' selectedTask no encontrado, creando uno temporal...');\n            currentSelectedTask = {\n              id: crypto.randomUUID(),\n              name: 'Tarea Temporal',\n              successors: [],\n              predecessors: []\n            };\n            console.warn(' selectedTask temporal creado:', currentSelectedTask.id);\n          }\n\n          // VERIFICACIN EXTRA: Asegurar que currentSelectedTask tenga las propiedades necesarias\n          if (!currentSelectedTask.successors) {\n            currentSelectedTask.successors = [];\n            console.warn(' currentSelectedTask.successors inicializado como array vaco');\n          }\n          if (!currentSelectedTask.predecessors) {\n            currentSelectedTask.predecessors = [];\n            console.warn(' currentSelectedTask.predecessors inicializado como array vaco');\n          }\n\n          // VERIFICACIN FINAL: Asegurar que currentSelectedTask tenga un ID vlido\n          if (!currentSelectedTask.id) {\n            currentSelectedTask.id = crypto.randomUUID();\n            console.warn(' currentSelectedTask.id inicializado como:', currentSelectedTask.id);\n          }\n\n          // VERIFICACIN EXTRA: Asegurar que currentSelectedTask tenga un nombre vlido\n          if (!currentSelectedTask.name) {\n            currentSelectedTask.name = 'Tarea Temporal';\n            console.warn(' currentSelectedTask.name inicializado como:', currentSelectedTask.name);\n          }\n\n          if (taskId && currentSelectedTask && !currentSelectedTask.successors.includes(taskId)) {\n            const newSuccs = currentSelectedTask.successors.slice().concat([taskId]);\n            console.log(' Agregando sucesora desde delegation:', {\n              tarea: currentSelectedTask.id,\n              nuevaSucesora: taskId,\n              sucesorasAntes: currentSelectedTask.successors,\n              sucesorasDespues: newSuccs\n            });\n\n            // Actualizar el estado local\n            const updatedTask = {\n              id: currentSelectedTask.id,\n              wbsCode: currentSelectedTask.wbsCode,\n              name: currentSelectedTask.name,\n              duration: currentSelectedTask.duration,\n              startDate: currentSelectedTask.startDate,\n              endDate: currentSelectedTask.endDate,\n              progress: currentSelectedTask.progress,\n              predecessors: [...(currentSelectedTask.predecessors || [])],\n              cost: currentSelectedTask.cost,\n              priority: currentSelectedTask.priority,\n              assignedTo: currentSelectedTask.assignedTo,\n              isMilestone: currentSelectedTask.isMilestone,\n              isCritical: currentSelectedTask.isCritical,\n              originalDuration: currentSelectedTask.originalDuration,\n              earlyStart: currentSelectedTask.earlyStart,\n              earlyFinish: currentSelectedTask.earlyFinish,\n              lateStart: currentSelectedTask.lateStart,\n              lateFinish: currentSelectedTask.lateFinish,\n              totalFloat: currentSelectedTask.totalFloat,\n              freeFloat: currentSelectedTask.freeFloat,\n              description: currentSelectedTask.description,\n              resources: [...(currentSelectedTask.resources || [])],\n              workPackageId: currentSelectedTask.workPackageId,\n              status: currentSelectedTask.status,\n              successors: newSuccs\n            };\n            // ACTUALIZAR SOLO EL ESTADO GLOBAL - NO setSelectedTask para evitar duplicacin\n            setTasks(prev => {\n              const updated = prev.map(t => {\n                if (t.id === currentSelectedTask.id) {\n                  return updatedTask;\n                }\n                if (t.id === taskId) {\n                  // Agregar esta tarea como predecesora de la sucesora\n                  return {\n                    id: t.id,\n                    wbsCode: t.wbsCode,\n                    name: t.name,\n                    duration: t.duration,\n                    startDate: t.startDate,\n                    endDate: t.endDate,\n                    progress: t.progress,\n                    predecessors: [...(t.predecessors || []), currentSelectedTask.id],\n                    cost: t.cost,\n                    priority: t.priority,\n                    assignedTo: t.assignedTo,\n                    isMilestone: t.isMilestone,\n                    isCritical: t.isCritical,\n                    originalDuration: t.originalDuration,\n                    earlyStart: t.earlyStart,\n                    earlyFinish: t.earlyFinish,\n                    lateStart: t.lateStart,\n                    lateFinish: t.lateFinish,\n                    totalFloat: t.totalFloat,\n                    freeFloat: t.freeFloat,\n                    description: t.description,\n                    resources: [...(t.resources || [])],\n                    workPackageId: t.workPackageId,\n                    status: t.status,\n                    successors: [...(t.successors || [])]\n                  };\n                }\n                return t;\n              });\n\n              // Actualizar selectedTask con la tarea actualizada del estado global\n              const updatedSelectedTask = updated.find(t => t.id === currentSelectedTask.id);\n              if (updatedSelectedTask) {\n                setSelectedTask(updatedSelectedTask);\n              }\n\n              return updated;\n            });\n\n            // NO limpiar el select si ya se proces correctamente\n            // e.target.value = '';\n            console.log(' SUCESORA AGREGADA EXITOSAMENTE - timestamp:', new Date().toISOString());\n          } else {\n            console.warn(' CONDICIONES NO CUMPLIDAS PARA SUCESORA:', {\n              taskId: !!taskId,\n              currentSelectedTask: !!currentSelectedTask,\n              notIncluded: !currentSelectedTask?.successors?.includes(taskId)\n            });\n          }\n\n          // Limpiar el flag de procesamiento\n          e.target.dataset.processing = 'false';\n        } else {\n          console.warn(' VALOR VACO O INVLIDO:', actualValue);\n        }\n      }\n    };\n\n    // Agregar event listener al documento\n    document.addEventListener('change', handleGlobalChange);\n    document.addEventListener('input', handleGlobalChange);\n    document.addEventListener('click', handleGlobalChange);\n\n    // Log de confirmacin\n    console.log(' EVENT LISTENERS AGREGADOS AL DOCUMENTO');\n\n    // Funcin de logs removida por seguridad\n\n    return () => {\n      document.removeEventListener('change', handleGlobalChange);\n      document.removeEventListener('input', handleGlobalChange);\n      document.removeEventListener('click', handleGlobalChange);\n      /* eslint-enable no-unreachable */\n    };\n  }, []); // CORRECCIN: Remover dependencias que causan bucle infinito\n\n  // Funcin para actualizar datos del proyecto (ya no se usa)\n  const updateBusinessCase = useCallback((field, value) => {\n    // Esta funcin ya no se usa, pero se mantiene por compatibilidad\n    console.log('updateBusinessCase called:', field, value);\n  }, []);\n\n  // Importar desde Excel\n  const handleFileUpload = async (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    try {\n      const data = await file.arrayBuffer();\n      const workbook = XLSX.read(data, { type: 'array' });\n      const sheetName = workbook.SheetNames[0];\n      const sheet = workbook.Sheets[sheetName];\n      const rows = XLSX.utils.sheet_to_json(sheet, { defval: '' });\n\n      const normalizeKey = (k) => String(k).trim().toLowerCase();\n\n      const imported = rows.map((r, idx) => {\n        const obj = {};\n        for (const k in r) obj[normalizeKey(k)] = r[k];\n\n        const id = obj['id'] || `T${String(idx + 1).padStart(3, '0')}`;\n        const wbs = obj['wbs'] || `1.${idx + 1}`;\n        const name = obj['name'] || obj['tarea'] || `Tarea ${idx + 1}`;\n        const duration = Number.isFinite(Number(obj['duration'])) ? Math.max(0, Math.round(Number(obj['duration']))) : 0;\n        const start = obj['startdate'] ? parseExcelDate(obj['startdate']) : toISO(new Date());\n        const end = obj['enddate'] ? parseExcelDate(obj['enddate']) : addDays(start, duration, includeWeekends);\n        const progress = Number.isFinite(Number(obj['progress'])) ? Math.min(100, Math.max(0, Math.round(Number(obj['progress'])))) : 0;\n        const predecessors = String(obj['predecessors'] || obj['predecesoras'] || '').split(',').map((s) => s.trim()).filter(Boolean);\n        const resources = String(obj['resources'] || '').split(',').map((s) => s.trim()).filter(Boolean);\n        const cost = Number.isFinite(Number(obj['cost'])) ? Number(obj['cost']) : 0;\n        const businessValue = Number.isFinite(Number(obj['businessvalue'] || obj['valor de negocio'])) ? Number(obj['businessvalue'] || obj['valor de negocio']) : 0;\n        const isMilestone = String(obj['ismilestone']).toLowerCase() === 'true' || duration === 0;\n        const status = obj['status'] || 'pending';\n\n        return {\n          id,\n          wbsCode: wbs,\n          name,\n          duration,\n          startDate: start,\n          endDate: end,\n          progress,\n          predecessors,\n          successors: [],\n          resources,\n          cost,\n          businessValue,\n          isMilestone,\n          isCritical: false,\n          earlyStart: start,\n          earlyFinish: end,\n          lateStart: start,\n          lateFinish: end,\n          totalFloat: 0,\n          freeFloat: 0,\n          status,\n        };\n      });\n\n      const mapById = new Map(imported.map((t) => [t.id, t]));\n      for (const t of imported) {\n        for (const pred of t.predecessors) {\n          const predTask = mapById.get(pred);\n          if (predTask && !predTask.successors.includes(t.id)) predTask.successors.push(t.id);\n        }\n      }\n\n      // Aplicar ordenamiento por wbsCode antes de importar\n      const sortedImported = sortTasksByWbsCode(imported);\n      console.log(' IMPORTACIN - Tareas ordenadas por wbsCode:', sortedImported.map(t => ({ name: t.name, wbsCode: t.wbsCode })));\n\n      if (typeof importTasks === 'function') {\n        importTasks(sortedImported);\n        console.log(' IMPORTACIN ANTIGUA - importTasks llamado exitosamente');\n      } else {\n        setTasks(sortedImported);\n        console.log(' IMPORTACIN ANTIGUA - setTasks llamado como fallback');\n      }\n      setBaselineTasks([]);\n      setShowBaseline(false);\n      alert('Tareas importadas desde Excel con xito');\n    } catch (err) {\n      console.error(err);\n      alert('No se pudo importar el archivo. Verifica el formato.');\n    }\n  };\n\n  // Exportar a Excel\n  const exportToExcel = useCallback(() => {\n    const exportData = tasksWithCPM.map(task => ({\n      ID: task.id,\n      WBS: task.wbsCode,\n      Name: task.name,\n      Duration: task.duration,\n      StartDate: task.startDate,\n      EndDate: task.endDate,\n      Progress: task.progress,\n      //  FIX: Convertir IDs de predecesoras a wbsCode legibles\n      Predecessors: task.predecessors?.map(predId => {\n        const predTask = tasksWithCPM.find(t => t.id === predId);\n        return predTask ? predTask.wbsCode : predId;\n      }).join(', ') || '',\n      Resources: task.resources.join(', '),\n      Cost: task.cost,\n      BusinessValue: task.businessValue || 0,\n      IsMilestone: task.isMilestone,\n      IsCritical: task.isCritical,\n      Status: task.status,\n      EarlyStart: task.earlyStart,\n      EarlyFinish: task.earlyFinish,\n      LateStart: task.lateStart,\n      LateFinish: task.lateFinish,\n      TotalFloat: task.totalFloat,\n      FreeFloat: task.freeFloat\n    }));\n\n    const ws = XLSX.utils.json_to_sheet(exportData);\n    const wb = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(wb, ws, 'Cronograma');\n\n    const businessData = [\n      ['Campo', 'Valor'],\n      ['Nombre del Proyecto', businessCase.projectName],\n      ['Objetivo', businessCase.objective],\n      ['Patrocinador', businessCase.sponsor],\n      ['Gerente del Proyecto', businessCase.manager],\n      ['Inversin Total', businessCase.totalInvestment],\n      ['Beneficios Esperados', businessCase.expectedBenefits],\n      ['TIR (%)', businessCase.irr],\n      ['ROI (%)', businessCase.roi],\n      ['Tiempo de Retorno (aos)', businessCase.paybackPeriod],\n      ['VPN', businessCase.npv]\n    ];\n    const wsBC = XLSX.utils.aoa_to_sheet(businessData);\n    XLSX.utils.book_append_sheet(wb, wsBC, 'Caso de Negocio');\n\n    XLSX.writeFile(wb, `${projectData.projectName}-${new Date().toISOString().split('T')[0]}.xlsx`);\n  }, [tasksWithCPM, projectData]);\n\n  // Exportar cronograma a Excel\n  const exportScheduleToExcel = useCallback(() => {\n    const wb = XLSX.utils.book_new();\n\n    //  DEBUG: Verificar nombres de tareas antes de exportar\n    console.log(' DEBUG - Exportando tareas a Excel:');\n    console.log('Total tareas:', tasksWithCPM.length);\n    console.log('Primeras 3 tareas:', tasksWithCPM.slice(0, 3).map(t => ({\n      name: t.name,\n      wbsCode: t.wbsCode,\n      hasName: !!t.name\n    })));\n\n    // Preparar datos del cronograma\n    const scheduleData = [\n      ['#', 'Tarea', 'Duracin', 'Inicio', 'Fin', 'Progreso (%)', 'Prioridad', 'Asignado', 'Costo', 'Valor de Negocio', 'Predecesoras', 'Hito', 'Crtica', 'Ruta Crtica']\n    ];\n\n    tasksWithCPM.forEach((task, index) => {\n      //  FIX: Convertir IDs de predecesoras a wbsCode legibles\n      const predecessorsText = task.predecessors?.map(predId => {\n        const predTask = tasksWithCPM.find(t => t.id === predId);\n        return predTask ? predTask.wbsCode : predId;\n      }).join(', ') || 'Sin';\n\n      scheduleData.push([\n        index + 1,\n        task.name,\n        `${task.duration}d`,\n        task.startDate,\n        task.endDate,\n        task.progress || 0,\n        task.priority || 'Media',\n        task.assignedTo || 'Sin asignar',\n        task.cost || 0,\n        task.businessValue || 0,\n        predecessorsText,\n        task.isMilestone ? 'S' : 'No',\n        task.isCritical ? 'S' : 'No',\n        task.isCritical ? 'S' : 'No'\n      ]);\n    });\n\n    const ws = XLSX.utils.aoa_to_sheet(scheduleData);\n\n    // Ajustar ancho de columnas\n    const colWidths = [\n      { wch: 5 },   // #\n      { wch: 40 },  // Tarea\n      { wch: 10 },  // Duracin\n      { wch: 12 },  // Inicio\n      { wch: 12 },  // Fin\n      { wch: 12 },  // Progreso\n      { wch: 12 },  // Prioridad\n      { wch: 20 },  // Asignado\n      { wch: 12 },  // Costo\n      { wch: 15 },  // Valor de Negocio\n      { wch: 30 },  // Predecesoras\n      { wch: 8 },   // Hito\n      { wch: 8 },   // Crtica\n      { wch: 12 }   // Ruta Crtica\n    ];\n    ws['!cols'] = colWidths;\n\n    XLSX.utils.book_append_sheet(wb, ws, 'Cronograma');\n\n    // Agregar hoja de resumen del proyecto\n    const summaryData = [\n      ['INFORMACIN DEL PROYECTO'],\n      ['Nombre del Proyecto', projectData.projectName],\n      ['Fecha de Inicio', projectData.startDate],\n      ['Fecha de Fin', projectData.endDate],\n      ['Presupuesto Total', projectData.totalBudget],\n      [''],\n      ['ESTADSTICAS DEL CRONOGRAMA'],\n      ['Total de Tareas', tasksWithCPM.length],\n      ['Tareas Crticas', tasksWithCPM.filter(t => t.isCritical).length],\n      ['Hitos', tasksWithCPM.filter(t => t.isMilestone).length],\n      ['Duracin Total (das)', Math.max(...tasksWithCPM.map(t => new Date(t.endDate).getTime())) - Math.min(...tasksWithCPM.map(t => new Date(t.startDate).getTime())) / (1000 * 60 * 60 * 24)],\n      [''],\n      ['FECHA DE EXPORTACIN'],\n      ['Exportado el', new Date().toLocaleString('es-ES')]\n    ];\n\n    const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);\n    wsSummary['!cols'] = [{ wch: 25 }, { wch: 30 }];\n    XLSX.utils.book_append_sheet(wb, wsSummary, 'Resumen');\n\n    XLSX.writeFile(wb, `Cronograma-${projectData.projectName}-${new Date().toISOString().split('T')[0]}.xlsx`);\n  }, [tasksWithCPM, projectData]);\n\n\n  // Cargar proyecto\n  const loadProject = useCallback((e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = (event) => {\n      try {\n        const loadedProjectData = JSON.parse(event.target.result);\n\n        if (loadedProjectData.tasks) setTasks(loadedProjectData.tasks);\n        if (loadedProjectData.baseline) setBaselineTasks(loadedProjectData.baseline);\n        if (loadedProjectData.settings) {\n          setViewMode(loadedProjectData.settings.viewMode || 'excel');\n          setGanttScale(loadedProjectData.settings.ganttScale || 'days');\n          setShowCriticalPath(loadedProjectData.settings.showCriticalPath ?? true);\n          setShowDependencies(loadedProjectData.settings.showDependencies ?? true);\n          setShowBaseline(loadedProjectData.settings.showBaseline ?? false);\n        }\n\n        alert('Proyecto cargado exitosamente');\n      } catch (error) {\n        alert('Error al cargar el proyecto. Verifica el formato del archivo.');\n      }\n    };\n    reader.readAsText(file);\n  }, []);\n\n  // Fechas del proyecto - USAR FECHAS ORIGINALES DE LA TABLA\n  const projectDates = useMemo(() => {\n    if (tasks.length === 0) return { start: new Date(), end: new Date() };\n    // USAR tasks (fechas originales) en lugar de tasksWithCPM (fechas procesadas por CPM)\n    const dates = tasks.flatMap((t) => [new Date(t.startDate), new Date(t.endDate)]);\n    const result = {\n      start: new Date(Math.min(...dates.map((d) => d.getTime()))),\n      end: new Date(Math.max(...dates.map((d) => d.getTime()))),\n    };\n\n    // Debug temporal para verificar el rango del proyecto\n    console.log(' PROJECT DATES CALCULADO (FECHAS ORIGINALES):', {\n      start: toISO(result.start),\n      end: toISO(result.end),\n      totalTasks: tasks.length,\n      firstTaskDate: tasks[0]?.startDate,\n      lastTaskDate: tasks[tasks.length - 1]?.endDate,\n      allStartDates: tasks.map(t => t.startDate),\n      minStartDate: Math.min(...tasks.map(t => new Date(t.startDate).getTime())),\n      minStartDateISO: toISO(new Date(Math.min(...tasks.map(t => new Date(t.startDate).getTime()))))\n    });\n\n    return result;\n  }, [tasks]); // Cambiar dependencia de tasksWithCPM a tasks\n\n  const totalDays = useMemo(() => {\n    const pStart = toISO(projectDates.start);\n    const pEnd = toISO(projectDates.end);\n    return Math.max(1, diffDaysExclusive(pStart, addDays(pEnd, 1, includeWeekends), includeWeekends));\n  }, [projectDates]);\n\n  // Escalado por das/semanas/meses\n  const pxPerDay = useMemo(() => {\n    switch (ganttScale) {\n      case 'days':\n        return 28; // Restaurado para mantener funcionalidad\n      case 'weeks':\n        return 10; // Restaurado\n      case 'months':\n        return 4;  // Restaurado\n      default:\n        return 20; // Restaurado\n    }\n  }, [ganttScale]);\n\n  const chartWidthPx = useMemo(() => totalDays * pxPerDay, [totalDays, pxPerDay]);\n\n  // Mtricas del proyecto\n  const projectMetrics = useMemo(() => {\n    const criticalTasks = tasksWithCPM.filter((t) => t.isCritical).length;\n    const completedTasks = tasksWithCPM.filter((t) => t.progress === 100).length;\n    const totalCost = tasksWithCPM.reduce((sum, t) => sum + t.cost, 0);\n\n    const todayISO = toISO(new Date());\n    const PV = tasksWithCPM.reduce((s, t) => {\n      const dur = Math.max(1, durationDaysInclusive(t.startDate, t.endDate, includeWeekends));\n      const elapsed = clamp01(diffDaysExclusive(t.startDate, todayISO, includeWeekends) / dur);\n      return s + t.cost * elapsed;\n    }, 0);\n\n    const EV = tasksWithCPM.reduce((s, t) => s + t.cost * (t.progress / 100), 0);\n    const AC = EV;\n\n    const spi = PV > 0 ? EV / PV : 1;\n    const cpi = AC > 0 ? EV / AC : 1;\n\n    const progressPercentage = tasksWithCPM.length > 0 ? (completedTasks / tasksWithCPM.length) * 100 : 0;\n    const investmentToDate = totalCost;\n    const projectedROI = projectData.totalBudget > 0 ?\n      ((totalCost / projectData.totalBudget) * 100) : 0;\n\n    return {\n      totalTasks: tasksWithCPM.length,\n      criticalTasks,\n      completedTasks,\n      totalCost,\n      earnedValue: Math.round(EV),\n      plannedValue: Math.round(PV),\n      spi: spi.toFixed(2),\n      cpi: cpi.toFixed(2),\n      progressPercentage: progressPercentage.toFixed(1),\n      investmentToDate,\n      projectedROI: projectedROI.toFixed(1)\n    };\n  }, [tasksWithCPM, projectData]);\n\n  // SISTEMA COMPLETAMENTE NUEVO PARA AGREGAR TAREAS\n  const [showAddTaskModal, setShowAddTaskModal] = useState(false);\n  const [newTaskData, setNewTaskData] = useState({\n    name: '',\n    duration: 5,\n    startDate: toISO(new Date()),\n    endDate: addDays(toISO(new Date()), 5),\n    description: '',\n    priority: 'medium',\n    assignedTo: '',\n    cost: 0,\n    businessValue: 0,  //  NUEVO: Valor de negocio de la tarea\n    selectedPredecessors: []\n  });\n\n  // Funcin para sincronizar dependencias bidireccionalmente (SOLO PREDECESORAS)\n  const syncDependencies = (taskId, predecessors, successors) => {\n    setTasks(prev => {\n      return prev.map(task => {\n        // Si es la tarea que estamos editando, actualizar sus dependencias\n        if (task.id === taskId) {\n          return {\n            id: task.id,\n            wbsCode: task.wbsCode,\n            name: task.name,\n            duration: task.duration,\n            startDate: task.startDate,\n            endDate: task.endDate,\n            progress: task.progress,\n            predecessors: [...(predecessors || [])],\n            cost: task.cost,\n            priority: task.priority,\n            assignedTo: task.assignedTo,\n            isMilestone: task.isMilestone,\n            isCritical: task.isCritical,\n            originalDuration: task.originalDuration,\n            earlyStart: task.earlyStart,\n            earlyFinish: task.earlyFinish,\n            lateStart: task.lateStart,\n            lateFinish: task.lateFinish,\n            totalFloat: task.totalFloat,\n            freeFloat: task.freeFloat,\n            description: task.description,\n            resources: [...(task.resources || [])],\n            workPackageId: task.workPackageId,\n            status: task.status,\n            successors: [] // Limpiar sucesoras\n          };\n        }\n\n        // Para todas las dems tareas, actualizar sus dependencias inversas\n        let updatedTask = {\n          id: task.id,\n          wbsCode: task.wbsCode,\n          name: task.name,\n          duration: task.duration,\n          startDate: task.startDate,\n          endDate: task.endDate,\n          progress: task.progress,\n          predecessors: [...(task.predecessors || [])],\n          cost: task.cost,\n          priority: task.priority,\n          assignedTo: task.assignedTo,\n          isMilestone: task.isMilestone,\n          isCritical: task.isCritical,\n          originalDuration: task.originalDuration,\n          earlyStart: task.earlyStart,\n          earlyFinish: task.earlyFinish,\n          lateStart: task.lateStart,\n          lateFinish: task.lateFinish,\n          totalFloat: task.totalFloat,\n          freeFloat: task.freeFloat,\n          description: task.description,\n          resources: [...(task.resources || [])],\n          workPackageId: task.workPackageId,\n          status: task.status,\n          successors: [...(task.successors || [])]\n        };\n\n        // Si esta tarea est en las predecesoras de la tarea editada,\n        // agregar la tarea editada a sus sucesoras\n        if (predecessors.includes(task.id)) {\n          if (!updatedTask.successors.includes(taskId)) {\n            updatedTask.successors = updatedTask.successors.slice().concat([taskId]);\n          }\n        } else {\n          // Si no est en las predecesoras, remover de sucesoras\n          updatedTask.successors = updatedTask.successors.filter(id => id !== taskId);\n        }\n\n        return updatedTask;\n      });\n    });\n  };\n\n  // Funcin principal para agregar tarea - COMPLETAMENTE REDISEADA\n  const addTask = () => {\n    console.log(' NUEVO SISTEMA - Abriendo modal para agregar tarea');\n    console.log(' NUEVO SISTEMA - Tareas disponibles:', tasks.map(t => ({ id: t.id, wbsCode: t.wbsCode, name: t.name })));\n    setNewTaskData({\n      name: '',\n      duration: 5,\n      startDate: toISO(new Date()),\n      endDate: addDays(toISO(new Date()), 5),\n      description: '',\n      priority: 'medium',\n      assignedTo: '',\n      cost: 0,\n      selectedPredecessors: [],\n      selectedSuccessors: []\n    });\n    setShowAddTaskModal(true);\n  };\n\n  // NUEVA FUNCIN: Generar archivo Excel de ejemplo\n  const generateExampleExcel = () => {\n    console.log(' GENERANDO ARCHIVO EXCEL DE EJEMPLO');\n\n    // Datos de ejemplo con hitos\n    const exampleData = [\n      // Encabezados\n      ['#', 'Nombre', 'Duracin', 'Inicio', 'Fin', 'Progreso', 'Prioridad', 'Asignado', 'Costo', 'Predecesoras', 'Hitos'],\n      // Tareas normales\n      [1, 'Inicio del Proyecto', 0, '2024-01-01', '2024-01-01', 100, 'Alta', 'PM', 0, '', 'S'],\n      [2, 'Anlisis de Requisitos', 5, '2024-01-02', '2024-01-08', 80, 'Alta', 'Analista', 5000, '1', 'No'],\n      [3, 'Diseo del Sistema', 7, '2024-01-09', '2024-01-17', 60, 'Alta', 'Arquitecto', 8000, '2', 'No'],\n      [4, 'Aprobacin del Diseo', 0, '2024-01-18', '2024-01-18', 0, 'Alta', 'Cliente', 0, '3', 'S'],\n      [5, 'Desarrollo Frontend', 10, '2024-01-19', '2024-01-30', 40, 'Media', 'Dev Frontend', 12000, '4', 'No'],\n      [6, 'Desarrollo Backend', 12, '2024-01-22', '2024-02-06', 30, 'Media', 'Dev Backend', 15000, '4', 'No'],\n      [7, 'Integracin', 3, '2024-02-07', '2024-02-11', 0, 'Alta', 'Dev Lead', 3000, '5,6', 'No'],\n      [8, 'Pruebas Unitarias', 4, '2024-02-12', '2024-02-17', 0, 'Media', 'QA', 2000, '7', 'No'],\n      [9, 'Pruebas de Integracin', 0, '2024-02-18', '2024-02-18', 0, 'Alta', 'QA Lead', 0, '8', 'S'],\n      [10, 'Despliegue en Produccin', 2, '2024-02-19', '2024-02-22', 0, 'Alta', 'DevOps', 1000, '9', 'No'],\n      [11, 'Cierre del Proyecto', 0, '2024-02-23', '2024-02-23', 0, 'Alta', 'PM', 0, '10', 'S']\n    ];\n\n    // Crear workbook\n    const workbook = XLSX.utils.book_new();\n    const worksheet = XLSX.utils.aoa_to_sheet(exampleData);\n\n    // Ajustar ancho de columnas\n    const colWidths = [\n      { wch: 5 },   // #\n      { wch: 25 },  // Nombre\n      { wch: 10 },  // Duracin\n      { wch: 12 },  // Inicio\n      { wch: 12 },  // Fin\n      { wch: 10 },  // Progreso\n      { wch: 12 },  // Prioridad\n      { wch: 15 },  // Asignado\n      { wch: 10 },  // Costo\n      { wch: 15 },  // Predecesoras\n      { wch: 8 }    // Hitos\n    ];\n    worksheet['!cols'] = colWidths;\n\n    // Agregar hoja al workbook\n    XLSX.utils.book_append_sheet(workbook, worksheet, 'Cronograma');\n\n    // Generar archivo y descargar\n    const fileName = `Cronograma_Ejemplo_${new Date().toISOString().split('T')[0]}.xlsx`;\n    XLSX.writeFile(workbook, fileName);\n\n    console.log(' Archivo Excel de ejemplo generado:', fileName);\n  };\n\n  // NUEVA FUNCIN: Importar cronograma completo desde Excel\n  const importScheduleFromExcel = (file) => {\n    console.log(' IMPORTANDO CRONOGRAMA COMPLETO desde:', file.name);\n    console.log(' Tamao del archivo:', file.size, 'bytes');\n    console.log(' Tipo de archivo:', file.type);\n\n    // Validar que el archivo existe y es vlido\n    if (!file) {\n      alert(' No se seleccion ningn archivo');\n      return;\n    }\n\n    // Validar tamao del archivo (mximo 10MB)\n    if (file.size > 10 * 1024 * 1024) {\n      alert(' El archivo es demasiado grande. El tamao mximo es 10MB');\n      return;\n    }\n\n    // Validar que el archivo no est vaco\n    if (file.size === 0) {\n      alert(' El archivo est vaco');\n      return;\n    }\n\n    // Validar tipo de archivo\n    if (!file.type.includes('sheet') && !file.type.includes('excel') && !file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {\n      alert(' Por favor selecciona un archivo Excel vlido (.xlsx o .xls)');\n      return;\n    }\n\n    console.log(' Validaciones de archivo pasadas, iniciando lectura...');\n\n    // NUEVO ENFOQUE: Usar fetch con URL.createObjectURL\n    try {\n      const fileUrl = URL.createObjectURL(file);\n      console.log(' URL del archivo creada:', fileUrl);\n\n      fetch(fileUrl)\n        .then(response => {\n          console.log(' Fetch response status:', response.status);\n          if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n          }\n          return response.arrayBuffer();\n        })\n        .then(arrayBuffer => {\n          console.log(' ArrayBuffer recibido, tamao:', arrayBuffer.byteLength);\n\n          try {\n            const data = new Uint8Array(arrayBuffer);\n            console.log(' Datos convertidos a Uint8Array, tamao:', data.length);\n\n            if (data.length === 0) {\n              throw new Error('El archivo est vaco');\n            }\n\n            const workbook = XLSX.read(data, { type: 'array' });\n            console.log(' Workbook creado exitosamente, hojas disponibles:', workbook.SheetNames);\n\n            // Usar la funcin auxiliar para procesar el workbook\n            processWorkbook(workbook);\n\n            // Limpiar la URL del objeto\n            URL.revokeObjectURL(fileUrl);\n\n          } catch (processingError) {\n            console.error(' Error procesando datos:', processingError);\n            URL.revokeObjectURL(fileUrl);\n            alert(' No se pudo procesar el archivo Excel. Verifica que el archivo no est corrupto y que sea un formato vlido (.xlsx o .xls).');\n          }\n        })\n        .catch(fetchError => {\n          console.error(' Error en fetch:', fetchError);\n          URL.revokeObjectURL(fileUrl);\n\n          // FALLBACK: Intentar con FileReader como ltimo recurso\n          console.log(' Intentando fallback con FileReader...');\n          tryFileReaderFallback(file);\n        });\n\n    } catch (urlError) {\n      console.error(' Error creando URL del objeto:', urlError);\n      // FALLBACK: Intentar con FileReader como ltimo recurso\n      console.log(' Intentando fallback con FileReader...');\n      tryFileReaderFallback(file);\n    }\n  };\n\n  // Funcin fallback con FileReader\n  const tryFileReaderFallback = (file) => {\n    console.log(' FALLBACK: Intentando con FileReader...');\n\n    const reader = new FileReader();\n\n    reader.onload = (e) => {\n      try {\n        console.log(' FileReader fallback: datos recibidos');\n        const data = new Uint8Array(e.target.result);\n        console.log(' Datos convertidos a Uint8Array, tamao:', data.length);\n\n        if (data.length === 0) {\n          throw new Error('El archivo est vaco');\n        }\n\n        const workbook = XLSX.read(data, { type: 'array' });\n        console.log(' Workbook creado exitosamente en fallback');\n        processWorkbook(workbook);\n\n      } catch (processingError) {\n        console.error(' Error procesando en fallback:', processingError);\n        alert(' No se pudo procesar el archivo Excel. Verifica que el archivo no est corrupto y que sea un formato vlido (.xlsx o .xls).');\n      }\n    };\n\n    reader.onerror = (error) => {\n      console.error(' Error en FileReader fallback:', error);\n      console.error(' Detalles del error fallback:', error.target?.error);\n      alert(' No se pudo leer el archivo con ningn mtodo. Por favor intenta con otro archivo o verifica que no est corrupto.');\n    };\n\n    // Intentar leer como DataURL (ms compatible)\n    reader.readAsDataURL(file);\n  };\n\n  // Funcin auxiliar para procesar el workbook\n  const processWorkbook = (workbook) => {\n    try {\n      console.log(' Procesando workbook, hojas disponibles:', workbook.SheetNames);\n\n      const worksheet = workbook.Sheets[workbook.SheetNames[0]];\n      const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });\n      console.log(' Datos convertidos a JSON, filas:', jsonData.length);\n\n      console.log(' Datos Excel importados:', jsonData);\n\n      if (jsonData.length < 2) {\n        alert('El archivo Excel debe tener al menos una fila de encabezados y una fila de datos');\n        return;\n      }\n\n      // Obtener encabezados (primera fila)\n      const headers = jsonData[0];\n      console.log(' Encabezados encontrados:', headers);\n\n      // Mapear columnas a ndices\n      const columnMap = {\n        //  FIX: Aceptar tanto \"Tarea\" como \"Nombre\" para la columna de nombres\n        nombre: headers.findIndex(h => {\n          const headerLower = h?.toString().toLowerCase();\n          return headerLower?.includes('nombre') || headerLower?.includes('tarea');\n        }),\n        duracion: headers.findIndex(h => h && h.toString().toLowerCase().includes('duraci')),\n        inicio: headers.findIndex(h => h && h.toString().toLowerCase().includes('inicio')),\n        fin: headers.findIndex(h => h && h.toString().toLowerCase().includes('fin')),\n        progreso: headers.findIndex(h => h && h.toString().toLowerCase().includes('progreso')),\n        prioridad: headers.findIndex(h => h && h.toString().toLowerCase().includes('prioridad')),\n        asignado: headers.findIndex(h => h && h.toString().toLowerCase().includes('asignado')),\n        costo: headers.findIndex(h => h && h.toString().toLowerCase().includes('costo')),\n        businessValue: headers.findIndex(h => {\n          const headerLower = h?.toString().toLowerCase();\n          return headerLower?.includes('valor') && headerLower?.includes('negocio');\n        }),\n        predecesoras: headers.findIndex(h => h && h.toString().toLowerCase().includes('predecesor')),\n        hitos: headers.findIndex(h => h && h.toString().toLowerCase().includes('hito'))\n      };\n\n      console.log(' Mapeo de columnas:', columnMap);\n\n      // Procesar datos (saltar encabezados)\n      const newTasks = [];\n      const fileTimestamp = new Date().toISOString(); // Timestamp fijo para todas las tareas del archivo\n\n      for (let i = 1; i < jsonData.length; i++) {\n        const row = jsonData[i];\n        if (!row || row.every(cell => !cell)) continue; // Saltar filas vacas\n\n        const duration = parseInt(row[columnMap.duracion]) || 5;\n\n        // Determinar si es hito: por duracin = 0 O por campo explcito \"Hitos\"\n        let isMilestone = duration === 0;\n        if (columnMap.hitos !== -1 && row[columnMap.hitos]) {\n          const hitoValue = row[columnMap.hitos].toString().toLowerCase().trim();\n          isMilestone = hitoValue === 's' || hitoValue === 'si' || hitoValue === 'yes' || hitoValue === '1' || hitoValue === 'true';\n        }\n\n        // Funcin helper para procesar fechas de forma segura\n        const parseDate = (dateValue) => {\n          if (!dateValue) return new Date().toISOString().split('T')[0];\n\n          if (typeof dateValue === 'number') {\n            try {\n              return XLSX.SSF.parse_date_code(dateValue);\n            } catch (error) {\n              console.warn('Error parsing date code:', dateValue, error);\n              return new Date().toISOString().split('T')[0];\n            }\n          }\n\n          try {\n            const date = new Date(dateValue);\n            if (isNaN(date.getTime())) {\n              console.warn('Invalid date value:', dateValue);\n              return new Date().toISOString().split('T')[0];\n            }\n            return date.toISOString().split('T')[0];\n          } catch (error) {\n            console.warn('Error parsing date:', dateValue, error);\n            return new Date().toISOString().split('T')[0];\n          }\n        };\n\n        const startDate = parseDate(row[columnMap.inicio]);\n        const endDate = isMilestone ? startDate : parseDate(row[columnMap.fin]);\n\n        // Validar y sanitizar datos de entrada\n        const rawName = row[columnMap.nombre] || `Tarea ${i}`;\n        const nameValidation = validateTaskName(rawName);\n        if (!nameValidation.valid) {\n          console.error(` Error en fila ${i + 1}: ${nameValidation.error}`);\n          continue; // Saltar esta fila si el nombre es invlido\n        }\n\n        const durationValidation = validateDuration(duration);\n        if (!durationValidation.valid) {\n          console.error(` Error en fila ${i + 1}: ${durationValidation.error}`);\n          continue; // Saltar esta fila si la duracin es invlida\n        }\n\n        const startValidation = validateDate(startDate);\n        if (!startValidation.valid) {\n          console.error(` Error en fila ${i + 1}: ${startValidation.error}`);\n          continue; // Saltar esta fila si la fecha es invlida\n        }\n\n        const task = {\n          id: crypto.randomUUID(), // Ya corregido anteriormente\n          wbsCode: `${i}`,\n          name: nameValidation.sanitized,\n          duration: isMilestone ? 0 : Math.max(1, durationDaysInclusive(startDate, endDate, includeWeekends)),\n          startDate: startValidation.value,\n          endDate: endDate,\n          progress: Math.max(0, Math.min(100, parseInt(row[columnMap.progreso]) || 0)), // Limitar 0-100\n          priority: sanitizeInput(row[columnMap.prioridad] || 'medium'),\n          assignedTo: sanitizeInput(row[columnMap.asignado] || ''),\n          cost: Math.max(0, parseFloat(row[columnMap.costo]) || 0), // Solo valores positivos\n          businessValue: Math.max(0, parseFloat(row[columnMap.businessValue]) || 0), //  Valor de negocio\n          predecessors: [],\n          successors: [],\n          isMilestone: isMilestone,\n          originalDuration: isMilestone ? 1 : duration, // Para hitos, guardar 1 como original\n          description: '',\n          resources: [], // Agregar propiedad resources vaca\n          status: 'pending' // Agregar status por defecto\n        };\n\n        // Procesar predecesoras si existen - USAR wbsCode COMO REFERENCIA\n        if (row[columnMap.predecesoras]) {\n          const predStr = row[columnMap.predecesoras].toString();\n          console.log(` Procesando predecesoras para tarea ${i}: \"${predStr}\"`);\n\n          // Dividir por comas y procesar nmeros de wbsCode\n          const predValues = predStr.split(',').map(s => s.trim()).filter(Boolean);\n          console.log(` Valores de predecesoras procesados: [${predValues.join(', ')}]`);\n\n          // Guardar temporalmente los nmeros de wbsCode para procesar despus\n          task.predecessors = predValues;\n          console.log(` Predecesoras temporales (wbsCode): [${task.predecessors.join(', ')}]`);\n        }\n\n        newTasks.push(task);\n      }\n\n      console.log(' Tareas procesadas:', newTasks);\n\n      if (newTasks.length === 0) {\n        alert('No se encontraron tareas vlidas en el archivo Excel');\n        return;\n      }\n\n      // PROCESAR PREDECESORAS: Convertir nmeros de wbsCode a IDs\n      console.log(' Procesando predecesoras con wbsCode como referencia...');\n      newTasks.forEach(task => {\n        if (task.predecessors && task.predecessors.length > 0) {\n          const predecessorIds = task.predecessors.map(predWbsCode => {\n            const predTask = newTasks.find(t => t.wbsCode === predWbsCode);\n            if (predTask) {\n              console.log(` Predecesora encontrada: wbsCode ${predWbsCode}  ID ${predTask.id}`);\n              return predTask.id;\n            } else {\n              console.warn(` Predecesora no encontrada: wbsCode ${predWbsCode}`);\n              return null;\n            }\n          }).filter(Boolean);\n\n          task.predecessors = predecessorIds;\n          console.log(` Tarea \"${task.name}\": predecesoras convertidas a IDs: [${predecessorIds.join(', ')}]`);\n        }\n      });\n\n      // VALIDAR PREDECESORAS DEL EXCEL\n      console.log(' Validando predecesoras del Excel...');\n      const validation = validateExcelPredecessors(newTasks);\n\n      if (validation.errors.length > 0) {\n        const errorMessage = ` ERRORES ENCONTRADOS EN EL ARCHIVO EXCEL:\\n\\n${validation.errors.join('\\n')}`;\n        alert(errorMessage);\n        return;\n      }\n\n      if (validation.warnings.length > 0) {\n        const warningMessage = ` ADVERTENCIAS ENCONTRADAS:\\n\\n${validation.warnings.join('\\n')}\\n\\nDeseas continuar con la importacin?`;\n        if (!window.confirm(warningMessage)) {\n          return;\n        }\n      }\n\n      console.log(' Validacin de predecesoras completada exitosamente');\n\n      // REEMPLAZAR COMPLETAMENTE TODAS LAS TAREAS EXISTENTES\n      console.log(' IMPORTACIN - REEMPLAZANDO CRONOGRAMA COMPLETO');\n      console.log(' IMPORTACIN - Tareas anteriores:', tasks?.length || 0);\n      console.log(' IMPORTACIN - Nuevas tareas:', newTasks.length);\n      console.log(' IMPORTACIN - Primeras 3 tareas nuevas:', newTasks.slice(0, 3));\n      console.log(' IMPORTACIN - importTasks es funcin?', typeof importTasks);\n\n      // CONFIRMACIN: Reemplazar cronograma completo?\n      const confirmMessage = ` IMPORTACIN DE CRONOGRAMA COMPLETO\\n\\n` +\n        `Tareas actuales: ${tasks?.length || 0}\\n` +\n        `Nuevas tareas: ${newTasks.length}\\n\\n` +\n        `Esto REEMPLAZAR COMPLETAMENTE el cronograma actual.\\n` +\n        `Las tareas de minuta existentes podran quedar sin hito asignado.\\n\\n` +\n        `Continuar con la importacin?`;\n\n      if (!window.confirm(confirmMessage)) {\n        console.log(' IMPORTACIN - Cancelada por el usuario');\n        return;\n      }\n\n      // Aplicar ordenamiento por wbsCode antes de importar\n      const sortedNewTasks = sortTasksByWbsCode(newTasks);\n      console.log(' IMPORTACIN - Tareas ordenadas por wbsCode:', sortedNewTasks.map(t => ({ name: t.name, wbsCode: t.wbsCode })));\n\n      if (typeof importTasks === 'function') {\n        importTasks(sortedNewTasks);\n        console.log(' IMPORTACIN - importTasks llamado exitosamente - CRONOGRAMA REEMPLAZADO');\n      } else {\n        console.error(' IMPORTACIN - importTasks no est disponible, usando setTasks como fallback');\n        if (typeof setTasks === 'function') {\n          setTasks(sortedNewTasks);\n          console.log(' IMPORTACIN - setTasks llamado como fallback - CRONOGRAMA REEMPLAZADO');\n        } else {\n          console.error(' IMPORTACIN - Ni importTasks ni setTasks estn disponibles');\n          alert('Error: No se puede completar la importacin. Las funciones de actualizacin no estn disponibles.');\n          return;\n        }\n      }\n\n      // Disparar evento de cambio de datos\n      const dataChangeEvent = new CustomEvent('dataChange', {\n        detail: { type: 'schedule_imported', taskCount: newTasks.length, timestamp: new Date().toISOString() }\n      });\n      window.dispatchEvent(dataChangeEvent);\n\n      // Actualizar fechas del proyecto\n      const startDates = newTasks.map(t => new Date(t.startDate));\n      const endDates = newTasks.map(t => new Date(t.endDate));\n      const projectStart = new Date(Math.min(...startDates));\n      const projectEnd = new Date(Math.max(...endDates));\n\n      // Notificar al componente padre sobre los cambios en el cronograma\n      if (onScheduleDataChange) {\n        onScheduleDataChange({\n          tasks: newTasks,\n          projectStart: projectStart.toISOString().split('T')[0],\n          projectEnd: projectEnd.toISOString().split('T')[0],\n          totalTasks: newTasks.length,\n          completedTasks: newTasks.filter(t => t.status === 'completed').length,\n          totalCost: newTasks.reduce((sum, t) => sum + (t.cost || 0), 0)\n        });\n      }\n\n      alert(` CRONOGRAMA REEMPLAZADO EXITOSAMENTE!\\n\\n ${newTasks.length} tareas cargadas (cronograma anterior eliminado)\\n Proyecto: ${projectStart.toLocaleDateString('es')} - ${projectEnd.toLocaleDateString('es')}\\n\\n Las tareas de minuta existentes podran necesitar reasignacin de hitos.`);\n\n    } catch (error) {\n      console.error(' Error al procesar workbook:', error);\n      alert('Error al procesar el archivo Excel. Verifica que tenga el formato correcto.');\n    }\n  };\n\n  // FUNCIN CORREGIDA: Insertar tarea inmediatamente despus de la fila seleccionada\n  const insertTaskAtPosition = async (insertAfterTaskId, visualIndex = null) => {\n    console.log(' AGREGANDO TAREA - Insertando despus de:', insertAfterTaskId, 'en ndice visual:', visualIndex);\n\n    // VALIDAR: Verificar si est en modo read-only\n    if (useSupabase && projectData?.organizationId) {\n      const editPermission = await subscriptionService.canEdit(projectData.organizationId);\n      if (!editPermission.allowed) {\n        alert(` No puedes insertar tareas\\n\\n${editPermission.message}\\n\\n${editPermission.suggestion}`);\n        console.warn('[READ-ONLY MODE] No se puede insertar tarea:', editPermission);\n        return;\n      }\n    }\n\n    // Encontrar la tarea de referencia\n    const referenceTask = tasks.find(task => task.id === insertAfterTaskId);\n    if (!referenceTask) {\n      console.error(' No se encontr la tarea de referencia');\n      return;\n    }\n\n    // Calcular fechas basadas en la tarea de referencia\n    const newStartDate = addDays(referenceTask.endDate, 1, includeWeekends);\n    const newEndDate = addDays(newStartDate, 5, includeWeekends);\n\n    // Generar ID nico\n    const generateUniqueId = () => {\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        const r = Math.random() * 16 | 0;\n        const v = c === 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n      });\n    };\n\n    // Generar cdigo WBS nico basado en la posicin\n    const generateWbsForPosition = (insertIndex) => {\n      // Si es la primera tarea, usar 1\n      if (insertIndex === 0) {\n        return 1;\n      }\n\n      // Buscar el wbsCode de la tarea anterior\n      const prevTask = tasks[insertIndex - 1];\n      if (prevTask && prevTask.wbsCode) {\n        // Si el wbsCode es numrico, incrementar\n        if (typeof prevTask.wbsCode === 'number') {\n          return prevTask.wbsCode + 1;\n        }\n        // Si es string con formato \"1.1\", \"1.2\", etc., incrementar la parte decimal\n        const wbsStr = String(prevTask.wbsCode);\n        const parts = wbsStr.split('.');\n        if (parts.length === 2) {\n          const major = parseInt(parts[0]);\n          const minor = parseInt(parts[1]) + 1;\n          return `${major}.${minor}`;\n        }\n        // Fallback: usar el ndice + 1\n        return insertIndex + 1;\n      }\n\n      // Fallback: usar el ndice + 1\n      return insertIndex + 1;\n    };\n\n    const newTaskId = generateUniqueId();\n    const newWbsCode = generateWbsForPosition(visualIndex !== null ? visualIndex + 1 : tasks.length);\n\n    // Crear nueva tarea\n    const newTask = {\n      id: newTaskId,\n      wbsCode: newWbsCode,\n      name: `Nueva Tarea ${newWbsCode}`,\n      duration: 5,\n      startDate: newStartDate,\n      endDate: newEndDate,\n      progress: 0,\n      predecessors: [insertAfterTaskId],\n      successors: [],\n      resources: [],\n      cost: 0,\n      isMilestone: false,\n      isCritical: false,\n      originalDuration: 5,\n      earlyStart: newStartDate,\n      earlyFinish: newEndDate,\n      lateStart: newStartDate,\n      lateFinish: newEndDate,\n      totalFloat: 0,\n      freeFloat: 0,\n      status: 'pending',\n      workPackageId: newTaskId,\n      plannedValue: 0,\n      earnedValue: 0,\n      actualCost: 0,\n      description: '',\n      priority: 'medium',\n      assignedTo: '',\n      createdDate: toISO(new Date()),\n      lastModified: toISO(new Date())\n    };\n\n    console.log(' NUEVA TAREA CREADA:', newTask);\n\n    // CORRECCIN: Insertar la tarea en la posicin exacta despus de la fila seleccionada\n    setTasks(prev => {\n      console.log(' DEBUG - Array antes de insercin:', prev.map((t, i) => ({ index: i, id: t.id, name: t.name, wbsCode: t.wbsCode })));\n\n      // 1. Encontrar el ndice de la tarea de referencia\n      const referenceIndex = prev.findIndex(task => task.id === insertAfterTaskId);\n      if (referenceIndex === -1) {\n        console.error(' No se encontr la tarea de referencia en el array');\n        return prev;\n      }\n\n      // 2. Insertar la nueva tarea inmediatamente despus de la tarea de referencia\n      const insertPosition = referenceIndex + 1;\n      const newTasks = [\n        ...prev.slice(0, insertPosition),\n        newTask,\n        ...prev.slice(insertPosition)\n      ];\n\n      console.log(' DEBUG - Tarea insertada en posicin:', insertPosition);\n      console.log(' DEBUG - Array despus de insercin:', newTasks.map((t, i) => ({ index: i, id: t.id, name: t.name, wbsCode: t.wbsCode })));\n\n      // 3. Actualizar dependencias de la tarea anterior\n      const updatedTasks = newTasks.map(task => {\n        if (task.id === insertAfterTaskId) {\n          return {\n            ...task,\n            successors: [...(task.successors || []), newTaskId]\n          };\n        }\n        return task;\n      });\n\n      // 4. Actualizar wbsCode de todas las tareas para mantener secuencia correcta\n      const finalTasks = updatedTasks.map((task, index) => ({\n        ...task,\n        wbsCode: index + 1\n      }));\n\n      console.log(' DEBUG - Array final con wbsCode actualizado:', finalTasks.map((t, i) => ({ index: i, id: t.id, name: t.name, wbsCode: t.wbsCode })));\n      console.log(' Tarea agregada exitosamente en posicin correcta');\n\n      //  FIX: Guardar la nueva tarea en Supabase inmediatamente\n      if (useSupabase && projectData?.id) {\n        // Insertar la nueva tarea en Supabase\n        const taskToInsert = {\n          id: newTask.id,\n          project_id: projectData.id,\n          owner_id: projectData.owner_id || supabaseService.currentUser?.id,\n          name: newTask.name,\n          wbs_code: newTask.wbsCode,\n          start_date: newTask.startDate,\n          end_date: newTask.endDate,\n          duration: newTask.duration,\n          progress: newTask.progress,\n          predecessors: newTask.predecessors || [],\n          successors: newTask.successors || [],\n          resources: newTask.resources || [],\n          cost: newTask.cost || 0,\n          status: newTask.status || 'pending',\n          priority: newTask.priority || 'medium',\n          description: newTask.description || '',\n          assigned_to: newTask.assignedTo || '',\n          is_milestone: newTask.isMilestone || false,\n          original_duration: newTask.originalDuration || newTask.duration,\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString()\n        };\n\n        supabaseService.supabase\n          .from('tasks')\n          .insert([taskToInsert])\n          .then(({ error }) => {\n            if (error) {\n              console.error(' Error insertando tarea en Supabase:', error);\n            } else {\n              console.log(' Tarea insertada en Supabase exitosamente');\n\n              // Actualizar wbs_code de todas las tareas afectadas\n              Promise.all(\n                finalTasks.map(task =>\n                  supabaseService.supabase\n                    .from('tasks')\n                    .update({ wbs_code: task.wbsCode })\n                    .eq('id', task.id)\n                    .eq('project_id', projectData.id)\n                )\n              ).then(() => {\n                console.log(' wbs_code actualizados en Supabase despus de insercin');\n              }).catch(error => {\n                console.error(' Error actualizando wbs_code en Supabase:', error);\n              });\n            }\n          })\n          .catch(error => {\n            console.error(' Error inesperado insertando en Supabase:', error);\n          });\n      }\n\n      return finalTasks;\n    });\n  };\n\n  // NUEVAS FUNCIONES PARA VISTA TABLA\n  const startEditing = (taskId, field, currentValue) => {\n    // Bloquear edicin si est en modo read-only\n    if (isReadOnlyMode) {\n      console.warn('[READ-ONLY MODE] No se puede editar en modo solo lectura');\n      return;\n    }\n    setEditingCell({ taskId, field });\n\n    // Para fechas, asegurar que est en formato ISO para el input\n    if (field === 'startDate' || field === 'endDate') {\n      if (currentValue) {\n        // Si ya est en formato ISO, usarlo directamente\n        if (currentValue.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n          setEditingValue(currentValue);\n        } else {\n          // Si est en formato espaol (DD/MM/YYYY), convertir a ISO\n          const dateParts = currentValue.split('/');\n          if (dateParts.length === 3) {\n            const day = dateParts[0].padStart(2, '0');\n            const month = dateParts[1].padStart(2, '0');\n            const year = dateParts[2];\n            setEditingValue(`${year}-${month}-${day}`);\n          } else {\n            setEditingValue(currentValue);\n          }\n        }\n      } else {\n        setEditingValue('');\n      }\n    } else {\n      setEditingValue(currentValue);\n    }\n  };\n\n\n  // Funciones para el manejo de minutas\n  const handleOpenMinutaModal = () => {\n    setIsMinutaModalOpen(true);\n  };\n\n  const handleCloseMinutaModal = () => {\n    setIsMinutaModalOpen(false);\n  };\n\n  const handleSaveMinuta = async (minutaTasks) => {\n    console.log(' Guardando tareas de minuta:', minutaTasks);\n\n    try {\n      // Si est usando Supabase, guardar en la base de datos\n      if (useSupabase && projectData?.id) {\n        const result = await supabaseService.saveMinutas(projectData.id, minutaTasks);\n\n        if (result.success) {\n          // Actualizar el estado local con los datos de Supabase\n          setMinutasTasks(prev => [...prev, ...minutaTasks]);\n\n          // Actualizar el estado global minutasByProject\n          if (updateProjectMinutas) {\n            const currentMinutas = minutasTasks || [];\n            const updatedMinutas = [...currentMinutas, ...minutaTasks];\n            updateProjectMinutas(projectData.id, updatedMinutas);\n          }\n\n          // Registrar eventos de auditora para cada minuta guardada\n          minutaTasks.forEach(minuta => {\n            logMinutaTaskCreated(minuta, projectData);\n          });\n\n          alert(` Se han guardado ${minutaTasks.length} tareas de la minuta en Supabase.`);\n        } else {\n          console.error(' Error guardando en Supabase:', result.error);\n          alert(` Error guardando las minutas: ${result.error.message || 'Error desconocido'}`);\n          return;\n        }\n      } else {\n        // Modo local: solo agregar al estado\n        setMinutasTasks(prev => [...prev, ...minutaTasks]);\n        alert(` Se han guardado ${minutaTasks.length} tareas de la minuta localmente.`);\n      }\n\n      // Sincronizar con el data change event para backups automticos\n      if (typeof window !== 'undefined') {\n        const dataChangeEvent = new CustomEvent('dataChange', {\n          detail: {\n            type: 'minutasUpdated',\n            projectId: projectData?.id,\n            minutasCount: minutaTasks.length\n          }\n        });\n        window.dispatchEvent(dataChangeEvent);\n      }\n\n    } catch (error) {\n      console.error(' Error guardando minutas:', error);\n      alert(` Error guardando las minutas: ${error.message}`);\n    }\n  };\n\n  // Funciones para edicin de minutas\n  const handleEditMinuta = (minuta) => {\n    setEditingMinuta(minuta);\n    setIsEditModalOpen(true);\n  };\n\n  const handleCloseEditModal = () => {\n    setEditingMinuta(null);\n    setIsEditModalOpen(false);\n  };\n\n  const handleUpdateMinuta = async (updatedMinuta) => {\n    try {\n      if (useSupabase) {\n        // Actualizar en Supabase\n        const updateResult = await supabaseService.updateMinuta(updatedMinuta.id, {\n          task_description: updatedMinuta.tarea,\n          responsible_person: updatedMinuta.responsable,\n          due_date: updatedMinuta.fecha,\n          milestone_id: updatedMinuta.hitoId,\n          status: updatedMinuta.estatus\n        });\n\n        if (updateResult.success) {\n          // Actualizar estado local preservando fechaCreacion\n          setMinutasTasks(prev =>\n            prev.map(m => m.id === updatedMinuta.id ? {\n              ...updatedMinuta,\n              fechaCreacion: m.fechaCreacion  // Preservar fecha de creacin\n            } : m)\n          );\n\n          // Actualizar el estado global minutasByProject preservando fechaCreacion\n          if (updateProjectMinutas) {\n            const currentMinutas = minutasTasks || [];\n            const updatedMinutas = currentMinutas.map(m => m.id === updatedMinuta.id ? {\n              ...updatedMinuta,\n              fechaCreacion: m.fechaCreacion  // Preservar fecha de creacin\n            } : m);\n            updateProjectMinutas(projectData.id, updatedMinutas);\n          }\n\n          // Registrar evento de auditora para la actualizacin\n          const changes = {\n            task_description: updatedMinuta.tarea,\n            responsible_person: updatedMinuta.responsable,\n            due_date: updatedMinuta.fecha,\n            milestone_id: updatedMinuta.hitoId,\n            status: updatedMinuta.estatus\n          };\n          logMinutaTaskUpdated(updatedMinuta, changes, projectData);\n\n          alert(' Minuta actualizada correctamente');\n        } else {\n          console.error(' Error actualizando minuta:', updateResult.error);\n          alert(` Error actualizando minuta: ${updateResult.error.message || 'Error desconocido'}`);\n        }\n      } else {\n        // Actualizar solo en estado local preservando fechaCreacion\n        setMinutasTasks(prev =>\n          prev.map(m => m.id === updatedMinuta.id ? {\n            ...updatedMinuta,\n            fechaCreacion: m.fechaCreacion  // Preservar fecha de creacin\n          } : m)\n        );\n        alert(' Minuta actualizada localmente');\n      }\n    } catch (error) {\n      console.error(' Error actualizando minuta:', error);\n      alert(` Error actualizando minuta: ${error.message}`);\n    }\n  };\n\n  // ===== FUNCIONES PARA ASISTENTE INTELIGENTE DE CRONOGRAMAS =====\n\n  // Inicializar el servicio de IA\n  useEffect(() => {\n    const initializeAIService = async () => {\n      if (useSupabase && projectData?.id) {\n        try {\n          console.log(' DEBUG - Inicializando servicio de IA:', {\n            projectId: projectData.id,\n            organizationId: projectData.organizationId,\n            organizationIdType: typeof projectData.organizationId,\n            hasOrganizationId: !!projectData.organizationId,\n            currentUser: supabaseService.currentUser?.email\n          });\n\n          await aiSchedulerService.initialize(\n            supabaseService.supabase,\n            projectData.organizationId,\n            supabaseService.currentUser\n          );\n          console.log(' Servicio de IA inicializado para proyecto:', projectData.id);\n        } catch (error) {\n          console.error(' Error inicializando servicio de IA:', error);\n        }\n      } else {\n        console.log(' No se puede inicializar servicio de IA:', {\n          useSupabase,\n          hasProjectId: !!projectData?.id,\n          projectData: projectData\n        });\n      }\n    };\n\n    initializeAIService();\n  }, [useSupabase, projectData?.id, projectData?.organizationId]);\n\n  // Manejar cronograma generado por IA\n  const handleAIScheduleGenerated = async (generatedSchedule) => {\n    try {\n      console.log(' Aplicando cronograma generado por IA:', generatedSchedule);\n\n      // CORRECCIN: Combinar actividades e hitos en el orden correcto\n      // CORRECCIN: Calcular fechas iniciales antes de CPM para evitar errores\n      const today = new Date();\n      const projectStartDate = toISO(today);\n\n      // 1. Procesar actividades con fechas iniciales\n      const aiActivities = generatedSchedule.activities.map((item, index) => {\n        const startDate = addDays(projectStartDate, index, includeWeekends);\n        const endDate = addDays(startDate, (item.duration || 1) - 1, includeWeekends);\n\n        return {\n          id: item.id,\n          name: item.name,\n          description: item.description || '',\n          duration: item.duration || 1,\n          startDate: startDate,\n          endDate: endDate,\n          progress: 0,\n          status: 'pending',\n          priority: item.priority || 'medium',\n          assignedTo: item.assignedTo || 'Pendiente',\n          dependencies: item.dependencies || [],\n          predecessors: item.dependencies || [],\n          successors: [],\n          isMilestone: false,\n          estimatedCost: item.estimatedCost || 0,\n          category: item.category || 'execution',\n          phase: item.phase || 'General',\n          generatedBy: 'ai',\n          confidence: item.confidence || 0.8,\n          criteria: item.criteria || ''\n        };\n      });\n\n      // 2. Procesar hitos con fechas iniciales\n      const aiMilestones = (generatedSchedule.milestones || []).map((item, index) => {\n        const milestoneDate = addDays(projectStartDate, aiActivities.length + index, includeWeekends);\n\n        return {\n          id: item.id,\n          name: item.name,\n          description: item.description || '',\n          duration: 0, // Los hitos no tienen duracin\n          startDate: milestoneDate,\n          endDate: milestoneDate, // Para hitos, startDate = endDate\n          progress: 0,\n          status: 'pending',\n          priority: item.priority || 'high',\n          assignedTo: item.assignedTo || 'Pendiente',\n          dependencies: item.dependencies || [],\n          predecessors: item.dependencies || [],\n          successors: [],\n          isMilestone: true,\n          estimatedCost: item.estimatedCost || 0,\n          category: item.category || 'milestone',\n          phase: item.phase || 'General',\n          generatedBy: 'ai',\n          confidence: item.confidence || 0.9,\n          criteria: item.criteria || ''\n        };\n      });\n\n      // 3. Intercalar hitos con sus actividades relacionadas\n      const allAITasks = [];\n      const processedMilestones = new Set();\n\n      // Agrupar actividades por fase\n      const activitiesByPhase = {};\n      aiActivities.forEach(activity => {\n        const phase = activity.phase || 'General';\n        if (!activitiesByPhase[phase]) {\n          activitiesByPhase[phase] = [];\n        }\n        activitiesByPhase[phase].push(activity);\n      });\n\n      // Procesar cada fase\n      Object.entries(activitiesByPhase).forEach(([phaseName, phaseActivities]) => {\n        // Agregar actividades de la fase\n        allAITasks.push(...phaseActivities);\n\n        // Buscar hitos de esta fase\n        const phaseMilestones = aiMilestones.filter(milestone =>\n          milestone.phase === phaseName && !processedMilestones.has(milestone.id)\n        );\n\n        // Agregar hitos de la fase despus de sus actividades\n        allAITasks.push(...phaseMilestones);\n        phaseMilestones.forEach(m => processedMilestones.add(m.id));\n      });\n\n      // Agregar hitos sin fase especfica al final\n      const unassignedMilestones = aiMilestones.filter(milestone =>\n        !milestone.phase || milestone.phase === 'General'\n      );\n      allAITasks.push(...unassignedMilestones);\n\n      console.log(' Cronograma IA procesado:', {\n        totalItems: allAITasks.length,\n        activities: allAITasks.filter(item => !item.isMilestone).length,\n        milestones: allAITasks.filter(item => item.isMilestone).length,\n        phases: [...new Set(allAITasks.map(item => item.phase))]\n      });\n\n      console.log(' DEBUG - Orden de tareas antes de CPM:', {\n        activitiesByPhase: Object.keys(activitiesByPhase),\n        allAITasksOrder: allAITasks.map((task, index) => ({\n          index,\n          id: task.id,\n          name: task.name,\n          isMilestone: task.isMilestone,\n          phase: task.phase\n        }))\n      });\n\n      // Confirmar reemplazo del cronograma actual\n      const activitiesCount = allAITasks.filter(item => !item.isMilestone).length;\n      const milestonesCount = allAITasks.filter(item => item.isMilestone).length;\n\n      const confirmMessage = ` CRONOGRAMA GENERADO POR IA\\n\\n` +\n        `Actividades: ${activitiesCount}\\n` +\n        `Hitos: ${milestonesCount}\\n` +\n        `Duracin estimada: ${Math.round(generatedSchedule.metadata?.estimatedDuration || 0)} das\\n\\n` +\n        `Esto REEMPLAZAR COMPLETAMENTE el cronograma actual.\\n` +\n        `Continuar con la aplicacin del cronograma generado por IA?`;\n\n      if (!window.confirm(confirmMessage)) {\n        console.log(' Aplicacin de cronograma IA cancelada por el usuario');\n        return;\n      }\n\n      // Aplicar CPM a las nuevas tareas manteniendo el orden original\n      const cpmResult = calculateCPM(allAITasks, includeWeekends);\n      const tasksWithCPM = cpmResult.tasks || cpmResult;\n\n      // CORRECCIN: Mantener el orden original de la IA despus del CPM\n      // El CPM puede reordenar las tareas, pero queremos preservar el orden lgico de la IA\n      const orderedTasksWithCPM = [];\n      const tasksMap = new Map(tasksWithCPM.map(task => [task.id, task]));\n\n      // Reconstruir el orden usando el array original allAITasks\n      allAITasks.forEach(originalTask => {\n        const cpmTask = tasksMap.get(originalTask.id);\n        if (cpmTask) {\n          orderedTasksWithCPM.push(cpmTask);\n        }\n      });\n\n      // Agregar cualquier tarea que no est en el orden original (por seguridad)\n      tasksWithCPM.forEach(task => {\n        if (!tasksMap.has(task.id) || !allAITasks.find(t => t.id === task.id)) {\n          orderedTasksWithCPM.push(task);\n        }\n      });\n\n      console.log(' DEBUG - Resultado CPM:', {\n        cpmResultType: typeof cpmResult,\n        cpmResultKeys: Object.keys(cpmResult),\n        tasksType: typeof tasksWithCPM,\n        tasksIsArray: Array.isArray(tasksWithCPM),\n        tasksLength: Array.isArray(tasksWithCPM) ? tasksWithCPM.length : 'N/A',\n        orderedTasksLength: orderedTasksWithCPM.length,\n        orderPreserved: allAITasks.length === orderedTasksWithCPM.length\n      });\n\n      console.log(' Orden preservado despus de CPM:', {\n        originalOrder: allAITasks.map(t => ({ id: t.id, name: t.name, isMilestone: t.isMilestone })),\n        finalOrder: orderedTasksWithCPM.map(t => ({ id: t.id, name: t.name, isMilestone: t.isMilestone }))\n      });\n\n      console.log(' DEBUG - Verificacin de intercalado:', {\n        milestonesPositions: orderedTasksWithCPM.map((task, index) =>\n          task.isMilestone ? { index, name: task.name, phase: task.phase } : null\n        ).filter(Boolean),\n        activitiesBeforeMilestones: orderedTasksWithCPM.map((task, index) => {\n          if (task.isMilestone) {\n            const activitiesBefore = orderedTasksWithCPM.slice(0, index).filter(t => !t.isMilestone);\n            return { milestone: task.name, activitiesBefore: activitiesBefore.length };\n          }\n          return null;\n        }).filter(Boolean),\n        sampleTasksWithDates: orderedTasksWithCPM.slice(0, 5).map(task => ({\n          id: task.id,\n          name: task.name,\n          startDate: task.startDate,\n          endDate: task.endDate,\n          isMilestone: task.isMilestone\n        }))\n      });\n\n      // Actualizar el estado de tareas con el orden preservado\n      setTasks(orderedTasksWithCPM);\n\n      // Registrar evento de auditora\n      addAuditEvent({\n        category: 'ai-scheduler',\n        action: 'schedule-applied',\n        description: 'Cronograma generado por IA aplicado al proyecto',\n        details: {\n          activitiesCount: activitiesCount,\n          milestonesCount: milestonesCount,\n          templateUsed: generatedSchedule.metadata?.templateUsed,\n          estimatedDuration: generatedSchedule.metadata?.estimatedDuration,\n          complexity: generatedSchedule.metadata?.complexity\n        }\n      });\n\n      // Mostrar recomendaciones si las hay\n      if (generatedSchedule.recommendations && generatedSchedule.recommendations.length > 0) {\n        const recommendationsText = generatedSchedule.recommendations\n          .map(rec => ` ${rec.title}: ${rec.description}`)\n          .join('\\n');\n\n        alert(` CRONOGRAMA DE IA APLICADO EXITOSAMENTE!\\n\\n` +\n          ` ${allAITasks.length} elementos generados\\n` +\n          ` ${milestonesCount} hitos creados\\n` +\n          ` Duracin estimada: ${Math.round(generatedSchedule.metadata?.estimatedDuration || 0)} das\\n\\n` +\n          ` RECOMENDACIONES:\\n${recommendationsText}`);\n      } else {\n        alert(` CRONOGRAMA DE IA APLICADO EXITOSAMENTE!\\n\\n` +\n          ` ${allAITasks.length} elementos generados\\n` +\n          ` ${milestonesCount} hitos creados\\n` +\n          ` Duracin estimada: ${Math.round(generatedSchedule.metadata?.estimatedDuration || 0)} das`);\n      }\n\n      console.log(' Cronograma de IA aplicado exitosamente');\n\n    } catch (error) {\n      console.error(' Error aplicando cronograma de IA:', error);\n      alert(` Error aplicando cronograma de IA: ${error.message}`);\n    }\n  };\n\n  // Funcin para alternar hito\n  const toggleMilestone = (taskId) => {\n    setTasks(prev => prev.map(task => {\n      if (task.id !== taskId) return task;\n\n      const isBecomingMilestone = !task.isMilestone;\n\n      if (isBecomingMilestone) {\n        // Al marcar como hito: duracin = 0, fin = inicio\n        console.log(' DEBUG - Creando hito:', {\n          taskId,\n          taskName: task.name,\n          startDate: task.startDate,\n          endDate: task.startDate,\n          duration: 0\n        });\n\n        return {\n          id: task.id,\n          wbsCode: task.wbsCode,\n          name: task.name,\n          duration: 0,\n          startDate: task.startDate,\n          endDate: task.startDate,\n          progress: task.progress,\n          predecessors: [...(task.predecessors || [])],\n          cost: task.cost,\n          priority: task.priority,\n          assignedTo: task.assignedTo,\n          isMilestone: true,\n          isCritical: task.isCritical,\n          originalDuration: task.originalDuration,\n          earlyStart: task.earlyStart,\n          earlyFinish: task.earlyFinish,\n          lateStart: task.lateStart,\n          lateFinish: task.lateFinish,\n          totalFloat: task.totalFloat,\n          freeFloat: task.freeFloat,\n          description: task.description,\n          resources: [...(task.resources || [])],\n          workPackageId: task.workPackageId,\n          status: task.status,\n          successors: [...(task.successors || [])],\n          updatedAt: new Date().toISOString()\n        };\n      } else {\n        // Al quitar hito: restaurar duracin original (mnimo 1 da)\n        const originalDuration = task.originalDuration || 1;\n        const newEndDate = addDays(task.startDate, originalDuration, includeWeekends);\n        return {\n          id: task.id,\n          wbsCode: task.wbsCode,\n          name: task.name,\n          duration: originalDuration,\n          startDate: task.startDate,\n          endDate: newEndDate,\n          progress: task.progress,\n          predecessors: [...(task.predecessors || [])],\n          cost: task.cost,\n          priority: task.priority,\n          assignedTo: task.assignedTo,\n          isMilestone: false,\n          isCritical: task.isCritical,\n          originalDuration: task.originalDuration,\n          earlyStart: task.earlyStart,\n          earlyFinish: task.earlyFinish,\n          lateStart: task.lateStart,\n          lateFinish: task.lateFinish,\n          totalFloat: task.totalFloat,\n          freeFloat: task.freeFloat,\n          description: task.description,\n          resources: [...(task.resources || [])],\n          workPackageId: task.workPackageId,\n          status: task.status,\n          successors: [...(task.successors || [])],\n          updatedAt: new Date().toISOString()\n        };\n      }\n    }));\n\n    // Disparar evento de cambio de datos\n    const dataChangeEvent = new CustomEvent('dataChange', {\n      detail: { type: 'milestone_toggled', taskId, timestamp: new Date().toISOString() }\n    });\n    window.dispatchEvent(dataChangeEvent);\n  };\n\n  // FUNCIN SIMPLIFICADA: Agregar tarea al final del cronograma\n  const addTaskAtEnd = async () => {\n    console.log(' AGREGANDO TAREA AL FINAL');\n\n    // VALIDAR: Verificar si est en modo read-only\n    if (useSupabase && projectData?.organizationId) {\n      const editPermission = await subscriptionService.canEdit(projectData.organizationId);\n      if (!editPermission.allowed) {\n        alert(` No puedes agregar tareas\\n\\n${editPermission.message}\\n\\n${editPermission.suggestion}`);\n        console.warn('[READ-ONLY MODE] No se puede agregar tarea:', editPermission);\n        return;\n      }\n    }\n\n    // Calcular fechas basadas en la ltima tarea\n    let newStartDate = toISO(new Date());\n    let newEndDate = addDays(newStartDate, 5, includeWeekends);\n\n    if (tasks.length > 0) {\n      const lastTask = tasks[tasks.length - 1];\n      newStartDate = addDays(lastTask.endDate, 1, includeWeekends);\n      newEndDate = addDays(newStartDate, 5, includeWeekends);\n    }\n\n    // Generar ID nico\n    const generateUniqueId = () => {\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        const r = Math.random() * 16 | 0;\n        const v = c === 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n      });\n    };\n\n    // Generar cdigo WBS nico\n    const generateUniqueWbs = () => {\n      let counter = 1;\n      let newWbs;\n      do {\n        newWbs = counter;\n        counter++;\n      } while (tasks.some(task => task.wbsCode === newWbs));\n      return newWbs;\n    };\n\n    const newTaskId = generateUniqueId();\n    const newWbsCode = generateUniqueWbs();\n\n    // Crear nueva tarea\n    const newTask = {\n      id: newTaskId,\n      wbsCode: newWbsCode,\n      name: `Nueva Tarea ${newWbsCode}`,\n      duration: 5,\n      startDate: newStartDate,\n      endDate: newEndDate,\n      progress: 0,\n      predecessors: tasks.length > 0 ? [tasks[tasks.length - 1].id] : [], // Depende de la ltima tarea\n      successors: [],\n      resources: [],\n      cost: 0,\n      isMilestone: false,\n      isCritical: false,\n      originalDuration: 5,\n      earlyStart: newStartDate,\n      earlyFinish: newEndDate,\n      lateStart: newStartDate,\n      lateFinish: newEndDate,\n      totalFloat: 0,\n      freeFloat: 0,\n      status: 'pending',\n      workPackageId: newTaskId,\n      plannedValue: 0,\n      earnedValue: 0,\n      actualCost: 0,\n      description: '',\n      priority: 'medium',\n      assignedTo: '',\n      createdDate: toISO(new Date()),\n      lastModified: toISO(new Date())\n    };\n\n    console.log(' NUEVA TAREA AL FINAL CREADA:', newTask);\n\n    // Agregar la tarea al final\n    setTasks(prev => {\n      const newTasks = [...prev, newTask];\n\n      // Si hay una tarea anterior, actualizar sus dependencias\n      if (prev.length > 0) {\n        const lastTaskId = prev[prev.length - 1].id;\n        const updatedTasks = newTasks.map(task => {\n          if (task.id === lastTaskId) {\n            return {\n              ...task,\n              successors: [...(task.successors || []), newTaskId]\n            };\n          }\n          return task;\n        });\n\n        console.log(' Tarea agregada al final exitosamente');\n        return updatedTasks;\n      }\n\n      console.log(' Primera tarea agregada exitosamente');\n      return newTasks;\n    });\n  };\n\n  // FUNCIN SIMPLIFICADA: Eliminar tarea directamente (como MS Project)\n  const deleteTask = async (taskId) => {  //  FIX: Agregar async para sincronizacin con Supabase\n    const taskToDelete = tasks.find(t => t.id === taskId);\n    if (!taskToDelete) {\n      console.error(' Tarea no encontrada para eliminar');\n      return;\n    }\n\n    // Verificar dependencias antes de eliminar\n    const dependentTasks = tasks.filter(task =>\n      task.predecessors?.includes(taskId) || task.successors?.includes(taskId)\n    );\n\n    let confirmMessage = `Ests seguro de que quieres eliminar la tarea \"${taskToDelete.name}\"?`;\n\n    if (dependentTasks.length > 0) {\n      confirmMessage += `\\n\\n ADVERTENCIA: Esta tarea tiene dependencias:\\n`;\n      dependentTasks.forEach(task => {\n        if (task.predecessors?.includes(taskId)) {\n          confirmMessage += ` \"${task.name}\" depende de esta tarea\\n`;\n        }\n        if (task.successors?.includes(taskId)) {\n          confirmMessage += ` Esta tarea depende de \"${task.name}\"\\n`;\n        }\n      });\n      confirmMessage += `\\nLas dependencias se limpiarn automticamente.`;\n    }\n\n    confirmMessage += `\\n\\nEsta accin no se puede deshacer.`;\n\n    if (!window.confirm(confirmMessage)) {\n      return;\n    }\n\n    console.log(' ELIMINANDO TAREA:', taskToDelete.name, 'ID:', taskId);\n    console.log(' Tareas dependientes encontradas:', dependentTasks.length);\n\n    //  FIX: Eliminar en Supabase INMEDIATAMENTE si est habilitado\n    if (useSupabase && projectData?.id) {\n      try {\n        console.log(' Eliminando tarea en Supabase...');\n        const { error } = await supabaseService.supabase\n          .from('tasks')\n          .delete()\n          .eq('id', taskId)\n          .eq('project_id', projectData.id);\n\n        if (error) {\n          console.error(' Error eliminando tarea en Supabase:', error);\n          alert(' Error al eliminar la tarea en la base de datos.\\n\\nPor favor, intntalo de nuevo.');\n          return; // No eliminar localmente si falla en Supabase\n        }\n\n        console.log(' Tarea eliminada en Supabase exitosamente');\n      } catch (error) {\n        console.error(' Error inesperado eliminando en Supabase:', error);\n        alert(' Error inesperado al eliminar la tarea.\\n\\nPor favor, intntalo de nuevo.');\n        return; // No eliminar localmente si falla\n      }\n    }\n\n    // Eliminar la tarea y limpiar dependencias\n    setTasks(prev => {\n      const updatedTasks = prev.filter(task => task.id !== taskId);\n\n      // Limpiar referencias a la tarea eliminada en todas las dems tareas\n      const cleanedTasks = updatedTasks.map(task => ({\n        ...task,\n        predecessors: task.predecessors?.filter(predId => predId !== taskId) || [],\n        successors: task.successors?.filter(succId => succId !== taskId) || []\n      }));\n\n      //  CORRECCIN: Reasignar wbsCode para mantener secuencia correcta\n      const finalTasks = cleanedTasks.map((task, index) => ({\n        ...task,\n        wbsCode: index + 1\n      }));\n\n      console.log(' Tarea eliminada localmente exitosamente');\n      console.log(' wbsCode reasignados despus de eliminacin:',\n        finalTasks.map(t => ({ name: t.name, wbsCode: t.wbsCode }))\n      );\n\n      //  FIX ADICIONAL: Actualizar wbs_code en Supabase despus de renumerar\n      if (useSupabase && projectData?.id) {\n        // Hacer update en background (no bloqueante)\n        Promise.all(\n          finalTasks.map(task =>\n            supabaseService.supabase\n              .from('tasks')\n              .update({ wbs_code: task.wbsCode })\n              .eq('id', task.id)\n              .eq('project_id', projectData.id)\n          )\n        ).then(results => {\n          const errors = results.filter(r => r.error);\n          if (errors.length > 0) {\n            console.error(' Algunos wbs_code no se actualizaron en Supabase:', errors);\n          } else {\n            console.log(' wbs_code actualizados en Supabase exitosamente');\n          }\n        }).catch(error => {\n          console.error(' Error actualizando wbs_code en Supabase:', error);\n        });\n      }\n\n      return finalTasks;\n    });\n  };\n\n  const saveEdit = () => {\n    if (!editingCell) return;\n\n    const { taskId, field } = editingCell;\n    const newValue = editingValue;\n\n    console.log(' SAVEEDIT - INICIANDO:', {\n      taskId,\n      field,\n      newValue,\n      tasksLength: tasks ? tasks.length : 'UNDEFINED'\n    });\n\n    if (field === 'dependencies') {\n      saveDependenciesEdit();\n      return;\n    }\n\n    setTasks(prev => {\n      console.log(' SAVEEDIT - Estado ANTES de actualizar:', {\n        prevLength: prev ? prev.length : 'UNDEFINED',\n        prevTasks: prev ? prev.map(t => ({ id: t.id, name: t.name })) : 'UNDEFINED'\n      });\n\n      return prev.map(task => {\n        if (task.id === taskId) {\n          // Clonacin segura del objeto task\n          const updatedTask = {\n            id: task.id,\n            wbsCode: task.wbsCode,\n            name: task.name,\n            duration: task.duration,\n            startDate: task.startDate,\n            endDate: task.endDate,\n            progress: task.progress,\n            predecessors: [...(task.predecessors || [])],\n            cost: task.cost,\n            businessValue: task.businessValue || 0,  //  PRESERVAR businessValue\n            priority: task.priority,\n            assignedTo: task.assignedTo,\n            isMilestone: task.isMilestone,\n            isCritical: task.isCritical,\n            originalDuration: task.originalDuration,\n            earlyStart: task.earlyStart,\n            earlyFinish: task.earlyFinish,\n            lateStart: task.lateStart,\n            lateFinish: task.lateFinish,\n            totalFloat: task.totalFloat,\n            freeFloat: task.freeFloat,\n            description: task.description,\n            resources: [...(task.resources || [])],\n            workPackageId: task.workPackageId,\n            status: task.status,\n            successors: [...(task.successors || [])]\n          };\n\n          switch (field) {\n            case 'name':\n              updatedTask.name = newValue;\n              break;\n            case 'duration':\n              const duration = parseInt(newValue) || 1;\n              updatedTask.duration = duration;\n              // Para hitos: fecha de fin = fecha de inicio\n              if (updatedTask.isMilestone) {\n                updatedTask.endDate = updatedTask.startDate;\n              } else {\n                // Calcular fecha fin basndose en la duracin\n                if (includeWeekends) {\n                  // Incluir fines de semana\n                  const startDate = new Date(updatedTask.startDate);\n                  startDate.setDate(startDate.getDate() + duration - 1);\n                  updatedTask.endDate = toISO(startDate);\n                } else {\n                  // Solo das laborales\n                  updatedTask.endDate = addDays(updatedTask.startDate, duration, includeWeekends);\n                }\n              }\n              break;\n            case 'startDate':\n              updatedTask.startDate = newValue;\n              // Para hitos: fecha de fin = fecha de inicio\n              if (updatedTask.isMilestone) {\n                updatedTask.endDate = newValue;\n              } else {\n                // Calcular fecha fin basndose en la duracin\n                if (includeWeekends) {\n                  // Incluir fines de semana\n                  const startDate = new Date(newValue);\n                  startDate.setDate(startDate.getDate() + updatedTask.duration - 1);\n                  updatedTask.endDate = toISO(startDate);\n                } else {\n                  // Solo das laborales\n                  updatedTask.endDate = addDays(newValue, updatedTask.duration, includeWeekends);\n                }\n              }\n              break;\n            case 'endDate':\n              updatedTask.endDate = newValue;\n              // NO recalcular duracin automticamente - mantener la duracin original\n              // La duracin se puede ajustar manualmente si es necesario\n              break;\n            case 'progress':\n              updatedTask.progress = Math.max(0, Math.min(100, parseInt(newValue) || 0));\n              break;\n            case 'priority':\n              updatedTask.priority = newValue;\n              break;\n            case 'assignedTo':\n              updatedTask.assignedTo = newValue;\n              break;\n            case 'cost':\n              updatedTask.cost = parseFloat(newValue) || 0;\n              break;\n            case 'businessValue':\n              updatedTask.businessValue = parseFloat(newValue) || 0;\n              break;\n          }\n\n          return updatedTask;\n        }\n        return task;\n      });\n    });\n\n    // Disparar evento de cambio de datos para sincronizar con otros componentes\n    const dataChangeEvent = new CustomEvent('dataChange', {\n      detail: {\n        type: 'taskUpdated',\n        taskId,\n        field,\n        newValue,\n        timestamp: new Date().toISOString()\n      }\n    });\n    window.dispatchEvent(dataChangeEvent);\n\n    //  FIX: Actualizar en Supabase inmediatamente despus de editar\n    if (useSupabase && projectData?.id) {\n      // Encontrar la tarea actualizada para obtener todos sus valores\n      const updatedTask = tasks.find(t => t.id === taskId);\n      if (updatedTask) {\n        // Construir objeto de actualizacin con el campo modificado\n        const updateData = {\n          updated_at: new Date().toISOString()\n        };\n\n        // Mapear el campo editado al nombre de columna en Supabase\n        switch (field) {\n          case 'name':\n            updateData.name = newValue;\n            break;\n          case 'duration':\n            updateData.duration = parseInt(newValue) || 1;\n            // Si cambi la duracin, actualizar tambin endDate\n            const task = tasks.find(t => t.id === taskId);\n            if (task) {\n              if (task.isMilestone) {\n                updateData.end_date = task.startDate;\n              } else {\n                const duration = parseInt(newValue) || 1;\n                if (includeWeekends) {\n                  const startDate = new Date(task.startDate);\n                  startDate.setDate(startDate.getDate() + duration - 1);\n                  updateData.end_date = toISO(startDate);\n                } else {\n                  updateData.end_date = addDays(task.startDate, duration, includeWeekends);\n                }\n              }\n            }\n            break;\n          case 'startDate':\n            updateData.start_date = newValue;\n            // Si cambi startDate, actualizar tambin endDate\n            const taskForStart = tasks.find(t => t.id === taskId);\n            if (taskForStart) {\n              if (taskForStart.isMilestone) {\n                updateData.end_date = newValue;\n              } else {\n                if (includeWeekends) {\n                  const startDate = new Date(newValue);\n                  startDate.setDate(startDate.getDate() + taskForStart.duration - 1);\n                  updateData.end_date = toISO(startDate);\n                } else {\n                  updateData.end_date = addDays(newValue, taskForStart.duration, includeWeekends);\n                }\n              }\n            }\n            break;\n          case 'endDate':\n            updateData.end_date = newValue;\n            break;\n          case 'progress':\n            updateData.progress = Math.max(0, Math.min(100, parseInt(newValue) || 0));\n            break;\n          case 'priority':\n            updateData.priority = newValue;\n            break;\n          case 'assignedTo':\n            updateData.assigned_to = newValue;\n            break;\n          case 'cost':\n            updateData.cost = parseFloat(newValue) || 0;\n            break;\n          case 'businessValue':\n            updateData.business_value = parseFloat(newValue) || 0;\n            break;\n        }\n\n        // Ejecutar UPDATE en Supabase\n        supabaseService.supabase\n          .from('tasks')\n          .update(updateData)\n          .eq('id', taskId)\n          .eq('project_id', projectData.id)\n          .then(({ error }) => {\n            if (error) {\n              console.error(' Error actualizando tarea en Supabase:', error);\n              console.error('Campo:', field, 'Valor:', newValue);\n            } else {\n              console.log(` Campo \"${field}\" actualizado en Supabase exitosamente`);\n            }\n          })\n          .catch(error => {\n            console.error(' Error inesperado actualizando en Supabase:', error);\n          });\n      }\n    }\n\n    console.log(' SAVEEDIT - COMPLETADO');\n    setEditingCell(null);\n    setEditingValue('');\n  };\n\n  const cancelEdit = () => {\n    setEditingCell(null);\n    setEditingValue('');\n  };\n\n  const handleKeyDown = (e) => {\n    if (editingCell) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        saveEdit();\n      } else if (e.key === 'Escape') {\n        e.preventDefault();\n        cancelEdit();\n      }\n    }\n  };\n\n  const insertRowAfter = (taskId) => {\n    const insertIndex = tasks.findIndex(task => task.id === taskId);\n    if (insertIndex === -1) return;\n\n    const previousTask = tasks[insertIndex];\n    const newStartDate = addDays(previousTask.endDate, 1, includeWeekends);\n    const newEndDate = addDays(newStartDate, 5, includeWeekends);\n\n    const newTask = {\n      id: crypto.randomUUID(),\n      name: 'Nueva Tarea',\n      duration: 5,\n      startDate: newStartDate,\n      endDate: newEndDate,\n      progress: 0,\n      priority: 'medium',\n      status: 'in-progress', // Estatus por defecto para nuevas tareas\n      assignedTo: '',\n      cost: 0,\n      predecessors: [taskId],\n      successors: [],\n      resources: [],\n      isMilestone: false,\n      originalDuration: 5, // Guardar duracin original\n      description: ''\n    };\n\n    setTasks(prev => {\n      const newTasks = prev.slice();\n      newTasks.splice(insertIndex + 1, 0, newTask);\n      return newTasks;\n    });\n  };\n\n  // NUEVAS FUNCIONES PARA EDITAR DEPENDENCIAS (SOLO PREDECESORAS)\n  const startEditingDependencies = (taskId) => {\n    const task = tasks.find(t => t.id === taskId);\n    if (!task) return;\n\n    // Convertir IDs a nmeros de wbsCode para mostrar nmeros correctos\n    const predecessorNumbers = task.predecessors.map(predId => {\n      const predTask = tasks.find(t => t.id === predId);\n      return predTask ? parseInt(predTask.wbsCode) : null;\n    }).filter(Boolean);\n\n    setEditingCell({ taskId, field: 'dependencies' });\n    setEditingValue(predecessorNumbers.join(', ')); // Mostrar nmeros de wbsCode\n    console.log(` Editando dependencias de tarea ${task.wbsCode}: mostrando nmeros wbsCode [${predecessorNumbers.join(', ')}]`);\n  };\n\n  const saveDependenciesEdit = () => {\n    if (!editingCell || editingCell.field !== 'dependencies') return;\n\n    const { taskId } = editingCell;\n    try {\n      // Procesar nmeros separados por comas (nmeros de wbsCode)\n      const predecessorNumbers = editingValue\n        .split(',')\n        .map(num => parseInt(num.trim()))\n        .filter(num => !isNaN(num) && num > 0);\n\n      console.log(` Guardando dependencias para tarea ${taskId}: nmeros wbsCode [${predecessorNumbers.join(', ')}]`);\n\n      // Convertir nmeros de wbsCode a IDs\n      const predecessorIds = predecessorNumbers.map(wbsCode => {\n        const predTask = tasks.find(t => parseInt(t.wbsCode) === wbsCode);\n        if (predTask) {\n          console.log(` Predecesora encontrada: wbsCode ${wbsCode}  ID ${predTask.id}`);\n          return predTask.id;\n        } else {\n          console.warn(` Predecesora no encontrada: wbsCode ${wbsCode}`);\n          return null;\n        }\n      }).filter(id => id); // Filtrar IDs vlidos\n\n      setTasks(prev => prev.map(task => {\n        if (task.id === taskId) {\n          // Clonacin segura del objeto task\n          const updatedTask = {\n            id: task.id,\n            wbsCode: task.wbsCode,\n            name: task.name,\n            duration: task.duration,\n            startDate: task.startDate,\n            endDate: task.endDate,\n            progress: task.progress,\n            predecessors: [...(task.predecessors || [])],\n            cost: task.cost,\n            priority: task.priority,\n            assignedTo: task.assignedTo,\n            isMilestone: task.isMilestone,\n            isCritical: task.isCritical,\n            originalDuration: task.originalDuration,\n            earlyStart: task.earlyStart,\n            earlyFinish: task.earlyFinish,\n            lateStart: task.lateStart,\n            lateFinish: task.lateFinish,\n            totalFloat: task.totalFloat,\n            freeFloat: task.freeFloat,\n            description: task.description,\n            resources: [...(task.resources || [])],\n            workPackageId: task.workPackageId,\n            status: task.status,\n            successors: [...(task.successors || [])]\n          };\n          updatedTask.predecessors = predecessorIds;\n          updatedTask.successors = []; // Limpiar sucesoras\n\n          // Sincronizar dependencias bidireccionalmente (solo predecesoras)\n          syncDependencies(taskId, predecessorIds, []);\n\n          return updatedTask;\n        }\n        return task;\n      }));\n\n      //  FIX: Sincronizar con Supabase inmediatamente\n      if (useSupabase && projectData?.id) {\n        const updateData = {\n          predecessors: predecessorIds,\n          updated_at: new Date().toISOString()\n        };\n\n        supabaseService.supabase\n          .from('tasks')\n          .update(updateData)\n          .eq('id', taskId)\n          .eq('project_id', projectData.id)\n          .then(({ error }) => {\n            if (error) {\n              console.error(' Error actualizando predecesoras en Supabase:', error);\n            } else {\n              console.log(' Predecesoras actualizadas en Supabase exitosamente');\n            }\n          })\n          .catch(error => {\n            console.error(' Error inesperado actualizando predecesoras:', error);\n          });\n      }\n\n      setEditingCell(null);\n      setEditingValue('');\n    } catch (error) {\n      console.error('Error al guardar dependencias:', error);\n      setEditingCell(null);\n      setEditingValue('');\n    }\n  };\n\n  // Funcin para crear la tarea desde el modal\n  const createTaskFromModal = (insertIndexOverride = null) => {\n    try {\n      console.log(' NUEVO SISTEMA - Creando tarea desde modal');\n      console.log(' NUEVO SISTEMA - Datos completos del modal:', newTaskData);\n      console.log(' NUEVO SISTEMA - Predecesoras seleccionadas:', newTaskData.selectedPredecessors);\n      console.log(' NUEVO SISTEMA - Sucesoras seleccionadas:', newTaskData.selectedSuccessors);\n      // Usar insertIndexOverride si est disponible, sino usar el del estado\n      const finalInsertIndex = insertIndexOverride !== null ? insertIndexOverride : newTaskData.insertIndex;\n      const finalInsertAfterTaskId = newTaskData.insertAfterTaskId;\n\n      console.log(' DEBUG - Valores de insercin:', {\n        insertIndex: newTaskData.insertIndex,\n        insertAfterTaskId: newTaskData.insertAfterTaskId,\n        insertIndexType: typeof newTaskData.insertIndex,\n        insertAfterTaskIdType: typeof newTaskData.insertAfterTaskId,\n        insertIndexOverride: insertIndexOverride,\n        finalInsertIndex: finalInsertIndex\n      });\n\n      // Validaciones\n      if (!newTaskData.name.trim()) {\n        alert('Por favor ingresa un nombre para la tarea');\n        return;\n      }\n\n      if (newTaskData.duration <= 0) {\n        alert('La duracin debe ser mayor a 0');\n        return;\n      }\n\n      // Generar ID nico usando UUID para evitar conflictos\n      const generateUniqueId = () => {\n        // Generar un UUID vlido directamente\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          const r = Math.random() * 16 | 0;\n          const v = c === 'x' ? r : (r & 0x3 | 0x8);\n          return v.toString(16);\n        });\n      };\n\n      // Generar cdigo WBS nico\n      const generateUniqueWbs = () => {\n        let counter = 1;\n        let newWbs;\n        do {\n          newWbs = `1.${counter}`;\n          counter++;\n        } while (tasks.some(task => task.wbsCode === newWbs));\n        return newWbs;\n      };\n\n      const newTaskId = generateUniqueId();\n      const newWbsCode = generateUniqueWbs();\n\n      console.log(' DEBUG - IDs generados:', {\n        newTaskId,\n        newWbsCode,\n        insertIndex: newTaskData.insertIndex,\n        insertAfterTaskId: newTaskData.insertAfterTaskId\n      });\n\n      // Crear nueva tarea\n      console.log(' DEBUG - Creando tarea con dependencias:', {\n        selectedPredecessors: newTaskData.selectedPredecessors,\n        selectedSuccessors: newTaskData.selectedSuccessors,\n        predecessorsLength: newTaskData.selectedPredecessors.length,\n        successorsLength: newTaskData.selectedSuccessors.length\n      });\n\n      const newTask = {\n        id: newTaskId,\n        wbsCode: newWbsCode,\n        name: newTaskData.name.trim(),\n        duration: newTaskData.duration,\n        startDate: newTaskData.startDate,\n        endDate: newTaskData.endDate,\n        progress: 0,\n        predecessors: newTaskData.selectedPredecessors.slice(),\n        successors: newTaskData.selectedSuccessors.slice(),\n        resources: [],\n        cost: newTaskData.cost,\n        businessValue: newTaskData.businessValue || 0,  //  NUEVO: Valor de negocio\n        isMilestone: false,\n        isCritical: false,\n        originalDuration: newTaskData.duration, // Guardar duracin original\n        earlyStart: newTaskData.startDate,\n        earlyFinish: newTaskData.endDate,\n        lateStart: newTaskData.startDate,\n        lateFinish: newTaskData.endDate,\n        totalFloat: 0,\n        freeFloat: 0,\n        status: 'pending',\n        // Conexin con EVM\n        workPackageId: newTaskId,\n        plannedValue: 0,\n        earnedValue: 0,\n        actualCost: 0,\n        // Campos adicionales\n        description: newTaskData.description,\n        priority: newTaskData.priority,\n        assignedTo: newTaskData.assignedTo,\n        createdDate: toISO(new Date()),\n        lastModified: toISO(new Date())\n      };\n\n      console.log(' NUEVO SISTEMA - Tarea creada:', newTask);\n      console.log(' DEBUG - Dependencias en la tarea creada:', {\n        predecessors: newTask.predecessors,\n        successors: newTask.successors,\n        predecessorsLength: newTask.predecessors.length,\n        successorsLength: newTask.successors.length\n      });\n      console.log(' NUEVO SISTEMA - Dependencias seleccionadas:', {\n        predecessors: newTaskData.selectedPredecessors,\n        successors: newTaskData.selectedSuccessors\n      });\n\n      // Agregar la tarea al estado y sincronizar dependencias en una sola operacin\n      console.log(' NUEVO SISTEMA - Llamando a setTasks con nueva tarea');\n      console.log(' NUEVO SISTEMA - Tareas actuales antes de agregar:', tasks.length);\n\n      setTasks(prev => {\n        console.log(' NUEVO SISTEMA - setTasks ejecutndose, tareas previas:', prev.length);\n        console.log(' DEBUG - Tarea a insertar:', {\n          id: newTask.id,\n          name: newTask.name,\n          wbsCode: newTask.wbsCode\n        });\n        let updatedTasks;\n\n        // Si hay una posicin especfica de insercin, insertar ah\n        console.log(' DEBUG - Verificando insertIndex:', {\n          insertIndex: newTaskData.insertIndex,\n          insertIndexUndefined: newTaskData.insertIndex === undefined,\n          insertAfterTaskId: newTaskData.insertAfterTaskId,\n          finalInsertIndex: finalInsertIndex,\n          finalInsertIndexUndefined: finalInsertIndex === undefined\n        });\n\n        if (finalInsertIndex !== undefined && finalInsertIndex !== null) {\n          // Usar el ndice calculado previamente\n          const newTasks = prev.slice();\n          newTasks.splice(finalInsertIndex, 0, newTask);\n          updatedTasks = newTasks;\n          console.log(' NUEVA FUNCIN - Tarea insertada en posicin:', finalInsertIndex);\n        } else if (newTaskData.insertAfterTaskId) {\n          // Fallback: buscar por ID de tarea\n          const insertIndex = prev.findIndex(task => task.id === newTaskData.insertAfterTaskId);\n          if (insertIndex !== -1) {\n            // Insertar despus de la tarea especificada\n            const newTasks = prev.slice();\n            newTasks.splice(insertIndex + 1, 0, newTask);\n            updatedTasks = newTasks;\n            console.log(' NUEVA FUNCIN - Tarea insertada despus de:', insertIndex + 1);\n          } else {\n            // Si no se encuentra la tarea, agregar al final\n            const newTasks = prev.slice();\n            newTasks.push(newTask);\n            updatedTasks = newTasks;\n            console.log(' NUEVA FUNCIN - Tarea agregada al final (posicin no encontrada)');\n          }\n        } else {\n          // Insercin normal al final\n          const newTasks = prev.slice();\n          newTasks.push(newTask);\n          updatedTasks = newTasks;\n          console.log(' NUEVO SISTEMA - Tarea agregada al final. Total tareas:', updatedTasks.length);\n        }\n\n        //  NO ORDENAR por wbsCode despus de insercin manual\n        // La tarea ya fue insertada en la posicin correcta arriba\n        // Ordenar por wbsCode movera la tarea nueva a una posicin incorrecta\n        // Solo renumerar wbsCodes para mantener secuencia correcta 1, 2, 3, ...\n        updatedTasks = updatedTasks.map((task, index) => ({\n          ...task,\n          wbsCode: index + 1\n        }));\n\n        console.log(' NUEVA FUNCIN - wbsCode actualizados para mantener secuencia:',\n          updatedTasks.map(t => ({ name: t.name, wbsCode: t.wbsCode }))\n        );\n\n        // Verificar que la tarea agregada mantenga sus dependencias y posicin\n        const addedTask = updatedTasks.find(t => t.id === newTaskId);\n        const addedTaskIndex = updatedTasks.findIndex(t => t.id === newTaskId);\n        console.log(' DEBUG - Tarea en el estado despus de agregar:', {\n          id: addedTask?.id,\n          name: addedTask?.name,\n          position: addedTaskIndex,\n          wbsCode: addedTask?.wbsCode,\n          predecessors: addedTask?.predecessors,\n          successors: addedTask?.successors,\n          predecessorsLength: addedTask?.predecessors?.length,\n          successorsLength: addedTask?.successors?.length\n        });\n\n        // Log de las primeras 15 tareas para verificar el orden\n        console.log(' DEBUG - Primeras 15 tareas despus de insercin:',\n          updatedTasks.slice(0, 15).map((t, i) => ({\n            position: i,\n            wbsCode: t.wbsCode,\n            name: t.name,\n            id: t.id\n          }))\n        );\n\n        // Sincronizar dependencias bidireccionalmente inmediatamente\n        if (newTaskData.selectedPredecessors.length > 0 || newTaskData.selectedSuccessors.length > 0) {\n          console.log(' NUEVO SISTEMA - Sincronizando dependencias...');\n\n          return updatedTasks.map(task => {\n            // Si es la tarea que acabamos de crear, mantener sus dependencias\n            if (task.id === newTaskId) {\n              return task;\n            }\n\n            // Para todas las dems tareas, actualizar sus dependencias inversas\n            let updatedTask = {\n              id: task.id,\n              wbsCode: task.wbsCode,\n              name: task.name,\n              duration: task.duration,\n              startDate: task.startDate,\n              endDate: task.endDate,\n              progress: task.progress,\n              predecessors: [...(task.predecessors || [])],\n              cost: task.cost,\n              priority: task.priority,\n              assignedTo: task.assignedTo,\n              isMilestone: task.isMilestone,\n              isCritical: task.isCritical,\n              originalDuration: task.originalDuration,\n              earlyStart: task.earlyStart,\n              earlyFinish: task.earlyFinish,\n              lateStart: task.lateStart,\n              lateFinish: task.lateFinish,\n              totalFloat: task.totalFloat,\n              freeFloat: task.freeFloat,\n              description: task.description,\n              resources: [...(task.resources || [])],\n              workPackageId: task.workPackageId,\n              status: task.status,\n              successors: [...(task.successors || [])]\n            };\n\n            // Si esta tarea est en las predecesoras de la nueva tarea,\n            // agregar la nueva tarea a sus sucesoras\n            if (newTaskData.selectedPredecessors.includes(task.id)) {\n              if (!updatedTask.successors.includes(newTaskId)) {\n                updatedTask.successors = updatedTask.successors.slice().concat([newTaskId]);\n                console.log(` NUEVO SISTEMA - Agregando ${newTaskId} como sucesora de ${task.id}`);\n              }\n            }\n\n            // Si esta tarea est en las sucesoras de la nueva tarea,\n            // agregar la nueva tarea a sus predecesoras\n            if (newTaskData.selectedSuccessors.includes(task.id)) {\n              if (!updatedTask.predecessors.includes(newTaskId)) {\n                updatedTask.predecessors = [...(updatedTask.predecessors || []), newTaskId];\n                console.log(` NUEVO SISTEMA - Agregando ${newTaskId} como predecesora de ${task.id}`);\n              }\n            }\n\n            return updatedTask;\n          });\n        }\n\n        console.log(' DEBUG - setTasks retornando:', {\n          totalTasks: updatedTasks.length,\n          newTaskIncluded: updatedTasks.some(t => t.id === newTaskId),\n          newTaskPosition: updatedTasks.findIndex(t => t.id === newTaskId)\n        });\n        return updatedTasks;\n      });\n\n      // Verificar que el estado se actualiz correctamente\n      setTimeout(() => {\n        console.log(' DEBUG - Estado despus de setTasks:', {\n          tasksLength: tasks.length,\n          newTaskExists: tasks.some(t => t.id === newTaskId)\n        });\n      }, 100);\n\n      // ELIMINADO: Creacin de Work Package - ya no es necesaria\n\n      // Cerrar modal y limpiar datos\n      setShowAddTaskModal(false);\n      setNewTaskData({\n        name: '',\n        duration: 5,\n        startDate: toISO(new Date()),\n        endDate: addDays(toISO(new Date()), 5),\n        description: '',\n        priority: 'medium',\n        assignedTo: '',\n        cost: 0,\n        selectedPredecessors: [],\n        insertAfterTaskId: null // Limpiar la posicin de insercin\n      });\n\n      console.log(' NUEVO SISTEMA - Proceso completado exitosamente');\n\n      // Verificar el estado final de las tareas\n      setTimeout(() => {\n        console.log(' DEBUG - Estado final de todas las tareas:');\n        setTasks(currentTasks => {\n          console.log(' DEBUG - Total de tareas despus de crear:', currentTasks.length);\n          console.log(' DEBUG - ltimas 3 tareas:', currentTasks.slice(-3).map(t => ({ name: t.name, wbsCode: t.wbsCode, id: t.id })));\n          currentTasks.forEach(task => {\n            console.log(` DEBUG - Tarea ${task.name} (${task.id}):`, {\n              predecessors: task.predecessors,\n              successors: task.successors,\n              predecessorsLength: task.predecessors?.length || 0,\n              successorsLength: task.successors?.length || 0\n            });\n          });\n          return currentTasks; // No modificar, solo para logging\n        });\n      }, 100);\n\n    } catch (error) {\n      console.error(' NUEVO SISTEMA - Error al crear tarea:', error);\n      alert('Error al crear la tarea. Por favor intenta de nuevo.');\n    }\n  };\n\n  // Guardar baseline\n  const saveBaseline = () => {\n    try {\n      // Clonacin segura de las tareas para el baseline\n      const baselineData = tasksWithCPM.map(task => ({\n        id: task.id,\n        wbsCode: task.wbsCode,\n        name: task.name,\n        duration: task.duration,\n        startDate: task.startDate,\n        endDate: task.endDate,\n        progress: task.progress,\n        priority: task.priority,\n        assignedTo: task.assignedTo,\n        cost: task.cost,\n        predecessors: [...(task.predecessors || [])],\n        successors: [...(task.successors || [])],\n        isMilestone: task.isMilestone,\n        originalDuration: task.originalDuration,\n        description: task.description,\n        resources: [...(task.resources || [])],\n        earlyStart: task.earlyStart,\n        earlyFinish: task.earlyFinish,\n        lateStart: task.lateStart,\n        lateFinish: task.lateFinish,\n        isCritical: task.isCritical,\n        slack: task.slack\n      }));\n\n      setBaselineTasks(baselineData);\n      setShowBaseline(true);\n      alert('Baseline guardado exitosamente');\n    } catch (error) {\n      console.error('Error al guardar baseline:', error);\n      alert('Error al guardar el baseline. Por favor intenta de nuevo.');\n    }\n  };\n\n  // Funciones auxiliares de UI\n  const getStatusColor = (status) => {\n    switch (status) {\n      case 'completed': return 'bg-green-500';\n      case 'in-progress': return 'bg-blue-500';\n      case 'delayed': return 'bg-red-500';\n      default: return 'bg-gray-300';\n    }\n  };\n\n  const getStatusIcon = (status) => {\n    switch (status) {\n      case 'completed': return '';\n      case 'in-progress': return '';\n      case 'delayed': return '';\n      default: return '';\n    }\n  };\n\n  const getRiskColor = (level) => {\n    switch (level) {\n      case 'Low': return 'text-green-600 bg-green-100';\n      case 'Medium': return 'text-yellow-600 bg-yellow-100';\n      case 'High': return 'text-red-600 bg-red-100';\n      default: return 'text-gray-600 bg-gray-100';\n    }\n  };\n\n  // Funcin centralizada para obtener la fecha de referencia del timeline\n  const getTimelineReferenceDate = useMemo(() => {\n    const originalStart = toISO(projectDates.start);\n\n    // CORRECCIN: Usar siempre la fecha original del proyecto, sin aplicar findFirstWorkingDay\n    // Esto asegura que las barras del Gantt se alineen exactamente con las fechas de la tabla\n    const referenceDate = originalStart;\n\n    // Debug para verificar el desplazamiento de fechas\n    console.log(' TIMELINE REFERENCE DATE CALCULADO (CORREGIDO):', {\n      originalProjectStart: originalStart,\n      includeWeekends: includeWeekends,\n      referenceDate: referenceDate,\n      isShifted: originalStart !== referenceDate,\n      shiftDays: originalStart !== referenceDate ?\n        Math.round((new Date(referenceDate) - new Date(originalStart)) / (1000 * 60 * 60 * 24)) : 0,\n      note: 'Usando fecha original sin aplicar findFirstWorkingDay para alineacin perfecta con tabla'\n    });\n\n    return referenceDate;\n  }, [projectDates.start, includeWeekends]);\n\n  // Lnea \"Hoy\"\n  const todayLeftPx = useMemo(() => {\n    // Usar la funcin centralizada para obtener la fecha de referencia\n    const todayISO = toISO(new Date());\n    // Para la lnea \"HOY\" usar la misma configuracin que las barras\n    // NUEVO ALGORITMO: Usar ndice de columnas\n    const days = findColumnIndex(todayISO, getTimelineReferenceDate, includeWeekends);\n\n\n    return Math.min(Math.max(0, days * pxPerDay), chartWidthPx);\n  }, [getTimelineReferenceDate, pxPerDay, chartWidthPx, includeWeekends]);\n\n  // Barras Gantt\n  const generateGanttBars = () => {\n    // Usar la funcin centralizada para obtener la fecha de referencia\n    const pStart = getTimelineReferenceDate;\n\n    // Debug temporal para verificar la referencia de barras\n    console.log(' GANTT BARS REFERENCIA:', {\n      pStart: pStart,\n      projectDatesStart: toISO(projectDates.start),\n      includeWeekends: includeWeekends,\n      pxPerDay: pxPerDay\n    });\n\n    return tasksWithCPM.map((task) => {\n      //  CORRECCIN DEFINITIVA: Usar siempre las fechas originales de la tabla, NO las calculadas por CPM\n      // Las fechas que rigen son las de la vista tabla (startDate y endDate)\n      const tableStartDate = task.startDate; // Fecha original de la tabla\n      const tableEndDate = task.endDate;     // Fecha original de la tabla\n\n      //  CORRECCIN FINAL: Usar findColumnIndex() para respetar la configuracin includeWeekends\n      // Esto asegura que las barras se alineen exactamente con el timeline\n      const leftDays = findColumnIndex(tableStartDate, pStart, includeWeekends);\n\n      // Calcular duracin usando la diferencia de columnas visibles\n      const endColumnIndex = findColumnIndex(tableEndDate, pStart, includeWeekends);\n      const durDays = Math.max(1, endColumnIndex - leftDays + 1);\n\n      // Debug temporal para verificar que el nuevo algoritmo funciona\n      if (task.name.includes('Aprobacin') || task.name.includes('Generacin') || task.name.includes('Envo') || task.name.includes('Solucin')) {\n        console.log(' GANTT USANDO FECHAS DE TABLA (CORREGIDO DEFINITIVAMENTE):');\n        console.log('   taskName:', task.name);\n        console.log('    FECHAS DE TABLA (las que rigen):');\n        console.log('   - tableStartDate:', tableStartDate);\n        console.log('   - tableEndDate:', tableEndDate);\n        console.log('    FECHAS CALCULADAS POR CPM (solo informativas):');\n        console.log('   - earlyStart:', task.earlyStart);\n        console.log('   - earlyFinish:', task.earlyFinish);\n        console.log('    CLCULOS GANTT (usando findColumnIndex corregido para alineacin perfecta):');\n        console.log('   - projectStart:', pStart);\n        console.log('   - includeWeekends:', includeWeekends);\n        console.log('   - leftDays (findColumnIndex corregido):', leftDays);\n        console.log('   - endColumnIndex (findColumnIndex corregido):', endColumnIndex);\n        console.log('   - durDays (diferencia de columnas):', durDays);\n        console.log('   - leftPx calculado:', leftDays * pxPerDay);\n        console.log('   - widthPx calculado:', durDays * pxPerDay);\n\n        // Debug especfico para la primera tarea\n        if (task.name.includes('Aprobacin')) {\n          console.log(' DEBUG ESPECFICO TAREA 1:');\n          console.log('   - Fecha inicio tabla:', tableStartDate);\n          console.log('   - Fecha referencia proyecto:', pStart);\n          console.log('   - includeWeekends:', includeWeekends);\n          console.log('   - leftDays (findColumnIndex corregido):', leftDays);\n          console.log('   - leftPx calculado:', leftDays * pxPerDay);\n          console.log('   - Debera ser 1?', tableStartDate === pStart ? 'S (ahora corregido)' : 'NO');\n        }\n\n        // Debug para comparar con lo que muestra la tabla\n        const tableDisplayStart = new Date(tableStartDate).toLocaleDateString('es-ES');\n        const tableDisplayEnd = new Date(tableEndDate).toLocaleDateString('es-ES');\n        console.log('    FECHAS MOSTRADAS EN TABLA:');\n        console.log('   - Inicio:', tableDisplayStart);\n        console.log('   - Fin:', tableDisplayEnd);\n        console.log('   - Las barras se alinean con estas fechas?', 'S (usando findColumnIndex corregido)');\n        console.log('   - Respeta includeWeekends?', 'S (usando findColumnIndex corregido)');\n        console.log('   - Desfase de un da corregido?', 'S (cambio de < a <= en findColumnIndex)');\n\n        // Debug para verificar si hay diferencia entre fechas de tabla y CPM\n        if (tableStartDate !== task.earlyStart || tableEndDate !== task.earlyFinish) {\n          console.log('    DIFERENCIA ENTRE TABLA Y CPM:');\n          console.log('   - Tabla inicio:', tableStartDate, 'vs CPM inicio:', task.earlyStart);\n          console.log('   - Tabla fin:', tableEndDate, 'vs CPM fin:', task.earlyFinish);\n          console.log('    GANTT USAR FECHAS DE TABLA (correcto)');\n        }\n      }\n\n\n      return {\n        id: task.id,\n        wbsCode: task.wbsCode,\n        name: task.name,\n        duration: task.duration,\n        startDate: tableStartDate,  // CORRECCIN: Usar fecha de tabla\n        endDate: tableEndDate,      // CORRECCIN: Usar fecha de tabla\n        progress: task.progress,\n        predecessors: [...(task.predecessors || [])],\n        cost: task.cost,\n        priority: task.priority,\n        assignedTo: task.assignedTo,\n        isMilestone: task.isMilestone,\n        isCritical: task.isCritical,\n        originalDuration: task.originalDuration,\n        earlyStart: task.earlyStart,\n        earlyFinish: task.earlyFinish,\n        lateStart: task.lateStart,\n        lateFinish: task.lateFinish,\n        totalFloat: task.totalFloat,\n        freeFloat: task.freeFloat,\n        description: task.description,\n        resources: [...(task.resources || [])],\n        workPackageId: task.workPackageId,\n        status: task.status,\n        successors: [...(task.successors || [])],\n        leftPx: leftDays * pxPerDay,\n        widthPx: task.isMilestone ? 12 : Math.max(1, durDays * pxPerDay), // Hitos = 12px de ancho\n      };\n    });\n  };\n\n\n  // Generar conexiones del diagrama de red basadas en dependencias\n  const generateNetworkEdges = useMemo(() => {\n    if (tasksWithCPM.length === 0) return [];\n\n    const edges = [];\n\n    tasksWithCPM.forEach(task => {\n      // Crear conexiones desde predecesoras hacia esta tarea\n      task.predecessors.forEach(predId => {\n        const predTask = tasksWithCPM.find(t => t.id === predId);\n        if (predTask) {\n          edges.push({\n            id: `${predId}-${task.id}`,\n            source: predId,\n            target: task.id,\n            type: 'predecessor',\n            isCritical: task.isCritical && predTask.isCritical\n          });\n        }\n      });\n    });\n\n    return edges;\n  }, [tasksWithCPM]);\n\n  const networkEdges = generateNetworkEdges;\n\n  const generateTimelineMarkers = () => {\n    const markers = [];\n\n    // Usar fechas del proyecto si estn disponibles, sino usar fechas por defecto\n    try {\n      const start = new Date(projectDates?.start || new Date());\n      const end = new Date(projectDates?.end || new Date(Date.now() + 30 * 24 * 60 * 60 * 1000));\n      const totalDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24));\n\n      for (let i = 0; i <= Math.min(10, totalDays); i++) {\n        const date = new Date(start);\n        date.setDate(date.getDate() + Math.floor((totalDays * i) / 10));\n\n        markers.push({\n          x: 50 + (i / 10) * 1100,\n          label: date.toLocaleDateString('es', { month: 'short', day: 'numeric' })\n        });\n      }\n    } catch (error) {\n      // Si hay error, crear marcadores por defecto\n      for (let i = 0; i <= 10; i++) {\n        const date = new Date();\n        date.setDate(date.getDate() + i);\n\n        markers.push({\n          x: 50 + (i / 10) * 1100,\n          label: date.toLocaleDateString('es', { month: 'short', day: 'numeric' })\n        });\n      }\n    }\n\n    return markers;\n  };\n\n\n  const autoFitNetworkDiagram = () => {\n    if (!networkSvgRef.current || networkNodes.length === 0) return;\n\n    // Calcular el bounding box de todos los nodos\n    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n\n    networkNodes.forEach(node => {\n      minX = Math.min(minX, node.x);\n      minY = Math.min(minY, node.y);\n      maxX = Math.max(maxX, node.x + node.width);\n      maxY = Math.max(maxY, node.y + node.height);\n    });\n\n    const contentWidth = maxX - minX;\n    const contentHeight = maxY - minY;\n\n    if (contentWidth === 0 || contentHeight === 0) return;\n\n    // Calcular zoom para que el contenido quepa en el viewport\n    const viewportWidth = 1200;\n    const viewportHeight = 600;\n\n    const scaleX = viewportWidth / contentWidth;\n    const scaleY = viewportHeight / contentHeight;\n    const optimalZoom = Math.min(scaleX, scaleY, 2); // Mximo 2x zoom\n\n    const newZoom = Math.max(0.3, optimalZoom);\n    setNetworkZoom(newZoom);\n\n    // Centrar el contenido\n    const centerX = (minX + maxX) / 2;\n    const centerY = (minY + maxY) / 2;\n    const newPanX = centerX - viewportWidth / (2 * newZoom);\n    const newPanY = centerY - viewportHeight / (2 * newZoom);\n\n    setNetworkPan({ x: newPanX, y: newPanY });\n  };\n\n  // Funciones de zoom y pan para el diagrama de red\n  const zoomIn = () => {\n    setNetworkZoom(prev => Math.min(prev * 1.2, 3));\n  };\n\n  const zoomOut = () => {\n    setNetworkZoom(prev => Math.max(prev / 1.2, 0.5));\n  };\n\n  const resetZoom = () => {\n    setNetworkZoom(1);\n    setNetworkPan({ x: 0, y: 0 });\n  };\n\n  // Funciones para arrastrar el diagrama (pan)\n  const handleDiagramMouseDown = (e) => {\n    // Solo si no se est arrastrando un nodo\n    if (draggedNode) return;\n\n    e.preventDefault();\n    setIsPanning(true);\n    setPanStart({ x: e.clientX, y: e.clientY });\n    setLastPan({ x: networkPan.x, y: networkPan.y });\n  };\n\n  const handleDiagramMouseMove = (e) => {\n    if (!isPanning) return;\n\n    e.preventDefault();\n    const deltaX = e.clientX - panStart.x;\n    const deltaY = e.clientY - panStart.y;\n\n    // Invertir el movimiento para que sea intuitivo\n    setNetworkPan({\n      x: lastPan.x - deltaX,\n      y: lastPan.y - deltaY\n    });\n  };\n\n  const handleDiagramMouseUp = (e) => {\n    if (isPanning) {\n      setIsPanning(false);\n    }\n  };\n\n  const handleDiagramMouseLeave = (e) => {\n    if (isPanning) {\n      setIsPanning(false);\n    }\n  };\n\n  // Funciones de arrastrar y soltar para nodos\n  const handleNodeMouseDown = (e, nodeId) => {\n    e.preventDefault();\n    const node = networkNodes.find(n => n.id === nodeId);\n    if (node) {\n      setDraggedNode(nodeId);\n      const rect = e.currentTarget.getBoundingClientRect();\n      setDragOffset({\n        x: e.clientX - rect.left,\n        y: e.clientY - rect.top\n      });\n    }\n  };\n\n  const handleNodeMouseMove = (e) => {\n    if (draggedNode && networkSvgRef.current) {\n      const svg = networkSvgRef.current;\n      const rect = svg.getBoundingClientRect();\n      const x = (e.clientX - rect.left) / networkZoom - dragOffset.x;\n      const y = (e.clientY - rect.top) / networkZoom - dragOffset.y;\n\n      // Actualizar posicin del nodo\n      const updatedNodes = networkNodes.map(n =>\n        n.id === draggedNode ? {\n          id: n.id,\n          taskId: n.taskId,\n          x: x,\n          y: y,\n          width: n.width,\n          height: n.height,\n          name: n.name,\n          duration: n.duration,\n          startDate: n.startDate,\n          endDate: n.endDate,\n          isCritical: n.isCritical,\n          isMilestone: n.isMilestone,\n          progress: n.progress,\n          predecessors: [...(n.predecessors || [])],\n          successors: [...(n.successors || [])]\n        } : n\n      );\n      // Aqu podras actualizar el estado de los nodos si quisieras persistir los cambios\n    }\n  };\n\n  const handleNodeMouseUp = () => {\n    setDraggedNode(null);\n    setDragOffset({ x: 0, y: 0 });\n  };\n\n  // Funcin para exportar el diagrama de red como imagen\n  const exportNetworkAsImage = () => {\n    if (networkSvgRef.current) {\n      const svg = networkSvgRef.current;\n      const svgData = new XMLSerializer().serializeToString(svg);\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      const img = new Image();\n\n      canvas.width = 1200;\n      canvas.height = 600;\n\n      img.onload = () => {\n        ctx.fillStyle = '#f9fafb';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n        ctx.drawImage(img, 0, 0);\n\n        const link = document.createElement('a');\n        link.download = `diagrama-red-${projectData.projectName}-${new Date().toISOString().split('T')[0]}.png`;\n        link.href = canvas.toDataURL('image/png');\n        link.click();\n      };\n\n      img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));\n    }\n  };\n\n  // Mtricas del diagrama de red\n  const networkMetrics = useMemo(() => {\n    const totalNodes = tasksWithCPM.length;\n    const totalEdges = tasksWithCPM.reduce((sum, t) => sum + t.predecessors.length, 0);\n    const criticalPathLength = tasksWithCPM.filter(t => t.isCritical).length;\n\n    // Log de debug para mtricas\n    console.log(' MTRICAS DEL DIAGRAMA:', {\n      totalNodes,\n      totalEdges,\n      criticalPathLength,\n      tareasConDeps: tasksWithCPM.filter(t => t.predecessors.length > 0).length,\n      detalleDeps: tasksWithCPM.map(t => ({\n        id: t.id,\n        name: t.name,\n        predecessors: t.predecessors,\n        count: t.predecessors.length\n      }))\n    });\n\n    // Calcular nivel mximo\n    const levels = new Map();\n    const visited = new Set();\n\n    const calculateLevel = (taskId, currentLevel = 0, visiting = new Set()) => {\n      if (visited.has(taskId)) return levels.get(taskId) || 0;\n\n      // Detectar dependencia circular\n      if (visiting.has(taskId)) {\n        console.warn('Dependencia circular detectada en tarea (anlisis):', taskId);\n        levels.set(taskId, currentLevel);\n        visited.add(taskId);\n        return currentLevel;\n      }\n\n      visiting.add(taskId);\n      visited.add(taskId);\n\n      const task = tasksWithCPM.find(t => t.id === taskId);\n      if (!task) {\n        visiting.delete(taskId);\n        return currentLevel;\n      }\n\n      let maxPredLevel = currentLevel;\n      for (const predId of task.predecessors) {\n        const predLevel = calculateLevel(predId, currentLevel + 1, visiting);\n        maxPredLevel = Math.max(maxPredLevel, predLevel);\n      }\n\n      levels.set(taskId, maxPredLevel);\n      visiting.delete(taskId);\n      return maxPredLevel;\n    };\n\n    for (const task of tasksWithCPM) {\n      calculateLevel(task.id);\n    }\n\n    const maxDepth = Math.max(...levels.values(), 0);\n\n    return {\n      totalNodes,\n      totalEdges,\n      criticalPathLength,\n      maxDepth\n    };\n  }, [tasksWithCPM]);\n\n  // Encabezados de timeline\n  const generateTimelineHeaders = () => {\n    const headers = [];\n    // Usar la funcin centralizada para obtener la fecha de referencia\n    const startReference = getTimelineReferenceDate;\n    const start = new Date(startReference);\n    const end = new Date(toISO(projectDates.end));\n\n    // Debug temporal para verificar el rango de headers\n    console.log(' TIMELINE HEADERS RANGO:', {\n      startDate: toISO(start),\n      endDate: toISO(end),\n      ganttScale: ganttScale,\n      projectDatesStart: toISO(projectDates.start),\n      projectDatesEnd: toISO(projectDates.end),\n      includeWeekends: includeWeekends,\n      startReference: toISO(startReference),\n      pxPerDay: pxPerDay,\n      chartWidthPx: chartWidthPx\n    });\n\n    if (ganttScale === 'days') {\n      const cur = new Date(start);\n      while (cur <= end) {\n        // Solo mostrar das que deben ser incluidos segn la configuracin\n        if (includeWeekends || isWorkingDay(cur)) {\n          headers.push({\n            label: cur.getDate(),\n            sub: cur.toLocaleDateString('es', { month: 'short' }),\n            width: pxPerDay\n          });\n        }\n        cur.setDate(cur.getDate() + 1);\n      }\n    } else if (ganttScale === 'weeks') {\n      const cur = new Date(start);\n      while (cur <= end) {\n        const labelStart = new Date(cur);\n        const labelEnd = new Date(cur);\n        labelEnd.setDate(labelEnd.getDate() + 6);\n        const remaining = Math.min(7, diffDaysExclusive(labelStart, addDays(end, 1, includeWeekends), includeWeekends));\n        headers.push({\n          label: `S ${labelStart.getDate()}${labelEnd.getDate()}`,\n          sub: labelStart.toLocaleDateString('es', { month: 'short' }),\n          width: remaining * pxPerDay\n        });\n        cur.setDate(cur.getDate() + 7);\n      }\n    } else {\n      const cur = new Date(start.getFullYear(), start.getMonth(), 1);\n      while (cur <= end) {\n        const next = new Date(cur.getFullYear(), cur.getMonth() + 1, 1);\n        const spanDays = diffDaysExclusive(toISO(cur), toISO(next), includeWeekends);\n        headers.push({\n          label: cur.toLocaleDateString('es', { month: 'short' }),\n          sub: cur.getFullYear(),\n          width: spanDays * pxPerDay\n        });\n        cur.setMonth(cur.getMonth() + 1);\n      }\n    }\n\n    // Debug: verificar cuntos headers se generaron\n    console.log(' TIMELINE HEADERS GENERADOS:', {\n      totalHeaders: headers.length,\n      totalWidth: headers.reduce((sum, h) => sum + h.width, 0),\n      firstHeader: headers[0],\n      lastHeader: headers[headers.length - 1]\n    });\n\n    return headers;\n  };\n\n  // Componente simplificado - sin caso de negocio redundante\n\n  return (\n    <div className=\"space-y-6\">\n      {/* BARRA UNIFICADA - DISEO CON COLOR AZUL CLARO */}\n      <div className=\"bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 rounded-2xl shadow-lg p-6 mb-8 border border-blue-200 relative overflow-hidden\">\n        {/* Elementos decorativos de fondo */}\n        <div className=\"absolute top-0 right-0 w-32 h-32 bg-blue-100/30 rounded-full -translate-y-16 translate-x-16\"></div>\n        <div className=\"absolute bottom-0 left-0 w-24 h-24 bg-indigo-100/30 rounded-full translate-y-12 -translate-x-12\"></div>\n\n        <div className=\"relative z-10\">\n          {/* Header Principal */}\n          <div className=\"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6 mb-6\">\n            <div className=\"flex items-center\">\n              <div className=\"bg-blue-100 rounded-2xl p-3 mr-4\">\n                <span className=\"text-2xl\"></span>\n              </div>\n              <div>\n                <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Cronograma del Proyecto</h1>\n                <p className=\"text-gray-600 text-lg\">Gestin de tiempo, dependencias y recursos integrada con EVM</p>\n              </div>\n            </div>\n\n            {/* Botones de accin */}\n            <div className=\"flex flex-wrap gap-3\">\n              <button\n                onClick={exportToExcel}\n                className=\"bg-white text-gray-700 px-4 py-2 rounded-xl hover:bg-blue-50 flex items-center space-x-2 transition-all duration-300 border border-gray-300 hover:border-blue-300 text-sm shadow-sm\"\n              >\n                <span></span>\n                <span>Exportar</span>\n              </button>\n\n              <button\n                onClick={() => compressSchedule()}\n                className=\"bg-white text-gray-700 px-4 py-2 rounded-xl hover:bg-blue-50 flex items-center space-x-2 transition-all duration-300 border border-gray-300 hover:border-blue-300 text-sm shadow-sm\"\n                title=\"Comprimir cronograma (en desarrollo)\"\n              >\n                <span></span>\n                <span>Comprimir</span>\n              </button>\n\n\n            </div>\n          </div>\n\n          {/* Mtricas del Proyecto */}\n          <div className=\"grid grid-cols-2 lg:grid-cols-6 gap-4 mb-6\">\n            {/* ELIMINADO: Work Packages - ya no se usan */}\n\n            <div className=\"bg-white rounded-xl p-4 border border-blue-200 hover:shadow-md transition-all duration-300\">\n              <div className=\"flex items-center space-x-2 mb-2\">\n                <span className=\"text-lg\"></span>\n                <span className=\"text-sm font-medium text-blue-600\">Inicio</span>\n              </div>\n              <div className=\"text-lg font-bold text-gray-800\">\n                {tasksWithCPM.length > 0\n                  ? (() => {\n                    // CORRECCIN: Usar fechas originales de la tabla, no las calculadas por CPM\n                    const originalStartDates = tasksWithCPM.map(t => new Date(t.startDate));\n                    const minStartDate = new Date(Math.min(...originalStartDates));\n                    return minStartDate.toLocaleDateString('es');\n                  })()\n                  : projectData?.startDate ? new Date(projectData.startDate).toLocaleDateString('es') : 'N/A'\n                }\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-xl p-4 border border-blue-200 hover:shadow-md transition-all duration-300\">\n              <div className=\"flex items-center space-x-2 mb-2\">\n                <span className=\"text-lg\"></span>\n                <span className=\"text-sm font-medium text-blue-600\">Fin</span>\n              </div>\n              <div className=\"text-lg font-bold text-gray-800\">\n                {(() => {\n                  if (tasksWithCPM.length > 0) {\n                    // CORRECCIN: Usar fechas originales de la tabla, no las calculadas por CPM\n                    const originalEndDates = tasksWithCPM\n                      .filter(t => t.endDate && t.endDate !== null && t.endDate !== undefined)\n                      .map(t => {\n                        const [year, month, day] = t.endDate.split('-');\n                        return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n                      })\n                      .filter(date => !isNaN(date.getTime())); // Filtrar fechas invlidas\n\n                    const maxEndDate = new Date(Math.max(...originalEndDates));\n\n                    // Formatear fecha de manera ms precisa para evitar problemas de zona horaria\n                    const year = maxEndDate.getFullYear();\n                    const month = String(maxEndDate.getMonth() + 1).padStart(2, '0');\n                    const day = String(maxEndDate.getDate()).padStart(2, '0');\n                    const formattedDate = `${day}/${month}/${year}`;\n\n                    console.log(' DEBUG - Fecha de fin del cronograma (usando fechas de tabla):', {\n                      totalTasks: tasksWithCPM.length,\n                      originalEndDates: originalEndDates.map(d => d && !isNaN(d.getTime()) ? d.toISOString().split('T')[0] : 'N/A'),\n                      maxEndDate: maxEndDate && !isNaN(maxEndDate.getTime()) ? maxEndDate.toISOString().split('T')[0] : 'N/A',\n                      year, month, day,\n                      formattedDate: formattedDate\n                    });\n\n                    return formattedDate;\n                  }\n                  return projectData?.endDate ? new Date(projectData.endDate).toLocaleDateString('es') : 'N/A';\n                })()}\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-xl p-4 border border-blue-200 hover:shadow-md transition-all duration-300\">\n              <div className=\"flex items-center space-x-2 mb-2\">\n                <span className=\"text-lg\"></span>\n                <span className=\"text-sm font-medium text-blue-600\">Presupuesto</span>\n              </div>\n              <div className=\"text-lg font-bold text-gray-800\">\n                ${tasksWithCPM.reduce((sum, task) => sum + (task.cost || 0), 0).toLocaleString()}\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-xl p-4 border border-red-200 hover:shadow-md transition-all duration-300\">\n              <div className=\"flex items-center space-x-2 mb-2\">\n                <span className=\"text-lg\"></span>\n                <span className=\"text-sm font-medium text-red-600\">Ruta Crtica</span>\n              </div>\n              <div className=\"text-2xl font-bold text-gray-800\">{cmpResult?.criticalPathLength || 0}</div>\n              <div className=\"text-sm text-red-600\">das</div>\n            </div>\n\n            <div className=\"bg-white rounded-xl p-4 border border-red-200 hover:shadow-md transition-all duration-300\">\n              <div className=\"flex items-center space-x-2 mb-2\">\n                <span className=\"text-lg\"></span>\n                <span className=\"text-sm font-medium text-red-600\">Tareas Crticas</span>\n              </div>\n              <div className=\"text-2xl font-bold text-gray-800\">{cmpResult?.criticalPath?.length || 0}</div>\n              <div className=\"text-sm text-red-600\">tareas</div>\n            </div>\n          </div>\n\n          {/* Controles de Vista Integrados */}\n          <div className=\"bg-white/60 backdrop-blur rounded-xl p-4 border border-blue-200 mb-4\">\n            <div className=\"flex flex-col lg:flex-row items-center justify-between gap-4\">\n              <div className=\"text-center lg:text-left\">\n                <h3 className=\"text-lg font-semibold text-gray-800 mb-1 flex items-center justify-center lg:justify-start\">\n                  <span className=\"mr-2 text-xl\"></span>\n                  Selecciona la Vista\n                </h3>\n                <p className=\"text-gray-600 text-sm\">\n                  Elige la visualizacin que mejor se adapte a tu anlisis\n                </p>\n              </div>\n\n              {/* Botones de vista organizados profesionalmente */}\n              <div className=\"flex flex-wrap justify-center lg:justify-end gap-2\">\n                <button\n                  onClick={() => !isReadOnlyMode && setViewMode('gantt')}\n                  disabled={isReadOnlyMode}\n                  className={`px-4 py-2 rounded-lg font-medium text-sm transition-all duration-300 flex items-center space-x-2 ${isReadOnlyMode\n                    ? 'bg-gray-200 text-gray-400 cursor-not-allowed border border-gray-300'\n                    : viewMode === 'gantt'\n                      ? 'bg-indigo-600 text-white shadow-md hover:shadow-lg'\n                      : 'bg-white text-gray-600 hover:bg-indigo-50 hover:text-indigo-700 border border-gray-300 hover:border-indigo-300'\n                    }`}\n                  title={isReadOnlyMode ? \"Vista Gantt no disponible (modo solo lectura)\" : \"Vista Gantt\"}\n                >\n                  <span></span>\n                  <span>Gantt</span>\n                </button>\n\n                <button\n                  onClick={() => setViewMode('excel')}\n                  className={`px-4 py-2 rounded-lg font-medium text-sm transition-all duration-300 flex items-center space-x-2 ${viewMode === 'excel'\n                    ? 'bg-indigo-600 text-white shadow-md hover:shadow-lg'\n                    : 'bg-white text-gray-600 hover:bg-indigo-50 hover:text-indigo-700 border border-gray-300 hover:border-indigo-300'\n                    }`}\n                >\n                  <span></span>\n                  <span>Tabla</span>\n                </button>\n\n\n                <button\n                  onClick={() => !isReadOnlyMode && setViewMode('minutas')}\n                  disabled={isReadOnlyMode}\n                  className={`px-4 py-2 rounded-lg font-medium text-sm transition-all duration-300 flex items-center space-x-2 ${isReadOnlyMode\n                    ? 'bg-gray-200 text-gray-400 cursor-not-allowed border border-gray-300'\n                    : viewMode === 'minutas'\n                      ? 'bg-indigo-600 text-white shadow-md hover:shadow-lg'\n                      : 'bg-white text-gray-600 hover:bg-indigo-50 hover:text-indigo-700 border border-gray-300 hover:border-indigo-300'\n                    }`}\n                  title={isReadOnlyMode ? \"Tareas de minutas no disponibles (modo solo lectura)\" : \"Tareas de minutas\"}\n                >\n                  <span></span>\n                  <span>Tareas de minutas</span>\n                </button>\n              </div>\n            </div>\n          </div>\n\n          {/* Alertas bsicas */}\n          <div className=\"space-y-3\">\n            {cmpError && (\n              <div className=\"bg-red-50 border border-red-200 rounded-xl p-3\">\n                <div className=\"flex items-center\">\n                  <span className=\"mr-2 text-red-500\"></span>\n                  <span className=\"text-sm text-red-700\">Error CPM: {cmpError}</span>\n                </div>\n              </div>\n            )}\n\n            {resourceAnalysis.conflicts.length > 0 && (\n              <div className=\"bg-yellow-50 border border-yellow-200 rounded-xl p-3\">\n                <div className=\"flex items-center\">\n                  <span className=\"mr-2 text-yellow-500\"></span>\n                  <span className=\"text-sm text-yellow-700\">\n                    {resourceAnalysis.conflicts.length} conflicto(s) de recursos detectado(s)\n                  </span>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n\n\n\n\n\n      {/* Vista Tabla */}\n      {viewMode === 'excel' && (\n        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-2xl font-bold\"> Vista Tabla - Cronograma</h2>\n\n            {/* Controles de configuracin */}\n            <div className=\"flex items-center space-x-4\">\n              {/* Casilla de seleccin para fines de semana */}\n              <div className=\"flex items-center space-x-2 bg-gray-50 rounded-lg px-3 py-2\">\n                <input\n                  type=\"checkbox\"\n                  id=\"includeWeekends\"\n                  checked={includeWeekends}\n                  onChange={(e) => {\n                    e.stopPropagation();\n                    console.log(' CHECKBOX CLICK:', e.target.checked);\n                    setIncludeWeekends(e.target.checked);\n                  }}\n                  className=\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2\"\n                />\n                <label htmlFor=\"includeWeekends\" className=\"text-sm font-medium text-gray-700\">\n                  Sbados y domingos son laborables\n                </label>\n              </div>\n\n              {/* Indicador de configuracin actual */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg px-3 py-2\">\n                <div className=\"flex items-center space-x-2 text-sm\">\n                  <span className=\"text-blue-600\"> Configuracin actual:</span>\n                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${includeWeekends\n                    ? 'bg-blue-100 text-blue-800'\n                    : 'bg-green-100 text-green-800'\n                    }`}>\n                    {includeWeekends ? 'Lunes a Domingo' : 'Lunes a Viernes'}\n                  </span>\n                </div>\n              </div>\n\n              {/* Indicador de validacin de predecesoras */}\n              <div className=\"bg-green-50 border border-green-200 rounded-lg px-3 py-2\">\n                <div className=\"flex items-center space-x-2 text-sm\">\n                  <span className=\"text-green-600\"> Validacin:</span>\n                  <span className=\"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                    Predecesoras validadas\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex flex-wrap gap-2\">\n              <button\n                onClick={generateExampleExcel}\n                disabled={isReadOnlyMode}\n                className={`px-2 py-1.5 rounded text-xs flex items-center space-x-1 ${isReadOnlyMode\n                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                  : 'bg-purple-600 text-white hover:bg-purple-700'\n                  }`}\n                title={isReadOnlyMode ? \"No disponible (modo solo lectura)\" : \"Descargar archivo Excel de ejemplo con hitos\"}\n              >\n                <span></span>\n                <span>Ejemplo</span>\n              </button>\n              <button\n                onClick={() => fileInputRef.current?.click()}\n                disabled={isReadOnlyMode}\n                className={`px-2 py-1.5 rounded text-xs flex items-center space-x-1 ${isReadOnlyMode\n                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                  : 'bg-blue-600 text-white hover:bg-blue-700'\n                  }`}\n                title={isReadOnlyMode ? \"No disponible (modo solo lectura)\" : \"Importar cronograma desde Excel (reemplaza datos existentes)\"}\n              >\n                <span></span>\n                <span>Importar</span>\n              </button>\n              <button\n                onClick={() => setShowAIWizard(true)}\n                disabled={isReadOnlyMode}\n                className={`px-2 py-1.5 rounded text-xs flex items-center space-x-1 ${isReadOnlyMode\n                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                  : 'bg-gradient-to-r from-purple-600 to-pink-600 text-white hover:from-purple-700 hover:to-pink-700'\n                  }`}\n                title={isReadOnlyMode ? \"No disponible (modo solo lectura)\" : \"Generar cronograma automticamente con Asistente de IA\"}\n              >\n                <span></span>\n                <span>IA</span>\n              </button>\n\n              {/* Input de archivo oculto */}\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\".xlsx,.xls\"\n                onChange={(e) => {\n                  const file = e.target.files?.[0];\n                  if (file) {\n                    importScheduleFromExcel(file);\n                  }\n                }}\n                style={{ display: 'none' }}\n              />\n              <button\n                onClick={exportScheduleToExcel}\n                className=\"bg-green-600 text-white px-2 py-1.5 rounded text-xs hover:bg-green-700 flex items-center space-x-1\"\n              >\n                <span></span>\n                <span>Excel</span>\n              </button>\n\n              {/* Botn para recalcular valores de negocio */}\n              {projectData?.plannedValue && (\n                <button\n                  onClick={() => {\n                    console.log(' Recalculando valores de negocio manualmente...');\n                    const recalculated = recalculateBusinessValue();\n                    if (recalculated && setTasks) {\n                      setTasks(recalculated);\n                    }\n                  }}\n                  className={`px-2 py-1.5 rounded text-xs flex items-center space-x-1 ${isReadOnlyMode || isBusinessValueSyncing\n                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                    : 'bg-indigo-600 text-white hover:bg-indigo-700'\n                    }`}\n                  title={isReadOnlyMode ? \"No disponible (modo solo lectura)\" : \"Recalcular valores de negocio de todas las tareas basado en TIR y costos\"}\n                  disabled={isReadOnlyMode || isBusinessValueSyncing}\n                >\n                  <span>{isBusinessValueSyncing ? '' : ''}</span>\n                  <span className=\"whitespace-nowrap\">{isBusinessValueSyncing ? 'Sync...' : 'Valores'}</span>\n                </button>\n              )}\n            </div>\n          </div>\n\n          {/* Tabla tipo Excel */}\n          <div className=\"overflow-y-auto max-h-[85vh] border border-gray-200 rounded-lg\">\n            <table className=\"min-w-full border-collapse border border-gray-300 text-xs\">\n              <thead className=\"sticky top-0 bg-gray-50 z-10\">\n                <tr>\n                  <th className=\"border border-gray-300 px-1 py-1 text-left text-xs font-medium text-gray-700\" style={{ width: '30px' }}>#</th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-center text-xs font-medium text-gray-700\" style={{ width: '70px' }}>Accin</th>\n                  <th className=\"border border-gray-300 px-2 py-1 text-left text-xs font-medium text-gray-700\" style={{ minWidth: '150px' }}>Tarea</th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-center text-xs font-medium text-gray-700\" style={{ width: '35px' }}></th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-left text-xs font-medium text-gray-700\" style={{ width: '55px' }}>Duracin</th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-left text-xs font-medium text-gray-700\" style={{ width: '85px' }}>Inicio</th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-left text-xs font-medium text-gray-700\" style={{ width: '85px' }}>Fin</th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-left text-xs font-medium text-gray-700\" style={{ width: '80px' }}>Progreso</th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-left text-xs font-medium text-gray-700\" style={{ width: '70px' }}>Prioridad</th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-left text-xs font-medium text-gray-700\" style={{ width: '90px' }}>Asignado</th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-left text-xs font-medium text-gray-700\" style={{ width: '70px' }}>Costo</th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-left text-xs font-medium text-gray-700\" style={{ width: '70px' }}> Valor</th>\n                  <th className=\"border border-gray-300 px-1 py-1 text-left text-xs font-medium text-gray-700\" style={{ width: '90px' }}>Predecesoras</th>\n                </tr>\n              </thead>\n              <tbody onKeyDown={handleKeyDown}>\n                {(() => {\n                  //  CORRECCIN: NO ordenar en cada render\n                  // Las tareas ya vienen en el orden correcto del array\n                  // Solo ordenamos durante la importacin de Excel (lneas 2420, 3170)\n\n                  // DEBUG: Mostrar orden actual (sin modificar)\n                  console.log(' DEBUG - Orden de tareas (sin ordenar):',\n                    tasksWithCPM.map((t, i) => ({\n                      index: i + 1,\n                      name: t.name,\n                      wbsCode: t.wbsCode\n                    }))\n                  );\n\n                  // Retornar las tareas en su orden original (SIN sortTasksByWbsCode)\n                  return tasksWithCPM;\n                })()\n                  .concat([{ id: 'add-new-task', isAddButton: true }]) // Agregar botn de nueva tarea al final\n                  .map((task, index) => {\n                    // Si es el botn de agregar nueva tarea\n                    if (task.isAddButton) {\n                      return (\n                        <tr key=\"add-new-task\" className=\"hover:bg-gray-50\">\n                          <td className=\"border border-gray-300 px-2 py-1 text-sm text-gray-400 text-center\">\n                            +\n                          </td>\n                          <td className=\"border border-gray-300 px-2 py-1\">\n                            <div className=\"flex justify-center\">\n                              <button\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  addTaskAtEnd();\n                                }}\n                                disabled={isReadOnlyMode}\n                                className={`text-sm px-4 py-2 rounded-md shadow-sm transition-colors duration-200 flex items-center space-x-2 ${isReadOnlyMode\n                                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                                  : 'bg-blue-500 hover:bg-blue-600 text-white'\n                                  }`}\n                                title={isReadOnlyMode ? \"No puedes agregar tareas (modo solo lectura)\" : \"Agregar nueva tarea al final\"}\n                              >\n                                <span></span>\n                                <span>Nueva Tarea</span>\n                              </button>\n                            </div>\n                          </td>\n                          <td colSpan=\"10\" className=\"border border-gray-300 px-2 py-1 text-sm text-gray-400 text-center\">\n                            Agregar nueva tarea al final del cronograma\n                          </td>\n                        </tr>\n                      );\n                    }\n\n                    // Tarea normal\n                    return (\n                      <tr\n                        key={task.id}\n                        className={`hover:bg-gray-50 ${selectedRow === task.id ? 'bg-blue-50' : ''}`}\n                        onClick={() => setSelectedRow(task.id)}\n                      >\n                        {/* Nmero de fila */}\n                        <td className=\"border border-gray-300 px-2 py-1 text-sm text-gray-600 text-center\">\n                          {index + 1}\n                        </td>\n\n                        {/* Acciones */}\n                        <td className=\"border border-gray-300 px-2 py-1\">\n                          <div className=\"flex space-x-1 justify-center\">\n                            <button\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                insertTaskAtPosition(task.id, index);\n                              }}\n                              disabled={isReadOnlyMode}\n                              className={`text-sm px-2 py-1 rounded-md shadow-sm transition-colors duration-200 flex items-center justify-center min-w-[32px] ${isReadOnlyMode\n                                ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                                : 'bg-green-500 hover:bg-green-600 text-white'\n                                }`}\n                              title={isReadOnlyMode ? \"No puedes insertar tareas (modo solo lectura)\" : \"Insertar fila despus\"}\n                            >\n                              \n                            </button>\n                            <button\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                deleteTask(task.id);\n                              }}\n                              className=\"bg-red-500 hover:bg-red-600 text-white text-sm px-2 py-1 rounded-md shadow-sm transition-colors duration-200 flex items-center justify-center min-w-[32px]\"\n                              title=\"Eliminar tarea\"\n                            >\n                              \n                            </button>\n                          </div>\n                        </td>\n\n                        {/* Nombre de la tarea */}\n                        <td className=\"border border-gray-300 px-2 py-1\">\n                          {editingCell?.taskId === task.id && editingCell?.field === 'name' ? (\n                            <input\n                              type=\"text\"\n                              value={editingValue}\n                              onChange={(e) => setEditingValue(e.target.value)}\n                              onBlur={saveEdit}\n                              onKeyDown={handleKeyDown}\n                              className=\"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                              autoFocus\n                            />\n                          ) : (\n                            <div\n                              className=\"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center\"\n                              onClick={() => startEditing(task.id, 'name', task.name)}\n                              title=\"Click para editar nombre\"\n                            >\n                              {task.name}\n                            </div>\n                          )}\n                        </td>\n\n                        {/* Hito */}\n                        <td className=\"border border-gray-300 px-2 py-1 text-center\">\n                          <button\n                            onClick={() => toggleMilestone(task.id)}\n                            className={`w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all duration-200 ${task.isMilestone\n                              ? 'bg-indigo-500 border-indigo-500 text-white shadow-lg'\n                              : 'bg-white border-gray-300 text-gray-400 hover:border-indigo-300 hover:text-indigo-400'\n                              }`}\n                            title={task.isMilestone ? 'Quitar hito' : 'Marcar como hito'}\n                          >\n                            \n                          </button>\n                        </td>\n\n                        {/* Duracin */}\n                        <td className=\"border border-gray-300 px-2 py-1\">\n                          {task.isMilestone ? (\n                            <div className=\"px-2 py-1 rounded bg-purple-100 text-purple-800 text-center font-medium\">\n                              0d\n                            </div>\n                          ) : editingCell?.taskId === task.id && editingCell?.field === 'duration' ? (\n                            <input\n                              type=\"number\"\n                              value={editingValue}\n                              onChange={(e) => setEditingValue(e.target.value)}\n                              onBlur={saveEdit}\n                              onKeyDown={handleKeyDown}\n                              className=\"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                              autoFocus\n                            />\n                          ) : (\n                            <div\n                              className=\"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center\"\n                              onClick={() => startEditing(task.id, 'duration', task.duration)}\n                              title=\"Click para editar duracin\"\n                            >\n                              {task.duration}d\n                            </div>\n                          )}\n                        </td>\n\n                        {/* Fecha de inicio */}\n                        <td className=\"border border-gray-300 px-2 py-1\">\n                          {editingCell?.taskId === task.id && editingCell?.field === 'startDate' ? (\n                            <input\n                              type=\"date\"\n                              value={editingValue}\n                              onChange={(e) => setEditingValue(e.target.value)}\n                              onBlur={saveEdit}\n                              onKeyDown={handleKeyDown}\n                              className=\"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                              autoFocus\n                            />\n                          ) : (\n                            <div\n                              className=\"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center text-sm\"\n                              onClick={() => startEditing(task.id, 'startDate', task.startDate)}\n                              title=\"Click para editar fecha de inicio\"\n                            >\n                              {task.startDate && task.startDate !== null && task.startDate !== undefined ? task.startDate.split('-').reverse().join('/') : ''}\n                            </div>\n                          )}\n                        </td>\n\n                        {/* Fecha de fin */}\n                        <td className=\"border border-gray-300 px-2 py-1\">\n                          {task.isMilestone ? (\n                            <div className=\"px-2 py-1 rounded bg-purple-100 text-purple-800 text-center font-medium text-sm\">\n                              {(() => {\n                                if (!task.startDate || task.startDate === null || task.startDate === undefined) return '';\n                                const [year, month, day] = task.startDate.split('-');\n                                return new Date(year, month - 1, day).toLocaleDateString('es');\n                              })()}\n                            </div>\n                          ) : editingCell?.taskId === task.id && editingCell?.field === 'endDate' ? (\n                            <input\n                              type=\"date\"\n                              value={editingValue}\n                              onChange={(e) => setEditingValue(e.target.value)}\n                              onBlur={saveEdit}\n                              onKeyDown={handleKeyDown}\n                              className=\"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                              autoFocus\n                            />\n                          ) : (\n                            <div\n                              className=\"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center text-sm\"\n                              onClick={() => startEditing(task.id, 'endDate', task.endDate)}\n                              title=\"Click para editar fecha de fin\"\n                            >\n                              {task.isMilestone\n                                ? (task.startDate && task.startDate !== null && task.startDate !== undefined ? task.startDate.split('-').reverse().join('/') : '')\n                                : (task.endDate && task.endDate !== null && task.endDate !== undefined ? task.endDate.split('-').reverse().join('/') : '')\n                              }\n                            </div>\n                          )}\n                        </td>\n\n                        {/* Progreso */}\n                        <td className=\"border border-gray-300 px-2 py-1\">\n                          {editingCell?.taskId === task.id && editingCell?.field === 'progress' ? (\n                            <input\n                              type=\"number\"\n                              min=\"0\"\n                              max=\"100\"\n                              value={editingValue}\n                              onChange={(e) => setEditingValue(e.target.value)}\n                              onBlur={saveEdit}\n                              onKeyDown={handleKeyDown}\n                              className=\"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                              autoFocus\n                            />\n                          ) : (\n                            <div\n                              className=\"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center\"\n                              onClick={() => startEditing(task.id, 'progress', task.progress)}\n                            >\n                              <div className=\"flex items-center space-x-2\">\n                                <div className=\"w-16 bg-gray-200 rounded-full h-2\">\n                                  <div\n                                    className=\"bg-blue-600 h-2 rounded-full\"\n                                    style={{ width: `${task.progress}%` }}\n                                  ></div>\n                                </div>\n                                <span className=\"text-xs\">{task.progress}%</span>\n                              </div>\n                            </div>\n                          )}\n                        </td>\n\n                        {/* Prioridad */}\n                        <td className=\"border border-gray-300 px-2 py-1\">\n                          {editingCell?.taskId === task.id && editingCell?.field === 'priority' ? (\n                            <select\n                              value={editingValue}\n                              onChange={(e) => setEditingValue(e.target.value)}\n                              onBlur={saveEdit}\n                              className=\"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                              autoFocus\n                            >\n                              <option value=\"low\">Baja</option>\n                              <option value=\"medium\">Media</option>\n                              <option value=\"high\">Alta</option>\n                              <option value=\"critical\">Crtica</option>\n                            </select>\n                          ) : (\n                            <div\n                              className=\"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center\"\n                              onClick={() => startEditing(task.id, 'priority', task.priority)}\n                            >\n                              <span className={`px-2 py-1 rounded-full text-xs ${task.priority === 'critical' ? 'bg-red-100 text-red-800' :\n                                task.priority === 'high' ? 'bg-orange-100 text-orange-800' :\n                                  task.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :\n                                    'bg-green-100 text-green-800'\n                                }`}>\n                                {task.priority === 'critical' ? 'Crtica' :\n                                  task.priority === 'high' ? 'Alta' :\n                                    task.priority === 'medium' ? 'Media' : 'Baja'}\n                              </span>\n                            </div>\n                          )}\n                        </td>\n\n                        {/* Asignado */}\n                        <td className=\"border border-gray-300 px-2 py-1\">\n                          {editingCell?.taskId === task.id && editingCell?.field === 'assignedTo' ? (\n                            <input\n                              type=\"text\"\n                              value={editingValue}\n                              onChange={(e) => setEditingValue(e.target.value)}\n                              onBlur={saveEdit}\n                              onKeyDown={handleKeyDown}\n                              className=\"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                              autoFocus\n                            />\n                          ) : (\n                            <div\n                              className=\"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center\"\n                              onClick={() => startEditing(task.id, 'assignedTo', task.assignedTo)}\n                            >\n                              {task.assignedTo || 'Sin asignar'}\n                            </div>\n                          )}\n                        </td>\n\n                        {/* Costo */}\n                        <td className=\"border border-gray-300 px-2 py-1\">\n                          {editingCell?.taskId === task.id && editingCell?.field === 'cost' ? (\n                            <input\n                              type=\"number\"\n                              step=\"0.01\"\n                              value={editingValue}\n                              onChange={(e) => setEditingValue(e.target.value)}\n                              onBlur={saveEdit}\n                              onKeyDown={handleKeyDown}\n                              className=\"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                              autoFocus\n                            />\n                          ) : (\n                            <div\n                              className=\"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center\"\n                              onClick={() => startEditing(task.id, 'cost', task.cost)}\n                            >\n                              ${task.cost.toLocaleString()}\n                            </div>\n                          )}\n                        </td>\n\n                        {/* Valor de Negocio */}\n                        <td className=\"border border-gray-300 px-2 py-1 bg-indigo-50\">\n                          {editingCell?.taskId === task.id && editingCell?.field === 'businessValue' ? (\n                            <input\n                              type=\"number\"\n                              step=\"0.01\"\n                              value={editingValue}\n                              onChange={(e) => setEditingValue(e.target.value)}\n                              onBlur={saveEdit}\n                              onKeyDown={handleKeyDown}\n                              className=\"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                              autoFocus\n                            />\n                          ) : (\n                            <div\n                              className=\"cursor-pointer hover:bg-indigo-100 px-2 py-1 rounded min-h-[24px] flex items-center\"\n                              onClick={() => startEditing(task.id, 'businessValue', task.businessValue || 0)}\n                              title=\"Valor de negocio segn PMBOK 7\"\n                            >\n                              ${(task.businessValue || 0).toLocaleString()}\n                            </div>\n                          )}\n                        </td>\n\n                        {/* Predecesoras */}\n                        <td className=\"border border-gray-300 px-2 py-1\">\n                          {editingCell?.taskId === task.id && editingCell?.field === 'dependencies' ? (\n                            <div className=\"space-y-2\">\n                              <div className=\"text-xs text-gray-600 mb-1\">Escribe los nmeros de fila separados por comas (ej: 1, 2, 3)</div>\n                              <input\n                                type=\"text\"\n                                value={editingValue}\n                                onChange={(e) => setEditingValue(e.target.value)}\n                                onBlur={saveEdit}\n                                onKeyDown={handleKeyDown}\n                                className=\"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"\n                                placeholder=\"1, 2, 3\"\n                                autoFocus\n                              />\n                              <div className=\"flex space-x-1\">\n                                <button\n                                  onClick={saveEdit}\n                                  className=\"text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600\"\n                                >\n                                  Guardar\n                                </button>\n                                <button\n                                  onClick={cancelEdit}\n                                  className=\"text-xs bg-gray-500 text-white px-2 py-1 rounded hover:bg-gray-600\"\n                                >\n                                  Cancelar\n                                </button>\n                              </div>\n                            </div>\n                          ) : (\n                            <div\n                              className=\"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded min-h-[24px] flex items-center\"\n                              onClick={() => startEditingDependencies(task.id)}\n                              title=\"Click para editar predecesoras\"\n                            >\n                              <div className=\"flex items-center space-x-2 text-xs\">\n                                {task.predecessors.length > 0 ? (\n                                  <div className=\"flex flex-wrap gap-1\">\n                                    {task.predecessors.map(predId => {\n                                      // Buscar la tarea predecesora por ID\n                                      const predTask = tasks.find(t => t.id === predId);\n\n                                      // Mostrar el nmero de wbsCode de la predecesora\n                                      const predNumber = predTask ? parseInt(predTask.wbsCode) : predId;\n\n                                      return (\n                                        <span\n                                          key={predId}\n                                          className=\"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-medium\"\n                                        >\n                                          {predNumber}\n                                        </span>\n                                      );\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"text-gray-400\">Sin predecesoras</span>\n                                )}\n                              </div>\n                            </div>\n                          )}\n                        </td>\n                      </tr>\n                    );\n                  })}\n              </tbody>\n            </table>\n          </div>\n\n          {/* Resumen de la tabla */}\n          <div className=\"mt-4 p-4 bg-gray-50 rounded-lg\">\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm\">\n              <div>\n                <span className=\"font-medium text-gray-700\">Total Tareas:</span>\n                <span className=\"ml-2 text-gray-600\">{tasksWithCPM.length}</span>\n              </div>\n              <div>\n                <span className=\"font-medium text-gray-700\">Duracin Total:</span>\n                <span className=\"ml-2 text-gray-600\">{tasksWithCPM.reduce((sum, task) => sum + task.duration, 0)} das</span>\n              </div>\n              <div>\n                <span className=\"font-medium text-gray-700\">Progreso Promedio:</span>\n                <span className=\"ml-2 text-gray-600\">\n                  {Math.round(tasksWithCPM.reduce((sum, task) => sum + task.progress, 0) / tasksWithCPM.length)}%\n                </span>\n              </div>\n              <div>\n                <span className=\"font-medium text-gray-700\">Costo Total:</span>\n                <span className=\"ml-2 text-gray-600\">\n                  ${tasksWithCPM.reduce((sum, task) => sum + task.cost, 0).toLocaleString()}\n                </span>\n              </div>\n              <div>\n                <span className=\"font-medium text-indigo-700\"> Valor Total:</span>\n                <span className=\"ml-2 text-indigo-600 font-semibold\">\n                  ${tasksWithCPM.reduce((sum, task) => sum + (task.businessValue || 0), 0).toLocaleString()}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Vista de Gantt */}\n      {viewMode === 'gantt' && (\n        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-2xl font-bold\">Diagrama Gantt</h2>\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg px-3 py-2\">\n              <div className=\"flex items-center space-x-2 text-sm text-blue-700\">\n                <span></span>\n                <span>Solo lectura - Edita desde la Vista Tabla</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Controles del Gantt */}\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex space-x-2\">\n              <select value={ganttScale} onChange={(e) => setGanttScale(e.target.value)} className=\"px-3 py-2 border rounded-lg\">\n                <option value=\"days\">Das</option>\n                <option value=\"weeks\">Semanas</option>\n                <option value=\"months\">Meses</option>\n              </select>\n\n              <button\n                onClick={() => setShowBaseline(!showBaseline)}\n                className={`px-3 py-2 rounded-lg transition-colors duration-200 ${showBaseline\n                  ? 'bg-green-500 text-white hover:bg-green-600'\n                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n                  }`}\n                disabled={baselineTasks.length === 0}\n              >\n                Baseline\n              </button>\n\n              <button\n                onClick={saveBaseline}\n                className=\"bg-indigo-600 text-white px-3 py-2 rounded-lg hover:bg-indigo-700 flex items-center space-x-2\"\n              >\n                <span></span>\n                <span>Guardar Baseline</span>\n              </button>\n            </div>\n\n\n            <div className=\"flex space-x-2\">\n              <button\n                onClick={cleanCircularDependencies}\n                className=\"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 flex items-center space-x-2\"\n                title=\"Limpiar dependencias circulares que causan duplicacin de tareas\"\n              >\n                <span></span>\n                <span>Limpiar Dependencias Circulares</span>\n              </button>\n            </div>\n          </div>\n\n          {/* Diagrama Gantt SVG */}\n          <div className=\"bg-white border rounded-lg overflow-hidden max-w-full\">\n            {/* Indicador de scroll horizontal */}\n            <div className=\"bg-blue-50 border-b border-blue-200 p-2\">\n              <div className=\"flex items-center justify-center text-sm text-blue-700\">\n                <span className=\"mr-2\"></span>\n                <span>Usa el scroll horizontal para navegar por el cronograma completo</span>\n              </div>\n            </div>\n            <div className=\"flex\">\n              {/* Panel izquierdo - Lista de tareas optimizada */}\n              <div\n                ref={leftRef}\n                onScroll={onLeftScroll}\n                className=\"w-80 bg-gray-50 border-r overflow-y-auto\"\n                style={{ height: '600px' }}\n              >\n                <div className=\"p-4\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <div className=\"text-sm font-medium text-gray-700\">TAREAS DEL PROYECTO</div>\n                    <div className=\"text-xs text-gray-500\">{tasksWithCPM.length} tareas</div>\n                  </div>\n\n                  {generateGanttBars().map((task, index) => (\n                    <div key={task.id} className=\"mb-2\">\n                      {/* Tarea principal - SOLO LECTURA */}\n                      <div\n                        className={`group flex items-center p-3 rounded-lg transition-all duration-200 border ${selectedTask?.id === task.id\n                          ? 'bg-indigo-100 border-indigo-300 shadow-md'\n                          : 'hover:bg-white hover:border-gray-300 hover:shadow-sm'\n                          }`}\n                        onClick={() => {\n                          console.log(' SELECCIN TAREA - Tarea seleccionada para ver:', {\n                            taskId: task.id,\n                            nombre: task.name,\n                            tareaCompleta: task\n                          });\n                          setSelectedTask(task);\n                        }}\n                        style={{ height: ROW_H }}\n                      >\n                        <div className=\"flex-1 min-w-0\">\n                          {/* Nombre de la tarea */}\n                          <div className=\"font-medium text-sm text-gray-900 truncate mb-1\">\n                            {task.name}\n                            {task.isMilestone && <span className=\"ml-2 text-indigo-600 text-lg\"></span>}\n                          </div>\n\n                          {/* Solo indicador de crtica */}\n                          {task.isCritical && (\n                            <div className=\"text-xs text-red-600 font-medium\">\n                               Tarea Crtica\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Solo indicador de crtica en el lado derecho */}\n                        {task.isCritical && (\n                          <div className=\"ml-3\">\n                            <span className=\"inline-block bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full\">\n                               Crtica\n                            </span>\n                          </div>\n                        )}\n\n                      </div>\n                    </div>\n                  ))}\n\n                  {/* Resumen del proyecto */}\n                  <div className=\"mt-4 p-3 bg-white rounded-lg border border-gray-200\">\n                    <div className=\"text-xs font-medium text-gray-700 mb-2\">RESUMEN</div>\n                    <div className=\"space-y-1 text-xs text-gray-600\">\n                      <div className=\"flex justify-between\">\n                        <span>Progreso Total:</span>\n                        <span className=\"font-medium\">{projectMetrics.progressPercentage}%</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Tareas Crticas:</span>\n                        <span className=\"font-medium text-red-600\">{projectMetrics.criticalTasks}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Completadas:</span>\n                        <span className=\"font-medium text-green-600\">{projectMetrics.completedTasks}</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Panel derecho - Diagrama Gantt */}\n              <div className=\"flex-1 flex flex-col max-w-full\" style={{ height: '600px', maxWidth: 'calc(100vw - 400px)' }}>\n                {/* Headers de timeline - FIJOS (fuera del scroll) */}\n                <div\n                  className=\"bg-gray-100 border-b p-2 flex-shrink-0\"\n                  style={{\n                    backgroundColor: '#f9fafb',\n                    borderBottom: '1px solid #e5e7eb'\n                  }}\n                >\n                  <div\n                    ref={headerRef}\n                    onScroll={onHeaderScroll}\n                    className=\"overflow-x-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200\"\n                    style={{\n                      width: '100%',\n                      maxWidth: '100%'\n                    }}\n                  >\n                    <div\n                      className=\"flex\"\n                      style={{\n                        width: Math.max(chartWidthPx + 100, 800),\n                        minWidth: Math.max(chartWidthPx + 100, 800)\n                      }}\n                    >\n                      {generateTimelineHeaders().map((header, index) => (\n                        <div\n                          key={index}\n                          className=\"text-xs text-gray-600 text-center border-r border-gray-200 flex-shrink-0\"\n                          style={{ width: header.width, minWidth: header.width }}\n                        >\n                          <div className=\"font-medium\">{header.label}</div>\n                          <div className=\"text-gray-400\">{header.sub}</div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Contenido scrolleable del Gantt */}\n                <div\n                  ref={rightRef}\n                  onScroll={onRightScroll}\n                  className=\"flex-1 overflow-x-auto overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200\"\n                >\n                  <div style={{ width: Math.max(chartWidthPx + 100, 800) }}>\n\n                    {/* Barras del Gantt */}\n                    <div className=\"relative\">\n                      {/* Lnea \"Hoy\" - Movida dentro del contenedor relative */}\n                      {todayLeftPx > 0 && todayLeftPx < chartWidthPx && (\n                        <div\n                          className=\"absolute z-10 w-0.5 bg-red-500\"\n                          style={{\n                            left: todayLeftPx,\n                            top: 0,\n                            height: '600px'\n                          }}\n                        >\n                          <div className=\"bg-red-500 text-white text-xs px-1 py-0.5 rounded -mt-2 -ml-6\">\n                            HOY\n                          </div>\n                        </div>\n                      )}\n                      {generateGanttBars().map((task, index) => (\n                        <div\n                          key={task.id}\n                          className=\"absolute\"\n                          style={{\n                            left: task.leftPx, // CORRECCIN: Eliminar offset fijo de 320px\n                            top: index * (ROW_H + 8) + PADDING_TOP + 5, // +8 por el mb-2 (0.5rem = 8px)\n                            width: task.widthPx,\n                            height: ROW_H - 10\n                          }}\n                        >\n                          {/* Barra principal */}\n                          <div\n                            className={`h-8 transition-all duration-200 cursor-default hover:opacity-80 ${task.isMilestone ? 'rounded-full' : 'rounded-lg'\n                              }`}\n                            title=\"Solo lectura - Edita desde la Vista Tabla\"\n                            style={{\n                              width: task.isMilestone ? '12px' : '100%',\n                              height: '100%',\n                              background: task.isMilestone\n                                ? 'linear-gradient(45deg, #8b5cf6, #7c3aed)' // Prpura para hitos\n                                : task.isCritical && showCriticalPath\n                                  ? 'linear-gradient(45deg, #ef4444, #dc2626)'\n                                  : task.isCritical\n                                    ? 'linear-gradient(45deg, #f97316, #ea580c)'\n                                    : 'linear-gradient(45deg, #6366f1, #4f46e5)',\n                              border: task.isCritical && showCriticalPath ? '2px solid #dc2626' : 'none',\n                              boxShadow: task.isCritical && showCriticalPath ? '0 0 10px rgba(239, 68, 68, 0.5)' : 'none'\n                            }}\n                          >\n                            {/* Barra de progreso */}\n                            <div\n                              className=\"h-full bg-green-400 rounded-l transition-all duration-200\"\n                              style={{\n                                width: `${task.progress}%`,\n                                background: 'linear-gradient(45deg, #4ade80, #22c55e)'\n                              }}\n                            />\n\n                            {/* Texto de la tarea */}\n                            <div className=\"absolute inset-0 flex items-center justify-center text-white text-xs font-medium px-2\">\n                              <span className=\"truncate\">{task.name}</span>\n                            </div>\n                          </div>\n\n                          {/* Baseline si est habilitado */}\n                          {showBaseline && baselineById.has(task.id) && (\n                            <div\n                              className=\"absolute top-0 h-full border-2 border-dashed border-gray-700 opacity-90\"\n                              style={{\n                                left: `${(diffDaysExclusive(toISO(projectDates.start), baselineById.get(task.id).startDate, includeWeekends) * pxPerDay)}px`,\n                                width: `${Math.max(1, durationDaysInclusive(baselineById.get(task.id).startDate, baselineById.get(task.id).endDate, includeWeekends) * pxPerDay)}px`,\n                                boxShadow: '0 0 4px rgba(55, 65, 81, 0.4)'\n                              }}\n                            />\n                          )}\n\n                          {/* Dependencias si estn habilitadas */}\n                          {showDependencies && task.predecessors.length > 0 && (\n                            <div className=\"absolute -top-2 left-0 w-full\">\n                              {task.predecessors.map((predId, predIndex) => {\n                                const pred = tasksWithCPM.find(t => t.id === predId);\n                                if (!pred) return null;\n\n                                const predBar = generateGanttBars().find(t => t.id === predId);\n                                if (!predBar) return null;\n\n                                const startX = predBar.leftPx + predBar.widthPx; // CORRECCIN: Eliminar offset fijo\n                                const startY = tasksWithCPM.findIndex(t => t.id === predId) * (ROW_H + 8) + PADDING_TOP + 5 + (ROW_H - 10) / 2;\n                                const endX = task.leftPx; // CORRECCIN: Eliminar offset fijo\n                                const endY = index * (ROW_H + 8) + PADDING_TOP + 5 + (ROW_H - 10) / 2;\n\n                                return (\n                                  <svg\n                                    key={predIndex}\n                                    className=\"absolute pointer-events-none\"\n                                    style={{\n                                      left: 0,\n                                      top: 0,\n                                      width: '100%',\n                                      height: '100%'\n                                    }}\n                                  >\n                                    <defs>\n                                      <marker\n                                        id={`arrow-${task.id}-${predId}`}\n                                        markerWidth=\"10\"\n                                        markerHeight=\"10\"\n                                        refX=\"9\"\n                                        refY=\"3\"\n                                        orient=\"auto\"\n                                        markerUnits=\"strokeWidth\"\n                                      >\n                                        <polygon\n                                          points=\"0,0 0,6 9,3\"\n                                          fill={task.isCritical ? '#ef4444' : '#6366f1'}\n                                        />\n                                      </marker>\n                                    </defs>\n                                    <line\n                                      x1={startX}\n                                      y1={startY}\n                                      x2={endX}\n                                      y2={endY}\n                                      stroke={task.isCritical ? '#ef4444' : '#6366f1'}\n                                      strokeWidth=\"2\"\n                                      markerEnd={`url(#arrow-${task.id}-${predId})`}\n                                      strokeDasharray={task.isCritical ? 'none' : '5,5'}\n                                    />\n                                  </svg>\n                                );\n                              })}\n                            </div>\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Vista de Red - DESHABILITADA */}\n      {false && viewMode === 'network' && (\n        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\n          <h2 className=\"text-2xl font-bold mb-4\">Diagrama de Red</h2>\n\n          {/* Controles principales del diagrama - DISEO MEJORADO */}\n          <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 mb-6 border border-blue-200\">\n            <div className=\"flex flex-col lg:flex-row items-center justify-between gap-4\">\n\n              {/* Seccin izquierda: Navegacin */}\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"text-sm font-medium text-gray-700 mr-2\">Navegacin:</div>\n                <div className=\"flex items-center bg-white rounded-lg p-1 shadow-sm border border-gray-200\">\n                  <button\n                    onClick={zoomOut}\n                    className=\"px-3 py-2 rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors duration-200\"\n                    title=\"Alejar\"\n                  >\n                    <span className=\"text-lg font-bold\"></span>\n                  </button>\n                  <div className=\"w-px h-6 bg-gray-300 mx-1\"></div>\n                  <button\n                    onClick={zoomIn}\n                    className=\"px-3 py-2 rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors duration-200\"\n                    title=\"Acercar\"\n                  >\n                    <span className=\"text-lg font-bold\">+</span>\n                  </button>\n                  <div className=\"w-px h-6 bg-gray-300 mx-1\"></div>\n                  <button\n                    onClick={resetZoom}\n                    className=\"px-3 py-2 rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors duration-200\"\n                    title=\"Zoom Original\"\n                  >\n                    <span className=\"text-sm\"></span>\n                  </button>\n                  <div className=\"w-px h-6 bg-gray-300 mx-1\"></div>\n                  <button\n                    onClick={centerNetwork}\n                    className=\"px-3 py-2 rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors duration-200\"\n                    title=\"Centrar Vista\"\n                  >\n                    <span className=\"text-sm\"></span>\n                  </button>\n                  <div className=\"w-px h-6 bg-gray-300 mx-1\"></div>\n                  <button\n                    onClick={autoFitNetworkDiagram}\n                    className=\"px-3 py-2 rounded-md bg-green-100 text-green-700 hover:bg-green-200 transition-colors duration-200\"\n                    title=\"Auto Ajustar\"\n                  >\n                    <span className=\"text-sm\"></span>\n                  </button>\n                </div>\n              </div>\n\n              {/* Seccin derecha: Acciones */}\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"text-sm font-medium text-gray-700 mr-2\">Acciones:</div>\n                <button\n                  onClick={exportNetworkAsImage}\n                  className=\"bg-gradient-to-r from-indigo-600 to-indigo-700 text-white px-6 py-2.5 rounded-lg hover:from-indigo-700 hover:to-indigo-800 flex items-center space-x-2 shadow-md hover:shadow-lg transition-all duration-200\"\n                >\n                  <span className=\"text-lg\"></span>\n                  <span className=\"font-medium\">Exportar Imagen</span>\n                </button>\n              </div>\n            </div>\n          </div>\n\n          {/* Controles de Layout y Filtros - NUEVOS */}\n          <div className=\"bg-white rounded-lg shadow-sm p-4 mb-6 border border-gray-200\">\n            <div className=\"flex flex-wrap items-center justify-between gap-4\">\n              {/* Filtros de Vista */}\n              <div className=\"flex items-center space-x-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <label className=\"text-sm font-medium text-gray-700\">Filtros:</label>\n                  <button\n                    onClick={() => setShowOnlyCriticalPath(!showOnlyCriticalPath)}\n                    className={`px-3 py-2 rounded-lg transition-colors ${showOnlyCriticalPath\n                      ? 'bg-red-100 text-red-700 border-2 border-red-300'\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                      }`}\n                  >\n                     Solo Ruta Crtica\n                  </button>\n                  <button\n                    onClick={() => setShowSimplifiedView(!showSimplifiedView)}\n                    className={`px-3 py-2 rounded-lg transition-colors ${showSimplifiedView\n                      ? 'bg-blue-100 text-blue-700 border-2 border-blue-300'\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                      }`}\n                  >\n                     Vista Simplificada\n                  </button>\n                </div>\n\n                <div className=\"flex items-center space-x-2\">\n                  <label className=\"text-sm font-medium text-gray-700\">Layout:</label>\n                  <select\n                    value={networkLayout}\n                    onChange={(e) => setNetworkLayout(e.target.value)}\n                    className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  >\n                    <option value=\"hierarchical\">Jerrquico</option>\n                    <option value=\"compact\">Compacto</option>\n                    <option value=\"grid\">Cuadrcula</option>\n                    <option value=\"radial\">Radial</option>\n                  </select>\n                </div>\n\n                <div className=\"flex items-center space-x-2\">\n                  <label className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"checkbox\"\n                      checked={autoFitNetwork}\n                      onChange={(e) => setAutoFitNetwork(e.target.checked)}\n                      className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n                    />\n                    <span className=\"text-sm font-medium text-gray-700\">Auto Ajustar</span>\n                  </label>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Botn principal de Dependencias - DISEO MEJORADO */}\n          <div className=\"flex justify-center mb-6\">\n            <div className=\"bg-gradient-to-r from-gray-50 to-blue-50 rounded-2xl p-2 border border-gray-200 shadow-sm\">\n              <button\n                onClick={() => {\n                  const newValue = !showNetworkDependencies;\n                  setShowNetworkDependencies(newValue);\n                  console.log(' Botn dependencias RED:', newValue ? 'ACTIVADO' : 'DESACTIVADO');\n                }}\n                className={`px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-300 flex items-center space-x-3 ${showNetworkDependencies\n                  ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg hover:from-blue-600 hover:to-blue-700 transform hover:scale-105'\n                  : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-300 hover:border-gray-400'\n                  }`}\n              >\n                <span className=\"text-2xl\"></span>\n                <span>Dependencias</span>\n                <div className={`w-3 h-3 rounded-full transition-all duration-300 ${showNetworkDependencies\n                  ? 'bg-green-400 shadow-lg shadow-green-400/50'\n                  : 'bg-gray-400'\n                  }`}></div>\n              </button>\n            </div>\n          </div>\n\n\n          {/* Mtricas del diagrama simplificadas */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6\">\n            <h3 className=\"text-lg font-semibold mb-3 text-blue-800\"> Mtricas del Diagrama</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"bg-white rounded-lg p-3 border border-blue-200\">\n                <div className=\"text-sm text-blue-600 mb-1\">Total Nodos</div>\n                <div className=\"text-2xl font-bold text-blue-800\">{networkMetrics.totalNodes}</div>\n                <div className=\"text-xs text-blue-600\">Tareas del proyecto</div>\n              </div>\n              <div className=\"bg-white rounded-lg p-3 border border-blue-200\">\n                <div className=\"text-sm text-blue-600 mb-1\">Total Relaciones</div>\n                <div className=\"text-2xl font-bold text-blue-800\">{networkMetrics.totalEdges}</div>\n                <div className=\"text-xs text-blue-600\">Dependencias activas</div>\n              </div>\n              <div className=\"bg-white rounded-lg p-3 border border-blue-200\">\n                <div className=\"text-sm text-blue-600 mb-1\">Ruta Crtica</div>\n                <div className=\"text-2xl font-bold text-blue-800\">{networkMetrics.criticalPathLength}</div>\n                <div className=\"text-xs text-blue-600\">Tareas crticas</div>\n              </div>\n            </div>\n          </div>\n\n          {/* Instrucciones de navegacin */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4\">\n            <div className=\"flex items-center space-x-4 text-sm text-blue-700\">\n              <div className=\"flex items-center space-x-2\">\n                <span className=\"text-lg\"></span>\n                <span><strong>Arrastrar:</strong> Haz clic y arrastra en el diagrama para moverlo</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <span className=\"text-lg\"></span>\n                <span><strong>Centrar:</strong> Usa \"Centrar Vista\" para volver al centro</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <span className=\"text-lg\"></span>\n                <span><strong>Zoom:</strong> Usa + y - para acercar/alejar</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Diagrama SVG */}\n          <div className=\"border rounded-lg overflow-hidden bg-gray-50\" style={{ height: '600px' }}>\n            <svg\n              ref={networkSvgRef}\n              className=\"w-full h-full\"\n              viewBox={`${networkPan.x} ${networkPan.y} ${1200 / networkZoom} ${600 / networkZoom}`}\n              preserveAspectRatio=\"xMidYMid meet\"\n              style={{\n                transform: `scale(${networkZoom})`,\n                cursor: isPanning ? 'grabbing' : 'grab'\n              }}\n              onMouseDown={handleDiagramMouseDown}\n              onMouseMove={(e) => {\n                handleDiagramMouseMove(e);\n                handleNodeMouseMove(e);\n              }}\n              onMouseUp={(e) => {\n                handleDiagramMouseUp(e);\n                handleNodeMouseUp(e);\n              }}\n              onMouseLeave={(e) => {\n                handleDiagramMouseLeave(e);\n                handleNodeMouseUp(e);\n              }}\n            >\n              {/* Log del viewBox para debugging */}\n              {(() => {\n                console.log(' VIEWBOX DEL SVG:', {\n                  x: networkPan.x,\n                  y: networkPan.y,\n                  width: 1200 / networkZoom,\n                  height: 600 / networkZoom,\n                  zoom: networkZoom\n                });\n                return null;\n              })()}\n\n              {/* Definiciones SVG */}\n              <defs>\n                {/* Marcadores de flecha */}\n                <marker\n                  id=\"arrowhead\"\n                  markerWidth=\"10\"\n                  markerHeight=\"7\"\n                  refX=\"9\"\n                  refY=\"3.5\"\n                  orient=\"auto\"\n                >\n                  <polygon points=\"0 0, 10 3.5, 0 7\" fill=\"#6366f1\" />\n                </marker>\n\n                {/* Marcador para ruta crtica */}\n                <marker\n                  id=\"critical-arrowhead\"\n                  markerWidth=\"10\"\n                  markerHeight=\"7\"\n                  refX=\"9\"\n                  refY=\"3.5\"\n                  orient=\"auto\"\n                >\n                  <polygon points=\"0 0, 10 3.5, 0 7\" fill=\"#ef4444\" />\n                </marker>\n\n                {/* Filtros y efectos */}\n                <filter id=\"shadow\" x=\"-20%\" y=\"-20%\" width=\"140%\" height=\"140%\">\n                  <feDropShadow dx=\"2\" dy=\"2\" stdDeviation=\"2\" floodColor=\"#00000020\" />\n                </filter>\n\n                {/* Gradientes */}\n                <linearGradient id=\"nodeGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                  <stop offset=\"0%\" stopColor=\"#6366f1\" />\n                  <stop offset=\"100%\" stopColor=\"#4f46e5\" />\n                </linearGradient>\n\n                <linearGradient id=\"criticalGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                  <stop offset=\"0%\" stopColor=\"#ef4444\" />\n                  <stop offset=\"100%\" stopColor=\"#dc2626\" />\n                </linearGradient>\n\n                <linearGradient id=\"milestoneGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                  <stop offset=\"0%\" stopColor=\"#8b5cf6\" />\n                  <stop offset=\"100%\" stopColor=\"#7c3aed\" />\n                </linearGradient>\n              </defs>\n\n              {/* Lneas de dependencias */}\n              {showNetworkDependencies && (() => {\n                console.log(' INICIANDO RENDERIZADO DE LNEAS DE DEPENDENCIAS');\n\n                const tasksWithDeps = tasksWithCPM.filter(t => t.predecessors.length > 0);\n\n                console.log(' DEPENDENCIAS:', {\n                  activado: showNetworkDependencies,\n                  totalTareas: tasksWithCPM.length,\n                  tareasConDeps: tasksWithDeps.length,\n                  dependencias: tasksWithDeps.map(t => `${t.id}(${t.predecessors.length} pred)`)\n                });\n\n                // Log detallado de todas las tareas para debug\n                console.log(' TODAS LAS TAREAS:', tasksWithCPM.map(t => ({\n                  id: t.id,\n                  name: t.name,\n                  predecessors: t.predecessors,\n                  successors: t.successors\n                })));\n\n                if (tasksWithDeps.length === 0) {\n                  console.log(' No hay tareas con dependencias definidas');\n                  return null;\n                }\n\n                // LIMPIAR Y GENERAR SOLO LAS LNEAS CORRECTAS\n                const allLines = [];\n\n                // SOLO usar las dependencias que estn en tasksWithCPM\n                tasksWithDeps.forEach((task) => {\n                  task.predecessors.forEach((predId) => {\n                    // Verificar que la predecesora existe en tasksWithCPM\n                    const pred = tasksWithCPM.find(t => t.id === predId);\n                    if (!pred) {\n                      console.log(` Predecesora no encontrada en tasksWithCPM: ${predId}`);\n                      return;\n                    }\n\n                    // Verificar que ambos nodos existen en networkNodes\n                    const predNode = networkNodes.find(n => n.id === predId);\n                    const taskNode = networkNodes.find(n => n.id === task.id);\n\n                    if (!predNode || !taskNode) {\n                      console.log(` Nodo no encontrado en networkNodes: pred=${predId} (${predNode ? 'OK' : 'NO'}), task=${task.id} (${taskNode ? 'OK' : 'NO'})`);\n                      return;\n                    }\n\n                    // Verificar que las coordenadas son vlidas\n                    if (typeof predNode.x !== 'number' || typeof predNode.y !== 'number' ||\n                      typeof taskNode.x !== 'number' || typeof taskNode.y !== 'number') {\n                      console.log(` Coordenadas invlidas: pred=(${predNode.x},${predNode.y}), task=(${taskNode.x},${taskNode.y})`);\n                      return;\n                    }\n\n                    const isCritical = task.isCritical || pred.isCritical;\n                    const strokeColor = isCritical ? '#ef4444' : '#6366f1';\n                    const strokeWidth = isCritical ? 3 : 2;\n                    const markerId = isCritical ? 'critical-arrowhead' : 'arrowhead';\n\n                    console.log(` Lnea vlida generada: ${predId}  ${task.id} (${predNode.x},${predNode.y})  (${taskNode.x},${taskNode.y})`);\n\n                    allLines.push({\n                      key: `${predId}-${task.id}`,\n                      x1: predNode.x + predNode.width / 2,\n                      y1: predNode.y + predNode.height / 2,\n                      x2: taskNode.x + taskNode.width / 2,\n                      y2: taskNode.y + taskNode.height / 2,\n                      stroke: strokeColor,\n                      strokeWidth: strokeWidth,\n                      markerId: markerId,\n                      isCritical: isCritical\n                    });\n                  });\n                });\n\n                console.log(` Total lneas vlidas generadas: ${allLines.length}`);\n                console.log(` Coordenadas de lneas:`, allLines.map(l => ({\n                  key: l.key,\n                  from: `(${l.x1},${l.y1})`,\n                  to: `(${l.x2},${l.y2})`\n                })));\n\n                // Renderizar SOLO las lneas vlidas - DISEO MEJORADO\n                const renderedLines = allLines.map((line, index) => {\n                  const isCritical = line.isCritical;\n                  const strokeColor = isCritical ? '#ef4444' : '#6366f1';\n                  const strokeWidth = isCritical ? 4 : 2;\n                  const markerId = isCritical ? 'critical-arrowhead' : 'arrowhead';\n\n                  console.log(` Renderizando lnea ${index + 1}: ${line.key} - Crtica: ${isCritical}`);\n\n                  return (\n                    <g key={line.key}>\n                      {/* Sombra de la lnea */}\n                      <line\n                        x1={line.x1 + 2}\n                        y1={line.y1 + 2}\n                        x2={line.x2 + 2}\n                        y2={line.y2 + 2}\n                        stroke=\"rgba(0,0,0,0.3)\"\n                        strokeWidth={strokeWidth + 2}\n                        markerEnd={`url(#${markerId})`}\n                        className=\"pointer-events-none\"\n                      />\n\n                      {/* Lnea principal */}\n                      <line\n                        x1={line.x1}\n                        y1={line.y1}\n                        x2={line.x2}\n                        y2={line.y2}\n                        stroke={strokeColor}\n                        strokeWidth={strokeWidth}\n                        markerEnd={`url(#${markerId})`}\n                        className=\"transition-all duration-200\"\n                        style={{\n                          strokeDasharray: isCritical ? 'none' : '8,4',\n                          filter: isCritical ? 'drop-shadow(0 0 6px rgba(239, 68, 68, 0.8))' : 'drop-shadow(0 0 2px rgba(99, 102, 241, 0.4))',\n                          opacity: 1,\n                          zIndex: 1000 + index,\n                          pointerEvents: 'none'\n                        }}\n                      />\n                    </g>\n                  );\n                });\n\n                console.log(` Total lneas renderizadas en DOM: ${renderedLines.length}`);\n\n                return renderedLines;\n              })()}\n\n              {/* Nodos - DISEO MEJORADO */}\n              {networkNodes.map((node) => {\n                const isCritical = node.task.isCritical;\n                const isMilestone = node.task.isMilestone;\n                const progress = node.task.progress || 0;\n\n                // Colores y estilos mejorados\n                const nodeFill = isMilestone ? 'url(#milestoneGradient)' :\n                  isCritical ? 'url(#criticalGradient)' :\n                    'url(#nodeGradient)';\n                const nodeStroke = isCritical ? '#dc2626' : '#4f46e5';\n                const strokeWidth = isCritical ? 4 : 2;\n\n                return (\n                  <g key={node.id}>\n                    {/* Sombra del nodo */}\n                    <rect\n                      x={node.x + 3}\n                      y={node.y + 3}\n                      width={node.width}\n                      height={node.height}\n                      rx=\"12\"\n                      ry=\"12\"\n                      fill=\"rgba(0,0,0,0.2)\"\n                      className=\"pointer-events-none\"\n                    />\n\n                    {/* Nodo principal */}\n                    <rect\n                      x={node.x}\n                      y={node.y}\n                      width={node.width}\n                      height={node.height}\n                      rx=\"12\"\n                      ry=\"12\"\n                      fill={nodeFill}\n                      stroke={nodeStroke}\n                      strokeWidth={strokeWidth}\n                      className=\"cursor-grab hover:opacity-90 transition-all duration-200\"\n                      onMouseDown={(e) => handleNodeMouseDown(e, node.id)}\n                    />\n\n                    {/* Barra de progreso interna */}\n                    <rect\n                      x={node.x + 4}\n                      y={node.y + node.height - 8}\n                      width={(node.width - 8) * (progress / 100)}\n                      height=\"4\"\n                      rx=\"2\"\n                      ry=\"2\"\n                      fill=\"rgba(255,255,255,0.8)\"\n                      className=\"pointer-events-none\"\n                    />\n\n                    {/* Fondo de la barra de progreso */}\n                    <rect\n                      x={node.x + 4}\n                      y={node.y + node.height - 8}\n                      width={node.width - 8}\n                      height=\"4\"\n                      rx=\"2\"\n                      ry=\"2\"\n                      fill=\"rgba(255,255,255,0.3)\"\n                      className=\"pointer-events-none\"\n                    />\n\n                    {/* Texto del nodo - mejorado */}\n                    <text\n                      x={node.x + node.width / 2}\n                      y={node.y + node.height / 2 - (showSimplifiedView ? 8 : 12)}\n                      textAnchor=\"middle\"\n                      className=\"text-white font-bold pointer-events-none\"\n                      style={{\n                        textShadow: '1px 1px 2px rgba(0,0,0,0.5)',\n                        fontSize: showSimplifiedView ? '10px' : '12px'\n                      }}\n                    >\n                      {showSimplifiedView ?\n                        (node.task.name.length > 12 ?\n                          node.task.name.substring(0, 12) + '...' :\n                          node.task.name) :\n                        (node.task.name.length > 18 ?\n                          node.task.name.substring(0, 18) + '...' :\n                          node.task.name)\n                      }\n                    </text>\n\n                    {/* Informacin adicional - mejorada */}\n                    {!showSimplifiedView && (\n                      <text\n                        x={node.x + node.width / 2}\n                        y={node.y + node.height / 2 + 8}\n                        textAnchor=\"middle\"\n                        className=\"text-white text-xs font-medium pointer-events-none\"\n                        style={{ textShadow: '1px 1px 2px rgba(0,0,0,0.5)' }}\n                      >\n                        {node.task.duration}d  {progress}%\n                      </text>\n                    )}\n\n                    {/* Icono de milestone - mejorado */}\n                    {isMilestone && (\n                      <g>\n                        <circle\n                          cx={node.x + node.width - 20}\n                          cy={node.y + 25}\n                          r=\"12\"\n                          fill=\"rgba(255,255,255,0.9)\"\n                          className=\"pointer-events-none\"\n                        />\n                        <text\n                          x={node.x + node.width - 20}\n                          y={node.y + 30}\n                          textAnchor=\"middle\"\n                          className=\"text-indigo-600 text-sm pointer-events-none\"\n                        >\n                          \n                        </text>\n                      </g>\n                    )}\n\n                    {/* Indicador de ruta crtica - mejorado */}\n                    {isCritical && (\n                      <g>\n                        <circle\n                          cx={node.x + node.width / 2}\n                          cy={node.y - 15}\n                          r=\"15\"\n                          fill=\"rgba(220, 38, 38, 0.9)\"\n                          stroke=\"#dc2626\"\n                          strokeWidth=\"2\"\n                          className=\"pointer-events-none\"\n                        />\n                        <text\n                          x={node.x + node.width / 2}\n                          y={node.y - 10}\n                          textAnchor=\"middle\"\n                          className=\"text-white text-sm font-bold pointer-events-none\"\n                        >\n                          \n                        </text>\n                      </g>\n                    )}\n\n                    {/* Indicador de nivel */}\n                    <text\n                      x={node.x - 5}\n                      y={node.y + 15}\n                      textAnchor=\"middle\"\n                      className=\"text-gray-500 text-xs font-bold pointer-events-none\"\n                    >\n                      L{node.level}\n                    </text>\n                  </g>\n                );\n              })}\n\n              {/* Timeline markers */}\n              <g className=\"timeline-markers\">\n                {generateTimelineMarkers().map((marker, index) => (\n                  <g key={index}>\n                    <line\n                      x1={marker.x}\n                      y1={550}\n                      x2={marker.x}\n                      y2={570}\n                      stroke=\"#9ca3af\"\n                      strokeWidth=\"2\"\n                    />\n                    <text\n                      x={marker.x}\n                      y={590}\n                      textAnchor=\"middle\"\n                      className=\"text-gray-600 text-xs\"\n                    >\n                      {marker.label}\n                    </text>\n                  </g>\n                ))}\n              </g>\n            </svg>\n          </div>\n        </div>\n      )}\n\n      {/* Vista de Tareas de Minutas */}\n      {viewMode === 'minutas' && (\n        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6 pb-32\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h2 className=\"text-2xl font-bold text-gray-800\"> Tareas de Minutas</h2>\n            <button\n              onClick={handleOpenMinutaModal}\n              className=\"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 flex items-center space-x-2 transition-all duration-300\"\n            >\n              <span></span>\n              <span>Nueva Minuta</span>\n            </button>\n          </div>\n\n          {loadingMinutas ? (\n            <div className=\"text-center py-12\">\n              <div className=\"bg-gray-100 rounded-xl p-8\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n                <h3 className=\"text-xl font-semibold text-gray-600 mb-2\">Cargando minutas...</h3>\n                <p className=\"text-gray-500\">Obteniendo datos desde {useSupabase ? 'Supabase' : 'localStorage'}</p>\n              </div>\n            </div>\n          ) : minutasTasks.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <div className=\"bg-gray-100 rounded-xl p-8\">\n                <span className=\"text-6xl mb-4 block\"></span>\n                <h3 className=\"text-xl font-semibold text-gray-600 mb-2\">No hay tareas de minutas</h3>\n                <p className=\"text-gray-500 mb-4\">Crea tu primera minuta haciendo clic en \"Nueva Minuta\"</p>\n                <button\n                  onClick={handleOpenMinutaModal}\n                  className=\"bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors\"\n                >\n                   Crear Primera Minuta\n                </button>\n              </div>\n            </div>\n          ) : (\n            <div className=\"space-y-6\">\n              {/* Organizar por hitos */}\n              {tasks.filter(task => task.isMilestone).map(hito => {\n                const tareasDelHito = minutasTasks.filter(tarea => tarea.hitoId === hito.id);\n\n                if (tareasDelHito.length === 0) return null;\n\n                return (\n                  <div key={hito.id} className=\"border border-gray-200 rounded-lg overflow-hidden\">\n                    <div className=\"bg-blue-50 px-4 py-3 border-b border-gray-200\">\n                      <h3 className=\"font-semibold text-gray-800\">\n                         {hito.wbsCode} - {hito.name}\n                      </h3>\n                    </div>\n\n                    <div className=\"overflow-x-auto\">\n                      <table className=\"w-full\">\n                        <thead className=\"bg-gray-50\">\n                          <tr>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/3\">Tarea</th>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/6\">Responsable</th>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8\">Fecha</th>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8\">Estatus</th>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8\">Creada</th>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8\">Acciones</th>\n                          </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-gray-200\">\n                          {tareasDelHito\n                            .sort((a, b) => new Date(a.fecha) - new Date(b.fecha))\n                            .map((tarea, index) => (\n                              <tr key={tarea.id} className=\"hover:bg-gray-50\">\n                                <td className=\"px-4 py-3 text-sm text-gray-900\">{tarea.tarea}</td>\n                                <td className=\"px-4 py-3 text-sm text-gray-700\">{tarea.responsable}</td>\n                                <td className=\"px-4 py-3 text-sm text-gray-700\">\n                                  {(() => {\n                                    try {\n                                      const fecha = new Date(tarea.fecha);\n                                      return isNaN(fecha.getTime()) ? 'Fecha invlida' : fecha.toLocaleDateString('es-ES');\n                                    } catch (error) {\n                                      return 'Fecha invlida';\n                                    }\n                                  })()}\n                                </td>\n                                <td className=\"px-4 py-3 text-sm\">\n                                  <select\n                                    value={tarea.estatus}\n                                    onChange={async (e) => {\n                                      const newStatus = e.target.value;\n\n                                      // Actualizar inmediatamente en el estado local\n                                      setMinutasTasks(prev => {\n                                        const updatedTasks = prev.map(t => t.id === tarea.id ? { ...t, estatus: newStatus } : t);\n\n                                        //  CORRECCIN: Actualizar estado global para sincronizacin con Dashboard\n                                        if (updateProjectMinutas) {\n                                          updateProjectMinutas(projectData?.id, updatedTasks);\n                                        }\n\n                                        return updatedTasks;\n                                      });\n\n                                      // Si usa Supabase, actualizar en la base de datos\n                                      if (useSupabase) {\n                                        try {\n                                          const result = await supabaseService.updateMinutaStatus(tarea.id, newStatus);\n                                          if (!result.success) {\n                                            console.error(' Error actualizando estatus en Supabase:', result.error);\n                                            // Revertir el cambio local en caso de error\n                                            setMinutasTasks(prev =>\n                                              prev.map(t => t.id === tarea.id ? { ...t, estatus: newStatus } : t)\n                                            );\n                                          } else {\n                                            //  NUEVO: Disparar evento personalizado para sincronizacin\n                                            console.log(' Disparando evento minutaStatusChanged:', { tareaId: tarea.id, newStatus });\n                                            window.dispatchEvent(new CustomEvent('minutaStatusChanged', {\n                                              detail: {\n                                                tareaId: tarea.id,\n                                                newStatus,\n                                                projectId: projectData?.id,\n                                                timestamp: Date.now()\n                                              }\n                                            }));\n\n                                            //  NUEVO: Activar auto-save\n                                            console.log(' Disparando evento autoSaveTrigger para minuta');\n                                            window.dispatchEvent(new CustomEvent('autoSaveTrigger', {\n                                              detail: {\n                                                source: 'minutaUpdate',\n                                                data: { minutasTasks: minutasTasks }\n                                              }\n                                            }));\n                                          }\n                                        } catch (error) {\n                                          console.error(' Error actualizando estatus:', error);\n                                        }\n                                      } else {\n                                        //  NUEVO: Para modo local tambin disparar eventos\n                                        console.log(' Disparando evento minutaStatusChanged (modo local):', { tareaId: tarea.id, newStatus });\n                                        window.dispatchEvent(new CustomEvent('minutaStatusChanged', {\n                                          detail: {\n                                            tareaId: tarea.id,\n                                            newStatus,\n                                            projectId: projectData?.id,\n                                            timestamp: Date.now()\n                                          }\n                                        }));\n\n                                        //  NUEVO: Activar auto-save\n                                        window.dispatchEvent(new CustomEvent('autoSaveTrigger', {\n                                          detail: {\n                                            source: 'minutaUpdate',\n                                            data: { minutasTasks: minutasTasks }\n                                          }\n                                        }));\n                                      }\n                                    }}\n                                    className={`px-3 py-1 rounded-full text-xs font-medium border-none ${tarea.estatus === 'Pendiente' ? 'bg-yellow-100 text-yellow-800' :\n                                      tarea.estatus === 'En Proceso' ? 'bg-blue-100 text-blue-800' :\n                                        'bg-green-100 text-green-800'\n                                      }`}\n                                  >\n                                    <option value=\"Pendiente\">Pendiente</option>\n                                    <option value=\"En Proceso\">En Proceso</option>\n                                    <option value=\"Completado\">Completado</option>\n                                  </select>\n                                </td>\n                                <td className=\"px-4 py-3 text-sm text-gray-500\">\n                                  {(() => {\n                                    try {\n                                      const fecha = new Date(tarea.fechaCreacion);\n                                      return isNaN(fecha.getTime()) ? 'Fecha invlida' : fecha.toLocaleDateString('es-ES');\n                                    } catch (error) {\n                                      return 'Fecha invlida';\n                                    }\n                                  })()}\n                                </td>\n                                <td className=\"px-4 py-3 text-sm\">\n                                  <button\n                                    onClick={() => handleEditMinuta(tarea)}\n                                    className=\"text-blue-600 hover:text-blue-800 transition-colors\"\n                                    title=\"Editar minuta\"\n                                  >\n                                     Editar\n                                  </button>\n                                </td>\n                              </tr>\n                            ))}\n                        </tbody>\n                      </table>\n                    </div>\n                  </div>\n                );\n              })}\n\n              {/* Mostrar tareas sin hito asignado */}\n              {(() => {\n                const tareasSinHito = minutasTasks.filter(tarea => {\n                  if (!tarea.hitoId) return true;\n                  const hitoEncontrado = tasks.find(t => t.id === tarea.hitoId && t.isMilestone);\n                  if (!hitoEncontrado) {\n                    console.log(` DEBUG: Tarea ${tarea.id} busca hito ${tarea.hitoId} pero no se encuentra`);\n                    console.log(` DEBUG: Hitos disponibles:`, tasks.filter(t => t.isMilestone).map(h => ({ id: h.id, name: h.name })));\n                  }\n                  return !hitoEncontrado;\n                });\n                return tareasSinHito.length > 0;\n              })() && (\n                  <div className=\"border border-gray-200 rounded-lg overflow-hidden\">\n                    <div className=\"bg-gray-50 px-4 py-3 border-b border-gray-200\">\n                      <h3 className=\"font-semibold text-gray-800\"> Sin hito asignado</h3>\n                    </div>\n\n                    <div className=\"overflow-x-auto\">\n                      <table className=\"w-full\">\n                        <thead className=\"bg-gray-50\">\n                          <tr>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/3\">Tarea</th>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/6\">Responsable</th>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8\">Fecha</th>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8\">Estatus</th>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8\">Creada</th>\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-700 w-1/8\">Acciones</th>\n                          </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-gray-200\">\n                          {minutasTasks\n                            .filter(tarea => {\n                              if (!tarea.hitoId) return true;\n                              const hitoEncontrado = tasks.find(t => t.id === tarea.hitoId && t.isMilestone);\n                              return !hitoEncontrado;\n                            })\n                            .sort((a, b) => new Date(a.fecha) - new Date(b.fecha))\n                            .map((tarea) => (\n                              <tr key={tarea.id} className=\"hover:bg-gray-50\">\n                                <td className=\"px-4 py-3 text-sm text-gray-900\">{tarea.tarea}</td>\n                                <td className=\"px-4 py-3 text-sm text-gray-700\">{tarea.responsable}</td>\n                                <td className=\"px-4 py-3 text-sm text-gray-700\">\n                                  {(() => {\n                                    try {\n                                      const fecha = new Date(tarea.fecha);\n                                      return isNaN(fecha.getTime()) ? 'Fecha invlida' : fecha.toLocaleDateString('es-ES');\n                                    } catch (error) {\n                                      return 'Fecha invlida';\n                                    }\n                                  })()}\n                                </td>\n                                <td className=\"px-4 py-3 text-sm\">\n                                  <select\n                                    value={tarea.estatus}\n                                    onChange={async (e) => {\n                                      const newStatus = e.target.value;\n\n                                      // Actualizar inmediatamente en el estado local\n                                      setMinutasTasks(prev =>\n                                        prev.map(t => t.id === tarea.id ? { ...t, estatus: newStatus } : t)\n                                      );\n\n                                      // Si usa Supabase, actualizar en la base de datos\n                                      if (useSupabase) {\n                                        try {\n                                          const result = await supabaseService.updateMinutaStatus(tarea.id, newStatus);\n                                          if (!result.success) {\n                                            console.error(' Error actualizando estatus en Supabase:', result.error);\n                                            // Revertir el cambio local en caso de error\n                                            setMinutasTasks(prev =>\n                                              prev.map(t => t.id === tarea.id ? { ...t, estatus: newStatus } : t)\n                                            );\n                                          } else {\n                                            //  NUEVO: Disparar evento personalizado para sincronizacin\n                                            console.log(' Disparando evento minutaStatusChanged (tabla 2):', { tareaId: tarea.id, newStatus });\n                                            window.dispatchEvent(new CustomEvent('minutaStatusChanged', {\n                                              detail: {\n                                                tareaId: tarea.id,\n                                                newStatus,\n                                                projectId: projectData?.id,\n                                                timestamp: Date.now()\n                                              }\n                                            }));\n\n                                            //  NUEVO: Activar auto-save\n                                            window.dispatchEvent(new CustomEvent('autoSaveTrigger', {\n                                              detail: {\n                                                source: 'minutaUpdate',\n                                                data: { minutasTasks: minutasTasks }\n                                              }\n                                            }));\n                                          }\n                                        } catch (error) {\n                                          console.error(' Error actualizando estatus:', error);\n                                        }\n                                      } else {\n                                        //  NUEVO: Para modo local tambin disparar eventos\n                                        console.log(' Disparando evento minutaStatusChanged (modo local, tabla 2):', { tareaId: tarea.id, newStatus });\n                                        window.dispatchEvent(new CustomEvent('minutaStatusChanged', {\n                                          detail: {\n                                            tareaId: tarea.id,\n                                            newStatus,\n                                            projectId: projectData?.id,\n                                            timestamp: Date.now()\n                                          }\n                                        }));\n\n                                        //  NUEVO: Activar auto-save\n                                        window.dispatchEvent(new CustomEvent('autoSaveTrigger', {\n                                          detail: {\n                                            source: 'minutaUpdate',\n                                            data: { minutasTasks: minutasTasks }\n                                          }\n                                        }));\n                                      }\n                                    }}\n                                    className={`px-3 py-1 rounded-full text-xs font-medium border-none ${tarea.estatus === 'Pendiente' ? 'bg-yellow-100 text-yellow-800' :\n                                      tarea.estatus === 'En Proceso' ? 'bg-blue-100 text-blue-800' :\n                                        'bg-green-100 text-green-800'\n                                      }`}\n                                  >\n                                    <option value=\"Pendiente\">Pendiente</option>\n                                    <option value=\"En Proceso\">En Proceso</option>\n                                    <option value=\"Completado\">Completado</option>\n                                  </select>\n                                </td>\n                                <td className=\"px-4 py-3 text-sm text-gray-500\">\n                                  {(() => {\n                                    try {\n                                      const fecha = new Date(tarea.fechaCreacion);\n                                      return isNaN(fecha.getTime()) ? 'Fecha invlida' : fecha.toLocaleDateString('es-ES');\n                                    } catch (error) {\n                                      return 'Fecha invlida';\n                                    }\n                                  })()}\n                                </td>\n                                <td className=\"px-4 py-3 text-sm\">\n                                  <button\n                                    onClick={() => handleEditMinuta(tarea)}\n                                    className=\"text-blue-600 hover:text-blue-800 transition-colors\"\n                                    title=\"Editar minuta\"\n                                  >\n                                     Editar\n                                  </button>\n                                </td>\n                              </tr>\n                            ))}\n                        </tbody>\n                      </table>\n                    </div>\n                  </div>\n                )}\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* MODAL INFORMATIVO PARA VISTA GANTT */}\n      {selectedTask && viewMode === 'gantt' && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg shadow-xl p-6 w-full max-w-md\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-bold text-gray-800\"> Vista Solo Lectura</h2>\n              <button\n                onClick={() => setSelectedTask(null)}\n                className=\"text-gray-500 hover:text-gray-700 text-2xl\"\n              >\n                \n              </button>\n            </div>\n\n            <div className=\"text-center\">\n              <div className=\"text-4xl mb-4\"></div>\n              <h3 className=\"text-lg font-semibold text-gray-700 mb-2\">\n                {selectedTask.name}\n              </h3>\n              <p className=\"text-gray-600 mb-4\">\n                Esta es la vista de solo lectura del diagrama Gantt.\n              </p>\n              <p className=\"text-sm text-gray-500 mb-6\">\n                Para editar esta tarea, cambia a la <strong>Vista Tabla</strong>.\n              </p>\n\n              <div className=\"flex space-x-3\">\n                <button\n                  onClick={() => setViewMode('excel')}\n                  className=\"flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors\"\n                >\n                   Ir a Vista Tabla\n                </button>\n                <button\n                  onClick={() => setSelectedTask(null)}\n                  className=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\n                >\n                  Cerrar\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* MODAL NUEVO Y LIMPIO DE EDICIN DE TAREA - SOLO EN VISTA TABLA */}\n      {selectedTask && viewMode !== 'gantt' && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-2xl font-bold\">{selectedTask.name}</h2>\n              <button\n                onClick={() => setSelectedTask(null)}\n                className=\"text-gray-500 hover:text-gray-700 text-2xl\"\n              >\n                \n              </button>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              {/* Informacin Bsica */}\n              <div>\n                <h3 className=\"text-lg font-semibold mb-4\">Informacin Bsica</h3>\n\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Nombre de la Tarea\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={selectedTask.name}\n                      onChange={(e) => setSelectedTask(prev => ({\n                        id: prev.id,\n                        wbsCode: prev.wbsCode,\n                        name: e.target.value,\n                        duration: prev.duration,\n                        startDate: prev.startDate,\n                        endDate: prev.endDate,\n                        progress: prev.progress,\n                        predecessors: [...(prev.predecessors || [])],\n                        cost: prev.cost,\n                        priority: prev.priority,\n                        assignedTo: prev.assignedTo,\n                        isMilestone: prev.isMilestone,\n                        isCritical: prev.isCritical,\n                        originalDuration: prev.originalDuration,\n                        earlyStart: prev.earlyStart,\n                        earlyFinish: prev.earlyFinish,\n                        lateStart: prev.lateStart,\n                        lateFinish: prev.lateFinish,\n                        totalFloat: prev.totalFloat,\n                        freeFloat: prev.freeFloat,\n                        description: prev.description,\n                        resources: [...(prev.resources || [])],\n                        workPackageId: prev.workPackageId,\n                        status: prev.status,\n                        successors: [...(prev.successors || [])]\n                      }))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Duracin (das)\n                    </label>\n                    <div className=\"flex items-center space-x-2\">\n                      <button\n                        onClick={() => setSelectedTask(prev => ({\n                          id: prev.id,\n                          wbsCode: prev.wbsCode,\n                          name: prev.name,\n                          duration: Math.max(1, prev.duration - 1),\n                          startDate: prev.startDate,\n                          endDate: prev.endDate,\n                          progress: prev.progress,\n                          predecessors: [...(prev.predecessors || [])],\n                          cost: prev.cost,\n                          priority: prev.priority,\n                          assignedTo: prev.assignedTo,\n                          isMilestone: prev.isMilestone,\n                          isCritical: prev.isCritical,\n                          originalDuration: prev.originalDuration,\n                          earlyStart: prev.earlyStart,\n                          earlyFinish: prev.earlyFinish,\n                          lateStart: prev.lateStart,\n                          lateFinish: prev.lateFinish,\n                          totalFloat: prev.totalFloat,\n                          freeFloat: prev.freeFloat,\n                          description: prev.description,\n                          resources: [...(prev.resources || [])],\n                          workPackageId: prev.workPackageId,\n                          status: prev.status,\n                          successors: [...(prev.successors || [])]\n                        }))}\n                        className=\"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300\"\n                      >\n                        -\n                      </button>\n                      <input\n                        type=\"number\"\n                        value={selectedTask.duration}\n                        onChange={(e) => setSelectedTask(prev => ({\n                          id: prev.id,\n                          wbsCode: prev.wbsCode,\n                          name: prev.name,\n                          duration: parseInt(e.target.value) || 1,\n                          startDate: prev.startDate,\n                          endDate: prev.endDate,\n                          progress: prev.progress,\n                          predecessors: [...(prev.predecessors || [])],\n                          cost: prev.cost,\n                          priority: prev.priority,\n                          assignedTo: prev.assignedTo,\n                          isMilestone: prev.isMilestone,\n                          isCritical: prev.isCritical,\n                          originalDuration: prev.originalDuration,\n                          earlyStart: prev.earlyStart,\n                          earlyFinish: prev.earlyFinish,\n                          lateStart: prev.lateStart,\n                          lateFinish: prev.lateFinish,\n                          totalFloat: prev.totalFloat,\n                          freeFloat: prev.freeFloat,\n                          description: prev.description,\n                          resources: [...(prev.resources || [])],\n                          workPackageId: prev.workPackageId,\n                          status: prev.status,\n                          successors: [...(prev.successors || [])]\n                        }))}\n                        className=\"w-20 px-3 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                        min=\"1\"\n                      />\n                      <button\n                        onClick={() => setSelectedTask(prev => ({\n                          id: prev.id,\n                          wbsCode: prev.wbsCode,\n                          name: prev.name,\n                          duration: prev.duration + 1,\n                          startDate: prev.startDate,\n                          endDate: prev.endDate,\n                          progress: prev.progress,\n                          predecessors: [...(prev.predecessors || [])],\n                          cost: prev.cost,\n                          priority: prev.priority,\n                          assignedTo: prev.assignedTo,\n                          isMilestone: prev.isMilestone,\n                          isCritical: prev.isCritical,\n                          originalDuration: prev.originalDuration,\n                          earlyStart: prev.earlyStart,\n                          earlyFinish: prev.earlyFinish,\n                          lateStart: prev.lateStart,\n                          lateFinish: prev.lateFinish,\n                          totalFloat: prev.totalFloat,\n                          freeFloat: prev.freeFloat,\n                          description: prev.description,\n                          resources: [...(prev.resources || [])],\n                          workPackageId: prev.workPackageId,\n                          status: prev.status,\n                          successors: [...(prev.successors || [])]\n                        }))}\n                        className=\"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300\"\n                      >\n                        +\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Dependencias - SISTEMA NUEVO Y SIMPLIFICADO */}\n              <div>\n                <h3 className=\"text-lg font-semibold mb-4\">Dependencias</h3>\n\n                {/* Predecesoras */}\n                <div className=\"mb-6\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Predecesoras ({selectedTask.predecessors?.length || 0})\n                  </label>\n\n                  {/* Lista de tareas disponibles para predecesoras */}\n                  <div className=\"space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-2\">\n                    {tasks.filter(task => task.id !== selectedTask.id).map(task => (\n                      <label key={task.id} className=\"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded\">\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedTask.predecessors?.includes(task.id) || false}\n                          onChange={(e) => {\n                            const currentPreds = selectedTask.predecessors || [];\n                            if (e.target.checked) {\n                              setSelectedTask(prev => ({\n                                id: prev.id,\n                                wbsCode: prev.wbsCode,\n                                name: prev.name,\n                                duration: prev.duration,\n                                startDate: prev.startDate,\n                                endDate: prev.endDate,\n                                progress: prev.progress,\n                                predecessors: [...(currentPreds || []), task.id],\n                                cost: prev.cost,\n                                priority: prev.priority,\n                                assignedTo: prev.assignedTo,\n                                isMilestone: prev.isMilestone,\n                                isCritical: prev.isCritical,\n                                originalDuration: prev.originalDuration,\n                                earlyStart: prev.earlyStart,\n                                earlyFinish: prev.earlyFinish,\n                                lateStart: prev.lateStart,\n                                lateFinish: prev.lateFinish,\n                                totalFloat: prev.totalFloat,\n                                freeFloat: prev.freeFloat,\n                                description: prev.description,\n                                resources: [...(prev.resources || [])],\n                                workPackageId: prev.workPackageId,\n                                status: prev.status,\n                                successors: [...(prev.successors || [])]\n                              }));\n                            } else {\n                              setSelectedTask(prev => ({\n                                id: prev.id,\n                                wbsCode: prev.wbsCode,\n                                name: prev.name,\n                                duration: prev.duration,\n                                startDate: prev.startDate,\n                                endDate: prev.endDate,\n                                progress: prev.progress,\n                                predecessors: currentPreds.filter(id => id !== task.id),\n                                cost: prev.cost,\n                                priority: prev.priority,\n                                assignedTo: prev.assignedTo,\n                                isMilestone: prev.isMilestone,\n                                isCritical: prev.isCritical,\n                                originalDuration: prev.originalDuration,\n                                earlyStart: prev.earlyStart,\n                                earlyFinish: prev.earlyFinish,\n                                lateStart: prev.lateStart,\n                                lateFinish: prev.lateFinish,\n                                totalFloat: prev.totalFloat,\n                                freeFloat: prev.freeFloat,\n                                description: prev.description,\n                                resources: [...(prev.resources || [])],\n                                workPackageId: prev.workPackageId,\n                                status: prev.status,\n                                successors: [...(prev.successors || [])]\n                              }));\n                            }\n                          }}\n                          className=\"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"\n                        />\n                        <span className=\"text-sm\">\n                          {task.wbsCode} - {task.name}\n                        </span>\n                      </label>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Sucesoras */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Sucesoras ({selectedTask.successors?.length || 0})\n                  </label>\n\n                  {/* Lista de tareas disponibles para sucesoras */}\n                  <div className=\"space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-2\">\n                    {tasks.filter(task => task.id !== selectedTask.id).map(task => (\n                      <label key={task.id} className=\"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded\">\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedTask.successors?.includes(task.id) || false}\n                          onChange={(e) => {\n                            const currentSuccs = selectedTask.successors || [];\n                            if (e.target.checked) {\n                              setSelectedTask(prev => ({\n                                id: prev.id,\n                                wbsCode: prev.wbsCode,\n                                name: prev.name,\n                                duration: prev.duration,\n                                startDate: prev.startDate,\n                                endDate: prev.endDate,\n                                progress: prev.progress,\n                                predecessors: [...(prev.predecessors || [])],\n                                cost: prev.cost,\n                                priority: prev.priority,\n                                assignedTo: prev.assignedTo,\n                                isMilestone: prev.isMilestone,\n                                isCritical: prev.isCritical,\n                                originalDuration: prev.originalDuration,\n                                earlyStart: prev.earlyStart,\n                                earlyFinish: prev.earlyFinish,\n                                lateStart: prev.lateStart,\n                                lateFinish: prev.lateFinish,\n                                totalFloat: prev.totalFloat,\n                                freeFloat: prev.freeFloat,\n                                description: prev.description,\n                                resources: [...(prev.resources || [])],\n                                workPackageId: prev.workPackageId,\n                                status: prev.status,\n                                successors: currentSuccs.slice().concat([task.id])\n                              }));\n                            } else {\n                              setSelectedTask(prev => ({\n                                id: prev.id,\n                                wbsCode: prev.wbsCode,\n                                name: prev.name,\n                                duration: prev.duration,\n                                startDate: prev.startDate,\n                                endDate: prev.endDate,\n                                progress: prev.progress,\n                                predecessors: [...(prev.predecessors || [])],\n                                cost: prev.cost,\n                                priority: prev.priority,\n                                assignedTo: prev.assignedTo,\n                                isMilestone: prev.isMilestone,\n                                isCritical: prev.isCritical,\n                                originalDuration: prev.originalDuration,\n                                earlyStart: prev.earlyStart,\n                                earlyFinish: prev.earlyFinish,\n                                lateStart: prev.lateStart,\n                                lateFinish: prev.lateFinish,\n                                totalFloat: prev.totalFloat,\n                                freeFloat: prev.freeFloat,\n                                description: prev.description,\n                                resources: [...(prev.resources || [])],\n                                workPackageId: prev.workPackageId,\n                                status: prev.status,\n                                successors: currentSuccs.filter(id => id !== task.id)\n                              }));\n                            }\n                          }}\n                          className=\"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"\n                        />\n                        <span className=\"text-sm\">\n                          {task.wbsCode} - {task.name}\n                        </span>\n                      </label>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Botones de accin */}\n            <div className=\"flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200\">\n              <button\n                onClick={() => setSelectedTask(null)}\n                className=\"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50\"\n              >\n                Cancelar\n              </button>\n              <button\n                onClick={() => {\n                  console.log(' MODAL NUEVO - Guardando tarea:', selectedTask);\n\n                  // Actualizar directamente el estado global\n                  setTasks(prev => {\n                    return prev.map(task => {\n                      if (task.id === selectedTask.id) {\n                        return {\n                          id: task.id,\n                          wbsCode: task.wbsCode,\n                          name: selectedTask.name,\n                          duration: selectedTask.duration,\n                          startDate: task.startDate,\n                          endDate: task.endDate,\n                          progress: task.progress,\n                          predecessors: selectedTask.predecessors || [],\n                          cost: task.cost,\n                          priority: task.priority,\n                          assignedTo: task.assignedTo,\n                          isMilestone: task.isMilestone,\n                          isCritical: task.isCritical,\n                          originalDuration: task.originalDuration,\n                          earlyStart: task.earlyStart,\n                          earlyFinish: task.earlyFinish,\n                          lateStart: task.lateStart,\n                          lateFinish: task.lateFinish,\n                          totalFloat: task.totalFloat,\n                          freeFloat: task.freeFloat,\n                          description: task.description,\n                          resources: [...(task.resources || [])],\n                          workPackageId: task.workPackageId,\n                          status: task.status,\n                          successors: selectedTask.successors || []\n                        };\n                      }\n                      return task;\n                    });\n                  });\n\n                  setSelectedTask(null);\n                }}\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\n              >\n                Guardar Cambios\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* MODAL VIEJO ELIMINADO PARA EVITAR CONFLICTOS */}\n      {false && selectedTask && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" data-task-id={selectedTask.id}>\n          <div className=\"bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-2xl font-bold\">{selectedTask.name}</h2>\n              <button\n                onClick={() => setSelectedTask(null)}\n                className=\"text-gray-500 hover:text-gray-700 text-2xl\"\n              >\n                \n              </button>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* Informacin Bsica */}\n              <div className=\"space-y-4\">\n                <h3 className=\"text-lg font-semibold\">Informacin Bsica</h3>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nombre de la Tarea\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={selectedTask.name || ''}\n                    onChange={(e) => {\n                      const newName = e.target.value;\n                      setSelectedTask(prev => ({\n                        id: prev.id,\n                        wbsCode: prev.wbsCode,\n                        name: newName,\n                        duration: prev.duration,\n                        startDate: prev.startDate,\n                        endDate: prev.endDate,\n                        progress: prev.progress,\n                        predecessors: [...(prev.predecessors || [])],\n                        cost: prev.cost,\n                        priority: prev.priority,\n                        assignedTo: prev.assignedTo,\n                        isMilestone: prev.isMilestone,\n                        isCritical: prev.isCritical,\n                        originalDuration: prev.originalDuration,\n                        earlyStart: prev.earlyStart,\n                        earlyFinish: prev.earlyFinish,\n                        lateStart: prev.lateStart,\n                        lateFinish: prev.lateFinish,\n                        totalFloat: prev.totalFloat,\n                        freeFloat: prev.freeFloat,\n                        description: prev.description,\n                        resources: [...(prev.resources || [])],\n                        workPackageId: prev.workPackageId,\n                        status: prev.status,\n                        successors: [...(prev.successors || [])]\n                      }));\n                    }}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Duracin (das)\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={selectedTask.duration || 0}\n                    onChange={(e) => {\n                      const newDuration = parseInt(e.target.value) || 0;\n                      setSelectedTask(prev => ({\n                        id: prev.id,\n                        wbsCode: prev.wbsCode,\n                        name: prev.name,\n                        duration: newDuration,\n                        startDate: prev.startDate,\n                        endDate: prev.endDate,\n                        progress: prev.progress,\n                        predecessors: [...(prev.predecessors || [])],\n                        cost: prev.cost,\n                        priority: prev.priority,\n                        assignedTo: prev.assignedTo,\n                        isMilestone: prev.isMilestone,\n                        isCritical: prev.isCritical,\n                        originalDuration: prev.originalDuration,\n                        earlyStart: prev.earlyStart,\n                        earlyFinish: prev.earlyFinish,\n                        lateStart: prev.lateStart,\n                        lateFinish: prev.lateFinish,\n                        totalFloat: prev.totalFloat,\n                        freeFloat: prev.freeFloat,\n                        description: prev.description,\n                        resources: [...(prev.resources || [])],\n                        workPackageId: prev.workPackageId,\n                        status: prev.status,\n                        successors: [...(prev.successors || [])]\n                      }));\n                    }}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                  />\n                </div>\n              </div>\n\n              {/* Dependencias */}\n              <div className=\"space-y-4\">\n                <h3 className=\"text-lg font-semibold\">Dependencias</h3>\n\n                {/* Predecesoras */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Predecesoras ({(tasks.find(t => t.id === selectedTask.id)?.predecessors || []).length})\n                  </label>\n                  <div className=\"space-y-2\">\n                    {(tasks.find(t => t.id === selectedTask.id)?.predecessors || [])?.map((predId, index) => {\n                      const predTask = tasks.find(t => t.id === predId);\n                      return (\n                        <div key={index} className=\"flex items-center justify-between bg-gray-50 p-2 rounded\" data-predecessor-id={predId}>\n                          <span className=\"text-sm\">\n                            {predTask ? `${predTask.wbsCode} - ${predTask.name}` : predId}\n                          </span>\n                          <button\n                            onClick={() => {\n                              const newPredecessors = selectedTask.predecessors.filter(id => id !== predId);\n                              setSelectedTask(prev => ({\n                                id: prev.id,\n                                wbsCode: prev.wbsCode,\n                                name: prev.name,\n                                duration: prev.duration,\n                                startDate: prev.startDate,\n                                endDate: prev.endDate,\n                                progress: prev.progress,\n                                predecessors: newPredecessors,\n                                cost: prev.cost,\n                                priority: prev.priority,\n                                assignedTo: prev.assignedTo,\n                                isMilestone: prev.isMilestone,\n                                isCritical: prev.isCritical,\n                                originalDuration: prev.originalDuration,\n                                earlyStart: prev.earlyStart,\n                                earlyFinish: prev.earlyFinish,\n                                lateStart: prev.lateStart,\n                                lateFinish: prev.lateFinish,\n                                totalFloat: prev.totalFloat,\n                                freeFloat: prev.freeFloat,\n                                description: prev.description,\n                                resources: [...(prev.resources || [])],\n                                workPackageId: prev.workPackageId,\n                                status: prev.status,\n                                successors: [...(prev.successors || [])]\n                              }));\n                            }}\n                            className=\"text-red-500 hover:text-red-700 text-sm\"\n                          >\n                            \n                          </button>\n                        </div>\n                      );\n                    })}\n                  </div>\n\n                  <select\n                    onChange={(e) => {\n                      const newPredId = e.target.value;\n                      if (newPredId && !selectedTask.predecessors?.includes(newPredId)) {\n                        const newPredecessors = [...(selectedTask.predecessors || []), newPredId];\n                        setSelectedTask(prev => ({\n                          id: prev.id,\n                          wbsCode: prev.wbsCode,\n                          name: prev.name,\n                          duration: prev.duration,\n                          startDate: prev.startDate,\n                          endDate: prev.endDate,\n                          progress: prev.progress,\n                          predecessors: newPredecessors,\n                          cost: prev.cost,\n                          priority: prev.priority,\n                          assignedTo: prev.assignedTo,\n                          isMilestone: prev.isMilestone,\n                          isCritical: prev.isCritical,\n                          originalDuration: prev.originalDuration,\n                          earlyStart: prev.earlyStart,\n                          earlyFinish: prev.earlyFinish,\n                          lateStart: prev.lateStart,\n                          lateFinish: prev.lateFinish,\n                          totalFloat: prev.totalFloat,\n                          freeFloat: prev.freeFloat,\n                          description: prev.description,\n                          resources: [...(prev.resources || [])],\n                          workPackageId: prev.workPackageId,\n                          status: prev.status,\n                          successors: [...(prev.successors || [])]\n                        }));\n                        e.target.value = '';\n                      }\n                    }}\n                    className=\"w-full mt-2 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                  >\n                    <option value=\"\">Agregar predecesora...</option>\n                    {tasks\n                      .filter(t => t.id !== selectedTask.id && !selectedTask.predecessors?.includes(t.id))\n                      .map(task => (\n                        <option key={task.id} value={task.id}>\n                          {task.wbsCode} - {task.name}\n                        </option>\n                      ))}\n                  </select>\n                </div>\n\n                {/* Sucesoras */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Sucesoras ({(tasks.find(t => t.id === selectedTask.id)?.successors || []).length})\n                  </label>\n                  <div className=\"space-y-2\">\n                    {(tasks.find(t => t.id === selectedTask.id)?.successors || [])?.map((succId, index) => {\n                      const succTask = tasks.find(t => t.id === succId);\n                      return (\n                        <div key={index} className=\"flex items-center justify-between bg-gray-50 p-2 rounded\" data-successor-id={succId}>\n                          <span className=\"text-sm\">\n                            {succTask ? `${succTask.wbsCode} - ${succTask.name}` : succId}\n                          </span>\n                          <button\n                            onClick={() => {\n                              const newSuccessors = selectedTask.successors.filter(id => id !== succId);\n                              setSelectedTask(prev => ({\n                                id: prev.id,\n                                wbsCode: prev.wbsCode,\n                                name: prev.name,\n                                duration: prev.duration,\n                                startDate: prev.startDate,\n                                endDate: prev.endDate,\n                                progress: prev.progress,\n                                predecessors: [...(prev.predecessors || [])],\n                                cost: prev.cost,\n                                priority: prev.priority,\n                                assignedTo: prev.assignedTo,\n                                isMilestone: prev.isMilestone,\n                                isCritical: prev.isCritical,\n                                originalDuration: prev.originalDuration,\n                                earlyStart: prev.earlyStart,\n                                earlyFinish: prev.earlyFinish,\n                                lateStart: prev.lateStart,\n                                lateFinish: prev.lateFinish,\n                                totalFloat: prev.totalFloat,\n                                freeFloat: prev.freeFloat,\n                                description: prev.description,\n                                resources: [...(prev.resources || [])],\n                                workPackageId: prev.workPackageId,\n                                status: prev.status,\n                                successors: newSuccessors\n                              }));\n                            }}\n                            className=\"text-red-500 hover:text-red-700 text-sm\"\n                          >\n                            \n                          </button>\n                        </div>\n                      );\n                    })}\n                  </div>\n\n                  <select\n                    onChange={(e) => {\n                      const newSuccId = e.target.value;\n                      console.log(' NUEVO MODAL - Agregando sucesora:', newSuccId);\n                      console.log(' NUEVO MODAL - selectedTask.successors ANTES:', selectedTask.successors);\n\n                      if (newSuccId && !selectedTask.successors?.includes(newSuccId)) {\n                        const newSuccessors = [...(selectedTask.successors || []), newSuccId];\n                        console.log(' NUEVO MODAL - newSuccessors:', newSuccessors);\n\n                        setSelectedTask(prev => {\n                          const updated = {\n                            id: prev.id,\n                            wbsCode: prev.wbsCode,\n                            name: prev.name,\n                            duration: prev.duration,\n                            startDate: prev.startDate,\n                            endDate: prev.endDate,\n                            progress: prev.progress,\n                            predecessors: [...(prev.predecessors || [])],\n                            cost: prev.cost,\n                            priority: prev.priority,\n                            assignedTo: prev.assignedTo,\n                            isMilestone: prev.isMilestone,\n                            isCritical: prev.isCritical,\n                            originalDuration: prev.originalDuration,\n                            earlyStart: prev.earlyStart,\n                            earlyFinish: prev.earlyFinish,\n                            lateStart: prev.lateStart,\n                            lateFinish: prev.lateFinish,\n                            totalFloat: prev.totalFloat,\n                            freeFloat: prev.freeFloat,\n                            description: prev.description,\n                            resources: [...(prev.resources || [])],\n                            workPackageId: prev.workPackageId,\n                            status: prev.status,\n                            successors: newSuccessors\n                          };\n                          console.log(' NUEVO MODAL - selectedTask DESPUS de setSelectedTask:', updated);\n                          return updated;\n                        });\n                        e.target.value = '';\n                      }\n                    }}\n                    className=\"w-full mt-2 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                  >\n                    <option value=\"\">Agregar sucesora...</option>\n                    {tasks\n                      .filter(t => t.id !== selectedTask.id && !selectedTask.successors?.includes(t.id))\n                      .map(task => (\n                        <option key={task.id} value={task.id}>\n                          {task.wbsCode} - {task.name}\n                        </option>\n                      ))}\n                  </select>\n                </div>\n              </div>\n            </div>\n\n            {/* Botones de Accin */}\n            <div className=\"flex justify-end space-x-4 mt-6 pt-6 border-t\">\n              <button\n                onClick={() => setSelectedTask(null)}\n                className=\"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50\"\n              >\n                Cancelar\n              </button>\n              <button\n                onClick={() => {\n                  console.log(' NUEVO MODAL - selectedTask COMPLETO al hacer clic en Guardar:', selectedTask);\n\n                  // SOLUCIN RADICAL: Guardar directamente sin usar selectedTask\n                  const taskId = selectedTask.id;\n                  const taskName = selectedTask.name;\n                  const taskDuration = selectedTask.duration;\n\n                  // Obtener predecesoras y sucesoras directamente del DOM\n                  const predecessorsList = document.querySelectorAll('[data-predecessor-id]');\n                  const successorsList = document.querySelectorAll('[data-successor-id]');\n\n                  console.log(' NUEVO MODAL - Elementos encontrados en DOM:', {\n                    predecessorsList: predecessorsList.length,\n                    successorsList: successorsList.length,\n                    predecessorsElements: Array.from(predecessorsList).map(el => ({\n                      id: el.getAttribute('data-predecessor-id'),\n                      text: el.textContent,\n                      outerHTML: el.outerHTML\n                    })),\n                    successorsElements: Array.from(successorsList).map(el => ({\n                      id: el.getAttribute('data-successor-id'),\n                      text: el.textContent,\n                      outerHTML: el.outerHTML\n                    }))\n                  });\n\n                  // Verificar si hay elementos de dependencias en el modal (SEGUNDA DECLARACIN ELIMINADA)\n                  // const allDependencyElements = document.querySelectorAll('[data-predecessor-id], [data-successor-id]');\n                  // console.log(' NUEVO MODAL - Todos los elementos de dependencias en el DOM:', {\n                  //   total: allDependencyElements.length,\n                  //   elements: Array.from(allDependencyElements).map(el => ({\n                  //     tagName: el.tagName,\n                  //     className: el.className,\n                  //     outerHTML: el.outerHTML\n                  //   }))\n                  // });\n\n                  // Verificar el HTML del modal completo\n                  const modalElement = document.querySelector('[data-task-id]');\n                  console.log(' NUEVO MODAL - HTML del modal completo:', {\n                    modalExists: !!modalElement,\n                    modalHTML: modalElement?.outerHTML,\n                    modalInnerHTML: modalElement?.innerHTML\n                  });\n\n                  // Verificar si hay elementos de dependencias en el modal (SEGUNDA DECLARACIN ELIMINADA)\n                  // const allDependencyElements = document.querySelectorAll('[data-predecessor-id], [data-successor-id]');\n                  // console.log(' NUEVO MODAL - Todos los elementos de dependencias en el DOM:', {\n                  //   total: allDependencyElements.length,\n                  //   elements: Array.from(allDependencyElements).map(el => ({\n                  //     tagName: el.tagName,\n                  //     className: el.className,\n                  //     outerHTML: el.outerHTML\n                  //   }))\n                  // });\n\n                  const predecessors = Array.from(predecessorsList).map(el => el.getAttribute('data-predecessor-id'));\n                  const successors = Array.from(successorsList).map(el => el.getAttribute('data-successor-id'));\n\n                  console.log(' NUEVO MODAL - Datos obtenidos del DOM:', {\n                    taskId,\n                    taskName,\n                    taskDuration,\n                    predecessors,\n                    successors\n                  });\n\n                  console.log(' NUEVO MODAL - Arrays separados:', {\n                    predecessors: predecessors,\n                    successors: successors,\n                    predecessorsLength: predecessors.length,\n                    successorsLength: successors.length\n                  });\n\n                  // Actualizar directamente el estado global SIN sincronizacin bidireccional\n                  setTasks(prev => {\n                    console.log(' NUEVO MODAL - Actualizando estado global directamente');\n                    const updatedTasks = prev.map(task => {\n                      if (task.id === taskId) {\n                        console.log(' NUEVO MODAL - Dependencias a guardar en la tarea:', {\n                          predecessors: predecessors,\n                          successors: successors,\n                          predecessorsLength: predecessors.length,\n                          successorsLength: successors.length\n                        });\n\n                        const updatedTask = {\n                          id: task.id,\n                          wbsCode: task.wbsCode,\n                          name: taskName,\n                          duration: taskDuration,\n                          startDate: task.startDate,\n                          endDate: task.endDate,\n                          progress: task.progress,\n                          cost: task.cost,\n                          priority: task.priority,\n                          assignedTo: task.assignedTo,\n                          isMilestone: task.isMilestone,\n                          isCritical: task.isCritical,\n                          originalDuration: task.originalDuration,\n                          earlyStart: task.earlyStart,\n                          earlyFinish: task.earlyFinish,\n                          lateStart: task.lateStart,\n                          lateFinish: task.lateFinish,\n                          totalFloat: task.totalFloat,\n                          freeFloat: task.freeFloat,\n                          description: task.description,\n                          resources: [...(task.resources || [])],\n                          workPackageId: task.workPackageId,\n                          status: task.status,\n                          predecessors: predecessors,\n                          successors: successors\n                        };\n                        console.log(' NUEVO MODAL - Tarea actualizada:', updatedTask);\n                        console.log(' NUEVO MODAL - Dependencias guardadas:', {\n                          predecessors: updatedTask.predecessors,\n                          successors: updatedTask.successors,\n                          predecessorsLength: updatedTask.predecessors?.length,\n                          successorsLength: updatedTask.successors?.length\n                        });\n                        return updatedTask;\n                      }\n                      return task;\n                    });\n\n                    const finalTask = updatedTasks.find(t => t.id === taskId);\n                    console.log(' NUEVO MODAL - Estado global actualizado:', finalTask);\n                    console.log(' NUEVO MODAL - Dependencias finales:', {\n                      predecessors: finalTask?.predecessors,\n                      successors: finalTask?.successors,\n                      predecessorsLength: finalTask?.predecessors?.length,\n                      successorsLength: finalTask?.successors?.length\n                    });\n                    return updatedTasks;\n                  });\n\n                  setSelectedTask(null);\n\n                  // Verificar el estado despus de cerrar el modal\n                  setTimeout(() => {\n                    const taskAfterClose = tasks.find(t => t.id === taskId);\n                    console.log(' NUEVO MODAL - Estado despus de cerrar modal:', taskAfterClose);\n                    console.log(' NUEVO MODAL - Dependencias despus de cerrar:', {\n                      predecessors: taskAfterClose?.predecessors,\n                      successors: taskAfterClose?.successors,\n                      predecessorsLength: taskAfterClose?.predecessors?.length,\n                      successorsLength: taskAfterClose?.successors?.length\n                    });\n                  }, 100);\n                }}\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\n              >\n                Guardar Cambios\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Modal de Edicin de Tarea ORIGINAL (MANTENER PARA COMPATIBILIDAD) */}\n      {console.log(' RENDERIZADO - selectedTask existe?', !!selectedTask, selectedTask)}\n      {false && selectedTask && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" data-task-id={selectedTask.id}>\n          <div className=\"bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-2xl font-bold\">Detalles de la Tarea</h2>\n              <div className=\"flex items-center space-x-2\">\n                <button\n                  onClick={() => {\n                    console.log(' BOTN X - Cerrando modal desde X');\n                    console.log(' BOTN X - selectedTask ANTES:', selectedTask);\n                    console.log(' BOTN X - tasks.length ANTES:', tasks.length);\n                    setSelectedTask(null);\n                    console.log(' BOTN X - selectedTask establecido a null');\n                  }}\n                  className=\"text-gray-500 hover:text-gray-700 text-2xl font-bold\"\n                  title=\"Cerrar\"\n                >\n                  \n                </button>\n                <span className={`px-3 py-1 rounded-full text-sm font-semibold ${getStatusColor(selectedTask.status)}`}>\n                  {getStatusIcon(selectedTask.status)} {selectedTask.status}\n                </span>\n                {selectedTask.isCritical && (\n                  <span className=\"px-3 py-1 rounded-full text-sm font-semibold bg-red-100 text-red-800\">\n                     Tarea Crtica\n                  </span>\n                )}\n                {selectedTask.isMilestone && (\n                  <span className=\"px-3 py-1 rounded-full text-sm font-semibold bg-purple-100 text-purple-800\">\n                     Milestone\n                  </span>\n                )}\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\">\n              {/* Informacin Bsica */}\n              <div className=\"bg-gray-50 rounded-lg p-4\">\n                <h3 className=\"text-lg font-semibold mb-3 text-gray-800\"> Informacin Bsica</h3>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">ID:</span>\n                    <span className=\"font-medium\">{selectedTask.id}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">WBS:</span>\n                    <span className=\"font-medium\">{selectedTask.wbsCode}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Nombre:</span>\n                    <span className=\"font-medium\">{selectedTask.name}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Duracin:</span>\n                    <span className=\"font-medium\">{selectedTask.duration} das</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Inicio:</span>\n                    <span className=\"font-medium\">{new Date(selectedTask.startDate).toLocaleDateString('es')}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Fin:</span>\n                    <span className=\"font-medium\">{new Date(selectedTask.endDate).toLocaleDateString('es')}</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Progreso y Costos */}\n              <div className=\"bg-gray-50 rounded-lg p-4\">\n                <h3 className=\"text-lg font-semibold mb-3 text-gray-800\"> Progreso y Costos</h3>\n                <div className=\"space-y-3\">\n                  <div>\n                    <div className=\"flex justify-between text-sm mb-1\">\n                      <span className=\"text-gray-600\">Progreso</span>\n                      <span className=\"font-medium\">{selectedTask.progress}%</span>\n                    </div>\n                    <div className=\"w-full bg-gray-200 rounded-full h-3\">\n                      <div\n                        className=\"bg-indigo-600 h-3 rounded-full transition-all duration-300\"\n                        style={{ width: `${selectedTask.progress}%` }}\n                      />\n                    </div>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Costo:</span>\n                    <span className=\"font-medium\">${selectedTask.cost.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Float Total:</span>\n                    <span className=\"font-medium\">{selectedTask.totalFloat} das</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Float Libre:</span>\n                    <span className=\"font-medium\">{selectedTask.freeFloat} das</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Recursos y Dependencias */}\n              <div className=\"bg-gray-50 rounded-lg p-4\">\n                <h3 className=\"text-lg font-semibold mb-3 text-gray-800\"> Recursos y Dependencias</h3>\n                <div className=\"space-y-3\">\n                  <div>\n                    <span className=\"text-sm text-gray-600\">Recursos:</span>\n                    <div className=\"mt-1\">\n                      {selectedTask.resources.length > 0 ? (\n                        selectedTask.resources.map((resource, index) => (\n                          <span key={index} className=\"inline-block bg-indigo-100 text-indigo-800 text-xs font-medium px-2 py-1 rounded-full mr-1 mb-1\">\n                            {resource}\n                          </span>\n                        ))\n                      ) : (\n                        <span className=\"text-gray-500 text-sm\">Sin recursos asignados</span>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Predecesoras:</span>\n                    <span className=\"font-medium\">{selectedTask.predecessors.length}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Sucesoras:</span>\n                    <span className=\"font-medium\">{selectedTask.successors.length}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Panel de Anlisis de Ruta Crtica */}\n            {selectedTask.isCritical && (\n              <div className=\"bg-gradient-to-r from-red-50 via-orange-50 to-red-50 rounded-2xl p-6 mb-8 border border-red-200 shadow-lg\">\n                <div className=\"flex items-center mb-6\">\n                  <div className=\"bg-gradient-to-r from-red-500 to-red-600 rounded-full p-3 mr-4 shadow-lg\">\n                    <span className=\"text-white text-2xl\"></span>\n                  </div>\n                  <div>\n                    <h3 className=\"text-2xl font-bold text-red-800 mb-1\">\n                      Anlisis de Ruta Crtica\n                    </h3>\n                    <p className=\"text-red-600 text-sm\">\n                      Esta tarea es crtica - cualquier retraso afecta la fecha de finalizacin del proyecto\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                  <div className=\"bg-white rounded-xl p-5 border border-red-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\n                    <div className=\"flex items-center mb-3\">\n                      <div className=\"bg-red-100 rounded-lg p-2 mr-3\">\n                        <span className=\"text-red-600 text-lg\"></span>\n                      </div>\n                      <div>\n                        <div className=\"text-sm font-medium text-red-600 mb-1\">Impacto de Retraso</div>\n                        <div className=\"text-xs text-gray-500\">Costo por da de retraso</div>\n                      </div>\n                    </div>\n                    <div className=\"text-2xl font-bold text-red-800\">\n                      ${selectedTask.criticalImpact?.delayCost?.toFixed(2) || '0.00'}\n                    </div>\n                    <div className=\"text-sm text-gray-600 mt-1\">por da</div>\n                  </div>\n\n                  <div className=\"bg-white rounded-xl p-5 border border-red-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\n                    <div className=\"flex items-center mb-3\">\n                      <div className=\"bg-red-100 rounded-lg p-2 mr-3\">\n                        <span className=\"text-red-600 text-lg\"></span>\n                      </div>\n                      <div>\n                        <div className=\"text-sm font-medium text-red-600 mb-1\">Impacto en Recursos</div>\n                        <div className=\"text-xs text-gray-500\">Nivel de impacto</div>\n                      </div>\n                    </div>\n                    <div className=\"text-2xl font-bold text-red-800\">\n                      {selectedTask.criticalImpact?.resourceImpact || 'Bajo'}\n                    </div>\n                    <div className={`text-sm px-2 py-1 rounded-full mt-2 inline-block ${selectedTask.criticalImpact?.resourceImpact === 'Alto'\n                      ? 'bg-red-100 text-red-700'\n                      : 'bg-green-100 text-green-700'\n                      }`}>\n                      {selectedTask.criticalImpact?.resourceImpact === 'Alto' ? ' Alto Riesgo' : ' Bajo Riesgo'}\n                    </div>\n                  </div>\n\n                  <div className=\"bg-white rounded-xl p-5 border border-red-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\n                    <div className=\"flex items-center mb-3\">\n                      <div className=\"bg-red-100 rounded-lg p-2 mr-3\">\n                        <span className=\"text-red-600 text-lg\"></span>\n                      </div>\n                      <div>\n                        <div className=\"text-sm font-medium text-red-600 mb-1\">Tareas Afectadas</div>\n                        <div className=\"text-xs text-gray-500\">Sucesoras directas</div>\n                      </div>\n                    </div>\n                    <div className=\"text-2xl font-bold text-red-800\">\n                      {selectedTask.criticalImpact?.successorImpact || 0}\n                    </div>\n                    <div className=\"text-sm text-gray-600 mt-1\">\n                      {selectedTask.criticalImpact?.successorImpact > 0 ? 'tareas dependientes' : 'sin dependientes'}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Alerta adicional */}\n                <div className=\"mt-6 bg-red-100 border border-red-300 rounded-xl p-4\">\n                  <div className=\"flex items-center\">\n                    <span className=\"text-red-600 text-xl mr-3\"></span>\n                    <div className=\"text-sm text-red-800\">\n                      <strong>Recomendacin:</strong> Monitorea esta tarea de cerca y considera tener un plan de contingencia para evitar retrasos.\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Panel de Anlisis de Sensibilidad */}\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6\">\n              <h3 className=\"text-lg font-semibold mb-3 text-blue-800 flex items-center\">\n                 Anlisis de Sensibilidad\n              </h3>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div className=\"bg-white rounded-lg p-3 border border-blue-200\">\n                  <div className=\"text-sm text-blue-600 mb-1\">Nivel de Sensibilidad</div>\n                  <div className=\"text-lg font-bold text-blue-800\">\n                    {selectedTask.sensitivity || 0}/10\n                  </div>\n                  <div className=\"text-xs text-blue-600\">Factor de riesgo</div>\n                </div>\n                <div className=\"bg-white rounded-lg p-3 border border-blue-200\">\n                  <div className=\"text-sm text-blue-600 mb-1\">Float de Seguridad</div>\n                  <div className=\"text-lg font-bold text-blue-800\">\n                    {selectedTask.safetyFloat || 0} das\n                  </div>\n                  <div className=\"text-xs text-blue-600\">Margen de seguridad</div>\n                </div>\n                <div className=\"bg-white rounded-lg p-3 border border-blue-200\">\n                  <div className=\"text-sm text-blue-600 mb-1\">Estado de Float</div>\n                  <div className={`text-lg font-bold ${selectedTask.totalFloat === 0 ? 'text-red-600' : selectedTask.totalFloat <= 2 ? 'text-yellow-600' : 'text-green-600'}`}>\n                    {selectedTask.totalFloat === 0 ? 'Crtico' : selectedTask.totalFloat <= 2 ? 'Alto Riesgo' : 'Seguro'}\n                  </div>\n                  <div className=\"text-xs text-blue-600\">Clasificacin de riesgo</div>\n                </div>\n              </div>\n            </div>\n\n            <h3 className=\"text-xl font-bold mb-4\"> Editar Tarea</h3>\n            <div className=\"grid grid-cols-2 gap-4 mb-4\">\n              <div>\n                <label htmlFor=\"name\" className=\"block text-sm font-medium text-gray-700 mb-1\">Nombre de la Tarea:</label>\n                <input\n                  type=\"text\"\n                  id=\"name\"\n                  value={tempTaskName}\n                  onChange={handleNameChange}\n                  onFocus={handleNameFocus}\n                  onBlur={handleNameBlur}\n                  className=\"w-full px-3 py-2 border rounded-lg\"\n                />\n              </div>\n              <div>\n                <label htmlFor=\"duration\" className=\"block text-sm font-medium text-gray-700 mb-1\">Duracin (das):</label>\n                <input\n                  type=\"number\"\n                  id=\"duration\"\n                  value={selectedTask?.duration || 0}\n                  onChange={(e) => updateTask(selectedTask?.id, 'duration', e.target.value)}\n                  className=\"w-full px-3 py-2 border rounded-lg\"\n                />\n              </div>\n              <div>\n                <label htmlFor=\"startDate\" className=\"block text-sm font-medium text-gray-700 mb-1\">Fecha de Inicio:</label>\n                <input\n                  type=\"date\"\n                  id=\"startDate\"\n                  value={selectedTask?.startDate || ''}\n                  onChange={(e) => updateTask(selectedTask?.id, 'startDate', e.target.value)}\n                  className=\"w-full px-3 py-2 border rounded-lg\"\n                />\n              </div>\n              <div>\n                <label htmlFor=\"endDate\" className=\"block text-sm font-medium text-gray-700 mb-1\">Fecha de Fin:</label>\n                <input\n                  type=\"date\"\n                  id=\"endDate\"\n                  value={selectedTask?.endDate || ''}\n                  onChange={(e) => updateTask(selectedTask?.id, 'endDate', e.target.value)}\n                  className=\"w-full px-3 py-2 border rounded-lg\"\n                />\n              </div>\n              <div>\n                <label htmlFor=\"progress\" className=\"block text-sm font-medium text-gray-700 mb-1\">Progreso (%):</label>\n                <input\n                  type=\"number\"\n                  id=\"progress\"\n                  value={selectedTask?.progress || 0}\n                  onChange={(e) => updateTask(selectedTask?.id, 'progress', e.target.value)}\n                  className=\"w-full px-3 py-2 border rounded-lg\"\n                />\n              </div>\n              <div>\n                <label htmlFor=\"cost\" className=\"block text-sm font-medium text-gray-700 mb-1\">Costo:</label>\n                <input\n                  type=\"number\"\n                  id=\"cost\"\n                  value={selectedTask?.cost || 0}\n                  onChange={(e) => updateTask(selectedTask?.id, 'cost', e.target.value)}\n                  className=\"w-full px-3 py-2 border rounded-lg\"\n                />\n              </div>\n              <div>\n                <label htmlFor=\"resources\" className=\"block text-sm font-medium text-gray-700 mb-1\">Recursos:</label>\n                <input\n                  type=\"text\"\n                  id=\"resources\"\n                  value={selectedTask?.resources?.join(', ') || ''}\n                  onChange={(e) => updateTask(selectedTask?.id, 'resources', e.target.value.split(',').map(r => r.trim()))}\n                  className=\"w-full px-3 py-2 border rounded-lg\"\n                />\n              </div>\n              <div>\n                <label htmlFor=\"status\" className=\"block text-sm font-medium text-gray-700 mb-1\">Estado:</label>\n                <select\n                  id=\"status\"\n                  value={selectedTask?.status || 'pending'}\n                  onChange={(e) => updateTask(selectedTask?.id, 'status', e.target.value)}\n                  className=\"w-full px-3 py-2 border rounded-lg\"\n                >\n                  <option value=\"pending\">Pendiente</option>\n                  <option value=\"in-progress\">En Progreso</option>\n                  <option value=\"completed\">Completado</option>\n                  <option value=\"delayed\">Retrasado</option>\n                </select>\n              </div>\n              <div>\n                <label htmlFor=\"isMilestone\" className=\"block text-sm font-medium text-gray-700 mb-1\">Milestone:</label>\n                <input\n                  type=\"checkbox\"\n                  id=\"isMilestone\"\n                  checked={selectedTask.isMilestone}\n                  onChange={(e) => updateTask(selectedTask.id, 'isMilestone', e.target.checked)}\n                  className=\"w-4 h-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n                />\n              </div>\n            </div>\n            <h3 className=\"text-xl font-bold mb-4\"> Gestin de Dependencias</h3>\n\n            {/* Predecesoras */}\n            <div className=\"mb-6\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <label className=\"block text-lg font-medium text-gray-700\">Predecesoras (Tareas que deben completarse antes)</label>\n                <span className=\"text-sm text-gray-500 bg-blue-50 px-2 py-1 rounded\">\n                  {selectedTask.predecessors.length} tarea(s)\n                </span>\n              </div>\n\n              {/* Lista de predecesoras actuales */}\n              <div className=\"mb-3\">\n                {selectedTask.predecessors.length > 0 ? (\n                  <div className=\"space-y-2\">\n                    {selectedTask.predecessors.map(predId => {\n                      const predTask = tasksWithCPM.find(t => t.id === predId);\n                      return predTask ? (\n                        <div key={predId} className=\"flex items-center justify-between bg-blue-50 p-3 rounded-lg border border-blue-200\">\n                          <div className=\"flex items-center space-x-3\">\n                            <span className=\"text-blue-600\"></span>\n                            <div>\n                              <div className=\"font-medium text-sm\">{predTask.name}</div>\n                              <div className=\"text-xs text-gray-600\">WBS: {predTask.wbsCode} | Duracin: {predTask.duration}d</div>\n                            </div>\n                          </div>\n                          <button\n                            onClick={() => {\n                              const newPreds = selectedTask.predecessors.filter(id => id !== predId);\n                              updatePredecessors(selectedTask.id, newPreds.join(','));\n                            }}\n                            className=\"text-red-600 hover:text-red-800 text-sm px-2 py-1 rounded hover:bg-red-50\"\n                            title=\"Eliminar dependencia\"\n                          >\n                            \n                          </button>\n                        </div>\n                      ) : (\n                        <div key={predId} className=\"bg-red-50 p-3 rounded-lg border border-red-200 text-red-600 text-sm\">\n                           Tarea no encontrada: {predId}\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-4 text-gray-500 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n                    <span className=\"text-lg\"></span>\n                    <div className=\"mt-2\">No hay predecesoras definidas</div>\n                    <div className=\"text-sm\">Esta tarea puede comenzar inmediatamente</div>\n                  </div>\n                )}\n              </div>\n\n              {/* Agregar nueva predecesora */}\n              <div className=\"space-y-3\">\n                <div className=\"flex space-x-2\">\n                  <select\n                    ref={predecessorSelectRef}\n                    id=\"newPredecessor\"\n                    defaultValue=\"\"\n                    className=\"flex-1 px-3 py-2 border rounded-lg text-sm\"\n                  >\n                    <option value=\"\">Seleccionar tarea predecesora...</option>\n                    {tasksWithCPM\n                      .filter(t => t.id !== selectedTask.id && !selectedTask.predecessors.includes(t.id))\n                      .map(task => (\n                        <option key={task.id} value={task.id}>\n                          {task.wbsCode} - {task.name} ({task.duration}d)\n                        </option>\n                      ))}\n                  </select>\n\n                  <select\n                    id=\"newDependencyType\"\n                    defaultValue=\"FS\"\n                    className=\"px-3 py-2 border rounded-lg text-sm bg-gray-50\"\n                    title=\"Tipo de dependencia\"\n                  >\n                    {Object.entries(DEPENDENCY_TYPES).map(([key, type]) => (\n                      <option key={key} value={key} title={type.description}>\n                        {type.name}\n                      </option>\n                    ))}\n                  </select>\n\n                  <button\n                    onClick={() => {\n                      console.log(' BOTN AGREGAR PREDECESORA - onClick disparado');\n                      const select = document.getElementById('newPredecessor');\n                      const dependencyTypeSelect = document.getElementById('newDependencyType');\n                      console.log(' BOTN AGREGAR PREDECESORA - select.value:', select?.value);\n                      console.log(' BOTN AGREGAR PREDECESORA - selectedTask:', selectedTask);\n\n                      if (select && select.value) {\n                        const taskId = select.value;\n                        console.log(' BOTN AGREGAR PREDECESORA - taskId seleccionado:', taskId);\n                        console.log(' BOTN AGREGAR PREDECESORA - selectedTask.predecessors:', selectedTask.predecessors);\n                        console.log(' BOTN AGREGAR PREDECESORA - Ya existe?', selectedTask.predecessors.includes(taskId));\n\n                        if (!selectedTask.predecessors.includes(taskId)) {\n                          // Validar dependencia circular\n                          if (hasCircularDependency(selectedTask.id, taskId)) {\n                            alert(` No se puede crear la dependencia: se detectara una dependencia circular entre ${selectedTask.id} y ${taskId}`);\n                            return;\n                          }\n\n                          const newPreds = [...(selectedTask.predecessors || []), taskId];\n                          const dependencyType = dependencyTypeSelect ? dependencyTypeSelect.value : 'FS';\n\n                          console.log(' Agregando predecesora desde botn:', {\n                            tarea: selectedTask.id,\n                            nuevaPredecesora: taskId,\n                            predecesorasAntes: selectedTask.predecessors,\n                            predecesorasDespues: newPreds,\n                            dependencyType\n                          });\n\n                          updatePredecessors(selectedTask.id, newPreds.join(','), dependencyType);\n                          select.value = '';\n                        } else {\n                          console.log(' BOTN AGREGAR PREDECESORA - La predecesora ya existe');\n                        }\n                      } else {\n                        console.log(' BOTN AGREGAR PREDECESORA - No hay tarea seleccionada');\n                      }\n                    }}\n                    className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm\"\n                  >\n                    Agregar\n                  </button>\n                </div>\n\n                {/* Informacin del tipo de dependencia seleccionado */}\n                <div className=\"text-xs text-gray-600 bg-gray-50 p-2 rounded\">\n                  <strong>Tipo de dependencia:</strong>\n                  <span id=\"dependencyTypeInfo\">\n                    {DEPENDENCY_TYPES.FS.description}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* Sucesoras */}\n            <div className=\"mb-6\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <label className=\"block text-lg font-medium text-gray-700\">Sucesoras (Tareas que dependen de esta)</label>\n                <span className=\"text-sm text-gray-500 bg-green-50 px-2 py-1 rounded\">\n                  {selectedTask.successors.length} tarea(s)\n                </span>\n              </div>\n\n              {/* Lista de sucesoras actuales */}\n              <div className=\"mb-3\">\n                {selectedTask.successors.length > 0 ? (\n                  <div className=\"space-y-2\">\n                    {selectedTask.successors.map(succId => {\n                      const succTask = tasksWithCPM.find(t => t.id === succId);\n                      return succTask ? (\n                        <div key={succId} className=\"flex items-center justify-between bg-green-50 p-3 rounded-lg border border-green-200\">\n                          <div className=\"flex items-center space-x-3\">\n                            <span className=\"text-green-600\"></span>\n                            <div>\n                              <div className=\"font-medium text-sm\">{succTask.name}</div>\n                              <div className=\"text-xs text-gray-600\">WBS: {succTask.wbsCode} | Duracin: {succTask.duration}d</div>\n                            </div>\n                          </div>\n                          <button\n                            onClick={() => {\n                              const newSuccs = selectedTask.successors.filter(id => id !== succId);\n                              // Actualizar la tarea sucesora para remover esta tarea de sus predecesoras\n                              const updatedSucc = {\n                                id: succTask.id,\n                                wbsCode: succTask.wbsCode,\n                                name: succTask.name,\n                                duration: succTask.duration,\n                                startDate: succTask.startDate,\n                                endDate: succTask.endDate,\n                                progress: succTask.progress,\n                                predecessors: succTask.predecessors.filter(id => id !== selectedTask.id),\n                                cost: succTask.cost,\n                                priority: succTask.priority,\n                                assignedTo: succTask.assignedTo,\n                                isMilestone: succTask.isMilestone,\n                                isCritical: succTask.isCritical,\n                                originalDuration: succTask.originalDuration,\n                                earlyStart: succTask.earlyStart,\n                                earlyFinish: succTask.earlyFinish,\n                                lateStart: succTask.lateStart,\n                                lateFinish: succTask.lateFinish,\n                                totalFloat: succTask.totalFloat,\n                                freeFloat: succTask.freeFloat,\n                                description: succTask.description,\n                                resources: [...(succTask.resources || [])],\n                                workPackageId: succTask.workPackageId,\n                                status: succTask.status,\n                                successors: [...(succTask.successors || [])]\n                              };\n                              setTasks(prev => prev.map(t => t.id === succId ? updatedSucc : t));\n                              // Actualizar esta tarea\n                              setSelectedTask(prev => ({\n                                id: prev.id,\n                                wbsCode: prev.wbsCode,\n                                name: prev.name,\n                                duration: prev.duration,\n                                startDate: prev.startDate,\n                                endDate: prev.endDate,\n                                progress: prev.progress,\n                                predecessors: [...(prev.predecessors || [])],\n                                cost: prev.cost,\n                                priority: prev.priority,\n                                assignedTo: prev.assignedTo,\n                                isMilestone: prev.isMilestone,\n                                isCritical: prev.isCritical,\n                                originalDuration: prev.originalDuration,\n                                earlyStart: prev.earlyStart,\n                                earlyFinish: prev.earlyFinish,\n                                lateStart: prev.lateStart,\n                                lateFinish: prev.lateFinish,\n                                totalFloat: prev.totalFloat,\n                                freeFloat: prev.freeFloat,\n                                description: prev.description,\n                                resources: [...(prev.resources || [])],\n                                workPackageId: prev.workPackageId,\n                                status: prev.status,\n                                successors: newSuccs\n                              }));\n                            }}\n                            className=\"text-red-600 hover:text-red-800 text-sm px-2 py-1 rounded hover:bg-red-50\"\n                            title=\"Eliminar dependencia\"\n                          >\n                            \n                          </button>\n                        </div>\n                      ) : (\n                        <div key={succId} className=\"bg-red-50 p-3 rounded-lg border border-red-200 text-red-600 text-sm\">\n                           Tarea no encontrada: {succId}\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-4 text-gray-500 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n                    <span className=\"text-lg\"></span>\n                    <div className=\"mt-2\">No hay sucesoras definidas</div>\n                    <div className=\"text-sm\">Esta tarea no bloquea ninguna otra tarea</div>\n                  </div>\n                )}\n              </div>\n\n              {/* Agregar nueva sucesora */}\n              <div className=\"flex space-x-2\">\n                {console.log(' RENDERIZANDO SECCIN SUCESORAS - selectedTask:', selectedTask?.id)}\n                {console.log(' RENDERIZANDO SECCIN SUCESORAS - selectedTask.successors:', selectedTask?.successors)}\n                {console.log(' RENDERIZANDO SECCIN SUCESORAS - selectedTask.successors.length:', selectedTask?.successors?.length)}\n                {console.log(' RENDERIZANDO SECCIN SUCESORAS - selectedTask.successors.length:', selectedTask?.successors?.length)}\n                {console.log(' RENDERIZANDO SECCIN SUCESORAS - selectedTask.successors.length:', selectedTask?.successors?.length)}\n                {console.log(' RENDERIZANDO SECCIN SUCESORAS - selectedTask.successors.length:', selectedTask?.successors?.length)}\n                {console.log(' RENDERIZANDO SECCIN SUCESORAS - selectedTask.successors.length:', selectedTask?.successors?.length)}\n                <select\n                  ref={successorSelectRef}\n                  id=\"newSuccessor\"\n                  defaultValue=\"\"\n                  className=\"flex-1 px-3 py-2 border rounded-lg text-sm\"\n                >\n                  <option value=\"\">Seleccionar tarea sucesora...</option>\n                  {tasksWithCPM\n                    .filter(t => t.id !== selectedTask.id && !selectedTask.successors.includes(t.id))\n                    .map(task => (\n                      <option key={task.id} value={task.id}>\n                        {task.wbsCode} - {task.name} ({task.duration}d)\n                      </option>\n                    ))}\n                </select>\n                {console.log(' RENDERIZANDO BOTN AGREGAR SUCESORA - selectedTask:', selectedTask?.id)}\n                {console.log(' RENDERIZANDO BOTN AGREGAR SUCESORA - selectedTask.successors:', selectedTask?.successors)}\n                {console.log(' RENDERIZANDO BOTN AGREGAR SUCESORA - selectedTask.successors.length:', selectedTask?.successors?.length)}\n                {console.log(' RENDERIZANDO BOTN AGREGAR SUCESORA - selectedTask.successors.length:', selectedTask?.successors?.length)}\n                {console.log(' RENDERIZANDO BOTN AGREGAR SUCESORA - selectedTask.successors.length:', selectedTask?.successors?.length)}\n                {console.log(' RENDERIZANDO BOTN AGREGAR SUCESORA - selectedTask.successors.length:', selectedTask?.successors?.length)}\n                {console.log(' RENDERIZANDO BOTN AGREGAR SUCESORA - selectedTask.successors.length:', selectedTask?.successors?.length)}\n                <button\n                  onClick={() => {\n                    console.log(' BOTN AGREGAR SUCESORA - onClick ejecutado');\n                    console.log(' BOTN AGREGAR SUCESORA - selectedTask:', selectedTask?.id);\n                    const select = document.getElementById('newSuccessor');\n                    console.log(' BOTN AGREGAR SUCESORA - select encontrado:', !!select);\n                    console.log(' BOTN AGREGAR SUCESORA - select.value:', select?.value);\n                    if (select && select.value.trim()) {\n                      const newSuccs = selectedTask.successors.slice().concat([select.value.trim()]);\n                      console.log(' Agregando sucesora desde select:', {\n                        tarea: selectedTask.id,\n                        nuevaSucesora: select.value.trim(),\n                        sucesorasAntes: selectedTask.successors,\n                        sucesorasDespues: newSuccs\n                      });\n\n                      // Actualizar el estado local\n                      const updatedTask = {\n                        id: selectedTask.id,\n                        wbsCode: selectedTask.wbsCode,\n                        name: selectedTask.name,\n                        duration: selectedTask.duration,\n                        startDate: selectedTask.startDate,\n                        endDate: selectedTask.endDate,\n                        progress: selectedTask.progress,\n                        predecessors: [...(selectedTask.predecessors || [])],\n                        cost: selectedTask.cost,\n                        priority: selectedTask.priority,\n                        assignedTo: selectedTask.assignedTo,\n                        isMilestone: selectedTask.isMilestone,\n                        isCritical: selectedTask.isCritical,\n                        originalDuration: selectedTask.originalDuration,\n                        earlyStart: selectedTask.earlyStart,\n                        earlyFinish: selectedTask.earlyFinish,\n                        lateStart: selectedTask.lateStart,\n                        lateFinish: selectedTask.lateFinish,\n                        totalFloat: selectedTask.totalFloat,\n                        freeFloat: selectedTask.freeFloat,\n                        description: selectedTask.description,\n                        resources: [...(selectedTask.resources || [])],\n                        workPackageId: selectedTask.workPackageId,\n                        status: selectedTask.status,\n                        successors: newSuccs\n                      };\n                      // ACTUALIZAR SOLO EL ESTADO GLOBAL - NO setSelectedTask para evitar duplicacin\n                      setTasks(prev => {\n                        const updated = prev.map(t => {\n                          if (t.id === selectedTask.id) {\n                            return updatedTask;\n                          }\n                          if (t.id === select.value.trim()) {\n                            // Agregar esta tarea como predecesora de la sucesora\n                            return {\n                              id: t.id,\n                              wbsCode: t.wbsCode,\n                              name: t.name,\n                              duration: t.duration,\n                              startDate: t.startDate,\n                              endDate: t.endDate,\n                              progress: t.progress,\n                              predecessors: [...(t.predecessors || []), selectedTask.id],\n                              cost: t.cost,\n                              priority: t.priority,\n                              assignedTo: t.assignedTo,\n                              isMilestone: t.isMilestone,\n                              isCritical: t.isCritical,\n                              originalDuration: t.originalDuration,\n                              earlyStart: t.earlyStart,\n                              earlyFinish: t.earlyFinish,\n                              lateStart: t.lateStart,\n                              lateFinish: t.lateFinish,\n                              totalFloat: t.totalFloat,\n                              freeFloat: t.freeFloat,\n                              description: t.description,\n                              resources: [...(t.resources || [])],\n                              workPackageId: t.workPackageId,\n                              status: t.status,\n                              successors: [...(t.successors || [])]\n                            };\n                          }\n                          return t;\n                        });\n\n                        // Actualizar selectedTask con la tarea actualizada del estado global\n                        const updatedSelectedTask = updated.find(t => t.id === selectedTask.id);\n                        if (updatedSelectedTask) {\n                          setSelectedTask(updatedSelectedTask);\n                        }\n\n                        return updated;\n                      });\n\n                      select.value = '';\n                    } else {\n                      console.log(' BOTN AGREGAR SUCESORA - Condicin no cumplida:', {\n                        select: !!select,\n                        value: select?.value,\n                        trimmed: select?.value?.trim()\n                      });\n                    }\n                  }}\n                  className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm\"\n                >\n                  Agregar\n                </button>\n              </div>\n\n              {/* Input manual para ID de tarea */}\n              <div className=\"mt-2\">\n                <input\n                  id=\"manualSuccessor\"\n                  type=\"text\"\n                  placeholder=\"O escribir ID de tarea manualmente...\"\n                  className=\"w-full px-3 py-2 border rounded-lg text-sm\"\n                  onKeyPress={(e) => {\n                    if (e.key === 'Enter') {\n                      if (e.target.value.trim()) {\n                        const newSuccs = selectedTask.successors.slice().concat([e.target.value.trim()]);\n                        console.log(' Agregando sucesora con Enter:', {\n                          tarea: selectedTask.id,\n                          nuevaSucesora: e.target.value.trim(),\n                          sucesorasAntes: selectedTask.successors,\n                          sucesorasDespues: newSuccs\n                        });\n\n                        // Actualizar el estado local\n                        const updatedTask = {\n                          id: selectedTask.id,\n                          wbsCode: selectedTask.wbsCode,\n                          name: selectedTask.name,\n                          duration: selectedTask.duration,\n                          startDate: selectedTask.startDate,\n                          endDate: selectedTask.endDate,\n                          progress: selectedTask.progress,\n                          predecessors: [...(selectedTask.predecessors || [])],\n                          cost: selectedTask.cost,\n                          priority: selectedTask.priority,\n                          assignedTo: selectedTask.assignedTo,\n                          isMilestone: selectedTask.isMilestone,\n                          isCritical: selectedTask.isCritical,\n                          originalDuration: selectedTask.originalDuration,\n                          earlyStart: selectedTask.earlyStart,\n                          earlyFinish: selectedTask.earlyFinish,\n                          lateStart: selectedTask.lateStart,\n                          lateFinish: selectedTask.lateFinish,\n                          totalFloat: selectedTask.totalFloat,\n                          freeFloat: selectedTask.freeFloat,\n                          description: selectedTask.description,\n                          resources: [...(selectedTask.resources || [])],\n                          workPackageId: selectedTask.workPackageId,\n                          status: selectedTask.status,\n                          successors: newSuccs\n                        };\n                        // ACTUALIZAR SOLO EL ESTADO GLOBAL - NO setSelectedTask para evitar duplicacin\n                        setTasks(prev => {\n                          const updated = prev.map(t => {\n                            if (t.id === selectedTask.id) {\n                              return updatedTask;\n                            }\n                            if (t.id === e.target.value.trim()) {\n                              // Agregar esta tarea como predecesora de la sucesora\n                              return {\n                                id: t.id,\n                                wbsCode: t.wbsCode,\n                                name: t.name,\n                                duration: t.duration,\n                                startDate: t.startDate,\n                                endDate: t.endDate,\n                                progress: t.progress,\n                                predecessors: [...(t.predecessors || []), selectedTask.id],\n                                cost: t.cost,\n                                priority: t.priority,\n                                assignedTo: t.assignedTo,\n                                isMilestone: t.isMilestone,\n                                isCritical: t.isCritical,\n                                originalDuration: t.originalDuration,\n                                earlyStart: t.earlyStart,\n                                earlyFinish: t.earlyFinish,\n                                lateStart: t.lateStart,\n                                lateFinish: t.lateFinish,\n                                totalFloat: t.totalFloat,\n                                freeFloat: t.freeFloat,\n                                description: t.description,\n                                resources: [...(t.resources || [])],\n                                workPackageId: t.workPackageId,\n                                status: t.status,\n                                successors: [...(t.successors || [])]\n                              };\n                            }\n                            return t;\n                          });\n\n                          // Actualizar selectedTask con la tarea actualizada del estado global\n                          const updatedSelectedTask = updated.find(t => t.id === selectedTask.id);\n                          if (updatedSelectedTask) {\n                            setSelectedTask(updatedSelectedTask);\n                          }\n\n                          return updated;\n                        });\n\n                        e.target.value = '';\n                      }\n                    }\n                  }}\n                />\n              </div>\n            </div>\n            <h3 className=\"text-xl font-bold mb-4\">Recursos Asignados</h3>\n            <div className=\"mb-4\">\n              <label htmlFor=\"assignedResources\" className=\"block text-sm font-medium text-gray-700 mb-1\">Recursos (separados por coma):</label>\n              <input\n                type=\"text\"\n                id=\"assignedResources\"\n                value={resourceAnalysis.resourceLoad[selectedTask.id]?.map(r => r.taskName).join(', ')}\n                onChange={(e) => {\n                  const resources = e.target.value.split(',').map(r => r.trim());\n                  const currentAssignments = resourceAnalysis.resourceLoad[selectedTask.id] || [];\n                  const newAssignments = resources.map(r => {\n                    const existing = currentAssignments.find(a => a.taskName === r);\n                    if (existing) {\n                      return {\n                        taskName: existing.taskName,\n                        taskId: existing.taskId,\n                        startDate: existing.startDate,\n                        endDate: existing.endDate,\n                        allocation: 100\n                      }; // Reset allocation if resource already exists\n                    } else {\n                      return { taskName: r, taskId: selectedTask.id, startDate: selectedTask.startDate, endDate: selectedTask.endDate, allocation: 100 };\n                    }\n                  });\n                  // Update resourceLoad state\n                  setTasks(prev => {\n                    const updatedTasks = prev.map(t => {\n                      if (t.id === selectedTask.id) {\n                        return {\n                          id: t.id,\n                          wbsCode: t.wbsCode,\n                          name: t.name,\n                          duration: t.duration,\n                          startDate: t.startDate,\n                          endDate: t.endDate,\n                          progress: t.progress,\n                          predecessors: [...(t.predecessors || [])],\n                          cost: t.cost,\n                          priority: t.priority,\n                          assignedTo: t.assignedTo,\n                          isMilestone: t.isMilestone,\n                          isCritical: t.isCritical,\n                          originalDuration: t.originalDuration,\n                          earlyStart: t.earlyStart,\n                          earlyFinish: t.earlyFinish,\n                          lateStart: t.lateStart,\n                          lateFinish: t.lateFinish,\n                          totalFloat: t.totalFloat,\n                          freeFloat: t.freeFloat,\n                          description: t.description,\n                          resources: newAssignments.map(a => a.taskName),\n                          workPackageId: t.workPackageId,\n                          status: t.status,\n                          successors: [...(t.successors || [])]\n                        };\n                      }\n                      return t;\n                    });\n                    return updatedTasks;\n                  });\n                }}\n                className=\"w-full px-3 py-2 border rounded-lg\"\n              />\n            </div>\n            <h3 className=\"text-xl font-bold mb-4\">Conflictos de Recursos</h3>\n            <div className=\"mb-4\">\n              <p className=\"text-sm text-gray-600\">\n                Los conflictos de recursos se muestran en la vista de lista de tareas.\n                Para ver los conflictos de recursos en el diagrama de red,\n                necesitaras implementar un algoritmo de deteccin de conflictos\n                en el diagrama de red mismo, lo cual es ms complejo.\n              </p>\n            </div>\n            <div className=\"flex justify-end space-x-2\">\n              <button\n                onClick={() => {\n                  console.log(' BOTN CANCELAR - Cerrando modal');\n                  console.log(' BOTN CANCELAR - selectedTask ANTES:', selectedTask);\n                  console.log(' BOTN CANCELAR - tasks.length ANTES:', tasks.length);\n                  setSelectedTask(null);\n                  console.log(' BOTN CANCELAR - selectedTask establecido a null');\n                }}\n                className=\"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400\"\n              >\n                Cancelar\n              </button>\n              <button\n                onClick={() => {\n                  console.log(' BOTN GUARDAR CAMBIOS - INICIANDO GUARDADO');\n                  console.log(' BOTN GUARDAR CAMBIOS - selectedTask:', selectedTask);\n                  console.log(' BOTN GUARDAR CAMBIOS - predecesoras ANTES:', selectedTask.predecessors);\n                  console.log(' BOTN GUARDAR CAMBIOS - sucesoras ANTES:', selectedTask.successors);\n\n                  // SOLUCIN: Usar selectedTask directamente (ya tiene los datos actualizados)\n                  console.log(' BOTN GUARDAR CAMBIOS - Usando selectedTask directamente:', {\n                    id: selectedTask.id,\n                    predecessors: selectedTask.predecessors,\n                    successors: selectedTask.successors\n                  });\n\n                  // Actualizar el estado global con currentTask y sincronizar dependencias bidireccionales\n                  setTasks(prev => {\n                    console.log(' BOTN GUARDAR CAMBIOS - tasks ANTES:', prev.map(t => ({\n                      id: t.id,\n                      name: t.name,\n                      predecessors: t.predecessors,\n                      successors: t.successors\n                    })));\n\n                    // SOLUCIN RADICAL: Solo actualizar la tarea actual, NO sincronizacin bidireccional\n                    const updatedTasks = prev.map(t => {\n                      if (t.id === selectedTask.id) {\n                        console.log(' BOTN GUARDAR CAMBIOS - Actualizando tarea:', t.id, 'con:', {\n                          predecessors: selectedTask.predecessors,\n                          successors: selectedTask.successors\n                        });\n                        return selectedTask;\n                      }\n\n                      // NO hacer sincronizacin bidireccional por ahora\n                      return t;\n                    });\n\n                    console.log(' BOTN GUARDAR CAMBIOS - tasks DESPUS:', updatedTasks.map(t => ({\n                      id: t.id,\n                      name: t.name,\n                      predecessors: t.predecessors,\n                      successors: t.successors\n                    })));\n\n                    return updatedTasks;\n                  });\n\n                  console.log(' BOTN GUARDAR CAMBIOS - predecesoras guardadas:', selectedTask.predecessors);\n                  console.log(' BOTN GUARDAR CAMBIOS - sucesoras guardadas:', selectedTask.successors);\n\n                  setSelectedTask(null);\n                }}\n                className=\"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700\"\n              >\n                Guardar Cambios\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Vista de Caso de Negocio */}\n      {showBusinessCase && (\n        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\n          <h2 className=\"text-2xl font-bold mb-4\">Caso de Negocio</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <h3 className=\"text-xl font-semibold mb-2\">Informacin del Proyecto</h3>\n              <p><strong>Nombre:</strong> {businessCase.projectName}</p>\n              <p><strong>Fecha de Inicio:</strong> {new Date(businessCase.startDate).toLocaleDateString('es')}</p>\n              <p><strong>Fecha de Fin Planificada:</strong> {new Date(businessCase.plannedEndDate).toLocaleDateString('es')}</p>\n              <p><strong>Inversin Total:</strong> ${businessCase.totalInvestment.toLocaleString()}</p>\n            </div>\n            <div>\n              <h3 className=\"text-xl font-semibold mb-2\">Beneficios Esperados</h3>\n              <p><strong>Objetivo:</strong> {businessCase.objective}</p>\n              <p><strong>Patrocinador:</strong> {businessCase.sponsor}</p>\n              <p><strong>Gerente del Proyecto:</strong> {businessCase.manager}</p>\n              <p><strong>Beneficios:</strong> {businessCase.expectedBenefits}</p>\n              <p><strong>TIR (%):</strong> {businessCase.irr}</p>\n              <p><strong>ROI (%):</strong> {businessCase.roi}</p>\n              <p><strong>Tiempo de Retorno (aos):</strong> {businessCase.paybackPeriod}</p>\n              <p><strong>VPN:</strong> ${businessCase.npv.toLocaleString()}</p>\n            </div>\n          </div>\n          <div className=\"flex justify-end mt-4\">\n            <button\n              onClick={() => setShowBusinessCase(false)}\n              className=\"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400\"\n            >\n              Cerrar\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Vista de Anlisis de Recursos */}\n      {showResourceAnalysis && (\n        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\n          <h2 className=\"text-2xl font-bold mb-4\">Anlisis de Recursos</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n            <div>\n              <h3 className=\"text-xl font-semibold mb-2\">Carga de Recursos</h3>\n              {Object.entries(resourceAnalysis.resourceLoad).map(([resource, assignments]) => (\n                <div key={resource}>\n                  <p><strong>{resource}:</strong> {assignments.length} tareas</p>\n                  <ul>\n                    {assignments.map(a => (\n                      <li key={a.taskId}>{a.taskName} (Das: {diffDaysExclusive(a.startDate, addDays(a.endDate, 1, includeWeekends), includeWeekends)})</li>\n                    ))}\n                  </ul>\n                </div>\n              ))}\n            </div>\n            <div>\n              <h3 className=\"text-xl font-semibold mb-2\">Conflictos de Recursos</h3>\n              {resourceAnalysis.conflicts.map(conflict => (\n                <p key={conflict.resource} className=\"text-red-600 text-sm\">\n                  Conflicto entre {conflict.task1} y {conflict.task2} por el recurso \"{conflict.resource}\" por {conflict.overlapDays} das.\n                </p>\n              ))}\n            </div>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <h3 className=\"text-xl font-semibold mb-2\">Utilizacin de Recursos</h3>\n              {Object.entries(resourceAnalysis.utilization).map(([resource, days]) => (\n                <p key={resource}><strong>{resource}:</strong> {days} das</p>\n              ))}\n            </div>\n            <div>\n              <h3 className=\"text-xl font-semibold mb-2\">Mtricas de Recursos</h3>\n              <p><strong>Total de Recursos:</strong> {Object.keys(resourceAnalysis.utilization).length}</p>\n              <p><strong>Total de Das Asignados:</strong> {Object.values(resourceAnalysis.utilization).reduce((sum, d) => sum + d, 0)} das</p>\n            </div>\n          </div>\n          <div className=\"flex justify-end mt-4\">\n            <button\n              onClick={() => setShowResourceAnalysis(false)}\n              className=\"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400\"\n            >\n              Cerrar\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Vista de Baseline - ELIMINADA (duplicada) */}\n      {false && showBaseline && (\n        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\n          <h2 className=\"text-2xl font-bold mb-4\">Baseline</h2>\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full bg-gray-100 border border-gray-200\">\n              <thead>\n                <tr className=\"bg-gray-200 text-gray-700 uppercase text-sm leading-normal\">\n                  <th className=\"py-3 px-6 text-left\">Tarea</th>\n                  <th className=\"py-3 px-6 text-left\">Duracin</th>\n                  <th className=\"py-3 px-6 text-left\">Inicio</th>\n                  <th className=\"py-3 px-6 text-left\">Fin</th>\n                  <th className=\"py-3 px-6 text-left\">Progreso</th>\n                  <th className=\"py-3 px-6 text-left\">Recursos</th>\n                  <th className=\"py-3 px-6 text-left\">Costo</th>\n                  <th className=\"py-3 px-6 text-left\">Estado</th>\n                  <th className=\"py-3 px-6 text-left\">Acciones</th>\n                </tr>\n              </thead>\n              <tbody className=\"text-gray-600 text-sm font-light\">\n                {baselineTasks.map((task) => (\n                  <tr key={task.id} className=\"border-b border-gray-200 hover:bg-gray-100\">\n                    <td className=\"py-3 px-6 text-left whitespace-nowrap\">\n                      <div className=\"flex items-center\">\n                        <span className=\"font-medium\">{task.name}</span>\n                        {task.isMilestone && <span className=\"ml-2 text-indigo-600 text-xs\"></span>}\n                      </div>\n                      <small className=\"text-gray-400\">WBS: {task.wbsCode}</small>\n                    </td>\n                    <td className=\"py-3 px-6 text-left\">\n                      {task.duration} {ganttScale === 'days' ? 'das' : ganttScale === 'weeks' ? 'semanas' : 'meses'}\n                    </td>\n                    <td className=\"py-3 px-6 text-left\">\n                      {(() => {\n                        // Usar formato consistente para evitar problemas de zona horaria\n                        if (!task.startDate || task.startDate === null || task.startDate === undefined) return '';\n                        const [year, month, day] = task.startDate.split('-');\n                        return new Date(year, month - 1, day).toLocaleDateString('es');\n                      })()}\n                    </td>\n                    <td className=\"py-3 px-6 text-left\">\n                      {(() => {\n                        // Para hitos, usar la fecha de inicio como fecha de fin\n                        if (task.isMilestone) {\n                          // Usar formato consistente para evitar problemas de zona horaria\n                          if (!task.startDate || task.startDate === null || task.startDate === undefined) return '';\n                          const [year, month, day] = task.startDate.split('-');\n                          return new Date(year, month - 1, day).toLocaleDateString('es');\n                        }\n\n                        // Para tareas normales, usar la fecha de fin con formato consistente\n                        if (!task.endDate || task.endDate === null || task.endDate === undefined) return '';\n                        const [year, month, day] = task.endDate.split('-');\n                        return new Date(year, month - 1, day).toLocaleDateString('es');\n                      })()}\n                    </td>\n                    <td className=\"py-3 px-6 text-left\">\n                      <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                        <div\n                          className=\"bg-indigo-600 h-2 rounded-full\"\n                          style={{ width: `${task.progress}%` }}\n                        ></div>\n                      </div>\n                      <span className=\"text-xs text-gray-500\">{task.progress}%</span>\n                    </td>\n                    <td className=\"py-3 px-6 text-left\">\n                      {task.resources.map((r, index) => (\n                        <span key={index} className=\"inline-block bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded-full mr-1\">\n                          {r}\n                        </span>\n                      ))}\n                    </td>\n                    <td className=\"py-3 px-6 text-left\">\n                      ${task.cost.toLocaleString()}\n                    </td>\n                    <td className=\"py-3 px-6 text-left\">\n                      <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getStatusColor(task.status)}`}>\n                        {getStatusIcon(task.status)} {task.status}\n                      </span>\n                    </td>\n                    <td className=\"py-3 px-6 text-left\">\n                      <button\n                        onClick={() => {\n                          console.log(' ABRIENDO TAREA PARA EDITAR:', {\n                            id: task.id,\n                            name: task.name,\n                            predecessors: task.predecessors,\n                            successors: task.successors\n                          });\n                          setSelectedTask(task);\n                        }}\n                        className=\"text-indigo-600 hover:text-indigo-900 mr-3\"\n                        title=\"Ver detalles\"\n                      >\n                        \n                      </button>\n                      <button\n                        onClick={() => updateTask(task.id, 'progress', task.progress + 10)}\n                        disabled={isReadOnlyMode}\n                        className={isReadOnlyMode ? \"text-gray-400 cursor-not-allowed mr-3\" : \"text-green-600 hover:text-green-900 mr-3\"}\n                        title={isReadOnlyMode ? \"No disponible (modo solo lectura)\" : \"Incrementar progreso\"}\n                      >\n                        \n                      </button>\n                      <button\n                        onClick={() => updateTask(task.id, 'progress', task.progress - 10)}\n                        disabled={isReadOnlyMode}\n                        className={isReadOnlyMode ? \"text-gray-400 cursor-not-allowed\" : \"text-red-600 hover:text-red-900\"}\n                        title={isReadOnlyMode ? \"No disponible (modo solo lectura)\" : \"Disminuir progreso\"}\n                      >\n                        \n                      </button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n          <div className=\"flex justify-end mt-4\">\n            <button\n              onClick={() => setShowBaseline(false)}\n              className=\"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400\"\n            >\n              Cerrar\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* MODAL COMPLETAMENTE NUEVO PARA AGREGAR TAREAS */}\n      {showAddTaskModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-6\">\n                <div>\n                  <h2 className=\"text-2xl font-bold text-gray-800\">\n                    {newTaskData.insertAfterTaskId ? ' Insertar Nueva Tarea' : ' Agregar Nueva Tarea'}\n                  </h2>\n                  {newTaskData.insertAfterTaskId && (\n                    <p className=\"text-sm text-gray-600 mt-1\">\n                      La tarea se insertar despus de: <span className=\"font-medium text-indigo-600\">\n                        {tasksWithCPM.find(t => t.id === newTaskData.insertAfterTaskId)?.name || 'Tarea anterior'}\n                      </span>\n                    </p>\n                  )}\n                </div>\n                <button\n                  onClick={() => setShowAddTaskModal(false)}\n                  className=\"text-gray-400 hover:text-gray-600 text-2xl\"\n                >\n                  \n                </button>\n              </div>\n\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {/* Informacin Bsica */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold text-gray-700 border-b pb-2\"> Informacin Bsica</h3>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Nombre de la Tarea *\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={newTaskData.name}\n                      onChange={(e) => setNewTaskData(prev => ({\n                        ...prev,\n                        name: e.target.value\n                      }))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      placeholder=\"Ingresa el nombre de la tarea\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Descripcin\n                    </label>\n                    <textarea\n                      value={newTaskData.description}\n                      onChange={(e) => setNewTaskData(prev => ({\n                        ...prev,\n                        description: e.target.value\n                      }))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      rows=\"3\"\n                      placeholder=\"Describe la tarea...\"\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        Duracin (das) *\n                      </label>\n                      <input\n                        type=\"number\"\n                        min=\"1\"\n                        value={newTaskData.duration}\n                        onChange={(e) => {\n                          const duration = parseInt(e.target.value) || 1;\n                          const newEndDate = addDays(newTaskData.startDate, duration, includeWeekends);\n                          setNewTaskData(prev => ({\n                            ...prev,\n                            duration: duration,\n                            endDate: newEndDate\n                          }));\n                        }}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        Costo ($)\n                      </label>\n                      <input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"0.01\"\n                        value={newTaskData.cost}\n                        onChange={(e) => setNewTaskData(prev => ({\n                          ...prev,\n                          cost: parseFloat(e.target.value) || 0\n                        }))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        Fecha de Inicio *\n                      </label>\n                      <input\n                        type=\"date\"\n                        value={newTaskData.startDate}\n                        onChange={(e) => {\n                          const newStartDate = e.target.value;\n                          const newEndDate = addDays(newStartDate, newTaskData.duration, includeWeekends);\n                          setNewTaskData(prev => ({\n                            ...prev,\n                            startDate: newStartDate,\n                            endDate: newEndDate\n                          }));\n                        }}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        Fecha de Fin\n                      </label>\n                      <input\n                        type=\"date\"\n                        value={newTaskData.endDate}\n                        onChange={(e) => {\n                          const newEndDate = e.target.value;\n                          const newDuration = Math.ceil((new Date(newEndDate) - new Date(newTaskData.startDate)) / (1000 * 60 * 60 * 24));\n                          setNewTaskData(prev => ({\n                            ...prev,\n                            duration: newDuration > 0 ? newDuration : 1,\n                            endDate: newEndDate\n                          }));\n                        }}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        Prioridad\n                      </label>\n                      <select\n                        value={newTaskData.priority}\n                        onChange={(e) => setNewTaskData(prev => ({\n                          ...prev,\n                          priority: e.target.value\n                        }))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      >\n                        <option value=\"low\"> Baja</option>\n                        <option value=\"medium\"> Media</option>\n                        <option value=\"high\"> Alta</option>\n                        <option value=\"critical\"> Crtica</option>\n                      </select>\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        Asignado a\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={newTaskData.assignedTo}\n                        onChange={(e) => setNewTaskData(prev => ({\n                          ...prev,\n                          assignedTo: e.target.value\n                        }))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        placeholder=\"Nombre del responsable\"\n                      />\n                    </div>\n                  </div>\n\n                  {/* Valor de Negocio (PMBOK 7) */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                       Valor de Negocio (USD)\n                    </label>\n                    <div className=\"flex items-center space-x-2\">\n                      <input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"0.01\"\n                        value={newTaskData.businessValue}\n                        onChange={(e) => setNewTaskData(prev => ({\n                          ...prev,\n                          businessValue: parseFloat(e.target.value) || 0\n                        }))}\n                        className=\"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        placeholder=\"Valor estimado\"\n                      />\n                      <button\n                        type=\"button\"\n                        onClick={() => {\n                          const calculatedValue = calculateTaskBusinessValue(\n                            newTaskData.cost || 0,\n                            newTaskData.priority || 'medium',\n                            projectData?.plannedValue || 0,\n                            tasks\n                          );\n                          setNewTaskData(prev => ({\n                            ...prev,\n                            businessValue: calculatedValue\n                          }));\n                        }}\n                        className=\"px-4 py-2 bg-indigo-100 text-indigo-700 rounded-md hover:bg-indigo-200 transition-colors text-sm font-medium whitespace-nowrap\"\n                        title=\"Calcular automticamente basado en TIR, costo y prioridad\"\n                      >\n                         Auto\n                      </button>\n                    </div>\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Se calcula automticamente con base en TIR del proyecto, costo y prioridad de la tarea\n                    </p>\n                  </div>\n                </div>\n\n                {/* Dependencias */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold text-gray-700 border-b pb-2\"> Dependencias</h3>\n\n                  {/* Predecesoras */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Predecesoras ({newTaskData.selectedPredecessors.length})\n                    </label>\n                    <div className=\"space-y-2 max-h-40 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50\">\n                      {tasks.length === 0 ? (\n                        <p className=\"text-sm text-gray-500 italic\">No hay tareas existentes</p>\n                      ) : (\n                        tasks.map(task => (\n                          <label key={task.id} className=\"flex items-center space-x-2 cursor-pointer hover:bg-white p-2 rounded\">\n                            <input\n                              type=\"checkbox\"\n                              checked={newTaskData.selectedPredecessors.includes(task.id)}\n                              onChange={(e) => {\n                                if (e.target.checked) {\n                                  console.log(' NUEVO SISTEMA - Agregando predecesora:', task.id, task.wbsCode, task.name);\n                                  setNewTaskData(prev => {\n                                    const newPreds = prev.selectedPredecessors.slice().concat([task.id]);\n                                    console.log(' NUEVO SISTEMA - Predecesoras actualizadas:', newPreds);\n                                    return {\n                                      name: prev.name,\n                                      duration: prev.duration,\n                                      startDate: prev.startDate,\n                                      endDate: prev.endDate,\n                                      description: prev.description,\n                                      priority: prev.priority,\n                                      assignedTo: prev.assignedTo,\n                                      cost: prev.cost,\n                                      selectedPredecessors: newPreds,\n                                      selectedSuccessors: [...(prev.selectedSuccessors || [])]\n                                    };\n                                  });\n                                } else {\n                                  console.log(' NUEVO SISTEMA - Removiendo predecesora:', task.id, task.wbsCode, task.name);\n                                  setNewTaskData(prev => {\n                                    const newPreds = prev.selectedPredecessors.filter(id => id !== task.id);\n                                    console.log(' NUEVO SISTEMA - Predecesoras actualizadas:', newPreds);\n                                    return {\n                                      name: prev.name,\n                                      duration: prev.duration,\n                                      startDate: prev.startDate,\n                                      endDate: prev.endDate,\n                                      description: prev.description,\n                                      priority: prev.priority,\n                                      assignedTo: prev.assignedTo,\n                                      cost: prev.cost,\n                                      selectedPredecessors: newPreds,\n                                      selectedSuccessors: [...(prev.selectedSuccessors || [])]\n                                    };\n                                  });\n                                }\n                              }}\n                              className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n                            />\n                            <span className=\"text-sm\">\n                              <span className=\"font-medium\">{task.wbsCode}</span> - {task.name}\n                            </span>\n                          </label>\n                        ))\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Sucesoras */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Sucesoras ({newTaskData.selectedSuccessors.length})\n                    </label>\n                    <div className=\"space-y-2 max-h-40 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50\">\n                      {tasks.length === 0 ? (\n                        <p className=\"text-sm text-gray-500 italic\">No hay tareas existentes</p>\n                      ) : (\n                        tasks.map(task => (\n                          <label key={task.id} className=\"flex items-center space-x-2 cursor-pointer hover:bg-white p-2 rounded\">\n                            <input\n                              type=\"checkbox\"\n                              checked={newTaskData.selectedSuccessors.includes(task.id)}\n                              onChange={(e) => {\n                                if (e.target.checked) {\n                                  console.log(' NUEVO SISTEMA - Agregando sucesora:', task.id, task.wbsCode, task.name);\n                                  setNewTaskData(prev => {\n                                    const newSuccs = prev.selectedSuccessors.slice().concat([task.id]);\n                                    console.log(' NUEVO SISTEMA - Sucesoras actualizadas:', newSuccs);\n                                    return {\n                                      name: prev.name,\n                                      duration: prev.duration,\n                                      startDate: prev.startDate,\n                                      endDate: prev.endDate,\n                                      description: prev.description,\n                                      priority: prev.priority,\n                                      assignedTo: prev.assignedTo,\n                                      cost: prev.cost,\n                                      selectedPredecessors: [...(prev.selectedPredecessors || [])],\n                                      selectedSuccessors: newSuccs\n                                    };\n                                  });\n                                } else {\n                                  console.log(' NUEVO SISTEMA - Removiendo sucesora:', task.id, task.wbsCode, task.name);\n                                  setNewTaskData(prev => {\n                                    const newSuccs = prev.selectedSuccessors.filter(id => id !== task.id);\n                                    console.log(' NUEVO SISTEMA - Sucesoras actualizadas:', newSuccs);\n                                    return {\n                                      name: prev.name,\n                                      duration: prev.duration,\n                                      startDate: prev.startDate,\n                                      endDate: prev.endDate,\n                                      description: prev.description,\n                                      priority: prev.priority,\n                                      assignedTo: prev.assignedTo,\n                                      cost: prev.cost,\n                                      selectedPredecessors: [...(prev.selectedPredecessors || [])],\n                                      selectedSuccessors: newSuccs\n                                    };\n                                  });\n                                }\n                              }}\n                              className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n                            />\n                            <span className=\"text-sm\">\n                              <span className=\"font-medium\">{task.wbsCode}</span> - {task.name}\n                            </span>\n                          </label>\n                        ))\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Informacin de dependencias */}\n                  <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\n                    <h4 className=\"text-sm font-medium text-blue-800 mb-2\"> Informacin sobre Dependencias</h4>\n                    <ul className=\"text-xs text-blue-700 space-y-1\">\n                      <li> <strong>Predecesoras:</strong> Tareas que deben completarse antes de esta</li>\n                      <li> <strong>Sucesoras:</strong> Tareas que dependen de esta tarea</li>\n                      <li> Las dependencias se sincronizan automticamente</li>\n                    </ul>\n                  </div>\n                </div>\n              </div>\n\n              {/* Botones de accin */}\n              <div className=\"flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200\">\n                <button\n                  onClick={() => setShowAddTaskModal(false)}\n                  className=\"px-6 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\n                >\n                  Cancelar\n                </button>\n                <button\n                  onClick={() => {\n                    // Calcular insertIndex en el momento del clic\n                    const currentTasks = tasks || [];\n                    const insertAfterTaskId = newTaskData.insertAfterTaskId;\n                    let calculatedInsertIndex = null;\n\n                    if (insertAfterTaskId) {\n                      const insertAfterIndex = currentTasks.findIndex(task => task.id === insertAfterTaskId);\n                      if (insertAfterIndex !== -1) {\n                        calculatedInsertIndex = insertAfterIndex + 1;\n                        console.log(' DEBUG - Calculando insertIndex en el momento del clic:', {\n                          insertAfterTaskId,\n                          insertAfterIndex,\n                          calculatedInsertIndex,\n                          totalTasks: currentTasks.length\n                        });\n                      }\n                    }\n\n                    createTaskFromModal(calculatedInsertIndex);\n                  }}\n                  className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2\"\n                >\n                  <span></span>\n                  <span>Crear Tarea</span>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Modal de Minuta */}\n      <MinutaModal\n        isOpen={isMinutaModalOpen}\n        onClose={handleCloseMinutaModal}\n        hitos={tasks.filter(task => task.isMilestone)}\n        onSave={handleSaveMinuta}\n      />\n\n      {/* Modal de Edicin de Minuta */}\n      <EditMinutaModal\n        isOpen={isEditModalOpen}\n        onClose={handleCloseEditModal}\n        minuta={editingMinuta}\n        hitos={tasks.filter(task => task.isMilestone)}\n        onUpdate={handleUpdateMinuta}\n      />\n\n      {/* Asistente Inteligente de Cronogramas */}\n      {showAIWizard && console.log(' DEBUG - ScheduleWizard props:', {\n        projectId: projectData?.id,\n        organizationId: projectData?.organizationId,\n        userId: supabaseService.currentUser?.id,\n        projectDataKeys: projectData ? Object.keys(projectData) : 'null',\n        projectData: projectData\n      })}\n      <ScheduleWizard\n        isOpen={showAIWizard}\n        onClose={() => setShowAIWizard(false)}\n        onComplete={handleAIScheduleGenerated}\n        projectId={projectData?.id}\n        currentProject={projectData}\n        organizationId={projectData?.organizationId}\n        userId={supabaseService.currentUser?.id}\n      />\n    </div>\n  );\n};\n\nexport default ScheduleManagement;\n","/**\n * Utilidades para calcular valor de negocio basado en TIR y prioridad\n * Sistema hbrido: clculo automtico + ajuste manual\n */\n\n/**\n * Calcula el valor planificado total del proyecto basado en TIR\n * @param {number} budget - Presupuesto/inversin del proyecto\n * @param {number} irr - TIR del proyecto (en formato 0-100, ej: 25.5 = 25.5%)\n * @param {number} period - Periodo en aos (default: 3)\n * @returns {number} Valor planificado total del proyecto\n */\nexport const calculatePlannedValueFromIRR = (budget, irr, period = 3) => {\n  if (!budget || budget <= 0) return 0;\n  if (!irr || irr <= 0) return budget; // Si no hay TIR, valor = presupuesto\n\n  // Convertir TIR de porcentaje (25.5) a decimal (0.255)\n  const irrDecimal = irr / 100;\n\n  // Frmula: Valor Futuro = Inversin  (1 + TIR)^perodo\n  const valorFuturo = budget * Math.pow(1 + irrDecimal, period);\n\n  return Math.round(valorFuturo);\n};\n\n/**\n * Mapea prioridad de texto/cdigo a peso numrico\n * @param {string} priority - \"critical\"/\"Crtica\", \"high\"/\"Alta\", \"medium\"/\"Media\", \"low\"/\"Baja\"\n * @returns {number} Peso de criticidad\n */\nexport const getPriorityWeight = (priority) => {\n  // Normalizar a lowercase para comparacin\n  const normalizedPriority = (priority || '').toLowerCase();\n\n  const weights = {\n    'critical': 2.0,  // Crtica\n    'crtica': 2.0,\n    'high': 1.5,      // Alta\n    'alta': 1.5,\n    'medium': 1.0,    // Media\n    'media': 1.0,\n    'low': 0.5,       // Baja\n    'baja': 0.5\n  };\n\n  return weights[normalizedPriority] || 1.0; // Default: Media\n};\n\n/**\n * Calcula el valor de negocio de UNA tarea de forma proporcional\n * Esta funcin requiere conocer TODAS las tareas del proyecto para distribuir correctamente\n *\n * @param {number} taskCost - Costo de la tarea actual\n * @param {string} taskPriority - Prioridad de la tarea actual\n * @param {number} projectPlannedValue - Valor planificado total del proyecto\n * @param {Array} allTasks - Array de TODAS las tareas del proyecto\n * @returns {number} Valor de negocio sugerido para esta tarea\n */\nexport const calculateTaskBusinessValue = (\n  taskCost,\n  taskPriority,\n  projectPlannedValue,\n  allTasks = []\n) => {\n  if (!taskCost || taskCost <= 0) return 0;\n  if (!projectPlannedValue || projectPlannedValue <= 0) return taskCost; // Fallback: valor = costo\n\n  // Calcular peso de esta tarea\n  const taskWeight = getPriorityWeight(taskPriority);\n  const taskWeightedCost = taskCost * taskWeight;\n\n  // Calcular peso total de TODAS las tareas\n  const totalWeightedCost = allTasks.reduce((sum, task) => {\n    const cost = task.cost || 0;\n    const weight = getPriorityWeight(task.priority);\n    return sum + (cost * weight);\n  }, 0);\n\n  // Si no hay tareas o peso total es 0, usar proporcin simple por costo\n  if (totalWeightedCost === 0) {\n    const totalCost = allTasks.reduce((sum, task) => sum + (task.cost || 0), 0);\n    if (totalCost === 0) return projectPlannedValue; // Una sola tarea sin costo\n    return Math.round(projectPlannedValue * (taskCost / totalCost));\n  }\n\n  // Calcular proporcin de esta tarea\n  const proportion = taskWeightedCost / totalWeightedCost;\n\n  // Calcular valor de negocio\n  const businessValue = projectPlannedValue * proportion;\n\n  return Math.round(businessValue);\n};\n\n/**\n * Calcula el valor de negocio de TODAS las tareas de un proyecto\n * Asegura que la suma de todos los businessValue = plannedValue del proyecto\n *\n * @param {Array} tasks - Array de tareas con {cost, priority}\n * @param {number} projectPlannedValue - Valor planificado del proyecto\n * @returns {Array} Array de tareas con businessValue calculado\n */\nexport const calculateAllTasksBusinessValue = (tasks, projectPlannedValue) => {\n  if (!Array.isArray(tasks) || tasks.length === 0) return [];\n  if (!projectPlannedValue || projectPlannedValue <= 0) {\n    // Si no hay valor planificado, asignar valor = costo\n    return tasks.map(task => ({\n      ...task,\n      businessValue: task.cost || 0\n    }));\n  }\n\n  // Calcular peso total\n  const totalWeightedCost = tasks.reduce((sum, task) => {\n    const cost = task.cost || 0;\n    const weight = getPriorityWeight(task.priority);\n    return sum + (cost * weight);\n  }, 0);\n\n  if (totalWeightedCost === 0) {\n    // Si todas las tareas tienen costo 0, distribuir equitativamente\n    const valuePerTask = Math.round(projectPlannedValue / tasks.length);\n    return tasks.map(task => ({\n      ...task,\n      businessValue: valuePerTask\n    }));\n  }\n\n  // Calcular businessValue para cada tarea\n  let remainingValue = projectPlannedValue;\n  const tasksWithValue = tasks.map((task, index) => {\n    const cost = task.cost || 0;\n    const weight = getPriorityWeight(task.priority);\n    const weightedCost = cost * weight;\n    const proportion = weightedCost / totalWeightedCost;\n\n    let businessValue;\n\n    // Para la ltima tarea, asignar el valor restante para evitar errores de redondeo\n    if (index === tasks.length - 1) {\n      businessValue = remainingValue;\n    } else {\n      businessValue = Math.round(projectPlannedValue * proportion);\n      remainingValue -= businessValue;\n    }\n\n    return {\n      ...task,\n      businessValue: Math.max(0, businessValue) // Asegurar que no sea negativo\n    };\n  });\n\n  return tasksWithValue;\n};\n\n/**\n * Calcula el valor de negocio entregado por una tarea\n * @param {number} businessValue - Valor de negocio total de la tarea\n * @param {number} progress - Progreso de la tarea (0-100)\n * @returns {number} Valor de negocio entregado\n */\nexport const calculateDeliveredValue = (businessValue, progress) => {\n  if (!businessValue || businessValue <= 0) return 0;\n  if (!progress || progress <= 0) return 0;\n  if (progress >= 100) return businessValue;\n\n  return Math.round((businessValue * progress) / 100);\n};\n\n/**\n * Valida si el valor planificado del proyecto cuadra con la suma de valores de tareas\n * @param {number} plannedValue - Valor planificado del proyecto\n * @param {Array} tasks - Array de tareas con businessValue\n * @returns {object} { isValid, difference, percentageDiff, totalTasksValue, plannedValue }\n */\nexport const validatePlannedValue = (plannedValue, tasks) => {\n  const totalTasksValue = tasks.reduce((sum, task) => sum + (task.businessValue || 0), 0);\n  const difference = totalTasksValue - plannedValue;\n  const percentageDiff = plannedValue > 0 ? (difference / plannedValue) * 100 : 0;\n\n  // Se considera vlido si la diferencia es menor al 5%\n  const isValid = Math.abs(percentageDiff) <= 5;\n\n  return {\n    isValid,\n    difference,\n    percentageDiff: Math.round(percentageDiff * 100) / 100,\n    totalTasksValue,\n    plannedValue\n  };\n};\n\n/**\n * Recalcula automticamente el businessValue de todas las tareas\n * basado en cambios en costos, prioridades o plannedValue del proyecto\n *\n * @param {Array} tasks - Array de tareas actuales\n * @param {number} projectPlannedValue - Valor planificado del proyecto\n * @param {Array} tasksToRecalculate - IDs de tareas que NO deben recalcularse (fueron editadas manualmente)\n * @returns {Array} Array de tareas con businessValue actualizado\n */\nexport const smartRecalculateBusinessValue = (\n  tasks,\n  projectPlannedValue,\n  tasksToKeep = []\n) => {\n  if (!Array.isArray(tasks) || tasks.length === 0) return [];\n\n  // Separar tareas que mantienen su valor manual vs tareas a recalcular\n  const tasksToKeepManual = tasks.filter(t => tasksToKeep.includes(t.id));\n  const tasksToRecalculate = tasks.filter(t => !tasksToKeep.includes(t.id));\n\n  if (tasksToRecalculate.length === 0) {\n    // Todas las tareas son manuales, no recalcular nada\n    return tasks;\n  }\n\n  // Valor ya asignado manualmente\n  const manualValue = tasksToKeepManual.reduce((sum, t) => sum + (t.businessValue || 0), 0);\n\n  // Valor disponible para distribuir entre tareas a recalcular\n  const remainingValue = Math.max(0, projectPlannedValue - manualValue);\n\n  // Recalcular solo las tareas no-manuales\n  const recalculatedTasks = calculateAllTasksBusinessValue(tasksToRecalculate, remainingValue);\n\n  // Combinar tareas manuales + recalculadas\n  const allTasks = [...tasksToKeepManual, ...recalculatedTasks];\n\n  // Ordenar por ID original para mantener orden\n  allTasks.sort((a, b) => {\n    const indexA = tasks.findIndex(t => t.id === a.id);\n    const indexB = tasks.findIndex(t => t.id === b.id);\n    return indexA - indexB;\n  });\n\n  return allTasks;\n};\n\n/**\n * Obtiene informacin descriptiva de una prioridad\n * @param {string} priority - Cdigo de prioridad\n * @returns {object} { label, weight, color }\n */\nexport const getPriorityInfo = (priority) => {\n  const normalized = (priority || '').toLowerCase();\n\n  const info = {\n    'critical': { label: 'Crtica', weight: 2.0, color: 'red' },\n    'crtica': { label: 'Crtica', weight: 2.0, color: 'red' },\n    'high': { label: 'Alta', weight: 1.5, color: 'orange' },\n    'alta': { label: 'Alta', weight: 1.5, color: 'orange' },\n    'medium': { label: 'Media', weight: 1.0, color: 'yellow' },\n    'media': { label: 'Media', weight: 1.0, color: 'yellow' },\n    'low': { label: 'Baja', weight: 0.5, color: 'green' },\n    'baja': { label: 'Baja', weight: 0.5, color: 'green' }\n  };\n\n  return info[normalized] || { label: 'Media', weight: 1.0, color: 'yellow' };\n};\n","import { useState, useEffect, useCallback } from 'react';\n\nconst useAuditLog = (projectId, useSupabase = false) => {\n  const [auditLog, setAuditLog] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Cargar log de auditora desde localStorage o Supabase\n  useEffect(() => {\n    const loadAuditLog = async () => {\n      if (!projectId) return;\n      \n      setIsLoading(true);\n      \n      try {\n        if (useSupabase) {\n          // Cargar desde Supabase usando los nuevos mtodos\n          const { default: supabaseService } = await import('../services/SupabaseService');\n          if (supabaseService.isAuthenticated()) {\n            const result = await supabaseService.loadAuditEvents(projectId);\n            if (result.success) {\n              setAuditLog(result.events);\n              console.log(` Logs de auditora cargados desde Supabase para proyecto ${projectId}: ${result.events.length} eventos`);\n            } else {\n              // Fallback a localStorage si Supabase falla\n              const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n              if (savedLog) {\n                setAuditLog(JSON.parse(savedLog));\n              } else {\n                setAuditLog([]);\n              }\n            }\n          } else {\n            // Fallback a localStorage si no hay autenticacin\n            const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n            if (savedLog) {\n              setAuditLog(JSON.parse(savedLog));\n            } else {\n              setAuditLog([]);\n            }\n          }\n        } else {\n          // Cargar desde localStorage\n          const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n          if (savedLog) {\n            setAuditLog(JSON.parse(savedLog));\n          } else {\n            setAuditLog([]);\n          }\n        }\n      } catch (error) {\n        console.error('Error loading audit log:', error);\n        // Fallback a localStorage en caso de error\n        const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n        if (savedLog) {\n          setAuditLog(JSON.parse(savedLog));\n        }\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadAuditLog();\n  }, [projectId, useSupabase]);\n\n  // Guardar log de auditora en localStorage y/o Supabase\n  const saveAuditLog = useCallback(async (log) => {\n    // Siempre guardar en localStorage como backup\n    localStorage.setItem(`audit-log-${projectId}`, JSON.stringify(log));\n\n    // NOTA: La sincronizacin con Supabase se hace individualmente por evento\n    // No enviamos toda la lista para evitar duplicados\n    console.log(` Logs de auditora guardados en localStorage para proyecto ${projectId}: ${log.length} eventos`);\n  }, [projectId]);\n\n  // Guardar un evento individual en Supabase\n  const saveEventToSupabase = useCallback(async (event) => {\n    if (!useSupabase) return;\n\n    try {\n      const { default: supabaseService } = await import('../services/SupabaseService');\n      if (supabaseService.isAuthenticated()) {\n        // Guardar solo este evento especfico\n        const result = await supabaseService.saveAuditEvents(projectId, [event]);\n        if (result.success) {\n          console.log(` Evento de auditora guardado en Supabase: ${event.action}`);\n        } else {\n          console.warn(' Error guardando evento en Supabase:', result.error);\n        }\n      }\n    } catch (error) {\n      console.error('Error guardando evento en Supabase:', error);\n    }\n  }, [projectId, useSupabase]);\n\n  // Agregar evento de auditora\n  const addAuditEvent = useCallback(async (event) => {\n    const newEvent = {\n      id: crypto.randomUUID(), // Generar UUID vlido para Supabase\n      timestamp: new Date().toISOString(),\n      projectId,\n      ...event\n    };\n\n    setAuditLog(prevLog => {\n      const updatedLog = [newEvent, ...prevLog];\n      // Guardar de forma asncrona en localStorage\n      saveAuditLog(updatedLog);\n      return updatedLog;\n    });\n\n    // Guardar este evento especfico en Supabase\n    saveEventToSupabase(newEvent);\n\n    return newEvent;\n  }, [projectId, saveAuditLog, saveEventToSupabase]);\n\n  // Registrar cambio de estado del proyecto\n  const logProjectStatusChange = useCallback((previousStatus, newStatus, projectData) => {\n    addAuditEvent({\n      category: 'project-status',\n      action: 'status-changed',\n      description: `Estado del proyecto cambiado de \"${previousStatus}\" a \"${newStatus}\"`,\n      details: {\n        previousStatus,\n        newStatus,\n        projectName: projectData.name,\n        manager: projectData.manager,\n        budget: projectData.budget\n      },\n      severity: 'high',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar creacin de work package\n  const logWorkPackageCreated = useCallback((workPackage, projectData) => {\n    addAuditEvent({\n      category: 'work-package',\n      action: 'created',\n      description: `Work Package \"${workPackage.name}\" creado`,\n      details: {\n        workPackageId: workPackage.id,\n        name: workPackage.name,\n        budget: workPackage.budget,\n        status: workPackage.status\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar modificacin de work package\n  const logWorkPackageModified = useCallback((workPackage, changes, projectData) => {\n    addAuditEvent({\n      category: 'work-package',\n      action: 'modified',\n      description: `Work Package \"${workPackage.name}\" modificado`,\n      details: {\n        workPackageId: workPackage.id,\n        name: workPackage.name,\n        changes: Object.keys(changes),\n        previousValues: changes\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar creacin de riesgo\n  const logRiskCreated = useCallback((risk, projectData) => {\n    addAuditEvent({\n      category: 'risk',\n      action: 'created',\n      description: `Riesgo \"${risk.name}\" identificado`,\n      details: {\n        riskId: risk.id,\n        name: risk.name,\n        probability: risk.probability,\n        impact: risk.impact,\n        priority: risk.priority\n      },\n      severity: risk.priority === 'high' ? 'high' : 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar evento financiero\n  const logFinancialEvent = useCallback((type, item, projectData) => {\n    const eventMap = {\n      'purchase-order': {\n        action: 'created',\n        description: `Orden de Compra \"${item.description}\" creada`,\n        details: {\n          poId: item.id,\n          description: item.description,\n          amount: item.amount,\n          supplier: item.supplier\n        }\n      },\n      'advance': {\n        action: 'created',\n        description: `Anticipo \"${item.description}\" creado`,\n        details: {\n          advanceId: item.id,\n          description: item.description,\n          amount: item.amount,\n          recipient: item.recipient\n        }\n      },\n      'invoice': {\n        action: 'created',\n        description: `Factura \"${item.description}\" creada`,\n        details: {\n          invoiceId: item.id,\n          description: item.description,\n          amount: item.amount,\n          supplier: item.supplier\n        }\n      },\n      'contract': {\n        action: 'created',\n        description: `Contrato \"${item.name}\" creado`,\n        details: {\n          contractId: item.id,\n          name: item.name,\n          value: item.value,\n          contractor: item.contractor\n        }\n      }\n    };\n\n    const eventConfig = eventMap[type];\n    if (eventConfig) {\n      addAuditEvent({\n        category: 'financial',\n        action: eventConfig.action,\n        description: eventConfig.description,\n        details: eventConfig.details,\n        severity: 'high',\n        user: projectData.manager || 'Sistema'\n      });\n    }\n  }, [addAuditEvent]);\n\n  // Registrar asignacin de recursos\n  const logResourceAssignment = useCallback((assignment, projectData) => {\n    addAuditEvent({\n      category: 'resources',\n      action: 'assigned',\n      description: `Recurso asignado al proyecto`,\n      details: {\n        assignmentId: assignment.id,\n        resourceId: assignment.resourceId,\n        role: assignment.role,\n        allocation: assignment.allocation\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar creacin de tarea de minuta\n  const logMinutaTaskCreated = useCallback((minutaTask, projectData) => {\n    addAuditEvent({\n      category: 'minutes',\n      action: 'minute-task-created',\n      description: `Tarea de minuta \"${minutaTask.tarea}\" creada`,\n      details: {\n        taskId: minutaTask.id,\n        tarea: minutaTask.tarea,\n        responsable: minutaTask.responsable,\n        fecha: minutaTask.fecha,\n        hitoId: minutaTask.hitoId,\n        estatus: minutaTask.estatus\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar actualizacin de tarea de minuta\n  const logMinutaTaskUpdated = useCallback((minutaTask, changes, projectData) => {\n    addAuditEvent({\n      category: 'minutes',\n      action: 'minute-task-updated',\n      description: `Tarea de minuta \"${minutaTask.tarea}\" actualizada`,\n      details: {\n        taskId: minutaTask.id,\n        tarea: minutaTask.tarea,\n        changes: changes,\n        newStatus: minutaTask.estatus\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Limpiar log de auditora\n  const clearAuditLog = useCallback(() => {\n    setAuditLog([]);\n    localStorage.removeItem(`audit-log-${projectId}`);\n  }, [projectId]);\n\n  // Exportar log de auditora\n  const exportAuditLog = useCallback(() => {\n    const exportData = {\n      projectId,\n      exportDate: new Date().toISOString(),\n      totalEvents: auditLog.length,\n      events: auditLog\n    };\n\n    const dataStr = JSON.stringify(exportData, null, 2);\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\n    \n    const url = URL.createObjectURL(dataBlob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `audit-log-${projectId}-${new Date().toISOString().split('T')[0]}.json`;\n    link.click();\n    URL.revokeObjectURL(url);\n  }, [auditLog, projectId]);\n\n  return {\n    auditLog,\n    isLoading,\n    addAuditEvent,\n    logProjectStatusChange,\n    logWorkPackageCreated,\n    logWorkPackageModified,\n    logRiskCreated,\n    logFinancialEvent,\n    logResourceAssignment,\n    logMinutaTaskCreated,\n    logMinutaTaskUpdated,\n    clearAuditLog,\n    exportAuditLog\n  };\n};\n\nexport default useAuditLog;\n"],"names":["_ref","isOpen","onClose","hitos","onSave","minutaTasks","setMinutaTasks","useState","id","tarea","responsable","fecha","hitoId","useEffect","handleInputChange","field","value","prev","map","task","_objectSpread","_jsx","className","children","_jsxs","onClick","onChange","e","target","placeholder","maxLength","rows","length","type","hito","wbsCode","name","handleSave","tareasValidas","filter","trim","alert","tareasConMetadata","crypto","randomUUID","fechaCreacion","Date","toISOString","estatus","minuta","onUpdate","editedMinuta","setEditedMinuta","_projectTypes$find","_industries$find","_methodologies$find","wizardData","availableTemplates","selectedTemplate","setSelectedTemplate","customProjectType","setCustomProjectType","projectTypes","label","icon","methodologies","description","industries","newData","projectType","project_type","industry","methodology","templateId","templateName","Object","keys","some","key","newProjectType","toLowerCase","replace","projectName","projectManager","projectDescription","matchingTemplate","find","template","handleProjectTypeChange","concat","method","handleTemplateSelect","estimated_duration_days","team_size_min","team_size_max","startDate","endDate","t","i","m","_experienceLevels$fin2","_riskTolerances$find","teamMembers","setTeamMembers","newMember","setNewMember","role","experience","experienceLevels","teamRoles","riskTolerances","experienceScores","averageScore","reduce","sum","member","teamExperience","teamSize","getRoleIcon","roleValue","r","getRoleLabel","size","level","addTeamMember","now","disabled","_experienceLevels$fin","removeTeamMember","memberId","availability","teamAvailability","risk","riskTolerance","budget","parseFloat","monthlyBudget","toLocaleString","milestones","setMilestones","newMilestone","setNewMilestone","showAddForm","setShowAddForm","predefinedMilestones","getPredefinedMilestones","milestoneTemplates","general","addMilestone","milestone","isCustom","editMilestone","milestoneId","reorderMilestones","fromIndex","toIndex","newMilestones","moved","splice","index","title","removeMilestone","onKeyPress","autoFocus","machineryData","setMachineryData","deliveryTime","deliveryTimeUnit","requiresInfrastructure","isForeignEquipment","numberOfAdvancePayments","advancePayments","percentage","timing","errors","setErrors","handleAdvancePaymentChange","newAdvancePayments","generateDefaultPayments","number","validateForm","newErrors","totalPercentage","payment","Math","abs","min","parseInt","checked","defaultPayments","handleNumberOfAdvancePaymentsChange","max","step","toFixed","_generatedSchedule$me","_generatedSchedule$me2","_generatedSchedule$me3","_generatedSchedule$me4","_generatedSchedule$ac","_generatedSchedule$ac2","_generatedSchedule$mi","_generatedSchedule$mi2","generatedSchedule","isGenerating","onGenerate","selectedView","setSelectedView","showRecommendations","setShowRecommendations","console","log","hasOnGenerate","formatDuration","days","round","stats","schedule","_schedule$criticalPat","activities","totalDuration","activity","duration","highPriorityActivities","a","priority","criticalPathActivities","criticalPath","totalActivities","totalMilestones","averageActivityDuration","calculateStats","handleGenerate","style","animationDelay","_Fragment","view","metadata","complexity","templateUsed","dateString","generatedAt","toLocaleDateString","category","assignedTo","confidence","phase","criteria","recommendations","recommendation","action","constructor","this","templateData","templatePath","loadTemplate","parseTemplateData","error","data","slice","forEach","row","_row$","originalId","parseDuration","parsePriority","responsible","predecessor","isMilestone","includes","categorizeActivity","determinePhase","templateBased","customizable","isCustomizable","push","templateVersion","loadedAt","durationStr","match","toString","priorityStr","activityName","activityId","condition","mapTeamRoles","templateRole","possibleRoles","customizeActivities","_activity$customizabl","_activity$customizabl2","customized","assignment","assignedRole","assignedExperience","deliveryDays","convertToDays","paymentTiming","getPaymentTimingFromActivity","correspondingPayment","p","amount","unit","filterConditionalActivities","include","generateTemplateBasedSchedule","_wizardData$advancePa","undefined","criticalPathResult","calculateCriticalPath","activitiesWithDependencies","generateRecommendations","estimatedDuration","calculateTotalDuration","assessComplexity","customizationApplied","manufacturingTime","infrastructureIncluded","importIncluded","applyDependencies","activitiesWithDates","calculateDates","identifyCriticalPath","result","dependencies","predecessorActivity","warn","checkCircularDependencies","visited","Set","recursionStack","hasCycle","has","add","depId","delete","activityMap","Map","set","calculateActivityDates","activityStartDate","depActivity","get","latestDependencyEnd","setDate","getDate","activityEndDate","earlyStart","earlyFinish","templateCalculated","sort","b","topologicalSort","temp","visit","Error","message","total","supabase","organizationId","currentUser","initialize","scheduleLogger","debug","userId","generateSmartSchedule","_template$activities","TemplateBasedSchedulerService","getBaseTemplate","hasTemplateData","template_data","hasActivities","activitiesLength","templateKeys","activitiesToAdjust","extractActivitiesFromTemplate","adjustedActivities","adjustActivitiesByContext","smartMilestones","generateSmartMilestones","finalActivities","sortMachineryActivities","saveGenerationHistory","genericTemplate","getGenericTemplateData","phases","extractActivitiesFromPhases","extractMilestonesFromPhases","query","from","select","or","is","eq","templates","genericQuery","genericTemplates","limit","bestTemplate","rankTemplates","context","arguments","teamSizeMultiplier","calculateTeamSizeMultiplier","experienceMultiplier","calculateExperienceMultiplier","activityIndex","adjustedDuration","ceil","adjustMachineryActivityDuration","adjustedActivity","generateActivityDescription","phaseIndex","determinePriority","suggestAssignee","estimatedCost","estimateCost","requiredSkills","parallel","generatedBy","calculateConfidence","adjustDependencies","activitiesByPhase","entries","phaseName","phaseActivities","phaseMilestone","progress","status","generateMilestoneCriteria","specificMilestones","generateSpecificMilestones","generationRecord","project_id","projectId","template_id","input_data","generated_schedule","created_by","organization_id","insert","baseDescription","existingActivities","Array","isArray","adjustedDeps","dep","startsWith","existingActivity","join","activityNames","scoreA","scoreB","genericPhases","riskLevel","getAvailableTemplates","order","getGenerationHistory","ascending","history","provideFeedback","generationId","feedbackScore","feedbackComments","update","feedback_score","feedback_comments","updated_at","addMachinerySpecificActivities","baseDuration","newActivities","importActivities","infrastructureActivities","paymentActivities","getPaymentPhase","paymentInfo","getPaymentTimingOrder","getActivitySortOrder","getPhaseOrder","sortedActivities","orderA","orderB","localeCompare","getActivityOrder","phaseOrder","getPaymentRelativePosition","onComplete","currentProject","currentStep","setCurrentStep","setWizardData","setGeneratedSchedule","setIsGenerating","setError","setAvailableTemplates","showMachineryConfig","setShowMachineryConfig","initializeWizard","needsMachineryStep","generateSchedule","async","loadAvailableTemplates","manager","split","smartSchedulerService","updateWizardData","useCallback","_schedule$activities","_schedule$milestones","handleClose","isCurrentStepValid","width","ProjectAnalysisStep","ResourceConfigStep","MilestoneDefinitionStep","MachineryConfigStep","SchedulePreview","prevStep","nextStep","completeWizard","syncFunction","delay","timeoutRef","useRef","isSyncingRef","lastSyncRef","errorRef","pendingDataRef","cancelSync","current","clearTimeout","executeSync","window","dispatchEvent","CustomEvent","detail","timestamp","toLocaleTimeString","lastSync","retryData","localStorage","setItem","JSON","stringify","storageError","sync","setTimeout","syncNow","retryTimeout","pendingDataStr","getItem","parse","removeItem","isSyncing","tasks","projectData","supabaseService","useSupabase","tasksWithValue","useMemo","plannedValue","businessValue","totalTasks","calculatedTasksArray","calculateAllTasksBusinessValue","calculatedValuesMap","calculatedValue","syncToSupabase","tasksToSync","successCount","errorCount","business_value","taskError","useDebouncedSync","originalTask","recalculate","tasksToRecalc","recalculatedTasks","DAY","ROW_H","sanitizeInput","input","substring","validateTaskName","valid","sanitized","validateDuration","num","isNaN","validateDate","date","dateObj","getTime","currentYear","getFullYear","d","toISO","sortTasksByWbsCode","getNumericValue","numericMatch","String","aNum","bNum","isWorkingDay","dayOfWeek","getDay","addDays","addWorkingDays","currentDate","daysAdded","diffDaysExclusive","d1","d2","diffVisibleColumnsExclusive","findColumnIndex","targetDate","referenceStartDate","includeWeekends","start","columnIndex","shouldDebug","tempCurrent","durationDaysInclusive","end","durationVisibleColumnsInclusive","calculateTaskSensitivity","allTasks","sensitivity","isCritical","predecessors","successors","resources","predId","pred","calculateCPM","uniqueTasks","seenIds","duplicatesRemoved","taskMap","cost","originalDuration","lateStart","lateFinish","totalFloat","freeFloat","workPackageId","updatedTasks","values","calculateForwardPass","calculating","calculateEarly","taskId","maxEarlyFinish","predFinish","adjustedDate","adjustToWorkingDay","calculateBackwardPass","finalTasks","projectEnd","taskEnd","calculateLate","minLateStart","succId","succ","succLateStart","lateFinishDate","criticalPathLength","criticalTasks","minSuccessorEarlyStart","succEarlyStart","criticalImpact","delayCost","resourceImpact","successorImpact","safetyFloat","startDates","endDates","minStart","maxEnd","timeDiff","criticalPaths","dfs","currentPath","pathDuration","pop","startTasks","startTask","findCriticalPaths","projectMetrics","calculateProjectMetrics","criticalDuration","adjustedTotalDuration","totalCost","criticalCost","criticalPercentage","averageFloat","maxFloat","criticalTasksCount","durationDifference","endDateObj","calculateResourceUtilization","resourceLoad","utilization","resource","assignments","totalDays","fromEntries","_cmpResult$criticalPa","_selectedTask$predece","_selectedTask$success","_tasksWithCPM$find","_supabaseService$curr3","_supabaseService$curr4","setTasks","importTasks","onScheduleDataChange","setIncludeWeekends","updateProjectMinutas","projectTasks","every","idToNewWbsMapping","newWbsCode","migratedTasks","migratedPredecessors","predTask","Boolean","migratedTask","needsUpdate","expectedWbs","pos","milestonesWithWrongDates","taskName","startDateOriginal","endDateOriginal","endDateCorregida","updatedAt","scheduleData","projectStart","completedTasks","inProgressTasks","delayedTasks","totalProgress","businessCase","plannedEndDate","totalInvestment","totalBudget","selectedTask","setSelectedTask","tempTaskName","setTempTaskName","viewMode","setViewMode","editingCell","setEditingCell","editingValue","setEditingValue","selectedRow","setSelectedRow","selectedPredecessor","setSelectedPredecessor","selectedSuccessor","setSelectedSuccessor","predecessorSelectRef","ganttScale","setGanttScale","showCriticalPath","setShowCriticalPath","showDependencies","setShowDependencies","baselineTasks","setBaselineTasks","showBaseline","setShowBaseline","showBusinessCase","setShowBusinessCase","showResourceAnalysis","setShowResourceAnalysis","cmpError","setCmpError","isMinutaModalOpen","setIsMinutaModalOpen","minutasTasks","setMinutasTasks","loadingMinutas","setLoadingMinutas","editingMinuta","setEditingMinuta","isEditModalOpen","setIsEditModalOpen","showAIWizard","setShowAIWizard","isReadOnlyMode","setIsReadOnlyMode","logMinutaTaskCreated","logMinutaTaskUpdated","addAuditEvent","useAuditLog","editPermission","subscriptionService","canEdit","allowed","checkReadOnlyMode","networkLayout","setNetworkLayout","networkOrientation","setNetworkOrientation","showNetworkDependencies","setShowNetworkDependencies","showNetworkCriticalPath","setShowNetworkCriticalPath","showOnlyCriticalPath","setShowOnlyCriticalPath","showSimplifiedView","setShowSimplifiedView","autoFitNetwork","setAutoFitNetwork","networkZoom","setNetworkZoom","networkPan","setNetworkPan","x","y","draggedNode","setDraggedNode","dragOffset","setDragOffset","isPanning","setIsPanning","panStart","setPanStart","lastPan","setLastPan","leftRef","rightRef","fileInputRef","networkSvgRef","baselineById","cmpResult","cpmResult","tasksWithForcedDeps","cpmTask","tasksWithCPMOriginal","taskWithCPMDates","tasksWithBusinessValue","isBusinessValueSyncing","businessValueLastSync","businessValueError","recalculateBusinessValue","useBusinessValueSync","tasksWithCPM","currentTask","circularTasks","currentId","path","cycleStart","indexOf","cycle","circular","resourceAnalysis","resourceConflicts","allocation","sortedAssignments","next","task1","task2","overlapDays","conflicts","analyzeResources","prevIncludeWeekends","handleTasksUpdated","event","prevTasks","addEventListener","removeEventListener","newEndDate","hasChanges","generateNetworkNodes","filteredTasks","nodeWidth","nodeHeight","horizontalSpacing","verticalSpacing","nodes","levels","processed","calculateLevel","visiting","tasksByLevel","maxLevel","levelWidth","levelStartX","height","n","center","networkNodes","centerNetwork","hasSvgRef","nodesLength","minX","Infinity","minY","maxX","maxY","node","margin","contentWidth","contentHeight","centerX","centerY","autoFitNetworkDiagram","setAttribute","success","minutas","loadMinutasByProject","_portfolioData$minuta","minutasFromStorage","minutasByProject","loadMinutas","headerRef","isScrolling","updateTask","selectedTaskId","updatedTask","Number","isFinite","valorAnterior","valorNuevo","taskCompleta","updated","selectedTaskCompleta","DEPENDENCY_TYPES","color","hasCircularDependency","newPredecessorId","foundTask","tempTask","cleanCircularDependencies","cleanedTasks","updateDependencyTypeInfo","dependencyTypeSelect","document","getElementById","dependencyTypeInfo","selectedType","typeInfo","textContent","updates","successorsString","dependencyType","newSuccs","s","predMap","_predMap$get","updatePredecessors","predecessorsString","newPreds","validation","validatePredecessor","updatedSelectedTask","validateExcelPredecessors","newValue","valor","warnings","predecessorTask","rowNumber","currentStart","predecessorId","_document$getElementB","nuevaPredecesora","predecesorasAntes","predecesorasDespues","antes","despues","count","successorSelect","handleSuccessorChange","actualValue","currentSelectedTask","_document$querySelect","modalTaskId","querySelector","getAttribute","nuevaSucesora","sucesorasAntes","sucesorasDespues","selectedTaskRef","hasCircularDependencyRef","updatePredecessorsRef","exportToExcel","exportData","_task$predecessors","ID","WBS","Name","Duration","StartDate","EndDate","Progress","Predecessors","Resources","Cost","BusinessValue","IsMilestone","IsCritical","Status","EarlyStart","EarlyFinish","LateStart","LateFinish","TotalFloat","FreeFloat","ws","XLSX","json_to_sheet","wb","book_new","book_append_sheet","businessData","objective","sponsor","expectedBenefits","irr","roi","paybackPeriod","npv","wsBC","aoa_to_sheet","exportScheduleToExcel","hasName","_task$predecessors2","predecessorsText","wch","summaryData","wsSummary","projectDates","_e$target$files2","file","files","reader","FileReader","onload","loadedProjectData","_loadedProjectData$se","_loadedProjectData$se2","_loadedProjectData$se3","baseline","settings","readAsText","_tasks$","_tasks","dates","flatMap","firstTaskDate","lastTaskDate","allStartDates","minStartDate","minStartDateISO","pStart","pEnd","pxPerDay","chartWidthPx","todayISO","PV","dur","elapsed","EV","spi","cpi","progressPercentage","investmentToDate","projectedROI","earnedValue","showAddTaskModal","setShowAddTaskModal","newTaskData","setNewTaskData","selectedPredecessors","tryFileReaderFallback","Uint8Array","workbook","processWorkbook","processingError","onerror","_error$target","readAsDataURL","SheetNames","worksheet","Sheets","jsonData","sheet_to_json","header","headers","columnMap","nombre","findIndex","h","headerLower","duracion","inicio","fin","progreso","prioridad","asignado","costo","predecesoras","newTasks","cell","hitoValue","parseDate","dateValue","parse_date_code","rawName","nameValidation","durationValidation","startValidation","predStr","predValues","predecessorIds","predWbsCode","errorMessage","warningMessage","confirm","confirmMessage","sortedNewTasks","dataChangeEvent","taskCount","startEditing","currentValue","dateParts","day","padStart","month","year","handleOpenMinutaModal","handleEditMinuta","_supabaseService$curr2","organizationIdType","hasOrganizationId","email","aiSchedulerService","hasProjectId","initializeAIService","saveEdit","tasksLength","saveDependenciesEdit","prevLength","updateData","end_date","start_date","taskForStart","assigned_to","then","_ref4","catch","cancelEdit","handleKeyDown","preventDefault","predecessorNumbers","syncDependencies","_ref5","getTimelineReferenceDate","originalStart","referenceDate","originalProjectStart","isShifted","shiftDays","note","todayLeftPx","generateGanttBars","projectDatesStart","tableStartDate","tableEndDate","leftDays","endColumnIndex","durDays","tableDisplayStart","tableDisplayEnd","leftPx","widthPx","edges","source","scaleX","scaleY","optimalZoom","newZoom","totalNodes","totalEdges","tareasConDeps","detalleDeps","currentLevel","maxPredLevel","predLevel","maxDepth","compressSchedule","compressionOptions","compressionPotential","compressionCost","daysToCompress","prompt","targetCompression","totalCompression","compression","compressedDays","originalStartDates","originalEndDates","maxEndDate","getMonth","formattedDate","stopPropagation","htmlFor","generateExampleExcel","fileName","_fileInputRef$current","click","ref","accept","_e$target$files3","endsWith","fileUrl","URL","createObjectURL","fetch","response","ok","arrayBuffer","byteLength","revokeObjectURL","fetchError","urlError","importScheduleFromExcel","display","recalculated","minWidth","onKeyDown","isAddButton","suggestion","newStartDate","lastTask","newTaskId","c","random","generateUniqueWbs","newWbs","counter","newTask","actualCost","createdDate","lastModified","lastTaskId","addTaskAtEnd","colSpan","insertAfterTaskId","visualIndex","referenceTask","insertIndex","prevTask","parts","major","minor","generateWbsForPosition","referenceIndex","insertPosition","_supabaseService$curr","taskToInsert","owner_id","wbs_code","is_milestone","original_duration","created_at","_ref2","Promise","all","insertTaskAtPosition","taskToDelete","dependentTasks","_task$predecessors3","_task$successors","_task$predecessors4","_task$successors2","_task$predecessors5","_task$successors3","results","deleteTask","onBlur","toggleMilestone","reverse","startEditingDependencies","predNumber","saveBaseline","baselineData","slack","onScroll","scrollTop","currentTarget","tareaCompleta","maxWidth","backgroundColor","borderBottom","scrollLeft","headerContainerWidth","scrollWidth","headerContainerClientWidth","clientWidth","rightContainerWidth","rightContainerClientWidth","generateTimelineHeaders","startReference","projectDatesEnd","cur","sub","labelStart","labelEnd","remaining","spanDays","setMonth","totalHeaders","totalWidth","firstHeader","lastHeader","left","top","background","border","boxShadow","predIndex","predBar","startX","startY","endX","endY","markerWidth","markerHeight","refX","refY","orient","markerUnits","points","fill","x1","y1","x2","y2","stroke","strokeWidth","markerEnd","strokeDasharray","tareasDelHito","newStatus","updateMinutaStatus","tareaId","hitoEncontrado","_selectedTask$predece2","currentPreds","_selectedTask$success2","currentSuccs","_ref9","conflict","_ref0","newDuration","calculateTaskBusinessValue","selectedSuccessors","currentTasks","calculatedInsertIndex","insertAfterIndex","insertIndexOverride","finalInsertIndex","insertIndexType","insertAfterTaskIdType","predecessorsLength","successorsLength","_addedTask$predecesso","_addedTask$successors","insertIndexUndefined","finalInsertIndexUndefined","addedTask","addedTaskIndex","position","newTaskIncluded","newTaskPosition","newTaskExists","_task$predecessors6","_task$successors4","createTaskFromModal","MinutaModal","handleCloseMinutaModal","saveMinutas","updatedMinutas","minutasCount","EditMinutaModal","handleCloseEditModal","updateResult","updateMinuta","updatedMinuta","task_description","responsible_person","due_date","milestone_id","changes","projectDataKeys","ScheduleWizard","today","projectStartDate","aiActivities","item","aiMilestones","milestoneDate","allAITasks","processedMilestones","_ref3","phaseMilestones","unassignedMilestones","totalItems","allAITasksOrder","activitiesCount","milestonesCount","orderedTasksWithCPM","tasksMap","cpmResultType","cpmResultKeys","tasksType","tasksIsArray","orderedTasksLength","orderPreserved","originalOrder","finalOrder","milestonesPositions","activitiesBeforeMilestones","activitiesBefore","sampleTasksWithDates","details","_generatedSchedule$me5","recommendationsText","rec","_generatedSchedule$me6","getPriorityWeight","taskCost","taskPriority","projectPlannedValue","taskWeightedCost","totalWeightedCost","valuePerTask","remainingValue","proportion","validatePlannedValue","totalTasksValue","difference","percentageDiff","isValid","auditLog","setAuditLog","isLoading","setIsLoading","default","isAuthenticated","loadAuditEvents","events","savedLog","loadAuditLog","saveAuditLog","saveEventToSupabase","saveAuditEvents","newEvent","prevLog","updatedLog","logProjectStatusChange","previousStatus","severity","user","logWorkPackageCreated","workPackage","logWorkPackageModified","previousValues","logRiskCreated","riskId","probability","impact","logFinancialEvent","eventConfig","poId","supplier","advanceId","recipient","invoiceId","contractId","contractor","logResourceAssignment","assignmentId","resourceId","minutaTask","clearAuditLog","exportAuditLog","exportDate","totalEvents","dataStr","dataBlob","Blob","url","link","createElement","href","download"],"sourceRoot":""}
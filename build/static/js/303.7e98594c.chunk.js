"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[303,521,664,902],{1096:(e,a,t)=>{t.d(a,{$0:()=>c,Jo:()=>n,g5:()=>s,jC:()=>r});var o=t(9379);const r=function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;if(!e||e<=0)return 0;if(!a||a<=0)return e;const o=a/100,r=e*Math.pow(1+o,t);return Math.round(r)},i=e=>({critical:2,"cr\xedtica":2,high:1.5,alta:1.5,medium:1,media:1,low:.5,baja:.5}[(e||"").toLowerCase()]||1),n=function(e,a,t){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!e||e<=0)return 0;if(!t||t<=0)return e;const r=e*i(a),n=o.reduce((e,a)=>e+(a.cost||0)*i(a.priority),0);if(0===n){const a=o.reduce((e,a)=>e+(a.cost||0),0);return 0===a?t:Math.round(t*(e/a))}const c=t*(r/n);return Math.round(c)},c=(e,a)=>{if(!Array.isArray(e)||0===e.length)return[];if(!a||a<=0)return e.map(e=>(0,o.A)((0,o.A)({},e),{},{businessValue:e.cost||0}));const t=e.reduce((e,a)=>e+(a.cost||0)*i(a.priority),0);if(0===t){const t=Math.round(a/e.length);return e.map(e=>(0,o.A)((0,o.A)({},e),{},{businessValue:t}))}let r=a;return e.map((n,c)=>{const s=(n.cost||0)*i(n.priority)/t;let d;return c===e.length-1?d=r:(d=Math.round(a*s),r-=d),(0,o.A)((0,o.A)({},n),{},{businessValue:Math.max(0,d)})})},s=(e,a)=>{const t=a.reduce((e,a)=>e+(a.businessValue||0),0),o=t-e,r=e>0?o/e*100:0;return{isValid:Math.abs(r)<=5,difference:o,percentageDiff:Math.round(100*r)/100,totalTasksValue:t,plannedValue:e}}},7902:(e,a,t)=>{t.d(a,{A:()=>i});var o=t(9379),r=t(9950);const i=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[i,n]=(0,r.useState)([]),[c,s]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(e){s(!0);try{if(a){const{default:a}=await Promise.resolve().then(t.bind(t,9874));if(a.isAuthenticated()){const t=await a.loadAuditEvents(e);if(t.success)n(t.events),console.log("\u2705 Logs de auditor\xeda cargados desde Supabase para proyecto ".concat(e,": ").concat(t.events.length," eventos"));else{const a=localStorage.getItem("audit-log-".concat(e));n(a?JSON.parse(a):[])}}else{const a=localStorage.getItem("audit-log-".concat(e));n(a?JSON.parse(a):[])}}else{const a=localStorage.getItem("audit-log-".concat(e));n(a?JSON.parse(a):[])}}catch(o){console.error("Error loading audit log:",o);const a=localStorage.getItem("audit-log-".concat(e));a&&n(JSON.parse(a))}finally{s(!1)}}})()},[e,a]);const d=(0,r.useCallback)(async a=>{localStorage.setItem("audit-log-".concat(e),JSON.stringify(a)),console.log("\ud83d\udccb Logs de auditor\xeda guardados en localStorage para proyecto ".concat(e,": ").concat(a.length," eventos"))},[e]),u=(0,r.useCallback)(async o=>{if(a)try{const{default:a}=await Promise.resolve().then(t.bind(t,9874));if(a.isAuthenticated()){const t=await a.saveAuditEvents(e,[o]);t.success?console.log("\u2705 Evento de auditor\xeda guardado en Supabase: ".concat(o.action)):console.warn("\u26a0\ufe0f Error guardando evento en Supabase:",t.error)}}catch(r){console.error("Error guardando evento en Supabase:",r)}},[e,a]),l=(0,r.useCallback)(async a=>{const t=(0,o.A)({id:crypto.randomUUID(),timestamp:(new Date).toISOString(),projectId:e},a);return n(e=>{const a=[t,...e];return d(a),a}),u(t),t},[e,d,u]),g=(0,r.useCallback)((e,a,t)=>{l({category:"project-status",action:"status-changed",description:'Estado del proyecto cambiado de "'.concat(e,'" a "').concat(a,'"'),details:{previousStatus:e,newStatus:a,projectName:t.name,manager:t.manager,budget:t.budget},severity:"high",user:t.manager||"Sistema"})},[l]),p=(0,r.useCallback)((e,a)=>{l({category:"work-package",action:"created",description:'Work Package "'.concat(e.name,'" creado'),details:{workPackageId:e.id,name:e.name,budget:e.budget,status:e.status},severity:"medium",user:a.manager||"Sistema"})},[l]),m=(0,r.useCallback)((e,a,t)=>{l({category:"work-package",action:"modified",description:'Work Package "'.concat(e.name,'" modificado'),details:{workPackageId:e.id,name:e.name,changes:Object.keys(a),previousValues:a},severity:"medium",user:t.manager||"Sistema"})},[l]),h=(0,r.useCallback)((e,a)=>{l({category:"risk",action:"created",description:'Riesgo "'.concat(e.name,'" identificado'),details:{riskId:e.id,name:e.name,probability:e.probability,impact:e.impact,priority:e.priority},severity:"high"===e.priority?"high":"medium",user:a.manager||"Sistema"})},[l]),k=(0,r.useCallback)((e,a,t)=>{const o={"purchase-order":{action:"created",description:'Orden de Compra "'.concat(a.description,'" creada'),details:{poId:a.id,description:a.description,amount:a.amount,supplier:a.supplier}},advance:{action:"created",description:'Anticipo "'.concat(a.description,'" creado'),details:{advanceId:a.id,description:a.description,amount:a.amount,recipient:a.recipient}},invoice:{action:"created",description:'Factura "'.concat(a.description,'" creada'),details:{invoiceId:a.id,description:a.description,amount:a.amount,supplier:a.supplier}},contract:{action:"created",description:'Contrato "'.concat(a.name,'" creado'),details:{contractId:a.id,name:a.name,value:a.value,contractor:a.contractor}}}[e];o&&l({category:"financial",action:o.action,description:o.description,details:o.details,severity:"high",user:t.manager||"Sistema"})},[l]),b=(0,r.useCallback)((e,a)=>{l({category:"resources",action:"assigned",description:"Recurso asignado al proyecto",details:{assignmentId:e.id,resourceId:e.resourceId,role:e.role,allocation:e.allocation},severity:"medium",user:a.manager||"Sistema"})},[l]),y=(0,r.useCallback)((e,a)=>{l({category:"minutes",action:"minute-task-created",description:'Tarea de minuta "'.concat(e.tarea,'" creada'),details:{taskId:e.id,tarea:e.tarea,responsable:e.responsable,fecha:e.fecha,hitoId:e.hitoId,estatus:e.estatus},severity:"medium",user:a.manager||"Sistema"})},[l]),v=(0,r.useCallback)((e,a,t)=>{l({category:"minutes",action:"minute-task-updated",description:'Tarea de minuta "'.concat(e.tarea,'" actualizada'),details:{taskId:e.id,tarea:e.tarea,changes:a,newStatus:e.estatus},severity:"medium",user:t.manager||"Sistema"})},[l]),f=(0,r.useCallback)(()=>{n([]),localStorage.removeItem("audit-log-".concat(e))},[e]),S=(0,r.useCallback)(()=>{const a={projectId:e,exportDate:(new Date).toISOString(),totalEvents:i.length,events:i},t=JSON.stringify(a,null,2),o=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(o),n=document.createElement("a");n.href=r,n.download="audit-log-".concat(e,"-").concat((new Date).toISOString().split("T")[0],".json"),n.click(),URL.revokeObjectURL(r)},[i,e]);return{auditLog:i,isLoading:c,addAuditEvent:l,logProjectStatusChange:g,logWorkPackageCreated:p,logWorkPackageModified:m,logRiskCreated:h,logFinancialEvent:k,logResourceAssignment:b,logMinutaTaskCreated:y,logMinutaTaskUpdated:v,clearAuditLog:f,exportAuditLog:S}}}}]);
/*! For license information please see 297.5e396d42.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[297],{1678:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var s=a(9950),r=a(7306),n=a(5924),o=a(3081),l=a(9284),d=a(4267),i=a(3769),c=a(9975),x=a(9201),m=a(1946);const u=(0,a(6230).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);var p=a(4867),h=a(4414);const g=()=>{var e,t,a,g,y;const{orgId:b}=(0,r.g)(),v=(0,r.Zp)(),[j,f]=(0,s.useState)(null),[N,w]=(0,s.useState)(null),[_,k]=(0,s.useState)(!0),[A,z]=(0,s.useState)("overview");(0,s.useEffect)(()=>{M()},[b]);const M=async()=>{k(!0);try{const[e,t]=await Promise.all([p.A.getOrganizationDetails(b),p.A.getOrganizationMetrics(b)]);e.data&&f(e.data),t&&w(t)}catch(e){console.error("Error cargando datos:",e),alert("Error al cargar los datos de la organizaci\xf3n")}finally{k(!1)}},C=e=>{let{title:t,value:a,icon:s,color:r}=e;return(0,h.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:t}),(0,h.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a})]}),(0,h.jsx)("div",{className:"p-3 rounded-lg bg-gradient-to-r ".concat(r),children:(0,h.jsx)(s,{className:"w-5 h-5 text-white"})})]})})};return _?(0,h.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,h.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}):j?(0,h.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,h.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,h.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,h.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,h.jsx)("button",{onClick:()=>v("/admin"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,h.jsx)(o.A,{className:"w-5 h-5 text-gray-600"})}),(0,h.jsx)(l.A,{className:"w-8 h-8 text-purple-600"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:j.name}),(0,h.jsxs)("p",{className:"text-sm text-gray-500",children:["ID: ",j.id]})]})]}),(0,h.jsxs)("div",{className:"flex space-x-4 border-b border-gray-200",children:[(0,h.jsx)("button",{onClick:()=>z("overview"),className:"px-4 py-2 border-b-2 font-medium text-sm transition-colors ".concat("overview"===A?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"Vista General"}),(0,h.jsxs)("button",{onClick:()=>z("members"),className:"px-4 py-2 border-b-2 font-medium text-sm transition-colors ".concat("members"===A?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"),children:["Miembros (",(null===(e=j.members)||void 0===e?void 0:e.length)||0,")"]}),(0,h.jsxs)("button",{onClick:()=>z("projects"),className:"px-4 py-2 border-b-2 font-medium text-sm transition-colors ".concat("projects"===A?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"),children:["Proyectos (",(null===(t=j.projects)||void 0===t?void 0:t.length)||0,")"]})]})]})}),(0,h.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:["overview"===A&&(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,h.jsx)(C,{title:"Proyectos",value:(null===N||void 0===N?void 0:N.projectsCount)||0,icon:d.A,color:"from-blue-600 to-cyan-600"}),(0,h.jsx)(C,{title:"Tareas",value:(null===N||void 0===N?void 0:N.tasksCount)||0,icon:i.A,color:"from-green-600 to-emerald-600"}),(0,h.jsx)(C,{title:"Miembros Activos",value:(null===N||void 0===N?void 0:N.activeMembersCount)||0,icon:c.A,color:"from-purple-600 to-indigo-600"}),(0,h.jsx)(C,{title:"Riesgos",value:(null===N||void 0===N?void 0:N.risksCount)||0,icon:n.A,color:"from-orange-600 to-red-600"})]}),(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:[(0,h.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Informaci\xf3n General"}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,h.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,h.jsx)(x.A,{className:"w-5 h-5 text-gray-400 mt-0.5"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-sm text-gray-600",children:"Fecha de Creaci\xf3n"}),(0,h.jsx)("p",{className:"text-sm font-medium text-gray-900",children:new Date(j.created_at).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric"})})]})]}),(0,h.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,h.jsx)(m.A,{className:"w-5 h-5 text-gray-400 mt-0.5"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-sm text-gray-600",children:"Owner ID"}),(0,h.jsx)("p",{className:"text-sm font-medium text-gray-900 font-mono text-xs",children:j.owner_id||"N/A"})]})]})]})]})]}),"members"===A&&(0,h.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,h.jsx)("thead",{className:"bg-gray-50",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Usuario"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Rol"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha de Ingreso"})]})}),(0,h.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:null===(a=j.members)||void 0===a?void 0:a.map(e=>{return(0,h.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,h.jsx)("td",{className:"px-6 py-4",children:(0,h.jsxs)("div",{className:"flex items-center",children:[(0,h.jsx)(u,{className:"w-4 h-4 text-gray-400 mr-2"}),(0,h.jsx)("span",{className:"text-sm text-gray-900",children:e.user_email})]})}),(0,h.jsx)("td",{className:"px-6 py-4",children:(0,h.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat((a=e.role,{owner:"bg-purple-100 text-purple-800",admin:"bg-blue-100 text-blue-800",organization_member_write:"bg-green-100 text-green-800",organization_member_read:"bg-gray-100 text-gray-800"}[a]||"bg-gray-100 text-gray-800")),children:e.role})}),(0,h.jsx)("td",{className:"px-6 py-4",children:(0,h.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat((t=e.status,{active:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",inactive:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800")),children:e.status})}),(0,h.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.accepted_at?new Date(e.accepted_at).toLocaleDateString("es-MX"):e.invited_at?"Invitado: ".concat(new Date(e.invited_at).toLocaleDateString("es-MX")):"N/A"})]},e.id);var t,a})})]})})}),"projects"===A&&(0,h.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,h.jsx)("thead",{className:"bg-gray-50",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Proyecto"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Manager"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Progreso"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fechas"})]})}),(0,h.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===(null===(g=j.projects)||void 0===g?void 0:g.length)?(0,h.jsx)("tr",{children:(0,h.jsxs)("td",{colSpan:"5",className:"px-6 py-12 text-center",children:[(0,h.jsx)(d.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,h.jsx)("p",{className:"text-gray-500",children:"No hay proyectos en esta organizaci\xf3n"})]})}):null===(y=j.projects)||void 0===y?void 0:y.map(e=>{return(0,h.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,h.jsxs)("td",{className:"px-6 py-4",children:[(0,h.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,h.jsxs)("div",{className:"text-xs text-gray-500",children:[e.id.substring(0,8),"..."]})]}),(0,h.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.manager||"N/A"}),(0,h.jsx)("td",{className:"px-6 py-4",children:(0,h.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat((t=e.status,{active:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800","on-hold":"bg-yellow-100 text-yellow-800",cancelled:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800")),children:e.status})}),(0,h.jsx)("td",{className:"px-6 py-4",children:(0,h.jsxs)("div",{className:"flex items-center",children:[(0,h.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-2 mr-2",children:(0,h.jsx)("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:"".concat(e.progress||0,"%")}})}),(0,h.jsxs)("span",{className:"text-sm text-gray-600",children:[e.progress||0,"%"]})]})}),(0,h.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.start_date&&e.end_date?(0,h.jsxs)("div",{className:"text-xs",children:[(0,h.jsx)("div",{children:new Date(e.start_date).toLocaleDateString("es-MX")}),(0,h.jsx)("div",{children:new Date(e.end_date).toLocaleDateString("es-MX")})]}):"N/A"})]},e.id);var t})})]})})})]})]}):(0,h.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,h.jsxs)("div",{className:"text-center",children:[(0,h.jsx)(n.A,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),(0,h.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Organizaci\xf3n no encontrada"}),(0,h.jsx)("button",{onClick:()=>v("/admin"),className:"mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Volver al Panel"})]})})}},1946:(e,t,a)=>{a.d(t,{A:()=>s});const s=(0,a(6230).A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},3081:(e,t,a)=>{a.d(t,{A:()=>s});const s=(0,a(6230).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3769:(e,t,a)=>{a.d(t,{A:()=>s});const s=(0,a(6230).A)("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},4267:(e,t,a)=>{a.d(t,{A:()=>s});const s=(0,a(6230).A)("folder-kanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]])},4867:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(9379),r=a(8103);const n=new class{async isSuperAdmin(){try{const e=r.default.getCurrentUser();if(!e)return!1;const{data:t}=await r.default.supabase.from("super_admins").select("id").eq("user_id",e.id).single();if(t)return!0;const{data:a}=await r.default.supabase.from("user_organization_roles").select("role").eq("user_id",e.id).eq("role","super_admin").single();return null!==a}catch(e){return console.error("Error verificando super-admin:",e),!1}}async listAllOrganizations(){try{const{data:e,error:t}=await r.default.supabase.from("organizations").select("\n          *,\n          members_count:organization_members(count),\n          projects_count:projects(count)\n        ").order("created_at",{ascending:!1});if(t)throw t;return{data:null===e||void 0===e?void 0:e.map(e=>{var t,a,r,n;return(0,s.A)((0,s.A)({},e),{},{member_count:(null===(t=e.members_count)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.count)||0,project_count:(null===(r=e.projects_count)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.count)||0})}),error:null}}catch(e){return console.error("Error listando organizaciones:",e),{data:null,error:e}}}async getOrganizationDetails(e){try{const{data:t,error:a}=await r.default.supabase.from("organizations").select("\n          *,\n          members:organization_members(\n            id,\n            user_email,\n            user_id,\n            role,\n            status,\n            invited_at,\n            accepted_at,\n            created_at\n          ),\n          projects:projects(\n            id,\n            name,\n            status,\n            progress,\n            manager,\n            start_date,\n            end_date,\n            budget\n          )\n        ").eq("id",e).single();if(a)throw a;return{data:t,error:null}}catch(t){return console.error("Error obteniendo detalles:",t),{data:null,error:t}}}async getOrganizationMetrics(e){try{const[t,a,s,n]=await Promise.all([r.default.supabase.from("projects").select("id",{count:"exact",head:!0}).eq("organization_id",e),r.default.supabase.from("tasks").select("id",{count:"exact",head:!0}),r.default.supabase.from("organization_members").select("id",{count:"exact",head:!0}).eq("organization_id",e).eq("status","active"),r.default.supabase.from("risks").select("id",{count:"exact",head:!0})]);return{projectsCount:t.count||0,tasksCount:a.count||0,activeMembersCount:s.count||0,risksCount:n.count||0}}catch(t){return console.error("Error obteniendo m\xe9tricas:",t),{projectsCount:0,tasksCount:0,activeMembersCount:0,risksCount:0}}}async getGlobalStats(){try{var e;const{data:t,error:a}=await r.default.supabase.rpc("get_super_admin_stats");if(a&&"42883"!==a.code)throw a;if(t)return t;const[s,n,o,l]=await Promise.all([r.default.supabase.from("organizations").select("*"),r.default.supabase.from("projects").select("id",{count:"exact",head:!0}),r.default.supabase.from("tasks").select("id",{count:"exact",head:!0}),r.default.supabase.from("organization_members").select("id",{count:"exact",head:!0})]);return{total_organizations:(null===(e=s.data)||void 0===e?void 0:e.length)||0,total_projects:n.count||0,total_tasks:o.count||0,active_members:l.count||0,organizations_by_status:s.data||[]}}catch(t){return console.error("Error obteniendo estad\xedsticas globales:",t),{total_organizations:0,total_projects:0,total_tasks:0,active_members:0,organizations_by_status:[]}}}async updateOrganization(e,t){try{const{data:a,error:n}=await r.default.supabase.from("organizations").update((0,s.A)((0,s.A)({},t),{},{updated_at:(new Date).toISOString()})).eq("id",e).select().single();if(n)throw n;return{data:a,error:null}}catch(a){return console.error("Error actualizando organizaci\xf3n:",a),{data:null,error:a}}}async deleteOrganization(e){try{const{error:t}=await r.default.supabase.from("organizations").delete().eq("id",e);if(t)throw t;return{error:null}}catch(t){return console.error("Error eliminando organizaci\xf3n:",t),{error:t}}}}},9201:(e,t,a)=>{a.d(t,{A:()=>s});const s=(0,a(6230).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},9284:(e,t,a)=>{a.d(t,{A:()=>s});const s=(0,a(6230).A)("building-2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},9975:(e,t,a)=>{a.d(t,{A:()=>s});const s=(0,a(6230).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])}}]);
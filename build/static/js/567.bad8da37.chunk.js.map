{"version":3,"file":"static/js/567.bad8da37.chunk.js","mappings":"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","sources":["utils/businessValueCalculator.js","hooks/useAuditLog.js"],"sourcesContent":["/**\n * Utilidades para calcular valor de negocio basado en TIR y prioridad\n * Sistema h√≠brido: c√°lculo autom√°tico + ajuste manual\n */\n\n/**\n * Calcula el valor planificado total del proyecto basado en TIR\n * @param {number} budget - Presupuesto/inversi√≥n del proyecto\n * @param {number} irr - TIR del proyecto (en formato 0-100, ej: 25.5 = 25.5%)\n * @param {number} period - Periodo en a√±os (default: 3)\n * @returns {number} Valor planificado total del proyecto\n */\nexport const calculatePlannedValueFromIRR = (budget, irr, period = 3) => {\n  if (!budget || budget <= 0) return 0;\n  if (!irr || irr <= 0) return budget; // Si no hay TIR, valor = presupuesto\n\n  // Convertir TIR de porcentaje (25.5) a decimal (0.255)\n  const irrDecimal = irr / 100;\n\n  // F√≥rmula: Valor Futuro = Inversi√≥n √ó (1 + TIR)^per√≠odo\n  const valorFuturo = budget * Math.pow(1 + irrDecimal, period);\n\n  return Math.round(valorFuturo);\n};\n\n/**\n * Mapea prioridad de texto/c√≥digo a peso num√©rico\n * @param {string} priority - \"critical\"/\"Cr√≠tica\", \"high\"/\"Alta\", \"medium\"/\"Media\", \"low\"/\"Baja\"\n * @returns {number} Peso de criticidad\n */\nexport const getPriorityWeight = (priority) => {\n  // Normalizar a lowercase para comparaci√≥n\n  const normalizedPriority = (priority || '').toLowerCase();\n\n  const weights = {\n    'critical': 2.0,  // Cr√≠tica\n    'cr√≠tica': 2.0,\n    'high': 1.5,      // Alta\n    'alta': 1.5,\n    'medium': 1.0,    // Media\n    'media': 1.0,\n    'low': 0.5,       // Baja\n    'baja': 0.5\n  };\n\n  return weights[normalizedPriority] || 1.0; // Default: Media\n};\n\n/**\n * Calcula el valor de negocio de UNA tarea de forma proporcional\n * Esta funci√≥n requiere conocer TODAS las tareas del proyecto para distribuir correctamente\n *\n * @param {number} taskCost - Costo de la tarea actual\n * @param {string} taskPriority - Prioridad de la tarea actual\n * @param {number} projectPlannedValue - Valor planificado total del proyecto\n * @param {Array} allTasks - Array de TODAS las tareas del proyecto\n * @returns {number} Valor de negocio sugerido para esta tarea\n */\nexport const calculateTaskBusinessValue = (\n  taskCost,\n  taskPriority,\n  projectPlannedValue,\n  allTasks = []\n) => {\n  if (!taskCost || taskCost <= 0) return 0;\n  if (!projectPlannedValue || projectPlannedValue <= 0) return taskCost; // Fallback: valor = costo\n\n  // Calcular peso de esta tarea\n  const taskWeight = getPriorityWeight(taskPriority);\n  const taskWeightedCost = taskCost * taskWeight;\n\n  // Calcular peso total de TODAS las tareas\n  const totalWeightedCost = allTasks.reduce((sum, task) => {\n    const cost = task.cost || 0;\n    const weight = getPriorityWeight(task.priority);\n    return sum + (cost * weight);\n  }, 0);\n\n  // Si no hay tareas o peso total es 0, usar proporci√≥n simple por costo\n  if (totalWeightedCost === 0) {\n    const totalCost = allTasks.reduce((sum, task) => sum + (task.cost || 0), 0);\n    if (totalCost === 0) return projectPlannedValue; // Una sola tarea sin costo\n    return Math.round(projectPlannedValue * (taskCost / totalCost));\n  }\n\n  // Calcular proporci√≥n de esta tarea\n  const proportion = taskWeightedCost / totalWeightedCost;\n\n  // Calcular valor de negocio\n  const businessValue = projectPlannedValue * proportion;\n\n  return Math.round(businessValue);\n};\n\n/**\n * Calcula el valor de negocio de TODAS las tareas de un proyecto\n * Asegura que la suma de todos los businessValue = plannedValue del proyecto\n *\n * @param {Array} tasks - Array de tareas con {cost, priority}\n * @param {number} projectPlannedValue - Valor planificado del proyecto\n * @returns {Array} Array de tareas con businessValue calculado\n */\nexport const calculateAllTasksBusinessValue = (tasks, projectPlannedValue) => {\n  if (!Array.isArray(tasks) || tasks.length === 0) return [];\n  if (!projectPlannedValue || projectPlannedValue <= 0) {\n    // Si no hay valor planificado, asignar valor = costo\n    return tasks.map(task => ({\n      ...task,\n      businessValue: task.cost || 0\n    }));\n  }\n\n  // Calcular peso total\n  const totalWeightedCost = tasks.reduce((sum, task) => {\n    const cost = task.cost || 0;\n    const weight = getPriorityWeight(task.priority);\n    return sum + (cost * weight);\n  }, 0);\n\n  if (totalWeightedCost === 0) {\n    // Si todas las tareas tienen costo 0, distribuir equitativamente\n    const valuePerTask = Math.round(projectPlannedValue / tasks.length);\n    return tasks.map(task => ({\n      ...task,\n      businessValue: valuePerTask\n    }));\n  }\n\n  // Calcular businessValue para cada tarea\n  let remainingValue = projectPlannedValue;\n  const tasksWithValue = tasks.map((task, index) => {\n    const cost = task.cost || 0;\n    const weight = getPriorityWeight(task.priority);\n    const weightedCost = cost * weight;\n    const proportion = weightedCost / totalWeightedCost;\n\n    let businessValue;\n\n    // Para la √∫ltima tarea, asignar el valor restante para evitar errores de redondeo\n    if (index === tasks.length - 1) {\n      businessValue = remainingValue;\n    } else {\n      businessValue = Math.round(projectPlannedValue * proportion);\n      remainingValue -= businessValue;\n    }\n\n    return {\n      ...task,\n      businessValue: Math.max(0, businessValue) // Asegurar que no sea negativo\n    };\n  });\n\n  return tasksWithValue;\n};\n\n/**\n * Calcula el valor de negocio entregado por una tarea\n * @param {number} businessValue - Valor de negocio total de la tarea\n * @param {number} progress - Progreso de la tarea (0-100)\n * @returns {number} Valor de negocio entregado\n */\nexport const calculateDeliveredValue = (businessValue, progress) => {\n  if (!businessValue || businessValue <= 0) return 0;\n  if (!progress || progress <= 0) return 0;\n  if (progress >= 100) return businessValue;\n\n  return Math.round((businessValue * progress) / 100);\n};\n\n/**\n * Valida si el valor planificado del proyecto cuadra con la suma de valores de tareas\n * @param {number} plannedValue - Valor planificado del proyecto\n * @param {Array} tasks - Array de tareas con businessValue\n * @returns {object} { isValid, difference, percentageDiff, totalTasksValue, plannedValue }\n */\nexport const validatePlannedValue = (plannedValue, tasks) => {\n  const totalTasksValue = tasks.reduce((sum, task) => sum + (task.businessValue || 0), 0);\n  const difference = totalTasksValue - plannedValue;\n  const percentageDiff = plannedValue > 0 ? (difference / plannedValue) * 100 : 0;\n\n  // Se considera v√°lido si la diferencia es menor al 5%\n  const isValid = Math.abs(percentageDiff) <= 5;\n\n  return {\n    isValid,\n    difference,\n    percentageDiff: Math.round(percentageDiff * 100) / 100,\n    totalTasksValue,\n    plannedValue\n  };\n};\n\n/**\n * Recalcula autom√°ticamente el businessValue de todas las tareas\n * basado en cambios en costos, prioridades o plannedValue del proyecto\n *\n * @param {Array} tasks - Array de tareas actuales\n * @param {number} projectPlannedValue - Valor planificado del proyecto\n * @param {Array} tasksToRecalculate - IDs de tareas que NO deben recalcularse (fueron editadas manualmente)\n * @returns {Array} Array de tareas con businessValue actualizado\n */\nexport const smartRecalculateBusinessValue = (\n  tasks,\n  projectPlannedValue,\n  tasksToKeep = []\n) => {\n  if (!Array.isArray(tasks) || tasks.length === 0) return [];\n\n  // Separar tareas que mantienen su valor manual vs tareas a recalcular\n  const tasksToKeepManual = tasks.filter(t => tasksToKeep.includes(t.id));\n  const tasksToRecalculate = tasks.filter(t => !tasksToKeep.includes(t.id));\n\n  if (tasksToRecalculate.length === 0) {\n    // Todas las tareas son manuales, no recalcular nada\n    return tasks;\n  }\n\n  // Valor ya asignado manualmente\n  const manualValue = tasksToKeepManual.reduce((sum, t) => sum + (t.businessValue || 0), 0);\n\n  // Valor disponible para distribuir entre tareas a recalcular\n  const remainingValue = Math.max(0, projectPlannedValue - manualValue);\n\n  // Recalcular solo las tareas no-manuales\n  const recalculatedTasks = calculateAllTasksBusinessValue(tasksToRecalculate, remainingValue);\n\n  // Combinar tareas manuales + recalculadas\n  const allTasks = [...tasksToKeepManual, ...recalculatedTasks];\n\n  // Ordenar por ID original para mantener orden\n  allTasks.sort((a, b) => {\n    const indexA = tasks.findIndex(t => t.id === a.id);\n    const indexB = tasks.findIndex(t => t.id === b.id);\n    return indexA - indexB;\n  });\n\n  return allTasks;\n};\n\n/**\n * Obtiene informaci√≥n descriptiva de una prioridad\n * @param {string} priority - C√≥digo de prioridad\n * @returns {object} { label, weight, color }\n */\nexport const getPriorityInfo = (priority) => {\n  const normalized = (priority || '').toLowerCase();\n\n  const info = {\n    'critical': { label: 'Cr√≠tica', weight: 2.0, color: 'red' },\n    'cr√≠tica': { label: 'Cr√≠tica', weight: 2.0, color: 'red' },\n    'high': { label: 'Alta', weight: 1.5, color: 'orange' },\n    'alta': { label: 'Alta', weight: 1.5, color: 'orange' },\n    'medium': { label: 'Media', weight: 1.0, color: 'yellow' },\n    'media': { label: 'Media', weight: 1.0, color: 'yellow' },\n    'low': { label: 'Baja', weight: 0.5, color: 'green' },\n    'baja': { label: 'Baja', weight: 0.5, color: 'green' }\n  };\n\n  return info[normalized] || { label: 'Media', weight: 1.0, color: 'yellow' };\n};\n","import { useState, useEffect, useCallback } from 'react';\n\nconst useAuditLog = (projectId, useSupabase = false) => {\n  const [auditLog, setAuditLog] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Cargar log de auditor√≠a desde localStorage o Supabase\n  useEffect(() => {\n    const loadAuditLog = async () => {\n      if (!projectId) return;\n      \n      setIsLoading(true);\n      \n      try {\n        if (useSupabase) {\n          // Cargar desde Supabase usando los nuevos m√©todos\n          const { default: supabaseService } = await import('../services/SupabaseService');\n          if (supabaseService.isAuthenticated()) {\n            const result = await supabaseService.loadAuditEvents(projectId);\n            if (result.success) {\n              setAuditLog(result.events);\n              console.log(`‚úÖ Logs de auditor√≠a cargados desde Supabase para proyecto ${projectId}: ${result.events.length} eventos`);\n            } else {\n              // Fallback a localStorage si Supabase falla\n              const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n              if (savedLog) {\n                setAuditLog(JSON.parse(savedLog));\n              } else {\n                setAuditLog([]);\n              }\n            }\n          } else {\n            // Fallback a localStorage si no hay autenticaci√≥n\n            const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n            if (savedLog) {\n              setAuditLog(JSON.parse(savedLog));\n            } else {\n              setAuditLog([]);\n            }\n          }\n        } else {\n          // Cargar desde localStorage\n          const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n          if (savedLog) {\n            setAuditLog(JSON.parse(savedLog));\n          } else {\n            setAuditLog([]);\n          }\n        }\n      } catch (error) {\n        console.error('Error loading audit log:', error);\n        // Fallback a localStorage en caso de error\n        const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n        if (savedLog) {\n          setAuditLog(JSON.parse(savedLog));\n        }\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadAuditLog();\n  }, [projectId, useSupabase]);\n\n  // Guardar log de auditor√≠a en localStorage y/o Supabase\n  const saveAuditLog = useCallback(async (log) => {\n    // Siempre guardar en localStorage como backup\n    localStorage.setItem(`audit-log-${projectId}`, JSON.stringify(log));\n\n    // NOTA: La sincronizaci√≥n con Supabase se hace individualmente por evento\n    // No enviamos toda la lista para evitar duplicados\n    console.log(`üìã Logs de auditor√≠a guardados en localStorage para proyecto ${projectId}: ${log.length} eventos`);\n  }, [projectId]);\n\n  // Guardar un evento individual en Supabase\n  const saveEventToSupabase = useCallback(async (event) => {\n    if (!useSupabase) return;\n\n    try {\n      const { default: supabaseService } = await import('../services/SupabaseService');\n      if (supabaseService.isAuthenticated()) {\n        // Guardar solo este evento espec√≠fico\n        const result = await supabaseService.saveAuditEvents(projectId, [event]);\n        if (result.success) {\n          console.log(`‚úÖ Evento de auditor√≠a guardado en Supabase: ${event.action}`);\n        } else {\n          console.warn('‚ö†Ô∏è Error guardando evento en Supabase:', result.error);\n        }\n      }\n    } catch (error) {\n      console.error('Error guardando evento en Supabase:', error);\n    }\n  }, [projectId, useSupabase]);\n\n  // Agregar evento de auditor√≠a\n  const addAuditEvent = useCallback(async (event) => {\n    const newEvent = {\n      id: crypto.randomUUID(), // Generar UUID v√°lido para Supabase\n      timestamp: new Date().toISOString(),\n      projectId,\n      ...event\n    };\n\n    setAuditLog(prevLog => {\n      const updatedLog = [newEvent, ...prevLog];\n      // Guardar de forma as√≠ncrona en localStorage\n      saveAuditLog(updatedLog);\n      return updatedLog;\n    });\n\n    // Guardar este evento espec√≠fico en Supabase\n    saveEventToSupabase(newEvent);\n\n    return newEvent;\n  }, [projectId, saveAuditLog, saveEventToSupabase]);\n\n  // Registrar cambio de estado del proyecto\n  const logProjectStatusChange = useCallback((previousStatus, newStatus, projectData) => {\n    addAuditEvent({\n      category: 'project-status',\n      action: 'status-changed',\n      description: `Estado del proyecto cambiado de \"${previousStatus}\" a \"${newStatus}\"`,\n      details: {\n        previousStatus,\n        newStatus,\n        projectName: projectData.name,\n        manager: projectData.manager,\n        budget: projectData.budget\n      },\n      severity: 'high',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar creaci√≥n de work package\n  const logWorkPackageCreated = useCallback((workPackage, projectData) => {\n    addAuditEvent({\n      category: 'work-package',\n      action: 'created',\n      description: `Work Package \"${workPackage.name}\" creado`,\n      details: {\n        workPackageId: workPackage.id,\n        name: workPackage.name,\n        budget: workPackage.budget,\n        status: workPackage.status\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar modificaci√≥n de work package\n  const logWorkPackageModified = useCallback((workPackage, changes, projectData) => {\n    addAuditEvent({\n      category: 'work-package',\n      action: 'modified',\n      description: `Work Package \"${workPackage.name}\" modificado`,\n      details: {\n        workPackageId: workPackage.id,\n        name: workPackage.name,\n        changes: Object.keys(changes),\n        previousValues: changes\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar creaci√≥n de riesgo\n  const logRiskCreated = useCallback((risk, projectData) => {\n    addAuditEvent({\n      category: 'risk',\n      action: 'created',\n      description: `Riesgo \"${risk.name}\" identificado`,\n      details: {\n        riskId: risk.id,\n        name: risk.name,\n        probability: risk.probability,\n        impact: risk.impact,\n        priority: risk.priority\n      },\n      severity: risk.priority === 'high' ? 'high' : 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar evento financiero\n  const logFinancialEvent = useCallback((type, item, projectData) => {\n    const eventMap = {\n      'purchase-order': {\n        action: 'created',\n        description: `Orden de Compra \"${item.description}\" creada`,\n        details: {\n          poId: item.id,\n          description: item.description,\n          amount: item.amount,\n          supplier: item.supplier\n        }\n      },\n      'advance': {\n        action: 'created',\n        description: `Anticipo \"${item.description}\" creado`,\n        details: {\n          advanceId: item.id,\n          description: item.description,\n          amount: item.amount,\n          recipient: item.recipient\n        }\n      },\n      'invoice': {\n        action: 'created',\n        description: `Factura \"${item.description}\" creada`,\n        details: {\n          invoiceId: item.id,\n          description: item.description,\n          amount: item.amount,\n          supplier: item.supplier\n        }\n      },\n      'contract': {\n        action: 'created',\n        description: `Contrato \"${item.name}\" creado`,\n        details: {\n          contractId: item.id,\n          name: item.name,\n          value: item.value,\n          contractor: item.contractor\n        }\n      }\n    };\n\n    const eventConfig = eventMap[type];\n    if (eventConfig) {\n      addAuditEvent({\n        category: 'financial',\n        action: eventConfig.action,\n        description: eventConfig.description,\n        details: eventConfig.details,\n        severity: 'high',\n        user: projectData.manager || 'Sistema'\n      });\n    }\n  }, [addAuditEvent]);\n\n  // Registrar asignaci√≥n de recursos\n  const logResourceAssignment = useCallback((assignment, projectData) => {\n    addAuditEvent({\n      category: 'resources',\n      action: 'assigned',\n      description: `Recurso asignado al proyecto`,\n      details: {\n        assignmentId: assignment.id,\n        resourceId: assignment.resourceId,\n        role: assignment.role,\n        allocation: assignment.allocation\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar creaci√≥n de tarea de minuta\n  const logMinutaTaskCreated = useCallback((minutaTask, projectData) => {\n    addAuditEvent({\n      category: 'minutes',\n      action: 'minute-task-created',\n      description: `Tarea de minuta \"${minutaTask.tarea}\" creada`,\n      details: {\n        taskId: minutaTask.id,\n        tarea: minutaTask.tarea,\n        responsable: minutaTask.responsable,\n        fecha: minutaTask.fecha,\n        hitoId: minutaTask.hitoId,\n        estatus: minutaTask.estatus\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar actualizaci√≥n de tarea de minuta\n  const logMinutaTaskUpdated = useCallback((minutaTask, changes, projectData) => {\n    addAuditEvent({\n      category: 'minutes',\n      action: 'minute-task-updated',\n      description: `Tarea de minuta \"${minutaTask.tarea}\" actualizada`,\n      details: {\n        taskId: minutaTask.id,\n        tarea: minutaTask.tarea,\n        changes: changes,\n        newStatus: minutaTask.estatus\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Limpiar log de auditor√≠a\n  const clearAuditLog = useCallback(() => {\n    setAuditLog([]);\n    localStorage.removeItem(`audit-log-${projectId}`);\n  }, [projectId]);\n\n  // Exportar log de auditor√≠a\n  const exportAuditLog = useCallback(() => {\n    const exportData = {\n      projectId,\n      exportDate: new Date().toISOString(),\n      totalEvents: auditLog.length,\n      events: auditLog\n    };\n\n    const dataStr = JSON.stringify(exportData, null, 2);\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\n    \n    const url = URL.createObjectURL(dataBlob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `audit-log-${projectId}-${new Date().toISOString().split('T')[0]}.json`;\n    link.click();\n    URL.revokeObjectURL(url);\n  }, [auditLog, projectId]);\n\n  return {\n    auditLog,\n    isLoading,\n    addAuditEvent,\n    logProjectStatusChange,\n    logWorkPackageCreated,\n    logWorkPackageModified,\n    logRiskCreated,\n    logFinancialEvent,\n    logResourceAssignment,\n    logMinutaTaskCreated,\n    logMinutaTaskUpdated,\n    clearAuditLog,\n    exportAuditLog\n  };\n};\n\nexport default useAuditLog;\n"],"names":["getPriorityWeight","priority","toLowerCase","calculateTaskBusinessValue","taskCost","taskPriority","projectPlannedValue","allTasks","arguments","length","undefined","taskWeightedCost","totalWeightedCost","reduce","sum","task","cost","totalCost","Math","round","businessValue","calculateAllTasksBusinessValue","tasks","Array","isArray","map","_objectSpread","valuePerTask","remainingValue","index","proportion","max","validatePlannedValue","plannedValue","totalTasksValue","difference","percentageDiff","isValid","abs","projectId","useSupabase","auditLog","setAuditLog","useState","isLoading","setIsLoading","useEffect","async","default","supabaseService","isAuthenticated","result","loadAuditEvents","success","events","console","log","concat","savedLog","localStorage","getItem","JSON","parse","error","loadAuditLog","saveAuditLog","useCallback","setItem","stringify","saveEventToSupabase","saveAuditEvents","event","action","warn","addAuditEvent","newEvent","id","crypto","randomUUID","timestamp","Date","toISOString","prevLog","updatedLog","logProjectStatusChange","previousStatus","newStatus","projectData","category","description","details","projectName","name","manager","budget","severity","user","logWorkPackageCreated","workPackage","workPackageId","status","logWorkPackageModified","changes","Object","keys","previousValues","logRiskCreated","risk","riskId","probability","impact","logFinancialEvent","type","item","eventConfig","poId","amount","supplier","advanceId","recipient","invoiceId","contractId","value","contractor","logResourceAssignment","assignment","assignmentId","resourceId","role","allocation","logMinutaTaskCreated","minutaTask","tarea","taskId","responsable","fecha","hitoId","estatus","logMinutaTaskUpdated","clearAuditLog","removeItem","exportAuditLog","exportData","exportDate","totalEvents","dataStr","dataBlob","Blob","url","URL","createObjectURL","link","document","createElement","href","download","split","click","revokeObjectURL"],"sourceRoot":""}
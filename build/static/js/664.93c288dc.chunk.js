"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[521,664,902],{7902:(e,a,t)=>{t.d(a,{A:()=>i});var o=t(9379),c=t(9950);const i=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[i,n]=(0,c.useState)([]),[r,s]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{if(e){s(!0);try{if(a){const{default:a}=await Promise.resolve().then(t.bind(t,9874));if(a.isAuthenticated()){const t=await a.loadAuditEvents(e);if(t.success)n(t.events),console.log("\u2705 Logs de auditor\xeda cargados desde Supabase para proyecto ".concat(e,": ").concat(t.events.length," eventos"));else{const a=localStorage.getItem("audit-log-".concat(e));n(a?JSON.parse(a):[])}}else{const a=localStorage.getItem("audit-log-".concat(e));n(a?JSON.parse(a):[])}}else{const a=localStorage.getItem("audit-log-".concat(e));n(a?JSON.parse(a):[])}}catch(o){console.error("Error loading audit log:",o);const a=localStorage.getItem("audit-log-".concat(e));a&&n(JSON.parse(a))}finally{s(!1)}}})()},[e,a]);const d=(0,c.useCallback)(async a=>{localStorage.setItem("audit-log-".concat(e),JSON.stringify(a)),console.log("\ud83d\udccb Logs de auditor\xeda guardados en localStorage para proyecto ".concat(e,": ").concat(a.length," eventos"))},[e]),l=(0,c.useCallback)(async o=>{if(a)try{const{default:a}=await Promise.resolve().then(t.bind(t,9874));if(a.isAuthenticated()){const t=await a.saveAuditEvents(e,[o]);t.success?console.log("\u2705 Evento de auditor\xeda guardado en Supabase: ".concat(o.action)):console.warn("\u26a0\ufe0f Error guardando evento en Supabase:",t.error)}}catch(c){console.error("Error guardando evento en Supabase:",c)}},[e,a]),u=(0,c.useCallback)(async a=>{const t=(0,o.A)({id:crypto.randomUUID(),timestamp:(new Date).toISOString(),projectId:e},a);return n(e=>{const a=[t,...e];return d(a),a}),l(t),t},[e,d,l]),g=(0,c.useCallback)((e,a,t)=>{u({category:"project-status",action:"status-changed",description:'Estado del proyecto cambiado de "'.concat(e,'" a "').concat(a,'"'),details:{previousStatus:e,newStatus:a,projectName:t.name,manager:t.manager,budget:t.budget},severity:"high",user:t.manager||"Sistema"})},[u]),m=(0,c.useCallback)((e,a)=>{u({category:"work-package",action:"created",description:'Work Package "'.concat(e.name,'" creado'),details:{workPackageId:e.id,name:e.name,budget:e.budget,status:e.status},severity:"medium",user:a.manager||"Sistema"})},[u]),p=(0,c.useCallback)((e,a,t)=>{u({category:"work-package",action:"modified",description:'Work Package "'.concat(e.name,'" modificado'),details:{workPackageId:e.id,name:e.name,changes:Object.keys(a),previousValues:a},severity:"medium",user:t.manager||"Sistema"})},[u]),k=(0,c.useCallback)((e,a)=>{u({category:"risk",action:"created",description:'Riesgo "'.concat(e.name,'" identificado'),details:{riskId:e.id,name:e.name,probability:e.probability,impact:e.impact,priority:e.priority},severity:"high"===e.priority?"high":"medium",user:a.manager||"Sistema"})},[u]),b=(0,c.useCallback)((e,a,t)=>{const o={"purchase-order":{action:"created",description:'Orden de Compra "'.concat(a.description,'" creada'),details:{poId:a.id,description:a.description,amount:a.amount,supplier:a.supplier}},advance:{action:"created",description:'Anticipo "'.concat(a.description,'" creado'),details:{advanceId:a.id,description:a.description,amount:a.amount,recipient:a.recipient}},invoice:{action:"created",description:'Factura "'.concat(a.description,'" creada'),details:{invoiceId:a.id,description:a.description,amount:a.amount,supplier:a.supplier}},contract:{action:"created",description:'Contrato "'.concat(a.name,'" creado'),details:{contractId:a.id,name:a.name,value:a.value,contractor:a.contractor}}}[e];o&&u({category:"financial",action:o.action,description:o.description,details:o.details,severity:"high",user:t.manager||"Sistema"})},[u]),y=(0,c.useCallback)((e,a)=>{u({category:"resources",action:"assigned",description:"Recurso asignado al proyecto",details:{assignmentId:e.id,resourceId:e.resourceId,role:e.role,allocation:e.allocation},severity:"medium",user:a.manager||"Sistema"})},[u]),S=(0,c.useCallback)((e,a)=>{u({category:"minutes",action:"minute-task-created",description:'Tarea de minuta "'.concat(e.tarea,'" creada'),details:{taskId:e.id,tarea:e.tarea,responsable:e.responsable,fecha:e.fecha,hitoId:e.hitoId,estatus:e.estatus},severity:"medium",user:a.manager||"Sistema"})},[u]),v=(0,c.useCallback)((e,a,t)=>{u({category:"minutes",action:"minute-task-updated",description:'Tarea de minuta "'.concat(e.tarea,'" actualizada'),details:{taskId:e.id,tarea:e.tarea,changes:a,newStatus:e.estatus},severity:"medium",user:t.manager||"Sistema"})},[u]),h=(0,c.useCallback)(()=>{n([]),localStorage.removeItem("audit-log-".concat(e))},[e]),I=(0,c.useCallback)(()=>{const a={projectId:e,exportDate:(new Date).toISOString(),totalEvents:i.length,events:i},t=JSON.stringify(a,null,2),o=new Blob([t],{type:"application/json"}),c=URL.createObjectURL(o),n=document.createElement("a");n.href=c,n.download="audit-log-".concat(e,"-").concat((new Date).toISOString().split("T")[0],".json"),n.click(),URL.revokeObjectURL(c)},[i,e]);return{auditLog:i,isLoading:r,addAuditEvent:u,logProjectStatusChange:g,logWorkPackageCreated:m,logWorkPackageModified:p,logRiskCreated:k,logFinancialEvent:b,logResourceAssignment:y,logMinutaTaskCreated:S,logMinutaTaskUpdated:v,clearAuditLog:h,exportAuditLog:I}}}}]);
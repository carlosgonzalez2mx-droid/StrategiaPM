"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[156],{8156:(e,s,t)=>{t.r(s),t.d(s,{default:()=>n});var a=t(5043),r=t(9555),l=t(5350),i=t(6877),o=t(579);const n=e=>{let{projectId:s,organizationId:t=null,category:n="general",relatedItemId:c=null,onFileUploaded:d=null,showUploadArea:x=!0,isContextual:m=!1,title:h="\ud83d\udcce Gesti\xf3n de Archivos"}=e;const{permissions:g}=(0,l.A)(),{files:p,isLoading:u,error:v,uploadFile:b,deleteFile:y,getFilesByCategory:f,getFilesByRelatedItem:j,searchFiles:N,getFileStats:w,fileLimits:k}=(0,r.A)(s),[C,D]=(0,a.useState)(!1),[S,F]=(0,a.useState)(""),[A,E]=(0,a.useState)(n),[M,z]=(0,a.useState)(!1),[B,T]=(0,a.useState)(""),[L,G]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{if(t)try{const e=await i.A.canEdit(t);G(!e.allowed)}catch(v){console.error("[READ-ONLY MODE] Error verificando permisos:",v),G(!1)}})()},[t]);const P=x&&g.canEdit&&!L,[I,O]=(0,a.useState)([]),[R,W]=(0,a.useState)("grid"),X=(0,a.useRef)(null),q=(0,a.useMemo)(()=>{let e=p;return console.log("\ud83d\udd0d FileManager - Filtrado:",{totalFiles:p.length,category:n,selectedCategory:A,isContextual:m,searchTerm:S}),"general"!==n&&m?(e=f(n),console.log("\ud83d\udcc2 Filtrado por categor\xeda contextual:",n,"archivos:",e.length)):"general"!==A&&(e=f(A),console.log("\ud83d\udcc2 Filtrado por categor\xeda seleccionada:",A,"archivos:",e.length)),c&&(e=j(c),console.log("\ud83d\udd17 Filtrado por item relacionado:",c,"archivos:",e.length)),S&&(e=N(S),console.log("\ud83d\udd0d Filtrado por b\xfasqueda:",S,"archivos:",e.length)),console.log("\u2705 Archivos finales filtrados:",e.length),e.sort((e,s)=>new Date(s.uploadDate)-new Date(e.uploadDate))},[p,n,A,c,S,m,f,j,N]),V=(0,a.useMemo)(()=>w(),[w]),_=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?D(!0):"dragleave"===e.type&&D(!1)},U=async e=>{O(Array.from(e)),z(!0)},J=e=>{const s=document.createElement("a");s.href=e.content,s.download=e.fileName,document.body.appendChild(s),s.click(),document.body.removeChild(s)},K=e=>{const s=e.mimeType||e.type||"";s.startsWith("image/")||"application/pdf"===s?window.open(e.content,"_blank"):J(e)},Y=e=>{const s=e.mimeType||e.type||"";return s.startsWith("image/")?"\ud83d\uddbc\ufe0f":"application/pdf"===s?"\ud83d\udcc4":s.includes("word")?"\ud83d\udcdd":s.includes("excel")?"\ud83d\udcca":"\ud83d\udcce"},H=e=>{const s=e.type||"";return s.startsWith("image/")?"\ud83d\uddbc\ufe0f":"application/pdf"===s?"\ud83d\udcc4":s.includes("word")?"\ud83d\udcdd":s.includes("excel")?"\ud83d\udcca":"\ud83d\udcce"},Q=e=>{const s=e.mimeType||e.type||"";return s.startsWith("image/")?"from-pink-500 to-rose-500":"application/pdf"===s?"from-red-500 to-pink-500":s.includes("word")?"from-blue-500 to-indigo-500":s.includes("excel")?"from-green-500 to-emerald-500":"from-gray-500 to-slate-500"},Z=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},$=[{id:"purchase-order",name:"\xd3rdenes de Compra",icon:"\ud83d\uded2",color:"bg-blue-100 text-blue-800"},{id:"invoice",name:"Facturas",icon:"\ud83e\uddfe",color:"bg-green-100 text-green-800"},{id:"advance",name:"Anticipos",icon:"\ud83d\udcb0",color:"bg-yellow-100 text-yellow-800"},{id:"contract",name:"Contratos",icon:"\ud83d\udccb",color:"bg-purple-100 text-purple-800"},{id:"risk-evidence",name:"Evidencia de Riesgos",icon:"\ud83d\udee1\ufe0f",color:"bg-red-100 text-red-800"},{id:"general",name:"General",icon:"\ud83d\udcc1",color:"bg-gray-100 text-gray-800"}],ee=$.find(e=>e.id===A);return(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)("div",{className:"bg-gradient-to-r from-slate-50 to-gray-50 rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,o.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,o.jsx)("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl text-white",children:(0,o.jsx)("span",{className:"text-2xl",children:"\ud83d\udcce"})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:h}),(0,o.jsx)("p",{className:"text-sm text-gray-600",children:m?"Archivos relacionados con este contexto":"Gesti\xf3n completa de documentos del proyecto"})]})]}),(0,o.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,o.jsxs)("div",{className:"text-right",children:[(0,o.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:V.totalFiles}),(0,o.jsx)("div",{className:"text-sm text-gray-600",children:"archivos"})]}),(0,o.jsxs)("div",{className:"text-right",children:[(0,o.jsxs)("div",{className:"text-lg font-semibold text-gray-800",children:[V.totalSizeMB,"MB"]}),(0,o.jsx)("div",{className:"text-xs text-gray-500",children:"total"})]}),P&&(0,o.jsxs)("button",{onClick:()=>{var e;return null===(e=X.current)||void 0===e?void 0:e.click()},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:[(0,o.jsx)("span",{className:"mr-2",children:"\ud83d\udce4"}),"Subir Archivos"]})]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,o.jsx)("div",{className:"lg:col-span-2",children:(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,o.jsx)("span",{className:"text-gray-400",children:"\ud83d\udd0d"})}),(0,o.jsx)("input",{type:"text",placeholder:"Buscar archivos por nombre, descripci\xf3n o categor\xeda...",value:S,onChange:e=>F(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white shadow-sm transition-all duration-200"})]})}),"general"===n&&(0,o.jsx)("div",{children:(0,o.jsx)("select",{value:A,onChange:e=>E(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white shadow-sm transition-all duration-200",children:$.map(e=>(0,o.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))})})]}),ee&&(0,o.jsxs)("div",{className:"mt-4 flex items-center space-x-2",children:[(0,o.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(ee.color),children:[ee.icon," ",ee.name]}),(0,o.jsxs)("span",{className:"text-sm text-gray-500",children:[q.length," archivo",1!==q.length?"s":""," encontrado",1!==q.length?"s":""]})]})]}),!g.canEdit&&x&&(0,o.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-6 text-center",children:(0,o.jsxs)("div",{className:"flex items-center justify-center space-x-3 text-orange-700",children:[(0,o.jsx)("span",{className:"text-2xl",children:"\ud83d\udc40"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-medium text-lg",children:"Modo Solo Lectura"}),(0,o.jsx)("p",{className:"text-sm text-orange-600",children:"Puedes visualizar y descargar archivos, pero no subir nuevos"})]})]})}),P&&(0,o.jsx)("div",{className:"border-2 border-dashed rounded-xl p-12 text-center transition-all duration-300 ".concat(C?"border-blue-500 bg-gradient-to-r from-blue-50 to-indigo-50 scale-105":"border-gray-300 hover:border-blue-400 hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50"),onDragEnter:_,onDragLeave:_,onDragOver:_,onDrop:e=>{e.preventDefault(),e.stopPropagation(),D(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&U(e.dataTransfer.files)},children:(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsx)("div",{className:"text-6xl",children:"\ud83d\udcc1"}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)("div",{className:"text-2xl font-bold text-gray-700",children:"Arrastra archivos aqu\xed"}),(0,o.jsx)("div",{className:"text-lg text-gray-600",children:"o haz clic para seleccionar"})]}),(0,o.jsxs)("div",{className:"text-sm text-gray-500 max-w-md mx-auto",children:["Tipos permitidos: PDF, JPG, PNG, DOC, DOCX, XLS, XLSX",(0,o.jsx)("br",{}),"Tama\xf1o m\xe1ximo: ",k.maxFileSize/1048576,"MB por archivo"]}),(0,o.jsx)("button",{onClick:()=>{var e;return null===(e=X.current)||void 0===e?void 0:e.click()},className:"px-8 py-4 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-xl hover:from-gray-200 hover:to-gray-300 transition-all duration-200 font-medium shadow-sm hover:shadow-md",children:"Seleccionar Archivos"})]})}),q.length>0&&(0,o.jsx)("div",{className:"flex items-center justify-between",children:(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("span",{className:"text-sm text-gray-600",children:"Vista:"}),(0,o.jsx)("button",{onClick:()=>W("grid"),className:"p-2 rounded-lg transition-colors ".concat("grid"===R?"bg-blue-100 text-blue-600":"text-gray-400 hover:text-gray-600"),children:"\u2b1b\u2b1b"}),(0,o.jsx)("button",{onClick:()=>W("list"),className:"p-2 rounded-lg transition-colors ".concat("list"===R?"bg-blue-100 text-blue-600":"text-gray-400 hover:text-gray-600"),children:"\u2630"})]})}),q.length>0?(0,o.jsx)("div",{className:"space-y-4",children:"grid"===R?(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:q.map(e=>(0,o.jsxs)("div",{className:"group bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-lg transition-all duration-200 hover:-translate-y-1",children:[(0,o.jsx)("div",{className:"p-4 bg-gradient-to-r ".concat(Q(e)," rounded-t-xl text-white"),children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsx)("span",{className:"text-2xl",children:Y(e)}),(0,o.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,o.jsx)("button",{onClick:()=>y(e.id),className:"p-1 bg-white bg-opacity-20 rounded hover:bg-opacity-30 transition-colors",title:"Eliminar",children:"\ud83d\uddd1\ufe0f"})})]})}),(0,o.jsxs)("div",{className:"p-4",children:[(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"font-semibold text-gray-900 truncate",title:e.fileName,children:e.fileName}),(0,o.jsx)("div",{className:"text-xs text-gray-500",children:Z(e.fileSize)})]}),e.description&&(0,o.jsx)("div",{className:"text-sm text-gray-600 line-clamp-2",children:e.description}),(0,o.jsx)("div",{className:"text-xs text-gray-400",children:new Date(e.uploadDate).toLocaleDateString()})]}),(0,o.jsxs)("div",{className:"mt-4 flex items-center justify-between opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[(0,o.jsx)("button",{onClick:()=>K(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Vista previa",children:"\ud83d\udc41\ufe0f"}),(0,o.jsx)("button",{onClick:()=>J(e),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Descargar",children:"\u2b07\ufe0f"})]})]})]},e.id))}):(0,o.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:(0,o.jsx)("div",{className:"overflow-x-auto",children:(0,o.jsxs)("table",{className:"w-full",children:[(0,o.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Archivo"}),(0,o.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tama\xf1o"}),(0,o.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),(0,o.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),(0,o.jsx)("tbody",{className:"divide-y divide-gray-100",children:q.map(e=>(0,o.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,o.jsx)("td",{className:"px-6 py-4",children:(0,o.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,o.jsx)("div",{className:"p-2 rounded-lg bg-gradient-to-r ".concat(Q(e)," text-white"),children:Y(e)}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"font-medium text-gray-900",children:e.fileName}),e.description&&(0,o.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]})}),(0,o.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:Z(e.fileSize)}),(0,o.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:new Date(e.uploadDate).toLocaleDateString()}),(0,o.jsx)("td",{className:"px-6 py-4",children:(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("button",{onClick:()=>K(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Vista previa",children:"\ud83d\udc41\ufe0f"}),(0,o.jsx)("button",{onClick:()=>J(e),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Descargar",children:"\u2b07\ufe0f"}),(0,o.jsx)("button",{onClick:()=>y(e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:"\ud83d\uddd1\ufe0f"})]})})]},e.id))})]})})})}):(0,o.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center",children:[(0,o.jsx)("div",{className:"text-6xl mb-6",children:"\ud83d\udcc1"}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)("div",{className:"text-2xl font-bold text-gray-700",children:"No hay archivos"}),(0,o.jsx)("div",{className:"text-gray-500 max-w-md mx-auto",children:S?"No se encontraron archivos con esa b\xfasqueda":"Sube tu primer archivo para comenzar"})]})]}),(0,o.jsx)("input",{ref:X,type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx",onChange:e=>{e.target.files&&e.target.files[0]&&U(e.target.files)},className:"hidden"}),M&&(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,o.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:(0,o.jsxs)("div",{className:"p-6",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,o.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\ud83d\udce4 Subir Archivos"}),(0,o.jsx)("button",{onClick:()=>{z(!1),O([]),T("")},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:"\u2715"})]}),(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcc2 Categor\xeda"}),(0,o.jsx)("select",{value:A,onChange:e=>E(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:$.map(e=>(0,o.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcdd Descripci\xf3n (opcional)"}),(0,o.jsx)("textarea",{value:B,onChange:e=>T(e.target.value),placeholder:"Describe brevemente estos archivos...",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors resize-none",rows:"3"})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\ud83d\udcce Archivos seleccionados (",I.length,")"]}),(0,o.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-2",children:I.map((e,s)=>(0,o.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("span",{className:"text-lg",children:H(e)}),(0,o.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name})]}),(0,o.jsx)("span",{className:"text-xs text-gray-500",children:Z(e.size)})]},s))})]})]}),(0,o.jsxs)("div",{className:"flex justify-end space-x-3 mt-8",children:[(0,o.jsx)("button",{onClick:()=>{z(!1),O([]),T("")},className:"px-6 py-3 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-xl transition-colors font-medium",children:"Cancelar"}),(0,o.jsx)("button",{onClick:async()=>{try{for(const e of I)await b(e,A,c,B);z(!1),O([]),T(""),d&&d()}catch(v){console.error("Error uploading files:",v)}},disabled:u,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:transform-none",children:u?(0,o.jsxs)("span",{className:"flex items-center",children:[(0,o.jsx)("span",{className:"animate-spin mr-2",children:"\u23f3"}),"Subiendo..."]}):(0,o.jsxs)("span",{className:"flex items-center",children:[(0,o.jsx)("span",{className:"mr-2",children:"\ud83d\udce4"}),"Subir Archivos"]})})]})]})})}),v&&(0,o.jsx)("div",{className:"bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-xl p-4",children:(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("span",{className:"text-red-600 text-lg",children:"\u274c"}),(0,o.jsx)("span",{className:"text-red-800 font-medium",children:v})]})})]})}}}]);
//# sourceMappingURL=156.2fce9c47.chunk.js.map
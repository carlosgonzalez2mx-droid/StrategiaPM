"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[200],{735:(e,s,t)=>{t.r(s),t.d(s,{default:()=>i});var a=t(9950),r=t(7902),n=t(4414);const i=e=>{let{projects:s,currentProjectId:t,workPackages:i,risks:l,tasks:d,purchaseOrders:o,advances:c,invoices:m,contracts:x,resourceAssignments:u,useSupabase:g=!0}=e;const[p,h]=(0,a.useState)("overview"),[b,j]=(0,a.useState)("all"),[v,f]=(0,a.useState)("all"),[y,N]=(0,a.useState)(""),w=s.find(e=>e.id===t),{auditLog:D,exportAuditLog:k,clearAuditLog:A}=(0,r.A)(t,g),S=(0,a.useMemo)(()=>{if(!w)return[];const e=[],s=new Date(w.updatedAt||w.createdAt);return e.push(...D),"active"!==w.status||D.find(e=>"project-activated"===e.action)||e.push({id:"event-".concat(Date.now(),"-1"),timestamp:s,category:"project-status",action:"project-activated",description:'Proyecto "'.concat(w.name,'" activado'),details:{previousStatus:"inactive",newStatus:"active",manager:w.manager,budget:w.budget,startDate:w.startDate,endDate:w.endDate},severity:"high",user:w.manager}),i.forEach((t,a)=>{"active"!==t.status&&"in-progress"!==t.status&&"completed"!==t.status||e.push({id:"event-".concat(Date.now(),"-wp-").concat(a),timestamp:new Date(t.updatedAt||t.createdAt||s),category:"work-package",action:"work-package-created",description:'Work Package "'.concat(t.name,'" creado'),details:{workPackageId:t.id,name:t.name,budget:t.budget,status:t.status,progress:t.progress||0},severity:"medium",user:w.manager})}),l.forEach((t,a)=>{"active"!==t.status&&"mitigated"!==t.status||e.push({id:"event-".concat(Date.now(),"-risk-").concat(a),timestamp:new Date(t.updatedAt||t.createdAt||s),category:"risk",action:"risk-identified",description:'Riesgo "'.concat(t.name,'" identificado'),details:{riskId:t.id,name:t.name,probability:t.probability,impact:t.impact,priority:t.priority,status:t.status},severity:"high"===t.priority?"high":"medium",user:w.manager})}),d.forEach((t,a)=>{"active"!==t.status&&"in-progress"!==t.status&&"completed"!==t.status||e.push({id:"event-".concat(Date.now(),"-task-").concat(a),timestamp:new Date(t.updatedAt||t.createdAt||s),category:"schedule",action:"task-created",description:'Tarea "'.concat(t.name,'" creada'),details:{taskId:t.id,name:t.name,duration:t.duration,status:t.status,startDate:t.startDate,endDate:t.endDate},severity:"medium",user:w.manager})}),o.forEach((t,a)=>{e.push({id:"event-".concat(Date.now(),"-po-").concat(a),timestamp:new Date(t.updatedAt||t.createdAt||s),category:"financial",action:"purchase-order-created",description:'Orden de Compra "'.concat(t.description,'" creada'),details:{poId:t.id,description:t.description,amount:t.amount,status:t.status,supplier:t.supplier},severity:"high",user:w.manager})}),c.forEach((t,a)=>{e.push({id:"event-".concat(Date.now(),"-advance-").concat(a),timestamp:new Date(t.updatedAt||t.createdAt||s),category:"financial",action:"advance-created",description:'Anticipo "'.concat(t.description,'" creado'),details:{advanceId:t.id,description:t.description,amount:t.amount,status:t.status,recipient:t.recipient},severity:"high",user:w.manager})}),m.forEach((t,a)=>{e.push({id:"event-".concat(Date.now(),"-invoice-").concat(a),timestamp:new Date(t.updatedAt||t.createdAt||s),category:"financial",action:"invoice-created",description:'Factura "'.concat(t.description,'" creada'),details:{invoiceId:t.id,description:t.description,amount:t.amount,status:t.status,supplier:t.supplier},severity:"high",user:w.manager})}),x.forEach((t,a)=>{e.push({id:"event-".concat(Date.now(),"-contract-").concat(a),timestamp:new Date(t.updatedAt||t.createdAt||s),category:"contracts",action:"contract-created",description:'Contrato "'.concat(t.name,'" creado'),details:{contractId:t.id,name:t.name,value:t.value,status:t.status,contractor:t.contractor},severity:"high",user:w.manager})}),u.forEach((t,a)=>{e.push({id:"event-".concat(Date.now(),"-resource-").concat(a),timestamp:new Date(t.updatedAt||t.createdAt||s),category:"resources",action:"resource-assigned",description:"Recurso asignado al proyecto",details:{assignmentId:t.id,resourceId:t.resourceId,role:t.role,startDate:t.startDate,endDate:t.endDate,allocation:t.allocation},severity:"medium",user:w.manager})}),e.sort((e,s)=>s.timestamp-e.timestamp)},[w,i,l,d,o,c,m,x,u,D]),C=(0,a.useMemo)(()=>{let e=S;if("all"!==v&&(e=e.filter(e=>e.category===v)),"all"!==b){new Date;const s=new Date;switch(b){case"today":s.setHours(0,0,0,0),e=e.filter(e=>e.timestamp>=s);break;case"week":s.setDate(s.getDate()-7),e=e.filter(e=>e.timestamp>=s);break;case"month":s.setMonth(s.getMonth()-1),e=e.filter(e=>e.timestamp>=s);break;case"quarter":s.setMonth(s.getMonth()-3),e=e.filter(e=>e.timestamp>=s)}}return y&&(e=e.filter(e=>{var s,t;return e.description.toLowerCase().includes(y.toLowerCase())||(null===(s=e.details)||void 0===s||null===(t=s.name)||void 0===t?void 0:t.toLowerCase().includes(y.toLowerCase()))||e.category.toLowerCase().includes(y.toLowerCase())})),e},[S,v,b,y]),E=e=>{switch(e){case"project-status":return"\ud83c\udfe2";case"work-package":return"\ud83d\udce6";case"risk":return"\u26a0\ufe0f";case"schedule":return"\ud83d\udcc5";case"financial":return"\ud83d\udcb0";case"contracts":return"\ud83d\udccb";case"resources":return"\ud83d\udc65";case"minutes":return"\ud83d\udcdd";default:return"\ud83d\udcc4"}},P=e=>{switch(e){case"high":return"text-red-600 bg-red-50 border-red-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":return"text-green-600 bg-green-50 border-green-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},I=e=>{switch(e){case"project-activated":return"Proyecto Activado";case"work-package-created":return"Work Package Creado";case"risk-identified":return"Riesgo Identificado";case"task-created":return"Tarea Creada";case"purchase-order-created":return"Orden de Compra Creada";case"advance-created":return"Anticipo Creado";case"invoice-created":return"Factura Creada";case"contract-created":return"Contrato Creado";case"resource-assigned":return"Recurso Asignado";case"minute-task-created":return"Tarea de Minuta Creada";case"minute-task-updated":return"Tarea de Minuta Actualizada";case"created":return"Creado";case"modified":return"Modificado";default:return e}};return w?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-gradient-to-r from-purple-50 to-indigo-100 rounded-2xl shadow-lg p-6 text-gray-800 relative overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-purple-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,n.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-indigo-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,n.jsx)("div",{className:"relative z-10",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,n.jsx)("span",{className:"text-3xl",children:"\ud83d\udccb"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gray-800",children:"Auditor\xeda Documental"}),(0,n.jsxs)("p",{className:"text-gray-600 text-lg",children:['Registro completo de movimientos del proyecto "',w.name,'"']})]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-4xl font-bold text-gray-800",children:C.length}),(0,n.jsx)("div",{className:"text-gray-600",children:"Eventos Registrados"})]})]})})]}),(0,n.jsx)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"text-purple-600 text-xl mr-3",children:"\u2139\ufe0f"}),(0,n.jsxs)("div",{className:"text-purple-800",children:[(0,n.jsx)("strong",{children:"Sistema de Auditor\xeda Autom\xe1tica:"}),' Este sistema registra autom\xe1ticamente todos los movimientos del proyecto desde que cambia a estado "Activo". Los eventos se guardan localmente y se pueden exportar para an\xe1lisis externos o cumplimiento regulatorio.']})]})}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categor\xeda"}),(0,n.jsxs)("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:v,onChange:e=>f(e.target.value),children:[(0,n.jsx)("option",{value:"all",children:"Todas las categor\xedas"}),(0,n.jsx)("option",{value:"project-status",children:"Estado del Proyecto"}),(0,n.jsx)("option",{value:"work-package",children:"Work Packages"}),(0,n.jsx)("option",{value:"risk",children:"Riesgos"}),(0,n.jsx)("option",{value:"schedule",children:"Cronograma"}),(0,n.jsx)("option",{value:"financial",children:"Financiero"}),(0,n.jsx)("option",{value:"contracts",children:"Contratos"}),(0,n.jsx)("option",{value:"resources",children:"Recursos"}),(0,n.jsx)("option",{value:"minutes",children:"Minutas"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Per\xedodo"}),(0,n.jsxs)("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:b,onChange:e=>j(e.target.value),children:[(0,n.jsx)("option",{value:"all",children:"Todo el per\xedodo"}),(0,n.jsx)("option",{value:"today",children:"Hoy"}),(0,n.jsx)("option",{value:"week",children:"\xdaltima semana"}),(0,n.jsx)("option",{value:"month",children:"\xdaltimo mes"}),(0,n.jsx)("option",{value:"quarter",children:"\xdaltimo trimestre"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),(0,n.jsx)("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"Buscar eventos...",value:y,onChange:e=>N(e.target.value)})]}),(0,n.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,n.jsx)("button",{onClick:()=>{k()},className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"\ud83d\udcc4 Exportar Reporte"}),(0,n.jsx)("button",{onClick:()=>{window.confirm("\xbfEst\xe1 seguro de limpiar todo el log de auditor\xeda? Esta acci\xf3n no se puede deshacer.")&&A()},className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",title:"Limpiar log de auditor\xeda",children:"\ud83d\uddd1\ufe0f"})]})]})}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-blue-500",children:[(0,n.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Total Eventos"}),(0,n.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:C.length})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-green-500",children:[(0,n.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Eventos Financieros"}),(0,n.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:C.filter(e=>"financial"===e.category).length})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-red-500",children:[(0,n.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Alta Severidad"}),(0,n.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:C.filter(e=>"high"===e.severity).length})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-purple-500",children:[(0,n.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"\xdaltimo Evento"}),(0,n.jsx)("div",{className:"text-sm font-bold text-gray-800",children:C.length>0?new Date(C[0].timestamp).toLocaleDateString():"N/A"})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,n.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Registro de Eventos"})}),(0,n.jsx)("div",{className:"max-h-96 overflow-y-auto",children:0===C.length?(0,n.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,n.jsx)("div",{className:"text-4xl mb-4",children:"\ud83d\udced"}),(0,n.jsx)("div",{className:"text-lg mb-2",children:"No hay eventos que coincidan con los filtros"})]}):(0,n.jsx)("div",{className:"divide-y divide-gray-200",children:C.map(e=>(0,n.jsx)("div",{className:"p-6 hover:bg-gray-50",children:(0,n.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,n.jsx)("div",{className:"text-2xl",children:E(e.category)}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("h4",{className:"font-semibold text-gray-900",children:e.description}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(P(e.severity)),children:e.severity.toUpperCase()}),(0,n.jsx)("span",{className:"text-sm text-gray-500",children:new Date(e.timestamp).toLocaleString()})]})]}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,n.jsx)("strong",{children:"Acci\xf3n:"})," ",I(e.action)]}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,n.jsx)("strong",{children:"Usuario:"})," ",e.user]}),e.details&&(0,n.jsxs)("div",{className:"bg-gray-50 rounded p-3",children:[(0,n.jsx)("div",{className:"text-sm text-gray-700",children:(0,n.jsx)("strong",{children:"Detalles:"})}),(0,n.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:Object.entries(e.details).map(e=>{let[s,t]=e;return(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("span",{className:"font-medium",children:[s,":"]}),(0,n.jsx)("span",{children:String(t)})]},s)})})]})]})]})},e.id))})})]})]}):(0,n.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,n.jsx)("div",{className:"text-4xl mb-4",children:"\ud83d\udccb"}),(0,n.jsx)("div",{className:"text-lg mb-2",children:"Selecciona un proyecto para ver su auditor\xeda"})]})}},3200:(e,s,t)=>{t.r(s),t.d(s,{default:()=>h});var a=t(9379),r=t(9950),n=t(6162),i=t(6241),l=t(5702),d=t(7243),o=t(1403),c=t(735),m=t(5462),x=t(6614),u=t(4321),g=t(4414);const p=e=>{let{orphanedTasks:s,availableMilestones:t,onReassign:n,updateMinutaTaskHito:i}=e;const[l,d]=(0,r.useState)({});return 0===s.length?null:(0,g.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,g.jsxs)("h3",{className:"text-yellow-800 font-semibold flex items-center",children:[(0,g.jsx)("span",{className:"mr-2",children:"\u26a0\ufe0f"}),"Tareas de Minuta sin Hito Asignado"]}),(0,g.jsxs)("span",{className:"text-sm bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full",children:[s.length," tareas"]})]}),(0,g.jsx)("p",{className:"text-yellow-700 text-sm mb-3",children:"Estas tareas perdieron su hito asignado. Reas\xedgnalas para mantener la organizaci\xf3n."}),(0,g.jsx)("div",{className:"space-y-2",children:s.map(e=>{const s=Math.ceil((new Date(e.fecha)-new Date)/864e5),r=s<=3?"text-red-600 bg-red-100":s<=7?"text-orange-600 bg-orange-100":"text-yellow-600 bg-yellow-100";return(0,g.jsx)("div",{className:"bg-white p-3 rounded border border-yellow-200",children:(0,g.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,g.jsxs)("div",{className:"flex-1",children:[(0,g.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,g.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.tarea}),(0,g.jsxs)("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full flex items-center",children:[(0,g.jsx)("span",{className:"mr-1",children:"\ud83d\udcdd"}),"Minuta"]})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,g.jsxs)("span",{children:["\ud83d\udc64 ",e.responsable]}),(0,g.jsxs)("span",{children:["\ud83d\udcc5 ",new Date(e.fecha).toLocaleDateString("es-ES")]}),(0,g.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("Completado"===e.estatus?"bg-green-100 text-green-800":"En Proceso"===e.estatus?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.estatus})]})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(r),children:0===s?"Hoy":1===s?"Ma\xf1ana":"".concat(s," d\xedas")}),(0,g.jsxs)("select",{value:e.hitoId||"",onChange:s=>(async(e,s)=>{if(s){d(s=>(0,a.A)((0,a.A)({},s),{},{[e]:!0}));try{await i(e,s)?(n(e,s),alert("\u2705 Tarea reasignada exitosamente")):alert("\u274c Error al reasignar tarea")}catch(t){console.error("Error en reasignaci\xf3n:",t),alert("\u274c Error al reasignar tarea")}finally{d(s=>(0,a.A)((0,a.A)({},s),{},{[e]:!1}))}}})(e.id,s.target.value),disabled:l[e.id],className:"text-xs border border-gray-300 rounded px-2 py-1 min-w-[200px]",children:[(0,g.jsx)("option",{value:"",children:"Seleccionar hito..."}),t.map(e=>(0,g.jsx)("option",{value:e.id,children:e.name},e.id))]}),l[e.id]&&(0,g.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-600"})]})]})},e.id)})})]})},h=e=>{var s;let{projects:h,currentProjectId:b,setCurrentProjectId:j,workPackages:v,setWorkPackages:f,risks:y,setRisks:N,reportingDate:w,setReportingDate:D,tasks:k,setTasks:A,importTasks:S,includeWeekends:C,setIncludeWeekends:E,purchaseOrders:P,setPurchaseOrders:I,advances:M,setAdvances:O,invoices:T,setInvoices:R,contracts:F,setContracts:L,resourceAssignments:q,useSupabase:B=!1,updateProjectMinutas:G}=e;const{permissions:H,isReadOnly:V}=(0,u.A)(),[z,W]=(0,r.useState)("summary"),[K,U]=(0,r.useState)(null),[$,J]=(0,r.useState)([]),[_,Z]=(0,r.useState)([]),[Q,X]=(0,r.useState)(!1),Y=[{id:"summary",name:"Dashboard Resumen",icon:"\ud83d\udcca",requiresEdit:!1},{id:"risks",name:"Gesti\xf3n de Riesgos",icon:"\ud83d\udee1\ufe0f",requiresEdit:!0},{id:"schedule",name:"Cronograma",icon:"\ud83d\udcc5",requiresEdit:!0},{id:"financial",name:"Gesti\xf3n Financiera",icon:"\ud83d\udcb0",requiresEdit:!0},{id:"resources",name:"Gesti\xf3n de Recursos",icon:"\ud83d\udc65",requiresEdit:!0},{id:"changes",name:"Control de Cambios",icon:"\ud83d\udd04",requiresEdit:!0},{id:"cashflow",name:"Flujo de Caja",icon:"\ud83d\udcb8",requiresEdit:!1},{id:"files",name:"Archivos",icon:"\ud83d\udcce",requiresEdit:!1},{id:"audit",name:"Auditor\xeda Documental",icon:"\ud83d\udccb",requiresEdit:!1}].filter(e=>!e.requiresEdit||!V());(0,r.useEffect)(()=>{const e=e=>{const s=e.detail;s&&s!==z&&W(s)};return window.addEventListener("changeTab",e),()=>{window.removeEventListener("changeTab",e)}},[z]),(0,r.useEffect)(()=>{const e=e=>{const{tareaId:s,newStatus:t,projectId:r}=e.detail;r===b&&(console.log("\ud83d\udd04 ProjectManagementTabs: Actualizando estado de minuta:",{tareaId:s,newStatus:t}),Z(e=>e.map(e=>e.id===s?(0,a.A)((0,a.A)({},e),{},{estatus:t}):e)))};return window.addEventListener("minutaStatusChanged",e),()=>{window.removeEventListener("minutaStatusChanged",e)}},[b]),(0,r.useEffect)(()=>{const e=Y.map(e=>e.id);e.includes(z)||e.length>0&&W(e[0])},[Y,z]),(0,r.useEffect)(()=>{(async()=>{if(b){X(!0);try{if(B){console.log("\ud83d\udd0d DEBUG: Cargando minutas para proyecto:",b);const{default:e}=await Promise.resolve().then(t.bind(t,9874)),{success:s,minutas:a}=await e.loadMinutasByProject(b);s?(console.log("\ud83d\udd0d DEBUG: Minutas recibidas de Supabase:",a),Z(a),console.log("\u2705 Minutas cargadas desde Supabase: ".concat(a.length))):(console.warn("\u26a0\ufe0f Error cargando minutas desde Supabase"),Z([]))}else{var e;const s=(null===(e=JSON.parse(localStorage.getItem("portfolioData")||"{}").minutasByProject)||void 0===e?void 0:e[b])||[];Z(s),G&&G(b,s),console.log("\u2705 Minutas cargadas desde localStorage: ".concat(s.length))}}catch(s){console.error("\u274c Error cargando minutas:",s),Z([])}finally{X(!1)}}})()},[b,B]);const ee=(e,s)=>{if(!e||!s)return 0;const t=e.progress||0;return console.log("\ud83c\udfaf C\xc1LCULO PROGRESO HITO CORREGIDO:",{milestoneName:e.name,milestoneId:e.id,milestoneProgress:t,milestoneStatus:e.status,milestoneProgressField:e.progress}),t},se=(e,s)=>e&&s?e.filter(e=>!s.find(s=>s.id===e.hitoId&&s.isMilestone)):[],te=async(e,s)=>{try{if(B){const{default:a}=await Promise.resolve().then(t.bind(t,9874)),{success:r}=await a.updateMinuta(e,{milestone_id:s});if(!r)throw new Error("Error actualizando en Supabase")}else{var r;const t=JSON.parse(localStorage.getItem("portfolioData")||"{}"),n=((null===(r=t.minutasByProject)||void 0===r?void 0:r[b])||[]).map(t=>t.id===e?(0,a.A)((0,a.A)({},t),{},{hitoId:s}):t);t.minutasByProject=(0,a.A)((0,a.A)({},t.minutasByProject),{},{[b]:n}),localStorage.setItem("portfolioData",JSON.stringify(t))}return Z(t=>t.map(t=>t.id===e?(0,a.A)((0,a.A)({},t),{},{hitoId:s}):t)),!0}catch(n){return console.error("Error actualizando tarea de minuta:",n),!1}},ae=(e,s)=>{const t=(e=>{if(!e)return[];const s=new Date,t=new Date;t.setDate(s.getDate()+15);const a=e.filter(e=>{if(e.isMilestone)return!1;if(e.progress>=100)return!1;const a=new Date(e.endDate);return a<s||a>=s&&a<=t}),r={};return e.filter(e=>e.isMilestone).sort((e,s)=>new Date(e.startDate)-new Date(s.startDate)).forEach(e=>{const s=new Date(e.startDate),t=a.filter(e=>new Date(e.endDate)<=s),n=new Set;Object.values(r).forEach(e=>{e.tasks.forEach(e=>n.add(e.id))});const i=t.filter(e=>!n.has(e.id));i.length>0&&(r[e.id]={milestone:e,tasks:i})}),console.log("\ud83c\udfaf TAREAS AGRUPADAS POR HITO (CORREGIDO):",{tasksNearDeadline:a.length,tasksByMilestone:Object.keys(r).length,details:Object.values(r).map(e=>({milestoneName:e.milestone.name,milestoneId:e.milestone.id,tasksCount:e.tasks.length,tasksNames:e.tasks.map(e=>e.name)}))}),Object.values(r)})(e),r=((e,s)=>{if(!s||0===s.length)return[];const t=new Date,a=new Date;a.setDate(t.getDate()+15);const r=s.filter(e=>{if("Completado"===e.estatus)return!1;const s=new Date(e.fecha);return s<t||s>=t&&s<=a}),n={};return r.forEach(s=>{const t=e.find(e=>e.id===s.hitoId&&e.isMilestone);if(t){n[t.id]||(n[t.id]={milestone:t,tasks:[]});const e={id:s.id,name:s.tarea,endDate:s.fecha,progress:"Completado"===s.estatus?100:"En Proceso"===s.estatus?50:0,responsable:s.responsable,estatus:s.estatus,source:"minuta"};n[t.id].tasks.push(e)}}),Object.values(n)})(e,s),n=[...t.map(e=>(0,a.A)((0,a.A)({},e),{},{source:"cronograma",tasks:e.tasks.map(e=>(0,a.A)((0,a.A)({},e),{},{source:"cronograma"}))})),...r.map(e=>(0,a.A)((0,a.A)({},e),{},{source:"minuta",tasks:e.tasks.map(e=>(0,a.A)((0,a.A)({},e),{},{source:"minuta"}))}))],i={};n.forEach(e=>{const s=e.milestone.id;i[s]||(i[s]={milestone:e.milestone,tasks:[]}),i[s].tasks.push(...e.tasks)});const l=Object.values(i).sort((e,s)=>new Date(e.milestone.startDate)-new Date(s.milestone.startDate));return console.log("\ud83c\udfaf HITOS ORDENADOS POR FECHA:",{totalGroups:l.length,order:l.map(e=>({milestoneName:e.milestone.name,milestoneDate:e.milestone.startDate,tasksCount:e.tasks.length}))}),l},re=(null===h||void 0===h?void 0:h.find(e=>e.id===b))||h[0],ne=Array.isArray(v)?v:[],ie=(0,r.useMemo)(()=>(console.log("\ud83d\udd04 ProjectManagementTabs - Recalculando projectTasks:",(null===k||void 0===k?void 0:k.length)||0),Array.isArray(k)?k:[]),[k]),le=Array.isArray(P)?P:[],de=Array.isArray(M)?M:[],oe=Array.isArray(T)?T:[],ce=Array.isArray(F)?F:[],me=Array.isArray(y)?y:[],xe=(Array.isArray(q),(0,r.useMemo)(()=>h?h.filter(e=>"active"===e.status).sort((e,s)=>e.name.localeCompare(s.name,void 0,{numeric:!0,sensitivity:"base"})):[],[h])),ue=(()=>{if(!re)return{};const e=Array.isArray(k)?k:[];if(0===e.length)return{percentComplete:0};const s=e.filter(e=>!e.isMilestone);if(0===s.length)return{percentComplete:0};const t=s.reduce((e,s)=>e+(s.progress||0),0),a=Math.round(t/s.length);if(Array.isArray(ne)&&ne.length>0){const e=ne.reduce((e,s)=>e+(s.budget||0),0),s=ne.reduce((e,s)=>e+(s.plannedValue||0),0),t=ne.reduce((e,s)=>e+(s.earnedValue||0),0),r=ne.reduce((e,s)=>e+(s.actualCost||0),0);return{BAC:e,PV:s,EV:t,AC:r,CV:t-r,SV:t-s,CPI:r>0?t/r:0,SPI:s>0?t/s:0,percentComplete:a,percentSpent:e>0?r/e*100:0}}return{percentComplete:a}})(),ge=(()=>{if(!k||0===k.length)return null;const e=k.filter(e=>!e.startDate||null===e.startDate||void 0===e.startDate);e.length>0&&console.log("\u26a0\ufe0f Tareas con fechas de inicio inv\xe1lidas:",e.map(e=>({id:e.id,name:e.name,startDate:e.startDate,isMilestone:e.isMilestone})));const s=k.filter(e=>e.startDate&&null!==e.startDate&&void 0!==e.startDate).map(e=>new Date(e.startDate)).filter(e=>!isNaN(e.getTime()));if(0===s.length)return console.log("\u26a0\ufe0f No se encontraron fechas de inicio v\xe1lidas"),null;const t=new Date(Math.min(...s));return isNaN(t.getTime())?(console.log("\u26a0\ufe0f Fecha m\xednima calculada es inv\xe1lida"),null):(console.log("\u2705 Fecha de inicio calculada:",t.toISOString().split("T")[0]),t.toISOString().split("T")[0])})(),pe=(()=>{if(!k||0===k.length)return null;const e=k.filter(e=>!e.endDate||null===e.endDate||void 0===e.endDate);e.length>0&&console.log("\u26a0\ufe0f Tareas con fechas de fin inv\xe1lidas:",e.map(e=>({id:e.id,name:e.name,endDate:e.endDate,isMilestone:e.isMilestone})));const s=k.filter(e=>e.endDate&&null!==e.endDate&&void 0!==e.endDate).map(e=>new Date(e.endDate)).filter(e=>!isNaN(e.getTime()));if(0===s.length)return console.log("\u26a0\ufe0f No se encontraron fechas de fin v\xe1lidas"),null;const t=new Date(Math.max(...s));return isNaN(t.getTime())?(console.log("\u26a0\ufe0f Fecha m\xe1xima calculada es inv\xe1lida"),null):(console.log("\u2705 Fecha de fin calculada:",t.toISOString().split("T")[0]),t.toISOString().split("T")[0])})();return re?(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-purple-100 rounded-2xl shadow-lg p-6 text-gray-800 relative overflow-hidden",children:[(0,g.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,g.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-purple-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,g.jsx)("div",{className:"relative z-10",children:(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{className:"flex items-center",children:[(0,g.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,g.jsx)("span",{className:"text-3xl",children:"\ud83d\udcca"})}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gray-800",children:re.name}),(0,g.jsx)("p",{className:"text-gray-600 text-lg",children:re.description||"Gesti\xf3n integral del proyecto - PMBOK v7"}),(0,g.jsxs)("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-700",children:[(0,g.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,g.jsx)("span",{className:"text-gray-500",children:"\ud83d\udc64"}),(0,g.jsx)("span",{children:re.manager})]}),(0,g.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,g.jsx)("span",{className:"text-yellow-600",children:"\ud83d\udcb0"}),(0,g.jsxs)("span",{children:["$",(re.budget/1e3).toFixed(0),"K"]})]}),(0,g.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,g.jsx)("span",{className:"text-green-500",children:"\ud83d\udcbc"}),(0,g.jsxs)("span",{className:"px-2 py-1 rounded bg-gray-100 text-gray-800 ml-2",children:[(null===(s=ue.percentComplete)||void 0===s?void 0:s.toFixed(1))||0,"% completado"]})]})]}),(0,g.jsx)("div",{className:"mt-3",children:(0,g.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-4 border border-green-200",children:(0,g.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,g.jsx)("span",{className:"text-green-600 text-lg",children:"\ud83d\udcbc"}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h4",{className:"font-semibold text-green-800 mb-2",children:"Caso de Negocio"}),(0,g.jsx)("p",{className:"text-gray-700 text-sm leading-relaxed",children:re.businessCase||"Sin caso de negocio definido"})]})]})})})]})]}),(0,g.jsxs)("div",{className:"text-right",children:[(0,g.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Fecha de Reporte"}),(0,g.jsx)("input",{type:"date",value:w,onChange:e=>D(e.target.value),className:"px-3 py-1 rounded bg-white text-gray-800 text-sm border border-gray-300 shadow-sm"})]})]})})]}),(0,g.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Proyecto Activo"}),(0,g.jsx)("div",{className:"px-4 py-2 rounded-lg text-sm font-medium ".concat(B?"bg-green-100 text-green-800 border border-green-300":"bg-red-100 text-red-800 border border-red-300"),children:B?"\ud83d\udfe2 Estado: Online":"\ud83d\udd34 Estado: Offline"})]}),(0,g.jsxs)("select",{value:b,onChange:e=>j(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,g.jsx)("option",{value:"",disabled:!0,children:"Seleccionar proyecto activo"}),xe.map(e=>(0,g.jsxs)("option",{value:e.id,children:[e.name," - ",e.manager]},e.id))]}),b&&(0,g.jsx)("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,g.jsxs)("div",{className:"flex items-center text-green-800 text-sm",children:[(0,g.jsx)("span",{className:"mr-2",children:"\u2705"}),(0,g.jsxs)("span",{children:[(0,g.jsx)("strong",{children:"Filtrado por proyecto implementado:"})," Todas las pesta\xf1as muestran \xfanicamente la informaci\xf3n de",(0,g.jsxs)("strong",{children:[" ",null===re||void 0===re?void 0:re.name]}),". Los datos de otros proyectos NO se incluyen en las m\xe9tricas ni en los m\xf3dulos."]})]})})]}),(0,g.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,g.jsx)("div",{className:"border-b border-gray-200",children:(0,g.jsx)("nav",{className:"flex flex-wrap gap-1 px-4 overflow-x-auto scrollbar-hide tab-container",children:Y.map(e=>(0,g.jsxs)("button",{onClick:()=>W(e.id),className:"\n                  py-3 px-2 border-b-2 font-medium text-xs sm:text-sm transition-colors whitespace-nowrap min-w-fit\n                  ".concat(z===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","\n                "),children:[(0,g.jsx)("span",{className:"mr-1 sm:mr-2",children:e.icon}),(0,g.jsx)("span",{className:"hidden sm:inline",children:e.name}),(0,g.jsx)("span",{className:"sm:hidden",children:e.name.split(" ")[0]})]},e.id))})}),(0,g.jsxs)("div",{children:["summary"===z&&(0,g.jsxs)("div",{className:"space-y-8",children:[(0,g.jsxs)("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 rounded-xl shadow-lg p-6 text-white",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"\ud83d\udcca Dashboard Resumen"}),(0,g.jsxs)("p",{className:"text-indigo-100 text-lg",children:[(null===re||void 0===re?void 0:re.name)||"Proyecto no seleccionado"," - Vista ejecutiva del estado del proyecto"]})]}),(0,g.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500",children:[(0,g.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center",children:[(0,g.jsx)("span",{className:"text-3xl mr-3",children:"\ud83d\udcc8"}),"Informaci\xf3n del Proyecto"]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,g.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg border border-blue-200",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,g.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"}),(0,g.jsx)("span",{className:"text-sm font-medium text-blue-600",children:"Presupuesto"})]}),(0,g.jsxs)("div",{className:"text-3xl font-bold text-blue-800",children:["$",(((null===re||void 0===re?void 0:re.budget)||0)/1e3).toFixed(0),"K"]}),(0,g.jsx)("div",{className:"text-sm text-blue-600 mt-1",children:"Presupuesto asignado"})]}),(0,g.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg border border-green-200",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,g.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc5"}),(0,g.jsx)("span",{className:"text-sm font-medium text-green-600",children:"Inicio"})]}),(0,g.jsx)("div",{className:"text-xl font-bold text-green-800",children:ge?new Date(ge).toLocaleDateString("es-ES"):"N/A"}),(0,g.jsx)("div",{className:"text-sm text-green-600 mt-1",children:"Fecha de inicio del cronograma"})]}),(0,g.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg border border-purple-200",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,g.jsx)("span",{className:"text-2xl",children:"\ud83c\udfc1"}),(0,g.jsx)("span",{className:"text-sm font-medium text-purple-600",children:"Fin"})]}),(0,g.jsx)("div",{className:"text-xl font-bold text-purple-800",children:pe?new Date(pe).toLocaleDateString("es-ES"):"N/A"}),(0,g.jsx)("div",{className:"text-sm text-purple-600 mt-1",children:"Fecha de fin del cronograma"})]})]})]}),(0,g.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500",children:[(0,g.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center",children:[(0,g.jsx)("span",{className:"text-3xl mr-3",children:"\ud83d\udcb3"}),"Gesti\xf3n Financiera"]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,g.jsxs)("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 p-6 rounded-lg border border-emerald-200",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,g.jsx)("span",{className:"text-2xl",children:"\ud83d\udccb"}),(0,g.jsx)("span",{className:"text-sm font-medium text-emerald-600",children:"\xd3rdenes de Compra"})]}),(0,g.jsxs)("div",{className:"text-3xl font-bold text-emerald-800",children:["$",(((null===le||void 0===le?void 0:le.reduce((e,s)=>e+(s.totalAmount||0),0))||0)/1e3).toFixed(0),"K"]}),(0,g.jsx)("div",{className:"text-sm text-emerald-600 mt-1",children:"Monto en OC aprobadas"})]}),(0,g.jsxs)("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 p-6 rounded-lg border border-amber-200",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,g.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb8"}),(0,g.jsx)("span",{className:"text-sm font-medium text-amber-600",children:"Anticipos"})]}),(0,g.jsxs)("div",{className:"text-3xl font-bold text-amber-800",children:["$",(((null===de||void 0===de?void 0:de.reduce((e,s)=>e+(s.amount||0),0))||0)/1e3).toFixed(0),"K"]}),(0,g.jsx)("div",{className:"text-sm text-amber-600 mt-1",children:"Anticipos solicitados"})]}),(0,g.jsxs)("div",{className:"bg-gradient-to-br from-cyan-50 to-cyan-100 p-6 rounded-lg border border-cyan-200",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,g.jsx)("span",{className:"text-2xl",children:"\ud83e\uddfe"}),(0,g.jsx)("span",{className:"text-sm font-medium text-cyan-600",children:"Facturas"})]}),(0,g.jsxs)("div",{className:"text-3xl font-bold text-cyan-800",children:["$",(((null===oe||void 0===oe?void 0:oe.reduce((e,s)=>e+(s.amount||0),0))||0)/1e3).toFixed(0),"K"]}),(0,g.jsx)("div",{className:"text-sm text-cyan-600 mt-1",children:"Facturas ingresadas"})]})]})]}),(0,g.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500",children:[(0,g.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center",children:[(0,g.jsx)("span",{className:"text-3xl mr-3",children:"\ud83d\udee1\ufe0f"}),"Reservas y Riesgos"]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-lg border border-orange-200",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,g.jsx)("span",{className:"text-2xl",children:"\u26a0\ufe0f"}),(0,g.jsx)("span",{className:"text-sm font-medium text-orange-600",children:"Reserva de Contingencia"})]}),(0,g.jsxs)("div",{className:"text-3xl font-bold text-orange-800",children:["$",(.05*((null===re||void 0===re?void 0:re.budget)||0)/1e3).toFixed(0),"K"]}),(0,g.jsx)("div",{className:"text-sm text-orange-600 mt-1",children:"5% del presupuesto total"})]}),(0,g.jsxs)("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 p-6 rounded-lg border border-pink-200",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,g.jsx)("span",{className:"text-2xl",children:"\ud83c\udfaf"}),(0,g.jsx)("span",{className:"text-sm font-medium text-pink-600",children:"Reserva de Gesti\xf3n"})]}),(0,g.jsxs)("div",{className:"text-3xl font-bold text-pink-800",children:["$",(.1*((null===re||void 0===re?void 0:re.budget)||0)/1e3).toFixed(0),"K"]}),(0,g.jsx)("div",{className:"text-sm text-pink-600 mt-1",children:"10% del presupuesto total"})]})]}),(0,g.jsxs)("div",{className:"bg-gradient-to-br from-red-50 to-red-100 p-6 rounded-lg border border-red-200",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,g.jsx)("span",{className:"text-2xl",children:"\ud83d\udea8"}),(0,g.jsx)("span",{className:"text-sm font-medium text-red-600",children:"Principales Riesgos"})]}),(0,g.jsxs)("div",{className:"space-y-3",children:[null===me||void 0===me?void 0:me.slice(0,3).map((e,s)=>{const t=(e.probability||0)*(e.costImpact||0);return(0,g.jsxs)("div",{className:"p-3 bg-white rounded-lg border",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,g.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,g.jsx)("span",{className:"w-3 h-3 rounded-full ".concat("high"===e.priority?"bg-red-500":"medium"===e.priority?"bg-yellow-500":"bg-green-500")}),(0,g.jsx)("span",{className:"text-sm font-medium text-gray-800 truncate",children:e.name})]}),(0,g.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat("high"===e.priority?"bg-red-100 text-red-800":"medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.priority})]}),(0,g.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,g.jsx)("span",{children:"Costo probable:"}),(0,g.jsxs)("span",{className:"font-semibold text-red-600",children:["$",(t/1e3).toFixed(1),"K"]})]}),(0,g.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-1",children:[(0,g.jsxs)("span",{children:["Prob: ",(100*(e.probability||0)).toFixed(0),"%"]}),(0,g.jsxs)("span",{children:["Impacto: $",((e.costImpact||0)/1e3).toFixed(0),"K"]})]})]},e.id)}),(!me||0===me.length)&&(0,g.jsx)("div",{className:"text-center text-gray-500 py-4",children:"No hay riesgos registrados"})]})]})]})]}),(0,g.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500",children:[(0,g.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center justify-between",children:[(0,g.jsxs)("div",{className:"flex items-center",children:[(0,g.jsx)("span",{className:"text-3xl mr-3",children:"\ud83c\udfaf"}),"Hitos del Proyecto"]}),(0,g.jsxs)("span",{className:"text-sm bg-purple-100 text-purple-800 px-3 py-1 rounded-full",children:[(null===ie||void 0===ie?void 0:ie.filter(e=>e.isMilestone).length)||0," hitos"]})]}),(0,g.jsxs)("div",{className:"space-y-4 max-h-96 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[(()=>{const e=(null===ie||void 0===ie?void 0:ie.filter(e=>e.isMilestone))||[];return console.log("\ud83c\udfaf Dashboard - Hitos actualizados:",e.map(e=>({id:e.id,name:e.name,startDate:e.startDate,endDate:e.endDate}))),e})().sort((e,s)=>new Date(e.startDate||e.endDate||"1900-01-01")-new Date(s.startDate||s.endDate||"1900-01-01")).map((e,s)=>(0,g.jsx)("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-lg border border-gray-200",children:(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,g.jsx)("div",{className:"w-4 h-4 rounded-full ".concat("completed"===e.status?"bg-green-500":"in-progress"===e.status?"bg-yellow-500":"delayed"===e.status?"bg-red-500":"bg-gray-400")}),(0,g.jsxs)("div",{children:[(0,g.jsxs)("h3",{className:"font-semibold text-gray-800",children:[e.name,(0,g.jsxs)("span",{className:"ml-2 text-sm font-medium text-blue-600",children:["[",ee(e,ie),"%]"]})]}),(0,g.jsx)("p",{className:"text-sm text-gray-600",children:e.endDate?new Date(e.endDate).toLocaleDateString("es-ES"):"Sin fecha"})]})]}),(0,g.jsx)("div",{className:"flex items-center space-x-2",children:H.canEdit?(0,g.jsxs)("select",{value:e.status||"in-progress",onChange:s=>{const t=s.target.value;console.log("\ud83c\udfaf CAMBIO DE ESTADO DE HITO:",{milestoneId:e.id,milestoneName:e.name,oldStatus:e.status,newStatus:t,currentProjectId:b});const r=ie.map(s=>s.id===e.id?(0,a.A)((0,a.A)({},s),{},{status:t}):s);console.log("\ud83c\udfaf TAREAS ACTUALIZADAS:",{totalTasks:r.length,milestoneTasks:r.filter(e=>e.isMilestone).length,updatedMilestone:r.find(s=>s.id===e.id)}),A(r)},className:"px-3 py-1 rounded-full text-xs font-medium border-0 focus:ring-2 focus:ring-blue-500 ".concat("completed"===e.status?"bg-green-100 text-green-800":"in-progress"===e.status?"bg-yellow-100 text-yellow-800":"delayed"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:[(0,g.jsx)("option",{value:"in-progress",className:"bg-yellow-100 text-yellow-800",children:"En Proceso"}),(0,g.jsx)("option",{value:"completed",className:"bg-green-100 text-green-800",children:"Realizado"}),(0,g.jsx)("option",{value:"delayed",className:"bg-red-100 text-red-800",children:"Atrasado"})]}):(0,g.jsxs)("div",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat("completed"===e.status?"bg-green-100 text-green-800":"in-progress"===e.status?"bg-yellow-100 text-yellow-800":"delayed"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:["completed"===e.status?"Realizado":"in-progress"===e.status?"En Proceso":"delayed"===e.status?"Atrasado":"Pendiente",(0,g.jsx)("span",{className:"ml-1 text-gray-500",children:"\ud83d\udc40"})]})})]})},e.id)),(!ie||0===ie.filter(e=>e.isMilestone).length)&&(0,g.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,g.jsx)("span",{className:"text-4xl mb-4 block",children:"\ud83c\udfaf"}),(0,g.jsx)("p",{children:"No hay hitos definidos para este proyecto"})]})]})]}),(0,g.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500",children:[(0,g.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center justify-between",children:[(0,g.jsxs)("div",{className:"flex items-center",children:[(0,g.jsx)("span",{className:"text-3xl mr-3",children:"\u26a0\ufe0f"}),"Alerta Tareas por Vencer",(0,g.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"(Vencidas + Pr\xf3ximas a vencer - Cronograma + Minutas)"})]}),(0,g.jsx)("span",{className:"text-sm bg-orange-100 text-orange-800 px-3 py-1 rounded-full",children:(()=>{const e=se(_,ie),s=ae(ie,_).reduce((e,s)=>e+s.tasks.length,0)+e.length;return"".concat(s," tareas")})()})]}),(()=>{const e=se(_,ie),s=ae(ie,_);return s.length>0||e.length>0?(0,g.jsxs)("div",{className:"space-y-6",children:[e.length>0&&(0,g.jsx)(p,{orphanedTasks:e,availableMilestones:ie.filter(e=>e.isMilestone),onReassign:(e,s)=>{Z(t=>t.map(t=>t.id===e?(0,a.A)((0,a.A)({},t),{},{hitoId:s}):t))},updateMinutaTaskHito:te}),s.map((e,s)=>(0,g.jsxs)("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 p-4 rounded-lg border border-orange-200",children:[(0,g.jsxs)("div",{className:"flex items-center mb-3",children:[(0,g.jsx)("div",{className:"w-3 h-3 rounded-full bg-orange-500 mr-3"}),(0,g.jsx)("h3",{className:"font-semibold text-gray-800 text-lg",children:e.milestone.name}),(0,g.jsxs)("span",{className:"ml-2 text-sm text-orange-600",children:["(",e.tasks.length," tareas)"]})]}),(0,g.jsx)("div",{className:"space-y-2",children:e.tasks.map((e,s)=>{const t=Math.ceil((new Date(e.endDate)-new Date)/864e5),a=t<0,r=a?"text-red-700 bg-red-200 border-red-300":0===t?"text-red-600 bg-red-100 border-red-200":t<=3?"text-orange-600 bg-orange-100 border-orange-200":t<=7?"text-yellow-600 bg-yellow-100 border-yellow-200":"text-blue-600 bg-blue-100 border-blue-200";return(0,g.jsx)("div",{className:"bg-white p-3 rounded-lg border border-gray-200 shadow-sm",children:(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{className:"flex-1",children:[(0,g.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,g.jsx)("h4",{className:"font-medium text-gray-800",children:e.name}),"cronograma"===e.source?(0,g.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full flex items-center",children:[(0,g.jsx)("span",{className:"mr-1",children:"\ud83d\udccb"}),"Cronograma"]}):(0,g.jsxs)("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full flex items-center",children:[(0,g.jsx)("span",{className:"mr-1",children:"\ud83d\udcdd"}),"Minuta"]})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-4 mt-1 text-sm text-gray-600",children:[(0,g.jsxs)("span",{children:["\ud83d\udcc5 ",new Date(e.endDate).toLocaleDateString("es-ES")]}),(0,g.jsxs)("span",{children:["\ud83d\udc64 ",e.assignedTo||e.responsable||"Sin asignar"]}),(0,g.jsxs)("span",{children:["\ud83d\udcca ",e.progress||0,"% completado"]}),e.estatus&&(0,g.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("Completado"===e.estatus?"bg-green-100 text-green-800":"En Proceso"===e.estatus?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.estatus})]})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(r),children:a?"Vencida hace ".concat(Math.abs(t)," d\xedas"):0===t?"Vence hoy":1===t?"Vence ma\xf1ana":"Vence en ".concat(t," d\xedas")}),(0,g.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:(0,g.jsx)("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:"".concat(e.progress||0,"%")}})})]})]})},e.id)})})]},e.milestone.id))]}):(0,g.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,g.jsx)("span",{className:"text-4xl mb-4 block",children:"\u2705"}),(0,g.jsx)("p",{children:"\xa1Excelente! No hay tareas pr\xf3ximas a vencer"}),(0,g.jsx)("p",{className:"text-sm mt-2",children:"Todas las tareas del cronograma y minutas est\xe1n al d\xeda o completadas"})]})})()]})]}),"risks"===z&&(0,g.jsx)(n.default,{projects:h,currentProjectId:b,setCurrentProjectId:j,risks:me,setRisks:N,useSupabase:B}),"schedule"===z&&(0,g.jsx)(i.default,{tasks:ie,setTasks:A,importTasks:S,projectData:re,onScheduleDataChange:U,includeWeekends:C,setIncludeWeekends:E,useSupabase:B,updateProjectMinutas:G}),"financial"===z&&(0,g.jsx)(l.default,{workPackages:ne,setWorkPackages:f,currentProject:re,risks:me,scheduleData:K,includeWeekends:C,purchaseOrders:P,setPurchaseOrders:I,advances:M,setAdvances:O,invoices:T,setInvoices:R,contracts:F,setContracts:L,useSupabase:B}),"resources"===z&&(0,g.jsx)(d.default,{projects:h,workPackages:ne,currentProject:re,includeWeekends:C}),"changes"===z&&(0,g.jsx)(m.default,{currentProjectId:b,projects:h,workPackages:ne,tasks:ie,purchaseOrders:le,advances:de,invoices:oe,contracts:ce,onUpdateProject:()=>{console.log("Proyecto actualizado por cambio aprobado")}}),"cashflow"===z&&(0,g.jsx)(x.default,{currentProjectId:null===re||void 0===re?void 0:re.id,currentProject:re,projects:h,workPackages:ne,tasks:k,purchaseOrders:le,advances:de,invoices:oe,contracts:ce}),"files"===z&&(0,g.jsx)(o.default,{projectId:b,category:"general",onFileUploaded:()=>{}}),"audit"===z&&(0,g.jsx)(c.default,{projects:h,currentProjectId:b,workPackages:v,risks:y,tasks:k,purchaseOrders:P,advances:M,invoices:T,contracts:F,resourceAssignments:q,useSupabase:B})]})]})]}):(0,g.jsxs)("div",{className:"text-center py-12",children:[(0,g.jsx)("div",{className:"text-4xl mb-4",children:"\ud83d\udcca"}),(0,g.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Selecciona un Proyecto"}),(0,g.jsx)("p",{className:"text-gray-600",children:"Elige un proyecto activo para ver su gesti\xf3n detallada"})]})}}}]);
"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[218,543,781,924],{1887:(e,a,n)=>{n.d(a,{A6:()=>i,ZY:()=>o,gZ:()=>s,kr:()=>l});const r={OWNER:"owner",ADMIN:"admin",MEMBER_WRITE:"organization_member_write",MEMBER_READ:"organization_member_read"},i={EXECUTIVE:"executive",SPONSOR:"sponsor",PROJECT_MANAGER:"project_manager",FINANCE_MANAGER:"finance_manager",QUALITY_MANAGER:"quality_manager",TECHNICAL_LEAD:"technical_lead",PMO_ASSISTANT:"pmo_assistant",PROJECT_COORDINATOR:"project_coordinator",TEAM_MEMBER:"team_member",AUDITOR:"auditor"},o={[i.EXECUTIVE]:{label:"Ejecutivo",description:"Toma decisiones estrat\xe9gicas y aprueba cambios cr\xedticos",icon:"\ud83d\udc54",color:"purple",badge:"bg-purple-100 text-purple-800"},[i.SPONSOR]:{label:"Patrocinador",description:"Aprueba cambios mayores del proyecto",icon:"\ud83c\udfaf",color:"blue",badge:"bg-blue-100 text-blue-800"},[i.PROJECT_MANAGER]:{label:"Project Manager",description:"Gestiona proyectos y aprueba cambios menores",icon:"\ud83d\udcca",color:"indigo",badge:"bg-indigo-100 text-indigo-800"},[i.FINANCE_MANAGER]:{label:"Gerente Financiero",description:"Aprueba impacto financiero de cambios",icon:"\ud83d\udcb0",color:"green",badge:"bg-green-100 text-green-800"},[i.QUALITY_MANAGER]:{label:"Gerente de Calidad",description:"Valida impacto en calidad",icon:"\u2b50",color:"yellow",badge:"bg-yellow-100 text-yellow-800"},[i.TECHNICAL_LEAD]:{label:"L\xedder T\xe9cnico",description:"Realiza an\xe1lisis t\xe9cnico de cambios",icon:"\ud83d\udd27",color:"cyan",badge:"bg-cyan-100 text-cyan-800"},[i.PMO_ASSISTANT]:{label:"Asistente PMO",description:"Soporte operativo y seguimiento",icon:"\ud83d\udccb",color:"teal",badge:"bg-teal-100 text-teal-800"},[i.PROJECT_COORDINATOR]:{label:"Coordinador de Proyectos",description:"Coordina tareas y actividades",icon:"\ud83d\udcc5",color:"orange",badge:"bg-orange-100 text-orange-800"},[i.TEAM_MEMBER]:{label:"Miembro de Equipo",description:"Participa en el proyecto y solicita cambios",icon:"\ud83d\udc64",color:"gray",badge:"bg-gray-100 text-gray-800"},[i.AUDITOR]:{label:"Auditor",description:"Solo lectura para auditor\xeda",icon:"\ud83d\udd0d",color:"slate",badge:"bg-slate-100 text-slate-800"}},t={[r.OWNER]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!0,canVoteInCCB:!0,canAssign:!0,canComment:!0,canViewAll:!0,approvalLimit:{cost:1/0,schedule:1/0},changeRole:"executive_board",level:"unlimited"},[r.ADMIN]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!0,canVoteInCCB:!0,canAssign:!0,canComment:!0,canViewAll:!0,approvalLimit:{cost:1/0,schedule:1/0},changeRole:"executive_board",level:"unlimited"},[r.MEMBER_WRITE]:{default:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!0,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"team_member",level:"basic"},[i.EXECUTIVE]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!1,canVoteInCCB:!0,canAssign:!0,canComment:!0,canViewAll:!0,approvalLimit:{cost:1/0,schedule:1/0},changeRole:"executive_board",level:"executive"},[i.SPONSOR]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!1,canVoteInCCB:!0,canAssign:!0,canComment:!0,canViewAll:!0,approvalLimit:{cost:1e5,schedule:30},changeRole:"sponsor",level:"high"},[i.PROJECT_MANAGER]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!0,canVoteInCCB:!0,canAssign:!0,canComment:!0,canViewAll:!0,approvalLimit:{cost:25e3,schedule:15},changeRole:"project_manager",level:"medium"},[i.FINANCE_MANAGER]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!1,canVoteInCCB:!0,canAssign:!1,canComment:!0,canViewAll:!0,approvalLimit:{cost:1e5,schedule:0},changeRole:"finance_manager",level:"specialized"},[i.QUALITY_MANAGER]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!1,canVoteInCCB:!0,canAssign:!1,canComment:!0,canViewAll:!0,approvalLimit:{cost:0,schedule:0},changeRole:"quality_manager",level:"specialized"},[i.TECHNICAL_LEAD]:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!0,canVoteInCCB:!0,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"technical_lead",level:"technical"},[i.PMO_ASSISTANT]:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!0,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"pmo_assistant",level:"operational"},[i.PROJECT_COORDINATOR]:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!0,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"project_coordinator",level:"operational"},[i.TEAM_MEMBER]:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"team_member",level:"basic"}},[r.MEMBER_READ]:{default:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"observer",level:"readonly"},[i.AUDITOR]:{canCreate:!1,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!0,approvalLimit:{cost:0,schedule:0},changeRole:"auditor",level:"audit"}}},s=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return{canCreate:!1,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!1,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"none",level:"none"};const n=t[e];return n?e===r.OWNER||e===r.ADMIN?n:a&&n[a]?n[a]:n.default||n:t[r.MEMBER_READ].default},l=e=>{var a;return e?(null===(a=o[e])||void 0===a?void 0:a.label)||e:"Sin rol espec\xedfico"}},6057:(e,a,n)=>{n.r(a),n.d(a,{default:()=>d});var r=n(5043),i=n(6877),o=n(6069),t=n(579);const s="https://ogqpsrsssrrytrqoyyph.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ncXBzcnNzc3JyeXRycW95eXBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3Nzc5NjAsImV4cCI6MjA3MzM1Mzk2MH0.EqXjG1iefYMZ84Tw-4po98gBV7uRuPoz0idQgJ03pzg",c=s&&l?(0,o.UU)(s,l):null,d=e=>{let{isOpen:a,onClose:n,limitType:o="project",currentPlan:s="free",currentCount:l=0,maxCount:d=0,organizationId:u=null,onUpgradeSuccess:m=null}=e;const[p,g]=(0,r.useState)(!1),[h,x]=(0,r.useState)("stripe");if(!a)return null;const v={project:{title:"\xa1Alcanzaste el l\xedmite de proyectos!",current:"Tienes ".concat(l," de ").concat(d," proyectos"),benefit:"Proyectos ilimitados"},user:{title:"\xa1Alcanzaste el l\xedmite de usuarios!",current:"Tienes ".concat(l," de ").concat(d," usuarios"),benefit:"Usuarios ilimitados"}},b=v[o]||v.project;return(0,t.jsx)("div",{className:"upgrade-modal-overlay",onClick:n,children:(0,t.jsxs)("div",{className:"upgrade-modal-content",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("button",{className:"upgrade-modal-close",onClick:n,children:"\xd7"}),(0,t.jsx)("div",{className:"upgrade-modal-icon",children:(0,t.jsxs)("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",children:[(0,t.jsx)("circle",{cx:"32",cy:"32",r:"30",fill:"#FEF3C7"}),(0,t.jsx)("path",{d:"M32 16L38 28H26L32 16Z",fill:"#F59E0B"}),(0,t.jsx)("circle",{cx:"32",cy:"36",r:"2",fill:"#F59E0B"}),(0,t.jsx)("rect",{x:"30",y:"42",width:"4",height:"8",rx:"2",fill:"#F59E0B"})]})}),(0,t.jsx)("h2",{className:"upgrade-modal-title",children:b.title}),(0,t.jsx)("p",{className:"upgrade-modal-subtitle",children:b.current}),(0,t.jsxs)("div",{className:"upgrade-plans-comparison",children:[(0,t.jsxs)("div",{className:"upgrade-plan-card upgrade-plan-current",children:[(0,t.jsxs)("div",{className:"upgrade-plan-header",children:[(0,t.jsx)("h3",{children:"Plan Free"}),(0,t.jsx)("span",{className:"upgrade-plan-badge",children:"Plan Actual"})]}),(0,t.jsxs)("div",{className:"upgrade-plan-price",children:["$0",(0,t.jsx)("span",{children:"/mes"})]}),(0,t.jsxs)("ul",{className:"upgrade-plan-features",children:[(0,t.jsxs)("li",{className:"upgrade-feature-limited",children:[(0,t.jsx)("span",{className:"upgrade-feature-icon",children:"\ud83d\udcca"}),(0,t.jsx)("span",{children:"1 proyecto"})]}),(0,t.jsxs)("li",{className:"upgrade-feature-limited",children:[(0,t.jsx)("span",{className:"upgrade-feature-icon",children:"\ud83d\udc65"}),(0,t.jsx)("span",{children:"3 usuarios"})]}),(0,t.jsxs)("li",{className:"upgrade-feature-included",children:[(0,t.jsx)("span",{className:"upgrade-feature-icon",children:"\u2713"}),(0,t.jsx)("span",{children:"Todas las funciones b\xe1sicas"})]})]})]}),(0,t.jsxs)("div",{className:"upgrade-plan-card upgrade-plan-recommended",children:[(0,t.jsxs)("div",{className:"upgrade-plan-header",children:[(0,t.jsx)("h3",{children:"Plan Professional"}),(0,t.jsx)("span",{className:"upgrade-plan-badge upgrade-plan-badge-pro",children:"Recomendado"})]}),(0,t.jsxs)("div",{className:"upgrade-plan-price",children:["$39",(0,t.jsx)("span",{children:"/mes"})]}),(0,t.jsxs)("ul",{className:"upgrade-plan-features",children:[(0,t.jsxs)("li",{className:"upgrade-feature-included",children:[(0,t.jsx)("span",{className:"upgrade-feature-icon",children:"\u2713"}),(0,t.jsx)("span",{children:(0,t.jsx)("strong",{children:"Proyectos ilimitados"})})]}),(0,t.jsxs)("li",{className:"upgrade-feature-included",children:[(0,t.jsx)("span",{className:"upgrade-feature-icon",children:"\u2713"}),(0,t.jsx)("span",{children:(0,t.jsx)("strong",{children:"Usuarios ilimitados"})})]}),(0,t.jsxs)("li",{className:"upgrade-feature-included",children:[(0,t.jsx)("span",{className:"upgrade-feature-icon",children:"\u2713"}),(0,t.jsx)("span",{children:"Soporte prioritario"})]}),(0,t.jsxs)("li",{className:"upgrade-feature-included",children:[(0,t.jsx)("span",{className:"upgrade-feature-icon",children:"\u2713"}),(0,t.jsx)("span",{children:"Reportes avanzados"})]})]}),(0,t.jsx)("button",{className:"upgrade-btn-primary",onClick:()=>{"stripe"===h?(async()=>{if(u)if(c){g(!0);try{const{data:{user:a}}=await c.auth.getUser(),n=(null===a||void 0===a?void 0:a.email)||"noemail@example.com",r=localStorage.getItem("strategiapm_portfolio_data");let i="Organization";if(r){var e;const a=JSON.parse(r);i=(null===a||void 0===a||null===(e=a.organization)||void 0===e?void 0:e.name)||i}console.log("[UpgradeModal] Creando sesi\xf3n de checkout para:",{organizationId:u,organizationName:i,userEmail:n});const{data:o,error:t}=await c.functions.invoke("create-checkout-session",{body:{organizationId:u,organizationName:i,userEmail:n,priceId:"price_1SPALq48wwYDYLIkLRP4SFG6",plan:"professional"}});if(t)throw new Error(t.message||"Error al crear sesi\xf3n de checkout");if(!o||!o.url)throw new Error("No se recibi\xf3 URL de checkout de Stripe");console.log("[UpgradeModal] Sesi\xf3n creada, redirigiendo a Stripe..."),window.location.href=o.url}catch(a){console.error("[UpgradeModal] Error en checkout:",a),alert("\u274c Error al procesar el pago: ".concat(a.message,"\n\nPor favor intenta de nuevo o contacta con soporte.")),g(!1)}}else alert("\u274c Error: Supabase no est\xe1 configurado correctamente.");else alert("\u274c Error: No se pudo identificar la organizaci\xf3n. Intenta recargar la p\xe1gina.")})():(async()=>{if(!u)return void alert("\u274c Error: No se pudo identificar la organizaci\xf3n. Intenta recargar la p\xe1gina.");if(window.confirm("\u26a0\ufe0f MODO SIMULACI\xd3N (Solo para desarrollo)\n\n\xbfConfirmas que deseas actualizar al Plan Professional?\n\n\ud83d\udcca Beneficios:\n\u2022 Proyectos ilimitados\n\u2022 Usuarios ilimitados\n\u2022 Soporte prioritario\n\u2022 Reportes avanzados\n\nNOTA: Esto es una simulaci\xf3n SIN PAGO REAL.\n\n\xbfContinuar?")){g(!0);try{const a=localStorage.getItem("strategiapm_portfolio_data");let r=null;if(a){var e;const n=JSON.parse(a);r=null===n||void 0===n||null===(e=n.user)||void 0===e?void 0:e.id}const o=await i.A.changePlan(u,"professional",r);if(!o.success)throw new Error(o.error||"Error desconocido");alert("\u2705 \xa1Plan actualizado exitosamente a Professional!\n\nBeneficios activados:\n\u2022 Proyectos ilimitados \u2713\n\u2022 Usuarios ilimitados \u2713\n\u2022 Soporte prioritario \u2713\n\n\ud83d\udd04 Recarga la p\xe1gina para ver los cambios reflejados."),m&&m(),n(),setTimeout(()=>{window.location.reload()},2e3)}catch(a){console.error("Error actualizando plan:",a),alert("\u274c Error al actualizar el plan: ".concat(a.message,"\n\nPor favor intenta de nuevo o contacta con soporte."))}finally{g(!1)}}})()},disabled:p,children:p?"stripe"===h?"Procesando...":"Actualizando...":"stripe"===h?"Ir a Checkout de Stripe":"Actualizar a Professional (Simulaci\xf3n)"})]})]}),!1,(0,t.jsxs)("p",{className:"upgrade-modal-footer",children:["\xbfPreguntas? ",(0,t.jsx)("a",{href:"mailto:soporte@strategiapm.com",children:"Contacta con soporte"})]}),(0,t.jsx)("button",{className:"upgrade-btn-secondary",onClick:n,children:"Ahora no"})]})})}},6218:(e,a,n)=>{n.r(a),n.d(a,{default:()=>D});var r=n(5452),i=n(5043),o=n(9543),t=n(2416),s=n(6877),l=n(1887);const c={OWNER:"owner",ADMIN:"admin",MEMBER_WRITE:"member_write",MEMBER_READ:"member_read"},d={[c.OWNER]:"\ud83d\udc51 Propietario",[c.ADMIN]:"\ud83d\udc51 Administrador",[c.MEMBER_WRITE]:"\u270f\ufe0f Miembro (Editar)",[c.MEMBER_READ]:"\ud83d\udc40 Miembro (Solo lectura)"},u={[c.OWNER]:"Control total de la organizaci\xf3n, puede gestionar miembros y proyectos",[c.ADMIN]:"Puede gestionar usuarios y proyectos de la organizaci\xf3n",[c.MEMBER_WRITE]:"Puede crear, editar y eliminar proyectos de la organizaci\xf3n",[c.MEMBER_READ]:"Solo puede ver proyectos de la organizaci\xf3n"},m={[c.OWNER]:{canInvite:!0,canEditRoles:!0,canRemoveMembers:!0,canEditProjects:!0,canDeleteProjects:!0,canViewAll:!0},[c.ADMIN]:{canInvite:!0,canEditRoles:!0,canRemoveMembers:!1,canEditProjects:!0,canDeleteProjects:!0,canViewAll:!0},[c.MEMBER_WRITE]:{canInvite:!1,canEditRoles:!1,canRemoveMembers:!1,canEditProjects:!0,canDeleteProjects:!1,canViewAll:!0},[c.MEMBER_READ]:{canInvite:!1,canEditRoles:!1,canRemoveMembers:!1,canEditProjects:!1,canDeleteProjects:!1,canViewAll:!0}},p={organization_owner:c.OWNER,organization_member_write:c.MEMBER_WRITE,organization_member_read:c.MEMBER_READ,admin:c.ADMIN,owner:c.OWNER,member:c.MEMBER_WRITE},g=[{value:c.OWNER,label:d[c.OWNER],description:u[c.OWNER]},{value:c.ADMIN,label:d[c.ADMIN],description:u[c.ADMIN]},{value:c.MEMBER_WRITE,label:d[c.MEMBER_WRITE],description:u[c.MEMBER_WRITE]},{value:c.MEMBER_READ,label:d[c.MEMBER_READ],description:u[c.MEMBER_READ]}],h=e=>p[e]||c.MEMBER_READ,x=e=>Object.values(c).includes(e),v=e=>m[e]||m[c.MEMBER_READ],b=(e,a)=>!0===v(e)[a],E=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{fallbackFromProject:a=null,required:n=!0}=e,[r,o]=(0,i.useState)(null),[s,l]=(0,i.useState)(!0),[c,d]=(0,i.useState)(null);return(0,i.useEffect)(()=>{(async()=>{try{if(console.log("\ud83d\udd0d useOrganizationId - Iniciando detecci\xf3n",{fallbackFromProject:a,required:n}),l(!0),d(null),a)return console.log("\u2705 Organization ID detectado desde proyecto:",a),o(a),void l(!1);console.log("\u23ed\ufe0f No hay fallbackFromProject, intentando desde servicio...");const e=t.default.getCurrentOrganization();if(e)return console.log("\u2705 Organization ID detectado desde servicio:",e),o(e),void l(!1);console.log("\ud83d\udd0d Intentando detectar organizaci\xf3n autom\xe1ticamente...");const r=await t.default.detectUserOrganization();if(r&&r.id)return console.log("\u2705 Organization ID auto-detectado:",r.id),console.log("\u2705 Nombre de organizaci\xf3n:",r.name),console.log("\u2705 Rol del usuario:",r.role),o(r.id),void l(!1);const i="No se pudo detectar organization_id. El usuario no pertenece a ninguna organizaci\xf3n.";console.error("\u274c",i),n&&d(i),o(null),l(!1)}catch(e){console.error("\u274c Error detectando organizaci\xf3n:",e),d(e.message),o(null),l(!1)}})()},[a,n]),{organizationId:r,loading:s,error:c,isValid:!!r,hasError:!!c}};var A=n(8437);const j=()=>(0,i.useMemo)(()=>({mapRole:e=>e?h(e):"member_read",isValidRole:x,getRolePermissions:v,hasPermission:b,validateRoleConsistency:e=>{const a=[],n={total:e.length,valid:0,invalid:0,legacy:0};return e.forEach(e=>{const r=e.role,i=h(r);r!==i&&n.legacy++,x(i)?n.valid++:(n.invalid++,a.push({user:e.user_email||e.email,originalRole:r,mappedRole:i,issue:"Mapped role is not valid"}))}),{issues:a,stats:n,isConsistent:0===a.length}}}),[]),N=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{currentUser:a,userEmail:n,isAuthenticated:r}=(0,A.A)(),{mapRole:o,hasPermission:t}=j();return(0,i.useMemo)(()=>{if(!r||!n)return{currentUser:null,currentUserMembership:null,currentUserRole:null,mappedRole:null,isOwnerOrAdmin:!1,isOwner:!1,isAdmin:!1,isMember:!1,canInvite:!1,canEditRoles:!1,canRemoveMembers:!1};const i=e.find(e=>e.user_email===n);if(!i)return{currentUser:a,currentUserMembership:null,currentUserRole:null,mappedRole:null,isOwnerOrAdmin:!1,isOwner:!1,isAdmin:!1,isMember:!1,canInvite:!1,canEditRoles:!1,canRemoveMembers:!1};const s=i.role,l=o(s),d=l===c.OWNER,u=l===c.ADMIN;return{currentUser:a,currentUserMembership:i,currentUserRole:s,mappedRole:l,isOwnerOrAdmin:d||u,isOwner:d,isAdmin:u,isMember:l===c.MEMBER_WRITE||l===c.MEMBER_READ,canInvite:t(l,"canInvite"),canEditRoles:t(l,"canEditRoles"),canRemoveMembers:t(l,"canRemoveMembers"),canEditMember:e=>{if(!t(l,"canEditRoles"))return!1;if(d)return!0;return o(null===e||void 0===e?void 0:e.role)!==c.OWNER},canRemoveMember:e=>{if(!t(l,"canRemoveMembers"))return!1;if((null===e||void 0===e?void 0:e.user_email)===n)return!1;if(d)return!0;const a=o(null===e||void 0===e?void 0:e.role);return a!==c.OWNER&&a!==c.ADMIN}}},[e,a,n,r,o,t])};var f=n(9379);const R={showModal:!1,email:"",role:"organization_member_write",functionalRole:"",isLoading:!1,error:null},y="OPEN_MODAL",C="CLOSE_MODAL",I="SET_EMAIL",_="SET_ROLE",M="SET_FUNCTIONAL_ROLE",w="SET_LOADING",S="SET_ERROR",O="RESET_FORM";function T(e,a){switch(a.type){case y:return(0,f.A)((0,f.A)({},e),{},{showModal:!0});case C:return(0,f.A)((0,f.A)({},e),{},{showModal:!1});case I:return(0,f.A)((0,f.A)({},e),{},{email:a.payload});case _:return(0,f.A)((0,f.A)({},e),{},{role:a.payload});case M:return(0,f.A)((0,f.A)({},e),{},{functionalRole:a.payload});case w:return(0,f.A)((0,f.A)({},e),{},{isLoading:a.payload});case S:return(0,f.A)((0,f.A)({},e),{},{error:a.payload});case O:return(0,f.A)((0,f.A)({},R),{},{showModal:e.showModal});default:return e}}const z=()=>{const[e,a]=(0,i.useReducer)(T,R);return{state:e,actions:{openModal:()=>a({type:y}),closeModal:()=>a({type:C}),setEmail:e=>a({type:I,payload:e}),setRole:e=>a({type:_,payload:e}),setFunctionalRole:e=>a({type:M,payload:e}),setLoading:e=>a({type:w,payload:e}),setError:e=>a({type:S,payload:e}),resetForm:()=>a({type:O})}}};function P(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const a=function(){const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUPABASE_URL:"https://ogqpsrsssrrytrqoyyph.supabase.co",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ncXBzcnNzc3JyeXRycW95eXBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3Nzc5NjAsImV4cCI6MjA3MzM1Mzk2MH0.EqXjG1iefYMZ84Tw-4po98gBV7uRuPoz0idQgJ03pzg",REACT_APP_STRIPE_PRICE_ID:"price_1SPALq48wwYDYLIkLRP4SFG6",REACT_APP_STRIPE_PUBLISHABLE_KEY:"pk_test_51SP6W448wvYDYLIkedrAG0cQnUrDwzRw708u2t6I7uEPIHFziT9i1fV90XXuEpSX0gCcpH0rHzuYjTZGivevrFqb00dosZzmjw"}.REACT_APP_BASE_URL;if(e)return e;const a=window.location.hostname;return"localhost"===a||"127.0.0.1"===a?"http://".concat(a,":").concat(window.location.port||3e3):window.location.origin}(),n=e.startsWith("/")?e:"/".concat(e);return"".concat(a).concat(n)}var k=n(579);const L=function(e){let{isOpen:a,onClose:n,invitation:r}=e;const[o,t]=(0,i.useState)(!1);if(!a||!r)return null;const s=P("/signup?email=".concat(encodeURIComponent(r.user_email),"&invited=true&org=").concat(r.organization_id));return(0,k.jsx)("div",{className:"invitation-modal-overlay",onClick:n,children:(0,k.jsxs)("div",{className:"invitation-modal",onClick:e=>e.stopPropagation(),children:[(0,k.jsxs)("div",{className:"invitation-modal-header",children:[(0,k.jsx)("h2",{children:"\u2705 Invitaci\xf3n Creada"}),(0,k.jsx)("button",{className:"close-button",onClick:n,children:"\xd7"})]}),(0,k.jsxs)("div",{className:"invitation-modal-body",children:[(0,k.jsxs)("div",{className:"invitation-info",children:[(0,k.jsxs)("p",{className:"invited-email",children:["\ud83d\udce7 ",(0,k.jsx)("strong",{children:r.user_email})]}),(0,k.jsxs)("p",{className:"invited-role",children:["Rol: ",(0,k.jsx)("span",{className:"role-badge",children:r.role})]})]}),(0,k.jsxs)("div",{className:"invitation-instructions",children:[(0,k.jsx)("h3",{children:"\ud83d\udccb C\xf3mo compartir esta invitaci\xf3n:"}),(0,k.jsxs)("ol",{children:[(0,k.jsx)("li",{children:"Copia el enlace de abajo"}),(0,k.jsx)("li",{children:"Env\xedalo al usuario por WhatsApp, email, o Slack"}),(0,k.jsx)("li",{children:"El usuario solo debe hacer clic y registrarse"}),(0,k.jsx)("li",{children:"Una vez registrado, tendr\xe1 acceso autom\xe1tico"})]})]}),(0,k.jsxs)("div",{className:"invitation-link-section",children:[(0,k.jsx)("label",{children:"\ud83d\udd17 Enlace de invitaci\xf3n:"}),(0,k.jsxs)("div",{className:"link-container",children:[(0,k.jsx)("input",{type:"text",value:s,readOnly:!0,className:"invitation-link-input"}),(0,k.jsx)("button",{className:"copy-button ".concat(o?"copied":""),onClick:async()=>{try{await navigator.clipboard.writeText(s),t(!0),setTimeout(()=>t(!1),3e3)}catch(e){console.error("Error copiando enlace:",e);const a=document.createElement("textarea");a.value=s,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),t(!0),setTimeout(()=>t(!1),3e3)}},children:o?"\u2705 Copiado":"\ud83d\udccb Copiar"})]})]}),(0,k.jsxs)("div",{className:"share-options",children:[(0,k.jsx)("h4",{children:"O compartir directamente:"}),(0,k.jsxs)("div",{className:"share-buttons",children:[(0,k.jsx)("button",{className:"share-btn whatsapp",onClick:()=>{const e=encodeURIComponent("\ud83c\udf89 \xa1Has sido invitado a unirte a nuestra organizaci\xf3n en StrategiaPM!\n\n"+"Haz clic en este enlace para registrarte:\n".concat(s,"\n\n")+"Importante: Usa el email ".concat(r.user_email," al registrarte."));window.open("https://wa.me/?text=".concat(e),"_blank")},children:"\ud83d\udcac WhatsApp"}),(0,k.jsx)("button",{className:"share-btn email",onClick:()=>{const e=encodeURIComponent("Invitaci\xf3n a StrategiaPM"),a=encodeURIComponent("Has sido invitado a unirte a nuestra organizaci\xf3n en StrategiaPM.\n\n"+"Haz clic en este enlace para registrarte:\n".concat(s,"\n\n")+"Importante: Debes registrarte usando el email ".concat(r.user_email,"\n\n")+"Una vez registrado, tendr\xe1s acceso autom\xe1tico a la organizaci\xf3n.");window.location.href="mailto:".concat(r.user_email,"?subject=").concat(e,"&body=").concat(a)},children:"\ud83d\udce7 Email"})]})]}),(0,k.jsx)("div",{className:"invitation-note",children:(0,k.jsxs)("p",{children:["\u26a0\ufe0f ",(0,k.jsx)("strong",{children:"Importante:"})," El usuario debe registrarse usando exactamente el email ",(0,k.jsx)("strong",{children:r.user_email})]})})]}),(0,k.jsx)("div",{className:"invitation-modal-footer",children:(0,k.jsx)("button",{className:"btn-primary",onClick:n,children:"Entendido"})})]})})};var U=n(6057);const D=e=>{let{currentProject:a,useSupabase:u=!1,onMemberAdded:m}=e;const[p,x]=(0,i.useState)([]),[v,b]=(0,i.useState)([]),{state:A,actions:j}=z(),f=A.showModal,R=A.email,y=A.role,C=A.functionalRole,I=e=>e?j.openModal():j.closeModal(),_=j.setEmail,M=j.setRole,w=j.setFunctionalRole,[S,O]=(0,i.useState)(!1),[T,P]=(0,i.useState)(null),[D,B]=(0,i.useState)(""),[F,Y]=(0,i.useState)(!1),[Z,V]=(0,i.useState)(null),[J,G]=(0,i.useState)(!1),[W,q]=(0,i.useState)({}),[X,H]=(0,i.useState)(null),[Q,K]=(0,i.useState)(""),[$,ee]=(0,i.useState)(!1),[ae,ne]=(0,i.useState)(null),{addAuditEvent:re}=(0,o.A)(null===a||void 0===a?void 0:a.id,u),{organizationId:ie,loading:oe,error:te}=E({fallbackFromProject:null===a||void 0===a?void 0:a.organization_id,required:!0});(0,i.useEffect)(()=>{r.vF.debug("\ud83d\udd0d OrganizationMembers - Estado actual:",{hasCurrentProject:!!a,currentProjectOrgId:null===a||void 0===a?void 0:a.organization_id,organizationId:ie,orgLoading:oe,orgError:te,useSupabase:u})},[a,ie,oe,te,u]);const{isOwnerOrAdmin:se,canInvite:le,canEditRoles:ce,canRemoveMembers:de,canEditMember:ue,canRemoveMember:me}=N(p),pe=async()=>{if(r.vF.debug("\ud83d\udd04 loadOrganizationMembers ejecut\xe1ndose",{useSupabase:u,organizationId:ie}),u){if(!ie)return r.vF.warn("\u26a0\ufe0f organizationId es null/undefined, esperando detecci\xf3n..."),void r.vF.warn("\u26a0\ufe0f Estado actual:",{orgLoading:oe,orgError:te,currentProjectOrgId:null===a||void 0===a?void 0:a.organization_id});r.vF.debug("\u2705 Iniciando carga de miembros para organization_id:",ie);try{Y(!0);const{default:e}=await Promise.resolve().then(n.bind(n,2416));if(e.isAuthenticated()){e.getCurrentUser();const{data:a,error:n}=await e.supabase.from("organization_members").select("*"),{data:i,error:o}=await e.supabase.from("organization_members").select("*").eq("organization_id",ie).order("joined_at",{ascending:!1});if(o)V("Error cargando miembros de la organizaci\xf3n");else{const e=(i||[]).filter(e=>"active"===e.status);x(e);const a=(i||[]).filter(e=>"pending"===e.status);b(a),r.vF.debug("\u2705 Total de miembros cargados:",(null===i||void 0===i?void 0:i.length)||0),r.vF.debug("\u2705 Miembros activos:",e.length),r.vF.debug("\u23f3 Invitaciones pendientes:",a.length)}}}catch(Z){V("Error cargando miembros de la organizaci\xf3n")}finally{Y(!1)}}else r.vF.warn("\u26a0\ufe0f Supabase no est\xe1 habilitado, no se cargar\xe1n miembros")},ge=e=>{var a;let{member:n,isInviteForm:i=!1,value:o,onChange:s}=e;const c=null===(a=p.find(e=>{var a;return e.user_email===(null===(a=t.default.getCurrentUser())||void 0===a?void 0:a.email)}))||void 0===a?void 0:a.role,d="owner"===c||"admin"===c;if(i)return(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rol Funcional (Opcional)"}),(0,k.jsxs)("select",{value:o||"",onChange:e=>s(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,k.jsx)("option",{value:"",children:"Sin rol espec\xedfico"}),(0,k.jsxs)("optgroup",{label:"Roles de Gesti\xf3n",children:[(0,k.jsxs)("option",{value:l.A6.EXECUTIVE,children:[l.ZY[l.A6.EXECUTIVE].icon," ",l.ZY[l.A6.EXECUTIVE].label]}),(0,k.jsxs)("option",{value:l.A6.SPONSOR,children:[l.ZY[l.A6.SPONSOR].icon," ",l.ZY[l.A6.SPONSOR].label]}),(0,k.jsxs)("option",{value:l.A6.PROJECT_MANAGER,children:[l.ZY[l.A6.PROJECT_MANAGER].icon," ",l.ZY[l.A6.PROJECT_MANAGER].label]})]}),(0,k.jsxs)("optgroup",{label:"Roles Especializados",children:[(0,k.jsxs)("option",{value:l.A6.FINANCE_MANAGER,children:[l.ZY[l.A6.FINANCE_MANAGER].icon," ",l.ZY[l.A6.FINANCE_MANAGER].label]}),(0,k.jsxs)("option",{value:l.A6.QUALITY_MANAGER,children:[l.ZY[l.A6.QUALITY_MANAGER].icon," ",l.ZY[l.A6.QUALITY_MANAGER].label]}),(0,k.jsxs)("option",{value:l.A6.TECHNICAL_LEAD,children:[l.ZY[l.A6.TECHNICAL_LEAD].icon," ",l.ZY[l.A6.TECHNICAL_LEAD].label]})]}),(0,k.jsxs)("optgroup",{label:"Roles Operativos",children:[(0,k.jsxs)("option",{value:l.A6.PMO_ASSISTANT,children:[l.ZY[l.A6.PMO_ASSISTANT].icon," ",l.ZY[l.A6.PMO_ASSISTANT].label]}),(0,k.jsxs)("option",{value:l.A6.PROJECT_COORDINATOR,children:[l.ZY[l.A6.PROJECT_COORDINATOR].icon," ",l.ZY[l.A6.PROJECT_COORDINATOR].label]}),(0,k.jsxs)("option",{value:l.A6.TEAM_MEMBER,children:[l.ZY[l.A6.TEAM_MEMBER].icon," ",l.ZY[l.A6.TEAM_MEMBER].label]})]}),(0,k.jsx)("optgroup",{label:"Roles de Supervisi\xf3n",children:(0,k.jsxs)("option",{value:l.A6.AUDITOR,children:[l.ZY[l.A6.AUDITOR].icon," ",l.ZY[l.A6.AUDITOR].label]})})]}),(0,k.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:o&&l.ZY[o]?l.ZY[o].description:"El rol funcional determina los permisos en control de cambios"})]});if(X===n.id)return(0,k.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,k.jsxs)("select",{value:Q,onChange:e=>K(e.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:[(0,k.jsx)("option",{value:"",children:"Sin rol espec\xedfico"}),(0,k.jsxs)("optgroup",{label:"Gesti\xf3n",children:[(0,k.jsxs)("option",{value:l.A6.EXECUTIVE,children:[l.ZY[l.A6.EXECUTIVE].icon," ",l.ZY[l.A6.EXECUTIVE].label]}),(0,k.jsxs)("option",{value:l.A6.SPONSOR,children:[l.ZY[l.A6.SPONSOR].icon," ",l.ZY[l.A6.SPONSOR].label]}),(0,k.jsxs)("option",{value:l.A6.PROJECT_MANAGER,children:[l.ZY[l.A6.PROJECT_MANAGER].icon," ",l.ZY[l.A6.PROJECT_MANAGER].label]})]}),(0,k.jsxs)("optgroup",{label:"Especializados",children:[(0,k.jsxs)("option",{value:l.A6.FINANCE_MANAGER,children:[l.ZY[l.A6.FINANCE_MANAGER].icon," ",l.ZY[l.A6.FINANCE_MANAGER].label]}),(0,k.jsxs)("option",{value:l.A6.QUALITY_MANAGER,children:[l.ZY[l.A6.QUALITY_MANAGER].icon," ",l.ZY[l.A6.QUALITY_MANAGER].label]}),(0,k.jsxs)("option",{value:l.A6.TECHNICAL_LEAD,children:[l.ZY[l.A6.TECHNICAL_LEAD].icon," ",l.ZY[l.A6.TECHNICAL_LEAD].label]})]}),(0,k.jsxs)("optgroup",{label:"Operativos",children:[(0,k.jsxs)("option",{value:l.A6.PMO_ASSISTANT,children:[l.ZY[l.A6.PMO_ASSISTANT].icon," ",l.ZY[l.A6.PMO_ASSISTANT].label]}),(0,k.jsxs)("option",{value:l.A6.PROJECT_COORDINATOR,children:[l.ZY[l.A6.PROJECT_COORDINATOR].icon," ",l.ZY[l.A6.PROJECT_COORDINATOR].label]}),(0,k.jsxs)("option",{value:l.A6.TEAM_MEMBER,children:[l.ZY[l.A6.TEAM_MEMBER].icon," ",l.ZY[l.A6.TEAM_MEMBER].label]})]}),(0,k.jsx)("optgroup",{label:"Supervisi\xf3n",children:(0,k.jsxs)("option",{value:l.A6.AUDITOR,children:[l.ZY[l.A6.AUDITOR].icon," ",l.ZY[l.A6.AUDITOR].label]})})]}),(0,k.jsx)("button",{onClick:()=>(async(e,a)=>{try{Y(!0);const{error:n}=await t.default.supabase.from("organization_members").update({functional_role:a||null,updated_at:(new Date).toISOString()}).eq("id",e).eq("organization_id",ie);if(n)return r.vF.error("Error actualizando rol funcional:",n),void alert("Error actualizando rol funcional: "+n.message);await pe(),H(null),K(""),alert("Rol funcional actualizado exitosamente")}catch(Z){r.vF.error("Error actualizando rol funcional:",Z),alert("Error actualizando rol funcional")}finally{Y(!1)}})(n.id,Q),className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"\u2713"}),(0,k.jsx)("button",{onClick:()=>{H(null),K("")},className:"px-3 py-1 bg-gray-300 text-gray-700 rounded text-sm hover:bg-gray-400",children:"\u2715"})]});const u=n.functional_role?l.ZY[n.functional_role]:null;return(0,k.jsxs)("div",{className:"flex items-center justify-between",children:[(0,k.jsx)("div",{children:u?(0,k.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(u.badge),children:[u.icon," ",u.label]}):(0,k.jsx)("span",{className:"text-gray-400 text-sm italic",children:"Sin rol espec\xedfico"})}),d&&"active"===n.status&&(0,k.jsx)("button",{onClick:()=>{H(n.id),K(n.functional_role||"")},className:"ml-2 text-blue-600 hover:text-blue-800 text-sm",title:"Editar rol funcional",children:"\u270f\ufe0f"})]})};if((0,i.useEffect)(()=>{pe()},[ie,u]),!u)return(0,k.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("span",{className:"text-yellow-600 text-xl mr-3",children:"\u26a0\ufe0f"}),(0,k.jsxs)("div",{children:[(0,k.jsx)("h3",{className:"text-yellow-800 font-medium",children:"Supabase no habilitado"}),(0,k.jsx)("p",{className:"text-yellow-700 text-sm",children:"Para compartir proyectos con otros usuarios, necesitas habilitar Supabase en la configuraci\xf3n."})]})]})});if(oe)return(0,k.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600 mr-3"}),(0,k.jsx)("p",{className:"text-blue-700",children:"Detectando organizaci\xf3n..."})]})});if(!ie||te)return(0,k.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("span",{className:"text-red-600 text-xl mr-3",children:"\u274c"}),(0,k.jsxs)("div",{children:[(0,k.jsx)("h3",{className:"text-red-800 font-medium",children:"No se detect\xf3 organizaci\xf3n"}),(0,k.jsx)("p",{className:"text-red-700 text-sm",children:te||"Este usuario no pertenece a ninguna organizaci\xf3n. Por favor, solicita una invitaci\xf3n."})]})]})});const he=e=>{switch(e){case"owner":return"bg-purple-100 text-purple-800";case"admin":return"bg-blue-100 text-blue-800";case"member":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},xe=e=>{const a=h(e);return d[a]||e};return(0,k.jsxs)("div",{className:"space-y-6",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Miembros de la Organizaci\xf3n"}),(0,k.jsx)("p",{className:"text-gray-600",children:"Gestiona qui\xe9n puede ver y editar los proyectos de tu organizaci\xf3n"})]}),le?(0,k.jsxs)("button",{onClick:()=>I(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[(0,k.jsx)("span",{children:"+"}),(0,k.jsx)("span",{children:"Invitar Miembro"})]}):(0,k.jsxs)("div",{className:"text-sm text-gray-500 italic bg-gray-50 px-3 py-2 rounded-lg border",children:[(0,k.jsx)("span",{children:"\ud83d\udd12"})," Solo administradores pueden invitar miembros"]})]}),Z&&(0,k.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("span",{className:"text-red-600 text-xl mr-3",children:"\u274c"}),(0,k.jsxs)("div",{children:[(0,k.jsx)("h3",{className:"text-red-800 font-medium",children:"Error"}),(0,k.jsx)("p",{className:"text-red-700 text-sm",children:Z})]})]})}),(0,k.jsx)("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,k.jsxs)("div",{className:"flex items-start",children:[(0,k.jsx)("span",{className:"text-blue-500 text-xl mr-3",children:"\u2139\ufe0f"}),(0,k.jsxs)("div",{children:[(0,k.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"Roles Funcionales en Control de Cambios"}),(0,k.jsx)("p",{className:"text-sm text-blue-700 mb-2",children:"Los roles funcionales determinan los permisos espec\xedficos en el m\xf3dulo de Control de Cambios:"}),(0,k.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,k.jsxs)("li",{children:[(0,k.jsx)("strong",{children:"Ejecutivo/Sponsor:"})," Aprueban cambios mayores sin l\xedmite"]}),(0,k.jsxs)("li",{children:[(0,k.jsx)("strong",{children:"Project Manager:"})," Aprueban cambios hasta $25K / 15 d\xedas"]}),(0,k.jsxs)("li",{children:[(0,k.jsx)("strong",{children:"Gerente Financiero:"})," Validan impacto financiero"]}),(0,k.jsxs)("li",{children:[(0,k.jsx)("strong",{children:"Miembro de Equipo:"})," Solo pueden solicitar cambios"]}),(0,k.jsxs)("li",{children:[(0,k.jsx)("strong",{children:"Sin rol espec\xedfico:"})," Permisos b\xe1sicos seg\xfan rol organizacional"]})]})]})]})}),v.length>0&&(0,k.jsxs)("div",{className:"bg-yellow-50 rounded-lg shadow-sm border border-yellow-200",children:[(0,k.jsxs)("div",{className:"p-4 border-b border-yellow-200",children:[(0,k.jsxs)("h3",{className:"text-lg font-semibold text-yellow-800 flex items-center",children:[(0,k.jsx)("span",{className:"mr-2",children:"\u23f3"}),"Invitaciones Pendientes (",v.length,")"]}),(0,k.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"Estas personas fueron invitadas pero a\xfan no han aceptado"})]}),(0,k.jsx)("div",{className:"divide-y divide-yellow-200",children:v.map(e=>{var a,n;return(0,k.jsx)("div",{className:"p-4",children:(0,k.jsxs)("div",{className:"flex items-start justify-between",children:[(0,k.jsxs)("div",{className:"flex items-start space-x-4 flex-1",children:[(0,k.jsx)("div",{className:"w-12 h-12 bg-yellow-300 rounded-full flex items-center justify-center flex-shrink-0",children:(0,k.jsx)("span",{className:"text-yellow-800 font-bold text-lg",children:"\u2709\ufe0f"})}),(0,k.jsxs)("div",{className:"flex-1",children:[(0,k.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,k.jsx)("p",{className:"font-semibold text-yellow-900 text-lg",children:e.user_email}),(0,k.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-200 text-yellow-800",children:"\u23f3 Pendiente"})]}),(0,k.jsxs)("div",{className:"space-y-1",children:[(0,k.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,k.jsx)("span",{className:"font-medium",children:"Rol:"})," ",xe(e.role)]}),e.functional_role&&(0,k.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,k.jsx)("span",{className:"font-medium",children:"Rol Funcional:"})," ",null===(a=l.ZY[e.functional_role])||void 0===a?void 0:a.icon," ",null===(n=l.ZY[e.functional_role])||void 0===n?void 0:n.label]}),e.invited_by&&(0,k.jsxs)("p",{className:"text-xs text-yellow-600 mt-2",children:["Invitado por ",(0,k.jsx)("span",{className:"font-medium",children:e.invited_by}),e.invited_at&&(0,k.jsxs)("span",{children:[" el ",new Date(e.invited_at).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric"})]})]}),e.created_at&&!e.invited_at&&(0,k.jsxs)("p",{className:"text-xs text-yellow-600 mt-2",children:["Invitado el ",new Date(e.created_at).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric"})]})]})]})]}),de&&(0,k.jsxs)("div",{className:"flex flex-col space-y-2 ml-4",children:[(0,k.jsxs)("button",{onClick:()=>(async e=>{try{const a=v.find(a=>a.id===e);if(!a)return;r.vF.debug("Reenviando invitaci\xf3n:",e);const n="localhost"===window.location.hostname?"https://strategiapm.vercel.app":window.location.origin;alert("\ud83d\udce7 Recordatorio de invitaci\xf3n\n      \nSe ha notificado nuevamente a ".concat(a.user_email,"\n\nComparte este enlace para que se registren:\n").concat(n,"\n\nUna vez registrado con ese email, tendr\xe1 acceso autom\xe1ticamente."))}catch(Z){r.vF.error("Error reenviando invitaci\xf3n:",Z),alert("Error al reenviar invitaci\xf3n")}})(e.id),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium flex items-center space-x-1 transition-colors",title:"Reenviar invitaci\xf3n",children:[(0,k.jsx)("span",{children:"\ud83d\udd04"}),(0,k.jsx)("span",{children:"Reenviar"})]}),(0,k.jsxs)("button",{onClick:()=>(async(e,a)=>{try{if(!window.confirm("\xbfEst\xe1s seguro de cancelar la invitaci\xf3n para ".concat(a,"?")))return;r.vF.debug("\ud83d\uddd1\ufe0f Cancelando invitaci\xf3n:",e);const{error:n}=await t.default.supabase.from("organization_members").delete().eq("id",e);if(n)return r.vF.error("\u274c Error cancelando invitaci\xf3n:",n),void alert("Error al cancelar invitaci\xf3n: ".concat(n.message));r.vF.debug("\u2705 Invitaci\xf3n cancelada exitosamente"),alert("\u2705 Invitaci\xf3n cancelada"),pe()}catch(n){r.vF.error("\u274c Error inesperado:",n),alert("Error: ".concat(n.message))}})(e.id,e.user_email),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 text-sm font-medium flex items-center space-x-1 transition-colors",title:"Cancelar invitaci\xf3n",children:[(0,k.jsx)("span",{children:"\u274c"}),(0,k.jsx)("span",{children:"Cancelar"})]})]})]})},e.id)})})]}),(0,k.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,k.jsx)("div",{className:"p-4 border-b",children:(0,k.jsxs)("h3",{className:"text-lg font-semibold text-gray-800",children:["Miembros Activos (",p.length,")"]})}),(0,k.jsx)("div",{className:"divide-y divide-gray-200",children:F?(0,k.jsxs)("div",{className:"p-8 text-center",children:[(0,k.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,k.jsx)("p",{className:"text-gray-600 mt-2",children:"Cargando miembros..."})]}):0===p.length?(0,k.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,k.jsx)("span",{className:"text-4xl mb-4 block",children:"\ud83d\udc65"}),(0,k.jsx)("p",{children:"No hay miembros en la organizaci\xf3n"}),(0,k.jsx)("p",{className:"text-sm",children:"Invita a otros usuarios para compartir tus proyectos"})]}):p.map(e=>(0,k.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,k.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,k.jsx)("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:(0,k.jsx)("span",{className:"text-gray-600 font-medium",children:e.user_email.charAt(0).toUpperCase()})}),(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"font-medium text-gray-900",children:e.user_email}),(0,k.jsxs)("p",{className:"text-sm text-gray-500",children:["Se uni\xf3 el ",new Date(e.joined_at).toLocaleDateString()]})]})]}),(0,k.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,k.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(he(e.role)),children:xe(e.role)}),(0,k.jsx)(ge,{member:e}),(0,k.jsxs)("div",{className:"flex items-center space-x-2",children:[ue(e)&&(0,k.jsx)("button",{onClick:()=>(e=>{P(e),B(e.role),O(!0)})(e),className:"text-blue-600 hover:text-blue-800 text-sm",title:"Cambiar rol",children:"\u270f\ufe0f"}),me(e)&&(0,k.jsx)("button",{onClick:()=>(async(e,a)=>{const i=p.find(a=>a.id===e);if(!me(i))return void(h(null===i||void 0===i?void 0:i.role)===c.OWNER?alert("\u274c No se puede eliminar al propietario de la organizaci\xf3n."):alert("\u274c No tienes permisos para eliminar este miembro."));if(window.confirm("\u26a0\ufe0f ELIMINACI\xd3N COMPLETA DE USUARIO\n\n\xbfEst\xe1s seguro de que quieres eliminar COMPLETAMENTE a ".concat(a,"?\n\nEsto eliminar\xe1:\n\u2022 Su membres\xeda en la organizaci\xf3n\n\u2022 Todos sus roles y permisos\n\u2022 Su acceso a todos los proyectos\n\nEsta acci\xf3n NO se puede deshacer.")))try{Y(!0);const{default:i}=await Promise.resolve().then(n.bind(n,2416));if(i.isAuthenticated()){const{error:n}=await i.supabase.from("organization_members").delete().eq("id",e);if(n)throw new Error("Error eliminando membres\xeda: ".concat(n.message));const{error:s}=await i.supabase.from("user_organization_roles").delete().eq("user_email",a).eq("organization_id",ie);s&&r.vF.warn("\u26a0\ufe0f Error eliminando de user_organization_roles (puede no existir):",s);const{error:l}=await i.supabase.from("tasks").update({assigned_to:null}).eq("assigned_to",a);l&&r.vF.warn("\u26a0\ufe0f Error actualizando tareas:",l);const{error:c}=await i.supabase.from("risks").update({owner:null}).eq("owner",a);c&&r.vF.warn("\u26a0\ufe0f Error actualizando riesgos:",c);try{["mi-dashboard-portfolio","lastSelectedProjectId","portfolioData","audit-log-"+a,"user-preferences-"+a].forEach(e=>{const n=localStorage.getItem(e);if(n)try{const i=JSON.parse(n);JSON.stringify(i).includes(a)&&(r.vF.debug("\ud83d\uddd1\ufe0f Limpiando localStorage key: ".concat(e)),localStorage.removeItem(e))}catch(i){r.vF.debug("\ud83d\uddd1\ufe0f Limpiando localStorage key (raw): ".concat(e)),localStorage.removeItem(e)}}),["currentUser","userSession","organizationData"].forEach(e=>{const n=sessionStorage.getItem(e);n&&n.includes(a)&&(r.vF.debug("\ud83d\uddd1\ufe0f Limpiando sessionStorage key: ".concat(e)),sessionStorage.removeItem(e))})}catch(t){}var o;re&&re({category:"organization",action:"member-completely-removed",description:'Usuario "'.concat(a,'" eliminado COMPLETAMENTE de la organizaci\xf3n'),details:{userEmail:a,organizationId:ie,tablesCleaned:["organization_members","user_organization_roles","tasks","risks"],localCacheCleaned:!0},severity:"high",user:(null===(o=i.getCurrentUser())||void 0===o?void 0:o.email)||"Sistema"});const d="\u2705 Usuario ".concat(a," eliminado COMPLETAMENTE de la organizaci\xf3n\n\nSe elimin\xf3 de:\n\u2022 organization_members (membres\xeda principal)\n\u2022 user_organization_roles (roles y permisos)\n\u2022 Referencias en tareas y riesgos\n\u2022 Cach\xe9 local del navegador\n\n\u26a0\ufe0f IMPORTANTE: El usuario eliminado debe:\n1. Cerrar sesi\xf3n completamente\n2. Cerrar el navegador\n3. Volver a abrir el navegador\n4. Iniciar sesi\xf3n nuevamente\n\nSolo as\xed ver\xe1 que ya no tiene acceso a la organizaci\xf3n.");alert(d),await pe()}}catch(Z){r.vF.error("\u274c Error eliminando miembro:",Z),V("Error eliminando miembro: ".concat(Z.message)),alert("\u274c Error eliminando usuario: ".concat(Z.message,"\n\nPor favor, intenta nuevamente o contacta al administrador."))}finally{Y(!1)}})(e.id,e.user_email),className:"text-red-600 hover:text-red-800 text-sm",title:"Eliminar miembro",children:"\ud83d\uddd1\ufe0f"})]})]})]},e.id))})]}),f&&(0,k.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,k.jsx)("div",{className:"bg-white rounded-lg max-w-md w-full",children:(0,k.jsxs)("div",{className:"p-6",children:[(0,k.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,k.jsx)("h2",{className:"text-xl font-bold",children:"Invitar Miembro"}),(0,k.jsx)("button",{onClick:()=>I(!1),className:"text-gray-500 hover:text-gray-700 text-xl",children:"\u2715"})]}),(0,k.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),R&&ie)if(le){try{if(!(await s.A.canAddUser(ie)).allowed){var a;const e=await s.A.getUsageStats(ie),n=localStorage.getItem("strategiapm_portfolio_data"),r=n?JSON.parse(n):{};return q({limitType:"user",currentPlan:(null===r||void 0===r||null===(a=r.organization)||void 0===a?void 0:a.subscriptionPlan)||"free",currentCount:e.currentUsers,maxCount:e.maxUsers}),void G(!0)}}catch(t){r.vF.error("Error verificando l\xedmites:",t)}try{Y(!0),V(null);const{default:e}=await Promise.resolve().then(n.bind(n,2416));if(e.isAuthenticated()){var i;e.getCurrentUser();const{data:a,error:n}=await e.supabase.from("user_organization_roles").select("role, organization_id").eq("user_id",null===(i=e.getCurrentUser())||void 0===i?void 0:i.id),{data:r,error:t}=await e.supabase.from("organization_members").select("*").eq("organization_id",ie).eq("user_email",R).single();if(r)return void alert("\u26a0\ufe0f El usuario ".concat(R," ya es miembro de esta organizaci\xf3n."));const{data:s,error:l}=await e.supabase.rpc("invite_member",{p_organization_id:ie,p_user_email:R,p_role:y,p_functional_role:C||null});if(l)throw l;if(s&&!s.success)throw new Error(s.error||"Error al invitar miembro");var o;if(re)re({category:"organization",action:"member-invited",description:'Invitaci\xf3n enviada a "'.concat(R,'" con rol "').concat(y,'"'),details:{userEmail:R,role:y,organizationId:ie},severity:"medium",user:(null===(o=e.getCurrentUser())||void 0===o?void 0:o.email)||"Sistema"});ne({user_email:R,role:y,organization_id:ie}),ee(!0),await pe(),j.resetForm(),j.closeModal(),m&&m()}}catch(Z){r.vF.error("Error invitando miembro:",Z),V("Error invitando miembro: ".concat(Z.message))}finally{Y(!1)}}else alert("\u274c No tienes permisos para invitar miembros. Solo owners y administradores pueden realizar esta acci\xf3n.")},children:[(0,k.jsxs)("div",{className:"space-y-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email del Usuario *"}),(0,k.jsx)("input",{type:"email",className:"w-full border rounded px-3 py-2",value:R,onChange:e=>_(e.target.value),placeholder:"usuario@ejemplo.com",required:!0})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rol"}),(0,k.jsx)("select",{className:"w-full border rounded px-3 py-2",value:y,onChange:e=>M(e.target.value),children:g.map(e=>(0,k.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,k.jsx)(ge,{isInviteForm:!0,value:C,onChange:e=>w(e)}),(0,k.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,k.jsx)("button",{type:"button",onClick:()=>I(!1),className:"px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50",disabled:F,children:"Cancelar"}),(0,k.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",disabled:F,children:F?"Enviando...":"Invitar"})]})]})]})})}),S&&(0,k.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,k.jsx)("div",{className:"bg-white rounded-lg max-w-md w-full mx-4",children:(0,k.jsxs)("div",{className:"p-6",children:[(0,k.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,k.jsx)("h2",{className:"text-xl font-bold",children:"Cambiar Rol de Usuario"}),(0,k.jsx)("button",{onClick:()=>{O(!1),P(null),B("")},className:"text-gray-500 hover:text-gray-700 text-xl",children:"\u2715"})]}),(0,k.jsxs)("div",{className:"mb-4",children:[(0,k.jsxs)("p",{className:"text-gray-600 mb-2",children:["Cambiando rol de: ",(0,k.jsx)("strong",{children:null===T||void 0===T?void 0:T.user_email})]}),(0,k.jsxs)("p",{className:"text-sm text-gray-500",children:["Rol actual: ",(0,k.jsx)("span",{className:"font-medium",children:T?xe(T.role):""})]})]}),(0,k.jsxs)("div",{className:"mb-6",children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nuevo Rol"}),(0,k.jsx)("select",{value:D,onChange:e=>B(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:g.map(e=>(0,k.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,k.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Solo lectura:"})," Puede ver proyectos pero no editarlos"]}),(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Editar:"})," Puede ver y modificar proyectos"]}),(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Administrador:"})," Puede gestionar usuarios y proyectos"]})]})]}),(0,k.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,k.jsx)("button",{onClick:()=>{O(!1),P(null),B("")},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",disabled:F,children:"Cancelar"}),(0,k.jsx)("button",{onClick:async()=>{if(T&&D){if(!ue(T)){return void(h(T.role)===c.OWNER?alert("\u274c No se puede cambiar el rol del propietario de la organizaci\xf3n."):alert("\u274c No tienes permisos para cambiar el rol de este miembro."))}try{Y(!0);const{default:a}=await Promise.resolve().then(n.bind(n,2416));if(a.isAuthenticated()){const{error:n}=await a.supabase.from("organization_members").update({role:D}).eq("id",T.id);if(n)throw n;var e;if(re)re({category:"organization",action:"member-role-updated",description:'Rol de "'.concat(T.user_email,'" cambiado a "').concat(xe(D),'"'),details:{userEmail:T.user_email,oldRole:T.role,newRole:D,organizationId:ie},severity:"medium",user:(null===(e=a.getCurrentUser())||void 0===e?void 0:e.email)||"Sistema"});alert("\u2705 Rol de ".concat(T.user_email," actualizado exitosamente")),await pe(),O(!1),P(null),B("")}}catch(Z){r.vF.error("Error actualizando rol:",Z),V("Error actualizando rol: ".concat(Z.message))}finally{Y(!1)}}},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",disabled:F||!D||D===(null===T||void 0===T?void 0:T.role),children:F?"Actualizando...":"Cambiar Rol"})]})]})})}),(0,k.jsx)(L,{isOpen:$,onClose:()=>ee(!1),invitation:ae}),(0,k.jsx)(U.default,{isOpen:J,onClose:()=>G(!1),limitType:W.limitType,currentPlan:W.currentPlan,currentCount:W.currentCount,maxCount:W.maxCount,organizationId:ie,onUpgradeSuccess:()=>{pe()}})]})}},9543:(e,a,n)=>{n.d(a,{A:()=>o});var r=n(9379),i=n(5043);const o=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[o,t]=(0,i.useState)([]),[s,l]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{if(e){l(!0);try{if(a){const{default:a}=await Promise.resolve().then(n.bind(n,2416));if(a.isAuthenticated()){const n=await a.loadAuditEvents(e);if(n.success)t(n.events),console.log("\u2705 Logs de auditor\xeda cargados desde Supabase para proyecto ".concat(e,": ").concat(n.events.length," eventos"));else{const a=localStorage.getItem("audit-log-".concat(e));t(a?JSON.parse(a):[])}}else{const a=localStorage.getItem("audit-log-".concat(e));t(a?JSON.parse(a):[])}}else{const a=localStorage.getItem("audit-log-".concat(e));t(a?JSON.parse(a):[])}}catch(r){console.error("Error loading audit log:",r);const a=localStorage.getItem("audit-log-".concat(e));a&&t(JSON.parse(a))}finally{l(!1)}}})()},[e,a]);const c=(0,i.useCallback)(async a=>{localStorage.setItem("audit-log-".concat(e),JSON.stringify(a)),console.log("\ud83d\udccb Logs de auditor\xeda guardados en localStorage para proyecto ".concat(e,": ").concat(a.length," eventos"))},[e]),d=(0,i.useCallback)(async r=>{if(a)try{const{default:a}=await Promise.resolve().then(n.bind(n,2416));if(a.isAuthenticated()){const n=await a.saveAuditEvents(e,[r]);n.success?console.log("\u2705 Evento de auditor\xeda guardado en Supabase: ".concat(r.action)):console.warn("\u26a0\ufe0f Error guardando evento en Supabase:",n.error)}}catch(i){console.error("Error guardando evento en Supabase:",i)}},[e,a]),u=(0,i.useCallback)(async a=>{const n=(0,r.A)({id:crypto.randomUUID(),timestamp:(new Date).toISOString(),projectId:e},a);return t(e=>{const a=[n,...e];return c(a),a}),d(n),n},[e,c,d]),m=(0,i.useCallback)((e,a,n)=>{u({category:"project-status",action:"status-changed",description:'Estado del proyecto cambiado de "'.concat(e,'" a "').concat(a,'"'),details:{previousStatus:e,newStatus:a,projectName:n.name,manager:n.manager,budget:n.budget},severity:"high",user:n.manager||"Sistema"})},[u]),p=(0,i.useCallback)((e,a)=>{u({category:"work-package",action:"created",description:'Work Package "'.concat(e.name,'" creado'),details:{workPackageId:e.id,name:e.name,budget:e.budget,status:e.status},severity:"medium",user:a.manager||"Sistema"})},[u]),g=(0,i.useCallback)((e,a,n)=>{u({category:"work-package",action:"modified",description:'Work Package "'.concat(e.name,'" modificado'),details:{workPackageId:e.id,name:e.name,changes:Object.keys(a),previousValues:a},severity:"medium",user:n.manager||"Sistema"})},[u]),h=(0,i.useCallback)((e,a)=>{u({category:"risk",action:"created",description:'Riesgo "'.concat(e.name,'" identificado'),details:{riskId:e.id,name:e.name,probability:e.probability,impact:e.impact,priority:e.priority},severity:"high"===e.priority?"high":"medium",user:a.manager||"Sistema"})},[u]),x=(0,i.useCallback)((e,a,n)=>{const r={"purchase-order":{action:"created",description:'Orden de Compra "'.concat(a.description,'" creada'),details:{poId:a.id,description:a.description,amount:a.amount,supplier:a.supplier}},advance:{action:"created",description:'Anticipo "'.concat(a.description,'" creado'),details:{advanceId:a.id,description:a.description,amount:a.amount,recipient:a.recipient}},invoice:{action:"created",description:'Factura "'.concat(a.description,'" creada'),details:{invoiceId:a.id,description:a.description,amount:a.amount,supplier:a.supplier}},contract:{action:"created",description:'Contrato "'.concat(a.name,'" creado'),details:{contractId:a.id,name:a.name,value:a.value,contractor:a.contractor}}}[e];r&&u({category:"financial",action:r.action,description:r.description,details:r.details,severity:"high",user:n.manager||"Sistema"})},[u]),v=(0,i.useCallback)((e,a)=>{u({category:"resources",action:"assigned",description:"Recurso asignado al proyecto",details:{assignmentId:e.id,resourceId:e.resourceId,role:e.role,allocation:e.allocation},severity:"medium",user:a.manager||"Sistema"})},[u]),b=(0,i.useCallback)((e,a)=>{u({category:"minutes",action:"minute-task-created",description:'Tarea de minuta "'.concat(e.tarea,'" creada'),details:{taskId:e.id,tarea:e.tarea,responsable:e.responsable,fecha:e.fecha,hitoId:e.hitoId,estatus:e.estatus},severity:"medium",user:a.manager||"Sistema"})},[u]),E=(0,i.useCallback)((e,a,n)=>{u({category:"minutes",action:"minute-task-updated",description:'Tarea de minuta "'.concat(e.tarea,'" actualizada'),details:{taskId:e.id,tarea:e.tarea,changes:a,newStatus:e.estatus},severity:"medium",user:n.manager||"Sistema"})},[u]),A=(0,i.useCallback)(()=>{t([]),localStorage.removeItem("audit-log-".concat(e))},[e]),j=(0,i.useCallback)(()=>{const a={projectId:e,exportDate:(new Date).toISOString(),totalEvents:o.length,events:o},n=JSON.stringify(a,null,2),r=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(r),t=document.createElement("a");t.href=i,t.download="audit-log-".concat(e,"-").concat((new Date).toISOString().split("T")[0],".json"),t.click(),URL.revokeObjectURL(i)},[o,e]);return{auditLog:o,isLoading:s,addAuditEvent:u,logProjectStatusChange:m,logWorkPackageCreated:p,logWorkPackageModified:g,logRiskCreated:h,logFinancialEvent:x,logResourceAssignment:v,logMinutaTaskCreated:b,logMinutaTaskUpdated:E,clearAuditLog:A,exportAuditLog:j}}}}]);
//# sourceMappingURL=218.058c8daf.chunk.js.map
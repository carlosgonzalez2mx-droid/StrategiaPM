"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[449],{8449:(e,s,t)=>{t.r(s),t.d(s,{default:()=>d});var a=t(9379),l=t(9950),r=t(3116),c=t(4414);const n=e=>{switch(e){case"active":return"bg-green-100 text-green-800 border-green-200";case"inactive":return"bg-gray-100 text-gray-600 border-gray-300";case"completed":return"bg-blue-100 text-blue-800 border-blue-200";case"on-hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"archived":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},i=e=>{switch(e){case"active":return"\ud83d\udfe2";case"inactive":return"\u26ab";case"completed":return"\u2705";case"on-hold":default:return"\u23f8\ufe0f";case"cancelled":return"\u274c";case"archived":return"\ud83d\udcc1"}},d=e=>{let{project:s,workPackages:t,risks:d,tasks:o,purchaseOrders:x,advances:m,invoices:h,contracts:g,resourceAssignments:p,onArchiveProject:u}=e;const[j,v]=(0,l.useState)(!1),[N,b]=(0,l.useState)(0),y=(()=>{if(!s)return[];try{const e=localStorage.getItem("audit-log-".concat(s.id));return e?JSON.parse(e):[]}catch(e){return console.error("Error loading audit log:",e),[]}})(),{files:f,getFileStats:w}=(0,r.A)(null===s||void 0===s?void 0:s.id),k=w(),A=(0,l.useMemo)(()=>{if(!s)return{};const e=t.length,a=t.filter(e=>"completed"===e.status).length,l=t.reduce((e,s)=>e+(s.budget||0),0),r=t.reduce((e,s)=>e+(s.earnedValue||0),0),c=t.reduce((e,s)=>e+(s.actualCost||0),0);return{totalWorkPackages:e,completedWorkPackages:a,completionPercentage:e>0?a/e*100:0,totalBudget:l,totalEarned:r,totalActual:c,budgetUtilization:l>0?c/l*100:0,cpi:c>0?r/c:1,totalRisks:d.length,activeRisks:d.filter(e=>"active"===e.status).length,totalTasks:o.length,completedTasks:o.filter(e=>"completed"===e.status).length,totalFinancialItems:x.length+m.length+h.length+g.length,totalResourceAssignments:p.length,totalAuditEvents:y.length,totalFiles:f.length,totalFileSize:k.totalSizeMB}},[s,t,d,o,x,m,h,g,p,y,f,k]),P=(0,l.useMemo)(()=>!!s&&("completed"===s.status&&(!(A.completionPercentage<90)&&0!==A.totalWorkPackages)),[s,A]),S=()=>{const e=[];return A.cpi<.9&&e.push("El proyecto tuvo sobrecostos significativos. Revisar estimaciones de costos para futuros proyectos similares."),A.completionPercentage<95&&e.push("Algunos entregables no se completaron al 100%. Mejorar el seguimiento de work packages."),A.activeRisks>0&&e.push("Quedaron riesgos activos al finalizar. Implementar mejor gesti\xf3n de riesgos desde el inicio."),A.totalAuditEvents>100&&e.push("El proyecto tuvo muchos cambios. Implementar mejor control de cambios."),0===e.length&&e.push("El proyecto se ejecut\xf3 exitosamente. Replicar buenas pr\xe1cticas en futuros proyectos."),e};return s?(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsxs)("div",{className:"bg-gradient-to-r from-purple-50 to-indigo-100 rounded-2xl shadow-lg p-6 text-gray-800 relative overflow-hidden",children:[(0,c.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-purple-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,c.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-indigo-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,c.jsx)("div",{className:"relative z-10",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,c.jsx)("span",{className:"text-3xl",children:"\ud83d\udcc1"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gray-800",children:"Archivado de Proyecto"}),(0,c.jsxs)("p",{className:"text-gray-600 text-lg",children:['Generar expediente completo y archivar "',s.name,'"']})]})]}),(0,c.jsxs)("div",{className:"text-right",children:[(0,c.jsxs)("div",{className:"text-4xl font-bold text-gray-800",children:[A.completionPercentage.toFixed(1),"%"]}),(0,c.jsx)("div",{className:"text-gray-600",children:"Completitud"})]})]})})]}),(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Estado del Proyecto"}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Estado Actual"}),(0,c.jsx)("div",{className:"flex items-center space-x-2",children:(0,c.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(n(s.status)),children:[i(s.status)," ",s.status]})})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Manager"}),(0,c.jsx)("div",{className:"font-medium",children:s.manager})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Presupuesto Original"}),(0,c.jsxs)("div",{className:"font-medium",children:["$",(s.budget/1e3).toFixed(0),"K USD"]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Per\xedodo"}),(0,c.jsxs)("div",{className:"font-medium",children:[s.startDate," - ",s.endDate]})]})]})]}),(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"M\xe9tricas Finales"}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,c.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,c.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:A.totalWorkPackages}),(0,c.jsx)("div",{className:"text-sm text-gray-600",children:"Work Packages"}),(0,c.jsxs)("div",{className:"text-xs text-gray-500",children:[A.completedWorkPackages," completados"]})]}),(0,c.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,c.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",(A.totalBudget/1e3).toFixed(0),"K"]}),(0,c.jsx)("div",{className:"text-sm text-gray-600",children:"Presupuesto Total"}),(0,c.jsxs)("div",{className:"text-xs text-gray-500",children:["$",(A.totalActual/1e3).toFixed(0),"K gastado"]})]}),(0,c.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[(0,c.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:A.totalAuditEvents}),(0,c.jsx)("div",{className:"text-sm text-gray-600",children:"Eventos de Auditor\xeda"}),(0,c.jsx)("div",{className:"text-xs text-gray-500",children:"Registros completos"})]})]})]}),y.length>0&&(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udccb Registro de Auditor\xeda"}),(0,c.jsxs)("div",{className:"space-y-3",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600",children:"Total de eventos registrados:"}),(0,c.jsx)("span",{className:"font-semibold text-purple-600",children:y.length})]}),(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600",children:"Primer evento:"}),(0,c.jsx)("span",{className:"text-sm text-gray-500",children:y.length>0?new Date(y[y.length-1].timestamp).toLocaleDateString():"N/A"})]}),(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600",children:"\xdaltimo evento:"}),(0,c.jsx)("span",{className:"text-sm text-gray-500",children:y.length>0?new Date(y[0].timestamp).toLocaleDateString():"N/A"})]}),(0,c.jsx)("div",{className:"mt-3 p-3 bg-purple-50 border border-purple-200 rounded-lg",children:(0,c.jsxs)("div",{className:"text-sm text-purple-800",children:[(0,c.jsx)("strong",{children:"\u2705 Audit Log incluido:"})," El expediente incluir\xe1 todos los eventos de auditor\xeda registrados desde la activaci\xf3n del proyecto hasta su completitud."]})})]})]}),(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Validaci\xf3n de Archivado"}),(0,c.jsxs)("div",{className:"space-y-3",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,c.jsx)("span",{className:"text-xl ".concat("completed"===s.status?"text-green-500":"text-red-500"),children:"completed"===s.status?"\u2705":"\u274c"}),(0,c.jsx)("span",{className:"text-sm",children:"Proyecto marcado como completado"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,c.jsx)("span",{className:"text-xl ".concat(A.completionPercentage>=90?"text-green-500":"text-red-500"),children:A.completionPercentage>=90?"\u2705":"\u274c"}),(0,c.jsxs)("span",{className:"text-sm",children:["Completitud m\xednima del 90% (",A.completionPercentage.toFixed(1),"%)"]})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,c.jsx)("span",{className:"text-xl ".concat(A.totalWorkPackages>0?"text-green-500":"text-red-500"),children:A.totalWorkPackages>0?"\u2705":"\u274c"}),(0,c.jsxs)("span",{className:"text-sm",children:["Work packages definidos (",A.totalWorkPackages,")"]})]})]}),!P&&(0,c.jsx)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,c.jsxs)("div",{className:"text-sm text-red-800",children:[(0,c.jsx)("strong",{children:"No se puede archivar:"})," El proyecto no cumple con los criterios m\xednimos de archivado."]})})]}),(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Contenido del Expediente"}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,c.jsx)("span",{className:"text-sm",children:"Informaci\xf3n del proyecto"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,c.jsx)("span",{className:"text-sm",children:"Work packages completos"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,c.jsx)("span",{className:"text-sm",children:"Gesti\xf3n de riesgos"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,c.jsx)("span",{className:"text-sm",children:"Cronograma y tareas"})]})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,c.jsx)("span",{className:"text-sm",children:"Documentaci\xf3n financiera"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,c.jsx)("span",{className:"text-sm",children:"Asignaci\xf3n de recursos"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,c.jsxs)("span",{className:"text-sm",children:["Auditor\xeda completa (",y.length," eventos)"]})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,c.jsxs)("span",{className:"text-sm",children:["Archivos adjuntos (",f.length," archivos, ",k.totalSizeMB,"MB)"]})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("span",{className:"text-green-500",children:"\u2705"}),(0,c.jsx)("span",{className:"text-sm",children:"Lecciones aprendidas"})]})]})]})]}),j&&(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Generando Expediente"}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,c.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:"".concat(N,"%")}})}),(0,c.jsxs)("div",{className:"text-sm text-gray-600 text-center",children:[N.toFixed(0),"% completado"]})]})]}),(0,c.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Archivar Proyecto"}),(0,c.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:'Generar expediente completo y cambiar estado a "Archivado"'})]}),(0,c.jsx)("button",{onClick:async()=>{if(P){v(!0),b(0);try{const e=["Validando datos del proyecto...","Generando m\xe9tricas finales...","Compilando documentaci\xf3n...","Creando expediente...","Finalizando archivado..."];for(let s=0;s<e.length;s++)b(s/e.length*100),await new Promise(e=>setTimeout(e,500));const l={metadata:{archiveDate:(new Date).toISOString(),archiveVersion:"1.0.0",projectId:s.id,projectName:s.name,archiveType:"project-completion"},project:(0,a.A)((0,a.A)({},s),{},{archivedAt:(new Date).toISOString(),finalMetrics:A}),workPackages:t,risks:d,tasks:o,financial:{purchaseOrders:x,advances:m,invoices:h,contracts:g},resources:p,auditLog:y,files:f,summary:{totalDuration:Math.round((new Date(s.endDate)-new Date(s.startDate))/864e5),finalBudget:A.totalBudget,finalCost:A.totalActual,completionRate:A.completionPercentage,performanceIndex:A.cpi,lessonsLearned:S()}},r=JSON.stringify(l,null,2),c=new Blob([r],{type:"application/json"}),n=URL.createObjectURL(c),i=document.createElement("a");i.href=n,i.download="expediente-".concat(s.name.replace(/[^a-zA-Z0-9]/g,"-"),"-").concat((new Date).toISOString().split("T")[0],".json"),i.click(),URL.revokeObjectURL(n),b(100),u&&u(s.id,l)}catch(e){console.error("Error generando expediente:",e)}finally{v(!1)}}},disabled:!P||j,className:"\n              px-6 py-3 rounded-lg font-medium transition-colors\n              ".concat(P&&!j?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-300 text-gray-500 cursor-not-allowed","\n            "),children:j?"Generando...":"\ud83d\udcc1 Generar Expediente y Archivar"})]})})]}):(0,c.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,c.jsx)("div",{className:"text-4xl mb-4",children:"\ud83d\udcc1"}),(0,c.jsx)("div",{className:"text-lg mb-2",children:"Selecciona un proyecto para generar su expediente"})]})}}}]);
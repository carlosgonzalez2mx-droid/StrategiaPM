"use strict";(self.webpackChunkmi_dashboard=self.webpackChunkmi_dashboard||[]).push([[462],{1188:(e,a,t)=>{t.d(a,{A6:()=>r,ZY:()=>l,gZ:()=>o,kr:()=>i});const s={OWNER:"owner",ADMIN:"admin",MEMBER_WRITE:"organization_member_write",MEMBER_READ:"organization_member_read"},r={EXECUTIVE:"executive",SPONSOR:"sponsor",PROJECT_MANAGER:"project_manager",FINANCE_MANAGER:"finance_manager",QUALITY_MANAGER:"quality_manager",TECHNICAL_LEAD:"technical_lead",PMO_ASSISTANT:"pmo_assistant",PROJECT_COORDINATOR:"project_coordinator",TEAM_MEMBER:"team_member",AUDITOR:"auditor"},l={[r.EXECUTIVE]:{label:"Ejecutivo",description:"Toma decisiones estrat\xe9gicas y aprueba cambios cr\xedticos",icon:"\ud83d\udc54",color:"purple",badge:"bg-purple-100 text-purple-800"},[r.SPONSOR]:{label:"Patrocinador",description:"Aprueba cambios mayores del proyecto",icon:"\ud83c\udfaf",color:"blue",badge:"bg-blue-100 text-blue-800"},[r.PROJECT_MANAGER]:{label:"Project Manager",description:"Gestiona proyectos y aprueba cambios menores",icon:"\ud83d\udcca",color:"indigo",badge:"bg-indigo-100 text-indigo-800"},[r.FINANCE_MANAGER]:{label:"Gerente Financiero",description:"Aprueba impacto financiero de cambios",icon:"\ud83d\udcb0",color:"green",badge:"bg-green-100 text-green-800"},[r.QUALITY_MANAGER]:{label:"Gerente de Calidad",description:"Valida impacto en calidad",icon:"\u2b50",color:"yellow",badge:"bg-yellow-100 text-yellow-800"},[r.TECHNICAL_LEAD]:{label:"L\xedder T\xe9cnico",description:"Realiza an\xe1lisis t\xe9cnico de cambios",icon:"\ud83d\udd27",color:"cyan",badge:"bg-cyan-100 text-cyan-800"},[r.PMO_ASSISTANT]:{label:"Asistente PMO",description:"Soporte operativo y seguimiento",icon:"\ud83d\udccb",color:"teal",badge:"bg-teal-100 text-teal-800"},[r.PROJECT_COORDINATOR]:{label:"Coordinador de Proyectos",description:"Coordina tareas y actividades",icon:"\ud83d\udcc5",color:"orange",badge:"bg-orange-100 text-orange-800"},[r.TEAM_MEMBER]:{label:"Miembro de Equipo",description:"Participa en el proyecto y solicita cambios",icon:"\ud83d\udc64",color:"gray",badge:"bg-gray-100 text-gray-800"},[r.AUDITOR]:{label:"Auditor",description:"Solo lectura para auditor\xeda",icon:"\ud83d\udd0d",color:"slate",badge:"bg-slate-100 text-slate-800"}},n={[s.OWNER]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!0,canVoteInCCB:!0,canAssign:!0,canComment:!0,canViewAll:!0,approvalLimit:{cost:1/0,schedule:1/0},changeRole:"executive_board",level:"unlimited"},[s.ADMIN]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!0,canVoteInCCB:!0,canAssign:!0,canComment:!0,canViewAll:!0,approvalLimit:{cost:1/0,schedule:1/0},changeRole:"executive_board",level:"unlimited"},[s.MEMBER_WRITE]:{default:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!0,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"team_member",level:"basic"},[r.EXECUTIVE]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!1,canVoteInCCB:!0,canAssign:!0,canComment:!0,canViewAll:!0,approvalLimit:{cost:1/0,schedule:1/0},changeRole:"executive_board",level:"executive"},[r.SPONSOR]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!1,canVoteInCCB:!0,canAssign:!0,canComment:!0,canViewAll:!0,approvalLimit:{cost:1e5,schedule:30},changeRole:"sponsor",level:"high"},[r.PROJECT_MANAGER]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!0,canVoteInCCB:!0,canAssign:!0,canComment:!0,canViewAll:!0,approvalLimit:{cost:25e3,schedule:15},changeRole:"project_manager",level:"medium"},[r.FINANCE_MANAGER]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!1,canVoteInCCB:!0,canAssign:!1,canComment:!0,canViewAll:!0,approvalLimit:{cost:1e5,schedule:0},changeRole:"finance_manager",level:"specialized"},[r.QUALITY_MANAGER]:{canCreate:!0,canApprove:!0,canReject:!0,canImplement:!1,canVoteInCCB:!0,canAssign:!1,canComment:!0,canViewAll:!0,approvalLimit:{cost:0,schedule:0},changeRole:"quality_manager",level:"specialized"},[r.TECHNICAL_LEAD]:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!0,canVoteInCCB:!0,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"technical_lead",level:"technical"},[r.PMO_ASSISTANT]:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!0,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"pmo_assistant",level:"operational"},[r.PROJECT_COORDINATOR]:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!0,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"project_coordinator",level:"operational"},[r.TEAM_MEMBER]:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"team_member",level:"basic"}},[s.MEMBER_READ]:{default:{canCreate:!0,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"observer",level:"readonly"},[r.AUDITOR]:{canCreate:!1,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!0,canViewAll:!0,approvalLimit:{cost:0,schedule:0},changeRole:"auditor",level:"audit"}}},o=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return{canCreate:!1,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!1,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:"none",level:"none"};const t=n[e];return t?e===s.OWNER||e===s.ADMIN?t:a&&t[a]?t[a]:t.default||t:n[s.MEMBER_READ].default},i=e=>{var a;return e?(null===(a=l[e])||void 0===a?void 0:a.label)||e:"Sin rol espec\xedfico"}},2367:(e,a,t)=>{t.d(a,{$$:()=>m,$M:()=>i,AX:()=>l,EL:()=>c,Kl:()=>u,X0:()=>o,aI:()=>n,iD:()=>d});var s=t(8103);const r=async e=>{let{userEmail:a,userId:t,changeId:r,changeNumber:l,changeTitle:n,notificationType:o,title:i,message:c,priority:d="normal",metadata:m={}}=e;try{s.default.getCurrentUser();const e=s.default.getCurrentOrganization();if(!e)return console.warn("No se puede crear notificaci\xf3n: organizaci\xf3n no detectada"),{success:!1,error:"Organizaci\xf3n no detectada"};const u={organization_id:e,user_id:t,user_email:a,change_id:r,change_number:l,change_title:n,notification_type:o,title:i,message:c,priority:d,status:"unread",metadata:m,action_url:"/change-management?changeId=".concat(r),created_at:(new Date).toISOString()},{data:p,error:x}=await s.default.supabase.from("change_notifications").insert(u).select().single();return x?(console.error("Error creando notificaci\xf3n:",x),{success:!1,error:x}):{success:!0,data:p}}catch(u){return console.error("Error inesperado creando notificaci\xf3n:",u),{success:!1,error:u}}},l=async e=>{try{const{data:a,error:t}=await s.default.supabase.from("change_notifications").select("*").eq("user_email",e).eq("status","unread").order("created_at",{ascending:!1});return t?(console.error("Error obteniendo notificaciones:",t),[]):a||[]}catch(a){return console.error("Error inesperado obteniendo notificaciones:",a),[]}},n=async e=>{try{const{error:a}=await s.default.supabase.from("change_notifications").update({status:"read",read_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("id",e);return a?(console.error("Error marcando notificaci\xf3n como le\xedda:",a),{success:!1,error:a}):{success:!0}}catch(a){return console.error("Error inesperado marcando notificaci\xf3n:",a),{success:!1,error:a}}},o=async e=>{try{const{error:a}=await s.default.supabase.from("change_notifications").update({status:"read",read_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("user_email",e).eq("status","unread");return a?(console.error("Error marcando todas como le\xeddas:",a),{success:!1,error:a}):{success:!0}}catch(a){return console.error("Error inesperado marcando todas como le\xeddas:",a),{success:!1,error:a}}},i=async e=>{try{const{count:a,error:t}=await s.default.supabase.from("change_notifications").select("*",{count:"exact",head:!0}).eq("user_email",e).eq("status","unread");return t?(console.error("Error obteniendo conteo:",t),0):a||0}catch(a){return console.error("Error inesperado obteniendo conteo:",a),0}},c=async e=>{let{userEmail:a,userId:t,change:s,assignedBy:l}=e;return r({userEmail:a,userId:t,changeId:s.id,changeNumber:s.changeNumber,changeTitle:s.title,notificationType:"assigned",title:"Cambio Asignado",message:"".concat(l,' te ha asignado el cambio "').concat(s.title,'"'),priority:"high",metadata:{assignedBy:l,changeStatus:s.status}})},d=async e=>{let{userEmail:a,userId:t,change:s}=e;return r({userEmail:a,userId:t,changeId:s.id,changeNumber:s.changeNumber,changeTitle:s.title,notificationType:"approval_required",title:"Aprobaci\xf3n Requerida",message:'El cambio "'.concat(s.title,'" requiere tu aprobaci\xf3n'),priority:"urgent",metadata:{costImpact:s.impactCost,scheduleImpact:s.impactSchedule}})},m=async e=>{let{userEmail:a,userId:t,change:s}=e;return r({userEmail:a,userId:t,changeId:s.id,changeNumber:s.changeNumber,changeTitle:s.title,notificationType:"ccb_vote_required",title:"Voto CCB Requerido",message:'Tu voto es requerido en el CCB para "'.concat(s.title,'"'),priority:"high",metadata:{changeStatus:s.status}})},u=async e=>{let{userEmail:a,userId:t,change:s,oldStatus:l,newStatus:n,changedBy:o}=e;return r({userEmail:a,userId:t,changeId:s.id,changeNumber:s.changeNumber,changeTitle:s.title,notificationType:"status_changed",title:"Estado de Cambio Actualizado",message:'El cambio "'.concat(s.title,'" pas\xf3 de ').concat(l," a ").concat(n),priority:"normal",metadata:{oldStatus:l,newStatus:n,changedBy:o}})}},5462:(e,a,t)=>{t.r(a),t.d(a,{default:()=>E});var s=t(9379),r=t(9950),l=t(7902);const n=(e,a)=>({applyChangeToProject:(0,r.useCallback)((e,t)=>{if(!a||!t)return console.warn("No se puede aplicar el cambio: onUpdateProject o project no disponible"),null;const r=(0,s.A)({},t);if(e.impactCost){const a=parseFloat(e.impactCost);r.budget=(r.budget||0)+a,r.budgetHistory=[...r.budgetHistory||[],{date:(new Date).toISOString(),amount:a,reason:"Cambio ".concat(e.changeNumber,": ").concat(e.title),type:"change_request",changeId:e.id}]}if(e.impactSchedule&&r.endDate){const a=parseFloat(e.impactSchedule),t=new Date(r.endDate),s=new Date(t.getTime()+24*a*60*60*1e3);r.scheduleHistory=[...r.scheduleHistory||[],{date:(new Date).toISOString(),days:a,reason:"Cambio ".concat(e.changeNumber,": ").concat(e.title),oldEndDate:r.endDate,newEndDate:s.toISOString().split("T")[0],changeId:e.id}],r.endDate=s.toISOString().split("T")[0]}return"scope"===e.category&&e.impactScope&&(r.scopeChanges=[...r.scopeChanges||[],{date:(new Date).toISOString(),changeId:e.id,changeNumber:e.changeNumber,description:e.impactScope,status:"implemented"}]),r.appliedChanges=[...r.appliedChanges||[],{changeId:e.id,changeNumber:e.changeNumber,title:e.title,appliedDate:(new Date).toISOString(),impactSummary:{cost:e.impactCost,schedule:e.impactSchedule,scope:e.impactScope,category:e.category}}],a(r),r},[a])});var o=t(8103),i=t(1188),c=t(2556);const d=()=>{const{currentUser:e,organizationId:a,isLoading:t,isAuthenticated:l,userEmail:n,userId:d}=(0,c.A)(),[m,u]=(0,r.useState)({canCreate:!1,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!1,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:null,level:"none",userId:null,userName:null,userEmail:null,orgRole:null,functionalRole:null}),[p,x]=(0,r.useState)(!0),[g,h]=(0,r.useState)(null),b=(0,r.useRef)(!1);(0,r.useEffect)(()=>{(async()=>{if(!b.current&&!t)try{var r,c;if(b.current=!0,x(!0),h(null),!l||!n)return void u({canCreate:!1,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!1,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:null,level:"none",userId:null,userName:null,userEmail:null,orgRole:null,functionalRole:null});if(!a)return void u({canCreate:!1,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!1,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:null,level:"none",userId:d,userName:(null===e||void 0===e||null===(c=e.user_metadata)||void 0===c?void 0:c.name)||n,userEmail:n,orgRole:null,functionalRole:null});const{data:t,error:p}=await o.default.supabase.from("organization_members").select("role, functional_role, user_id, status").eq("user_email",n).eq("organization_id",a).eq("status","active").maybeSingle();if(p)return console.error("Error obteniendo membership:",p),void h("Error cargando permisos");var m;if(!t)return console.warn("No se encontr\xf3 membership activo para el usuario"),void u({canCreate:!1,canApprove:!1,canReject:!1,canImplement:!1,canVoteInCCB:!1,canAssign:!1,canComment:!1,canViewAll:!1,approvalLimit:{cost:0,schedule:0},changeRole:null,level:"none",userId:e.id,userName:(null===(m=e.user_metadata)||void 0===m?void 0:m.name)||e.email,userEmail:e.email,orgRole:null,functionalRole:null});const g=t.role,v=t.functional_role,j=(0,i.gZ)(g,v);u((0,s.A)((0,s.A)({},j),{},{userId:t.user_id||e.id,userName:(null===(r=e.user_metadata)||void 0===r?void 0:r.name)||e.email,userEmail:e.email,orgRole:g,functionalRole:v}))}catch(g){console.error("Error inesperado en useChangePermissions:",g),h("Error inesperado cargando permisos")}finally{x(!1),b.current=!1}})()},[l,n,a,t,e,d]);return{permissions:m,loading:t||p,error:g,canApproveSpecificChange:(e,a)=>{if(!m.canApprove)return!1;const t=parseFloat(e)||0,s=parseFloat(a)||0,r=t<=m.approvalLimit.cost,l=s<=m.approvalLimit.schedule;return r&&l}}},m=e=>{const a=e.filter(e=>["approved","rejected","implemented"].includes(e.status));if(0===a.length)return 0;return(a.reduce((e,a)=>{const t=new Date(a.createdAt),s=new Date(a.updatedAt);return e+Math.ceil((s-t)/864e5)},0)/a.length).toFixed(1)},u=e=>{const a=e.reduce((e,a)=>(e[a.category]=(e[a.category]||0)+1,e),{});return Object.entries(a).sort((e,a)=>a[1]-e[1]).slice(0,3)},p=e=>{const a=e.filter(e=>{var a,t;if("implemented"!==e.status||!e.expectedImplementationDate)return!1;const s=new Date(e.expectedImplementationDate),r=null===(a=e.statusHistory)||void 0===a||null===(t=a.find(e=>"implemented"===e.status))||void 0===t?void 0:t.date;return!!r&&new Date(r)<=s}).length,t=e.filter(e=>"implemented"===e.status).length;return t>0?(a/t*100).toFixed(0):0};var x=t(2367);const g=e=>{const{permissions:a,loading:t}=d(),[l,n]=(0,r.useState)(!1),o=(0,r.useCallback)(()=>{return a.userId?(e=a)&&e.userId?{userId:e.userId,userName:e.userName||e.userEmail,userEmail:e.userEmail,userRole:e.orgRole,changeRole:e.changeRole,functionalRole:e.functionalRole,timestamp:(new Date).toISOString()}:null:null;var e},[a]),i=(0,r.useCallback)(()=>a.canCreate&&!t,[a.canCreate,t]),c=(0,r.useCallback)(e=>{if(!a.canApprove)return!1;const t=parseFloat(e.impactCost)||0,s=parseFloat(e.impactSchedule)||0,r=t<=a.approvalLimit.cost,l=s<=a.approvalLimit.schedule;return r&&l},[a]),m=(0,r.useCallback)(()=>a.canReject&&!t,[a.canReject,t]),u=(0,r.useCallback)(()=>a.canImplement&&!t,[a.canImplement,t]),p=(0,r.useCallback)(()=>a.canVoteInCCB&&!t,[a.canVoteInCCB,t]),g=(0,r.useCallback)(()=>a.canAssign&&!t,[a.canAssign,t]),h=(0,r.useCallback)(e=>{const a=o();return a?(0,s.A)((0,s.A)({},e),{},{createdBy:a,createdByUser:a.userName,createdByEmail:a.userEmail}):e},[o]),b=(0,r.useCallback)(async(e,a,t)=>{if(e&&a){n(!0);try{const s=o();if(!s)return;await(0,x.EL)({userEmail:a,userId:t,change:e,assignedBy:s.userName})}catch(s){console.error("Error notificando asignaci\xf3n:",s)}finally{n(!1)}}},[o]),v=(0,r.useCallback)(async(e,a,t)=>{if(e&&a){n(!0);try{await(0,x.iD)({userEmail:a,userId:t,change:e})}catch(s){console.error("Error notificando aprobaci\xf3n:",s)}finally{n(!1)}}},[]),j=(0,r.useCallback)(async(e,a)=>{if(e&&a&&0!==a.length){n(!0);try{for(const t of a)t.userEmail&&await(0,x.$$)({userEmail:t.userEmail,userId:t.userId,change:e})}catch(t){console.error("Error notificando CCB:",t)}finally{n(!1)}}},[]),y=(0,r.useCallback)(async function(e,a,t){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(e){n(!0);try{const l=o();if(!l)return;var r;if(e.createdByEmail&&e.createdByEmail!==l.userEmail)await(0,x.Kl)({userEmail:e.createdByEmail,userId:null===(r=e.createdBy)||void 0===r?void 0:r.userId,change:e,oldStatus:a,newStatus:t,changedBy:l.userName});for(const r of s)r.email&&r.email!==l.userEmail&&await(0,x.Kl)({userEmail:r.email,userId:r.id,change:e,oldStatus:a,newStatus:t,changedBy:l.userName})}catch(l){console.error("Error notificando cambio de estado:",l)}finally{n(!1)}}},[o]);return{permissions:a,permissionsLoading:t,canCreate:i,canApprove:c,canReject:m,canImplement:u,canVoteInCCB:p,canAssign:g,getCurrentUserInfo:o,enrichChangeWithUser:h,notifyAssignment:b,notifyApproval:v,notifyCCBMembers:j,notifyStatusChange:y,processing:l}};var h=t(3286);const b={low:{threshold:5e3,approver:"project_manager",label:"Project Manager"},medium:{threshold:25e3,approver:"sponsor",label:"Sponsor"},high:{threshold:1e5,approver:"ccb",label:"CCB"},critical:{threshold:1/0,approver:"executive_board",label:"Executive Board"}},v={low:{threshold:5,approver:"project_manager",label:"Project Manager"},medium:{threshold:15,approver:"sponsor",label:"Sponsor"},high:{threshold:30,approver:"ccb",label:"CCB"},critical:{threshold:1/0,approver:"executive_board",label:"Executive Board"}},j=[{id:"pm",name:"Project Manager",role:"pm",required:!0},{id:"tech",name:"Technical Lead",role:"tech",required:!0},{id:"finance",name:"Finance Manager",role:"finance",required:!1},{id:"quality",name:"Quality Manager",role:"quality",required:!1},{id:"sponsor",name:"Sponsor",role:"sponsor",required:!0}];var y=t(4414);const f=e=>{let{change:a,currentUserPermissions:t,onUpdateVotes:l}=e;const n=null===t||void 0===t?void 0:t.functionalRole;console.log("\ud83d\udc64 Rol funcional del usuario en CCB:",n);const[o,c]=(0,r.useState)(a.ccbVotes||j.map(e=>(0,s.A)((0,s.A)({},e),{},{vote:null,comments:"",votedAt:null})));(0,r.useEffect)(()=>{a.ccbVotes&&c(a.ccbVotes)},[a.ccbVotes]);const d=(e,a)=>{const t=o.map(t=>t.id===e?(0,s.A)((0,s.A)({},t),{},{vote:a,votedAt:(new Date).toISOString()}):t);c(t),l(t)},m={pm:{name:"Project Manager",icon:"\ud83d\udcca",required:!0},tech:{name:"Technical Lead",icon:"\ud83d\udd27",required:!0},finance:{name:"Finance Manager",icon:"\ud83d\udcb0",required:!1},quality:{name:"Quality Manager",icon:"\u2b50",required:!1},sponsor:{name:"Sponsor",icon:"\ud83c\udfaf",required:!0}},u=(()=>{if(!o||0===o.length)return{totalMembers:Object.keys(m).length,votedCount:0,approveCount:0,rejectCount:0,abstainCount:0,quorumPercentage:0,approvePercentage:0,rejectPercentage:0,abstainPercentage:0,hasQuorum:!1,hasMajority:!1,result:"pending"};const e=o.length,a=o.filter(e=>e.vote).length,t=o.filter(e=>"approve"===e.vote).length,s=o.filter(e=>"reject"===e.vote).length,r=o.filter(e=>"abstain"===e.vote).length,l=a/e*100,n=t/e*100,i=l>=60,c=i&&n>50;let d="pending";return a===e&&(d=i&&c?"approved":"rejected"),{totalMembers:e,votedCount:a,approveCount:t,rejectCount:s,abstainCount:r,quorumPercentage:l,approvePercentage:n,rejectPercentage:s/e*100,abstainPercentage:r/e*100,hasQuorum:i,hasMajority:c,result:d}})(),p=o.filter(e=>"approve"===e.vote).length,x=o.filter(e=>"reject"===e.vote).length,g=o.filter(e=>e.required).length;return(0,y.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,y.jsxs)("h3",{className:"text-xl font-bold text-gray-800 flex items-center",children:[(0,y.jsx)("span",{className:"text-2xl mr-2",children:"\ud83c\udfdb\ufe0f"}),"Comit\xe9 de Control de Cambios (CCB)"]}),n&&(0,y.jsxs)("div",{className:"bg-blue-100 border border-blue-300 rounded-lg px-4 py-2",children:[(0,y.jsx)("div",{className:"text-xs text-gray-600",children:"Tu rol en CCB:"}),(0,y.jsx)("div",{className:"font-semibold text-blue-800",children:(0,i.kr)(n)})]})]}),(0,y.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Votaci\xf3n para aprobar o rechazar el cambio"}),(0,y.jsxs)("div",{className:"mb-6 bg-white rounded-xl p-6 border-2 border-indigo-300 shadow-lg",children:[(0,y.jsx)("h4",{className:"font-bold text-gray-800 mb-4 text-lg",children:"\ud83d\udcca Resultados en Tiempo Real"}),(0,y.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[(0,y.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[(0,y.jsx)("div",{className:"text-3xl font-bold text-green-700",children:u.approveCount}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:"\u2705 Aprobar"}),(0,y.jsxs)("div",{className:"text-xs text-gray-500",children:[u.approvePercentage.toFixed(1),"% del total"]})]}),(0,y.jsxs)("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[(0,y.jsx)("div",{className:"text-3xl font-bold text-red-700",children:u.rejectCount}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:"\u274c Rechazar"}),(0,y.jsxs)("div",{className:"text-xs text-gray-500",children:[u.rejectPercentage.toFixed(1),"% del total"]})]}),(0,y.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,y.jsx)("div",{className:"text-3xl font-bold text-gray-700",children:u.abstainCount}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:"\u26aa Abstenci\xf3n"}),(0,y.jsxs)("div",{className:"text-xs text-gray-500",children:[u.abstainPercentage.toFixed(1),"% del total"]})]})]}),(0,y.jsxs)("div",{className:"space-y-4 mb-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"flex items-center justify-between text-sm mb-2",children:[(0,y.jsx)("span",{className:"text-gray-700 font-medium",children:"\ud83d\udcca Participaci\xf3n (M\xednimo: 60% para quorum)"}),(0,y.jsxs)("span",{className:"font-bold ".concat(u.hasQuorum?"text-green-600":"text-red-600"),children:[u.votedCount,"/",u.totalMembers," miembros (",u.quorumPercentage.toFixed(1),"%)",u.hasQuorum?" \u2713":" \u2717"]})]}),(0,y.jsxs)("div",{className:"w-full bg-gray-200 rounded-full h-4 relative",children:[(0,y.jsx)("div",{className:"h-4 rounded-full transition-all ".concat(u.hasQuorum?"bg-green-500":"bg-red-500"),style:{width:"".concat(u.quorumPercentage,"%")}}),(0,y.jsx)("div",{className:"absolute top-0 left-[60%] w-0.5 h-4 bg-gray-600"}),(0,y.jsx)("div",{className:"absolute top-4 left-[60%] transform -translate-x-1/2 text-xs text-gray-600",children:"60%"})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"flex items-center justify-between text-sm mb-2",children:[(0,y.jsx)("span",{className:"text-gray-700 font-medium",children:"\u2705 Aprobaci\xf3n (M\xednimo: >50% del total para aprobar)"}),(0,y.jsxs)("span",{className:"font-bold ".concat(u.hasMajority?"text-green-600":"text-gray-600"),children:[u.approveCount,"/",u.totalMembers," aprueban (",u.approvePercentage.toFixed(1),"%)",u.hasMajority?" \u2713":""]})]}),(0,y.jsxs)("div",{className:"w-full bg-gray-200 rounded-full h-4 relative",children:[(0,y.jsx)("div",{className:"h-4 rounded-full transition-all ".concat(u.hasMajority?"bg-green-500":u.hasQuorum?"bg-yellow-500":"bg-gray-400"),style:{width:"".concat(u.approvePercentage,"%")}}),(0,y.jsx)("div",{className:"absolute top-0 left-[50%] w-0.5 h-4 bg-gray-600"}),(0,y.jsx)("div",{className:"absolute top-4 left-[50%] transform -translate-x-1/2 text-xs text-gray-600",children:"50%"})]})]})]}),(0,y.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:(0,y.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,y.jsx)("span",{className:"text-blue-600 text-lg",children:"\u2139\ufe0f"}),(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsx)("h5",{className:"font-semibold text-blue-800 text-sm mb-1",children:"Estado Actual"}),(0,y.jsxs)("div",{className:"text-xs text-blue-700 space-y-1",children:[!u.hasQuorum&&(0,y.jsxs)("p",{className:"font-medium",children:["\u26a0\ufe0f A\xfan no hay quorum. Se requiere que al menos ",Math.ceil(.6*u.totalMembers)," de ",u.totalMembers," miembros voten. Faltan ",Math.ceil(.6*u.totalMembers)-u.votedCount," votos."]}),u.hasQuorum&&!u.hasMajority&&(0,y.jsxs)("p",{className:"font-medium",children:["\u2713 Hay quorum, pero NO hay mayor\xeda. Se requiere que m\xe1s de ",Math.floor(u.totalMembers/2)," miembros aprueben.",u.votedCount<u.totalMembers&&" Faltan ".concat(u.totalMembers-u.votedCount," votos por emitir.")]}),u.hasMajority&&(0,y.jsxs)("p",{className:"font-medium text-green-700",children:["\u2713 Hay quorum Y mayor\xeda. El cambio ser\xe1 aprobado.",u.votedCount<u.totalMembers&&" (Faltan ".concat(u.totalMembers-u.votedCount," votos, pero ya se alcanz\xf3 mayor\xeda)")]})]})]})]})}),"pending"!==u.result&&(0,y.jsxs)("div",{className:"p-4 rounded-lg text-center font-bold text-lg ".concat("approved"===u.result?"bg-green-100 text-green-800 border-2 border-green-300":"bg-red-100 text-red-800 border-2 border-red-300"),children:["approved"===u.result?"\u2705 CAMBIO APROBADO POR CCB":"\u274c CAMBIO RECHAZADO POR CCB",(0,y.jsxs)("div",{className:"text-sm font-normal mt-2",children:["Votaci\xf3n completa: ",u.approveCount," a favor, ",u.rejectCount," en contra, ",u.abstainCount," abstenciones"]})]}),u.votedCount>0&&!u.hasQuorum&&(0,y.jsx)("div",{className:"mt-4 bg-yellow-50 border border-yellow-300 rounded-lg p-3 text-center",children:(0,y.jsx)("p",{className:"text-yellow-800 font-medium text-sm",children:"\u26a0\ufe0f Sin quorum, la votaci\xf3n NO es v\xe1lida. Todos los miembros CCB deben participar."})})]}),(0,y.jsx)("div",{className:"mb-6 bg-gray-50 border border-gray-300 rounded-lg p-4",children:(0,y.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,y.jsx)("span",{className:"text-gray-600 text-lg",children:"\ud83d\udcd0"}),(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsx)("h5",{className:"font-semibold text-gray-800 text-sm mb-2",children:"Reglas de Votaci\xf3n CCB"}),(0,y.jsxs)("ul",{className:"text-xs text-gray-700 space-y-1",children:[(0,y.jsxs)("li",{children:["\u2022 ",(0,y.jsx)("strong",{children:"Quorum:"})," M\xednimo 60% de miembros deben votar (\u2265",Math.ceil(.6*u.totalMembers)," de ",u.totalMembers,")"]}),(0,y.jsxs)("li",{children:["\u2022 ",(0,y.jsx)("strong",{children:"Mayor\xeda:"})," M\xe1s del 50% del TOTAL de miembros deben aprobar (>",Math.floor(u.totalMembers/2)," de ",u.totalMembers,")"]}),(0,y.jsxs)("li",{children:["\u2022 ",(0,y.jsx)("strong",{children:"Resultado:"})," Solo es v\xe1lido si hay quorum Y mayor\xeda"]}),(0,y.jsxs)("li",{children:["\u2022 ",(0,y.jsx)("strong",{children:"Importante:"})," Los porcentajes se calculan sobre el total de miembros, no sobre los que ya votaron"]})]})]})]})}),(0,y.jsx)("div",{className:"space-y-3 mb-6",children:o.map(e=>{const a=(t=e.id,!!n&&{executive:"executive",sponsor:"sponsor",project_manager:"pm",finance_manager:"finance",quality_manager:"quality",technical_lead:"tech"}[n]===t);var t;return(0,y.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"font-semibold text-gray-800",children:e.name}),(0,y.jsxs)("div",{className:"text-sm text-gray-500",children:[e.role," ",e.required&&(0,y.jsx)("span",{className:"text-red-500",children:"*"})]})]}),(0,y.jsxs)("div",{className:"flex space-x-2",children:[(0,y.jsx)("button",{onClick:()=>d(e.id,"approve"),disabled:!a,className:"px-4 py-2 rounded-lg transition-colors ".concat(a?"approve"===e.vote?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-green-50":"bg-gray-200 text-gray-400 cursor-not-allowed"),title:a?"Aprobar":"No tienes este rol para votar",children:"\u2705 Aprobar"}),(0,y.jsx)("button",{onClick:()=>d(e.id,"reject"),disabled:!a,className:"px-4 py-2 rounded-lg transition-colors ".concat(a?"reject"===e.vote?"bg-red-600 text-white":"bg-gray-100 text-gray-700 hover:bg-red-50":"bg-gray-200 text-gray-400 cursor-not-allowed"),title:a?"Rechazar":"No tienes este rol para votar",children:"\u274c Rechazar"})]})]}),e.vote&&(0,y.jsxs)("div",{className:"mt-3",children:[(0,y.jsx)("input",{type:"text",placeholder:"Comentarios opcionales...",value:e.comments||"",onChange:a=>((e,a)=>{const t=o.map(t=>t.id===e?(0,s.A)((0,s.A)({},t),{},{comments:a}):t);c(t)})(e.id,a.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-purple-500"}),(0,y.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Votado: ",new Date(e.votedAt).toLocaleString()]})]})]},e.id)})}),(0,y.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[(0,y.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-2xl font-bold text-green-600",children:p}),(0,y.jsx)("div",{className:"text-xs text-gray-600",children:"A favor"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-2xl font-bold text-red-600",children:x}),(0,y.jsx)("div",{className:"text-xs text-gray-600",children:"En contra"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:g}),(0,y.jsx)("div",{className:"text-xs text-gray-600",children:"Requeridos"})]})]}),p>=g&&(0,y.jsx)("div",{className:"mt-3 text-center text-sm font-medium text-green-600",children:"\u2705 Se alcanz\xf3 el qu\xf3rum de aprobaci\xf3n"})]}),(0,y.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4",children:(0,y.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,y.jsx)("span",{className:"text-yellow-600 text-lg",children:"\u2139\ufe0f"}),(0,y.jsxs)("div",{children:[(0,y.jsx)("h4",{className:"font-semibold text-yellow-800 text-sm mb-1",children:"Restricci\xf3n de Votaci\xf3n"}),(0,y.jsx)("p",{className:"text-xs text-yellow-700",children:"Solo puedes votar con tu rol funcional asignado. Los dem\xe1s roles est\xe1n deshabilitados para ti. Si necesitas cambiar tu voto, contacta a un administrador."})]})]})})]})},N=e=>{let{title:a,icon:t,value:s,color:r,details:l}=e;return(0,y.jsxs)("div",{className:"bg-gradient-to-br ".concat(r," rounded-lg p-4 border"),children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,y.jsx)("span",{className:"text-2xl",children:t}),(0,y.jsxs)("div",{className:"text-right",children:[(0,y.jsx)("div",{className:"text-xs text-gray-600",children:a}),(0,y.jsx)("div",{className:"text-2xl font-bold",children:s})]})]}),l&&(0,y.jsx)("div",{className:"space-y-1 text-xs text-gray-700",children:l.map((e,a)=>(0,y.jsx)("div",{children:e},a))})]})},C=e=>{let{change:a,project:t}=e;const s=((e,a)=>{const t=parseFloat(e.impactCost)||0,s=parseFloat(e.impactSchedule)||0,r=null!==a&&void 0!==a&&a.budget?t/a.budget*100:0,l=null!==a&&void 0!==a&&a.budget?a.budget-t:0;let n=null,o=0;if(null!==a&&void 0!==a&&a.endDate&&s>0){const e=new Date(a.endDate);n=new Date(e.getTime()+24*s*60*60*1e3),o=s/Math.ceil((e-new Date(a.startDate))/864e5)*100}const i=.4*r+.3*o+(e.impactScope?15:0)+(e.impactQuality?10:0)+(e.impactResources?5:0);let c="approve",d="El impacto es aceptable para los beneficios esperados";return i>50?(c="reject",d="El impacto es demasiado alto. Considere alternativas."):i>30&&(c="review",d="Requiere an\xe1lisis detallado de alternativas y beneficios."),{cost:t,costPercentage:r.toFixed(1),remainingBudget:l.toFixed(0),schedule:s,newEndDate:n?n.toISOString().split("T")[0]:null,delayPercentage:o.toFixed(1),scope:e.impactScope||"Sin impacto especificado",affectedDeliverables:e.affectedDeliverables||0,newRequirements:e.newRequirements||0,complexity:e.complexity||"Media",risks:e.impactRisks||"A evaluar",stakeholders:e.impactStakeholders||"Todos los stakeholders",totalImpactScore:i.toFixed(1),recommendation:c,recommendationReason:d}})(a,t);return(0,y.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[(0,y.jsxs)("h3",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center",children:[(0,y.jsx)("span",{className:"text-2xl mr-2",children:"\ud83d\udcca"}),"An\xe1lisis de Impacto Detallado"]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,y.jsx)(N,{title:"Impacto en Costo",icon:"\ud83d\udcb0",value:"$".concat(s.cost,"K"),color:"from-emerald-50 to-emerald-100 border-emerald-200",details:["% del presupuesto: ".concat(s.costPercentage,"%"),"Presupuesto restante: $".concat(s.remainingBudget,"K")]}),(0,y.jsx)(N,{title:"Impacto en Tiempo",icon:"\ud83d\udcc5",value:"".concat(s.schedule," d\xedas"),color:"from-blue-50 to-blue-100 border-blue-200",details:["% de retraso: ".concat(s.delayPercentage,"%"),s.newEndDate?"Nueva fecha: ".concat(s.newEndDate):"Sin cambio de fecha"]}),(0,y.jsx)(N,{title:"Impacto en Alcance",icon:"\ud83d\udccb",value:a.impactScope?"Alto":"Bajo",color:"from-purple-50 to-purple-100 border-purple-200",details:["Entregables: ".concat(s.affectedDeliverables),"Complejidad: ".concat(s.complexity)]})]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,y.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,y.jsx)("div",{className:"font-semibold text-gray-700 mb-2",children:"\u2b50 Impacto en Calidad"}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:a.impactQuality||"Sin impacto especificado"})]}),(0,y.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,y.jsx)("div",{className:"font-semibold text-gray-700 mb-2",children:"\ud83d\udc65 Impacto en Recursos"}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:a.impactResources||"Sin impacto especificado"})]}),(0,y.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,y.jsx)("div",{className:"font-semibold text-gray-700 mb-2",children:"\ud83d\udee1\ufe0f Impacto en Riesgos"}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:s.risks})]}),(0,y.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,y.jsx)("div",{className:"font-semibold text-gray-700 mb-2",children:"\ud83d\udc54 Impacto en Stakeholders"}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:s.stakeholders})]})]}),(0,y.jsxs)("div",{className:"rounded-lg p-4 border ".concat((r=s.totalImpactScore,r<20?"from-green-50 to-green-100 border-green-200":r<40?"from-yellow-50 to-yellow-100 border-yellow-200":r<60?"from-orange-50 to-orange-100 border-orange-200":"from-red-50 to-red-100 border-red-200")),children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,y.jsx)("div",{className:"font-bold text-gray-800",children:"Puntuaci\xf3n de Impacto Total"}),(0,y.jsx)("div",{className:"text-3xl font-bold",children:s.totalImpactScore})]}),(0,y.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,y.jsx)("div",{className:"h-full bg-gradient-to-r from-green-500 via-yellow-500 to-red-500",style:{width:"".concat(Math.min(100,s.totalImpactScore),"%")}})})]}),(0,y.jsx)("div",{className:"mt-4 p-4 rounded-lg border ".concat("approve"===s.recommendation?"bg-green-50 border-green-200":"review"===s.recommendation?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"),children:(0,y.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,y.jsx)("span",{className:"text-2xl",children:"approve"===s.recommendation?"\u2705":"review"===s.recommendation?"\u26a0\ufe0f":"\u274c"}),(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"font-bold text-gray-800 mb-1",children:"Recomendaci\xf3n del Sistema"}),(0,y.jsx)("div",{className:"text-sm text-gray-700",children:s.recommendationReason})]})]})})]});var r},A=e=>{let{change:a,onComplete:t,onUpdateAlternatives:l}=e;const n=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(null===e||void 0===e||""===e)return"0";const t=parseFloat(e);return isNaN(t)?"0":t.toFixed(a)},[o,i]=(0,r.useState)({costDetails:a.impactCost||"",scheduleDetails:a.impactSchedule||"",scopeDetails:a.impactScope||"",qualityDetails:a.impactQuality||"",resourcesDetails:a.impactResources||""}),[c,d]=(0,r.useState)(a.alternatives||[]),[m,u]=(0,r.useState)(!1),[p,x]=(0,r.useState)({name:"",description:"",cost:"",schedule:"",pros:[""],cons:[""]});return(0,y.jsxs)("div",{className:"bg-gradient-to-r from-cyan-50 to-blue-50 rounded-xl p-6 border border-cyan-200",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("h3",{className:"text-xl font-bold text-gray-800 flex items-center space-x-2",children:[(0,y.jsx)("span",{className:"text-2xl",children:"\ud83d\udcca"}),(0,y.jsx)("span",{children:"An\xe1lisis de Impacto Completo"})]}),(0,y.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Completa todas las secciones y agrega m\xednimo 3 alternativas"})]}),(()=>{const e=o.costDetails&&o.scheduleDetails&&o.scopeDetails&&o.qualityDetails&&o.resourcesDetails,a=c.length>=3;return e&&a})()?(0,y.jsx)("button",{onClick:t,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold shadow-lg animate-pulse",children:"\u2705 Completar An\xe1lisis"}):(0,y.jsxs)("div",{className:"text-sm text-gray-500 text-right",children:[(0,y.jsx)("div",{className:"font-semibold",children:"Pendiente:"}),(0,y.jsxs)("div",{children:[c.length,"/3 alternativas"]})]})]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcb0 Impacto en Costos (Detalle)"}),(0,y.jsx)("textarea",{value:o.costDetails,onChange:e=>i((0,s.A)((0,s.A)({},o),{},{costDetails:e.target.value})),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500",placeholder:"Describe el impacto detallado en costos..."})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcc5 Impacto en Cronograma (Detalle)"}),(0,y.jsx)("textarea",{value:o.scheduleDetails,onChange:e=>i((0,s.A)((0,s.A)({},o),{},{scheduleDetails:e.target.value})),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500",placeholder:"Describe el impacto detallado en cronograma..."})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udccb Impacto en Alcance (Detalle)"}),(0,y.jsx)("textarea",{value:o.scopeDetails,onChange:e=>i((0,s.A)((0,s.A)({},o),{},{scopeDetails:e.target.value})),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500",placeholder:"Describe el impacto detallado en alcance..."})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u2b50 Impacto en Calidad (Detalle)"}),(0,y.jsx)("textarea",{value:o.qualityDetails,onChange:e=>i((0,s.A)((0,s.A)({},o),{},{qualityDetails:e.target.value})),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500",placeholder:"Describe el impacto detallado en calidad..."})]}),(0,y.jsxs)("div",{className:"md:col-span-2",children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udc65 Impacto en Recursos (Detalle)"}),(0,y.jsx)("textarea",{value:o.resourcesDetails,onChange:e=>i((0,s.A)((0,s.A)({},o),{},{resourcesDetails:e.target.value})),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500",placeholder:"Describe el impacto detallado en recursos humanos y materiales..."})]})]}),(0,y.jsxs)("div",{className:"border-t pt-6",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,y.jsxs)("h4",{className:"font-semibold text-gray-800",children:["\ud83d\udd04 Alternativas (",c.length,"/3 m\xednimo)"]}),(0,y.jsx)("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"\u2795 Agregar Alternativa"})]}),(0,y.jsx)("div",{className:"space-y-4",children:c.map((e,a)=>(0,y.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,y.jsxs)("h5",{className:"font-semibold text-gray-800 mb-2",children:["Opci\xf3n ",a+1,": ",e.name]}),(0,y.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-gray-500",children:"\ud83d\udcb0 Costo:"}),(0,y.jsxs)("div",{className:"font-medium",children:["$",n(e.cost),"K"]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-gray-500",children:"\ud83d\udcc5 Tiempo:"}),(0,y.jsxs)("div",{className:"font-medium",children:[n(e.schedule,0)," d\xedas"]})]})]})]},e.id||a))}),m&&(0,y.jsxs)("div",{className:"mt-4 bg-white rounded-lg p-6 border-2 border-blue-300",children:[(0,y.jsx)("h5",{className:"font-semibold text-gray-800 mb-4",children:"Nueva Alternativa"}),(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsx)("input",{type:"text",value:p.name,onChange:e=>x((0,s.A)((0,s.A)({},p),{},{name:e.target.value})),placeholder:"Nombre de la alternativa",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),(0,y.jsx)("textarea",{value:p.description,onChange:e=>x((0,s.A)((0,s.A)({},p),{},{description:e.target.value})),placeholder:"Descripci\xf3n detallada",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,y.jsx)("input",{type:"number",value:p.cost,onChange:e=>x((0,s.A)((0,s.A)({},p),{},{cost:e.target.value})),placeholder:"Costo (K)",className:"px-4 py-2 border border-gray-300 rounded-lg"}),(0,y.jsx)("input",{type:"number",value:p.schedule,onChange:e=>x((0,s.A)((0,s.A)({},p),{},{schedule:e.target.value})),placeholder:"Tiempo (d\xedas)",className:"px-4 py-2 border border-gray-300 rounded-lg"})]}),(0,y.jsxs)("div",{className:"flex space-x-4",children:[(0,y.jsx)("button",{onClick:()=>{if(!p.name||!p.description)return void alert("\u274c Completa nombre y descripci\xf3n de la alternativa");const e=(0,s.A)((0,s.A)({},p),{},{id:"alt-".concat(Date.now()),addedAt:(new Date).toISOString()}),a=[...c,e];d(a),l(a),x({name:"",description:"",cost:"",schedule:"",pros:[""],cons:[""]}),u(!1)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"\u2705 Agregar"}),(0,y.jsx)("button",{onClick:()=>u(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400",children:"Cancelar"})]})]})]})]}),(0,y.jsx)("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,y.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,y.jsx)("span",{className:"text-yellow-600 text-lg",children:"\ud83d\udca1"}),(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsx)("h5",{className:"font-semibold text-yellow-800 text-sm mb-1",children:"Requerimientos del An\xe1lisis"}),(0,y.jsxs)("ul",{className:"text-xs text-yellow-700 space-y-1",children:[(0,y.jsx)("li",{children:"\u2022 Completa el an\xe1lisis detallado de las 5 \xe1reas de impacto"}),(0,y.jsx)("li",{children:'\u2022 Agrega m\xednimo 3 alternativas (incluyendo "No hacer nada" si aplica)'}),(0,y.jsx)("li",{children:'\u2022 Una vez completo, el bot\xf3n "Completar An\xe1lisis" se habilitar\xe1'}),(0,y.jsx)("li",{children:'\u2022 El cambio pasar\xe1 a estado "Listo para Revisi\xf3n"'})]})]})]})})]})},w=e=>{let{change:a,onUpdateAlternatives:t,currentUserPermissions:l,onSelectAlternative:n,canSelect:o}=e;const i=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(null===e||void 0===e||""===e)return"0";const t=parseFloat(e);return isNaN(t)?"0":t.toFixed(a)},[c,d]=(0,r.useState)(a.alternatives||[{id:1,name:"No hacer nada (Status Quo)",cost:0,schedule:0,pros:["Sin costos adicionales","Sin retrasos"],cons:["Problema sin resolver","Riesgo de escalamiento"]},{id:2,name:"Implementar cambio completo",cost:parseFloat(a.impactCost)||0,schedule:parseFloat(a.impactSchedule)||0,pros:["Soluci\xf3n completa","Satisface todos los requisitos"],cons:["Costo elevado","Mayor tiempo de implementaci\xf3n"]},{id:3,name:"Soluci\xf3n parcial / Iterativa",cost:.6*(parseFloat(a.impactCost)||0),schedule:.5*(parseFloat(a.impactSchedule)||0),pros:["Menor impacto inicial","M\xe1s flexible"],cons:["Soluci\xf3n incompleta","Puede requerir cambios futuros"]}]),[m,u]=(0,r.useState)(!1),[p,x]=(0,r.useState)({name:"",cost:0,schedule:0,pros:"",cons:""}),g=()=>{if(!l)return!1;const e=l.functionalRole,t=a.requiredApprover;if("ccb"===t||"executive_board"===t){return["executive","sponsor","project_manager","finance_manager","quality_manager","technical_lead"].includes(e)}return"sponsor"===t?["executive","sponsor"].includes(e):"project_manager"===t&&["executive","sponsor","project_manager"].includes(e)};return(0,y.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[(0,y.jsxs)("h3",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center",children:[(0,y.jsx)("span",{className:"text-2xl mr-2",children:"\ud83d\udd04"}),"An\xe1lisis de Alternativas"]}),(0,y.jsx)("div",{className:"space-y-4 mb-4",children:c.map((e,a)=>(0,y.jsxs)("div",{className:"border-2 border-gray-200 rounded-lg p-4 hover:border-purple-300 transition-colors",children:[(0,y.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsxs)("div",{className:"font-semibold text-gray-800 text-lg mb-1",children:["Opci\xf3n ",a+1,": ",e.name]}),(0,y.jsxs)("div",{className:"flex space-x-4 text-sm text-gray-600",children:[(0,y.jsxs)("span",{children:["\ud83d\udcb0 Costo: $",i(e.cost),"K"]}),(0,y.jsxs)("span",{children:["\ud83d\udcc5 Tiempo: ",i(e.schedule,0)," d\xedas"]})]})]})}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[(0,y.jsxs)("div",{className:"bg-green-50 rounded-lg p-3",children:[(0,y.jsxs)("div",{className:"text-sm font-semibold text-green-700 mb-2 flex items-center",children:[(0,y.jsx)("span",{className:"mr-1",children:"\u2705"})," Ventajas"]}),(0,y.jsx)("ul",{className:"text-sm space-y-1 text-gray-700",children:e.pros.map((e,a)=>(0,y.jsxs)("li",{className:"flex items-start",children:[(0,y.jsx)("span",{className:"mr-1",children:"\u2022"}),(0,y.jsx)("span",{children:e})]},a))})]}),(0,y.jsxs)("div",{className:"bg-red-50 rounded-lg p-3",children:[(0,y.jsxs)("div",{className:"text-sm font-semibold text-red-700 mb-2 flex items-center",children:[(0,y.jsx)("span",{className:"mr-1",children:"\u274c"})," Desventajas"]}),(0,y.jsx)("ul",{className:"text-sm space-y-1 text-gray-700",children:e.cons.map((e,a)=>(0,y.jsxs)("li",{className:"flex items-start",children:[(0,y.jsx)("span",{className:"mr-1",children:"\u2022"}),(0,y.jsx)("span",{children:e})]},a))})]})]}),o&&(0,y.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:g()?(0,y.jsx)("button",{onClick:()=>(e=>{if(n)n(e);else{const a=c.map((a,t)=>(0,s.A)((0,s.A)({},a),{},{selected:t===e}));d(a),t(a)}})(a),disabled:e.selected,className:"w-full px-4 py-2 rounded-lg transition-colors text-sm font-medium ".concat(e.selected?"bg-green-100 text-green-800 cursor-default border-2 border-green-300":"bg-blue-600 text-white hover:bg-blue-700"),children:e.selected?"\u2705 Seleccionada":"\ud83d\udccc Seleccionar esta alternativa"}):(0,y.jsx)("div",{className:"bg-gray-100 text-gray-600 px-4 py-2 rounded-lg text-sm text-center",children:"\ud83d\udd12 Solo los aprobadores pueden seleccionar alternativas"})}),!o&&e.selected&&(0,y.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,y.jsx)("div",{className:"bg-green-100 text-green-800 px-4 py-2 rounded-lg text-sm text-center font-medium border-2 border-green-300",children:"\u2705 Esta es la alternativa seleccionada"})})]},e.id))}),(()=>{const e=null===l||void 0===l?void 0:l.functionalRole;return["executive","sponsor","project_manager","technical_lead","pmo_assistant"].includes(e)})()?m?(0,y.jsxs)("div",{className:"border-2 border-purple-300 rounded-lg p-4 bg-purple-50",children:[(0,y.jsx)("h4",{className:"font-semibold text-gray-800 mb-3",children:"Nueva Alternativa"}),(0,y.jsxs)("div",{className:"space-y-3",children:[(0,y.jsx)("input",{type:"text",placeholder:"Nombre de la alternativa",value:p.name,onChange:e=>x((0,s.A)((0,s.A)({},p),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,y.jsx)("input",{type:"number",placeholder:"Costo (K)",value:p.cost,onChange:e=>x((0,s.A)((0,s.A)({},p),{},{cost:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg"}),(0,y.jsx)("input",{type:"number",placeholder:"Tiempo (d\xedas)",value:p.schedule,onChange:e=>x((0,s.A)((0,s.A)({},p),{},{schedule:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg"})]}),(0,y.jsx)("textarea",{placeholder:"Ventajas (una por l\xednea)",value:p.pros,onChange:e=>x((0,s.A)((0,s.A)({},p),{},{pros:e.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),(0,y.jsx)("textarea",{placeholder:"Desventajas (una por l\xednea)",value:p.cons,onChange:e=>x((0,s.A)((0,s.A)({},p),{},{cons:e.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),(0,y.jsxs)("div",{className:"flex space-x-2",children:[(0,y.jsx)("button",{onClick:()=>{const e={id:c.length+1,name:p.name,cost:parseFloat(p.cost)||0,schedule:parseFloat(p.schedule)||0,pros:p.pros.split("\n").filter(e=>e.trim()),cons:p.cons.split("\n").filter(e=>e.trim()),selected:!1},a=[...c,e];d(a),t(a),x({name:"",cost:0,schedule:0,pros:"",cons:""}),u(!1)},className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Agregar"}),(0,y.jsx)("button",{onClick:()=>u(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancelar"})]})]})]}):(0,y.jsx)("button",{onClick:()=>u(!0),className:"w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-colors text-gray-600 hover:text-purple-700 font-medium",children:"\u2795 Agregar Alternativa"}):(0,y.jsx)("div",{className:"border-2 border-gray-300 rounded-lg p-4 bg-gray-50 text-center",children:(0,y.jsx)("p",{className:"text-sm text-gray-500 italic",children:"\ud83d\udd12 Solo el equipo de proyecto puede agregar alternativas"})}),(0,y.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4",children:(0,y.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,y.jsx)("span",{className:"text-blue-600 text-lg",children:"\u2139\ufe0f"}),(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsx)("h4",{className:"font-semibold text-blue-800 text-sm mb-1",children:"Proceso de Alternativas"}),(0,y.jsxs)("ul",{className:"text-xs text-blue-700 space-y-1",children:[(0,y.jsxs)("li",{children:["\u2022 ",(0,y.jsx)("strong",{children:"Equipo de proyecto:"})," Puede agregar y analizar alternativas"]}),(0,y.jsxs)("li",{children:["\u2022 ",(0,y.jsx)("strong",{children:"Aprobadores/CCB:"})," Seleccionan cu\xe1l alternativa implementar"]}),(0,y.jsx)("li",{children:"\u2022 La alternativa seleccionada ser\xe1 la que se implemente si se aprueba el cambio"})]})]})]})})]})},S=e=>{let{change:a,onSelectAlternative:t}=e;const s=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(null===e||void 0===e||""===e)return"0";const t=parseFloat(e);return isNaN(t)?"0":t.toFixed(a)};return a.alternatives&&0!==a.alternatives.length?(0,y.jsxs)("div",{className:"bg-gradient-to-r from-emerald-50 to-green-50 rounded-xl p-6 border border-emerald-200",children:[(0,y.jsxs)("div",{className:"mb-6",children:[(0,y.jsxs)("h3",{className:"text-xl font-bold text-gray-800 flex items-center space-x-2",children:[(0,y.jsx)("span",{className:"text-2xl",children:"\ud83c\udfaf"}),(0,y.jsx)("span",{children:"Seleccionar Alternativa a Implementar"})]}),(0,y.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"El cambio ha sido aprobado. Selecciona cu\xe1l alternativa se implementar\xe1."})]}),(0,y.jsx)("div",{className:"space-y-4",children:a.alternatives.map((e,r)=>(0,y.jsx)("div",{className:"bg-white rounded-lg p-6 border-2 transition-all ".concat(a.selectedAlternative===r?"border-green-500 bg-green-50":"border-gray-200 hover:border-emerald-300 hover:shadow-md"),children:(0,y.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsxs)("h4",{className:"font-bold text-gray-800 text-lg mb-2",children:["Opci\xf3n ",r+1,": ",e.name]}),(0,y.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-sm text-gray-500",children:"\ud83d\udcb0 Costo:"}),(0,y.jsxs)("div",{className:"font-semibold text-gray-800",children:["$",s(e.cost),"K"]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-sm text-gray-500",children:"\ud83d\udcc5 Tiempo:"}),(0,y.jsxs)("div",{className:"font-semibold text-gray-800",children:[s(e.schedule,0)," d\xedas"]})]})]}),e.pros&&e.pros.length>0&&(0,y.jsxs)("div",{className:"mb-3",children:[(0,y.jsx)("div",{className:"text-sm font-semibold text-green-700 mb-1",children:"\u2705 Ventajas:"}),(0,y.jsx)("ul",{className:"text-sm text-gray-600 space-y-1",children:e.pros.map((e,a)=>(0,y.jsxs)("li",{children:["\u2022 ",e]},a))})]}),e.cons&&e.cons.length>0&&(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-sm font-semibold text-red-700 mb-1",children:"\u274c Desventajas:"}),(0,y.jsx)("ul",{className:"text-sm text-gray-600 space-y-1",children:e.cons.map((e,a)=>(0,y.jsxs)("li",{children:["\u2022 ",e]},a))})]})]}),(0,y.jsx)("button",{onClick:()=>t(r),disabled:a.selectedAlternative===r,className:"ml-4 px-6 py-3 rounded-lg font-semibold transition-all ".concat(a.selectedAlternative===r?"bg-green-600 text-white cursor-default":"bg-emerald-600 text-white hover:bg-emerald-700 hover:shadow-lg"),children:a.selectedAlternative===r?"\u2705 Seleccionada":"\ud83d\udccc Seleccionar"})]})},e.id||r))}),(0,y.jsx)("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,y.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,y.jsx)("span",{className:"text-blue-600 text-lg",children:"\u2139\ufe0f"}),(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsx)("h5",{className:"font-semibold text-blue-800 text-sm mb-1",children:"Siguiente Paso"}),(0,y.jsx)("p",{className:"text-xs text-blue-700",children:'Una vez seleccionada la alternativa, el cambio pasar\xe1 autom\xe1ticamente a estado "Implementando" y se podr\xe1 iniciar la ejecuci\xf3n del cambio aprobado.'})]})]})})]}):(0,y.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:(0,y.jsx)("p",{className:"text-yellow-800",children:"\u26a0\ufe0f No hay alternativas registradas para este cambio."})})},I=e=>{let{title:a,value:t,icon:s,description:r,trend:l}=e;return(0,y.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,y.jsx)("span",{className:"text-3xl",children:s}),l&&(0,y.jsxs)("span",{className:"text-sm font-medium ".concat(l>0?"text-green-600":"text-red-600"),children:[l>0?"\u2197":"\u2198"," ",Math.abs(l),"%"]})]}),(0,y.jsx)("div",{className:"text-3xl font-bold text-gray-800 mb-1",children:t}),(0,y.jsx)("div",{className:"text-sm font-medium text-gray-600 mb-1",children:a}),r&&(0,y.jsx)("div",{className:"text-xs text-gray-500",children:r})]})},R=e=>{let{changes:a}=e;const t=(0,r.useMemo)(()=>{const e=a.length,t=a.filter(e=>"approved"===e.status||"implemented"===e.status).length,s=e>0?t/e*100:0;return{avgProcessingTime:m(a),approvalRate:s.toFixed(1),topCategories:u(a),efficiency:p(a),totalChanges:e,pendingReview:a.filter(e=>"underReview"===e.status).length}},[a]);return(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,y.jsx)(I,{title:"Tiempo Promedio",value:"".concat(t.avgProcessingTime," d\xedas"),icon:"\u23f1\ufe0f",description:"De solicitud a decisi\xf3n"}),(0,y.jsx)(I,{title:"Tasa de Aprobaci\xf3n",value:"".concat(t.approvalRate,"%"),icon:"\u2705",description:"Cambios aprobados/total"}),(0,y.jsx)(I,{title:"Eficiencia",value:"".concat(t.efficiency,"%"),icon:"\u26a1",description:"Implementados a tiempo"}),(0,y.jsx)(I,{title:"En Revisi\xf3n",value:t.pendingReview,icon:"\ud83d\udd0d",description:"Requieren atenci\xf3n"})]})},E=e=>{var a,t,o,c,d,m;let{currentProjectId:u,projects:p,workPackages:x,tasks:j,purchaseOrders:N,advances:I,invoices:E,contracts:D,onUpdateProject:_}=e;const[q,M]=(0,r.useState)([]),[B,T]=(0,r.useState)(!1),[O,k]=(0,r.useState)(null),[P,V]=(0,r.useState)("all"),[L,F]=(0,r.useState)("all"),[z,U]=(0,r.useState)(""),[Q,H]=(0,r.useState)(null),[G,K]=(0,r.useState)(!1),[$,J]=(0,r.useState)(!1),[W,Y]=(0,r.useState)(!1),[X,Z]=(0,r.useState)(!1),{addAuditEvent:ee}=(0,l.A)(u),{applyChangeToProject:ae}=n(u,_),{permissions:te,permissionsLoading:se,canCreate:re,canApprove:le,canReject:ne,canImplement:oe,canVoteInCCB:ie,canAssign:ce,getCurrentUserInfo:de,enrichChangeWithUser:me,notifyAssignment:ue,notifyApproval:pe,notifyCCBMembers:xe,notifyStatusChange:ge,processing:he}=g(u),be=(0,r.useMemo)(()=>null===p||void 0===p?void 0:p.find(e=>e.id===u),[p,u]);(0,r.useEffect)(()=>{(async()=>{if(null!==be&&void 0!==be&&be.organizationId)try{const e=await h.A.canEdit(be.organizationId);Z(!e.allowed)}catch(e){console.error("[READ-ONLY MODE] Error verificando permisos:",e),Z(!1)}})()},[null===be||void 0===be?void 0:be.organizationId]),(0,r.useEffect)(()=>{u||console.warn("\u26a0\ufe0f No hay proyecto seleccionado para Control de Cambios")},[u]);const[ve,je]=(0,r.useState)({title:"",description:"",justification:"",impactScope:"",impactSchedule:"",impactCost:"",impactQuality:"",impactResources:"",priority:"medium",category:"scope",requestedBy:"",requestedDate:(new Date).toISOString().split("T")[0],expectedImplementationDate:"",attachments:[],stakeholders:[]}),ye=(e,a)=>{je(t=>(0,s.A)((0,s.A)({},t),{},{[e]:a}))};(0,r.useEffect)(()=>{if(!u)return console.warn("No hay proyecto activo, no se pueden cargar cambios"),void M([]);const e=localStorage.getItem("project-changes-".concat(u));if(e)try{const a=JSON.parse(e);M(Array.isArray(a)?a:[])}catch(a){console.error("Error parseando cambios guardados:",a),M([])}else M([])},[u]);const fe=e=>{if(u)try{localStorage.setItem("project-changes-".concat(u),JSON.stringify(e))}catch(a){console.error("Error guardando cambios:",a)}else console.warn("No hay proyecto activo, no se pueden guardar cambios")},Ne={scope:{label:"Alcance",icon:"\ud83d\udccb",color:"bg-blue-100 text-blue-800"},schedule:{label:"Cronograma",icon:"\ud83d\udcc5",color:"bg-green-100 text-green-800"},cost:{label:"Costos",icon:"\ud83d\udcb0",color:"bg-yellow-100 text-yellow-800"},quality:{label:"Calidad",icon:"\u2b50",color:"bg-purple-100 text-purple-800"},resources:{label:"Recursos",icon:"\ud83d\udc65",color:"bg-indigo-100 text-indigo-800"},risk:{label:"Riesgos",icon:"\ud83d\udee1\ufe0f",color:"bg-red-100 text-red-800"},procurement:{label:"Adquisiciones",icon:"\ud83d\uded2",color:"bg-orange-100 text-orange-800"},communication:{label:"Comunicaciones",icon:"\ud83d\udce2",color:"bg-teal-100 text-teal-800"}},Ce={submitted:{label:"Solicitado",icon:"\ud83d\udce4",color:"bg-blue-100 text-blue-800"},impactAnalysis:{label:"An\xe1lisis de Impacto",icon:"\ud83d\udcca",color:"bg-cyan-100 text-cyan-800"},readyForReview:{label:"Listo para Revisi\xf3n",icon:"\u2705",color:"bg-green-100 text-green-800"},underReview:{label:"En Revisi\xf3n CCB",icon:"\ud83d\uddf3\ufe0f",color:"bg-indigo-100 text-indigo-800"},approved:{label:"Aprobado - Seleccionar Alternativa",icon:"\u2714\ufe0f",color:"bg-emerald-100 text-emerald-800"},implementing:{label:"Implementando",icon:"\ud83d\ude80",color:"bg-purple-100 text-purple-800"},implemented:{label:"Implementado",icon:"\u2728",color:"bg-green-100 text-green-800"},rejected:{label:"Rechazado",icon:"\u274c",color:"bg-red-100 text-red-800"},cancelled:{label:"Cancelado",icon:"\u26d4",color:"bg-gray-100 text-gray-600"}},Ae={low:{label:"Baja",icon:"\ud83d\udfe2",color:"bg-green-100 text-green-800"},medium:{label:"Media",icon:"\ud83d\udfe1",color:"bg-yellow-100 text-yellow-800"},high:{label:"Alta",icon:"\ud83d\udfe0",color:"bg-orange-100 text-orange-800"},critical:{label:"Cr\xedtica",icon:"\ud83d\udd34",color:"bg-red-100 text-red-800"}},we=(0,r.useMemo)(()=>{let e=q;return"all"!==P&&(e=e.filter(e=>e.status===P)),"all"!==L&&(e=e.filter(e=>e.priority===L)),z&&(e=e.filter(e=>e.title.toLowerCase().includes(z.toLowerCase())||e.description.toLowerCase().includes(z.toLowerCase())||e.requestedBy.toLowerCase().includes(z.toLowerCase()))),e.sort((e,a)=>new Date(a.requestedDate)-new Date(e.requestedDate))},[q,P,L,z]),Se=(0,r.useMemo)(()=>({totalChanges:q.length,pendingChanges:q.filter(e=>["submitted","initialReview","impactAnalysis","underReview","approvalPending"].includes(e.status)).length,approvedChanges:q.filter(e=>"approved"===e.status).length,implementedChanges:q.filter(e=>"implemented"===e.status).length,rejectedChanges:q.filter(e=>"rejected"===e.status).length,totalCostImpact:q.filter(e=>"approved"===e.status||"implemented"===e.status).reduce((e,a)=>e+(parseFloat(a.impactCost)||0),0),totalScheduleImpact:q.filter(e=>"approved"===e.status||"implemented"===e.status).reduce((e,a)=>e+(parseFloat(a.impactSchedule)||0),0)}),[q]),Ie=()=>{var e;if(!re())return void alert("No tienes permisos para crear cambios");const a=parseFloat(ve.impactCost)||0,t=parseFloat(ve.impactSchedule)||0,{approver:r,level:l}=((e,a)=>{let t="project_manager",s="low";return e>=b.critical.threshold?(t=b.critical.approver,s="critical"):e>=b.high.threshold?(t=b.high.approver,s="high"):e>=b.medium.threshold&&(t=b.medium.approver,s="medium"),a>=v.critical.threshold?(t=v.critical.approver,s="critical"):a>=v.high.threshold&&"critical"!==s?(t=v.high.approver,s="high"):a>=v.medium.threshold&&"low"===s&&(t=v.medium.approver,s="medium"),{approver:t,level:s}})(a,t),n=me(ve),o=a>=25e3||t>=15,i=o?"impactAnalysis":"readyForReview",c=(0,s.A)((0,s.A)({id:"change-".concat(Date.now()),projectId:u,projectName:(null===be||void 0===be?void 0:be.name)||"Sin nombre"},n),{},{status:i,requiredApprover:r,authorityLevel:l,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),changeNumber:"CHG-".concat(String(q.length+1).padStart(6,"0")),ccbVotes:null,alternatives:null,impactAnalysisComplete:!1,selectedAlternative:null}),d=[c,...q];M(d),fe(d),ee("change_management","change_created",{changeId:c.id,changeTitle:c.title,changeNumber:c.changeNumber,createdBy:null===(e=c.createdBy)||void 0===e?void 0:e.userName,requiredApprover:r,needsAnalysis:o}),je({title:"",description:"",justification:"",impactScope:"",impactSchedule:"",impactCost:"",impactQuality:"",impactResources:"",priority:"medium",category:"scope",requestedBy:"",requestedDate:(new Date).toISOString().split("T")[0],expectedImplementationDate:"",attachments:[],stakeholders:[]}),T(!1),o?alert("\u2705 Cambio creado. Requiere an\xe1lisis de impacto completo antes de la revisi\xf3n."):alert("\u2705 Cambio creado. Listo para aprobaci\xf3n directa.")},Re=e=>"ccb"===e.requiredApprover||"executive_board"===e.requiredApprover||"high"===e.authorityLevel||"critical"===e.authorityLevel||(parseFloat(e.impactCost)||0)>1e5||(parseFloat(e.impactSchedule)||0)>30,Ee=(e,a)=>{var t;const r=q.find(a=>a.id===e);if(!r)return;if("approved"!==r.status)return void alert("\u274c Solo se puede seleccionar alternativa despu\xe9s de aprobar el cambio");const l=q.map(t=>t.id===e?(0,s.A)((0,s.A)({},t),{},{selectedAlternative:a,status:"implementing",updatedAt:(new Date).toISOString()}):t);M(l),fe(l),ee("change_management","alternative_selected",{changeId:e,changeNumber:r.changeNumber,alternativeIndex:a,alternativeName:null===(t=r.alternatives[a])||void 0===t?void 0:t.name}),alert("\u2705 Alternativa seleccionada. El cambio pasa a implementaci\xf3n.")},De=async function(e,a){var t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const l=q.find(a=>a.id===e);if(!l)return;const n=l.status;if("approved"===a&&!le(l))return void alert("No tienes permisos para aprobar este cambio o excede tu l\xedmite de aprobaci\xf3n");if("rejected"===a&&!ne())return void alert("No tienes permisos para rechazar cambios");if("implemented"===a&&!oe())return void alert("No tienes permisos para implementar cambios");const o=de(),i=q.map(t=>{if(t.id===e){const e=(0,s.A)((0,s.A)({},t),{},{status:a,updatedAt:(new Date).toISOString(),statusHistory:[...t.statusHistory||[],{status:a,date:(new Date).toISOString(),comments:r,updatedBy:(null===o||void 0===o?void 0:o.userName)||"Sistema",userEmail:null===o||void 0===o?void 0:o.userEmail}]});return"approved"===a&&ae(e,be),e}return t});M(i),fe(i),ee("change_management","change_status_updated",{changeId:e,oldStatus:n,newStatus:a,comments:r,updatedBy:null===o||void 0===o?void 0:o.userName}),null!==(t=l.createdBy)&&void 0!==t&&t.userEmail&&await ge((0,s.A)((0,s.A)({},l),{},{changeNumber:l.changeNumber,title:l.title}),n,a,[{email:l.createdBy.userEmail,id:l.createdBy.userId}])},_e=(e,a)=>{const t=q.map(t=>t.id===e?(0,s.A)((0,s.A)({},t),{},{alternatives:a}):t);M(t),fe(t)},qe=e=>e<10?"text-green-600":e<25?"text-yellow-600":e<50?"text-orange-600":"text-red-600";return(0,y.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,y.jsx)("div",{className:"max-w-7xl mx-auto",children:u?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"bg-gradient-to-r from-purple-50 to-indigo-100 rounded-2xl shadow-lg p-8 mb-8 text-gray-800 relative overflow-hidden",children:[(0,y.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-purple-100/30 rounded-full -translate-y-16 translate-x-16"}),(0,y.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-indigo-100/30 rounded-full translate-y-12 -translate-x-12"}),(0,y.jsx)("div",{className:"relative z-10",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("div",{className:"bg-white/60 backdrop-blur rounded-2xl p-3 mr-4 shadow-sm",children:(0,y.jsx)("span",{className:"text-3xl",children:"\ud83d\udd04"})}),(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,y.jsx)("h1",{className:"text-4xl font-bold text-gray-800",children:"Control de Cambios"}),be&&(0,y.jsxs)("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:["\ud83d\udcc1 ",be.name]})]}),(0,y.jsx)("p",{className:"text-gray-600 text-lg",children:"Gesti\xf3n integral de cambios del proyecto seg\xfan PMBOK v7"}),(0,y.jsxs)("div",{className:"mt-4 flex items-center space-x-6 text-sm text-gray-700",children:[(0,y.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,y.jsx)("span",{className:"text-gray-500",children:"\ud83d\udccb"}),(0,y.jsxs)("span",{children:["Total: ",Se.totalChanges]})]}),(0,y.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,y.jsx)("span",{className:"text-gray-500",children:"\u23f3"}),(0,y.jsxs)("span",{children:["Pendientes: ",Se.pendingChanges]})]}),(0,y.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,y.jsx)("span",{className:"text-gray-500",children:"\u2705"}),(0,y.jsxs)("span",{children:["Aprobados: ",Se.approvedChanges]})]}),(0,y.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,y.jsx)("span",{className:"text-gray-500",children:"\ud83d\ude80"}),(0,y.jsxs)("span",{children:["Implementados: ",Se.implementedChanges]})]})]})]})]}),(0,y.jsx)("button",{onClick:()=>T(!0),disabled:!re()||X,className:"px-8 py-4 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1 font-semibold border ".concat(re()&&!X?"bg-white text-purple-700 hover:bg-purple-50 border-purple-200":"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed"),title:X?"No disponible (modo solo lectura)":re()?"":"No tienes permisos para crear cambios",children:"\ud83d\udcdd Solicitar Cambio"}),te.changeRole&&(0,y.jsxs)("div",{className:"text-sm bg-white/80 px-4 py-2 rounded-lg border border-purple-200",children:[(0,y.jsx)("div",{className:"text-gray-600",children:"Tu rol:"}),(0,y.jsx)("div",{className:"font-semibold text-purple-700",children:(0,i.kr)(te.functionalRole)||te.changeRole})]})]})})]}),(0,y.jsx)("div",{className:"mb-8",children:(0,y.jsx)(R,{changes:q})}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,y.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-purple-500",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:Se.totalChanges}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:"Total de Cambios"})]}),(0,y.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg",children:(0,y.jsx)("span",{className:"text-2xl",children:"\ud83d\udd04"})})]})}),(0,y.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-blue-500",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:Se.pendingChanges}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:"Pendientes"})]}),(0,y.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,y.jsx)("span",{className:"text-2xl",children:"\u23f3"})})]})}),(0,y.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-green-500",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["$",Se.totalCostImpact.toFixed(0),"K"]}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:"Impacto en Costos"})]}),(0,y.jsx)("div",{className:"p-3 bg-green-100 rounded-lg",children:(0,y.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"})})]})}),(0,y.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border-l-4 border-yellow-500",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:Se.totalScheduleImpact}),(0,y.jsx)("div",{className:"text-sm text-gray-600",children:"D\xedas de Impacto"})]}),(0,y.jsx)("div",{className:"p-3 bg-yellow-100 rounded-lg",children:(0,y.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc5"})})]})})]}),(0,y.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-8",children:(0,y.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[(0,y.jsx)("div",{className:"lg:col-span-2",children:(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,y.jsx)("span",{className:"text-gray-400",children:"\ud83d\udd0d"})}),(0,y.jsx)("input",{type:"text",placeholder:"Buscar cambios por t\xedtulo, descripci\xf3n o solicitante...",value:z,onChange:e=>U(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"})]})}),(0,y.jsx)("div",{children:(0,y.jsxs)("select",{value:P,onChange:e=>V(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200",children:[(0,y.jsx)("option",{value:"all",children:"Todos los Estados"}),Object.entries(Ce).map(e=>{let[a,t]=e;return(0,y.jsxs)("option",{value:a,children:[t.icon," ",t.label]},a)})]})}),(0,y.jsx)("div",{children:(0,y.jsxs)("select",{value:L,onChange:e=>F(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200",children:[(0,y.jsx)("option",{value:"all",children:"Todas las Prioridades"}),Object.entries(Ae).map(e=>{let[a,t]=e;return(0,y.jsxs)("option",{value:a,children:[t.icon," ",t.label]},a)})]})})]})}),(0,y.jsx)("div",{className:"space-y-4",children:0===we.length?(0,y.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-12 text-center",children:[(0,y.jsx)("div",{className:"text-6xl mb-6",children:"\ud83d\udd0d"}),(0,y.jsx)("div",{className:"text-2xl font-bold text-gray-700 mb-2",children:"No hay cambios registrados"}),(0,y.jsx)("div",{className:"text-gray-500",children:z||"all"!==P||"all"!==L?"No se encontraron cambios con los filtros aplicados":"Comienza solicitando el primer cambio del proyecto"})]}):we.map(e=>{var a,t,s,r,l,n,o,i,c;return(0,y.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200",children:(0,y.jsx)("div",{className:"p-6",children:(0,y.jsxs)("div",{className:"flex items-start justify-between",children:[(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,y.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(null===(a=Ne[e.category])||void 0===a?void 0:a.color),children:[null===(t=Ne[e.category])||void 0===t?void 0:t.icon," ",null===(s=Ne[e.category])||void 0===s?void 0:s.label]}),(0,y.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(null===(r=Ce[e.status])||void 0===r?void 0:r.color),children:[null===(l=Ce[e.status])||void 0===l?void 0:l.icon," ",null===(n=Ce[e.status])||void 0===n?void 0:n.label]}),(0,y.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(null===(o=Ae[e.priority])||void 0===o?void 0:o.color),children:[null===(i=Ae[e.priority])||void 0===i?void 0:i.icon," ",null===(c=Ae[e.priority])||void 0===c?void 0:c.label]}),Re(e)&&(0,y.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800 border border-purple-300",children:"\ud83d\uddf3\ufe0f Requiere CCB"}),(0,y.jsx)("span",{className:"text-sm text-gray-500 font-mono",children:e.changeNumber})]}),(0,y.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:e.title}),(0,y.jsx)("p",{className:"text-gray-600 mb-3 line-clamp-2",children:e.description}),(0,y.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-gray-500",children:"Solicitante:"}),(0,y.jsx)("div",{className:"font-medium",children:e.requestedBy})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-gray-500",children:"Fecha:"}),(0,y.jsx)("div",{className:"font-medium",children:new Date(e.requestedDate).toLocaleDateString()})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-gray-500",children:"Impacto Costo:"}),(0,y.jsxs)("div",{className:"font-medium ".concat(qe(e.impactCost)),children:["$",e.impactCost||0,"K"]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-gray-500",children:"Impacto Cronograma:"}),(0,y.jsxs)("div",{className:"font-medium ".concat(qe(e.impactSchedule)),children:[e.impactSchedule||0," d\xedas"]})]})]}),e.requiredApprover&&(0,y.jsxs)("div",{className:"mt-3 text-xs text-gray-600",children:["\ud83c\udfaf Aprobador requerido: ",(0,y.jsx)("span",{className:"font-medium",children:e.requiredApprover})]})]}),(0,y.jsxs)("div",{className:"flex flex-col items-end space-y-2 ml-4",children:[(0,y.jsx)("button",{onClick:()=>H(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:"\ud83d\udc41\ufe0f"}),"impactAnalysis"===e.status&&(0,y.jsx)("button",{onClick:()=>H(e),className:"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors text-sm",children:"\ud83d\udcca Completar An\xe1lisis"}),"readyForReview"===e.status&&!Re(e)&&(0,y.jsxs)(y.Fragment,{children:[le(e)&&(0,y.jsx)("button",{onClick:()=>De(e.id,"approved","Cambio aprobado directamente"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"\u2705 Aprobar"}),ne()&&(0,y.jsx)("button",{onClick:()=>De(e.id,"rejected","Cambio rechazado"),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"\u274c Rechazar"})]}),"readyForReview"===e.status&&Re(e)&&(0,y.jsx)("button",{onClick:()=>De(e.id,"underReview","Enviado a CCB para votaci\xf3n"),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm",children:"\ud83d\uddf3\ufe0f Enviar a CCB"}),"underReview"===e.status&&(0,y.jsx)("button",{onClick:()=>H(e),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"\ud83d\uddf3\ufe0f Ver Panel CCB"}),"approved"===e.status&&!e.selectedAlternative&&(0,y.jsx)("button",{onClick:()=>H(e),className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors text-sm animate-pulse",children:"\ud83c\udfaf Seleccionar Alternativa"}),"implementing"===e.status&&oe()&&(0,y.jsx)("button",{onClick:()=>De(e.id,"implemented","Cambio implementado exitosamente"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"\u2728 Completar Implementaci\xf3n"})]})]})})},e.id)})}),B&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,y.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:(0,y.jsxs)("div",{className:"p-8",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,y.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"\ud83d\udcdd Solicitar Cambio"}),(0,y.jsx)("button",{onClick:()=>T(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:"\u2715"})]}),(0,y.jsxs)("form",{onSubmit:e=>{e.preventDefault(),Ie()},className:"space-y-6",children:[(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udccb T\xedtulo del Cambio *"}),(0,y.jsx)("input",{type:"text",required:!0,value:ve.title,onChange:e=>ye("title",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors",placeholder:"T\xedtulo descriptivo del cambio"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83c\udff7\ufe0f Categor\xeda *"}),(0,y.jsx)("select",{required:!0,value:ve.category,onChange:e=>ye("category",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors",children:Object.entries(Ne).map(e=>{let[a,t]=e;return(0,y.jsxs)("option",{value:a,children:[t.icon," ",t.label]},a)})})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u26a1 Prioridad *"}),(0,y.jsx)("select",{required:!0,value:ve.priority,onChange:e=>ye("priority",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors",children:Object.entries(Ae).map(e=>{let[a,t]=e;return(0,y.jsxs)("option",{value:a,children:[t.icon," ",t.label]},a)})})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udc64 Solicitante *"}),(0,y.jsx)("input",{type:"text",required:!0,value:ve.requestedBy,onChange:e=>ye("requestedBy",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors",placeholder:"Nombre del solicitante"})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcdd Descripci\xf3n Detallada *"}),(0,y.jsx)("textarea",{required:!0,rows:4,value:ve.description,onChange:e=>ye("description",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors resize-none",placeholder:"Describe detalladamente el cambio solicitado, incluyendo el contexto y la necesidad"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83c\udfaf Justificaci\xf3n del Cambio *"}),(0,y.jsx)("textarea",{required:!0,rows:3,value:ve.justification,onChange:e=>ye("justification",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors resize-none",placeholder:"Explica por qu\xe9 es necesario este cambio y qu\xe9 beneficios aportar\xe1"})]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcb0 Impacto en Costos (K)"}),(0,y.jsx)("input",{type:"number",value:ve.impactCost,onChange:e=>ye("impactCost",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors",placeholder:"0",min:"0",step:"0.1"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcc5 Impacto en Cronograma (d\xedas)"}),(0,y.jsx)("input",{type:"number",value:ve.impactSchedule,onChange:e=>ye("impactSchedule",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors",placeholder:"0",min:"0",step:"0.5"})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udccb Impacto en Alcance"}),(0,y.jsx)("textarea",{rows:2,value:ve.impactScope,onChange:e=>ye("impactScope",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors resize-none",placeholder:"Describe el impacto en el alcance del proyecto"})]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcc5 Fecha de Solicitud"}),(0,y.jsx)("input",{type:"date",value:ve.requestedDate,onChange:e=>ye("requestedDate",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83c\udfaf Fecha Esperada de Implementaci\xf3n"}),(0,y.jsx)("input",{type:"date",value:ve.expectedImplementationDate,onChange:e=>ye("expectedImplementationDate",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"})]})]}),(0,y.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[(0,y.jsx)("button",{type:"button",onClick:()=>T(!1),className:"px-6 py-3 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-xl transition-colors font-medium",children:"Cancelar"}),(0,y.jsx)("button",{type:"submit",className:"px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl hover:from-purple-700 hover:to-indigo-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:"\ud83d\udce4 Enviar Solicitud"})]})]})]})})}),Q&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 overflow-y-auto",children:(0,y.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-y-auto my-8",children:(0,y.jsxs)("div",{className:"p-8",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,y.jsxs)("h2",{className:"text-3xl font-bold text-gray-800",children:["\ud83d\udccb Detalles del Cambio: ",Q.changeNumber]}),(0,y.jsx)("button",{onClick:()=>H(null),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:"\u2715"})]}),(0,y.jsxs)("div",{className:"space-y-6",children:[(0,y.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6",children:[(0,y.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udccb Informaci\xf3n B\xe1sica"}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-sm text-gray-500",children:"T\xedtulo:"}),(0,y.jsx)("div",{className:"font-medium",children:Q.title})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-sm text-gray-500",children:"Categor\xeda:"}),(0,y.jsxs)("div",{className:"font-medium",children:[null===(a=Ne[Q.category])||void 0===a?void 0:a.icon," ",null===(t=Ne[Q.category])||void 0===t?void 0:t.label]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-sm text-gray-500",children:"Prioridad:"}),(0,y.jsxs)("div",{className:"font-medium",children:[null===(o=Ae[Q.priority])||void 0===o?void 0:o.icon," ",null===(c=Ae[Q.priority])||void 0===c?void 0:c.label]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-sm text-gray-500",children:"Estado:"}),(0,y.jsxs)("div",{className:"font-medium",children:[null===(d=Ce[Q.status])||void 0===d?void 0:d.icon," ",null===(m=Ce[Q.status])||void 0===m?void 0:m.label]})]}),Q.requiredApprover&&(0,y.jsxs)("div",{className:"md:col-span-2",children:[(0,y.jsx)("span",{className:"text-sm text-gray-500",children:"Aprobador Requerido:"}),(0,y.jsxs)("div",{className:"font-medium text-purple-700",children:["\ud83c\udfaf ",Q.requiredApprover," (Nivel: ",Q.authorityLevel,")"]})]})]})]}),(0,y.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6",children:[(0,y.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udcdd Descripci\xf3n y Justificaci\xf3n"}),(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-sm text-gray-500",children:"Descripci\xf3n:"}),(0,y.jsx)("div",{className:"mt-1",children:Q.description})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"text-sm text-gray-500",children:"Justificaci\xf3n:"}),(0,y.jsx)("div",{className:"mt-1",children:Q.justification})]})]})]}),be&&(0,y.jsx)(y.Fragment,{children:"impactAnalysis"===Q.status?(0,y.jsx)(A,{change:Q,onComplete:()=>(e=>{const a=q.find(a=>a.id===e);if(!a)return;if(!a.alternatives||a.alternatives.length<3)return void alert("\u274c Debes agregar al menos 3 alternativas antes de completar el an\xe1lisis");const t=q.map(a=>a.id===e?(0,s.A)((0,s.A)({},a),{},{status:"readyForReview",impactAnalysisComplete:!0,updatedAt:(new Date).toISOString()}):a);M(t),fe(t),ee("change_management","impact_analysis_completed",{changeId:e,changeNumber:a.changeNumber,alternativesCount:a.alternatives.length}),alert("\u2705 An\xe1lisis de impacto completado. El cambio est\xe1 listo para revisi\xf3n.")})(Q.id),onUpdateAlternatives:e=>_e(Q.id,e)}):(0,y.jsx)(C,{change:Q,project:be})}),"underReview"===Q.status&&(0,y.jsx)(f,{change:Q,currentUserPermissions:te,onUpdateVotes:e=>((e,a)=>{const t=q.map(t=>t.id===e?(0,s.A)((0,s.A)({},t),{},{ccbVotes:a}):t);M(t),fe(t)})(Q.id,e)}),"approved"!==Q.status||Q.selectedAlternative?(0,y.jsx)(w,{change:Q,currentUserPermissions:te,onUpdateAlternatives:e=>_e(Q.id,e),onSelectAlternative:e=>Ee(Q.id,e),canSelect:!1}):(0,y.jsx)(S,{change:Q,onSelectAlternative:e=>Ee(Q.id,e)}),Q.statusHistory&&Q.statusHistory.length>0&&(0,y.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6",children:[(0,y.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udcc8 Historial de Estados"}),(0,y.jsx)("div",{className:"space-y-3",children:Q.statusHistory.map((e,a)=>{var t,s,r;return(0,y.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[(0,y.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(null===(t=Ce[e.status])||void 0===t?void 0:t.color),children:[null===(s=Ce[e.status])||void 0===s?void 0:s.icon," ",null===(r=Ce[e.status])||void 0===r?void 0:r.label]}),(0,y.jsx)("span",{className:"text-sm text-gray-500",children:new Date(e.date).toLocaleDateString()}),e.comments&&(0,y.jsxs)("span",{className:"text-sm text-gray-600",children:["- ",e.comments]})]},a)})})]}),(0,y.jsx)("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:(0,y.jsx)("button",{onClick:()=>H(null),className:"px-6 py-3 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-xl transition-colors font-medium",children:"Cerrar"})})]})]})})})]}):(0,y.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center",children:[(0,y.jsx)("div",{className:"text-6xl mb-4",children:"\u26a0\ufe0f"}),(0,y.jsx)("h3",{className:"text-xl font-bold text-yellow-800 mb-2",children:"No hay proyecto seleccionado"}),(0,y.jsx)("p",{className:"text-yellow-700",children:"Selecciona un proyecto desde el men\xfa principal para gestionar sus cambios"})]})})})}}}]);
{"version":3,"file":"static/js/781.987cfe57.chunk.js","mappings":"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","sources":["hooks/useAuditLog.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\n\nconst useAuditLog = (projectId, useSupabase = false) => {\n  const [auditLog, setAuditLog] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Cargar log de auditorÃ­a desde localStorage o Supabase\n  useEffect(() => {\n    const loadAuditLog = async () => {\n      if (!projectId) return;\n      \n      setIsLoading(true);\n      \n      try {\n        if (useSupabase) {\n          // Cargar desde Supabase usando los nuevos mÃ©todos\n          const { default: supabaseService } = await import('../services/SupabaseService');\n          if (supabaseService.isAuthenticated()) {\n            const result = await supabaseService.loadAuditEvents(projectId);\n            if (result.success) {\n              setAuditLog(result.events);\n              console.log(`âœ… Logs de auditorÃ­a cargados desde Supabase para proyecto ${projectId}: ${result.events.length} eventos`);\n            } else {\n              // Fallback a localStorage si Supabase falla\n              const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n              if (savedLog) {\n                setAuditLog(JSON.parse(savedLog));\n              } else {\n                setAuditLog([]);\n              }\n            }\n          } else {\n            // Fallback a localStorage si no hay autenticaciÃ³n\n            const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n            if (savedLog) {\n              setAuditLog(JSON.parse(savedLog));\n            } else {\n              setAuditLog([]);\n            }\n          }\n        } else {\n          // Cargar desde localStorage\n          const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n          if (savedLog) {\n            setAuditLog(JSON.parse(savedLog));\n          } else {\n            setAuditLog([]);\n          }\n        }\n      } catch (error) {\n        console.error('Error loading audit log:', error);\n        // Fallback a localStorage en caso de error\n        const savedLog = localStorage.getItem(`audit-log-${projectId}`);\n        if (savedLog) {\n          setAuditLog(JSON.parse(savedLog));\n        }\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadAuditLog();\n  }, [projectId, useSupabase]);\n\n  // Guardar log de auditorÃ­a en localStorage y/o Supabase\n  const saveAuditLog = useCallback(async (log) => {\n    // Siempre guardar en localStorage como backup\n    localStorage.setItem(`audit-log-${projectId}`, JSON.stringify(log));\n\n    // NOTA: La sincronizaciÃ³n con Supabase se hace individualmente por evento\n    // No enviamos toda la lista para evitar duplicados\n    console.log(`ðŸ“‹ Logs de auditorÃ­a guardados en localStorage para proyecto ${projectId}: ${log.length} eventos`);\n  }, [projectId]);\n\n  // Guardar un evento individual en Supabase\n  const saveEventToSupabase = useCallback(async (event) => {\n    if (!useSupabase) return;\n\n    try {\n      const { default: supabaseService } = await import('../services/SupabaseService');\n      if (supabaseService.isAuthenticated()) {\n        // Guardar solo este evento especÃ­fico\n        const result = await supabaseService.saveAuditEvents(projectId, [event]);\n        if (result.success) {\n          console.log(`âœ… Evento de auditorÃ­a guardado en Supabase: ${event.action}`);\n        } else {\n          console.warn('âš ï¸ Error guardando evento en Supabase:', result.error);\n        }\n      }\n    } catch (error) {\n      console.error('Error guardando evento en Supabase:', error);\n    }\n  }, [projectId, useSupabase]);\n\n  // Agregar evento de auditorÃ­a\n  const addAuditEvent = useCallback(async (event) => {\n    const newEvent = {\n      id: crypto.randomUUID(), // Generar UUID vÃ¡lido para Supabase\n      timestamp: new Date().toISOString(),\n      projectId,\n      ...event\n    };\n\n    setAuditLog(prevLog => {\n      const updatedLog = [newEvent, ...prevLog];\n      // Guardar de forma asÃ­ncrona en localStorage\n      saveAuditLog(updatedLog);\n      return updatedLog;\n    });\n\n    // Guardar este evento especÃ­fico en Supabase\n    saveEventToSupabase(newEvent);\n\n    return newEvent;\n  }, [projectId, saveAuditLog, saveEventToSupabase]);\n\n  // Registrar cambio de estado del proyecto\n  const logProjectStatusChange = useCallback((previousStatus, newStatus, projectData) => {\n    addAuditEvent({\n      category: 'project-status',\n      action: 'status-changed',\n      description: `Estado del proyecto cambiado de \"${previousStatus}\" a \"${newStatus}\"`,\n      details: {\n        previousStatus,\n        newStatus,\n        projectName: projectData.name,\n        manager: projectData.manager,\n        budget: projectData.budget\n      },\n      severity: 'high',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar creaciÃ³n de work package\n  const logWorkPackageCreated = useCallback((workPackage, projectData) => {\n    addAuditEvent({\n      category: 'work-package',\n      action: 'created',\n      description: `Work Package \"${workPackage.name}\" creado`,\n      details: {\n        workPackageId: workPackage.id,\n        name: workPackage.name,\n        budget: workPackage.budget,\n        status: workPackage.status\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar modificaciÃ³n de work package\n  const logWorkPackageModified = useCallback((workPackage, changes, projectData) => {\n    addAuditEvent({\n      category: 'work-package',\n      action: 'modified',\n      description: `Work Package \"${workPackage.name}\" modificado`,\n      details: {\n        workPackageId: workPackage.id,\n        name: workPackage.name,\n        changes: Object.keys(changes),\n        previousValues: changes\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar creaciÃ³n de riesgo\n  const logRiskCreated = useCallback((risk, projectData) => {\n    addAuditEvent({\n      category: 'risk',\n      action: 'created',\n      description: `Riesgo \"${risk.name}\" identificado`,\n      details: {\n        riskId: risk.id,\n        name: risk.name,\n        probability: risk.probability,\n        impact: risk.impact,\n        priority: risk.priority\n      },\n      severity: risk.priority === 'high' ? 'high' : 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar evento financiero\n  const logFinancialEvent = useCallback((type, item, projectData) => {\n    const eventMap = {\n      'purchase-order': {\n        action: 'created',\n        description: `Orden de Compra \"${item.description}\" creada`,\n        details: {\n          poId: item.id,\n          description: item.description,\n          amount: item.amount,\n          supplier: item.supplier\n        }\n      },\n      'advance': {\n        action: 'created',\n        description: `Anticipo \"${item.description}\" creado`,\n        details: {\n          advanceId: item.id,\n          description: item.description,\n          amount: item.amount,\n          recipient: item.recipient\n        }\n      },\n      'invoice': {\n        action: 'created',\n        description: `Factura \"${item.description}\" creada`,\n        details: {\n          invoiceId: item.id,\n          description: item.description,\n          amount: item.amount,\n          supplier: item.supplier\n        }\n      },\n      'contract': {\n        action: 'created',\n        description: `Contrato \"${item.name}\" creado`,\n        details: {\n          contractId: item.id,\n          name: item.name,\n          value: item.value,\n          contractor: item.contractor\n        }\n      }\n    };\n\n    const eventConfig = eventMap[type];\n    if (eventConfig) {\n      addAuditEvent({\n        category: 'financial',\n        action: eventConfig.action,\n        description: eventConfig.description,\n        details: eventConfig.details,\n        severity: 'high',\n        user: projectData.manager || 'Sistema'\n      });\n    }\n  }, [addAuditEvent]);\n\n  // Registrar asignaciÃ³n de recursos\n  const logResourceAssignment = useCallback((assignment, projectData) => {\n    addAuditEvent({\n      category: 'resources',\n      action: 'assigned',\n      description: `Recurso asignado al proyecto`,\n      details: {\n        assignmentId: assignment.id,\n        resourceId: assignment.resourceId,\n        role: assignment.role,\n        allocation: assignment.allocation\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar creaciÃ³n de tarea de minuta\n  const logMinutaTaskCreated = useCallback((minutaTask, projectData) => {\n    addAuditEvent({\n      category: 'minutes',\n      action: 'minute-task-created',\n      description: `Tarea de minuta \"${minutaTask.tarea}\" creada`,\n      details: {\n        taskId: minutaTask.id,\n        tarea: minutaTask.tarea,\n        responsable: minutaTask.responsable,\n        fecha: minutaTask.fecha,\n        hitoId: minutaTask.hitoId,\n        estatus: minutaTask.estatus\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Registrar actualizaciÃ³n de tarea de minuta\n  const logMinutaTaskUpdated = useCallback((minutaTask, changes, projectData) => {\n    addAuditEvent({\n      category: 'minutes',\n      action: 'minute-task-updated',\n      description: `Tarea de minuta \"${minutaTask.tarea}\" actualizada`,\n      details: {\n        taskId: minutaTask.id,\n        tarea: minutaTask.tarea,\n        changes: changes,\n        newStatus: minutaTask.estatus\n      },\n      severity: 'medium',\n      user: projectData.manager || 'Sistema'\n    });\n  }, [addAuditEvent]);\n\n  // Limpiar log de auditorÃ­a\n  const clearAuditLog = useCallback(() => {\n    setAuditLog([]);\n    localStorage.removeItem(`audit-log-${projectId}`);\n  }, [projectId]);\n\n  // Exportar log de auditorÃ­a\n  const exportAuditLog = useCallback(() => {\n    const exportData = {\n      projectId,\n      exportDate: new Date().toISOString(),\n      totalEvents: auditLog.length,\n      events: auditLog\n    };\n\n    const dataStr = JSON.stringify(exportData, null, 2);\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\n    \n    const url = URL.createObjectURL(dataBlob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `audit-log-${projectId}-${new Date().toISOString().split('T')[0]}.json`;\n    link.click();\n    URL.revokeObjectURL(url);\n  }, [auditLog, projectId]);\n\n  return {\n    auditLog,\n    isLoading,\n    addAuditEvent,\n    logProjectStatusChange,\n    logWorkPackageCreated,\n    logWorkPackageModified,\n    logRiskCreated,\n    logFinancialEvent,\n    logResourceAssignment,\n    logMinutaTaskCreated,\n    logMinutaTaskUpdated,\n    clearAuditLog,\n    exportAuditLog\n  };\n};\n\nexport default useAuditLog;\n"],"names":["projectId","useSupabase","arguments","length","undefined","auditLog","setAuditLog","useState","isLoading","setIsLoading","useEffect","async","default","supabaseService","isAuthenticated","result","loadAuditEvents","success","events","console","log","concat","savedLog","localStorage","getItem","JSON","parse","error","loadAuditLog","saveAuditLog","useCallback","setItem","stringify","saveEventToSupabase","saveAuditEvents","event","action","warn","addAuditEvent","newEvent","_objectSpread","id","crypto","randomUUID","timestamp","Date","toISOString","prevLog","updatedLog","logProjectStatusChange","previousStatus","newStatus","projectData","category","description","details","projectName","name","manager","budget","severity","user","logWorkPackageCreated","workPackage","workPackageId","status","logWorkPackageModified","changes","Object","keys","previousValues","logRiskCreated","risk","riskId","probability","impact","priority","logFinancialEvent","type","item","eventConfig","poId","amount","supplier","advanceId","recipient","invoiceId","contractId","value","contractor","logResourceAssignment","assignment","assignmentId","resourceId","role","allocation","logMinutaTaskCreated","minutaTask","tarea","taskId","responsable","fecha","hitoId","estatus","logMinutaTaskUpdated","clearAuditLog","removeItem","exportAuditLog","exportData","exportDate","totalEvents","dataStr","dataBlob","Blob","url","URL","createObjectURL","link","document","createElement","href","download","split","click","revokeObjectURL"],"sourceRoot":""}